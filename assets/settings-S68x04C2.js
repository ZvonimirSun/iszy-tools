import{F as j,aV as D,aq as G,m as J,u as o,G as ee,a2 as te,a3 as N,at as oe,aU as le,bJ as ae,au as se,t as F,aE as M,J as _,K as C,X as e,a1 as t,ar as n,ap as u,ai as x,a0 as P,T as $,a$ as U,as as ne,az as re,aA as de,aB as ie,aC as ue}from"./index-H2_rx4Ff.js";import{E as pe}from"./el-checkbox-KSjJNqAp.js";import{E as me,a as fe}from"./el-radio-group-ex0mQY06.js";/* empty css                 */import{E as ce}from"./el-divider-KoIoyKmk.js";import{E as _e}from"./el-space-bwtVQA_4.js";import{E as we}from"./el-popover-nFPu-1cc.js";import{n as ge,b as he}from"./Router-ALeZVy9V.js";import{a as ve,E as Ve}from"./el-form-item-QFE-hqjC.js";import"./hasIn-gub3h7hm.js";import"./castArray-DGuu2HcO.js";const ke=j({inheritAttrs:!1,__name:"HaveAccess",props:{auth:{type:[Boolean,Object],default:!1},link:{default:""}},setup(p){const d=p,g=D(),E=ge(),m=G(),h=J(()=>d.auth?typeof d.auth=="boolean"?g.logged:g.checkAccess(d.auth):d.link?g.checkAccess(E.getAuth(d.link)):!0);function i(){d.link&&m.push(d.link)}return(c,b)=>o(h)?ee(c.$slots,"default",te({key:0},c.$attrs,{goto:i})):N("",!0)}}),ye=oe("main",{persist:!0,state:()=>({_cache:{},clearOfflineCacheTag:!1}),getters:{getData:p=>d=>{if(d)return(p._cache||{})[d]}},actions:{setData({key:p,val:d}={}){p&&(this._cache=this._cache||{},this._cache[p]=d)},clear(){this._cache={}},clearOfflineCache(){console.log("clearOfflineCache"),this.clearOfflineCacheTag=!0}}}),T=p=>(de("data-v-75a22de6"),p=p(),ie(),p),Ce={key:0,flex:"","flex-col":"","items-start":"","gap-4":"","text-7":""},Ee={flex:""},be=T(()=>u("div",{"w-32":""}," 昵称: ",-1)),Se={flex:""},xe=T(()=>u("div",{"w-32":""}," 邮箱: ",-1)),Pe={flex:""},Ue=T(()=>u("div",{"w-32":""}," 角色 ",-1)),Ne={flex:"","gap-4":""},Te={flex:"","flex-wrap":"","items-start":"","gap-4":"","text-7":"",class:"settings-container"},Oe={class:"settings-wrapper"},Ae={key:0,class:"settings-wrapper"},Ie=j({__name:"settings",setup(p){const d=G(),g=le(),E=ae(),m=D(),h=se(),i=J(()=>h.general),c=F(!1),b=F(),a=M({nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),q=M({rePasswd:[{validator:(v,l,r)=>{l&&l!==a.passwd?r(new Error("两次输入的密码不一致")):r()}}],oldPasswd:[{validator:(v,l,r)=>{!l&&(a.passwd||a.rePasswd)?r(new Error("请输入旧密码")):r()}}]}),O=()=>ye().clearOfflineCache();function H(){d.push({path:"/login",query:{redirect:g.fullPath}})}function z(){d.push("/logout")}function K(){a.nickName=m.profile.nickName??"",a.email=m.profile.email??"",a.passwd="",a.rePasswd="",a.oldPasswd="",c.value=!0}function X(){c.value=!1}async function L(v){v&&await v.validate(async l=>{if(l){const r={};if(a.nickName&&(r.nickName=a.nickName),a.email&&(r.email=a.email),a.passwd&&(r.passwd=a.passwd,r.oldPasswd=a.oldPasswd),Object.keys(r).length===0){U.warning("没有需要修改的信息");return}try{await m.updateUser(r)}catch(f){U.error(f.message)}c.value=!1}else return U.warning("请检查输入"),!1})}return(v,l)=>{var I,R,B;const r=he,f=ne,Q=ke,V=re,k=ve,W=Ve,A=we,y=_e,Y=ce,S=me,Z=fe,w=pe;return _(),C($,null,[e(r,{level:3},{default:t(()=>[n(" 账户信息 ")]),_:1}),o(m).logged?(_(),C("div",Ce,[u("div",Ee,[be,u("div",null,x(o(m).profile.nickName),1)]),u("div",Se,[xe,u("div",null,x(o(m).profile.email),1)]),u("div",Pe,[Ue,u("div",null,x(((B=(R=(I=o(m).profile)==null?void 0:I.roles)==null?void 0:R[0])==null?void 0:B.alias)??"普通用户"),1)]),u("div",Ne,[e(f,{type:"primary",onClick:z},{default:t(()=>[n(" 登出 ")]),_:1}),e(Q,{link:"/userManager"},{default:t(({goto:s})=>[e(f,{type:"primary",onClick:s},{default:t(()=>[n(" 用户权限中心 ")]),_:2},1032,["onClick"])]),_:1}),o(c)?(_(),C($,{key:1},[e(f,{type:"primary",onClick:l[0]||(l[0]=s=>L(o(b)))},{default:t(()=>[n(" 保存 ")]),_:1}),e(f,{onClick:X},{default:t(()=>[n(" 取消 ")]),_:1})],64)):(_(),P(f,{key:0,onClick:K},{default:t(()=>[n(" 修改信息 ")]),_:1}))]),o(c)?(_(),P(W,{key:0,ref_key:"ruleFormRef",ref:b,model:o(a),rules:o(q),"label-width":"8rem","label-position":"left"},{default:t(()=>[e(k,{label:"昵称",prop:"nickName"},{default:t(()=>[e(V,{modelValue:o(a).nickName,"onUpdate:modelValue":l[1]||(l[1]=s=>o(a).nickName=s)},null,8,["modelValue"])]),_:1}),e(k,{label:"邮箱",prop:"email"},{default:t(()=>[e(V,{modelValue:o(a).email,"onUpdate:modelValue":l[2]||(l[2]=s=>o(a).email=s)},null,8,["modelValue"])]),_:1}),e(k,{label:"旧密码",prop:"oldPasswd"},{default:t(()=>[e(V,{modelValue:o(a).oldPasswd,"onUpdate:modelValue":l[3]||(l[3]=s=>o(a).oldPasswd=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(k,{label:"新密码",prop:"passwd"},{default:t(()=>[e(V,{modelValue:o(a).passwd,"onUpdate:modelValue":l[4]||(l[4]=s=>o(a).passwd=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(k,{label:"确认密码",prop:"rePasswd"},{default:t(()=>[e(V,{modelValue:o(a).rePasswd,"onUpdate:modelValue":l[5]||(l[5]=s=>o(a).rePasswd=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])):N("",!0),e(A,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:O},{reference:t(()=>[e(f,{type:"danger",plain:""},{default:t(()=>[n(" 清空本地缓存 ")]),_:1})]),_:1})])):(_(),P(y,{key:1},{default:t(()=>[e(f,{type:"primary",onClick:H},{default:t(()=>[n(" 登录 ")]),_:1}),e(A,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:O},{reference:t(()=>[e(f,{type:"danger",plain:""},{default:t(()=>[n(" 清空本地缓存 ")]),_:1})]),_:1})]),_:1})),e(Y),u("div",Te,[u("div",Oe,[e(r,{level:4},{default:t(()=>[n(" 全局设置 ")]),_:1}),e(r,{level:5},{default:t(()=>[n(" 外观 ")]),_:1}),e(y,null,{default:t(()=>[e(Z,{"model-value":o(i).theme.mode,onChange:o(E).setTheme},{default:t(()=>[e(S,{label:"auto"},{default:t(()=>[n(" 跟随系统 ")]),_:1}),e(S,{label:"light"},{default:t(()=>[n(" 浅色 ")]),_:1}),e(S,{label:"dark"},{default:t(()=>[n(" 深色 ")]),_:1})]),_:1},8,["model-value","onChange"])]),_:1}),e(r,{level:5},{default:t(()=>[n(" 访问统计 ")]),_:1}),e(y,null,{default:t(()=>[e(w,{modelValue:o(i).showMost,"onUpdate:modelValue":l[6]||(l[6]=s=>o(i).showMost=s)},{default:t(()=>[n(" 最常访问 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(i).showRecent,"onUpdate:modelValue":l[7]||(l[7]=s=>o(i).showRecent=s)},{default:t(()=>[n(" 最近访问 ")]),_:1},8,["modelValue"])]),_:1}),e(r,{level:5},{default:t(()=>[n(" 其他设置 ")]),_:1}),e(y,null,{default:t(()=>[e(w,{modelValue:o(i).showSearch,"onUpdate:modelValue":l[8]||(l[8]=s=>o(i).showSearch=s)},{default:t(()=>[n(" 显示搜索 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(i).showType,"onUpdate:modelValue":l[9]||(l[9]=s=>o(i).showType=s)},{default:t(()=>[n(" 显示分类 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(i).openInNewTab,"onUpdate:modelValue":l[10]||(l[10]=s=>o(i).openInNewTab=s)},{default:t(()=>[n(" 新标签页打开工具 ")]),_:1},8,["modelValue"])]),_:1})]),o(m).logged?(_(),C("div",Ae,[e(r,{level:4},{default:t(()=>[n(" 应用设置 ")]),_:1}),e(r,{level:5},{default:t(()=>[n(" JSON 编辑器 ")]),_:1}),e(y,null,{default:t(()=>[e(w,{modelValue:o(h).modules.jsonEditor.syncCloud,"onUpdate:modelValue":l[11]||(l[11]=s=>o(h).modules.jsonEditor.syncCloud=s)},{default:t(()=>[n(" 从云端获取 ")]),_:1},8,["modelValue"])]),_:1})])):N("",!0)])],64)}}}),ze=ue(Ie,[["__scopeId","data-v-75a22de6"]]);export{ze as default};
