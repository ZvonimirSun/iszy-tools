import{h as N,R as G,V as f,a0 as V,X as z,k,Y as A,n as m,o as w,l as L,a as _,w as j,a1 as F,c as P,B as q,a2 as I,_ as M}from"./index-4d48419a.js";import{E as X}from"./el-empty-92537ae9.js";import{E as Y,a as H}from"./el-table-v2-223f5521.js";import"./el-scrollbar-e88d9e52.js";import"./castArray-dc14ee52.js";const Q=N({__name:"propertyTable",props:{height:{default:null}},setup(U){G(()=>{f.on("updateGeojsonLayer",E),f.on("updateEditor",E)});const u=V(null),n=z({row:null,col:null,value:null,changed:!1});let y=!1;const b=k(()=>{var t,e;return(e=(t=u.value)==null?void 0:t.features)!=null&&e.length?u.value.features.map(a=>a.properties||{}):[]}),h=k(()=>{var t,e;if((e=(t=u.value)==null?void 0:t.features)!=null&&e.length){const a=R(b.value);if(!a.length)return null;const l=a.map(o=>({title:o,dataKey:o,key:o,width:150,cellRenderer:({rowData:s,column:i,rowIndex:c,columnIndex:d})=>{let p,v;s[i.dataKey]!=null?(v=typeof s[i.dataKey],~["boolean","number","string"].indexOf(v)?p=s[i.dataKey].toString():p=JSON.stringify(s[i.dataKey])):p="";const C=()=>{n.row=c,n.col=d,n.value=p},T=()=>{if(n.changed){let r;if(n.value!=null?r=n.value.trim():r="",v!=="string")try{r=JSON.parse(r)}catch{}K(c,d,r)}n.row=null,n.col=null,n.value=null,n.changed=!1},B=r=>{n.value=r,n.changed=!0},J=r=>{var g;(g=r==null?void 0:r.focus)==null||g.call(r)};return n.row===c&&n.col===d?_(q,{ref:J,modelValue:n.value,onInput:B,onBlur:T},null):_("div",{class:"table-v2-inline-editing-trigger",onClick:C,title:p},[p])}}));return l.unshift({title:"序号",dataKey:"index",key:"index",width:50,fixed:!0,cellRenderer:({rowIndex:o})=>_("span",{class:"_index"},[o+1])}),l}else return null}),x=A(O,500);function S(t){var a;let e=t.target;if(e.classList.contains("el-table-v2__row")||(e=e.closest(".el-table-v2__row")),e&&e.parentElement){const l=[].indexOf.call(e.parentElement.children,e),o=(a=e.closest(".el-table-v2__root"))==null?void 0:a.querySelectorAll("._index")[l];if(o){const s=parseInt(o.textContent||"1")-1;f.emit("selectFeature",s)}}}function K(t,e,a){var o,s,i,c;const l=(s=(o=u.value)==null?void 0:o.features)==null?void 0:s[t];if(l){l.properties||(l.properties={});const d=(c=(i=h.value)==null?void 0:i[e])==null?void 0:c.dataKey;d&&(l.properties[d]=a)}u.value&&x(I(u.value))}function O(t){y||(y=!0,f.emit("updateEditor",t),y=!1)}function E(){y||f.emit("getGeoJson",function(t){u.value=t})}function R(t){return[...t.reduce((e,a)=>(Object.keys(a).forEach(l=>e.add(l)),e),new Set)]}return(t,e)=>{const a=Y,l=H,o=X;return m(h)?(w(),L("div",{key:0,"w-full":"",style:F({height:t.height?t.height+"px":void 0})},[_(l,null,{default:j(({height:s,width:i})=>[_(a,{columns:m(h),data:m(b),width:i,height:s,fixed:"",onClick:S},null,8,["columns","data","width","height"])]),_:1})],4)):(w(),P(o,{key:1}))}}});const te=M(Q,[["__scopeId","data-v-441c8626"]]);export{te as default};
