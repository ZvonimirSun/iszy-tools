var q6=Object.defineProperty;var Y6=(n,e,t)=>e in n?q6(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var j=(n,e,t)=>Y6(n,typeof e!="symbol"?e+"":e,t);import{by as Rr,aU as wa,a4 as X6,ag as hi,X as DM,ap as Z6,as as Q6,a2 as J6,a8 as ez,a3 as tz,k as nz,ax as rz,q as oz,E as sz,K as iz,v as eI,a0 as az}from"./index-pX3VYlhd.js";import{c as oa,d as LM,e as lz}from"./tslib.es6-C-xmt75I.js";function cz(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const o in r)if(o!=="default"&&!(o in n)){const s=Object.getOwnPropertyDescriptor(r,o);s&&Object.defineProperty(n,o,s.get?s:{enumerable:!0,get:()=>r[o]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}const uz=["top","right","bottom","left"],Cs=Math.min,Xr=Math.max,Uf=Math.round,_p=Math.floor,ga=n=>({x:n,y:n}),dz={left:"right",right:"left",bottom:"top",top:"bottom"},hz={start:"end",end:"start"};function Zx(n,e,t){return Xr(n,Cs(e,t))}function xi(n,e){return typeof n=="function"?n(e):n}function wi(n){return n.split("-")[0]}function Yc(n){return n.split("-")[1]}function yb(n){return n==="x"?"y":"x"}function vb(n){return n==="y"?"height":"width"}function ma(n){return["top","bottom"].includes(wi(n))?"y":"x"}function Sb(n){return yb(ma(n))}function pz(n,e,t){t===void 0&&(t=!1);const r=Yc(n),o=Sb(n),s=vb(o);let i=o==="x"?r===(t?"end":"start")?"right":"left":r==="start"?"bottom":"top";return e.reference[s]>e.floating[s]&&(i=Hf(i)),[i,Hf(i)]}function fz(n){const e=Hf(n);return[Qx(n),e,Qx(e)]}function Qx(n){return n.replace(/start|end/g,e=>hz[e])}function gz(n,e,t){const r=["left","right"],o=["right","left"],s=["top","bottom"],i=["bottom","top"];switch(n){case"top":case"bottom":return t?e?o:r:e?r:o;case"left":case"right":return e?s:i;default:return[]}}function mz(n,e,t,r){const o=Yc(n);let s=gz(wi(n),t==="start",r);return o&&(s=s.map(i=>i+"-"+o),e&&(s=s.concat(s.map(Qx)))),s}function Hf(n){return n.replace(/left|right|bottom|top/g,e=>dz[e])}function yz(n){return{top:0,right:0,bottom:0,left:0,...n}}function FM(n){return typeof n!="number"?yz(n):{top:n,right:n,bottom:n,left:n}}function Kf(n){const{x:e,y:t,width:r,height:o}=n;return{width:r,height:o,top:t,left:e,right:e+r,bottom:t+o,x:e,y:t}}function tI(n,e,t){let{reference:r,floating:o}=n;const s=ma(e),i=Sb(e),a=vb(i),c=wi(e),u=s==="y",h=r.x+r.width/2-o.width/2,f=r.y+r.height/2-o.height/2,g=r[a]/2-o[a]/2;let y;switch(c){case"top":y={x:h,y:r.y-o.height};break;case"bottom":y={x:h,y:r.y+r.height};break;case"right":y={x:r.x+r.width,y:f};break;case"left":y={x:r.x-o.width,y:f};break;default:y={x:r.x,y:r.y}}switch(Yc(e)){case"start":y[i]-=g*(t&&u?-1:1);break;case"end":y[i]+=g*(t&&u?-1:1);break}return y}const vz=async(n,e,t)=>{const{placement:r="bottom",strategy:o="absolute",middleware:s=[],platform:i}=t,a=s.filter(Boolean),c=await(i.isRTL==null?void 0:i.isRTL(e));let u=await i.getElementRects({reference:n,floating:e,strategy:o}),{x:h,y:f}=tI(u,r,c),g=r,y={},v=0;for(let S=0;S<a.length;S++){const{name:w,fn:b}=a[S],{x:_,y:T,data:E,reset:M}=await b({x:h,y:f,initialPlacement:r,placement:g,strategy:o,middlewareData:y,rects:u,platform:i,elements:{reference:n,floating:e}});h=_??h,f=T??f,y={...y,[w]:{...y[w],...E}},M&&v<=50&&(v++,typeof M=="object"&&(M.placement&&(g=M.placement),M.rects&&(u=M.rects===!0?await i.getElementRects({reference:n,floating:e,strategy:o}):M.rects),{x:h,y:f}=tI(u,g,c)),S=-1)}return{x:h,y:f,placement:g,strategy:o,middlewareData:y}};async function kd(n,e){var t;e===void 0&&(e={});const{x:r,y:o,platform:s,rects:i,elements:a,strategy:c}=n,{boundary:u="clippingAncestors",rootBoundary:h="viewport",elementContext:f="floating",altBoundary:g=!1,padding:y=0}=xi(e,n),v=FM(y),w=a[g?f==="floating"?"reference":"floating":f],b=Kf(await s.getClippingRect({element:(t=await(s.isElement==null?void 0:s.isElement(w)))==null||t?w:w.contextElement||await(s.getDocumentElement==null?void 0:s.getDocumentElement(a.floating)),boundary:u,rootBoundary:h,strategy:c})),_=f==="floating"?{x:r,y:o,width:i.floating.width,height:i.floating.height}:i.reference,T=await(s.getOffsetParent==null?void 0:s.getOffsetParent(a.floating)),E=await(s.isElement==null?void 0:s.isElement(T))?await(s.getScale==null?void 0:s.getScale(T))||{x:1,y:1}:{x:1,y:1},M=Kf(s.convertOffsetParentRelativeRectToViewportRelativeRect?await s.convertOffsetParentRelativeRectToViewportRelativeRect({elements:a,rect:_,offsetParent:T,strategy:c}):_);return{top:(b.top-M.top+v.top)/E.y,bottom:(M.bottom-b.bottom+v.bottom)/E.y,left:(b.left-M.left+v.left)/E.x,right:(M.right-b.right+v.right)/E.x}}const Sz=n=>({name:"arrow",options:n,async fn(e){const{x:t,y:r,placement:o,rects:s,platform:i,elements:a,middlewareData:c}=e,{element:u,padding:h=0}=xi(n,e)||{};if(u==null)return{};const f=FM(h),g={x:t,y:r},y=Sb(o),v=vb(y),S=await i.getDimensions(u),w=y==="y",b=w?"top":"left",_=w?"bottom":"right",T=w?"clientHeight":"clientWidth",E=s.reference[v]+s.reference[y]-g[y]-s.floating[v],M=g[y]-s.reference[y],A=await(i.getOffsetParent==null?void 0:i.getOffsetParent(u));let R=A?A[T]:0;(!R||!await(i.isElement==null?void 0:i.isElement(A)))&&(R=a.floating[T]||s.floating[v]);const L=E/2-M/2,K=R/2-S[v]/2-1,D=Cs(f[b],K),U=Cs(f[_],K),V=D,F=R-S[v]-U,$=R/2-S[v]/2+L,H=Zx(V,$,F),Z=!c.arrow&&Yc(o)!=null&&$!==H&&s.reference[v]/2-($<V?D:U)-S[v]/2<0,G=Z?$<V?$-V:$-F:0;return{[y]:g[y]+G,data:{[y]:H,centerOffset:$-H-G,...Z&&{alignmentOffset:G}},reset:Z}}}),xz=function(n){return n===void 0&&(n={}),{name:"flip",options:n,async fn(e){var t,r;const{placement:o,middlewareData:s,rects:i,initialPlacement:a,platform:c,elements:u}=e,{mainAxis:h=!0,crossAxis:f=!0,fallbackPlacements:g,fallbackStrategy:y="bestFit",fallbackAxisSideDirection:v="none",flipAlignment:S=!0,...w}=xi(n,e);if((t=s.arrow)!=null&&t.alignmentOffset)return{};const b=wi(o),_=ma(a),T=wi(a)===a,E=await(c.isRTL==null?void 0:c.isRTL(u.floating)),M=g||(T||!S?[Hf(a)]:fz(a)),A=v!=="none";!g&&A&&M.push(...mz(a,S,v,E));const R=[a,...M],L=await kd(e,w),K=[];let D=((r=s.flip)==null?void 0:r.overflows)||[];if(h&&K.push(L[b]),f){const $=pz(o,i,E);K.push(L[$[0]],L[$[1]])}if(D=[...D,{placement:o,overflows:K}],!K.every($=>$<=0)){var U,V;const $=(((U=s.flip)==null?void 0:U.index)||0)+1,H=R[$];if(H)return{data:{index:$,overflows:D},reset:{placement:H}};let Z=(V=D.filter(G=>G.overflows[0]<=0).sort((G,q)=>G.overflows[1]-q.overflows[1])[0])==null?void 0:V.placement;if(!Z)switch(y){case"bestFit":{var F;const G=(F=D.filter(q=>{if(A){const Q=ma(q.placement);return Q===_||Q==="y"}return!0}).map(q=>[q.placement,q.overflows.filter(Q=>Q>0).reduce((Q,ae)=>Q+ae,0)]).sort((q,Q)=>q[1]-Q[1])[0])==null?void 0:F[0];G&&(Z=G);break}case"initialPlacement":Z=a;break}if(o!==Z)return{reset:{placement:Z}}}return{}}}};function nI(n,e){return{top:n.top-e.height,right:n.right-e.width,bottom:n.bottom-e.height,left:n.left-e.width}}function rI(n){return uz.some(e=>n[e]>=0)}const wz=function(n){return n===void 0&&(n={}),{name:"hide",options:n,async fn(e){const{rects:t}=e,{strategy:r="referenceHidden",...o}=xi(n,e);switch(r){case"referenceHidden":{const s=await kd(e,{...o,elementContext:"reference"}),i=nI(s,t.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:rI(i)}}}case"escaped":{const s=await kd(e,{...o,altBoundary:!0}),i=nI(s,t.floating);return{data:{escapedOffsets:i,escaped:rI(i)}}}default:return{}}}}};async function bz(n,e){const{placement:t,platform:r,elements:o}=n,s=await(r.isRTL==null?void 0:r.isRTL(o.floating)),i=wi(t),a=Yc(t),c=ma(t)==="y",u=["left","top"].includes(i)?-1:1,h=s&&c?-1:1,f=xi(e,n);let{mainAxis:g,crossAxis:y,alignmentAxis:v}=typeof f=="number"?{mainAxis:f,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...f};return a&&typeof v=="number"&&(y=a==="end"?v*-1:v),c?{x:y*h,y:g*u}:{x:g*u,y:y*h}}const _z=function(n){return n===void 0&&(n=0),{name:"offset",options:n,async fn(e){var t,r;const{x:o,y:s,placement:i,middlewareData:a}=e,c=await bz(e,n);return i===((t=a.offset)==null?void 0:t.placement)&&(r=a.arrow)!=null&&r.alignmentOffset?{}:{x:o+c.x,y:s+c.y,data:{...c,placement:i}}}}},Pz=function(n){return n===void 0&&(n={}),{name:"shift",options:n,async fn(e){const{x:t,y:r,placement:o}=e,{mainAxis:s=!0,crossAxis:i=!1,limiter:a={fn:w=>{let{x:b,y:_}=w;return{x:b,y:_}}},...c}=xi(n,e),u={x:t,y:r},h=await kd(e,c),f=ma(wi(o)),g=yb(f);let y=u[g],v=u[f];if(s){const w=g==="y"?"top":"left",b=g==="y"?"bottom":"right",_=y+h[w],T=y-h[b];y=Zx(_,y,T)}if(i){const w=f==="y"?"top":"left",b=f==="y"?"bottom":"right",_=v+h[w],T=v-h[b];v=Zx(_,v,T)}const S=a.fn({...e,[g]:y,[f]:v});return{...S,data:{x:S.x-t,y:S.y-r}}}}},Cz=function(n){return n===void 0&&(n={}),{options:n,fn(e){const{x:t,y:r,placement:o,rects:s,middlewareData:i}=e,{offset:a=0,mainAxis:c=!0,crossAxis:u=!0}=xi(n,e),h={x:t,y:r},f=ma(o),g=yb(f);let y=h[g],v=h[f];const S=xi(a,e),w=typeof S=="number"?{mainAxis:S,crossAxis:0}:{mainAxis:0,crossAxis:0,...S};if(c){const T=g==="y"?"height":"width",E=s.reference[g]-s.floating[T]+w.mainAxis,M=s.reference[g]+s.reference[T]-w.mainAxis;y<E?y=E:y>M&&(y=M)}if(u){var b,_;const T=g==="y"?"width":"height",E=["top","left"].includes(wi(o)),M=s.reference[f]-s.floating[T]+(E&&((b=i.offset)==null?void 0:b[f])||0)+(E?0:w.crossAxis),A=s.reference[f]+s.reference[T]+(E?0:((_=i.offset)==null?void 0:_[f])||0)-(E?w.crossAxis:0);v<M?v=M:v>A&&(v=A)}return{[g]:y,[f]:v}}}},Iz=function(n){return n===void 0&&(n={}),{name:"size",options:n,async fn(e){const{placement:t,rects:r,platform:o,elements:s}=e,{apply:i=()=>{},...a}=xi(n,e),c=await kd(e,a),u=wi(t),h=Yc(t),f=ma(t)==="y",{width:g,height:y}=r.floating;let v,S;u==="top"||u==="bottom"?(v=u,S=h===(await(o.isRTL==null?void 0:o.isRTL(s.floating))?"start":"end")?"left":"right"):(S=u,v=h==="end"?"top":"bottom");const w=y-c.top-c.bottom,b=g-c.left-c.right,_=Cs(y-c[v],w),T=Cs(g-c[S],b),E=!e.middlewareData.shift;let M=_,A=T;if(f?A=h||E?Cs(T,b):b:M=h||E?Cs(_,w):w,E&&!h){const L=Xr(c.left,0),K=Xr(c.right,0),D=Xr(c.top,0),U=Xr(c.bottom,0);f?A=g-2*(L!==0||K!==0?L+K:Xr(c.left,c.right)):M=y-2*(D!==0||U!==0?D+U:Xr(c.top,c.bottom))}await i({...e,availableWidth:A,availableHeight:M});const R=await o.getDimensions(s.floating);return g!==R.width||y!==R.height?{reset:{rects:!0}}:{}}}};function Xc(n){return NM(n)?(n.nodeName||"").toLowerCase():"#document"}function Jr(n){var e;return(n==null||(e=n.ownerDocument)==null?void 0:e.defaultView)||window}function _i(n){var e;return(e=(NM(n)?n.ownerDocument:n.document)||window.document)==null?void 0:e.documentElement}function NM(n){return n instanceof Node||n instanceof Jr(n).Node}function js(n){return n instanceof Element||n instanceof Jr(n).Element}function Rs(n){return n instanceof HTMLElement||n instanceof Jr(n).HTMLElement}function oI(n){return typeof ShadowRoot>"u"?!1:n instanceof ShadowRoot||n instanceof Jr(n).ShadowRoot}function Kd(n){const{overflow:e,overflowX:t,overflowY:r,display:o}=ts(n);return/auto|scroll|overlay|hidden|clip/.test(e+r+t)&&!["inline","contents"].includes(o)}function Ez(n){return["table","td","th"].includes(Xc(n))}function Tg(n){return[":popover-open",":modal"].some(e=>{try{return n.matches(e)}catch{return!1}})}function xb(n){const e=wb(),t=ts(n);return t.transform!=="none"||t.perspective!=="none"||(t.containerType?t.containerType!=="normal":!1)||!e&&(t.backdropFilter?t.backdropFilter!=="none":!1)||!e&&(t.filter?t.filter!=="none":!1)||["transform","perspective","filter"].some(r=>(t.willChange||"").includes(r))||["paint","layout","strict","content"].some(r=>(t.contain||"").includes(r))}function kz(n){let e=ya(n);for(;Rs(e)&&!zc(e);){if(Tg(e))return null;if(xb(e))return e;e=ya(e)}return null}function wb(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}function zc(n){return["html","body","#document"].includes(Xc(n))}function ts(n){return Jr(n).getComputedStyle(n)}function Mg(n){return js(n)?{scrollLeft:n.scrollLeft,scrollTop:n.scrollTop}:{scrollLeft:n.scrollX,scrollTop:n.scrollY}}function ya(n){if(Xc(n)==="html")return n;const e=n.assignedSlot||n.parentNode||oI(n)&&n.host||_i(n);return oI(e)?e.host:e}function $M(n){const e=ya(n);return zc(e)?n.ownerDocument?n.ownerDocument.body:n.body:Rs(e)&&Kd(e)?e:$M(e)}function Td(n,e,t){var r;e===void 0&&(e=[]),t===void 0&&(t=!0);const o=$M(n),s=o===((r=n.ownerDocument)==null?void 0:r.body),i=Jr(o);return s?e.concat(i,i.visualViewport||[],Kd(o)?o:[],i.frameElement&&t?Td(i.frameElement):[]):e.concat(o,Td(o,[],t))}function zM(n){const e=ts(n);let t=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const o=Rs(n),s=o?n.offsetWidth:t,i=o?n.offsetHeight:r,a=Uf(t)!==s||Uf(r)!==i;return a&&(t=s,r=i),{width:t,height:r,$:a}}function bb(n){return js(n)?n:n.contextElement}function Rc(n){const e=bb(n);if(!Rs(e))return ga(1);const t=e.getBoundingClientRect(),{width:r,height:o,$:s}=zM(e);let i=(s?Uf(t.width):t.width)/r,a=(s?Uf(t.height):t.height)/o;return(!i||!Number.isFinite(i))&&(i=1),(!a||!Number.isFinite(a))&&(a=1),{x:i,y:a}}const Tz=ga(0);function BM(n){const e=Jr(n);return!wb()||!e.visualViewport?Tz:{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}}function Mz(n,e,t){return e===void 0&&(e=!1),!t||e&&t!==Jr(n)?!1:e}function ul(n,e,t,r){e===void 0&&(e=!1),t===void 0&&(t=!1);const o=n.getBoundingClientRect(),s=bb(n);let i=ga(1);e&&(r?js(r)&&(i=Rc(r)):i=Rc(n));const a=Mz(s,t,r)?BM(s):ga(0);let c=(o.left+a.x)/i.x,u=(o.top+a.y)/i.y,h=o.width/i.x,f=o.height/i.y;if(s){const g=Jr(s),y=r&&js(r)?Jr(r):r;let v=g,S=v.frameElement;for(;S&&r&&y!==v;){const w=Rc(S),b=S.getBoundingClientRect(),_=ts(S),T=b.left+(S.clientLeft+parseFloat(_.paddingLeft))*w.x,E=b.top+(S.clientTop+parseFloat(_.paddingTop))*w.y;c*=w.x,u*=w.y,h*=w.x,f*=w.y,c+=T,u+=E,v=Jr(S),S=v.frameElement}}return Kf({width:h,height:f,x:c,y:u})}function Az(n){let{elements:e,rect:t,offsetParent:r,strategy:o}=n;const s=o==="fixed",i=_i(r),a=e?Tg(e.floating):!1;if(r===i||a&&s)return t;let c={scrollLeft:0,scrollTop:0},u=ga(1);const h=ga(0),f=Rs(r);if((f||!f&&!s)&&((Xc(r)!=="body"||Kd(i))&&(c=Mg(r)),Rs(r))){const g=ul(r);u=Rc(r),h.x=g.x+r.clientLeft,h.y=g.y+r.clientTop}return{width:t.width*u.x,height:t.height*u.y,x:t.x*u.x-c.scrollLeft*u.x+h.x,y:t.y*u.y-c.scrollTop*u.y+h.y}}function jz(n){return Array.from(n.getClientRects())}function UM(n){return ul(_i(n)).left+Mg(n).scrollLeft}function Rz(n){const e=_i(n),t=Mg(n),r=n.ownerDocument.body,o=Xr(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=Xr(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let i=-t.scrollLeft+UM(n);const a=-t.scrollTop;return ts(r).direction==="rtl"&&(i+=Xr(e.clientWidth,r.clientWidth)-o),{width:o,height:s,x:i,y:a}}function Oz(n,e){const t=Jr(n),r=_i(n),o=t.visualViewport;let s=r.clientWidth,i=r.clientHeight,a=0,c=0;if(o){s=o.width,i=o.height;const u=wb();(!u||u&&e==="fixed")&&(a=o.offsetLeft,c=o.offsetTop)}return{width:s,height:i,x:a,y:c}}function Dz(n,e){const t=ul(n,!0,e==="fixed"),r=t.top+n.clientTop,o=t.left+n.clientLeft,s=Rs(n)?Rc(n):ga(1),i=n.clientWidth*s.x,a=n.clientHeight*s.y,c=o*s.x,u=r*s.y;return{width:i,height:a,x:c,y:u}}function sI(n,e,t){let r;if(e==="viewport")r=Oz(n,t);else if(e==="document")r=Rz(_i(n));else if(js(e))r=Dz(e,t);else{const o=BM(n);r={...e,x:e.x-o.x,y:e.y-o.y}}return Kf(r)}function HM(n,e){const t=ya(n);return t===e||!js(t)||zc(t)?!1:ts(t).position==="fixed"||HM(t,e)}function Lz(n,e){const t=e.get(n);if(t)return t;let r=Td(n,[],!1).filter(a=>js(a)&&Xc(a)!=="body"),o=null;const s=ts(n).position==="fixed";let i=s?ya(n):n;for(;js(i)&&!zc(i);){const a=ts(i),c=xb(i);!c&&a.position==="fixed"&&(o=null),(s?!c&&!o:!c&&a.position==="static"&&!!o&&["absolute","fixed"].includes(o.position)||Kd(i)&&!c&&HM(n,i))?r=r.filter(h=>h!==i):o=a,i=ya(i)}return e.set(n,r),r}function Fz(n){let{element:e,boundary:t,rootBoundary:r,strategy:o}=n;const i=[...t==="clippingAncestors"?Tg(e)?[]:Lz(e,this._c):[].concat(t),r],a=i[0],c=i.reduce((u,h)=>{const f=sI(e,h,o);return u.top=Xr(f.top,u.top),u.right=Cs(f.right,u.right),u.bottom=Cs(f.bottom,u.bottom),u.left=Xr(f.left,u.left),u},sI(e,a,o));return{width:c.right-c.left,height:c.bottom-c.top,x:c.left,y:c.top}}function Nz(n){const{width:e,height:t}=zM(n);return{width:e,height:t}}function $z(n,e,t){const r=Rs(e),o=_i(e),s=t==="fixed",i=ul(n,!0,s,e);let a={scrollLeft:0,scrollTop:0};const c=ga(0);if(r||!r&&!s)if((Xc(e)!=="body"||Kd(o))&&(a=Mg(e)),r){const f=ul(e,!0,s,e);c.x=f.x+e.clientLeft,c.y=f.y+e.clientTop}else o&&(c.x=UM(o));const u=i.left+a.scrollLeft-c.x,h=i.top+a.scrollTop-c.y;return{x:u,y:h,width:i.width,height:i.height}}function kv(n){return ts(n).position==="static"}function iI(n,e){return!Rs(n)||ts(n).position==="fixed"?null:e?e(n):n.offsetParent}function KM(n,e){const t=Jr(n);if(Tg(n))return t;if(!Rs(n)){let o=ya(n);for(;o&&!zc(o);){if(js(o)&&!kv(o))return o;o=ya(o)}return t}let r=iI(n,e);for(;r&&Ez(r)&&kv(r);)r=iI(r,e);return r&&zc(r)&&kv(r)&&!xb(r)?t:r||kz(n)||t}const zz=async function(n){const e=this.getOffsetParent||KM,t=this.getDimensions,r=await t(n.floating);return{reference:$z(n.reference,await e(n.floating),n.strategy),floating:{x:0,y:0,width:r.width,height:r.height}}};function Bz(n){return ts(n).direction==="rtl"}const Uz={convertOffsetParentRelativeRectToViewportRelativeRect:Az,getDocumentElement:_i,getClippingRect:Fz,getOffsetParent:KM,getElementRects:zz,getClientRects:jz,getDimensions:Nz,getScale:Rc,isElement:js,isRTL:Bz};function Hz(n,e){let t=null,r;const o=_i(n);function s(){var a;clearTimeout(r),(a=t)==null||a.disconnect(),t=null}function i(a,c){a===void 0&&(a=!1),c===void 0&&(c=1),s();const{left:u,top:h,width:f,height:g}=n.getBoundingClientRect();if(a||e(),!f||!g)return;const y=_p(h),v=_p(o.clientWidth-(u+f)),S=_p(o.clientHeight-(h+g)),w=_p(u),_={rootMargin:-y+"px "+-v+"px "+-S+"px "+-w+"px",threshold:Xr(0,Cs(1,c))||1};let T=!0;function E(M){const A=M[0].intersectionRatio;if(A!==c){if(!T)return i();A?i(!1,A):r=setTimeout(()=>{i(!1,1e-7)},1e3)}T=!1}try{t=new IntersectionObserver(E,{..._,root:o.ownerDocument})}catch{t=new IntersectionObserver(E,_)}t.observe(n)}return i(!0),s}function Kz(n,e,t,r){r===void 0&&(r={});const{ancestorScroll:o=!0,ancestorResize:s=!0,elementResize:i=typeof ResizeObserver=="function",layoutShift:a=typeof IntersectionObserver=="function",animationFrame:c=!1}=r,u=bb(n),h=o||s?[...u?Td(u):[],...Td(e)]:[];h.forEach(b=>{o&&b.addEventListener("scroll",t,{passive:!0}),s&&b.addEventListener("resize",t)});const f=u&&a?Hz(u,t):null;let g=-1,y=null;i&&(y=new ResizeObserver(b=>{let[_]=b;_&&_.target===u&&y&&(y.unobserve(e),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{var T;(T=y)==null||T.observe(e)})),t()}),u&&!c&&y.observe(u),y.observe(e));let v,S=c?ul(n):null;c&&w();function w(){const b=ul(n);S&&(b.x!==S.x||b.y!==S.y||b.width!==S.width||b.height!==S.height)&&t(),S=b,v=requestAnimationFrame(w)}return t(),()=>{var b;h.forEach(_=>{o&&_.removeEventListener("scroll",t),s&&_.removeEventListener("resize",t)}),f==null||f(),(b=y)==null||b.disconnect(),y=null,c&&cancelAnimationFrame(v)}}const Wz=_z,Vz=Pz,Gz=xz,qz=Iz,Yz=wz,aI=Sz,Xz=Cz,Zz=(n,e,t)=>{const r=new Map,o={platform:Uz,...t},s={...o.platform,_c:r};return vz(n,e,{...o,platform:s})};function Oe(n,e={}){const t=typeof n=="string"?n:n.src;if(typeof e=="function")return e(t);const{baseUrl:r=""}=e;return t.startsWith("data:")||t.match(/^https?:\/\//)?t:`${r.replace(/\/$/,"")}/${t.replace(/^\.?\//,"")}`}function Qz(n){const e=Oe("./icons/icon/0_merged.svg",n);return{fonts:{monospace:Oe("./fonts/IBMPlexMono-Medium.woff2",n),sansSerif:Oe("./fonts/IBMPlexSans-Medium.woff2",n),serif:Oe("./fonts/IBMPlexSerif-Medium.woff2",n),draw:Oe("./fonts/Shantell_Sans-Tldrawish.woff2",n)},icons:{"align-bottom":e+"#align-bottom","align-center-horizontal":e+"#align-center-horizontal","align-center-vertical":e+"#align-center-vertical","align-left":e+"#align-left","align-right":e+"#align-right","align-top":e+"#align-top","arrow-left":e+"#arrow-left","arrowhead-arrow":e+"#arrowhead-arrow","arrowhead-bar":e+"#arrowhead-bar","arrowhead-diamond":e+"#arrowhead-diamond","arrowhead-dot":e+"#arrowhead-dot","arrowhead-none":e+"#arrowhead-none","arrowhead-square":e+"#arrowhead-square","arrowhead-triangle-inverted":e+"#arrowhead-triangle-inverted","arrowhead-triangle":e+"#arrowhead-triangle",blob:e+"#blob","bring-forward":e+"#bring-forward","bring-to-front":e+"#bring-to-front",broken:e+"#broken","check-circle":e+"#check-circle",check:e+"#check","chevron-down":e+"#chevron-down","chevron-left":e+"#chevron-left","chevron-right":e+"#chevron-right","chevron-up":e+"#chevron-up","chevrons-ne":e+"#chevrons-ne","chevrons-sw":e+"#chevrons-sw","clipboard-copied":e+"#clipboard-copied","clipboard-copy":e+"#clipboard-copy",color:e+"#color","cross-2":e+"#cross-2","cross-circle":e+"#cross-circle","dash-dashed":e+"#dash-dashed","dash-dotted":e+"#dash-dotted","dash-draw":e+"#dash-draw","dash-solid":e+"#dash-solid",disconnected:e+"#disconnected",discord:e+"#discord","distribute-horizontal":e+"#distribute-horizontal","distribute-vertical":e+"#distribute-vertical",dot:e+"#dot","dots-horizontal":e+"#dots-horizontal","dots-vertical":e+"#dots-vertical","drag-handle-dots":e+"#drag-handle-dots",duplicate:e+"#duplicate",edit:e+"#edit","external-link":e+"#external-link","fill-fill":e+"#fill-fill","fill-none":e+"#fill-none","fill-pattern":e+"#fill-pattern","fill-semi":e+"#fill-semi","fill-solid":e+"#fill-solid",follow:e+"#follow",following:e+"#following","font-draw":e+"#font-draw","font-mono":e+"#font-mono","font-sans":e+"#font-sans","font-serif":e+"#font-serif","geo-arrow-down":e+"#geo-arrow-down","geo-arrow-left":e+"#geo-arrow-left","geo-arrow-right":e+"#geo-arrow-right","geo-arrow-up":e+"#geo-arrow-up","geo-check-box":e+"#geo-check-box","geo-cloud":e+"#geo-cloud","geo-diamond":e+"#geo-diamond","geo-ellipse":e+"#geo-ellipse","geo-heart":e+"#geo-heart","geo-hexagon":e+"#geo-hexagon","geo-octagon":e+"#geo-octagon","geo-oval":e+"#geo-oval","geo-pentagon":e+"#geo-pentagon","geo-rectangle":e+"#geo-rectangle","geo-rhombus-2":e+"#geo-rhombus-2","geo-rhombus":e+"#geo-rhombus","geo-star":e+"#geo-star","geo-trapezoid":e+"#geo-trapezoid","geo-triangle":e+"#geo-triangle","geo-x-box":e+"#geo-x-box",github:e+"#github",group:e+"#group","horizontal-align-end":e+"#horizontal-align-end","horizontal-align-middle":e+"#horizontal-align-middle","horizontal-align-start":e+"#horizontal-align-start","info-circle":e+"#info-circle",leading:e+"#leading",link:e+"#link",lock:e+"#lock",menu:e+"#menu",minus:e+"#minus",mixed:e+"#mixed",pack:e+"#pack",plus:e+"#plus","question-mark-circle":e+"#question-mark-circle","question-mark":e+"#question-mark",redo:e+"#redo","reset-zoom":e+"#reset-zoom","rotate-ccw":e+"#rotate-ccw","rotate-cw":e+"#rotate-cw","send-backward":e+"#send-backward","send-to-back":e+"#send-to-back","share-1":e+"#share-1","size-extra-large":e+"#size-extra-large","size-large":e+"#size-large","size-medium":e+"#size-medium","size-small":e+"#size-small","spline-cubic":e+"#spline-cubic","spline-line":e+"#spline-line","stack-horizontal":e+"#stack-horizontal","stack-vertical":e+"#stack-vertical","status-offline":e+"#status-offline","stretch-horizontal":e+"#stretch-horizontal","stretch-vertical":e+"#stretch-vertical","text-align-center":e+"#text-align-center","text-align-left":e+"#text-align-left","text-align-right":e+"#text-align-right","toggle-off":e+"#toggle-off","toggle-on":e+"#toggle-on","tool-arrow":e+"#tool-arrow","tool-eraser":e+"#tool-eraser","tool-frame":e+"#tool-frame","tool-hand":e+"#tool-hand","tool-highlight":e+"#tool-highlight","tool-laser":e+"#tool-laser","tool-line":e+"#tool-line","tool-media":e+"#tool-media","tool-note":e+"#tool-note","tool-pencil":e+"#tool-pencil","tool-pointer":e+"#tool-pointer","tool-screenshot":e+"#tool-screenshot","tool-text":e+"#tool-text",trash:e+"#trash",twitter:e+"#twitter",undo:e+"#undo",ungroup:e+"#ungroup",unlock:e+"#unlock","vertical-align-end":e+"#vertical-align-end","vertical-align-middle":e+"#vertical-align-middle","vertical-align-start":e+"#vertical-align-start","warning-triangle":e+"#warning-triangle","zoom-in":e+"#zoom-in","zoom-out":e+"#zoom-out"},translations:{ar:Oe("./translations/ar.json",n),ca:Oe("./translations/ca.json",n),cs:Oe("./translations/cs.json",n),da:Oe("./translations/da.json",n),de:Oe("./translations/de.json",n),en:Oe("./translations/en.json",n),es:Oe("./translations/es.json",n),fa:Oe("./translations/fa.json",n),fi:Oe("./translations/fi.json",n),fr:Oe("./translations/fr.json",n),gl:Oe("./translations/gl.json",n),he:Oe("./translations/he.json",n),"hi-in":Oe("./translations/hi-in.json",n),hr:Oe("./translations/hr.json",n),hu:Oe("./translations/hu.json",n),id:Oe("./translations/id.json",n),it:Oe("./translations/it.json",n),ja:Oe("./translations/ja.json",n),"ko-kr":Oe("./translations/ko-kr.json",n),ku:Oe("./translations/ku.json",n),languages:Oe("./translations/languages.json",n),main:Oe("./translations/main.json",n),my:Oe("./translations/my.json",n),ne:Oe("./translations/ne.json",n),no:Oe("./translations/no.json",n),pl:Oe("./translations/pl.json",n),"pt-br":Oe("./translations/pt-br.json",n),"pt-pt":Oe("./translations/pt-pt.json",n),ro:Oe("./translations/ro.json",n),ru:Oe("./translations/ru.json",n),sl:Oe("./translations/sl.json",n),so:Oe("./translations/so.json",n),sv:Oe("./translations/sv.json",n),te:Oe("./translations/te.json",n),th:Oe("./translations/th.json",n),tr:Oe("./translations/tr.json",n),uk:Oe("./translations/uk.json",n),vi:Oe("./translations/vi.json",n),"zh-cn":Oe("./translations/zh-cn.json",n),"zh-tw":Oe("./translations/zh-tw.json",n)},embedIcons:{codepen:Oe("./embed-icons/codepen.png",n),codesandbox:Oe("./embed-icons/codesandbox.png",n),desmos:Oe("./embed-icons/desmos.png",n),excalidraw:Oe("./embed-icons/excalidraw.png",n),felt:Oe("./embed-icons/felt.png",n),figma:Oe("./embed-icons/figma.png",n),github_gist:Oe("./embed-icons/github_gist.png",n),google_calendar:Oe("./embed-icons/google_calendar.png",n),google_maps:Oe("./embed-icons/google_maps.png",n),google_slides:Oe("./embed-icons/google_slides.png",n),observable:Oe("./embed-icons/observable.png",n),replit:Oe("./embed-icons/replit.png",n),scratch:Oe("./embed-icons/scratch.png",n),spotify:Oe("./embed-icons/spotify.png",n),tldraw:Oe("./embed-icons/tldraw.png",n),val_town:Oe("./embed-icons/val_town.png",n),vimeo:Oe("./embed-icons/vimeo.png",n),youtube:Oe("./embed-icons/youtube.png",n)}}}const Tv="__TLDRAW_LIBRARY_VERSIONS__";function Jz(){if(globalThis[Tv])return globalThis[Tv];const n={versions:[],didWarn:!1,scheduledNotice:null};return Object.defineProperty(globalThis,Tv,{value:n,writable:!1,configurable:!1,enumerable:!1}),n}function ba(n,e,t){if(!n||!e||!t)throw new Error("Missing name/version/module system in built version of tldraw library");const r=Jz();if(r.versions.push({name:n,version:e,modules:t}),!r.scheduledNotice)try{r.scheduledNotice=setTimeout(()=>{r.scheduledNotice=null,lI(r)},100)}catch{lI(r)}}function lI(n){if(!n.versions.length||n.didWarn)return;const e=n.versions.sort((a,c)=>cI(a.version,c.version)),t=e[e.length-1].version,r=new Set,o=new Map;for(const a of e){if(o.has(a.name)){r.delete(a.name),Mv(o,a.name,new Set).add(a.version);continue}a.version===t?r.add(a.name):(r.delete(a.name),Mv(o,a.name,new Set).add(a.version))}if(o.size>0){const a=[`${oi("[tldraw]",["bold","bgRed","textWhite"])} ${oi("You have multiple versions of tldraw libraries installed. This can lead to bugs and unexpected behavior.",["textRed","bold"])}`,"",`The latest version you have installed is ${oi(`v${t}`,["bold","textBlue"])}. The following libraries are on the latest version:`,...Array.from(r,c=>`  • ✅ ${oi(c,["bold"])}`),"","The following libraries are not on the latest version, or have multiple versions installed:",...Array.from(o,([c,u])=>{const h=Array.from(u).sort(cI).map(f=>oi(`v${f}`,f===t?["textGreen"]:["textRed"]));return`  • ❌ ${oi(c,["bold"])} (${h.join(", ")})`})];console.log(a.join(`
`)),n.didWarn=!0;return}const s=new Map;for(const a of e)Mv(s,a.name,{version:a.version,modules:[]}).modules.push(a.modules);const i=new Map;for(const[a,c]of s)c.modules.length>1&&i.set(a,c);if(i.size>0){const a=[`${oi("[tldraw]",["bold","bgRed","textWhite"])} ${oi("You have multiple instances of some tldraw libraries active. This can lead to bugs and unexpected behavior. ",["textRed","bold"])}`,"","This usually means that your bundler is misconfigured, and is importing the same library multiple times - usually once as an ES Module, and once as a CommonJS module.","","The following libraries have been imported multiple times:",...Array.from(i,([c,u])=>{const h=u.modules.map((f,g)=>f==="esm"?`      ${g+1}. ES Modules`:`      ${g+1}. CommonJS`).join(`
`);return`  • ❌ ${oi(c,["bold"])} v${u.version}: 
${h}`}),"","You should configure your bundler to only import one version of each library."];console.log(a.join(`
`)),n.didWarn=!0;return}}function cI(n,e){const t=n.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/),r=e.match(/^(\d+)\.(\d+)\.(\d+)(?:-(\w+))?$/);return!t||!r?n.localeCompare(e):t[1]!==r[1]?Number(t[1])-Number(r[1]):t[2]!==r[2]?Number(t[2])-Number(r[2]):t[3]!==r[3]?Number(t[3])-Number(r[3]):t[4]&&r[4]?t[4].localeCompare(r[4]):t[4]?1:r[4]?-1:0}const e8={bold:"1",textBlue:"94",textRed:"31",textGreen:"32",bgRed:"41",textWhite:"97"};function oi(n,e=[]){return`\x1B[${e.map(t=>e8[t]).join(";")}m${n}\x1B[m`}function Mv(n,e,t){return n.has(e)?n.get(e):(n.set(e,t),t)}var Av,uI;function t8(){if(uI)return Av;uI=1;var n="Expected a function",e=NaN,t="[object Symbol]",r=/^\s+|\s+$/g,o=/^[-+]0x[0-9a-f]+$/i,s=/^0b[01]+$/i,i=/^0o[0-7]+$/i,a=parseInt,c=typeof Rr=="object"&&Rr&&Rr.Object===Object&&Rr,u=typeof self=="object"&&self&&self.Object===Object&&self,h=c||u||Function("return this")(),f=Object.prototype,g=f.toString,y=Math.max,v=Math.min,S=function(){return h.Date.now()};function w(A,R,L){var K,D,U,V,F,$,H=0,Z=!1,G=!1,q=!0;if(typeof A!="function")throw new TypeError(n);R=M(R)||0,_(L)&&(Z=!!L.leading,G="maxWait"in L,U=G?y(M(L.maxWait)||0,R):U,q="trailing"in L?!!L.trailing:q);function Q(we){var Ie=K,Ve=D;return K=D=void 0,H=we,V=A.apply(Ve,Ie),V}function ae(we){return H=we,F=setTimeout(pe,R),Z?Q(we):V}function B(we){var Ie=we-$,Ve=we-H,Xe=R-Ie;return G?v(Xe,U-Ve):Xe}function oe(we){var Ie=we-$,Ve=we-H;return $===void 0||Ie>=R||Ie<0||G&&Ve>=U}function pe(){var we=S();if(oe(we))return _e(we);F=setTimeout(pe,B(we))}function _e(we){return F=void 0,q&&K?Q(we):(K=D=void 0,V)}function ue(){F!==void 0&&clearTimeout(F),H=0,K=$=D=F=void 0}function Ne(){return F===void 0?V:_e(S())}function Te(){var we=S(),Ie=oe(we);if(K=arguments,D=this,$=we,Ie){if(F===void 0)return ae($);if(G)return F=setTimeout(pe,R),Q($)}return F===void 0&&(F=setTimeout(pe,R)),V}return Te.cancel=ue,Te.flush=Ne,Te}function b(A,R,L){var K=!0,D=!0;if(typeof A!="function")throw new TypeError(n);return _(L)&&(K="leading"in L?!!L.leading:K,D="trailing"in L?!!L.trailing:D),w(A,R,{leading:K,maxWait:R,trailing:D})}function _(A){var R=typeof A;return!!A&&(R=="object"||R=="function")}function T(A){return!!A&&typeof A=="object"}function E(A){return typeof A=="symbol"||T(A)&&g.call(A)==t}function M(A){if(typeof A=="number")return A;if(E(A))return e;if(_(A)){var R=typeof A.valueOf=="function"?A.valueOf():A;A=_(R)?R+"":R}if(typeof A!="string")return A===0?A:+A;A=A.replace(r,"");var L=s.test(A);return L||i.test(A)?a(A.slice(2),L?2:8):o.test(A)?e:+A}return Av=b,Av}var n8=t8();const WM=wa(n8);var jv,dI;function r8(){if(dI)return jv;dI=1;var n=200,e="__lodash_hash_undefined__",t=1/0,r="[object Function]",o="[object GeneratorFunction]",s=/[\\^$.*+?()[\]{}|]/g,i=/^\[object .+?Constructor\]$/,a=typeof Rr=="object"&&Rr&&Rr.Object===Object&&Rr,c=typeof self=="object"&&self&&self.Object===Object&&self,u=a||c||Function("return this")();function h(ie,Se){var Ke=ie?ie.length:0;return!!Ke&&g(ie,Se,0)>-1}function f(ie,Se,Ke,_t){for(var ho=ie.length,gr=Ke+-1;++gr<ho;)if(Se(ie[gr],gr,ie))return gr;return-1}function g(ie,Se,Ke){if(Se!==Se)return f(ie,y,Ke);for(var _t=Ke-1,ho=ie.length;++_t<ho;)if(ie[_t]===Se)return _t;return-1}function y(ie){return ie!==ie}function v(ie,Se){return ie.has(Se)}function S(ie,Se){return ie==null?void 0:ie[Se]}function w(ie){var Se=!1;if(ie!=null&&typeof ie.toString!="function")try{Se=!!(ie+"")}catch{}return Se}function b(ie){var Se=-1,Ke=Array(ie.size);return ie.forEach(function(_t){Ke[++Se]=_t}),Ke}var _=Array.prototype,T=Function.prototype,E=Object.prototype,M=u["__core-js_shared__"],A=function(){var ie=/[^.]+$/.exec(M&&M.keys&&M.keys.IE_PROTO||"");return ie?"Symbol(src)_1."+ie:""}(),R=T.toString,L=E.hasOwnProperty,K=E.toString,D=RegExp("^"+R.call(L).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),U=_.splice,V=uo(u,"Map"),F=uo(u,"Set"),$=uo(Object,"create");function H(ie){var Se=-1,Ke=ie?ie.length:0;for(this.clear();++Se<Ke;){var _t=ie[Se];this.set(_t[0],_t[1])}}function Z(){this.__data__=$?$(null):{}}function G(ie){return this.has(ie)&&delete this.__data__[ie]}function q(ie){var Se=this.__data__;if($){var Ke=Se[ie];return Ke===e?void 0:Ke}return L.call(Se,ie)?Se[ie]:void 0}function Q(ie){var Se=this.__data__;return $?Se[ie]!==void 0:L.call(Se,ie)}function ae(ie,Se){var Ke=this.__data__;return Ke[ie]=$&&Se===void 0?e:Se,this}H.prototype.clear=Z,H.prototype.delete=G,H.prototype.get=q,H.prototype.has=Q,H.prototype.set=ae;function B(ie){var Se=-1,Ke=ie?ie.length:0;for(this.clear();++Se<Ke;){var _t=ie[Se];this.set(_t[0],_t[1])}}function oe(){this.__data__=[]}function pe(ie){var Se=this.__data__,Ke=It(Se,ie);if(Ke<0)return!1;var _t=Se.length-1;return Ke==_t?Se.pop():U.call(Se,Ke,1),!0}function _e(ie){var Se=this.__data__,Ke=It(Se,ie);return Ke<0?void 0:Se[Ke][1]}function ue(ie){return It(this.__data__,ie)>-1}function Ne(ie,Se){var Ke=this.__data__,_t=It(Ke,ie);return _t<0?Ke.push([ie,Se]):Ke[_t][1]=Se,this}B.prototype.clear=oe,B.prototype.delete=pe,B.prototype.get=_e,B.prototype.has=ue,B.prototype.set=Ne;function Te(ie){var Se=-1,Ke=ie?ie.length:0;for(this.clear();++Se<Ke;){var _t=ie[Se];this.set(_t[0],_t[1])}}function we(){this.__data__={hash:new H,map:new(V||B),string:new H}}function Ie(ie){return co(this,ie).delete(ie)}function Ve(ie){return co(this,ie).get(ie)}function Xe(ie){return co(this,ie).has(ie)}function Zt(ie,Se){return co(this,ie).set(ie,Se),this}Te.prototype.clear=we,Te.prototype.delete=Ie,Te.prototype.get=Ve,Te.prototype.has=Xe,Te.prototype.set=Zt;function vt(ie){var Se=-1,Ke=ie?ie.length:0;for(this.__data__=new Te;++Se<Ke;)this.add(ie[Se])}function Ut(ie){return this.__data__.set(ie,e),this}function St(ie){return this.__data__.has(ie)}vt.prototype.add=vt.prototype.push=Ut,vt.prototype.has=St;function It(ie,Se){for(var Ke=ie.length;Ke--;)if(jl(ie[Ke][0],Se))return Ke;return-1}function tr(ie){if(!Oo(ie)||Tl(ie))return!1;var Se=cs(ie)||w(ie)?D:i;return Se.test(Ml(ie))}function ls(ie,Se,Ke){var _t=-1,ho=h,gr=ie.length,Vs=!0,Br=[],Ur=Br;if(gr>=n){var mr=fr(ie);if(mr)return b(mr);Vs=!1,ho=v,Ur=new vt}else Ur=Br;e:for(;++_t<gr;){var Hr=ie[_t],yr=Hr;if(Hr=Hr!==0?Hr:0,Vs&&yr===yr){for(var Do=Ur.length;Do--;)if(Ur[Do]===yr)continue e;Br.push(Hr)}else ho(Ur,yr,Ke)||(Ur!==Br&&Ur.push(yr),Br.push(Hr))}return Br}var fr=F&&1/b(new F([,-0]))[1]==t?function(ie){return new F(ie)}:Oa;function co(ie,Se){var Ke=ie.__data__;return Ra(Se)?Ke[typeof Se=="string"?"string":"hash"]:Ke.map}function uo(ie,Se){var Ke=S(ie,Se);return tr(Ke)?Ke:void 0}function Ra(ie){var Se=typeof ie;return Se=="string"||Se=="number"||Se=="symbol"||Se=="boolean"?ie!=="__proto__":ie===null}function Tl(ie){return!!A&&A in ie}function Ml(ie){if(ie!=null){try{return R.call(ie)}catch{}try{return ie+""}catch{}}return""}function Al(ie){return ie&&ie.length?ls(ie):[]}function jl(ie,Se){return ie===Se||ie!==ie&&Se!==Se}function cs(ie){var Se=Oo(ie)?K.call(ie):"";return Se==r||Se==o}function Oo(ie){var Se=typeof ie;return!!ie&&(Se=="object"||Se=="function")}function Oa(){}return jv=Al,jv}var o8=r8();const s8=wa(o8),ld={Good:"#40C057",Mid:"#FFC078",Poor:"#E03131"},i8=ld.Good;class VM{constructor(){j(this,"startTime",0);j(this,"name","");j(this,"frames",0);j(this,"started",!1);j(this,"frame",null);j(this,"recordFrame",()=>{this.frames++,this.started&&(this.frame=requestAnimationFrame(this.recordFrame))})}start(e){this.name=e,this.frames=0,this.started=!0,this.frame!==null&&cancelAnimationFrame(this.frame),this.frame=requestAnimationFrame(this.recordFrame),this.startTime=performance.now()}stop(){this.started=!1,this.frame!==null&&cancelAnimationFrame(this.frame);const e=(performance.now()-this.startTime)/1e3,t=e===0?0:Math.floor(this.frames/e),r=t>55?ld.Good:t>30?ld.Mid:ld.Poor,o=r===ld.Mid?"black":"white",s=this.name[0].toUpperCase()+this.name.slice(1);console.debug(`%cPerf%c ${s} %c${t}%c fps`,`color: white; background: ${i8};padding: 2px;border-radius: 3px;`,"font-weight: normal",`font-weight: bold; padding: 2px; background: ${r};color: ${o};`,"font-weight: normal")}isStarted(){return this.started}}function _b(n,e){const t=[];e:for(const r of n){for(const o of t)if(e?e(r,o):r===o)continue e;t.push(r)}return t}function Ze(n){return n.filter(e=>e!=null)}function En(n){return n[n.length-1]}function a8(n,e){let t,r=1/0;for(const o of n){const s=e(o);s<r&&(t=o,r=s)}return t}function l8(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(let t=0;t<n.length;t++)if(!Object.is(n[t],e[t]))return!1;return!0}function GM(n){const e=(...t)=>{try{return n(...t)}catch(r){throw r instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(r,e),r}};return e}const Md=()=>{},da={ok(n){return{ok:!0,value:n}},err(n){return{ok:!1,error:n}}};function Sn(n,e){const t=e&&n&&typeof n=="object"&&e in n?n[e]:n;throw new Error(`Unknown switch case ${t}`)}const yt=GM((n,e)=>{if(!n)throw new Error(e||"Assertion Error")}),Mr=GM((n,e)=>{if(n==null)throw new Error(e??"value must be defined");return n});function Pb(){let n,e;const t=new Promise((r,o)=>{n=r,e=o});return Object.assign(t,{resolve:n,reject:e})}function Jx(n){return new Promise(e=>setTimeout(e,n))}function Or(...n){if(n.length===2){const[e,t]=n;t.addInitializer(function(){yt(Reflect.isExtensible(this),"Cannot bind to a non-extensible class.");const o=e.bind(this),s=Reflect.defineProperty(this,t.name,{value:o,writable:!0,configurable:!0});yt(s,"Cannot bind a non-configurable class method.")})}else{const[e,t,r]=n;if(!r||typeof r.value!="function")throw new TypeError(`Only methods can be decorated with @bind. <${t}> is not a method!`);return{configurable:!0,get(){const o=r.value.bind(this);return Object.defineProperty(this,t,{value:o,configurable:!0,writable:!0}),o}}}}class Os{constructor(){j(this,"items",new WeakMap)}get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}}function Ag(n,e){let t;const r=(...o)=>(t||(t={},t.promise=new Promise((s,i)=>{t.resolve=s,t.reject=i})),clearTimeout(t.timeout),t.latestArgs=o,t.timeout=setTimeout(()=>{const s=t;t=void 0;try{s.resolve(n(...s.latestArgs))}catch(i){s.reject(i)}},e),t.promise);return r.cancel=()=>{t&&clearTimeout(t.timeout)},r}const hI=new WeakMap;function Cb(n,e){if(typeof n!="object"||n===null)return;let t=hI.get(n);t||(t={tags:{},extras:{}},hI.set(n,t)),e.tags&&(t.tags={...t.tags,...e.tags}),e.extras&&(t.extras={...t.extras,...e.extras})}async function Ds(n,e){return window.fetch(n,{referrerPolicy:"strict-origin-when-cross-origin",...e})}const Ad=(n,e)=>{const t=new window.Image(n,e);return t.referrerPolicy="strict-origin-when-cross-origin",t};class Yo{static async dataUrlToArrayBuffer(e){return Ds(e).then(function(t){return t.arrayBuffer()})}static async blobToDataUrl(e){return await new Promise((t,r)=>{if(e){const o=new FileReader;o.onload=()=>t(o.result),o.onerror=s=>r(s),o.onabort=s=>r(s),o.readAsDataURL(e)}})}static async blobToText(e){return await new Promise((t,r)=>{if(e){const o=new FileReader;o.onload=()=>t(o.result),o.onerror=s=>r(s),o.onabort=s=>r(s),o.readAsText(e)}})}static rewriteMimeType(e,t){return e.type===t?e:e instanceof File?new File([e],e.name,{type:t}):new Blob([e],{type:t})}}function ew(n){let e=0;for(let t=0;t<n.length;t++)e=(e<<5)-e+n.charCodeAt(t),e|=0;return e+""}function pI(n){const e=new DataView(n);let t=0;for(let r=0;r<e.byteLength;r++)t=(t<<5)-t+e.getUint8(r),t|=0;return t+""}/*!
 * MIT License: https://github.com/ai/nanoid/blob/main/LICENSE
 * Modified code originally from <https://github.com/ai/nanoid>
 * Copyright 2017 Andrey Sitnik <andrey@sitnik.ru>
 *
 * `nanoid` is currently only distributed as an ES module. Some tools (jest, playwright) don't
 * properly support ESM-only code yet, and tldraw itself is distributed as both an ES module and a
 * CommonJS module. By including nanoid here, we can make sure it works well in every environment
 * where tldraw is used. We can also remove some unused features like custom alphabets.
 */const fI=globalThis.crypto,c8="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",u8=128;let nl,Pc;function d8(n){!nl||nl.length<n?(nl=new Uint8Array(n*u8),fI.getRandomValues(nl),Pc=0):Pc+n>nl.length&&(fI.getRandomValues(nl),Pc=0),Pc+=n}function h8(n=21){d8(n-=0);let e="";for(let t=Pc-n;t<Pc;t++)e+=c8[nl[t]&63];return e}let p8=h8;function bt(n){return p8(n)}/*!
 * MIT License: https://github.com/vHeemstra/is-apng/blob/main/license
 * Copyright (c) Philip van Heemstra
 */function f8(n){const e=new Uint8Array(n);if(!e||!(typeof Buffer<"u"&&Buffer.isBuffer(e)||e instanceof Uint8Array)||e.length<16||!(e[0]===137&&e[1]===80&&e[2]===78&&e[3]===71&&e[4]===13&&e[5]===10&&e[6]===26&&e[7]===10))return!1;function r(s,i,a,c,u=1024){if(!i)return-1;i=new RegExp(i,"g");const h=i.source.length,f=new TextDecoder,g=s.length;if(typeof c>"u"&&(c=g),a>=g||c<=0||a>=c)return-1;s=s.subarray(a,c);let y=-1,v=0,S=0,w="";e:for(;v<s.length;){const b=v+u,_=s.subarray(v,b),T=f.decode(_,{stream:!0}),E=w+T;let M,A=-1;for(;(M=i.exec(E))!==null;){A=M.index-w.length,y=S+A;break e}v=b,S+=T.length;const R=A>-1?A+h:T.length-h;w=T.slice(R)}return y>=0&&(y+=a>=0?a:g+a),y}const o=r(e,"IDAT",12);return o>=12?r(e,"acTL",8,o)>=8:!1}const g8=n=>new Uint8Array(n)[3]===44;/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Józef Sokołowski <j.k.sokolowski@gmail.com>
 */function gI(n,e){let t=0;for(;n[e+t];)t+=n[e+t]+1;return t+1}function m8(n){return new TextDecoder("ascii").decode(n.slice(0,3))==="GIF"}function y8(n){const e=new Uint8Array(n);let t,r,o=0,s=0;if(!m8(n))return!1;for(t=e[10]&128,r=e[10]&7,o+=6,o+=7,o+=t?3*Math.pow(2,r+1):0;s<2&&o<e.length;)switch(e[o]){case 44:s+=1,t=e[o+9]&128,r=e[o+9]&7,o+=10,o+=t?3*Math.pow(2,r+1):0,o+=gI(e,o+1)+1;break;case 33:o+=2,o+=gI(e,o);break;case 59:o=e.length;break;default:o=e.length;break}return s>1}/*!
 * MIT License: https://github.com/alexgorbatchev/crc/blob/master/LICENSE
 * Copyright: 2014 Alex Gorbatchev
 * Code: crc32, https://github.com/alexgorbatchev/crc/blob/master/src/calculators/crc32.ts
 */let tw=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];typeof Int32Array<"u"&&(tw=new Int32Array(tw));const v8=(n,e)=>{let t=~~e^-1;for(let r=0;r<n.length;r++)t=tw[(t^n[r])&255]^t>>>8;return t^-1},mI=4,yI=4;class Ps{static isPng(e,t){return e.getUint8(t+0)===137&&e.getUint8(t+1)===80&&e.getUint8(t+2)===78&&e.getUint8(t+3)===71&&e.getUint8(t+4)===13&&e.getUint8(t+5)===10&&e.getUint8(t+6)===26&&e.getUint8(t+7)===10}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){const r={};if(!Ps.isPng(e,t))throw new Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){const o=t,s=e.getInt32(t);t+=4;const i=Ps.getChunkType(e,t);if(i==="IDAT"&&r[i]){t+=s+mI+yI;continue}if(i==="IEND")break;r[i]={start:o,dataOffset:t+4,size:s},t+=s+mI+yI}return r}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){return Ps.readChunks(e)[t]}static setPhysChunk(e,t=1,r){let o=46,s=0;const i=Ps.findChunk(e,"pHYs");i&&(o=i.start,s=i.size);const a=Ps.findChunk(e,"IDAT");a&&(o=a.start,s=0);const c=new ArrayBuffer(21),u=new DataView(c);u.setUint32(0,9),u.setUint8(4,112),u.setUint8(5,72),u.setUint8(6,89),u.setUint8(7,115);const h=2835.5;u.setInt32(8,h*t),u.setInt32(12,h*t),u.setInt8(16,1);const f=new Uint8Array(c.slice(4,17));u.setInt32(17,v8(f));const g=e.buffer.slice(0,o),y=e.buffer.slice(o+s);return new Blob([g,c,y],r)}}/*!
 * MIT License: https://github.com/sindresorhus/is-webp/blob/main/license
 * Copyright (c) Sindre Sorhus <sindresorhus@gmail.com> (https://sindresorhus.com)
 */function S8(n){return!n||n.length<12?!1:n[8]===87&&n[9]===69&&n[10]===66&&n[11]===80}function x8(n){const e=new Uint8Array(n);return!S8(e)||!e||e.length<21?!1:(e[20]>>1&1)===1}const qM=Object.freeze(["image/svg+xml"]),YM=Object.freeze(["image/jpeg","image/png","image/webp"]),XM=Object.freeze(["image/gif","image/apng","image/avif"]),jg=Object.freeze([...YM,...qM,...XM]),Ib=Object.freeze(["video/mp4","video/webm","video/quicktime"]),w8=[...jg,...Ib].join(",");class Zr{static loadVideo(e){return new Promise((t,r)=>{const o=document.createElement("video");o.onloadeddata=()=>t(o),o.onerror=s=>{console.error(s),r(new Error("Could not load video"))},o.crossOrigin="anonymous",o.src=e})}static async getVideoFrameAsDataUrl(e,t=0){const r=Pb();let o=!1;const s=()=>{if(!o)if(e.readyState>=e.HAVE_METADATA)o=!0,e.currentTime=t;else return;if(e.readyState>=e.HAVE_CURRENT_DATA){const a=document.createElement("canvas");a.width=e.videoWidth,a.height=e.videoHeight;const c=a.getContext("2d");if(!c)throw new Error("Could not get 2d context");c.drawImage(e,0,0),r.resolve(a.toDataURL())}},i=a=>{console.error(a),r.reject(new Error("Could not get video frame"))};e.addEventListener("loadedmetadata",s),e.addEventListener("loadeddata",s),e.addEventListener("canplay",s),e.addEventListener("seeked",s),e.addEventListener("error",i),e.addEventListener("stalled",i),s();try{return await r}finally{e.removeEventListener("loadedmetadata",s),e.removeEventListener("loadeddata",s),e.removeEventListener("canplay",s),e.removeEventListener("seeked",s),e.removeEventListener("error",i),e.removeEventListener("stalled",i)}}static loadImage(e){return new Promise((t,r)=>{const o=Ad();o.onload=()=>t(o),o.onerror=s=>{console.error(s),r(new Error("Could not load image"))},o.crossOrigin="anonymous",o.referrerPolicy="strict-origin-when-cross-origin",o.src=e})}static async getVideoSize(e){return Zr.usingObjectURL(e,async t=>{const r=await Zr.loadVideo(t);return{w:r.videoWidth,h:r.videoHeight}})}static async getImageSize(e){const t=await Zr.usingObjectURL(e,Zr.loadImage);try{if(e.type==="image/png"){const r=new DataView(await e.arrayBuffer());if(Ps.isPng(r,0)){const o=Ps.findChunk(r,"pHYs");if(o){const s=Ps.parsePhys(r,o.dataOffset);if(s.unit===0&&s.ppux===s.ppuy){const i=Math.max(s.ppux/2834.5,1);return{w:Math.round(t.naturalWidth/i),h:Math.round(t.naturalHeight/i)}}}}}}catch(r){return console.error(r),{w:t.naturalWidth,h:t.naturalHeight}}return{w:t.naturalWidth,h:t.naturalHeight}}static async isAnimated(e){return e.type==="image/gif"?y8(await e.arrayBuffer()):e.type==="image/avif"?g8(await e.arrayBuffer()):e.type==="image/webp"?x8(await e.arrayBuffer()):e.type==="image/apng"?f8(await e.arrayBuffer()):!1}static isAnimatedImageType(e){return XM.includes(e||"")}static isStaticImageType(e){return YM.includes(e||"")}static isVectorImageType(e){return qM.includes(e||"")}static isImageType(e){return jg.includes(e)}static async usingObjectURL(e,t){const r=URL.createObjectURL(e);try{return await t(r)}finally{URL.revokeObjectURL(r)}}}function it(n,e,t){return n+(e-n)*t}function rs(n=""){let e=0,t=0,r=0,o=0;function s(){const i=e^e<<11;return e=t,t=r,r=o,o^=(o>>>19^i^i>>>8)>>>0,o/4294967296*2}for(let i=0;i<n.length+64;i++)e^=n.charCodeAt(i)|0,s();return s}function Bc(n,e,t,r=!1){const[o,s]=e,[i,a]=t,c=i+(n-o)/(s-o)*(a-i);return r?i<a?Math.max(Math.min(c,a),i):Math.max(Math.min(c,i),a):c}function Qo(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Yn(n,e){if(Qo(n,e))return n[e]}function vI(n){return Object.keys(n)}function qt(n){return Object.values(n)}function Lr(n){return Object.entries(n)}function Eb(n){return Object.fromEntries(n)}function Sd(n,e){const t={};let r=!1;for(const[o,s]of Lr(n))e(o,s)?t[o]=s:r=!0;return r?t:n}function Wd(n,e){const t={};for(const[r,o]of Lr(n)){const s=e(r,o);t[r]=s}return t}function ZM(n,e){if(n===e)return!0;const t=new Set(Object.keys(n)),r=new Set(Object.keys(e));if(t.size!==r.size)return!1;for(const o of t)if(!r.has(o)||!Object.is(n[o],e[o]))return!1;return!0}function b8(n){const e=_8(n.chars),t=P8(e,n.firstPositive,n.mostPositive,n.mostNegative),r=n.jitterRange??Math.floor(Math.pow(e.length,3)/5),o=C8(r,e.length);return{chars:n.chars,byChar:e.byChar,byCode:e.byCode,length:e.length,first:e.byCode[0],last:e.byCode[e.length-1],firstPositive:t.firstPositive,mostPositive:t.mostPositive,firstNegative:t.firstNegative,mostNegative:t.mostNegative,jitterRange:r,paddingDict:o}}function _8(n){const e={},t={},r=n.length;for(let o=0;o<r;o++){const s=n[o];e[o]=s,t[s]=o}return{byCode:e,byChar:t,length:r}}function P8(n,e,t,r){const o=e?n.byChar[e]:Math.ceil(n.length/2),s=t?n.byChar[t]:n.length-1,i=r?n.byChar[r]:0;if(o===void 0||s===void 0||i===void 0)throw new Error("invalid charSet");if(s-o<3)throw new Error("mostPositive must be at least 3 characters away from neutral");if(o-i<3)throw new Error("mostNegative must be at least 3 characters away from neutral");return{firstPositive:n.byCode[o],mostPositive:n.byCode[s],firstNegative:n.byCode[o-1],mostNegative:n.byCode[i]}}function C8(n,e){const t={};for(let r=0;r<100&&(t[r]=Math.pow(e,r),!(t[r]>n));r++);return t}var Rv=null;function kb(){return Rv||(Rv=b8({chars:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",firstPositive:"a",mostPositive:"z",mostNegative:"A"}))}function la(n,e,t){const r=t.byChar[n],o=t.byChar[e];return Math.abs(r-o)}function Tb(n,e){const t=n[0];if(t>e.mostPositive||t<e.mostNegative)throw new Error("invalid firstChar on key");return t===e.mostPositive?la(t,e.firstPositive,e)+1+Wf(n.slice(1),"positive",e):t===e.mostNegative?la(t,e.firstNegative,e)+1+Wf(n.slice(1),"negative",e):t>=e.firstPositive?la(t,e.firstPositive,e)+2:la(t,e.firstNegative,e)+2}function Wf(n,e,t){const r=n[0];if(r>t.mostPositive||r<t.mostNegative)throw new Error("invalid firstChar on key");return r===t.mostPositive&&e==="positive"?la(r,t.mostNegative,t)+1+Wf(n.slice(1),e,t):r===t.mostNegative&&e==="negative"?la(r,t.mostPositive,t)+1+Wf(n.slice(1),e,t):e==="positive"?la(r,t.mostNegative,t)+2:la(r,t.mostPositive,t)+2}function Rg(n,e,t,r,o){const s=Math.max(n.length,e.length);return t==="start"?[n.padStart(s,r),e.padStart(s,r)]:[n.padEnd(s,r),e.padEnd(s,r)]}function I8(n,e,t){let[r,o]=Rg(n,e,"end",t.first),s=nw(r,o,t);s===1&&(r=r.padEnd(r.length+1,t.first),s=t.length);const i=eA(Math.floor(s/2),t);return Mb(r,i,t)}function nw(n,e,t){const[r,o]=Rg(n,e,"end",t.first).sort(),s=QM(o,r,t);return E8(s,t)}function Mb(n,e,t){const r=t.length,[o,s]=Rg(n,e,"start",t.first),i=[];let a=0;for(let c=o.length-1;c>=0;c--){const u=t.byChar[o[c]],h=t.byChar[s[c]],f=u+h+a;a=Math.floor(f/r);const g=f%r;i.unshift(t.byCode[g])}return a>0&&i.unshift(t.byCode[a]),i.join("")}function QM(n,e,t){const r=t.length,[o,s]=Rg(n,e,"start",t.first),i=[];let a=0;for(let c=o.length-1;c>=0;c--){let u=t.byChar[o[c]];const h=t.byChar[s[c]]+a;u<h?(a=1,u+=r):a=0;const f=u-h;i.unshift(t.byCode[f])}if(a>0)throw new Error("Subtraction result is negative. Ensure a is greater than or equal to b.");for(;i.length>1&&i[0]===t.byCode[0];)i.shift();return i.join("")}function JM(n,e){return Mb(n,e.byCode[1],e)}function rw(n,e){return QM(n,e.byCode[1],e)}function eA(n,e){if(n===0)return e.byCode[0];let t="";const r=e.length;for(;n>0;)t=e.byCode[n%r]+t,n=Math.floor(n/r);return t}function E8(n,e){let t=0;const r=n.length,o=e.length;for(let s=0;s<r;s++)t+=e.byChar[n[s]]*Math.pow(o,r-s-1);return t}function k8(n){return n.firstPositive+n.byCode[0]}function T8(n,e){return Tb(n,e)===n.length}function SI(n,e){Vf(n,e)}function Vf(n,e){const t=rA(n,e),r=Tb(t,e);if(r>n.length)throw new Error("invalid order key length: "+n);return n.slice(0,r)}function tA(n,e){if(!T8(n,e))throw new Error("invalid integer length: "+n)}function nA(n,e){tA(n,e);const[t,r]=oA(n,e);if(r.split("").some(i=>i!==e.byCode[e.length-1])){const i=JM(r,e);return t+i}const s=A8(t,e);return sA(s,"lower",e)}function M8(n,e){tA(n,e);const[t,r]=oA(n,e);if(r.split("").some(i=>i!==e.byCode[0])){const i=rw(r,e);return t+i}const s=j8(t,e);return sA(s,"upper",e)}function rA(n,e){let t=0;if(n[0]===e.mostPositive)for(;n[t]===e.mostPositive;)t=t+1;if(n[0]===e.mostNegative)for(;n[t]===e.mostNegative;)t=t+1;return n.slice(0,t+1)}function oA(n,e){const t=rA(n,e),r=n.slice(t.length);return[t,r]}function A8(n,e){const t=n>=e.firstPositive,r=JM(n,e),o=n[n.length-1]===e.mostPositive,s=r[r.length-1]===e.mostPositive;return t&&s?r+e.mostNegative:!t&&o?n.slice(0,n.length-1):r}function j8(n,e){const t=n>=e.firstPositive,r=n[n.length-1]===e.mostNegative;if(t&&r){const o=n.slice(0,n.length-1);return rw(o,e)}return!t&&r?n+e.mostPositive:rw(n,e)}function sA(n,e,t){const r=Tb(n,t),o=e==="upper"?t.byCode[t.length-1]:t.byCode[0];return n+o.repeat(r-n.length)}function iA(n,e){const t=eA(Math.floor(Math.random()*e.jitterRange),e);return Mb(n,t,e)}function R8(n,e,t){const r=n.padEnd(n.length+e,t.first);return iA(r,t)}function O8(n,e,t){const r=Vf(n,t),o=nA(r,t);let s=0;if(e!==null){const a=nw(n,e,t);a<t.jitterRange+1&&(s=Math.max(s,xI(a,t)))}const i=nw(n,o,t);return i<t.jitterRange+1&&(s=Math.max(s,xI(i,t))),s}function xI(n,e){const t=e.jitterRange-n,r=Object.entries(e.paddingDict).find(([o,s])=>s>t);return r?parseInt(r[0]):0}function D8(n,e,t=kb()){if(n!==null&&SI(n,t),e!==null&&SI(e,t),n===null&&e===null)return k8(t);if(n===null){const r=Vf(e,t);return M8(r,t)}if(e===null){const r=Vf(n,t);return nA(r,t)}if(n>=e)throw new Error(n+" >= "+e);return I8(n,e,t)}function aA(n,e,t=kb()){const r=D8(n,e,t),o=O8(r,e,t);return o?R8(r,o,t):iA(r,t)}function lA(n,e,t,r=kb()){return L8(n,e,t,r,aA,lA)}function L8(n,e,t,r,o,s){if(t===0)return[];if(t===1)return[o(n,e,r)];if(e==null){let c=o(n,e,r);const u=[c];for(let h=0;h<t-1;h++)c=o(c,e,r),u.push(c);return u}if(n==null){let c=o(n,e,r);const u=[c];for(let h=0;h<t-1;h++)c=o(n,c,r),u.push(c);return u.reverse(),u}const i=Math.floor(t/2),a=o(n,e,r);return[...s(n,a,i,r),a,...s(a,e,t-i-1,r)]}const Zc=lA,cA="a0";function F8(n){try{aA(n,null)}catch{throw new Error("invalid index: "+n)}}function Uc(n,e,t){return Zc(n??null,e??null,t)}function Ov(n,e){return Zc(n??null,null,e)}function jd(n,e){return Zc(n??null,e??null,1)[0]}function Is(n=null){return Zc(n,null,1)[0]}function N8(n=null){return Zc(null,n,1)[0]}function Rd(n,e="a1"){return[e,...Zc(e,null,n)]}function Gn(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function $8(n,e){return n.id>e.id?1:-1}function Ab(n){try{return localStorage.getItem(n)}catch{return null}}function jb(n,e){try{localStorage.setItem(n,e)}catch{}}function z8(){try{localStorage.clear()}catch{}}function uA(n){try{return sessionStorage.getItem(n)}catch{return null}}function Rb(n,e){try{sessionStorage.setItem(n,e)}catch{}}function dA(n){try{sessionStorage.removeItem(n)}catch{}}function B8(){try{sessionStorage.clear()}catch{}}const U8=()=>typeof process<"u"&&!1,Cc=[],H8=60,af=Math.ceil(1e3/H8);let Wu,Dv=0,ow=0;const K8=()=>{const n=Cc.splice(0,Cc.length);for(const e of n)e()};function hA(){if(Wu)return;const n=Date.now(),e=n-ow;if(Dv+e<af){Wu=requestAnimationFrame(()=>{Wu=void 0,hA()});return}Wu=requestAnimationFrame(()=>{Wu=void 0,ow=n,Dv=Math.min(Dv+e-af,af*10),K8()})}let wI=!1;function pA(n){return U8()?(n(),()=>{}):(Cc.includes(n)||(Cc.push(n),wI||(wI=!0,ow=Date.now()-af-1),hA()),()=>{const e=Cc.indexOf(n);e>-1&&Cc.splice(e,1)})}class W8{constructor(){j(this,"timeouts",new Map);j(this,"intervals",new Map);j(this,"rafs",new Map);this.setTimeout=this.setTimeout.bind(this),this.setInterval=this.setInterval.bind(this),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.dispose=this.dispose.bind(this)}setTimeout(e,t,r,...o){const s=window.setTimeout(t,r,o),i=this.timeouts.get(e)??[];return this.timeouts.set(e,[...i,s]),s}setInterval(e,t,r,...o){const s=window.setInterval(t,r,o),i=this.intervals.get(e)??[];return this.intervals.set(e,[...i,s]),s}requestAnimationFrame(e,t){const r=window.requestAnimationFrame(t),o=this.rafs.get(e)??[];return this.rafs.set(e,[...o,r]),r}dispose(e){var t,r,o;(t=this.timeouts.get(e))==null||t.forEach(s=>clearTimeout(s)),(r=this.intervals.get(e))==null||r.forEach(s=>clearInterval(s)),(o=this.rafs.get(e))==null||o.forEach(s=>cancelAnimationFrame(s)),this.timeouts.delete(e),this.intervals.delete(e),this.rafs.delete(e)}disposeAll(){for(const e of this.timeouts.keys())this.dispose(e)}forContext(e){return{setTimeout:(t,r,...o)=>this.setTimeout(e,t,r,o),setInterval:(t,r,...o)=>this.setInterval(e,t,r,o),requestAnimationFrame:t=>this.requestAnimationFrame(e,t),dispose:()=>this.dispose(e)}}}const Ge=(n,e)=>{try{return new URL(n,e)}catch{return}};function V8(n){return n!==void 0}function G8(){return typeof globalThis<"u"&&globalThis.structuredClone?[globalThis.structuredClone,!0]:typeof global<"u"&&global.structuredClone?[global.structuredClone,!0]:typeof window<"u"&&window.structuredClone?[window.structuredClone,!0]:[n=>n&&JSON.parse(JSON.stringify(n)),!1]}const fA=G8(),zt=fA[0];fA[1];const q8=Object.getPrototypeOf(zt({}));ba("@tldraw/utils","3.6.0","esm");var bI={},Vu,_I;function ar(){if(_I)return Vu;_I=1;var n=function(e){return e&&e.Math===Math&&e};return Vu=n(typeof globalThis=="object"&&globalThis)||n(typeof window=="object"&&window)||n(typeof self=="object"&&self)||n(typeof Rr=="object"&&Rr)||n(typeof Vu=="object"&&Vu)||function(){return this}()||Function("return this")(),Vu}var Lv={},Fv,PI;function lr(){return PI||(PI=1,Fv=function(n){try{return!!n()}catch{return!0}}),Fv}var Nv,CI;function _a(){if(CI)return Nv;CI=1;var n=lr();return Nv=!n(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),Nv}var $v,II;function Og(){if(II)return $v;II=1;var n=lr();return $v=!n(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),$v}var zv,EI;function Pi(){if(EI)return zv;EI=1;var n=Og(),e=Function.prototype.call;return zv=n?e.bind(e):function(){return e.apply(e,arguments)},zv}var Bv={},kI;function Y8(){if(kI)return Bv;kI=1;var n={}.propertyIsEnumerable,e=Object.getOwnPropertyDescriptor,t=e&&!n.call({1:2},1);return Bv.f=t?function(o){var s=e(this,o);return!!s&&s.enumerable}:n,Bv}var Uv,TI;function gA(){return TI||(TI=1,Uv=function(n,e){return{enumerable:!(n&1),configurable:!(n&2),writable:!(n&4),value:e}}),Uv}var Hv,MI;function wn(){if(MI)return Hv;MI=1;var n=Og(),e=Function.prototype,t=e.call,r=n&&e.bind.bind(t,t);return Hv=n?r:function(o){return function(){return t.apply(o,arguments)}},Hv}var Kv,AI;function Qc(){if(AI)return Kv;AI=1;var n=wn(),e=n({}.toString),t=n("".slice);return Kv=function(r){return t(e(r),8,-1)},Kv}var Wv,jI;function X8(){if(jI)return Wv;jI=1;var n=wn(),e=lr(),t=Qc(),r=Object,o=n("".split);return Wv=e(function(){return!r("z").propertyIsEnumerable(0)})?function(s){return t(s)==="String"?o(s,""):r(s)}:r,Wv}var Vv,RI;function Dg(){return RI||(RI=1,Vv=function(n){return n==null}),Vv}var Gv,OI;function Jc(){if(OI)return Gv;OI=1;var n=Dg(),e=TypeError;return Gv=function(t){if(n(t))throw new e("Can't call method on "+t);return t},Gv}var qv,DI;function Lg(){if(DI)return qv;DI=1;var n=X8(),e=Jc();return qv=function(t){return n(e(t))},qv}var Yv,LI;function cr(){if(LI)return Yv;LI=1;var n=typeof document=="object"&&document.all;return Yv=typeof n>"u"&&n!==void 0?function(e){return typeof e=="function"||e===n}:function(e){return typeof e=="function"},Yv}var Xv,FI;function _l(){if(FI)return Xv;FI=1;var n=cr();return Xv=function(e){return typeof e=="object"?e!==null:n(e)},Xv}var Zv,NI;function Fg(){if(NI)return Zv;NI=1;var n=ar(),e=cr(),t=function(r){return e(r)?r:void 0};return Zv=function(r,o){return arguments.length<2?t(n[r]):n[r]&&n[r][o]},Zv}var Qv,$I;function mA(){if($I)return Qv;$I=1;var n=wn();return Qv=n({}.isPrototypeOf),Qv}var Jv,zI;function Z8(){if(zI)return Jv;zI=1;var n=ar(),e=n.navigator,t=e&&e.userAgent;return Jv=t?String(t):"",Jv}var eS,BI;function Q8(){if(BI)return eS;BI=1;var n=ar(),e=Z8(),t=n.process,r=n.Deno,o=t&&t.versions||r&&r.version,s=o&&o.v8,i,a;return s&&(i=s.split("."),a=i[0]>0&&i[0]<4?1:+(i[0]+i[1])),!a&&e&&(i=e.match(/Edge\/(\d+)/),(!i||i[1]>=74)&&(i=e.match(/Chrome\/(\d+)/),i&&(a=+i[1]))),eS=a,eS}var tS,UI;function yA(){if(UI)return tS;UI=1;var n=Q8(),e=lr(),t=ar(),r=t.String;return tS=!!Object.getOwnPropertySymbols&&!e(function(){var o=Symbol("symbol detection");return!r(o)||!(Object(o)instanceof Symbol)||!Symbol.sham&&n&&n<41}),tS}var nS,HI;function vA(){if(HI)return nS;HI=1;var n=yA();return nS=n&&!Symbol.sham&&typeof Symbol.iterator=="symbol",nS}var rS,KI;function SA(){if(KI)return rS;KI=1;var n=Fg(),e=cr(),t=mA(),r=vA(),o=Object;return rS=r?function(s){return typeof s=="symbol"}:function(s){var i=n("Symbol");return e(i)&&t(i.prototype,o(s))},rS}var oS,WI;function J8(){if(WI)return oS;WI=1;var n=String;return oS=function(e){try{return n(e)}catch{return"Object"}},oS}var sS,VI;function Ob(){if(VI)return sS;VI=1;var n=cr(),e=J8(),t=TypeError;return sS=function(r){if(n(r))return r;throw new t(e(r)+" is not a function")},sS}var iS,GI;function Db(){if(GI)return iS;GI=1;var n=Ob(),e=Dg();return iS=function(t,r){var o=t[r];return e(o)?void 0:n(o)},iS}var aS,qI;function eB(){if(qI)return aS;qI=1;var n=Pi(),e=cr(),t=_l(),r=TypeError;return aS=function(o,s){var i,a;if(s==="string"&&e(i=o.toString)&&!t(a=n(i,o))||e(i=o.valueOf)&&!t(a=n(i,o))||s!=="string"&&e(i=o.toString)&&!t(a=n(i,o)))return a;throw new r("Can't convert object to primitive value")},aS}var lS={exports:{}},cS,YI;function xA(){return YI||(YI=1,cS=!1),cS}var uS,XI;function Lb(){if(XI)return uS;XI=1;var n=ar(),e=Object.defineProperty;return uS=function(t,r){try{e(n,t,{value:r,configurable:!0,writable:!0})}catch{n[t]=r}return r},uS}var ZI;function Fb(){if(ZI)return lS.exports;ZI=1;var n=xA(),e=ar(),t=Lb(),r="__core-js_shared__",o=lS.exports=e[r]||t(r,{});return(o.versions||(o.versions=[])).push({version:"3.39.0",mode:n?"pure":"global",copyright:"© 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.39.0/LICENSE",source:"https://github.com/zloirock/core-js"}),lS.exports}var dS,QI;function Nb(){if(QI)return dS;QI=1;var n=Fb();return dS=function(e,t){return n[e]||(n[e]=t||{})},dS}var hS,JI;function Vd(){if(JI)return hS;JI=1;var n=Jc(),e=Object;return hS=function(t){return e(n(t))},hS}var pS,eE;function Pa(){if(eE)return pS;eE=1;var n=wn(),e=Vd(),t=n({}.hasOwnProperty);return pS=Object.hasOwn||function(o,s){return t(e(o),s)},pS}var fS,tE;function wA(){if(tE)return fS;tE=1;var n=wn(),e=0,t=Math.random(),r=n(1 .toString);return fS=function(o){return"Symbol("+(o===void 0?"":o)+")_"+r(++e+t,36)},fS}var gS,nE;function Ci(){if(nE)return gS;nE=1;var n=ar(),e=Nb(),t=Pa(),r=wA(),o=yA(),s=vA(),i=n.Symbol,a=e("wks"),c=s?i.for||i:i&&i.withoutSetter||r;return gS=function(u){return t(a,u)||(a[u]=o&&t(i,u)?i[u]:c("Symbol."+u)),a[u]},gS}var mS,rE;function tB(){if(rE)return mS;rE=1;var n=Pi(),e=_l(),t=SA(),r=Db(),o=eB(),s=Ci(),i=TypeError,a=s("toPrimitive");return mS=function(c,u){if(!e(c)||t(c))return c;var h=r(c,a),f;if(h){if(u===void 0&&(u="default"),f=n(h,c,u),!e(f)||t(f))return f;throw new i("Can't convert object to primitive value")}return u===void 0&&(u="number"),o(c,u)},mS}var yS,oE;function bA(){if(oE)return yS;oE=1;var n=tB(),e=SA();return yS=function(t){var r=n(t,"string");return e(r)?r:r+""},yS}var vS,sE;function _A(){if(sE)return vS;sE=1;var n=ar(),e=_l(),t=n.document,r=e(t)&&e(t.createElement);return vS=function(o){return r?t.createElement(o):{}},vS}var SS,iE;function PA(){if(iE)return SS;iE=1;var n=_a(),e=lr(),t=_A();return SS=!n&&!e(function(){return Object.defineProperty(t("div"),"a",{get:function(){return 7}}).a!==7}),SS}var aE;function CA(){if(aE)return Lv;aE=1;var n=_a(),e=Pi(),t=Y8(),r=gA(),o=Lg(),s=bA(),i=Pa(),a=PA(),c=Object.getOwnPropertyDescriptor;return Lv.f=n?c:function(h,f){if(h=o(h),f=s(f),a)try{return c(h,f)}catch{}if(i(h,f))return r(!e(t.f,h,f),h[f])},Lv}var xS={},wS,lE;function IA(){if(lE)return wS;lE=1;var n=_a(),e=lr();return wS=n&&e(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),wS}var bS,cE;function Pl(){if(cE)return bS;cE=1;var n=_l(),e=String,t=TypeError;return bS=function(r){if(n(r))return r;throw new t(e(r)+" is not an object")},bS}var uE;function Gd(){if(uE)return xS;uE=1;var n=_a(),e=PA(),t=IA(),r=Pl(),o=bA(),s=TypeError,i=Object.defineProperty,a=Object.getOwnPropertyDescriptor,c="enumerable",u="configurable",h="writable";return xS.f=n?t?function(g,y,v){if(r(g),y=o(y),r(v),typeof g=="function"&&y==="prototype"&&"value"in v&&h in v&&!v[h]){var S=a(g,y);S&&S[h]&&(g[y]=v.value,v={configurable:u in v?v[u]:S[u],enumerable:c in v?v[c]:S[c],writable:!1})}return i(g,y,v)}:i:function(g,y,v){if(r(g),y=o(y),r(v),e)try{return i(g,y,v)}catch{}if("get"in v||"set"in v)throw new s("Accessors not supported");return"value"in v&&(g[y]=v.value),g},xS}var _S,dE;function $b(){if(dE)return _S;dE=1;var n=_a(),e=Gd(),t=gA();return _S=n?function(r,o,s){return e.f(r,o,t(1,s))}:function(r,o,s){return r[o]=s,r},_S}var PS={exports:{}},CS,hE;function nB(){if(hE)return CS;hE=1;var n=_a(),e=Pa(),t=Function.prototype,r=n&&Object.getOwnPropertyDescriptor,o=e(t,"name"),s=o&&(function(){}).name==="something",i=o&&(!n||n&&r(t,"name").configurable);return CS={EXISTS:o,PROPER:s,CONFIGURABLE:i},CS}var IS,pE;function EA(){if(pE)return IS;pE=1;var n=wn(),e=cr(),t=Fb(),r=n(Function.toString);return e(t.inspectSource)||(t.inspectSource=function(o){return r(o)}),IS=t.inspectSource,IS}var ES,fE;function rB(){if(fE)return ES;fE=1;var n=ar(),e=cr(),t=n.WeakMap;return ES=e(t)&&/native code/.test(String(t)),ES}var kS,gE;function kA(){if(gE)return kS;gE=1;var n=Nb(),e=wA(),t=n("keys");return kS=function(r){return t[r]||(t[r]=e(r))},kS}var TS,mE;function zb(){return mE||(mE=1,TS={}),TS}var MS,yE;function TA(){if(yE)return MS;yE=1;var n=rB(),e=ar(),t=_l(),r=$b(),o=Pa(),s=Fb(),i=kA(),a=zb(),c="Object already initialized",u=e.TypeError,h=e.WeakMap,f,g,y,v=function(_){return y(_)?g(_):f(_,{})},S=function(_){return function(T){var E;if(!t(T)||(E=g(T)).type!==_)throw new u("Incompatible receiver, "+_+" required");return E}};if(n||s.state){var w=s.state||(s.state=new h);w.get=w.get,w.has=w.has,w.set=w.set,f=function(_,T){if(w.has(_))throw new u(c);return T.facade=_,w.set(_,T),T},g=function(_){return w.get(_)||{}},y=function(_){return w.has(_)}}else{var b=i("state");a[b]=!0,f=function(_,T){if(o(_,b))throw new u(c);return T.facade=_,r(_,b,T),T},g=function(_){return o(_,b)?_[b]:{}},y=function(_){return o(_,b)}}return MS={set:f,get:g,has:y,enforce:v,getterFor:S},MS}var vE;function oB(){if(vE)return PS.exports;vE=1;var n=wn(),e=lr(),t=cr(),r=Pa(),o=_a(),s=nB().CONFIGURABLE,i=EA(),a=TA(),c=a.enforce,u=a.get,h=String,f=Object.defineProperty,g=n("".slice),y=n("".replace),v=n([].join),S=o&&!e(function(){return f(function(){},"length",{value:8}).length!==8}),w=String(String).split("String"),b=PS.exports=function(_,T,E){g(h(T),0,7)==="Symbol("&&(T="["+y(h(T),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),E&&E.getter&&(T="get "+T),E&&E.setter&&(T="set "+T),(!r(_,"name")||s&&_.name!==T)&&(o?f(_,"name",{value:T,configurable:!0}):_.name=T),S&&E&&r(E,"arity")&&_.length!==E.arity&&f(_,"length",{value:E.arity});try{E&&r(E,"constructor")&&E.constructor?o&&f(_,"prototype",{writable:!1}):_.prototype&&(_.prototype=void 0)}catch{}var M=c(_);return r(M,"source")||(M.source=v(w,typeof T=="string"?T:"")),_};return Function.prototype.toString=b(function(){return t(this)&&u(this).source||i(this)},"toString"),PS.exports}var AS,SE;function MA(){if(SE)return AS;SE=1;var n=cr(),e=Gd(),t=oB(),r=Lb();return AS=function(o,s,i,a){a||(a={});var c=a.enumerable,u=a.name!==void 0?a.name:s;if(n(i)&&t(i,u,a),a.global)c?o[s]=i:r(s,i);else{try{a.unsafe?o[s]&&(c=!0):delete o[s]}catch{}c?o[s]=i:e.f(o,s,{value:i,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return o},AS}var jS={},RS,xE;function sB(){if(xE)return RS;xE=1;var n=Math.ceil,e=Math.floor;return RS=Math.trunc||function(r){var o=+r;return(o>0?e:n)(o)},RS}var OS,wE;function Cl(){if(wE)return OS;wE=1;var n=sB();return OS=function(e){var t=+e;return t!==t||t===0?0:n(t)},OS}var DS,bE;function iB(){if(bE)return DS;bE=1;var n=Cl(),e=Math.max,t=Math.min;return DS=function(r,o){var s=n(r);return s<0?e(s+o,0):t(s,o)},DS}var LS,_E;function AA(){if(_E)return LS;_E=1;var n=Cl(),e=Math.min;return LS=function(t){var r=n(t);return r>0?e(r,9007199254740991):0},LS}var FS,PE;function qd(){if(PE)return FS;PE=1;var n=AA();return FS=function(e){return n(e.length)},FS}var NS,CE;function aB(){if(CE)return NS;CE=1;var n=Lg(),e=iB(),t=qd(),r=function(o){return function(s,i,a){var c=n(s),u=t(c);if(u===0)return!o&&-1;var h=e(a,u),f;if(o&&i!==i){for(;u>h;)if(f=c[h++],f!==f)return!0}else for(;u>h;h++)if((o||h in c)&&c[h]===i)return o||h||0;return!o&&-1}};return NS={includes:r(!0),indexOf:r(!1)},NS}var $S,IE;function jA(){if(IE)return $S;IE=1;var n=wn(),e=Pa(),t=Lg(),r=aB().indexOf,o=zb(),s=n([].push);return $S=function(i,a){var c=t(i),u=0,h=[],f;for(f in c)!e(o,f)&&e(c,f)&&s(h,f);for(;a.length>u;)e(c,f=a[u++])&&(~r(h,f)||s(h,f));return h},$S}var zS,EE;function Bb(){return EE||(EE=1,zS=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]),zS}var kE;function lB(){if(kE)return jS;kE=1;var n=jA(),e=Bb(),t=e.concat("length","prototype");return jS.f=Object.getOwnPropertyNames||function(o){return n(o,t)},jS}var BS={},TE;function cB(){return TE||(TE=1,BS.f=Object.getOwnPropertySymbols),BS}var US,ME;function uB(){if(ME)return US;ME=1;var n=Fg(),e=wn(),t=lB(),r=cB(),o=Pl(),s=e([].concat);return US=n("Reflect","ownKeys")||function(a){var c=t.f(o(a)),u=r.f;return u?s(c,u(a)):c},US}var HS,AE;function dB(){if(AE)return HS;AE=1;var n=Pa(),e=uB(),t=CA(),r=Gd();return HS=function(o,s,i){for(var a=e(s),c=r.f,u=t.f,h=0;h<a.length;h++){var f=a[h];!n(o,f)&&!(i&&n(i,f))&&c(o,f,u(s,f))}},HS}var KS,jE;function hB(){if(jE)return KS;jE=1;var n=lr(),e=cr(),t=/#|\.prototype\./,r=function(c,u){var h=s[o(c)];return h===a?!0:h===i?!1:e(u)?n(u):!!u},o=r.normalize=function(c){return String(c).replace(t,".").toLowerCase()},s=r.data={},i=r.NATIVE="N",a=r.POLYFILL="P";return KS=r,KS}var WS,RE;function eu(){if(RE)return WS;RE=1;var n=ar(),e=CA().f,t=$b(),r=MA(),o=Lb(),s=dB(),i=hB();return WS=function(a,c){var u=a.target,h=a.global,f=a.stat,g,y,v,S,w,b;if(h?y=n:f?y=n[u]||o(u,{}):y=n[u]&&n[u].prototype,y)for(v in c){if(w=c[v],a.dontCallGetSet?(b=e(y,v),S=b&&b.value):S=y[v],g=i(h?v:u+(f?".":"#")+v,a.forced),!g&&S!==void 0){if(typeof w==typeof S)continue;s(w,S)}(a.sham||S&&S.sham)&&t(w,"sham",!0),r(y,v,w,a)}},WS}var VS={},GS,OE;function pB(){if(OE)return GS;OE=1;var n=jA(),e=Bb();return GS=Object.keys||function(r){return n(r,e)},GS}var DE;function fB(){if(DE)return VS;DE=1;var n=_a(),e=IA(),t=Gd(),r=Pl(),o=Lg(),s=pB();return VS.f=n&&!e?Object.defineProperties:function(a,c){r(a);for(var u=o(c),h=s(c),f=h.length,g=0,y;f>g;)t.f(a,y=h[g++],u[y]);return a},VS}var qS,LE;function gB(){if(LE)return qS;LE=1;var n=Fg();return qS=n("document","documentElement"),qS}var YS,FE;function RA(){if(FE)return YS;FE=1;var n=Pl(),e=fB(),t=Bb(),r=zb(),o=gB(),s=_A(),i=kA(),a=">",c="<",u="prototype",h="script",f=i("IE_PROTO"),g=function(){},y=function(_){return c+h+a+_+c+"/"+h+a},v=function(_){_.write(y("")),_.close();var T=_.parentWindow.Object;return _=null,T},S=function(){var _=s("iframe"),T="java"+h+":",E;return _.style.display="none",o.appendChild(_),_.src=String(T),E=_.contentWindow.document,E.open(),E.write(y("document.F=Object")),E.close(),E.F},w,b=function(){try{w=new ActiveXObject("htmlfile")}catch{}b=typeof document<"u"?document.domain&&w?v(w):S():v(w);for(var _=t.length;_--;)delete b[u][t[_]];return b()};return r[f]=!0,YS=Object.create||function(T,E){var M;return T!==null?(g[u]=n(T),M=new g,g[u]=null,M[f]=T):M=b(),E===void 0?M:e.f(M,E)},YS}var XS,NE;function Ub(){if(NE)return XS;NE=1;var n=Ci(),e=RA(),t=Gd().f,r=n("unscopables"),o=Array.prototype;return o[r]===void 0&&t(o,r,{configurable:!0,value:e(null)}),XS=function(s){o[r][s]=!0},XS}var $E;function mB(){if($E)return bI;$E=1;var n=eu(),e=Vd(),t=qd(),r=Cl(),o=Ub();return n({target:"Array",proto:!0},{at:function(i){var a=e(this),c=t(a),u=r(i),h=u>=0?u:c+u;return h<0||h>=c?void 0:a[h]}}),o("at"),bI}var ZS,zE;function Yd(){if(zE)return ZS;zE=1;var n=ar(),e=wn();return ZS=function(t,r){return e(n[t].prototype[r])},ZS}var QS,BE;function yB(){if(BE)return QS;BE=1,mB();var n=Yd();return QS=n("Array","at"),QS}var JS,UE;function vB(){if(UE)return JS;UE=1;var n=yB();return JS=n,JS}vB();var HE={},e0,KE;function OA(){if(KE)return e0;KE=1;var n=Qc();return e0=Array.isArray||function(t){return n(t)==="Array"},e0}var t0,WE;function SB(){if(WE)return t0;WE=1;var n=TypeError,e=9007199254740991;return t0=function(t){if(t>e)throw n("Maximum allowed index exceeded");return t},t0}var n0,VE;function xB(){if(VE)return n0;VE=1;var n=Qc(),e=wn();return n0=function(t){if(n(t)==="Function")return e(t)},n0}var r0,GE;function wB(){if(GE)return r0;GE=1;var n=xB(),e=Ob(),t=Og(),r=n(n.bind);return r0=function(o,s){return e(o),s===void 0?o:t?r(o,s):function(){return o.apply(s,arguments)}},r0}var o0,qE;function DA(){if(qE)return o0;qE=1;var n=OA(),e=qd(),t=SB(),r=wB(),o=function(s,i,a,c,u,h,f,g){for(var y=u,v=0,S=f?r(f,g):!1,w,b;v<c;)v in a&&(w=S?S(a[v],v,i):a[v],h>0&&n(w)?(b=e(w),y=o(s,i,w,b,y,h-1)-1):(t(y+1),s[y]=w),y++),v++;return y};return o0=o,o0}var s0,YE;function bB(){if(YE)return s0;YE=1;var n=Ci(),e=n("toStringTag"),t={};return t[e]="z",s0=String(t)==="[object z]",s0}var i0,XE;function LA(){if(XE)return i0;XE=1;var n=bB(),e=cr(),t=Qc(),r=Ci(),o=r("toStringTag"),s=Object,i=t(function(){return arguments}())==="Arguments",a=function(c,u){try{return c[u]}catch{}};return i0=n?t:function(c){var u,h,f;return c===void 0?"Undefined":c===null?"Null":typeof(h=a(u=s(c),o))=="string"?h:i?t(u):(f=t(u))==="Object"&&e(u.callee)?"Arguments":f},i0}var a0,ZE;function _B(){if(ZE)return a0;ZE=1;var n=wn(),e=lr(),t=cr(),r=LA(),o=Fg(),s=EA(),i=function(){},a=o("Reflect","construct"),c=/^\s*(?:class|function)\b/,u=n(c.exec),h=!c.test(i),f=function(v){if(!t(v))return!1;try{return a(i,[],v),!0}catch{return!1}},g=function(v){if(!t(v))return!1;switch(r(v)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!u(c,s(v))}catch{return!0}};return g.sham=!0,a0=!a||e(function(){var y;return f(f.call)||!f(Object)||!f(function(){y=!0})||y})?g:f,a0}var l0,QE;function PB(){if(QE)return l0;QE=1;var n=OA(),e=_B(),t=_l(),r=Ci(),o=r("species"),s=Array;return l0=function(i){var a;return n(i)&&(a=i.constructor,e(a)&&(a===s||n(a.prototype))?a=void 0:t(a)&&(a=a[o],a===null&&(a=void 0))),a===void 0?s:a},l0}var c0,JE;function FA(){if(JE)return c0;JE=1;var n=PB();return c0=function(e,t){return new(n(e))(t===0?0:t)},c0}var e2;function CB(){if(e2)return HE;e2=1;var n=eu(),e=DA(),t=Ob(),r=Vd(),o=qd(),s=FA();return n({target:"Array",proto:!0},{flatMap:function(a){var c=r(this),u=o(c),h;return t(a),h=s(c,0),h.length=e(h,c,c,u,0,1,a,arguments.length>1?arguments[1]:void 0),h}}),HE}var t2={},n2;function IB(){if(n2)return t2;n2=1;var n=Ub();return n("flatMap"),t2}var u0,r2;function EB(){if(r2)return u0;r2=1,CB(),IB();var n=Yd();return u0=n("Array","flatMap"),u0}var d0,o2;function kB(){if(o2)return d0;o2=1;var n=EB();return d0=n,d0}kB();var s2={},i2;function TB(){if(i2)return s2;i2=1;var n=eu(),e=DA(),t=Vd(),r=qd(),o=Cl(),s=FA();return n({target:"Array",proto:!0},{flat:function(){var a=arguments.length?arguments[0]:void 0,c=t(this),u=r(c),h=s(c,0);return h.length=e(h,c,c,u,0,a===void 0?1:o(a)),h}}),s2}var a2={},l2;function MB(){if(l2)return a2;l2=1;var n=Ub();return n("flat"),a2}var h0,c2;function AB(){if(c2)return h0;c2=1,TB(),MB();var n=Yd();return h0=n("Array","flat"),h0}var p0,u2;function jB(){if(u2)return p0;u2=1;var n=AB();return p0=n,p0}jB();var d2={},f0,h2;function Xd(){if(h2)return f0;h2=1;var n=LA(),e=String;return f0=function(t){if(n(t)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e(t)},f0}var p2;function RB(){if(p2)return d2;p2=1;var n=eu(),e=wn(),t=Jc(),r=Cl(),o=Xd(),s=lr(),i=e("".charAt),a=s(function(){return"𠮷".at(-2)!=="\uD842"});return n({target:"String",proto:!0,forced:a},{at:function(u){var h=o(t(this)),f=h.length,g=r(u),y=g>=0?g:f+g;return y<0||y>=f?void 0:i(h,y)}}),d2}var g0,f2;function OB(){if(f2)return g0;f2=1,RB();var n=Yd();return g0=n("String","at"),g0}var m0,g2;function DB(){if(g2)return m0;g2=1;var n=OB();return m0=n,m0}DB();var m2={},y0,y2;function NA(){if(y2)return y0;y2=1;var n=Pl();return y0=function(){var e=n(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t},y0}var v0,v2;function LB(){if(v2)return v0;v2=1;var n=lr(),e=ar(),t=e.RegExp,r=n(function(){var i=t("a","y");return i.lastIndex=2,i.exec("abcd")!==null}),o=r||n(function(){return!t("a","y").sticky}),s=r||n(function(){var i=t("^r","gy");return i.lastIndex=2,i.exec("str")!==null});return v0={BROKEN_CARET:s,MISSED_STICKY:o,UNSUPPORTED_Y:r},v0}var S0,S2;function FB(){if(S2)return S0;S2=1;var n=lr(),e=ar(),t=e.RegExp;return S0=n(function(){var r=t(".","s");return!(r.dotAll&&r.test(`
`)&&r.flags==="s")}),S0}var x0,x2;function NB(){if(x2)return x0;x2=1;var n=lr(),e=ar(),t=e.RegExp;return x0=n(function(){var r=t("(?<a>b)","g");return r.exec("b").groups.a!=="b"||"b".replace(r,"$<a>c")!=="bc"}),x0}var w0,w2;function Hb(){if(w2)return w0;w2=1;var n=Pi(),e=wn(),t=Xd(),r=NA(),o=LB(),s=Nb(),i=RA(),a=TA().get,c=FB(),u=NB(),h=s("native-string-replace",String.prototype.replace),f=RegExp.prototype.exec,g=f,y=e("".charAt),v=e("".indexOf),S=e("".replace),w=e("".slice),b=function(){var M=/a/,A=/b*/g;return n(f,M,"a"),n(f,A,"a"),M.lastIndex!==0||A.lastIndex!==0}(),_=o.BROKEN_CARET,T=/()??/.exec("")[1]!==void 0,E=b||T||_||c||u;return E&&(g=function(A){var R=this,L=a(R),K=t(A),D=L.raw,U,V,F,$,H,Z,G;if(D)return D.lastIndex=R.lastIndex,U=n(g,D,K),R.lastIndex=D.lastIndex,U;var q=L.groups,Q=_&&R.sticky,ae=n(r,R),B=R.source,oe=0,pe=K;if(Q&&(ae=S(ae,"y",""),v(ae,"g")===-1&&(ae+="g"),pe=w(K,R.lastIndex),R.lastIndex>0&&(!R.multiline||R.multiline&&y(K,R.lastIndex-1)!==`
`)&&(B="(?: "+B+")",pe=" "+pe,oe++),V=new RegExp("^(?:"+B+")",ae)),T&&(V=new RegExp("^"+B+"$(?!\\s)",ae)),b&&(F=R.lastIndex),$=n(f,Q?V:R,pe),Q?$?($.input=w($.input,oe),$[0]=w($[0],oe),$.index=R.lastIndex,R.lastIndex+=$[0].length):R.lastIndex=0:b&&$&&(R.lastIndex=R.global?$.index+$[0].length:F),T&&$&&$.length>1&&n(h,$[0],V,function(){for(H=1;H<arguments.length-2;H++)arguments[H]===void 0&&($[H]=void 0)}),$&&q)for($.groups=Z=i(null),H=0;H<q.length;H++)G=q[H],Z[G[0]]=$[G[1]];return $}),w0=g,w0}var b2;function $A(){if(b2)return m2;b2=1;var n=eu(),e=Hb();return n({target:"RegExp",proto:!0,forced:/./.exec!==e},{exec:e}),m2}var _2={},b0,P2;function $B(){if(P2)return b0;P2=1;var n=Og(),e=Function.prototype,t=e.apply,r=e.call;return b0=typeof Reflect=="object"&&Reflect.apply||(n?r.bind(t):function(){return r.apply(t,arguments)}),b0}var _0,C2;function zB(){if(C2)return _0;C2=1,$A();var n=Pi(),e=MA(),t=Hb(),r=lr(),o=Ci(),s=$b(),i=o("species"),a=RegExp.prototype;return _0=function(c,u,h,f){var g=o(c),y=!r(function(){var b={};return b[g]=function(){return 7},""[c](b)!==7}),v=y&&!r(function(){var b=!1,_=/a/;return c==="split"&&(_={},_.constructor={},_.constructor[i]=function(){return _},_.flags="",_[g]=/./[g]),_.exec=function(){return b=!0,null},_[g](""),!b});if(!y||!v||h){var S=/./[g],w=u(g,""[c],function(b,_,T,E,M){var A=_.exec;return A===t||A===a.exec?y&&!M?{done:!0,value:n(S,_,T,E)}:{done:!0,value:n(b,T,_,E)}:{done:!1}});e(String.prototype,c,w[0]),e(a,g,w[1])}f&&s(a[g],"sham",!0)},_0}var P0,I2;function BB(){if(I2)return P0;I2=1;var n=wn(),e=Cl(),t=Xd(),r=Jc(),o=n("".charAt),s=n("".charCodeAt),i=n("".slice),a=function(c){return function(u,h){var f=t(r(u)),g=e(h),y=f.length,v,S;return g<0||g>=y?c?"":void 0:(v=s(f,g),v<55296||v>56319||g+1===y||(S=s(f,g+1))<56320||S>57343?c?o(f,g):v:c?i(f,g,g+2):(v-55296<<10)+(S-56320)+65536)}};return P0={codeAt:a(!1),charAt:a(!0)},P0}var C0,E2;function UB(){if(E2)return C0;E2=1;var n=BB().charAt;return C0=function(e,t,r){return t+(r?n(e,t).length:1)},C0}var I0,k2;function zA(){if(k2)return I0;k2=1;var n=wn(),e=Vd(),t=Math.floor,r=n("".charAt),o=n("".replace),s=n("".slice),i=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,a=/\$([$&'`]|\d{1,2})/g;return I0=function(c,u,h,f,g,y){var v=h+c.length,S=f.length,w=a;return g!==void 0&&(g=e(g),w=i),o(y,w,function(b,_){var T;switch(r(_,0)){case"$":return"$";case"&":return c;case"`":return s(u,0,h);case"'":return s(u,v);case"<":T=g[s(_,1,-1)];break;default:var E=+_;if(E===0)return b;if(E>S){var M=t(E/10);return M===0?b:M<=S?f[M-1]===void 0?r(_,1):f[M-1]+r(_,1):b}T=f[E-1]}return T===void 0?"":T})},I0}var E0,T2;function HB(){if(T2)return E0;T2=1;var n=Pi(),e=Pl(),t=cr(),r=Qc(),o=Hb(),s=TypeError;return E0=function(i,a){var c=i.exec;if(t(c)){var u=n(c,i,a);return u!==null&&e(u),u}if(r(i)==="RegExp")return n(o,i,a);throw new s("RegExp#exec called on incompatible receiver")},E0}var M2;function KB(){if(M2)return _2;M2=1;var n=$B(),e=Pi(),t=wn(),r=zB(),o=lr(),s=Pl(),i=cr(),a=Dg(),c=Cl(),u=AA(),h=Xd(),f=Jc(),g=UB(),y=Db(),v=zA(),S=HB(),w=Ci(),b=w("replace"),_=Math.max,T=Math.min,E=t([].concat),M=t([].push),A=t("".indexOf),R=t("".slice),L=function(V){return V===void 0?V:String(V)},K=function(){return"a".replace(/./,"$0")==="$0"}(),D=function(){return/./[b]?/./[b]("a","$0")==="":!1}(),U=!o(function(){var V=/./;return V.exec=function(){var F=[];return F.groups={a:"7"},F},"".replace(V,"$<a>")!=="7"});return r("replace",function(V,F,$){var H=D?"$":"$0";return[function(G,q){var Q=f(this),ae=a(G)?void 0:y(G,b);return ae?e(ae,G,Q,q):e(F,h(Q),G,q)},function(Z,G){var q=s(this),Q=h(Z);if(typeof G=="string"&&A(G,H)===-1&&A(G,"$<")===-1){var ae=$(F,q,Q,G);if(ae.done)return ae.value}var B=i(G);B||(G=h(G));var oe=q.global,pe;oe&&(pe=q.unicode,q.lastIndex=0);for(var _e=[],ue;ue=S(q,Q),!(ue===null||(M(_e,ue),!oe));){var Ne=h(ue[0]);Ne===""&&(q.lastIndex=g(Q,u(q.lastIndex),pe))}for(var Te="",we=0,Ie=0;Ie<_e.length;Ie++){ue=_e[Ie];for(var Ve=h(ue[0]),Xe=_(T(c(ue.index),Q.length),0),Zt=[],vt,Ut=1;Ut<ue.length;Ut++)M(Zt,L(ue[Ut]));var St=ue.groups;if(B){var It=E([Ve],Zt,Xe,Q);St!==void 0&&M(It,St),vt=h(n(G,void 0,It))}else vt=v(Ve,Q,Xe,Zt,St,G);Xe>=we&&(Te+=R(Q,we,Xe)+vt,we=Xe+Ve.length)}return Te+R(Q,we)}]},!U||!K||D),_2}var A2={},k0,j2;function WB(){if(j2)return k0;j2=1;var n=_l(),e=Qc(),t=Ci(),r=t("match");return k0=function(o){var s;return n(o)&&((s=o[r])!==void 0?!!s:e(o)==="RegExp")},k0}var T0,R2;function VB(){if(R2)return T0;R2=1;var n=Pi(),e=Pa(),t=mA(),r=NA(),o=RegExp.prototype;return T0=function(s){var i=s.flags;return i===void 0&&!("flags"in o)&&!e(s,"flags")&&t(o,s)?n(r,s):i},T0}var O2;function GB(){if(O2)return A2;O2=1;var n=eu(),e=Pi(),t=wn(),r=Jc(),o=cr(),s=Dg(),i=WB(),a=Xd(),c=Db(),u=VB(),h=zA(),f=Ci(),g=xA(),y=f("replace"),v=TypeError,S=t("".indexOf),w=t("".replace),b=t("".slice),_=Math.max;return n({target:"String",proto:!0},{replaceAll:function(E,M){var A=r(this),R,L,K,D,U,V,F,$,H,Z,G=0,q="";if(!s(E)){if(R=i(E),R&&(L=a(r(u(E))),!~S(L,"g")))throw new v("`.replaceAll` does not allow non-global regexes");if(K=c(E,y),K)return e(K,E,A,M);if(g&&R)return w(a(A),E,M)}for(D=a(A),U=a(E),V=o(M),V||(M=a(M)),F=U.length,$=_(1,F),H=S(D,U);H!==-1;)Z=V?a(M(U,H,D)):h(U,D,H,[],void 0,M),q+=b(D,G,H)+Z,G=H+F,H=H+$>D.length?-1:S(D,U,H+$);return G<D.length&&(q+=b(D,G)),q}}),A2}var M0,D2;function qB(){if(D2)return M0;D2=1,$A(),KB(),GB();var n=Yd();return M0=n("String","replaceAll"),M0}var A0,L2;function YB(){if(L2)return A0;L2=1;var n=qB();return A0=n,A0}YB();function BA(n){return n&&typeof n=="object"&&"parents"in n}function UA(n){for(let e=0,t=n.parents.length;e<t;e++)if(n.parents[e].__unsafe__getWithoutCapture(!0),n.parents[e].lastChangedEpoch!==n.parentEpochs[e])return!0;return!1}function Gf(n,e){if(n.children.remove(e)&&n.children.isEmpty&&BA(n))for(let t=0,r=n.parents.length;t<r;t++)Gf(n.parents[t],n)}function Kb(n,e){if(n.children.add(e)&&BA(n))for(let t=0,r=n.parents.length;t<r;t++)Kb(n.parents[t],n)}function HA(n,e){return n===e||Object.is(n,e)||!!(n&&e&&typeof n.equals=="function"&&n.equals(e))}function Ca(n,e){const t=Symbol.for(`com.tldraw.state/${n}`),r=globalThis;return r[t]??(r[t]=e()),r[t]}const gi=Ca("empty_array",()=>Object.freeze([])),F2=8;class qf{constructor(){j(this,"arraySize",0);j(this,"array",Array(F2));j(this,"set",null)}get isEmpty(){if(this.array)return this.arraySize===0;if(this.set)return this.set.size===0;throw new Error("no set or array")}add(e){if(this.array)return this.array.indexOf(e)!==-1?!1:this.arraySize<F2?(this.array[this.arraySize]=e,this.arraySize++,!0):(this.set=new Set(this.array),this.array=null,this.set.add(e),!0);if(this.set)return this.set.has(e)?!1:(this.set.add(e),!0);throw new Error("no set or array")}remove(e){if(this.array){const t=this.array.indexOf(e);return t===-1?!1:(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return this.set.has(e)?(this.set.delete(e),!0):!1;throw new Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){const r=this.array[t];typeof r<"u"&&e(r)}return}if(this.set){this.set.forEach(e);return}throw new Error("no set or array")}has(e){return this.array?this.array.indexOf(e)!==-1:this.set.has(e)}clear(){this.set?this.set.clear():(this.arraySize=0,this.array=[])}size(){return this.set?this.set.size:this.arraySize}}const eo=Symbol.for("com.tldraw.state/RESET_VALUE");class KA{constructor(e){j(this,"index",0);j(this,"buffer");this.capacity=e,this.buffer=new Array(e)}pushEntry(e,t,r){if(r!==void 0){if(r===eo){this.clear();return}this.buffer[this.index]=[e,t,r],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){const{index:t,capacity:r,buffer:o}=this;for(let s=0;s<r;s++){const i=(t-1+r-s)%r,a=o[i];if(!a)return eo;const[c,u]=a;if(s===0&&e>=u)return[];if(c<=e&&e<u){const h=s+1,f=new Array(h);for(let g=0;g<h;g++)f[g]=o[(i+g)%r][2];return f}}return eo}}class XB{constructor(e,t){j(this,"offset",0);j(this,"maybeRemoved");this.below=e,this.child=t}}const Kt=Ca("capture",()=>({stack:null}));function Pp(n){const e=Kt.stack;Kt.stack=null;try{return n()}finally{Kt.stack=e}}function WA(n){Kt.stack=new XB(Kt.stack,n),n.parentSet.clear()}function VA(){const n=Kt.stack;if(Kt.stack=n.below,n.offset<n.child.parents.length){for(let e=n.offset;e<n.child.parents.length;e++){const t=n.child.parents[e];n.child.parentSet.has(t)||Gf(t,n.child)}n.child.parents.length=n.offset,n.child.parentEpochs.length=n.offset}if(n.maybeRemoved)for(let e=0;e<n.maybeRemoved.length;e++){const t=n.maybeRemoved[e];n.child.parentSet.has(t)||Gf(t,n.child)}}function Yf(n){if(Kt.stack){if(Kt.stack.child.parentSet.has(n))return;if(Kt.stack.child.parentSet.add(n),Kt.stack.child.isActivelyListening&&Kb(n,Kt.stack.child),Kt.stack.offset<Kt.stack.child.parents.length){const t=Kt.stack.child.parents[Kt.stack.offset];t!==n&&(Kt.stack.maybeRemoved?Kt.stack.maybeRemoved.push(t):Kt.stack.maybeRemoved=[t])}Kt.stack.child.parents[Kt.stack.offset]=n,Kt.stack.child.parentEpochs[Kt.stack.offset]=n.lastChangedEpoch,Kt.stack.offset++}}const ca=-1;class ZB{constructor(e,t,r){j(this,"_isActivelyListening",!1);j(this,"lastTraversedEpoch",ca);j(this,"lastReactedEpoch",ca);j(this,"_scheduleCount",0);j(this,"parentSet",new qf);j(this,"parentEpochs",[]);j(this,"parents",[]);j(this,"_scheduleEffect");j(this,"maybeExecute",()=>{this._isActivelyListening&&this.execute()});this.name=e,this.runEffect=t,this._scheduleEffect=r==null?void 0:r.scheduleEffect}get isActivelyListening(){return this._isActivelyListening}get scheduleCount(){return this._scheduleCount}maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==kr()){if(this.parents.length&&!UA(this)){this.lastReactedEpoch=kr();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)Kb(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)Gf(this.parents[e],this)}execute(){try{WA(this);const e=kr(),t=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=e,t}finally{VA()}}}const tu=Ca("EffectScheduler",()=>ZB);function Ms(n,e,t){const r=new tu(n,e,t);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function QB(n,e,t){const r=new tu(n,e,t);return{scheduler:r,start:o=>{const s=(o==null?void 0:o.force)??!1;r.attach(),s?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}class JB{constructor(e){j(this,"initialAtomValues",new Map);this.parent=e}get isRoot(){return this.parent===null}commit(){if(mt.globalIsReacting)for(const e of this.initialAtomValues.keys())qA(e);else this.isRoot?GA(this.initialAtomValues.keys()):this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){mt.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{var r;t.set(e),(r=t.historyBuffer)==null||r.clear()}),this.commit()}}const mt=Ca("transactions",()=>({globalEpoch:ca+1,globalIsReacting:!1,currentTransaction:null,cleanupReactors:null,reactionEpoch:ca+1}));function e9(){return mt.reactionEpoch}function kr(){return mt.globalEpoch}function t9(){return mt.globalIsReacting}function Wb(n,e){e.lastTraversedEpoch!==mt.globalEpoch&&(e.lastTraversedEpoch=mt.globalEpoch,e instanceof tu?n.add(e):e.children.visit(t=>Wb(n,t)))}function GA(n){var t;if(mt.globalIsReacting)throw new Error("flushChanges cannot be called during a reaction");const e=mt.currentTransaction;try{mt.currentTransaction=null,mt.globalIsReacting=!0,mt.reactionEpoch=mt.globalEpoch;const r=new Set;for(const s of n)s.children.visit(i=>Wb(r,i));for(const s of r)s.maybeScheduleEffect();let o=0;for(;(t=mt.cleanupReactors)!=null&&t.size;){if(o++>1e3)throw new Error("Reaction update depth limit exceeded");const s=mt.cleanupReactors;mt.cleanupReactors=null;for(const i of s)i.maybeScheduleEffect()}}finally{mt.cleanupReactors=null,mt.globalIsReacting=!1,mt.currentTransaction=e}}function n9(n,e){mt.currentTransaction?mt.currentTransaction.initialAtomValues.has(n)||mt.currentTransaction.initialAtomValues.set(n,e):mt.globalIsReacting?qA(n):GA([n])}function qA(n){const e=mt.cleanupReactors??(mt.cleanupReactors=new Set);n.children.visit(t=>Wb(e,t))}function r9(){mt.globalEpoch++}function o9(n){const e=new JB(mt.currentTransaction);mt.currentTransaction=e;try{let t,r=!1;try{t=n(()=>r=!0)}catch(o){throw e.abort(),o}return r?e.abort():e.commit(),t}finally{mt.currentTransaction=mt.currentTransaction.parent}}function As(n){return mt.currentTransaction?n():o9(n)}class s9{constructor(e,t,r){j(this,"isEqual");j(this,"computeDiff");j(this,"lastChangedEpoch",kr());j(this,"children",new qf);j(this,"historyBuffer");this.name=e,this.current=t,this.isEqual=(r==null?void 0:r.isEqual)??null,r&&(r.historyLength&&(this.historyBuffer=new KA(r.historyLength)),this.computeDiff=r.computeDiff)}__unsafe__getWithoutCapture(e){return this.current}get(){return Yf(this),this.current}set(e,t){var o,s;if(((o=this.isEqual)==null?void 0:o.call(this,this.current,e))??HA(this.current,e))return this.current;r9(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,kr(),t??((s=this.computeDiff)==null?void 0:s.call(this,this.current,e,this.lastChangedEpoch,kr()))??eo),this.lastChangedEpoch=kr();const r=this.current;return this.current=e,n9(this,r),e}update(e){return this.set(e(this.current))}getDiffSince(e){var t;return Yf(this),e>=this.lastChangedEpoch?gi:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??eo}}const i9=Ca("Atom",()=>s9);function dn(n,e,t){return new i9(n,e,t)}let N2=!1;function a9(){N2||(N2=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}const cd=Symbol.for("com.tldraw.state/UNINITIALIZED");function il(n){return n===cd}const sw=Ca("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function ud(n,e){return new sw(n,e)}class l9{constructor(e,t,r){j(this,"lastChangedEpoch",ca);j(this,"lastTraversedEpoch",ca);j(this,"lastCheckedEpoch",ca);j(this,"parentSet",new qf);j(this,"parents",[]);j(this,"parentEpochs",[]);j(this,"children",new qf);j(this,"historyBuffer");j(this,"state",cd);j(this,"error",null);j(this,"computeDiff");j(this,"isEqual");this.name=e,this.derive=t,r!=null&&r.historyLength&&(this.historyBuffer=new KA(r.historyLength)),this.computeDiff=r==null?void 0:r.computeDiff,this.isEqual=(r==null?void 0:r.isEqual)??HA}get isActivelyListening(){return!this.children.isEmpty}__unsafe__getWithoutCapture(e){var o;const t=this.lastChangedEpoch===ca,r=kr();if(!t&&(this.lastCheckedEpoch===r||this.isActivelyListening&&t9()&&this.lastTraversedEpoch<e9()||!UA(this)))if(this.lastCheckedEpoch=r,this.error){if(e)return this.state;throw this.error.thrownValue}else return this.state;try{WA(this);const s=this.derive(this.state,this.lastCheckedEpoch),i=s instanceof sw?s.value:s,a=this.state===cd;if(a||!this.isEqual(i,this.state)){if(this.historyBuffer&&!a){const c=s instanceof sw?s.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,kr(),c??((o=this.computeDiff)==null?void 0:o.call(this,this.state,i,this.lastCheckedEpoch,kr()))??eo)}this.lastChangedEpoch=kr(),this.state=i}return this.error=null,this.lastCheckedEpoch=kr(),this.state}catch(s){if(this.state!==cd&&(this.state=cd,this.lastChangedEpoch=kr()),this.lastCheckedEpoch=kr(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:s},!e)throw s;return this.state}finally{VA()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{Yf(this)}}getDiffSince(e){var t;return this.__unsafe__getWithoutCapture(!0),Yf(this),e>=this.lastChangedEpoch?gi:((t=this.historyBuffer)==null?void 0:t.getChangesSince(e))??eo}}const Ng=Ca("Computed",()=>l9);function c9(n={},e,t,r){const o=r.value,s=Symbol.for("__@tldraw/state__computed__"+t);return r.value=function(){let i=this[s];return i||(i=new Ng(t,o.bind(this),n),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:i})),i.get()},r.value[YA]=!0,r}function u9(n={},e,t,r){const o=r.get,s=Symbol.for("__@tldraw/state__computed__"+t);return r.get=function(){let i=this[s];return i||(i=new Ng(t,o.bind(this),n),Object.defineProperty(this,s,{enumerable:!1,configurable:!1,writable:!1,value:i})),i.get()},r}function d9(n,e,t){yt(t.kind==="method","@computed can only be used on methods");const r=Symbol.for("__@tldraw/state__computed__"+String(t.name)),o=function(){let s=this[r];return s||(s=new Ng(String(t.name),e.bind(this),n),Object.defineProperty(this,r,{enumerable:!1,configurable:!1,writable:!1,value:s})),s.get()};return o[YA]=!0,o}function $2(n={},e){if(e.length===2){const[t,r]=e;return d9(n,t,r)}else{const[t,r,o]=e;return o.get?(a9(),u9(n,t,r,o)):c9(n,t,r,o)}}const YA="@@__isComputedMethod__@@";function ce(){if(arguments.length===1){const n=arguments[0];return(...e)=>$2(n,e)}else return typeof arguments[0]=="string"?new Ng(arguments[0],arguments[1],arguments[2]):$2(void 0,arguments)}const XA=1,h9=Ca("apiVersion",()=>XA);if(h9!==XA)throw new Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");ba("@tldraw/state","3.6.0","esm");var j0={exports:{}},tt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var z2;function p9(){if(z2)return tt;z2=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),r=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),i=Symbol.for("react.context"),a=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),u=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),f=Symbol.iterator;function g(B){return B===null||typeof B!="object"?null:(B=f&&B[f]||B["@@iterator"],typeof B=="function"?B:null)}var y={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,S={};function w(B,oe,pe){this.props=B,this.context=oe,this.refs=S,this.updater=pe||y}w.prototype.isReactComponent={},w.prototype.setState=function(B,oe){if(typeof B!="object"&&typeof B!="function"&&B!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,B,oe,"setState")},w.prototype.forceUpdate=function(B){this.updater.enqueueForceUpdate(this,B,"forceUpdate")};function b(){}b.prototype=w.prototype;function _(B,oe,pe){this.props=B,this.context=oe,this.refs=S,this.updater=pe||y}var T=_.prototype=new b;T.constructor=_,v(T,w.prototype),T.isPureReactComponent=!0;var E=Array.isArray,M=Object.prototype.hasOwnProperty,A={current:null},R={key:!0,ref:!0,__self:!0,__source:!0};function L(B,oe,pe){var _e,ue={},Ne=null,Te=null;if(oe!=null)for(_e in oe.ref!==void 0&&(Te=oe.ref),oe.key!==void 0&&(Ne=""+oe.key),oe)M.call(oe,_e)&&!R.hasOwnProperty(_e)&&(ue[_e]=oe[_e]);var we=arguments.length-2;if(we===1)ue.children=pe;else if(1<we){for(var Ie=Array(we),Ve=0;Ve<we;Ve++)Ie[Ve]=arguments[Ve+2];ue.children=Ie}if(B&&B.defaultProps)for(_e in we=B.defaultProps,we)ue[_e]===void 0&&(ue[_e]=we[_e]);return{$$typeof:n,type:B,key:Ne,ref:Te,props:ue,_owner:A.current}}function K(B,oe){return{$$typeof:n,type:B.type,key:oe,ref:B.ref,props:B.props,_owner:B._owner}}function D(B){return typeof B=="object"&&B!==null&&B.$$typeof===n}function U(B){var oe={"=":"=0",":":"=2"};return"$"+B.replace(/[=:]/g,function(pe){return oe[pe]})}var V=/\/+/g;function F(B,oe){return typeof B=="object"&&B!==null&&B.key!=null?U(""+B.key):oe.toString(36)}function $(B,oe,pe,_e,ue){var Ne=typeof B;(Ne==="undefined"||Ne==="boolean")&&(B=null);var Te=!1;if(B===null)Te=!0;else switch(Ne){case"string":case"number":Te=!0;break;case"object":switch(B.$$typeof){case n:case e:Te=!0}}if(Te)return Te=B,ue=ue(Te),B=_e===""?"."+F(Te,0):_e,E(ue)?(pe="",B!=null&&(pe=B.replace(V,"$&/")+"/"),$(ue,oe,pe,"",function(Ve){return Ve})):ue!=null&&(D(ue)&&(ue=K(ue,pe+(!ue.key||Te&&Te.key===ue.key?"":(""+ue.key).replace(V,"$&/")+"/")+B)),oe.push(ue)),1;if(Te=0,_e=_e===""?".":_e+":",E(B))for(var we=0;we<B.length;we++){Ne=B[we];var Ie=_e+F(Ne,we);Te+=$(Ne,oe,pe,Ie,ue)}else if(Ie=g(B),typeof Ie=="function")for(B=Ie.call(B),we=0;!(Ne=B.next()).done;)Ne=Ne.value,Ie=_e+F(Ne,we++),Te+=$(Ne,oe,pe,Ie,ue);else if(Ne==="object")throw oe=String(B),Error("Objects are not valid as a React child (found: "+(oe==="[object Object]"?"object with keys {"+Object.keys(B).join(", ")+"}":oe)+"). If you meant to render a collection of children, use an array instead.");return Te}function H(B,oe,pe){if(B==null)return B;var _e=[],ue=0;return $(B,_e,"","",function(Ne){return oe.call(pe,Ne,ue++)}),_e}function Z(B){if(B._status===-1){var oe=B._result;oe=oe(),oe.then(function(pe){(B._status===0||B._status===-1)&&(B._status=1,B._result=pe)},function(pe){(B._status===0||B._status===-1)&&(B._status=2,B._result=pe)}),B._status===-1&&(B._status=0,B._result=oe)}if(B._status===1)return B._result.default;throw B._result}var G={current:null},q={transition:null},Q={ReactCurrentDispatcher:G,ReactCurrentBatchConfig:q,ReactCurrentOwner:A};function ae(){throw Error("act(...) is not supported in production builds of React.")}return tt.Children={map:H,forEach:function(B,oe,pe){H(B,function(){oe.apply(this,arguments)},pe)},count:function(B){var oe=0;return H(B,function(){oe++}),oe},toArray:function(B){return H(B,function(oe){return oe})||[]},only:function(B){if(!D(B))throw Error("React.Children.only expected to receive a single React element child.");return B}},tt.Component=w,tt.Fragment=t,tt.Profiler=o,tt.PureComponent=_,tt.StrictMode=r,tt.Suspense=c,tt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Q,tt.act=ae,tt.cloneElement=function(B,oe,pe){if(B==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+B+".");var _e=v({},B.props),ue=B.key,Ne=B.ref,Te=B._owner;if(oe!=null){if(oe.ref!==void 0&&(Ne=oe.ref,Te=A.current),oe.key!==void 0&&(ue=""+oe.key),B.type&&B.type.defaultProps)var we=B.type.defaultProps;for(Ie in oe)M.call(oe,Ie)&&!R.hasOwnProperty(Ie)&&(_e[Ie]=oe[Ie]===void 0&&we!==void 0?we[Ie]:oe[Ie])}var Ie=arguments.length-2;if(Ie===1)_e.children=pe;else if(1<Ie){we=Array(Ie);for(var Ve=0;Ve<Ie;Ve++)we[Ve]=arguments[Ve+2];_e.children=we}return{$$typeof:n,type:B.type,key:ue,ref:Ne,props:_e,_owner:Te}},tt.createContext=function(B){return B={$$typeof:i,_currentValue:B,_currentValue2:B,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},B.Provider={$$typeof:s,_context:B},B.Consumer=B},tt.createElement=L,tt.createFactory=function(B){var oe=L.bind(null,B);return oe.type=B,oe},tt.createRef=function(){return{current:null}},tt.forwardRef=function(B){return{$$typeof:a,render:B}},tt.isValidElement=D,tt.lazy=function(B){return{$$typeof:h,_payload:{_status:-1,_result:B},_init:Z}},tt.memo=function(B,oe){return{$$typeof:u,type:B,compare:oe===void 0?null:oe}},tt.startTransition=function(B){var oe=q.transition;q.transition={};try{B()}finally{q.transition=oe}},tt.unstable_act=ae,tt.useCallback=function(B,oe){return G.current.useCallback(B,oe)},tt.useContext=function(B){return G.current.useContext(B)},tt.useDebugValue=function(){},tt.useDeferredValue=function(B){return G.current.useDeferredValue(B)},tt.useEffect=function(B,oe){return G.current.useEffect(B,oe)},tt.useId=function(){return G.current.useId()},tt.useImperativeHandle=function(B,oe,pe){return G.current.useImperativeHandle(B,oe,pe)},tt.useInsertionEffect=function(B,oe){return G.current.useInsertionEffect(B,oe)},tt.useLayoutEffect=function(B,oe){return G.current.useLayoutEffect(B,oe)},tt.useMemo=function(B,oe){return G.current.useMemo(B,oe)},tt.useReducer=function(B,oe,pe){return G.current.useReducer(B,oe,pe)},tt.useRef=function(B){return G.current.useRef(B)},tt.useState=function(B){return G.current.useState(B)},tt.useSyncExternalStore=function(B,oe,pe){return G.current.useSyncExternalStore(B,oe,pe)},tt.useTransition=function(){return G.current.useTransition()},tt.version="18.3.1",tt}var B2;function Vb(){return B2||(B2=1,j0.exports=p9()),j0.exports}var C=Vb();const at=wa(C),f9=cz({__proto__:null,default:at},[C]);function $g(n,e){const t=at.useRef(e);t.current=e;const[r,o,s]=at.useMemo(()=>{let i=null;const a=h=>(i=h,()=>{i=null}),c=new tu(`useStateTracking(${n})`,()=>{var h;return(h=t.current)==null?void 0:h.call(t)},{scheduleEffect(){i==null||i()}});return[c,a,()=>c.scheduleCount]},[n]);return at.useSyncExternalStore(o,s,s),at.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}const U2={apply(n,e,t){return $g(n.displayName??n.name??"tracked(???)",()=>n.apply(e,t))}},g9=Symbol.for("react.memo"),m9=Symbol.for("react.forward_ref");function On(n){let e=null;const t=n.$$typeof;return t===g9&&(n=n.type,e=n.compare),t===m9?C.memo(C.forwardRef(new Proxy(n.render,U2))):C.memo(new Proxy(n,U2),e)}function Gb(n,e,t){return C.useState(()=>{const r=typeof e=="function"?e():e;return dn(`useAtom(${n})`,r,t)})[0]}function y9(){const n=arguments[0],e=arguments[1],t=arguments.length===3?void 0:arguments[2],r=arguments.length===3?arguments[2]:arguments[3];return C.useMemo(()=>ce(`useComputed(${n})`,e,t),r)}function ha(n,e,t=gi){C.useEffect(()=>{const r=new tu(n,e);return r.attach(),r.execute(),()=>{r.detach()}},t)}function re(){const n=arguments,e=n.length===3?n[2]:[n[0]],t=n.length===3?n[0]:`useValue(${n[0].name})`,r=C.useRef(!0);r.current=!0;const o=C.useMemo(()=>n.length===1?n[0]:ce(t,()=>{if(r.current)return n[1]();try{return n[1]()}catch{return{}}}),e);try{const{subscribe:s,getSnapshot:i}=C.useMemo(()=>({subscribe:a=>Ms(`useValue(${t})`,()=>{o.get(),a()}),getSnapshot:()=>o.get()}),[o]);return C.useSyncExternalStore(s,i,i)}finally{r.current=!1}}ba("@tldraw/state-react","3.6.0","esm");class lf{constructor(e){j(this,"nextValue");j(this,"diff");this.previousValue=e}get(){var r,o,s,i;const e=((o=(r=this.diff)==null?void 0:r.removed)==null?void 0:o.size)??0,t=((i=(s=this.diff)==null?void 0:s.added)==null?void 0:i.size)??0;if(!(e===0&&t===0))return{value:this.nextValue,diff:this.diff}}_add(e,t){var r,o;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.add(e),this.diff??(this.diff={}),t?(r=this.diff.removed)==null||r.delete(e):((o=this.diff).added??(o.added=new Set),this.diff.added.add(e))}add(e){var o,s,i;const t=this.previousValue.has(e);if(t)return((s=(o=this.diff)==null?void 0:o.removed)==null?void 0:s.has(e))?this._add(e,t):void 0;(i=this.nextValue)!=null&&i.has(e)||this._add(e,t)}_remove(e,t){var r,o;this.nextValue??(this.nextValue=new Set(this.previousValue)),this.nextValue.delete(e),this.diff??(this.diff={}),t?((r=this.diff).removed??(r.removed=new Set),this.diff.removed.add(e)):(o=this.diff.added)==null||o.delete(e)}remove(e){var o,s,i,a;const t=this.previousValue.has(e);if(!t)return((s=(o=this.diff)==null?void 0:o.added)==null?void 0:s.has(e))?this._remove(e,t):void 0;(a=(i=this.diff)==null?void 0:i.removed)!=null&&a.has(e)||this._remove(e,t)}}class zg{constructor(e,t){j(this,"createDefaultProperties");j(this,"validator");j(this,"ephemeralKeys");j(this,"ephemeralKeySet");j(this,"scope");this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.validator=t.validator??{validate:o=>o},this.scope=t.scope??"document",this.ephemeralKeys=t.ephemeralKeys;const r=new Set;if(t.ephemeralKeys)for(const[o,s]of Lr(t.ephemeralKeys))s&&r.add(o);this.ephemeralKeySet=r}create(e){const t={...this.createDefaultProperties(),id:this.createId()};for(const[r,o]of Object.entries(e))o!==void 0&&(t[r]=o);return t.typeName=this.typeName,t}clone(e){return{...zt(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??bt())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw new Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance(e){return(e==null?void 0:e.typeName)===this.typeName}isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return e[this.typeName.length]===":"}withDefaultProperties(e){return new zg(this.typeName,{createDefaultProperties:e,validator:this.validator,scope:this.scope,ephemeralKeys:this.ephemeralKeys})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}}function Us(n,e){return new zg(n,{createDefaultProperties:()=>({}),validator:e.validator,scope:e.scope,ephemeralKeys:e.ephemeralKeys})}function Xf(){return{added:{},updated:{},removed:{}}}function iw(n){const e={added:n.removed,removed:n.added,updated:{}};for(const[t,r]of Object.values(n.updated))e.updated[t.id]=[r,t];return e}function ZA(n){return Object.keys(n.added).length===0&&Object.keys(n.updated).length===0&&Object.keys(n.removed).length===0}function qb(n){const e={added:{},removed:{},updated:{}};return xd(e,n),e}function xd(n,e){for(const t of e){for(const[r,o]of Lr(t.added))if(n.removed[r]){const s=n.removed[r];delete n.removed[r],s!==o&&(n.updated[r]=[s,o])}else n.added[r]=o;for(const[r,[o,s]]of Lr(t.updated)){if(n.added[r]){n.added[r]=s,delete n.updated[r],delete n.removed[r];continue}if(n.updated[r]){n.updated[r]=[n.updated[r][0],s],delete n.removed[r];continue}n.updated[r]=t.updated[r],delete n.removed[r]}for(const[r,o]of Lr(t.removed))n.added[r]?delete n.added[r]:n.updated[r]?(n.removed[r]=n.updated[r][0],delete n.updated[r]):n.removed[r]=o}}var dd={exports:{}};dd.exports;var H2;function v9(){return H2||(H2=1,function(n,e){var t=200,r="__lodash_hash_undefined__",o=1,s=2,i=9007199254740991,a="[object Arguments]",c="[object Array]",u="[object AsyncFunction]",h="[object Boolean]",f="[object Date]",g="[object Error]",y="[object Function]",v="[object GeneratorFunction]",S="[object Map]",w="[object Number]",b="[object Null]",_="[object Object]",T="[object Promise]",E="[object Proxy]",M="[object RegExp]",A="[object Set]",R="[object String]",L="[object Symbol]",K="[object Undefined]",D="[object WeakMap]",U="[object ArrayBuffer]",V="[object DataView]",F="[object Float32Array]",$="[object Float64Array]",H="[object Int8Array]",Z="[object Int16Array]",G="[object Int32Array]",q="[object Uint8Array]",Q="[object Uint8ClampedArray]",ae="[object Uint16Array]",B="[object Uint32Array]",oe=/[\\^$.*+?()[\]{}|]/g,pe=/^\[object .+?Constructor\]$/,_e=/^(?:0|[1-9]\d*)$/,ue={};ue[F]=ue[$]=ue[H]=ue[Z]=ue[G]=ue[q]=ue[Q]=ue[ae]=ue[B]=!0,ue[a]=ue[c]=ue[U]=ue[h]=ue[V]=ue[f]=ue[g]=ue[y]=ue[S]=ue[w]=ue[_]=ue[M]=ue[A]=ue[R]=ue[D]=!1;var Ne=typeof Rr=="object"&&Rr&&Rr.Object===Object&&Rr,Te=typeof self=="object"&&self&&self.Object===Object&&self,we=Ne||Te||Function("return this")(),Ie=e&&!e.nodeType&&e,Ve=Ie&&!0&&n&&!n.nodeType&&n,Xe=Ve&&Ve.exports===Ie,Zt=Xe&&Ne.process,vt=function(){try{return Zt&&Zt.binding&&Zt.binding("util")}catch{}}(),Ut=vt&&vt.isTypedArray;function St(N,X){for(var de=-1,ke=N==null?0:N.length,wt=0,Ye=[];++de<ke;){var Mt=N[de];X(Mt,de,N)&&(Ye[wt++]=Mt)}return Ye}function It(N,X){for(var de=-1,ke=X.length,wt=N.length;++de<ke;)N[wt+de]=X[de];return N}function tr(N,X){for(var de=-1,ke=N==null?0:N.length;++de<ke;)if(X(N[de],de,N))return!0;return!1}function ls(N,X){for(var de=-1,ke=Array(N);++de<N;)ke[de]=X(de);return ke}function fr(N){return function(X){return N(X)}}function co(N,X){return N.has(X)}function uo(N,X){return N==null?void 0:N[X]}function Ra(N){var X=-1,de=Array(N.size);return N.forEach(function(ke,wt){de[++X]=[wt,ke]}),de}function Tl(N,X){return function(de){return N(X(de))}}function Ml(N){var X=-1,de=Array(N.size);return N.forEach(function(ke){de[++X]=ke}),de}var Al=Array.prototype,jl=Function.prototype,cs=Object.prototype,Oo=we["__core-js_shared__"],Oa=jl.toString,ie=cs.hasOwnProperty,Se=function(){var N=/[^.]+$/.exec(Oo&&Oo.keys&&Oo.keys.IE_PROTO||"");return N?"Symbol(src)_1."+N:""}(),Ke=cs.toString,_t=RegExp("^"+Oa.call(ie).replace(oe,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ho=Xe?we.Buffer:void 0,gr=we.Symbol,Vs=we.Uint8Array,Br=cs.propertyIsEnumerable,Ur=Al.splice,mr=gr?gr.toStringTag:void 0,Hr=Object.getOwnPropertySymbols,yr=ho?ho.isBuffer:void 0,Do=Tl(Object.keys,Object),Rl=Ys(we,"DataView"),Ai=Ys(we,"Map"),Ol=Ys(we,"Promise"),Dl=Ys(we,"Set"),Ll=Ys(we,"WeakMap"),Gs=Ys(Object,"create"),Sh=Fn(Rl),Da=Fn(Ai),du=Fn(Ol),La=Fn(Dl),Hm=Fn(Ll),ji=gr?gr.prototype:void 0,Ri=ji?ji.valueOf:void 0;function po(N){var X=-1,de=N==null?0:N.length;for(this.clear();++X<de;){var ke=N[X];this.set(ke[0],ke[1])}}function hu(){this.__data__=Gs?Gs(null):{},this.size=0}function Km(N){var X=this.has(N)&&delete this.__data__[N];return this.size-=X?1:0,X}function Wm(N){var X=this.__data__;if(Gs){var de=X[N];return de===r?void 0:de}return ie.call(X,N)?X[N]:void 0}function Vm(N){var X=this.__data__;return Gs?X[N]!==void 0:ie.call(X,N)}function qs(N,X){var de=this.__data__;return this.size+=this.has(N)?0:1,de[N]=Gs&&X===void 0?r:X,this}po.prototype.clear=hu,po.prototype.delete=Km,po.prototype.get=Wm,po.prototype.has=Vm,po.prototype.set=qs;function fo(N){var X=-1,de=N==null?0:N.length;for(this.clear();++X<de;){var ke=N[X];this.set(ke[0],ke[1])}}function xh(){this.__data__=[],this.size=0}function Gm(N){var X=this.__data__,de=$l(X,N);if(de<0)return!1;var ke=X.length-1;return de==ke?X.pop():Ur.call(X,de,1),--this.size,!0}function wh(N){var X=this.__data__,de=$l(X,N);return de<0?void 0:X[de][1]}function bh(N){return $l(this.__data__,N)>-1}function _h(N,X){var de=this.__data__,ke=$l(de,N);return ke<0?(++this.size,de.push([N,X])):de[ke][1]=X,this}fo.prototype.clear=xh,fo.prototype.delete=Gm,fo.prototype.get=wh,fo.prototype.has=bh,fo.prototype.set=_h;function us(N){var X=-1,de=N==null?0:N.length;for(this.clear();++X<de;){var ke=N[X];this.set(ke[0],ke[1])}}function qm(){this.size=0,this.__data__={hash:new po,map:new(Ai||fo),string:new po}}function Ym(N){var X=ut(this,N).delete(N);return this.size-=X?1:0,X}function Wt(N){return ut(this,N).get(N)}function Xm(N){return ut(this,N).has(N)}function pu(N,X){var de=ut(this,N),ke=de.size;return de.set(N,X),this.size+=de.size==ke?0:1,this}us.prototype.clear=qm,us.prototype.delete=Ym,us.prototype.get=Wt,us.prototype.has=Xm,us.prototype.set=pu;function Fa(N){var X=-1,de=N==null?0:N.length;for(this.__data__=new us;++X<de;)this.add(N[X])}function Fl(N){return this.__data__.set(N,r),this}function Zm(N){return this.__data__.has(N)}Fa.prototype.add=Fa.prototype.push=Fl,Fa.prototype.has=Zm;function Lo(N){var X=this.__data__=new fo(N);this.size=X.size}function Nl(){this.__data__=new fo,this.size=0}function go(N){var X=this.__data__,de=X.delete(N);return this.size=X.size,de}function Qm(N){return this.__data__.get(N)}function Kr(N){return this.__data__.has(N)}function Jm(N,X){var de=this.__data__;if(de instanceof fo){var ke=de.__data__;if(!Ai||ke.length<t-1)return ke.push([N,X]),this.size=++de.size,this;de=this.__data__=new us(ke)}return de.set(N,X),this.size=de.size,this}Lo.prototype.clear=Nl,Lo.prototype.delete=go,Lo.prototype.get=Qm,Lo.prototype.has=Kr,Lo.prototype.set=Jm;function ey(N,X){var de=ps(N),ke=!de&&za(N),wt=!de&&!ke&&yu(N),Ye=!de&&!ke&&!wt&&Su(N),Mt=de||ke||wt||Ye,tn=Mt?ls(N.length,String):[],At=tn.length;for(var Et in N)ie.call(N,Et)&&!(Mt&&(Et=="length"||wt&&(Et=="offset"||Et=="parent")||Ye&&(Et=="buffer"||Et=="byteLength"||Et=="byteOffset")||Ih(Et,At)))&&tn.push(Et);return tn}function $l(N,X){for(var de=N.length;de--;)if(No(N[de][0],X))return de;return-1}function zl(N,X,de){var ke=X(N);return ps(N)?ke:It(ke,de(N))}function ds(N){return N==null?N===void 0?K:b:mr&&mr in Object(N)?Ch(N):hs(N)}function Oi(N){return gs(N)&&ds(N)==a}function Na(N,X,de,ke,wt){return N===X?!0:N==null||X==null||!gs(N)&&!gs(X)?N!==N&&X!==X:ty(N,X,de,ke,Na,wt)}function ty(N,X,de,ke,wt,Ye){var Mt=ps(N),tn=ps(X),At=Mt?c:Fo(N),Et=tn?c:Fo(X);At=At==a?_:At,Et=Et==a?_:Et;var gn=At==_,vr=Et==_,nn=At==Et;if(nn&&yu(N)){if(!yu(X))return!1;Mt=!0,gn=!1}if(nn&&!gn)return Ye||(Ye=new Lo),Mt||Su(N)?Bl(N,X,de,ke,wt,Ye):$a(N,X,At,de,ke,wt,Ye);if(!(de&o)){var bn=gn&&ie.call(N,"__wrapped__"),nr=vr&&ie.call(X,"__wrapped__");if(bn||nr){var Qt=bn?N.value():N,Nn=nr?X.value():X;return Ye||(Ye=new Lo),wt(Qt,Nn,de,ke,Ye)}}return nn?(Ye||(Ye=new Lo),ry(N,X,de,ke,wt,Ye)):!1}function ny(N){if(!vu(N)||mu(N))return!1;var X=Di(N)?_t:pe;return X.test(Fn(N))}function fu(N){return gs(N)&&Th(N.length)&&!!ue[ds(N)]}function Ph(N){if(!Hl(N))return Do(N);var X=[];for(var de in Object(N))ie.call(N,de)&&de!="constructor"&&X.push(de);return X}function Bl(N,X,de,ke,wt,Ye){var Mt=de&o,tn=N.length,At=X.length;if(tn!=At&&!(Mt&&At>tn))return!1;var Et=Ye.get(N);if(Et&&Ye.get(X))return Et==X;var gn=-1,vr=!0,nn=de&s?new Fa:void 0;for(Ye.set(N,X),Ye.set(X,N);++gn<tn;){var bn=N[gn],nr=X[gn];if(ke)var Qt=Mt?ke(nr,bn,gn,X,N,Ye):ke(bn,nr,gn,N,X,Ye);if(Qt!==void 0){if(Qt)continue;vr=!1;break}if(nn){if(!tr(X,function(Nn,$o){if(!co(nn,$o)&&(bn===Nn||wt(bn,Nn,de,ke,Ye)))return nn.push($o)})){vr=!1;break}}else if(!(bn===nr||wt(bn,nr,de,ke,Ye))){vr=!1;break}}return Ye.delete(N),Ye.delete(X),vr}function $a(N,X,de,ke,wt,Ye,Mt){switch(de){case V:if(N.byteLength!=X.byteLength||N.byteOffset!=X.byteOffset)return!1;N=N.buffer,X=X.buffer;case U:return!(N.byteLength!=X.byteLength||!Ye(new Vs(N),new Vs(X)));case h:case f:case w:return No(+N,+X);case g:return N.name==X.name&&N.message==X.message;case M:case R:return N==X+"";case S:var tn=Ra;case A:var At=ke&o;if(tn||(tn=Ml),N.size!=X.size&&!At)return!1;var Et=Mt.get(N);if(Et)return Et==X;ke|=s,Mt.set(N,X);var gn=Bl(tn(N),tn(X),ke,wt,Ye,Mt);return Mt.delete(N),gn;case L:if(Ri)return Ri.call(N)==Ri.call(X)}return!1}function ry(N,X,de,ke,wt,Ye){var Mt=de&o,tn=Ul(N),At=tn.length,Et=Ul(X),gn=Et.length;if(At!=gn&&!Mt)return!1;for(var vr=At;vr--;){var nn=tn[vr];if(!(Mt?nn in X:ie.call(X,nn)))return!1}var bn=Ye.get(N);if(bn&&Ye.get(X))return bn==X;var nr=!0;Ye.set(N,X),Ye.set(X,N);for(var Qt=Mt;++vr<At;){nn=tn[vr];var Nn=N[nn],$o=X[nn];if(ke)var Li=Mt?ke($o,Nn,nn,X,N,Ye):ke(Nn,$o,nn,N,X,Ye);if(!(Li===void 0?Nn===$o||wt(Nn,$o,de,ke,Ye):Li)){nr=!1;break}Qt||(Qt=nn=="constructor")}if(nr&&!Qt){var Kl=N.constructor,Fi=X.constructor;Kl!=Fi&&"constructor"in N&&"constructor"in X&&!(typeof Kl=="function"&&Kl instanceof Kl&&typeof Fi=="function"&&Fi instanceof Fi)&&(nr=!1)}return Ye.delete(N),Ye.delete(X),nr}function Ul(N){return zl(N,oy,gu)}function ut(N,X){var de=N.__data__;return Eh(X)?de[typeof X=="string"?"string":"hash"]:de.map}function Ys(N,X){var de=uo(N,X);return ny(de)?de:void 0}function Ch(N){var X=ie.call(N,mr),de=N[mr];try{N[mr]=void 0;var ke=!0}catch{}var wt=Ke.call(N);return ke&&(X?N[mr]=de:delete N[mr]),wt}var gu=Hr?function(N){return N==null?[]:(N=Object(N),St(Hr(N),function(X){return Br.call(N,X)}))}:Ba,Fo=ds;(Rl&&Fo(new Rl(new ArrayBuffer(1)))!=V||Ai&&Fo(new Ai)!=S||Ol&&Fo(Ol.resolve())!=T||Dl&&Fo(new Dl)!=A||Ll&&Fo(new Ll)!=D)&&(Fo=function(N){var X=ds(N),de=X==_?N.constructor:void 0,ke=de?Fn(de):"";if(ke)switch(ke){case Sh:return V;case Da:return S;case du:return T;case La:return A;case Hm:return D}return X});function Ih(N,X){return X=X??i,!!X&&(typeof N=="number"||_e.test(N))&&N>-1&&N%1==0&&N<X}function Eh(N){var X=typeof N;return X=="string"||X=="number"||X=="symbol"||X=="boolean"?N!=="__proto__":N===null}function mu(N){return!!Se&&Se in N}function Hl(N){var X=N&&N.constructor,de=typeof X=="function"&&X.prototype||cs;return N===de}function hs(N){return Ke.call(N)}function Fn(N){if(N!=null){try{return Oa.call(N)}catch{}try{return N+""}catch{}}return""}function No(N,X){return N===X||N!==N&&X!==X}var za=Oi(function(){return arguments}())?Oi:function(N){return gs(N)&&ie.call(N,"callee")&&!Br.call(N,"callee")},ps=Array.isArray;function fs(N){return N!=null&&Th(N.length)&&!Di(N)}var yu=yr||Ua;function kh(N,X){return Na(N,X)}function Di(N){if(!vu(N))return!1;var X=ds(N);return X==y||X==v||X==u||X==E}function Th(N){return typeof N=="number"&&N>-1&&N%1==0&&N<=i}function vu(N){var X=typeof N;return N!=null&&(X=="object"||X=="function")}function gs(N){return N!=null&&typeof N=="object"}var Su=Ut?fr(Ut):fu;function oy(N){return fs(N)?ey(N):Ph(N)}function Ba(){return[]}function Ua(){return!1}n.exports=kh}(dd,dd.exports)),dd.exports}var S9=v9();const QA=wa(S9);function x9(n){if(n.length===0)return new Set;const e=n[0],t=n.slice(1),r=new Set;for(const o of e)t.every(s=>s.has(o))&&r.add(o);return r}function w9(n,e){const t={};for(const r of e)n.has(r)||(t.added??(t.added=new Set),t.added.add(r));for(const r of n)e.has(r)||(t.removed??(t.removed=new Set),t.removed.add(r));return t.added||t.removed?t:void 0}function K2(n,e){for(const[t,r]of Object.entries(n)){const o=r,s=e[t];if("eq"in o&&s!==o.eq||"neq"in o&&s===o.neq||"gt"in o&&(typeof s!="number"||s<=o.gt))return!1}return!0}function W2(n,e,t){const r=Object.fromEntries(Object.keys(t).map(o=>[o,new Set]));for(const[o,s]of Object.entries(t))if("eq"in s){const a=n.index(e,o).get().get(s.eq);if(a)for(const c of a)r[o].add(c)}else if("neq"in s){const i=n.index(e,o);for(const[a,c]of i.get())if(a!==s.neq)for(const u of c)r[o].add(u)}else if("gt"in s){const i=n.index(e,o);for(const[a,c]of i.get())if(a>s.gt)for(const u of c)r[o].add(u)}return x9(Object.values(r))}class b9{constructor(e,t){j(this,"indexCache",new Map);j(this,"historyCache",new Map);this.atoms=e,this.history=t}filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);const t=ce("filterHistory:"+e,(r,o)=>{if(il(r))return this.history.get();const s=this.history.getDiffSince(o);if(s===eo)return this.history.get();const i={added:{},removed:{},updated:{}};let a=0,c=0,u=0;for(const h of s){for(const f of qt(h.added))if(f.typeName===e)if(i.removed[f.id]){const g=i.removed[f.id];delete i.removed[f.id],c--,g!==f&&(i.updated[f.id]=[g,f],u++)}else i.added[f.id]=f,a++;for(const[f,g]of qt(h.updated))g.typeName===e&&(i.added[g.id]?i.added[g.id]=g:i.updated[g.id]?i.updated[g.id]=[i.updated[g.id][0],g]:(i.updated[g.id]=[f,g],u++));for(const f of qt(h.removed))f.typeName===e&&(i.added[f.id]?(delete i.added[f.id],a--):i.updated[f.id]?(i.removed[f.id]=i.updated[f.id][0],delete i.updated[f.id],u--,c++):(i.removed[f.id]=f,c++))}return a||c||u?ud(this.history.get(),i):r},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){const r=e+":"+t;if(this.indexCache.has(r))return this.indexCache.get(r);const o=this.__uncached_createIndex(e,t);return this.indexCache.set(r,o),o}__uncached_createIndex(e,t){const r=this.filterHistory(e),o=()=>{r.get();const s=new Map;for(const i of qt(this.atoms.get())){const a=i.get();if(a.typeName===e){const c=a[t];s.has(c)||s.set(c,new Set),s.get(c).add(a.id)}}return s};return ce("index:"+e+":"+t,(s,i)=>{if(il(s))return o();const a=r.getDiffSince(i);if(a===eo)return o();const c=new Map,u=(y,v)=>{let S=c.get(y);S||(S=new lf(s.get(y)??new Set)),S.add(v),c.set(y,S)},h=(y,v)=>{let S=c.get(y);S||(S=new lf(s.get(y)??new Set)),S.remove(v),c.set(y,S)};for(const y of a){for(const v of qt(y.added))if(v.typeName===e){const S=v[t];u(S,v.id)}for(const[v,S]of qt(y.updated))if(S.typeName===e){const w=v[t],b=S[t];w!==b&&(h(w,S.id),u(b,S.id))}for(const v of qt(y.removed))if(v.typeName===e){const S=v[t];h(S,v.id)}}let f,g;for(const[y,v]of c){const S=v.get();S&&(f||(f=new Map(s)),g||(g=new Map),S.value.size===0?f.delete(y):f.set(y,S.value),g.set(y,S.diff))}return f&&g?ud(f,g):s},{historyLength:100})}record(e,t=()=>({}),r="record:"+e+(t?":"+t.toString():"")){const o=this.ids(e,t,r);return ce(r,()=>{var s;for(const i of o.get())return(s=this.atoms.get()[i])==null?void 0:s.get()})}records(e,t=()=>({}),r="records:"+e+(t?":"+t.toString():"")){const o=this.ids(e,t,"ids:"+r);return ce(r,()=>[...o.get()].map(s=>{const i=this.atoms.get()[s];if(!i)throw new Error("no atom found for record id: "+s);return i.get()}))}ids(e,t=()=>({}),r="ids:"+e+(t?":"+t.toString():"")){const o=this.filterHistory(e),s=()=>{o.get();const c=t();return Object.keys(c).length===0?new Set(qt(this.atoms.get()).flatMap(u=>{const h=u.get();return h.typeName===e?h.id:[]})):W2(this,e,c)},i=c=>{const u=s(),h=w9(c,u);return h?ud(u,h):c},a=ce("ids_query:"+r,t,{isEqual:QA});return ce("query:"+r,(c,u)=>{const h=a.get();if(il(c))return s();if(u<a.lastChangedEpoch)return i(c);const f=o.getDiffSince(u);if(f===eo)return i(c);const g=new lf(c);for(const v of f){for(const S of qt(v.added))S.typeName===e&&K2(h,S)&&g.add(S.id);for(const[S,w]of qt(v.updated))w.typeName===e&&(K2(h,w)?g.add(w.id):g.remove(w.id));for(const S of qt(v.removed))S.typeName===e&&g.remove(S.id)}const y=g.get();return y?ud(y.value,y.diff):c},{historyLength:50})}exec(e,t){const r=W2(this,e,t);if(r.size===0)return gi;const o=this.atoms.get();return[...r].map(s=>o[s].get())}}class _9{constructor(e){j(this,"_beforeCreateHandlers",{});j(this,"_afterCreateHandlers",{});j(this,"_beforeChangeHandlers",{});j(this,"_afterChangeHandlers",{});j(this,"_beforeDeleteHandlers",{});j(this,"_afterDeleteHandlers",{});j(this,"_operationCompleteHandlers",[]);j(this,"_isEnabled",!0);this.store=e}isEnabled(){return this._isEnabled}setIsEnabled(e){this._isEnabled=e}handleBeforeCreate(e,t){if(!this._isEnabled)return e;const r=this._beforeCreateHandlers[e.typeName];if(r){let o=e;for(const s of r)o=s(o,t);return o}return e}handleAfterCreate(e,t){if(!this._isEnabled)return;const r=this._afterCreateHandlers[e.typeName];if(r)for(const o of r)o(e,t)}handleBeforeChange(e,t,r){if(!this._isEnabled)return t;const o=this._beforeChangeHandlers[t.typeName];if(o){let s=t;for(const i of o)s=i(e,s,r);return s}return t}handleAfterChange(e,t,r){if(!this._isEnabled)return;const o=this._afterChangeHandlers[t.typeName];if(o)for(const s of o)s(e,t,r)}handleBeforeDelete(e,t){if(!this._isEnabled)return!0;const r=this._beforeDeleteHandlers[e.typeName];if(r){for(const o of r)if(o(e,t)===!1)return!1}return!0}handleAfterDelete(e,t){if(!this._isEnabled)return;const r=this._afterDeleteHandlers[e.typeName];if(r)for(const o of r)o(e,t)}handleOperationComplete(e){if(this._isEnabled)for(const t of this._operationCompleteHandlers)t(e)}register(e){const t=[];for(const[r,o]of Object.entries(e))o!=null&&o.beforeCreate&&t.push(this.registerBeforeCreateHandler(r,o.beforeCreate)),o!=null&&o.afterCreate&&t.push(this.registerAfterCreateHandler(r,o.afterCreate)),o!=null&&o.beforeChange&&t.push(this.registerBeforeChangeHandler(r,o.beforeChange)),o!=null&&o.afterChange&&t.push(this.registerAfterChangeHandler(r,o.afterChange)),o!=null&&o.beforeDelete&&t.push(this.registerBeforeDeleteHandler(r,o.beforeDelete)),o!=null&&o.afterDelete&&t.push(this.registerAfterDeleteHandler(r,o.afterDelete));return()=>{for(const r of t)r()}}registerBeforeCreateHandler(e,t){return this._beforeCreateHandlers[e]||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>tl(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){return this._afterCreateHandlers[e]||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>tl(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){return this._beforeChangeHandlers[e]||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>tl(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){return this._afterChangeHandlers[e]||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>tl(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){return this._beforeDeleteHandlers[e]||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>tl(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){return this._afterDeleteHandlers[e]||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>tl(this._afterDeleteHandlers[e],t)}registerOperationCompleteHandler(e){return this._operationCompleteHandlers.push(e),()=>tl(this._operationCompleteHandlers,e)}}function tl(n,e){const t=n.indexOf(e);t>=0&&n.splice(t,1)}class Yb{constructor(e){j(this,"id");j(this,"atoms",dn("store_atoms",{}));j(this,"history",dn("history",0,{historyLength:1e3}));j(this,"query",new b9(this.atoms,this.history));j(this,"listeners",new Set);j(this,"historyAccumulator",new C9);j(this,"historyReactor");j(this,"schema");j(this,"props");j(this,"scopedTypes");j(this,"sideEffects",new _9(this));j(this,"isMergingRemoteChanges",!1);j(this,"_integrityChecker");j(this,"_isPossiblyCorrupted",!1);j(this,"pendingAfterEvents",null);j(this,"_isInAtomicOp",!1);const{initialData:t,schema:r,id:o}=e;this.id=o??bt(),this.schema=r,this.props=e.props,t&&this.atoms.set(Eb(Lr(t).map(([s,i])=>[s,dn("atom:"+s,this.schema.validateRecord(this,i,"initialize",null))]))),this.historyReactor=QB("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:s=>this.cancelHistoryReactor=pA(s)}),this.scopedTypes={document:new Set(qt(this.schema.types).filter(s=>s.scope==="document").map(s=>s.typeName)),session:new Set(qt(this.schema.types).filter(s=>s.scope==="session").map(s=>s.typeName)),presence:new Set(qt(this.schema.types).filter(s=>s.scope==="presence").map(s=>s.typeName))}}cancelHistoryReactor(){}_flushHistory(){if(this.historyAccumulator.hasChanges()){const e=this.historyAccumulator.flush();for(const{changes:t,source:r}of e){let o=null,s=null,i=null;for(const{onHistory:a,filters:c}of this.listeners)if(!(c.source!=="all"&&c.source!==r))if(c.scope!=="all")if(c.scope==="document"){if(s??(s=this.filterChangesByScope(t,"document")),!s)continue;a({changes:s,source:r})}else if(c.scope==="session"){if(o??(o=this.filterChangesByScope(t,"session")),!o)continue;a({changes:o,source:r})}else{if(i??(i=this.filterChangesByScope(t,"presence")),!i)continue;a({changes:i,source:r})}else a({changes:t,source:r})}}}dispose(){this.cancelHistoryReactor()}filterChangesByScope(e,t){const r={added:Sd(e.added,(o,s)=>this.scopedTypes[t].has(s.typeName)),updated:Sd(e.updated,(o,s)=>this.scopedTypes[t].has(s[1].typeName)),removed:Sd(e.removed,(o,s)=>this.scopedTypes[t].has(s.typeName))};return Object.keys(r.added).length===0&&Object.keys(r.updated).length===0&&Object.keys(r.removed).length===0?null:r}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),this.listeners.size===0&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}put(e,t){this.atomic(()=>{const r={},o={},s=this.atoms.__unsafe__getWithoutCapture();let i=null,a,c=!1;const u=this.isMergingRemoteChanges?"remote":"user";for(let h=0,f=e.length;h<f;h++){a=e[h];const g=(i??s)[a.id];if(g){const y=g.__unsafe__getWithoutCapture();if(a=this.sideEffects.handleBeforeChange(y,a,u),this.schema.validateRecord(this,a,t??"updateRecord",y)===y)continue;g.set(a),c=!0;const S=g.__unsafe__getWithoutCapture();r[a.id]=[y,S],this.addDiffForAfterEvent(y,S)}else a=this.sideEffects.handleBeforeCreate(a,u),c=!0,a=this.schema.validateRecord(this,a,t??"createRecord",null),o[a.id]=a,this.addDiffForAfterEvent(null,a),i||(i={...s}),i[a.id]=dn("atom:"+a.id,a)}i&&this.atoms.set(i),c&&this.updateHistory({added:o,updated:r,removed:{}})})}remove(e){this.atomic(()=>{const t=new Set,r=this.isMergingRemoteChanges?"remote":"user";if(this.sideEffects.isEnabled())for(const s of e){const i=this.atoms.__unsafe__getWithoutCapture()[s];i&&this.sideEffects.handleBeforeDelete(i.get(),r)===!1&&t.add(s)}let o;this.atoms.update(s=>{let i;for(const a of e){if(t.has(a)||!(a in s))continue;i||(i={...s}),o||(o={}),delete i[a];const c=s[a].get();o[a]=c,this.addDiffForAfterEvent(c,null)}return i??s}),o&&this.updateHistory({added:{},updated:{},removed:o})})}get(e){var t;return(t=this.atoms.get()[e])==null?void 0:t.get()}unsafeGetWithoutCapture(e){var t;return(t=this.atoms.__unsafe__getWithoutCapture()[e])==null?void 0:t.__unsafe__getWithoutCapture()}serialize(e="document"){const t={};for(const[r,o]of Lr(this.atoms.get())){const s=o.get();(e==="all"||this.scopedTypes[e].has(s.typeName))&&(t[r]=s)}return t}getStoreSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}getSnapshot(e="document"){return console.warn("[tldraw] `Store.getSnapshot` is deprecated and will be removed in a future release. Use `getSnapshot` from the `tldraw` package instead."),this.getStoreSnapshot(e)}migrateSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadStoreSnapshot(e){const t=this.schema.migrateStoreSnapshot(e);if(t.type==="error")throw new Error(`Failed to migrate snapshot: ${t.reason}`);const r=this.sideEffects.isEnabled();try{this.sideEffects.setIsEnabled(!1),this.atomic(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}finally{this.sideEffects.setIsEnabled(r)}}loadSnapshot(e){console.warn("[tldraw] `Store.loadSnapshot` is deprecated and will be removed in a future release. Use `loadSnapshot` from the 'tldraw' package instead."),this.loadStoreSnapshot(e)}allRecords(){return qt(this.atoms.get()).map(e=>e.get())}clear(){this.remove(vI(this.atoms.get()))}update(e,t){const r=this.atoms.get()[e];if(!r){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(r.__unsafe__getWithoutCapture())])}has(e){return!!this.atoms.get()[e]}listen(e,t){this._flushHistory();const r={onHistory:e,filters:{source:(t==null?void 0:t.source)??"all",scope:(t==null?void 0:t.scope)??"all"}};return this.listeners.add(r),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(r),this.listeners.size===0&&this.historyReactor.stop()}}mergeRemoteChanges(e){if(this.isMergingRemoteChanges)return e();if(this._isInAtomicOp)throw new Error("Cannot merge remote changes while in atomic operation");try{this.isMergingRemoteChanges=!0,As(e)}finally{this.isMergingRemoteChanges=!1,this.ensureStoreIsUsable()}}extractingChanges(e){const t=[],r=this.historyAccumulator.addInterceptor(o=>t.push(o.changes));try{return As(e),qb(t)}finally{r()}}applyDiff(e,{runCallbacks:t=!0,ignoreEphemeralKeys:r=!1}={}){this.atomic(()=>{const o=qt(e.added);for(const[i,a]of qt(e.updated)){const c=this.schema.getType(a.typeName);if(r&&c.ephemeralKeySet.size){const u=this.get(a.id);if(!u){o.push(a);continue}let h=null;for(const[f,g]of Object.entries(a))c.ephemeralKeySet.has(f)||Object.is(g,Yn(u,f))||(h||(h={...u}),h[f]=g);h&&o.push(h)}else o.push(a)}const s=vI(e.removed);o.length&&this.put(o),s.length&&this.remove(s)},t)}createComputedCache(e,t,r){const o=new Os;return{get:s=>{const i=this.atoms.get()[s];if(i)return o.get(i,()=>{const a=r?ce(i.name+":equals",()=>i.get(),{isEqual:r}):i;return ce(e+":"+s,()=>t(a.get()))}).get()}}}createSelectedComputedCache(e,t,r){const o=new Os;return{get:s=>{const i=this.atoms.get()[s];if(i)return o.get(i,()=>{const a=ce(e+":"+s+":selector",()=>t(i.get()));return ce(e+":"+s,()=>r(a.get()))}).get()}}}ensureStoreIsUsable(){this.atomic(()=>{var e;this._integrityChecker??(this._integrityChecker=this.schema.createIntegrityChecker(this)),(e=this._integrityChecker)==null||e.call(this)})}markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}addDiffForAfterEvent(e,t){if(yt(this.pendingAfterEvents,"must be in event operation"),e===t||(e&&t&&yt(e.id===t.id),!e&&!t))return;const r=(e||t).id,o=this.pendingAfterEvents.get(r);o?o.after=t:this.pendingAfterEvents.set(r,{before:e,after:t})}flushAtomicCallbacks(){let e=0;const t=this.isMergingRemoteChanges?"remote":"user";for(;this.pendingAfterEvents;){const r=this.pendingAfterEvents;if(this.pendingAfterEvents=null,!!this.sideEffects.isEnabled()){if(e++,e>100)throw new Error("Maximum store update depth exceeded, bailing out");for(const{before:o,after:s}of r.values())o&&s?this.sideEffects.handleAfterChange(o,s,t):o&&!s?this.sideEffects.handleAfterDelete(o,t):!o&&s&&this.sideEffects.handleAfterCreate(s,t);this.pendingAfterEvents||this.sideEffects.handleOperationComplete(t)}}}atomic(e,t=!0){return As(()=>{if(this._isInAtomicOp)return this.pendingAfterEvents||(this.pendingAfterEvents=new Map),e();this.pendingAfterEvents=new Map;const r=this.sideEffects.isEnabled();this.sideEffects.setIsEnabled(t??r),this._isInAtomicOp=!0;try{const o=e();return this.flushAtomicCallbacks(),o}finally{this.pendingAfterEvents=null,this.sideEffects.setIsEnabled(r),this._isInAtomicOp=!1}})}addHistoryInterceptor(e){return this.historyAccumulator.addInterceptor(t=>e(t,this.isMergingRemoteChanges?"remote":"user"))}}function P9(n){if(n.length===0)return[];const e=[];let t=[n[0]],r;for(let o=1,s=n.length;o<s;o++)r=n[o],t[0].source!==r.source&&(e.push(t),t=[]),t.push(r);return e.push(t),e.map(o=>({source:o[0].source,changes:qb(o.map(s=>s.changes))}))}class C9{constructor(){j(this,"_history",[]);j(this,"_interceptors",new Set)}addInterceptor(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){this._history.push(e);for(const t of this._interceptors)t(e)}flush(){const e=P9(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}}function I9(n,e,t){const r=new Os;return{get(o,s){return r.get(o,()=>(o instanceof Yb?o:o.store).createComputedCache(n,c=>e(o,c),t)).get(s)}}}function E9(n){const e=[];for(let t=n.length-1;t>=0;t--){const r=n[t];if("id"in r)e.unshift(r);else{const o=r.dependsOn,s=e[0];s&&(e[0]={...s,dependsOn:o.concat(s.dependsOn??[])})}}return e}function Oc({sequence:n,sequenceId:e,retroactive:t=!0}){const r={sequenceId:e,retroactive:t,sequence:E9(n)};return JA(r),r}function Nr(n,e){return Object.fromEntries(Lr(e).map(([t,r])=>[t,`${n}/${r}`]))}function io(n){const e=n.sequenceId;return Oc({sequenceId:e,retroactive:n.retroactive??!0,sequence:n.sequence.map(t=>"id"in t?{...t,scope:"record",filter:r=>{var o,s;return r.typeName===n.recordType&&(((o=t.filter)==null?void 0:o.call(t,r))??!0)&&(((s=n.filter)==null?void 0:s.call(n,r))??!0)}}:t)})}function k9(n){const e=new Map(n.map(s=>[s.id,s])),t=new Set,r=[];function o(s){yt(!t.has(s.id),`Circular dependency in migrations: ${s.id}`),t.add(s.id);const{version:i,sequenceId:a}=Zf(s.id),c=e.get(`${a}/${i-1}`);if(c&&o(c),s.dependsOn)for(const u of s.dependsOn){const h=e.get(u);h&&o(h)}e.delete(s.id),r.push(s)}for(const s of e.values())o(s);return r}function Zf(n){const[e,t]=n.split("/");return{sequenceId:e,version:parseInt(t)}}function V2(n,e){e&&yt(n.startsWith(e+"/"),`Every migration in sequence '${e}' must have an id starting with '${e}/'. Got invalid id: '${n}'`),yt(n.match(/^(.*?)\/(0|[1-9]\d*)$/),`Invalid migration id: '${n}'`)}function JA(n){if(yt(!n.sequenceId.includes("/"),`sequenceId cannot contain a '/', got ${n.sequenceId}`),yt(n.sequenceId.length,"sequenceId must be a non-empty string"),n.sequence.length===0)return;V2(n.sequence[0].id,n.sequenceId);let e=Zf(n.sequence[0].id).version;yt(e===1,`Expected the first migrationId to be '${n.sequenceId}/1' but got '${n.sequence[0].id}'`);for(let t=1;t<n.sequence.length;t++){const r=n.sequence[t].id;V2(r,n.sequenceId);const o=Zf(r).version;yt(o===e+1,`Migration id numbers must increase in increments of 1, expected ${n.sequenceId}/${e+1} but got '${n.sequence[t].id}'`),e=o}}var ta=(n=>(n.IncompatibleSubtype="incompatible-subtype",n.UnknownType="unknown-type",n.TargetVersionTooNew="target-version-too-new",n.TargetVersionTooOld="target-version-too-old",n.MigrationError="migration-error",n.UnrecognizedSubtype="unrecognized-subtype",n))(ta||{});function T9(n){if(n.schemaVersion>2||n.schemaVersion<1)return da.err("Bad schema version");if(n.schemaVersion===2)return da.ok(n);const e={schemaVersion:2,sequences:{"com.tldraw.store":n.storeVersion}};for(const[t,r]of Object.entries(n.recordVersions))if(e.sequences[`com.tldraw.${t}`]=r.version,"subTypeKey"in r)for(const[o,s]of Object.entries(r.subTypeVersions))e.sequences[`com.tldraw.${t}.${o}`]=s;return da.ok(e)}class Xb{constructor(e,t){j(this,"migrations",{});j(this,"sortedMigrations");var o;this.types=e,this.options=t;for(const s of t.migrations??[])yt(!this.migrations[s.sequenceId],`Duplicate migration sequenceId ${s.sequenceId}`),JA(s),this.migrations[s.sequenceId]=s;const r=Object.values(this.migrations).flatMap(s=>s.sequence);this.sortedMigrations=k9(r);for(const s of this.sortedMigrations)if((o=s.dependsOn)!=null&&o.length)for(const i of s.dependsOn){const a=r.find(c=>c.id===i);yt(a,`Migration '${s.id}' depends on missing migration '${i}'`)}}static create(e,t){return new Xb(e,t??{})}validateRecord(e,t,r,o){try{const s=Yn(this.types,t.typeName);if(!s)throw new Error(`Missing definition for record type ${t.typeName}`);return s.validate(t,o??void 0)}catch(s){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:r,recordBefore:o,error:s});throw s}}getMigrationsSince(e){const t=T9(e);if(!t.ok)return t;const r=t.value,o=new Set(Object.keys(r.sequences).filter(i=>this.migrations[i]));for(const i in this.migrations)r.sequences[i]===void 0&&this.migrations[i].retroactive&&o.add(i);if(o.size===0)return da.ok([]);const s=new Set;for(const i of o){const a=r.sequences[i];if(typeof a!="number"&&this.migrations[i].retroactive||a===0){for(const h of this.migrations[i].sequence)s.add(h.id);continue}const c=`${i}/${a}`,u=this.migrations[i].sequence.findIndex(h=>h.id===c);if(u===-1)return da.err("Incompatible schema?");for(const h of this.migrations[i].sequence.slice(u+1))s.add(h.id)}return da.ok(this.sortedMigrations.filter(({id:i})=>s.has(i)))}migratePersistedRecord(e,t,r="up"){const o=this.getMigrationsSince(t);if(!o.ok)return console.error("Error migrating record",o.error),{type:"error",reason:ta.MigrationError};let s=o.value;if(s.length===0)return{type:"success",value:e};if(s.some(i=>i.scope==="store"))return{type:"error",reason:r==="down"?ta.TargetVersionTooOld:ta.TargetVersionTooNew};if(r==="down"){if(!s.every(i=>i.down))return{type:"error",reason:ta.TargetVersionTooOld};s=s.slice().reverse()}e=zt(e);try{for(const i of s){if(i.scope==="store")throw new Error;if(!(i.filter?i.filter(e):!0))continue;const c=i[r](e);c&&(e=zt(c))}}catch(i){return console.error("Error migrating record",i),{type:"error",reason:ta.MigrationError}}return{type:"success",value:e}}migrateStoreSnapshot(e){let{store:t}=e;const r=this.getMigrationsSince(e.schema);if(!r.ok)return console.error("Error migrating store",r.error),{type:"error",reason:ta.MigrationError};const o=r.value;if(o.length===0)return{type:"success",value:t};t=zt(t);try{for(const s of o)if(s.scope==="record")for(const[i,a]of Object.entries(t)){if(!(s.filter?s.filter(a):!0))continue;const u=s.up(a);u&&(t[i]=zt(u))}else if(s.scope==="store"){const i=s.up(t);i&&(t=zt(i))}else Sn(s)}catch(s){return console.error("Error migrating store",s),{type:"error",reason:ta.MigrationError}}return{type:"success",value:t}}createIntegrityChecker(e){var t,r;return((r=(t=this.options).createIntegrityChecker)==null?void 0:r.call(t,e))??void 0}serialize(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e,sequence:t})=>[e,t.length?Zf(t.at(-1).id).version:0]))}}serializeEarliestVersion(){return{schemaVersion:2,sequences:Object.fromEntries(Object.values(this.migrations).map(({sequenceId:e})=>[e,0]))}}getType(e){const t=Yn(this.types,e);return yt(t,"record type does not exists"),t}}ba("@tldraw/store","3.6.0","esm");function M9(n){if(!n.length)return null;let e="";for(const t of n)typeof t=="number"?e+=`.${t}`:t.startsWith("(")?e.endsWith(")")?e=`${e.slice(0,-1)}, ${t.slice(1)}`:e+=t:e+=`.${t}`;return e=e.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,""),e.startsWith(".")?e.slice(1):e}class ct extends Error{constructor(t,r=[]){const o=M9(r),s=t.split(`
`).map((i,a)=>a===0?i:`  ${i}`).join(`
`);super(r?`At ${o}: ${s}`:s);j(this,"name","ValidationError");this.rawMessage=t,this.path=r}}function Fr(n,e){try{return e()}catch(t){throw t instanceof ct?new ct(t.rawMessage,[n,...t.path]):new ct(t.toString(),[n])}}function va(n){if(n===null)return"null";if(Array.isArray(n))return"an array";const e=typeof n;switch(e){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${e}`;case"object":return`an ${e}`;case"undefined":return"undefined";default:Sn(e)}}class ur{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){return this.validationFn(e)}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return L9(this)}optional(){return tj(this)}refine(e){return new ur(t=>e(this.validate(t)),(t,r)=>{const o=this.validateUsingKnownGoodVersion(t,r);return Object.is(t,o)?t:e(o)})}check(e,t){return typeof e=="string"?this.refine(r=>(Fr(`(check ${e})`,()=>t(r)),r)):this.refine(r=>(e(r),r))}}class A9 extends ur{constructor(e){super(t=>{const r=G2.validate(t);for(let o=0;o<r.length;o++)Fr(o,()=>e.validate(r[o]));return r},(t,r)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(r);const o=G2.validate(r);let s=t.length!==o.length;for(let i=0;i<o.length;i++){const a=o[i];if(i>=t.length){s=!0,Fr(i,()=>e.validate(a));continue}if(Object.is(t[i],a))continue;const c=Fr(i,()=>e.validateUsingKnownGoodVersion(t[i],a));Object.is(c,t[i])||(s=!0)}return s?r:t}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(e.length===0)throw new ct("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new ct("Expected an array with length greater than 1")})}}class Qf extends ur{constructor(e,t=!1){super(r=>{if(typeof r!="object"||r===null)throw new ct(`Expected object, got ${va(r)}`);for(const[o,s]of Object.entries(e))Fr(o,()=>{s.validate(Yn(r,o))});if(!t){for(const o of Object.keys(r))if(!Qo(e,o))throw new ct("Unexpected property",[o])}return r},(r,o)=>{if(typeof o!="object"||o===null)throw new ct(`Expected object, got ${va(o)}`);let s=!1;for(const[i,a]of Object.entries(e)){const c=Yn(r,i),u=Yn(o,i);if(Object.is(c,u))continue;const h=Fr(i,()=>{const f=a;return f.validateUsingKnownGoodVersion?f.validateUsingKnownGoodVersion(c,u):f.validate(u)});Object.is(h,c)||(s=!0)}if(!t){for(const i of Object.keys(o))if(!Qo(e,i))throw new ct("Unexpected property",[i])}for(const i of Object.keys(r))if(!Qo(o,i)){s=!0;break}return s?o:r}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new Qf(this.config,!0)}extend(e){return new Qf({...this.config,...e})}}class Bg extends ur{constructor(e,t,r,o){super(s=>{this.expectObject(s);const{matchingSchema:i,variant:a}=this.getMatchingSchemaAndVariant(s);return i===void 0?this.unknownValueValidation(s,a):Fr(`(${e} = ${a})`,()=>i.validate(s))},(s,i)=>{this.expectObject(i),this.expectObject(s);const{matchingSchema:a,variant:c}=this.getMatchingSchemaAndVariant(i);return a===void 0?this.unknownValueValidation(i,c):Yn(s,e)!==Yn(i,e)?Fr(`(${e} = ${c})`,()=>a.validate(i)):Fr(`(${e} = ${c})`,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(s,i):a.validate(i))}),this.key=e,this.config=t,this.unknownValueValidation=r,this.useNumberKeys=o}expectObject(e){if(typeof e!="object"||e===null)throw new ct(`Expected an object, got ${va(e)}`,[])}getMatchingSchemaAndVariant(e){const t=Yn(e,this.key);if(!this.useNumberKeys&&typeof t!="string")throw new ct(`Expected a string for key "${this.key}", got ${va(t)}`);if(this.useNumberKeys&&!Number.isFinite(Number(t)))throw new ct(`Expected a number for key "${this.key}", got "${t}"`);return{matchingSchema:Qo(this.config,t)?this.config[t]:void 0,variant:t}}validateUnknownVariants(e){return new Bg(this.key,this.config,e,this.useNumberKeys)}}class j9 extends ur{constructor(e,t){super(r=>{if(typeof r!="object"||r===null)throw new ct(`Expected object, got ${va(r)}`);for(const[o,s]of Object.entries(r))Fr(o,()=>{e.validate(o),t.validate(s)});return r},(r,o)=>{if(typeof o!="object"||o===null)throw new ct(`Expected object, got ${va(o)}`);let s=!1;for(const[i,a]of Object.entries(o)){if(!Qo(r,i)){s=!0,Fr(i,()=>{e.validate(i),t.validate(a)});continue}const c=Yn(r,i),u=a;if(Object.is(c,u))continue;const h=Fr(i,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(c,u):t.validate(u));Object.is(h,c)||(s=!0)}for(const i of Object.keys(r))if(!Qo(o,i)){s=!0;break}return s?o:r}),this.keyValidator=e,this.valueValidator=t}}function Zb(n){return new ur(e=>{if(typeof e!==n)throw new ct(`Expected ${n}, got ${va(e)}`);return e})}const R9=new ur(n=>n),Qe=Zb("string"),We=Zb("number").check(n=>{if(Number.isNaN(n))throw new ct("Expected a number, got NaN");if(!Number.isFinite(n))throw new ct(`Expected a finite number, got ${n}`)}),Jf=We.check(n=>{if(n<0)throw new ct(`Expected a positive number, got ${n}`)}),ln=We.check(n=>{if(n<=0)throw new ct(`Expected a non-zero positive number, got ${n}`)}),ej=We.check(n=>{if(!Number.isInteger(n))throw new ct(`Expected an integer, got ${n}`)}),cf=ej.check(n=>{if(n<0)throw new ct(`Expected a positive integer, got ${n}`)}),O9=ej.check(n=>{if(n<=0)throw new ct(`Expected a non-zero positive integer, got ${n}`)}),nt=Zb("boolean");function Qn(n){return new ur(e=>{if(e!==n)throw new ct(`Expected ${n}, got ${JSON.stringify(e)}`);return n})}const G2=new ur(n=>{if(!Array.isArray(n))throw new ct(`Expected an array, got ${va(n)}`);return n});function Tn(n){return new A9(n)}function ot(n){return new Qf(n)}function aw(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null||Object.getPrototypeOf(n)===q8)}function lw(n){return n===null||typeof n=="number"||typeof n=="string"||typeof n=="boolean"?!0:Array.isArray(n)?n.every(lw):aw(n)?Object.values(n).every(lw):!1}const Mn=new ur(n=>{if(lw(n))return n;throw new ct(`Expected json serializable value, got ${typeof n}`)},(n,e)=>{if(Array.isArray(n)&&Array.isArray(e)){let t=n.length!==e.length;for(let r=0;r<e.length;r++){if(r>=n.length){t=!0,Mn.validate(e[r]);continue}const o=n[r],s=e[r];if(Object.is(o,s))continue;const i=Mn.validateUsingKnownGoodVersion(o,s);Object.is(i,o)||(t=!0)}return t?e:n}else if(aw(n)&&aw(e)){let t=!1;for(const r of Object.keys(e)){if(!Qo(n,r)){t=!0,Mn.validate(e[r]);continue}const o=n[r],s=e[r];if(Object.is(o,s))continue;const i=Mn.validateUsingKnownGoodVersion(o,s);Object.is(i,o)||(t=!0)}for(const r of Object.keys(n))if(!Qo(e,r)){t=!0;break}return t?e:n}else return Mn.validate(e)});function eg(n,e){return new j9(n,e)}function Qb(n,e){return new Bg(n,e,(t,r)=>{throw new ct(`Expected one of ${Object.keys(e).map(o=>JSON.stringify(o)).join(" or ")}, got ${JSON.stringify(r)}`,[n])},!1)}function D9(n,e){return new Bg(n,e,(t,r)=>{throw new ct(`Expected one of ${Object.keys(e).map(o=>JSON.stringify(o)).join(" or ")}, got ${JSON.stringify(r)}`,[n])},!0)}function Hs(n,e){return new ur(t=>Fr(n,()=>e.validate(t)),(t,r)=>Fr(n,()=>e.validateUsingKnownGoodVersion?e.validateUsingKnownGoodVersion(t,r):e.validate(r)))}function Ug(n){return new ur(e=>{if(!n.has(e)){const t=Array.from(n,r=>JSON.stringify(r)).join(" or ");throw new ct(`Expected ${t}, got ${e}`)}return e})}function tj(n){return new ur(e=>{if(e!==void 0)return n.validate(e)},(e,t)=>{if(!(e===void 0&&t===void 0)&&t!==void 0)return n.validateUsingKnownGoodVersion&&e!==void 0?n.validateUsingKnownGoodVersion(e,t):n.validate(t)})}function L9(n){return new ur(e=>e===null?null:n.validate(e),(e,t)=>t===null?null:n.validateUsingKnownGoodVersion&&e!==null?n.validateUsingKnownGoodVersion(e,t):n.validate(t))}function Hg(...n){return Ug(new Set(n))}function Jb(n){try{return new URL(n)}catch{if(n.startsWith("/")||n.startsWith("./"))try{return new URL(n,"http://example.com")}catch{throw new ct(`Expected a valid url, got ${JSON.stringify(n)}`)}throw new ct(`Expected a valid url, got ${JSON.stringify(n)}`)}}const F9=new Set(["http:","https:","mailto:"]),ro=Qe.check(n=>{if(n==="")return;const e=Jb(n);if(!F9.has(e.protocol.toLowerCase()))throw new ct(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)}),N9=new Set(["http:","https:","data:","asset:"]),dl=Qe.check(n=>{if(n==="")return;const e=Jb(n);if(!N9.has(e.protocol.toLowerCase()))throw new ct(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});Qe.check(n=>{if(n==="")return;if(!Jb(n).protocol.toLowerCase().match(/^https?:$/))throw new ct(`Expected a valid url, got ${JSON.stringify(n)} (invalid protocol)`)});const e1=Qe.refine(n=>{try{return F8(n),n}catch{throw new ct(`Expected an index key, got ${JSON.stringify(n)}`)}});ba("@tldraw/validate","3.6.0","esm");function to(n){return Qe.refine(e=>{if(!e.startsWith(`${n}:`))throw new Error(`${n} ID must start with "${n}:"`);return e})}const Kg=to("asset");function t1(n,e){return ot({id:Kg,typeName:Qn("asset"),type:Qn(n),props:e,meta:Mn})}const hl=ot({x:We,y:We,z:We.optional()}),wd=ot({x:We,y:We,w:We,h:We}),nj=We.check(n=>{if(n<0||n>1)throw new ct("Opacity must be between 0 and 1")}),$9=Qe.refine(n=>{if(!n.startsWith("page:")&&!n.startsWith("shape:"))throw new Error('Parent ID must start with "page:" or "shape:"');return n}),_o=to("shape");function z9(n,e,t){return ot({id:_o,typeName:Qn("shape"),x:We,y:We,rotation:We,index:e1,parentId:$9,type:Qn(n),isLocked:nt,opacity:nj,props:e?ot(e):Mn,meta:t?ot(t):Mn})}const B9=to("binding");function U9(n,e,t){return ot({id:B9,typeName:Qn("binding"),type:Qn(n),fromId:_o,toId:_o,props:e?ot(e):Mn,meta:t?ot(t):Mn})}Nr("com.tldraw.binding",{});io({sequenceId:"com.tldraw.binding",recordType:"binding",sequence:[]});function al(n){return`binding:${bt()}`}function H9(n){return Us("binding",{scope:"document",validator:Hs("binding",Qb("type",Wd(n,(e,{props:t,meta:r})=>U9(e,t,r))))}).withDefaultProperties(()=>({meta:{}}))}class Dn{constructor(e,t,r){this.id=e,this.defaultValue=t,this.type=r}static define(e,t){const{defaultValue:r,type:o=R9}=t;return new Dn(e,r,o)}static defineEnum(e,t){const{defaultValue:r,values:o}=t;return new K9(e,r,o)}setDefaultValue(e){this.defaultValue=e}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}}class K9 extends Dn{constructor(e,t,r){super(e,t,Hg(...r)),this.values=r}}const Cp=Nr("com.tldraw.shape",{AddIsLocked:1,HoistOpacity:2,AddMeta:3,AddWhite:4}),W9=io({sequenceId:"com.tldraw.shape",recordType:"shape",sequence:[{id:Cp.AddIsLocked,up:n=>{n.isLocked=!1},down:n=>{delete n.isLocked}},{id:Cp.HoistOpacity,up:n=>{n.opacity=Number(n.props.opacity??"1"),delete n.props.opacity},down:n=>{const e=n.opacity;delete n.opacity,n.props.opacity=e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}},{id:Cp.AddMeta,up:n=>{n.meta={}}},{id:Cp.AddWhite,up:n=>{},down:n=>{n.props.color==="white"&&(n.props.color="black")}}]});function Ic(n){return n?n.typeName==="shape":!1}function Tr(n){return n?n.startsWith("shape:"):!1}function Ct(n){return`shape:${n??bt()}`}function rj(n){const e=new Map;for(const[t,r]of Object.entries(n))if(r instanceof Dn){if(e.has(r))throw new Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);e.set(r,t)}return e}function os(n,e){return Wd(e,(t,r)=>`com.tldraw.shape.${n}/${r}`)}function V9(n){return Us("shape",{scope:"document",validator:Hs("shape",Qb("type",Wd(n,(e,{props:t,meta:r})=>z9(e,t,r))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}function q2(n,e){const t=[];for(const[r,{migrations:o}]of Object.entries(e)){const s=`com.tldraw.${n}.${r}`;o?"sequenceId"in o?(yt(s===o.sequenceId,`sequenceId mismatch for ${r} ${zg} migrations. Expected '${s}', got '${o.sequenceId}'`),t.push(o)):"sequence"in o?t.push(Oc({sequenceId:s,retroactive:!1,sequence:o.sequence.map(i=>"id"in i?oj(n,r,i):i)})):t.push(Oc({sequenceId:s,retroactive:!1,sequence:Object.keys(o.migrators).map(i=>Number(i)).sort((i,a)=>i-a).map(i=>({id:`${s}/${i}`,scope:"record",filter:a=>a.typeName===n&&a.type===r,up:a=>{const c=o.migrators[i].up(a);if(c)return c},down:a=>{const c=o.migrators[i].down(a);if(c)return c}}))})):t.push(Oc({sequenceId:s,retroactive:!1,sequence:[]}))}return t}function oj(n,e,t){return{id:t.id,dependsOn:t.dependsOn,scope:"record",filter:r=>r.typeName===n&&r.type===e,up:r=>{const o=t.up(r.props);o&&(r.props=o)},down:typeof t.down=="function"?r=>{const o=t.down(r.props);o&&(r.props=o)}:void 0}}const sj=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red","white"],tg={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",fill:"#1d1d1d",note:{fill:"#FCE19C",text:"#000000"},semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4465e9",fill:"#4465e9",note:{fill:"#8AA3FF",text:"#000000"},semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#6FC896",text:"#000000"},semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#9fa8b2",fill:"#9fa8b2",note:{fill:"#C0CAD3",text:"#000000"},semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4ba1f1",fill:"#4ba1f1",note:{fill:"#9BC4FD",text:"#000000"},semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#4cb05e",fill:"#4cb05e",note:{fill:"#98D08A",text:"#000000"},semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#f87777",fill:"#f87777",note:{fill:"#F7A5A1",text:"#000000"},semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e085f4",fill:"#e085f4",note:{fill:"#DFB0F9",text:"#000000"},semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#e16919",fill:"#e16919",note:{fill:"#FAA475",text:"#000000"},semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#FC8282",text:"#000000"},semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#DB91FD",text:"#000000"},semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#f1ac4b",fill:"#f1ac4b",note:{fill:"#FED49A",text:"#000000"},semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},white:{solid:"#FFFFFF",fill:"#FFFFFF",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#FFFFFF",text:"#000000"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 6.5%)",solid:"#010403",black:{solid:"#f2f2f2",fill:"#f2f2f2",note:{fill:"#2c2c2c",text:"#f2f2f2"},semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4f72fc",fill:"#4f72fc",note:{fill:"#2A3F98",text:"#f2f2f2"},semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",fill:"#099268",note:{fill:"#014429",text:"#f2f2f2"},semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",fill:"#9398b0",note:{fill:"#56595F",text:"#f2f2f2"},semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",fill:"#4dabf7",note:{fill:"#1F5495",text:"#f2f2f2"},semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",fill:"#40c057",note:{fill:"#21581D",text:"#f2f2f2"},semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",fill:"#ff8787",note:{fill:"#923632",text:"#f2f2f2"},semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",fill:"#e599f7",note:{fill:"#762F8E",text:"#f2f2f2"},semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",fill:"#f76707",note:{fill:"#843906",text:"#f2f2f2"},semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",fill:"#e03131",note:{fill:"#89231A",text:"#f2f2f2"},semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",fill:"#ae3ec9",note:{fill:"#681683",text:"#f2f2f2"},semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",fill:"#ffc034",note:{fill:"#98571B",text:"#f2f2f2"},semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},white:{solid:"#f3f3f3",fill:"#f3f3f3",semi:"#f5f5f5",pattern:"#f9f9f9",note:{fill:"#eaeaea",text:"#1d1d1d"},highlight:{srgb:"#ffffff",p3:"color(display-p3 1 1 1)"}}}};function Ii(n){return n.isDarkMode?tg.darkMode:tg.lightMode}const oo=Dn.defineEnum("tldraw:color",{defaultValue:"black",values:sj}),n1=Dn.defineEnum("tldraw:labelColor",{defaultValue:"black",values:sj}),pl=Dn.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),fl=Dn.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern","fill"]}),Ls=Dn.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),ij={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},Fs=Dn.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),aj=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],ng=Dn.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:aj}),rg=Dn.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:aj}),lj={labelColor:n1,color:oo,fill:fl,dash:pl,size:Fs,arrowheadStart:ng,arrowheadEnd:rg,font:Ls,start:hl,end:hl,bend:We,text:Qe,labelPosition:We,scale:ln},xc=os("arrow",{AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3,ExtractBindings:4,AddScale:5});function Ip(n){return oj("shape","arrow",n)}const cj=Oc({sequenceId:"com.tldraw.shape.arrow",retroactive:!1,sequence:[Ip({id:xc.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"}),Ip({id:xc.AddIsPrecise,up:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise=!(n.normalizedAnchor.x===.5&&n.normalizedAnchor.y===.5)),e.type==="binding"&&(e.isPrecise=!(e.normalizedAnchor.x===.5&&e.normalizedAnchor.y===.5))},down:({start:n,end:e})=>{n.type==="binding"&&(n.isPrecise||(n.normalizedAnchor={x:.5,y:.5}),delete n.isPrecise),e.type==="binding"&&(e.isPrecise||(e.normalizedAnchor={x:.5,y:.5}),delete e.isPrecise)}}),Ip({id:xc.AddLabelPosition,up:n=>{n.labelPosition=.5},down:n=>{delete n.labelPosition}}),{id:xc.ExtractBindings,scope:"store",up:n=>{const e=Object.values(n).filter(t=>t.typeName==="shape"&&t.type==="arrow");for(const t of e){const{start:r,end:o}=t.props;if(r.type==="binding"){const s=al(),i={typeName:"binding",id:s,type:"arrow",fromId:t.id,toId:r.boundShapeId,meta:{},props:{terminal:"start",normalizedAnchor:r.normalizedAnchor,isExact:r.isExact,isPrecise:r.isPrecise}};n[s]=i,t.props.start={x:0,y:0}}else delete t.props.start.type;if(o.type==="binding"){const s=al(),i={typeName:"binding",id:s,type:"arrow",fromId:t.id,toId:o.boundShapeId,meta:{},props:{terminal:"end",normalizedAnchor:o.normalizedAnchor,isExact:o.isExact,isPrecise:o.isPrecise}};n[s]=i,t.props.end={x:0,y:0}}else delete t.props.end.type}}},Ip({id:xc.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}})]}),uj={terminal:Hg("start","end"),normalizedAnchor:hl,isExact:nt,isPrecise:nt},dj={sequence:[{dependsOn:[xc.ExtractBindings]}]},G9=Hs("camera",ot({typeName:Qn("camera"),id:to("camera"),x:We,y:We,z:We,meta:Mn})),q9=Nr("com.tldraw.camera",{AddMeta:1}),Y9=io({sequenceId:"com.tldraw.camera",recordType:"camera",sequence:[{id:q9.AddMeta,up:n=>{n.meta={}}}]}),Es=Us("camera",{validator:G9,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),X9=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),hj=Ug(X9),Z9=ot({type:hj,rotation:We}),Q9=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),J9=Ug(Q9),eU=new Set(["starting","paused","active","stopping"]),pj=ot({id:Qe,points:Tn(hl),size:Jf,color:J9,opacity:We,state:Ug(eU),delay:We,shrink:We,taper:nt}),Od=to("page"),tU=Hs("page",ot({typeName:Qn("page"),id:Od,name:Qe,index:e1,meta:Mn})),nU=Nr("com.tldraw.page",{AddMeta:1}),rU=io({sequenceId:"com.tldraw.page",recordType:"page",sequence:[{id:nU.AddMeta,up:n=>{n.meta={}}}]}),so=Us("page",{validator:tU,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function Ir(n){return so.isId(n)}const oU={id:!1,typeName:!1,currentPageId:!1,opacityForNextShape:!1,stylesForNextShape:!1,followingUserId:!1,highlightedUserIds:!1,brush:!1,cursor:!1,scribbles:!1,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!1,chatMessage:!1,isChatting:!1,isPenMode:!1,isGridMode:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!1,openMenus:!1,isChangingStyle:!1,isReadonly:!0,meta:!1,duplicateProps:!1};function fj(n){return n?Sd(n,e=>oU[e]):null}to("instance");function sU(n){const e={};for(const[r,o]of n)e[r]=tj(o);const t=Hs("instance",ot({typeName:Qn("instance"),id:to("instance"),currentPageId:Od,followingUserId:Qe.nullable(),brush:wd.nullable(),opacityForNextShape:nj,stylesForNextShape:ot(e),cursor:Z9,scribbles:Tn(pj),isFocusMode:nt,isDebugMode:nt,isToolLocked:nt,exportBackground:nt,screenBounds:wd,insets:Tn(nt),zoomBrush:wd.nullable(),isPenMode:nt,isGridMode:nt,chatMessage:Qe,isChatting:nt,highlightedUserIds:Tn(Qe),isFocused:nt,devicePixelRatio:We,isCoarsePointer:nt,isHoveringCanvas:nt.nullable(),openMenus:Tn(Qe),isChangingStyle:nt,isReadonly:nt,meta:Mn,duplicateProps:ot({shapeIds:Tn(to("shape")),offset:ot({x:We,y:We})}).nullable()}));return Us("instance",{validator:t,scope:"session",ephemeralKeys:{currentPageId:!1,meta:!1,followingUserId:!0,opacityForNextShape:!0,stylesForNextShape:!0,brush:!0,cursor:!0,scribbles:!0,isFocusMode:!0,isDebugMode:!0,isToolLocked:!0,exportBackground:!0,screenBounds:!0,insets:!0,zoomBrush:!0,isPenMode:!0,isGridMode:!0,chatMessage:!0,isChatting:!0,highlightedUserIds:!0,isFocused:!0,devicePixelRatio:!0,isCoarsePointer:!0,isHoveringCanvas:!0,openMenus:!0,isChangingStyle:!0,isReadonly:!0,duplicateProps:!0}}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],isFocused:!1,devicePixelRatio:typeof window>"u"?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}const $t=Nr("com.tldraw.instance",{AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24,RemoveCanMoveCamera:25}),iU=io({sequenceId:"com.tldraw.instance",recordType:"instance",sequence:[{id:$t.AddTransparentExportBgs,up:n=>({...n,exportBackground:!0})},{id:$t.RemoveDialog,up:({dialog:n,...e})=>e},{id:$t.AddToolLockMode,up:n=>({...n,isToolLocked:!1})},{id:$t.RemoveExtraPropsForNextShape,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:Object.fromEntries(Object.entries(n).filter(([t])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(t)))})},{id:$t.AddLabelColor,up:({propsForNextShape:n,...e})=>({...e,propsForNextShape:{...n,labelColor:"black"}})},{id:$t.AddFollowingUserId,up:n=>({...n,followingUserId:null})},{id:$t.RemoveAlignJustify,up:n=>{let e=n.propsForNextShape.align;return e==="justify"&&(e="start"),{...n,propsForNextShape:{...n.propsForNextShape,align:e}}}},{id:$t.AddZoom,up:n=>({...n,zoomBrush:null})},{id:$t.AddVerticalAlign,up:n=>({...n,propsForNextShape:{...n.propsForNextShape,verticalAlign:"middle"}})},{id:$t.AddScribbleDelay,up:n=>n.scribble!==null?{...n,scribble:{...n.scribble,delay:0}}:{...n}},{id:$t.RemoveUserId,up:({userId:n,...e})=>e},{id:$t.AddIsPenModeAndIsGridMode,up:n=>({...n,isPenMode:!1,isGridMode:!1})},{id:$t.HoistOpacity,up:({propsForNextShape:{opacity:n,...e},...t})=>({...t,opacityForNextShape:Number(n??"1"),propsForNextShape:e})},{id:$t.AddChat,up:n=>({...n,chatMessage:"",isChatting:!1})},{id:$t.AddHighlightedUserIds,up:n=>({...n,highlightedUserIds:[]})},{id:$t.ReplacePropsForNextShapeWithStylesForNextShape,up:({propsForNextShape:n,...e})=>({...e,stylesForNextShape:{}})},{id:$t.AddMeta,up:n=>({...n,meta:{}})},{id:$t.RemoveCursorColor,up:n=>{const{color:e,...t}=n.cursor;return{...n,cursor:t}}},{id:$t.AddLonelyProperties,up:n=>({...n,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1})},{id:$t.ReadOnlyReadonly,up:({isReadOnly:n,...e})=>({...e,isReadonly:n})},{id:$t.AddHoveringCanvas,up:n=>({...n,isHoveringCanvas:null})},{id:$t.AddScribbles,up:({scribble:n,...e})=>({...e,scribbles:[]})},{id:$t.AddInset,up:n=>({...n,insets:[!1,!1,!1,!1]}),down:({insets:n,...e})=>({...e})},{id:$t.AddDuplicateProps,up:n=>({...n,duplicateProps:null}),down:({duplicateProps:n,...e})=>({...e})},{id:$t.RemoveCanMoveCamera,up:({canMoveCamera:n,...e})=>({...e}),down:n=>({...n,canMoveCamera:!0})}]}),ir="instance:instance",aU=Hs("instance_page_state",ot({typeName:Qn("instance_page_state"),id:to("instance_page_state"),pageId:Od,selectedShapeIds:Tn(_o),hintingShapeIds:Tn(_o),erasingShapeIds:Tn(_o),hoveredShapeId:_o.nullable(),editingShapeId:_o.nullable(),croppingShapeId:_o.nullable(),focusedGroupId:_o.nullable(),meta:Mn})),Gu=Nr("com.tldraw.instance_page_state",{AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5}),lU=io({sequenceId:"com.tldraw.instance_page_state",recordType:"instance_page_state",sequence:[{id:Gu.AddCroppingId,up(n){n.croppingShapeId=null}},{id:Gu.RemoveInstanceIdAndCameraId,up(n){delete n.instanceId,delete n.cameraId}},{id:Gu.AddMeta,up:n=>{n.meta={}}},{id:Gu.RenameProperties,up:n=>{},down:n=>{}},{id:Gu.RenamePropertiesAgain,up:n=>{n.selectedShapeIds=n.selectedIds,delete n.selectedIds,n.hintingShapeIds=n.hintingIds,delete n.hintingIds,n.erasingShapeIds=n.erasingIds,delete n.erasingIds,n.hoveredShapeId=n.hoveredId,delete n.hoveredId,n.editingShapeId=n.editingId,delete n.editingId,n.croppingShapeId=n.croppingShapeId??n.croppingId??null,delete n.croppingId,n.focusedGroupId=n.focusLayerId,delete n.focusLayerId},down:n=>{n.selectedIds=n.selectedShapeIds,delete n.selectedShapeIds,n.hintingIds=n.hintingShapeIds,delete n.hintingShapeIds,n.erasingIds=n.erasingShapeIds,delete n.erasingShapeIds,n.hoveredId=n.hoveredShapeId,delete n.hoveredShapeId,n.editingId=n.editingShapeId,delete n.editingShapeId,n.croppingId=n.croppingShapeId,delete n.croppingShapeId,n.focusLayerId=n.focusedGroupId,delete n.focusedGroupId}}]}),Xo=Us("instance_page_state",{validator:aU,scope:"session",ephemeralKeys:{pageId:!1,selectedShapeIds:!1,editingShapeId:!1,croppingShapeId:!1,meta:!1,hintingShapeIds:!0,erasingShapeIds:!0,hoveredShapeId:!0,focusedGroupId:!0}}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),cU=Hs("pointer",ot({typeName:Qn("pointer"),id:to("pointer"),x:We,y:We,lastActivityTimestamp:We,meta:Mn})),uU=Nr("com.tldraw.pointer",{AddMeta:1}),dU=io({sequenceId:"com.tldraw.pointer",recordType:"pointer",sequence:[{id:uU.AddMeta,up:n=>{n.meta={}}}]}),r1=Us("pointer",{validator:cU,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),og=r1.createId("pointer"),hU=Hs("instance_presence",ot({typeName:Qn("instance_presence"),id:to("instance_presence"),userId:Qe,userName:Qe,lastActivityTimestamp:We,followingUserId:Qe.nullable(),cursor:ot({x:We,y:We,type:hj,rotation:We}),color:Qe,camera:ot({x:We,y:We,z:We}),screenBounds:wd,selectedShapeIds:Tn(to("shape")),currentPageId:to("page"),brush:wd.nullable(),scribbles:Tn(pj),chatMessage:Qe,meta:Mn})),qu=Nr("com.tldraw.instance_presence",{AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5}),pU=io({sequenceId:"com.tldraw.instance_presence",recordType:"instance_presence",sequence:[{id:qu.AddScribbleDelay,up:n=>{n.scribble!==null&&(n.scribble.delay=0)}},{id:qu.RemoveInstanceId,up:n=>{delete n.instanceId}},{id:qu.AddChatMessage,up:n=>{n.chatMessage=""}},{id:qu.AddMeta,up:n=>{n.meta={}}},{id:qu.RenameSelectedShapeIds,up:n=>{}}]}),fU=Us("instance_presence",{validator:hU,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),gU=Hs("document",ot({typeName:Qn("document"),id:Qn("document:document"),gridSize:We,name:Qe,meta:Mn})),Y2=Nr("com.tldraw.document",{AddName:1,AddMeta:2}),mU=io({sequenceId:"com.tldraw.document",recordType:"document",sequence:[{id:Y2.AddName,up:n=>{n.name=""},down:n=>{delete n.name}},{id:Y2.AddMeta,up:n=>{n.meta={}}}]}),o1=Us("document",{validator:gU,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),cw=o1.createId("document");function yU(n,e){return n.index<e.index?-1:n.index>e.index?1:0}function X2(n){n.typeName==="asset"&&("src"in n&&(n.src="<redacted>"),"src"in n.props&&(n.props.src="<redacted>"))}function vU({error:n,phase:e,record:t,recordBefore:r}){throw Cb(n,{tags:{origin:"store.validateRecord",storePhase:e,isExistingValidationIssue:e==="initialize"},extras:{recordBefore:r?X2(zt(r)):void 0,recordAfter:X2(zt(t))}}),n}function SU(){return[so.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function xU(n){const e=n.query.ids("page"),t=n.query.records("instance_page_state"),r=()=>{if(!n.has(cw))return n.put([o1.create({id:cw,name:n.props.defaultName})]),r();if(!n.has(og))return n.put([r1.create({id:og})]),r();const o=e.get();if(o.size===0)return n.put(SU()),r();const s=()=>[...o].map(h=>n.get(h)).sort(yU)[0].id,i=n.get(ir);if(i){if(!o.has(i.currentPageId))return n.put([{...i,currentPageId:s()}]),r()}else return n.put([n.schema.types.instance.create({id:ir,currentPageId:s(),exportBackground:!0})]),r();const a=new Set,c=new Set;for(const h of o){const f=Xo.createId(h);n.get(f)||a.add(f);const y=Es.createId(h);n.has(y)||c.add(y)}a.size>0&&n.put([...a].map(h=>Xo.create({id:h,pageId:Xo.parseId(h)}))),c.size>0&&n.put([...c].map(h=>Es.create({id:h})));const u=t.get();for(const h of u){if(!o.has(h.pageId)){n.remove([h.id]);continue}if(h.croppingShapeId&&!n.has(h.croppingShapeId))return n.put([{...h,croppingShapeId:null}]),r();if(h.focusedGroupId&&!n.has(h.focusedGroupId))return n.put([{...h,focusedGroupId:null}]),r();if(h.hoveredShapeId&&!n.has(h.hoveredShapeId))return n.put([{...h,hoveredShapeId:null}]),r();const f=h.selectedShapeIds.filter(v=>n.has(v));if(f.length!==h.selectedShapeIds.length)return n.put([{...h,selectedShapeIds:f}]),r();const g=h.hintingShapeIds.filter(v=>n.has(v));if(g.length!==h.hintingShapeIds.length)return n.put([{...h,hintingShapeIds:g}]),r();const y=h.erasingShapeIds.filter(v=>n.has(v));if(y.length!==h.erasingShapeIds.length)return n.put([{...h,erasingShapeIds:y}]),r()}};return r}const wU=t1("bookmark",ot({title:Qe,description:Qe,image:Qe,favicon:Qe,src:dl.nullable()})),Z2=Nr("com.tldraw.asset.bookmark",{MakeUrlsValid:1,AddFavicon:2}),bU=io({sequenceId:"com.tldraw.asset.bookmark",recordType:"asset",filter:n=>n.type==="bookmark",sequence:[{id:Z2.MakeUrlsValid,up:n=>{dl.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:Z2.AddFavicon,up:n=>{dl.isValid(n.props.favicon)||(n.props.favicon="")},down:n=>{delete n.props.favicon}}]}),_U=t1("image",ot({w:We,h:We,name:Qe,isAnimated:nt,mimeType:Qe.nullable(),src:dl.nullable(),fileSize:ln.optional()})),Yu=Nr("com.tldraw.asset.image",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),PU=io({sequenceId:"com.tldraw.asset.image",recordType:"asset",filter:n=>n.type==="image",sequence:[{id:Yu.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:Yu.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:Yu.MakeUrlsValid,up:n=>{dl.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:Yu.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:Yu.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),CU=t1("video",ot({w:We,h:We,name:Qe,isAnimated:nt,mimeType:Qe.nullable(),src:dl.nullable(),fileSize:We.optional()})),Xu=Nr("com.tldraw.asset.video",{AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3,AddFileSize:4,MakeFileSizeOptional:5}),IU=io({sequenceId:"com.tldraw.asset.video",recordType:"asset",filter:n=>n.type==="video",sequence:[{id:Xu.AddIsAnimated,up:n=>{n.props.isAnimated=!1},down:n=>{delete n.props.isAnimated}},{id:Xu.RenameWidthHeight,up:n=>{n.props.w=n.props.width,n.props.h=n.props.height,delete n.props.width,delete n.props.height},down:n=>{n.props.width=n.props.w,n.props.height=n.props.h,delete n.props.w,delete n.props.h}},{id:Xu.MakeUrlsValid,up:n=>{dl.isValid(n.props.src)||(n.props.src="")},down:n=>{}},{id:Xu.AddFileSize,up:n=>{n.props.fileSize=-1},down:n=>{delete n.props.fileSize}},{id:Xu.MakeFileSizeOptional,up:n=>{n.props.fileSize===-1&&(n.props.fileSize=void 0)},down:n=>{n.props.fileSize===void 0&&(n.props.fileSize=-1)}}]}),EU=Hs("asset",Qb("type",{image:_U,video:CU,bookmark:wU})),kU=Nr("com.tldraw.asset",{AddMeta:1}),TU=io({sequenceId:"com.tldraw.asset",recordType:"asset",sequence:[{id:kU.AddMeta,up:n=>{n.meta={}}}]}),sa=Us("asset",{validator:EU,scope:"document"}).withDefaultProperties(()=>({meta:{}})),gj={w:ln,h:ln,assetId:Kg.nullable(),url:ro},Q2=os("bookmark",{NullAssetId:1,MakeUrlsValid:2}),mj={sequence:[{id:Q2.NullAssetId,up:n=>{n.assetId===void 0&&(n.assetId=null)},down:"retired"},{id:Q2.MakeUrlsValid,up:n=>{ro.isValid(n.url)||(n.url="")},down:n=>{}}]},yj=ot({type:Hg("free","straight"),points:Tn(hl)}),vj={color:oo,fill:fl,dash:pl,size:Fs,segments:Tn(yj),isComplete:nt,isClosed:nt,isPen:nt,scale:ln},J2=os("draw",{AddInPen:1,AddScale:2}),Sj={sequence:[{id:J2.AddInPen,up:n=>{const{points:e}=n.segments[0];if(e.length===0){n.isPen=!1;return}let t=!(e[0].z===0||e[0].z===.5);e[1]&&(t=t&&!(e[1].z===0||e[1].z===.5)),n.isPen=t},down:"retired"},{id:J2.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},MU=/(^\/r\/[^/]+\/?$)/,AU=[{hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(MU))return n}},{hostnames:["figma.com"],fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{hostnames:["google.*"],fromEmbedUrl:n=>{const e=Ge(n);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[o,s]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${o},${s},${r}z`}}},{hostnames:["val.town"],fromEmbedUrl:n=>{const e=Ge(n),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{hostnames:["codesandbox.io"],fromEmbedUrl:n=>{const e=Ge(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{hostnames:["codepen.io"],fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,o,s]=t;return`https://codepen.io/${o}/pen/${s}`}}},{hostnames:["scratch.mit.edu"],fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,o]=t;return`https://scratch.mit.edu/projects/${o}`}}},{hostnames:["*.youtube.com","youtube.com","youtu.be"],fromEmbedUrl:n=>{const e=Ge(n);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{hostnames:["calendar.google.*"],fromEmbedUrl:n=>{const e=Ge(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const o of r)e.searchParams.delete(o);return e.searchParams.set("cid",t),e.href}}},{hostnames:["docs.google.*"],fromEmbedUrl:n=>{const e=Ge(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}}},{hostnames:["gist.github.com"],fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{hostnames:["replit.com"],fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{hostnames:["felt.com"],fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{hostnames:["open.spotify.com"],fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{hostnames:["vimeo.com","player.vimeo.com"],fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{hostnames:["excalidraw.com"],fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.hash.match(/#room=/))return n}},{hostnames:["observablehq.com"],fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{hostnames:["desmos.com"],fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return n.replace("?embed","")}}],xj={w:ln,h:ln,url:Qe},Ep=os("embed",{GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4}),wj={sequence:[{id:Ep.GenOriginalUrlInEmbed,up:n=>{try{const e=n.url,t=new URL(e).host.replace("www.","");let r;for(const o of AU)if(o.hostnames.includes(t))try{r=o.fromEmbedUrl(e)}catch(s){console.warn(s)}n.tmpOldUrl=n.url,n.url=r??""}catch{n.url="",n.tmpOldUrl=n.url}},down:"retired"},{id:Ep.RemoveDoesResize,up:n=>{delete n.doesResize},down:"retired"},{id:Ep.RemoveTmpOldUrl,up:n=>{delete n.tmpOldUrl},down:"retired"},{id:Ep.RemovePermissionOverrides,up:n=>{delete n.overridePermissions},down:"retired"}]},bj={w:ln,h:ln,name:Qe},_j={sequence:[]},sg=Dn.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),ig=Dn.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),Zo=Dn.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box","heart"]}),Pj={geo:Zo,labelColor:n1,color:oo,fill:fl,dash:pl,size:Fs,font:Ls,align:sg,verticalAlign:ig,url:ro,w:ln,h:ln,growY:Jf,text:Qe,scale:ln},si=os("geo",{AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8,AddScale:9}),Cj={sequence:[{id:si.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:si.AddLabelColor,up:n=>{n.labelColor="black"},down:"retired"},{id:si.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:si.AddCheckBox,up:n=>{},down:"retired"},{id:si.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:si.MigrateLegacyAlign,up:n=>{let e;switch(n.align){case"start":e="start-legacy";break;case"end":e="end-legacy";break;default:e="middle-legacy";break}n.align=e},down:"retired"},{id:si.AddCloud,up:n=>{},down:"retired"},{id:si.MakeUrlsValid,up:n=>{ro.isValid(n.url)||(n.url="")},down:n=>{}},{id:si.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},Ij={},Ej={sequence:[]},kj={color:oo,size:Fs,segments:Tn(yj),isComplete:nt,isPen:nt,scale:ln},jU=os("highlight",{AddScale:1}),Tj={sequence:[{id:jU.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},RU=ot({topLeft:hl,bottomRight:hl}),Mj={w:ln,h:ln,playing:nt,url:ro,assetId:Kg.nullable(),crop:RU.nullable(),flipX:nt,flipY:nt},kp=os("image",{AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3,AddFlipProps:4}),Aj={sequence:[{id:kp.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:kp.AddCropProp,up:n=>{n.crop=null},down:n=>{delete n.crop}},{id:kp.MakeUrlsValid,up:n=>{ro.isValid(n.url)||(n.url="")},down:n=>{}},{id:kp.AddFlipProps,up:n=>{n.flipX=!1,n.flipY=!1},down:n=>{delete n.flipX,delete n.flipY}}]},ag=Dn.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),OU=ot({id:Qe,index:e1,x:We,y:We}),jj={color:oo,dash:pl,size:Fs,spline:ag,points:eg(Qe,OU),scale:ln},Zu=os("line",{AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4,AddScale:5}),Rj={sequence:[{id:Zu.AddSnapHandles,up:n=>{for(const e of Object.values(n.handles))e.canSnap=!0},down:"retired"},{id:Zu.RemoveExtraHandleProps,up:n=>{n.handles=Eb(Object.values(n.handles).map(e=>[e.index,{x:e.x,y:e.y}]))},down:n=>{const e=Object.entries(n.handles).map(([t,r])=>({index:t,...r})).sort(Gn);n.handles=Object.fromEntries(e.map((t,r)=>{const o=r===0?"start":r===e.length-1?"end":`handle:${t.index}`;return[o,{id:o,type:"vertex",canBind:!1,canSnap:!0,index:t.index,x:t.x,y:t.y}]}))}},{id:Zu.HandlesToPoints,up:n=>{const e=Object.entries(n.handles).map(([t,{x:r,y:o}])=>({x:r,y:o,index:t})).sort(Gn);n.points=e.map(({x:t,y:r})=>({x:t,y:r})),delete n.handles},down:n=>{const e=Rd(n.points.length);n.handles=Object.fromEntries(n.points.map((t,r)=>[e[r],{x:t.x,y:t.y}])),delete n.points}},{id:Zu.PointIndexIds,up:n=>{const e=Rd(n.points.length);n.points=Object.fromEntries(n.points.map((t,r)=>{const o=e[r];return[o,{id:o,index:o,x:t.x,y:t.y}]}))},down:n=>{const e=Object.values(n.points).sort(Gn);n.points=e.map(({x:t,y:r})=>({x:t,y:r}))}},{id:Zu.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}}]},Oj={color:oo,labelColor:n1,size:Fs,font:Ls,fontSizeAdjustment:Jf,align:sg,verticalAlign:ig,growY:Jf,url:ro,text:Qe,scale:ln},Qi=os("note",{AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5,AddFontSizeAdjustment:6,AddScale:7,AddLabelColor:8}),Dj={sequence:[{id:Qi.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:Qi.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:Qi.MigrateLegacyAlign,up:n=>{switch(n.align){case"start":n.align="start-legacy";return;case"end":n.align="end-legacy";return;default:n.align="middle-legacy";return}},down:"retired"},{id:Qi.AddVerticalAlign,up:n=>{n.verticalAlign="middle"},down:"retired"},{id:Qi.MakeUrlsValid,up:n=>{ro.isValid(n.url)||(n.url="")},down:n=>{}},{id:Qi.AddFontSizeAdjustment,up:n=>{n.fontSizeAdjustment=0},down:n=>{delete n.fontSizeAdjustment}},{id:Qi.AddScale,up:n=>{n.scale=1},down:n=>{delete n.scale}},{id:Qi.AddLabelColor,up:n=>{n.labelColor="black"},down:n=>{delete n.labelColor}}]},uw=Dn.defineEnum("tldraw:textAlign",{defaultValue:"start",values:["start","middle","end"]}),Lj={color:oo,size:Fs,font:Ls,textAlign:uw,w:ln,text:Qe,scale:ln,autoSize:nt},ek=os("text",{RemoveJustify:1,AddTextAlign:2}),Fj={sequence:[{id:ek.RemoveJustify,up:n=>{n.align==="justify"&&(n.align="start")},down:"retired"},{id:ek.AddTextAlign,up:n=>{n.textAlign=n.align,delete n.align},down:n=>{n.align=n.textAlign,delete n.textAlign}}]},Nj={w:ln,h:ln,time:We,playing:nt,url:ro,assetId:Kg.nullable()},tk=os("video",{AddUrlProp:1,MakeUrlsValid:2}),$j={sequence:[{id:tk.AddUrlProp,up:n=>{n.url=""},down:"retired"},{id:tk.MakeUrlsValid,up:n=>{ro.isValid(n.url)||(n.url="")},down:n=>{}}]},Tp=Nr("com.tldraw.store",{RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4}),DU=Oc({sequenceId:"com.tldraw.store",retroactive:!1,sequence:[{id:Tp.RemoveCodeAndIconShapeTypes,scope:"store",up:n=>{for(const[e,t]of Lr(n))t.typeName==="shape"&&(t.type==="icon"||t.type==="code")&&delete n[e]}},{id:Tp.AddInstancePresenceType,scope:"store",up(n){}},{id:Tp.RemoveTLUserAndPresenceAndAddPointer,scope:"store",up:n=>{for(const[e,t]of Lr(n))t.typeName.match(/^(user|user_presence)$/)&&delete n[e]}},{id:Tp.RemoveUserDocument,scope:"store",up:n=>{for(const[e,t]of Lr(n))t.typeName.match("user_document")&&delete n[e]}}]}),LU={arrow:{migrations:cj,props:lj},bookmark:{migrations:mj,props:gj},draw:{migrations:Sj,props:vj},embed:{migrations:wj,props:xj},frame:{migrations:_j,props:bj},geo:{migrations:Cj,props:Pj},group:{migrations:Ej,props:Ij},highlight:{migrations:Tj,props:kj},image:{migrations:Aj,props:Mj},line:{migrations:Rj,props:jj},note:{migrations:Dj,props:Oj},text:{migrations:Fj,props:Lj},video:{migrations:$j,props:Nj}},FU={arrow:{migrations:dj,props:uj}};function NU({shapes:n=LU,bindings:e=FU,migrations:t}={}){const r=new Map;for(const a of qt(n))for(const c of rj(a.props??{}).keys()){if(r.has(c.id)&&r.get(c.id)!==c)throw new Error(`Multiple StyleProp instances with the same id: ${c.id}`);r.set(c.id,c)}const o=V9(n),s=H9(e),i=sU(r);return Xb.create({asset:sa,binding:s,camera:Es,document:o1,instance:i,instance_page_state:Xo,page:so,instance_presence:fU,pointer:r1,shape:o},{migrations:[DU,TU,Y9,mU,iU,lU,rU,pU,dU,W9,bU,PU,IU,...q2("shape",n),...q2("binding",e),...t??[]],onValidationFailure:vU,createIntegrityChecker:xU})}const Dd=[{locale:"id",label:"Bahasa Indonesia"},{locale:"ca",label:"Català"},{locale:"cs",label:"Čeština"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Español"},{locale:"fr",label:"Français"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Português - Brasil"},{locale:"pt-pt",label:"Português - Europeu"},{locale:"ro",label:"Română"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Slovenščina"},{locale:"so",label:"Somali"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Tiếng Việt"},{locale:"tr",label:"Türkçe"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:"עברית"},{locale:"ar",label:"عربي"},{locale:"fa",label:"فارسی"},{locale:"ku",label:"کوردی"},{locale:"ne",label:"नेपाली"},{locale:"hi-in",label:"हिन्दी"},{locale:"te",label:"తెలుగు"},{locale:"th",label:"ภาษาไทย"},{locale:"my",label:"မြန်မာစာ"},{locale:"ko-kr",label:"한국어"},{locale:"ja",label:"日本語"},{locale:"zh-cn",label:"简体中文"},{locale:"zh-tw",label:"繁體中文 (台灣)"}];function $U(){const n=typeof window<"u"?window.navigator.languages??["en"]:["en"];return zU(n)}function zU(n){for(const e of n){const t=BU(e);if(t)return t}return"en"}const nk={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function BU(n){const e=Dd.find(o=>o.locale===n.toLowerCase());if(e)return e.locale;const[t,r]=n.split(/[-_]/).map(o=>o.toLowerCase());if(r){const o=Dd.find(s=>s.locale===t);if(o)return o.locale}return t in nk?nk[t]:null}ba("@tldraw/tlschema","3.6.0","esm");var R0={exports:{}},Qu={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var rk;function UU(){if(rk)return Qu;rk=1;var n=Vb(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),r=Object.prototype.hasOwnProperty,o=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,s={key:!0,ref:!0,__self:!0,__source:!0};function i(a,c,u){var h,f={},g=null,y=null;u!==void 0&&(g=""+u),c.key!==void 0&&(g=""+c.key),c.ref!==void 0&&(y=c.ref);for(h in c)r.call(c,h)&&!s.hasOwnProperty(h)&&(f[h]=c[h]);if(a&&a.defaultProps)for(h in c=a.defaultProps,c)f[h]===void 0&&(f[h]=c[h]);return{$$typeof:e,type:a,key:g,ref:y,props:f,_owner:o.current}}return Qu.Fragment=t,Qu.jsx=i,Qu.jsxs=i,Qu}var ok;function HU(){return ok||(ok=1,R0.exports=UU()),R0.exports}var p=HU(),O0={exports:{}};/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/var sk;function KU(){return sk||(sk=1,function(n){(function(){var e={}.hasOwnProperty;function t(){for(var s="",i=0;i<arguments.length;i++){var a=arguments[i];a&&(s=o(s,r(a)))}return s}function r(s){if(typeof s=="string"||typeof s=="number")return s;if(typeof s!="object")return"";if(Array.isArray(s))return t.apply(null,s);if(s.toString!==Object.prototype.toString&&!s.toString.toString().includes("[native code]"))return s.toString();var i="";for(var a in s)e.call(s,a)&&s[a]&&(i=o(i,a));return i}function o(s,i){return i?s?s+" "+i:s+i:s}n.exports?(t.default=t,n.exports=t):window.classNames=t})()}(O0)),O0.exports}var WU=KU();const Fe=wa(WU),zj="3.6.0",ik={major:"2024-09-13T14:36:29.063Z",minor:"2024-12-04T15:00:05.881Z",patch:"2024-12-04T15:00:05.881Z"},VU={error:null};class s1 extends C.Component{constructor(){super(...arguments);j(this,"state",VU)}static getDerivedStateFromError(t){return{error:t}}componentDidCatch(t){var r,o;(o=(r=this.props).onError)==null||o.call(r,t)}render(){const{error:t}=this.state;if(t!==null){const{fallback:r}=this.props;return p.jsx(r,{error:t})}return this.props.children}}function Ld({children:n,fallback:e,...t}){return e===null?n:p.jsx(s1,{fallback:e,...t,children:n})}function i1(n,e){return Wg(`${n}_${e}`)}function nu(n){return Wg(`${C.useId()}${n??""}`)}function Jo(n){const e=Mr(C.useContext(Bj));return Wg(`${e}_${n}`)}function Wg(n){return n.replace(/:/g,"_")}const Bj=C.createContext(null);function GU({children:n}){const e=nu();return p.jsx(Bj.Provider,{value:e,children:n})}const a1=C.createContext(null);function te(){const n=at.useContext(a1);if(!n)throw new Error("useEditor must be used inside of the <Tldraw /> or <TldrawEditor /> components");return n}function Ia(){return at.useContext(a1)}function l1({editor:n,children:e}){return p.jsx(a1.Provider,{value:n,children:p.jsx(GU,{children:e})})}function qU(){return p.jsx("div",{className:"tl-background"})}function ru(n,e,t,r,o,s){C.useLayoutEffect(()=>{const i=n.current;if(!i||e===void 0)return;let a=`translate(${e}px, ${t}px)`;r!==void 0&&(a+=` scale(${r})`),o!==void 0&&(a+=` rotate(${o}rad)`),s&&(a+=` translate(${s.x}px, ${s.y}px)`),i.style.transform=a})}const xn={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>n*(2-n),easeInOutQuad:n=>n<.5?2*n*n:-1+(4-2*n)*n,easeInCubic:n=>n*n*n,easeOutCubic:n=>--n*n*n+1,easeInOutCubic:n=>n<.5?4*n*n*n:(n-1)*(2*n-2)*(2*n-2)+1,easeInQuart:n=>n*n*n*n,easeOutQuart:n=>1- --n*n*n*n,easeInOutQuart:n=>n<.5?8*n*n*n*n:1-8*--n*n*n*n,easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>1+--n*n*n*n*n,easeInOutQuint:n=>n<.5?16*n*n*n*n*n:1+16*--n*n*n*n*n,easeInSine:n=>1-Math.cos(n*Math.PI/2),easeOutSine:n=>Math.sin(n*Math.PI/2),easeInOutSine:n=>-(Math.cos(Math.PI*n)-1)/2,easeInExpo:n=>n<=0?0:Math.pow(2,10*n-10),easeOutExpo:n=>n>=1?1:1-Math.pow(2,-10*n),easeInOutExpo:n=>n<=0?0:n>=1?1:n<.5?Math.pow(2,20*n-10)/2:(2-Math.pow(2,-20*n+10))/2};class P{constructor(e=0,t=0,r=1){this.x=e,this.y=t,this.z=r}get pressure(){return this.z}set(e=this.x,t=this.y,r=this.z){return this.x=e,this.y=t,this.z=r,this}setTo({x:e=0,y:t=0,z:r=1}){return this.x=e,this.y=t,this.z=r,this}rot(e){if(e===0)return this;const{x:t,y:r}=this,o=Math.sin(e),s=Math.cos(e);return this.x=t*s-r*o,this.y=t*o+r*s,this}rotWith(e,t){if(t===0)return this;const r=this.x-e.x,o=this.y-e.y,s=Math.sin(t),i=Math.cos(t);return this.x=e.x+(r*i-o*s),this.y=e.y+(r*s+o*i),this}clone(){const{x:e,y:t,z:r}=this;return new P(e,t,r)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),t!==void 0&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){const r=P.Tan(e,this);return this.add(r.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return P.Dpr(this,e)}cpr(e){return P.Cpr(this,e)}len2(){return P.Len2(this)}len(){return P.Len(this)}pry(e){return P.Pry(this,e)}per(){const{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return P.Uni(this)}tan(e){return P.Tan(this,e)}dist(e){return P.Dist(this,e)}distanceToLineSegment(e,t){return P.DistanceToLineSegment(e,t,this)}slope(e){return P.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return P.Angle(this,e)}toAngle(){return P.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return P.Equals(this,e)}equalsXY(e,t){return P.EqualsXY(this,e,t)}norm(){const e=this.len();return this.x=e===0?0:this.x/e,this.y=e===0?0:this.y/e,this}toFixed(){return P.ToFixed(this)}toString(){return P.ToString(P.ToFixed(this))}toJson(){return P.ToJson(this)}toArray(){return P.ToArray(this)}static Add(e,t){return new P(e.x+t.x,e.y+t.y)}static AddXY(e,t,r){return new P(e.x+t,e.y+r)}static Sub(e,t){return new P(e.x-t.x,e.y-t.y)}static SubXY(e,t,r){return new P(e.x-t,e.y-r)}static AddScalar(e,t){return new P(e.x+t,e.y+t)}static SubScalar(e,t){return new P(e.x-t,e.y-t)}static Div(e,t){return new P(e.x/t,e.y/t)}static Mul(e,t){return new P(e.x*t,e.y*t)}static DivV(e,t){return new P(e.x/t.x,e.y/t.y)}static MulV(e,t){return new P(e.x*t.x,e.y*t.y)}static Neg(e){return new P(-e.x,-e.y)}static Per(e){return new P(e.y,-e.x)}static Abs(e){return new P(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return((e.y-t.y)**2+(e.x-t.x)**2)**.5}static DistMin(e,t,r){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)<r**2}static Dist2(e,t){return(e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new P(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return(e.x*e.x+e.y*e.y)**.5}static Pry(e,t){return P.Dpr(e,t)/P.Len(t)}static Uni(e){return P.Div(e,P.Len(e))}static Tan(e,t){return P.Uni(P.Sub(e,t))}static Min(e,t){return new P(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new P(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:r=1}){return new P(e,t,r)}static FromArray(e){return new P(e[0],e[1])}static Rot(e,t=0){const r=Math.sin(t),o=Math.cos(t);return new P(e.x*o-e.y*r,e.x*r+e.y*o)}static RotWith(e,t,r){const o=e.x-t.x,s=e.y-t.y,i=Math.sin(r),a=Math.cos(r);return new P(t.x+(o*a-s*i),t.y+(o*i+s*a))}static NearestPointOnLineThroughPoint(e,t,r){return P.Mul(t,P.Sub(r,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,r,o=!0){if(P.Equals(e,r)||P.Equals(t,r))return P.From(r);const s=P.Tan(t,e),i=P.Add(e,P.Mul(s,P.Sub(r,e).pry(s)));if(o){if(i.x<Math.min(e.x,t.x))return P.Cast(e.x<t.x?e:t);if(i.x>Math.max(e.x,t.x))return P.Cast(e.x>t.x?e:t);if(i.y<Math.min(e.y,t.y))return P.Cast(e.y<t.y?e:t);if(i.y>Math.max(e.y,t.y))return P.Cast(e.y>t.y?e:t)}return i}static DistanceToLineThroughPoint(e,t,r){return P.Dist(r,P.NearestPointOnLineThroughPoint(e,t,r))}static DistanceToLineSegment(e,t,r,o=!0){return P.Dist(r,P.NearestPointOnLineSegment(e,t,r,o))}static Snap(e,t=1){return new P(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof P?e:P.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,r){return P.Sub(t,e).mul(r).add(e)}static Med(e,t){return new P((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return Math.abs(e.x-t.x)<1e-4&&Math.abs(e.y-t.y)<1e-4}static EqualsXY(e,t,r){return e.x===t&&e.y===r}static Clockwise(e,t,r){return(r.x-e.x)*(t.y-e.y)-(t.x-e.x)*(r.y-e.y)<0}static Rescale(e,t){const r=P.Len(e);return new P(t*e.x/r,t*e.y/r)}static ScaleWithOrigin(e,t,r){return P.Sub(e,r).mul(t).add(r)}static ToFixed(e){return new P(di(e.x),di(e.y))}static ToInt(e){return new P(parseInt(e.x.toFixed(0)),parseInt(e.y.toFixed(0)),parseInt((e.z??0).toFixed(0)))}static ToCss(e){return`${e.x},${e.y}`}static Nudge(e,t,r){return P.Add(e,P.Tan(t,e).mul(r))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=Math.PI*2),t}static FromAngle(e,t=1){return new P(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){const{x:t,y:r,z:o}=e;return{x:t,y:r,z:o}}static Average(e){const t=e.length,r=new P(0,0);if(t===0)return r;for(let o=0;o<t;o++)r.add(e[o]);return r.div(t)}static Clamp(e,t,r){return r===void 0?new P(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new P(Math.min(Math.max(e.x,t),r),Math.min(Math.max(e.y,t),r))}static PointsBetween(e,t,r=6){const o=[];for(let s=0;s<r;s++){const i=xn.easeInQuad(s/(r-1)),a=P.Lrp(e,t,i);a.z=Math.min(1,.5+Math.abs(.5-YU(i))*.65),o.push(a)}return o}static SnapToGrid(e,t=8){return new P(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}}const YU=n=>n<.5?2*n*n:-1+(4-2*n)*n;function pt(n){return`${ee(n.x)},${ee(n.y)} `}function Ar(n,e){return`${ee((n.x+e.x)/2)},${ee((n.y+e.y)/2)} `}const ft=Math.PI,Dt=ft/2,xt=ft*2,XU=Math.sin;function Cn(n,e,t){return Math.max(e,typeof t<"u"?Math.min(n,t):n)}function Mp(n,e=1e10){return n?Math.round(n*e)/e:0}function pa(n,e,t=1e-6){return Math.abs(n-e)<=t}function Uj(n,e){const t=Math.pow(n-e,2)/Math.pow(n+e,2);return ft*(n+e)*(1+3*t/(10+Math.sqrt(4-3*t)))}function ll(n){return n=n%xt,n<0?n=n+xt:n===0&&(n=0),n}function Zd(n,e){return n=ll(n),e=ll(e),n>e&&(e+=xt),e-n}function Hj(n,e){return xt-Zd(n,e)}function uf(n,e){const t=(e-n)%xt;return 2*t%xt-t}function dw(n){return(xt+n)%xt}function lg(n,e){const t=xt/e;let r=Math.floor((dw(n)+t/2)/t)*t%xt;return r<ft&&(r+=xt),r>ft&&(r-=xt),r}function Kj(n,e){return n===e||pa(n%(Math.PI/2)-e%(Math.PI/2),0)}function ZU(n){return n*ft/180}function QU(n){return n*180/ft}function gl(n,e,t){return new P(n.x,n.y).add(P.FromAngle(t,e))}function D0(n,e,t){const r=n/2,o=e/2,s=[];let i=1/0,a=-1/0,c=1/0,u=-1/0;for(let v=0;v<t;v++){const S=xt/t,w=-Dt+v*S,b=r+r*Math.cos(w),_=o+o*Math.sin(w);b<i&&(i=b),_<c&&(c=_),b>a&&(a=b),_>u&&(u=_),s.push(new P(b,_))}const h=a-i,f=u-c,g=n-h,y=e-f;if(g!==0||y!==0)for(let v=0;v<s.length;v++){const S=s[v];S.x=(S.x-i)/h*n,S.y=(S.y-c)/f*e}return s}function Ju(n,e,t,r){return n<r&&t<e}function Vo(n,e,t,r){const o=Math.max(n,t),s=Math.min(e,r);return o<=s?[o,s]:null}function ak(n,e,t){return(e.x-n.x)*(t.y-n.y)-(t.x-n.x)*(e.y-n.y)}function no(n,e){let t=0,r,o;for(let s=0;s<e.length;s++){if(r=e[s],r.x===n.x&&r.y===n.y||(o=e[(s+1)%e.length],P.Dist(n,r)+P.Dist(n,o)===P.Dist(r,o)))return!0;r.y<=n.y?o.y>n.y&&ak(r,o,n)>0&&(t+=1):o.y<=n.y&&ak(r,o,n)<0&&(t-=1)}return t!==0}function ee(n){return Math.round(n*1e4)/1e4}function di(n){return Math.round(n*100)/100}const lk=n=>Math.abs(n)<Number.MAX_SAFE_INTEGER;function ia(n,e,t){return t<0?Zd(n,e):Hj(n,e)}function hw(n,e,t,r){let o;if(Math.abs(n)>ft){o=uf(e,r);const s=uf(r,t);return Math.abs(o)<Math.abs(s)?o/n:(n-s)/n}else{o=uf(e,r);const s=o/n;return Math.sign(o)!==Math.sign(n)?Math.abs(s)>.5?1:0:s}}function JU(n,e,t,r){const o=2*((e-n)%xt)%xt-(e-n)%xt;return r?(xt-Math.abs(o))*(t?1:-1):o}function c1(n,e,t){const r=-2*(n.x*(e.y-t.y)-n.y*(e.x-t.x)+e.x*t.y-t.x*e.y),o=((n.x*n.x+n.y*n.y)*(t.y-e.y)+(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y))/r,s=((n.x*n.x+n.y*n.y)*(e.x-t.x)+(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x))/r;return!Number.isFinite(o)||!Number.isFinite(s)?null:new P(o,s)}function e7(n,e,t,r,o){if(t===null)return[P.From(n),P.From(e)];const s=[],i=P.Angle(t,n),a=P.Angle(t,e),c=Zd(i,a);for(let u=0;u<o;u++){const h=u/(o-1),f=i+c*h,g=gl(t,r,f);s.push(g)}return s}const L0=({brush:n,color:e,opacity:t,className:r})=>{const o=C.useRef(null);ru(o,n.x,n.y);const s=ee(Math.max(1,n.w)),i=ee(Math.max(1,n.h));return p.jsx("svg",{className:"tl-overlays__item",ref:o,children:e?p.jsxs("g",{className:"tl-brush",opacity:t,children:[p.jsx("rect",{width:s,height:i,fill:e,opacity:.75}),p.jsx("rect",{width:s,height:i,fill:"none",stroke:e,opacity:.1})]}):p.jsx("rect",{className:`tl-brush tl-brush__default ${r}`,width:s,height:i})})},kt={isSafari:!1,isIos:!1,isChromeForIos:!1,isFirefox:!1,isAndroid:!1,isWebview:!1,isDarwin:!1};typeof window<"u"&&"navigator"in window&&(kt.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),kt.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),kt.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),kt.isFirefox=/firefox/i.test(navigator.userAgent),kt.isAndroid=/android/i.test(navigator.userAgent),kt.isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1);const ck={isLocked:!1,wheelBehavior:"pan",panSpeed:1,zoomSpeed:1,zoomSteps:[.1,.25,.5,1,2,4,8]},F0={duration:0,easing:xn.easeInOutCubic},uk={CAMERA_MOVE:-10},t7=["top","right","bottom","left"],dk=0,u1=2,Ap=1,hk=5,n7=128;var N0={};const r7={},Wj=Cr("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),sn={logPreventDefaults:Cr("logPreventDefaults",{defaults:{all:!1}}),logPointerCaptures:Cr("logPointerCaptures",{defaults:{all:!1}}),logElementRemoves:Cr("logElementRemoves",{defaults:{all:!1}}),debugSvg:Cr("debugSvg",{defaults:{all:!1}}),showFps:Cr("showFps",{defaults:{all:!1}}),measurePerformance:Cr("measurePerformance",{defaults:{all:!1}}),throwToBlob:Cr("throwToBlob",{defaults:{all:!1}}),reconnectOnPing:Cr("reconnectOnPing",{defaults:{all:!1}}),debugCursors:Cr("debugCursors",{defaults:{all:!1}}),forceSrgb:Cr("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:Cr("debugGeometry",{defaults:{all:!1}}),hideShapes:Cr("hideShapes",{defaults:{all:!1}}),editOnType:Cr("editOnType",{defaults:{all:!1}})};if(typeof Element<"u"){const n=Element.prototype.removeChild;Ms("element removal logging",()=>{sn.logElementRemoves.get()?Element.prototype.removeChild=function(e){return console.warn("[tldraw] removing child:",e),n.call(this,e)}:Element.prototype.removeChild=n})}function Cr(n,{defaults:e,shouldStoreForSession:t=!0}){return o7({name:n,defaults:e,shouldStoreForSession:t})}function o7(n){const e=i7(n),t=n.shouldStoreForSession?s7(n.name):null,r=dn(`debug:${n.name}`,t??e);return typeof window<"u"&&(n.shouldStoreForSession&&Ms(`debug:${n.name}`,()=>{const o=r.get();o===e?dA(`tldraw_debug:${n.name}`):Rb(`tldraw_debug:${n.name}`,JSON.stringify(o))}),Object.defineProperty(window,`tldraw${n.name.replace(/^[a-z]/,o=>o.toUpperCase())}`,{get(){return r.get()},set(o){r.set(o)},configurable:!0})),Object.assign(r,n)}function s7(n){try{return JSON.parse(uA(`tldraw_debug:${n}`)??"null")}catch{return null}}function $0(n){try{return n()}catch{return null}}function i7(n){switch($0(()=>N0.TLDRAW_ENV)??$0(()=>N0.VERCEL_PUBLIC_TLDRAW_ENV)??$0(()=>N0.NEXT_PUBLIC_TLDRAW_ENV)??"production"){case"production":return n.defaults.production??n.defaults.all;case"preview":case"staging":return n.defaults.staging??n.defaults.all;default:return n.defaults.development??n.defaults.all}}function cg(n){if(n instanceof HTMLElement)return n;if(n.parentElement)return cg(n.parentElement);throw Error("Could not find a parent element of an HTML type!")}function et(n){n.preventDefault(),sn.logPreventDefaults.get()&&console.warn("preventDefault called on event:",n)}function Qd(n,e){if(n.setPointerCapture(e.pointerId),sn.logPointerCaptures.get()){const t=Wj.get();t.set(n,(t.get(n)??0)+1),console.warn("setPointerCapture called on element:",n,e)}}function Jd(n,e){if(n.hasPointerCapture(e.pointerId)&&(n.releasePointerCapture(e.pointerId),sn.logPointerCaptures.get())){const t=Wj.get();t.get(n)===1?t.delete(n):t.has(n)?t.set(n,t.get(n)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",n,e)}}const cn=n=>n.stopPropagation(),Hn=(n,e,t)=>{n&&n.style.setProperty(e,t)},qn=n=>kt.isDarwin?n.metaKey:n.ctrlKey||n.metaKey;function Qr(n){return n.isKilled=!0,{point:{x:n.clientX,y:n.clientY,z:n.pressure},shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey,metaKey:n.metaKey,accelKey:qn(n),pointerId:n.pointerId,button:n.button,isPen:n.pointerType==="pen"}}function d1(){const n=te();return C.useMemo(function(){let r,o;function s(S){if(!S.isKilled){if(S.button===u1){n.dispatch({type:"pointer",target:"canvas",name:"right_click",...Qr(S)});return}S.button!==0&&S.button!==1&&S.button!==5||(Qd(S.currentTarget,S),n.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...Qr(S)}))}}function i(S){S.isKilled||S.clientX===r&&S.clientY===o||(r=S.clientX,o=S.clientY,n.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...Qr(S)}))}function a(S){S.isKilled||S.button!==0&&S.button!==1&&S.button!==2&&S.button!==5||(r=S.clientX,o=S.clientY,Jd(S.currentTarget,S),n.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...Qr(S)}))}function c(S){if(S.isKilled||n.getInstanceState().isPenMode&&S.pointerType!=="pen")return;const w=S.pointerType==="mouse"||S.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:w?!0:null})}function u(S){if(S.isKilled||n.getInstanceState().isPenMode&&S.pointerType!=="pen")return;const w=S.pointerType==="mouse"||S.pointerType==="pen";n.updateInstanceState({isHoveringCanvas:w?!1:null})}function h(S){S.isKilled=!0,et(S)}function f(S){S.isKilled=!0,S.target instanceof HTMLElement&&S.target.tagName!=="A"&&S.target.tagName!=="TEXTAREA"&&!(n.getEditingShape()&&S.target.className.includes("tl-text-content"))&&et(S)}function g(S){et(S)}async function y(S){var b,_;if(et(S),cn(S),!((_=(b=S.dataTransfer)==null?void 0:b.files)!=null&&_.length))return;const w=Array.from(S.dataTransfer.files);await n.putExternalContent({type:"files",files:w,point:n.screenToPage({x:S.clientX,y:S.clientY}),ignoreParent:!1})}function v(S){cn(S)}return{onPointerDown:s,onPointerMove:i,onPointerUp:a,onPointerEnter:c,onPointerLeave:u,onDragOver:g,onDrop:y,onTouchStart:h,onTouchEnd:f,onClick:v}},[n])}function a7(){const n=te();C.useEffect(()=>{let e=n.getInstanceState().isCoarsePointer;const t=i=>{const a=i.pointerType!=="mouse";e!==a&&(e=a,n.updateInstanceState({isCoarsePointer:a}))};window.addEventListener("pointerdown",t,{capture:!0});const r=window.matchMedia&&window.matchMedia("(any-pointer: coarse)"),o=kt.isFirefox&&!kt.isAndroid&&!kt.isIos,s=()=>{const i=o?!1:r.matches;e===i&&(e=i,n.updateInstanceState({isCoarsePointer:i}))};return r&&(r.addEventListener("change",s),s()),()=>{window.removeEventListener("pointerdown",t,{capture:!0}),r&&r.removeEventListener("change",s)}},[n])}const Vj=C.createContext(null);function Gj({container:n,children:e}){return p.jsx(Vj.Provider,{value:n,children:e})}function fn(){return Mr(C.useContext(Vj),"useContainer used outside of <Tldraw />")}function l7(){const n=te(),e=fn(),t=re("isFocused",()=>n.getIsFocused(),[n]);C.useEffect(()=>{if(!e)return;function r(o){if(o.isSpecialRedispatchedEvent)return;et(o),cn(o);const s=e.querySelector(".tl-canvas");if(!s)return;const i=new DragEvent(o.type,o);i.isSpecialRedispatchedEvent=!0,s.dispatchEvent(i)}return e.addEventListener("dragover",r),e.addEventListener("drop",r),()=>{e.removeEventListener("dragover",r),e.removeEventListener("drop",r)}},[e]),C.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;let r=null;const o=()=>{r!=null&&r();const s=`(resolution: ${window.devicePixelRatio}dppx)`,i=matchMedia(s),a=c=>{c.type==="change"&&o()};i.addEventListener?i.addEventListener("change",o):i.addListener&&i.addListener(a),r=()=>{i.removeEventListener?i.removeEventListener("change",o):i.removeListener&&i.removeListener(a)},n.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return o(),()=>{r==null||r()}},[n]),C.useEffect(()=>{if(!t)return;const r=a=>{if(a.altKey&&(n.isIn("zoom")||!n.getPath().endsWith(".idle"))&&!jp(n)&&et(a),a.isKilled)return;switch(a.isKilled=!0,a.key){case"=":case"-":case"0":{if(a.metaKey||a.ctrlKey){et(a);return}break}case"Tab":{if(jp(n))return;break}case",":return;case"Escape":{if((n.getEditingShape()||n.getSelectedShapeIds().length>0)&&et(a),n.menus.getOpenMenus().length>0)return;n.inputs.keys.has("Escape")||(n.inputs.keys.add("Escape"),n.cancel(),e.focus());return}default:if(jp(n))return}const c={type:"keyboard",name:a.repeat?"key_repeat":"key_down",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:qn(a)};n.dispatch(c)},o=a=>{if(a.isKilled||(a.isKilled=!0,jp(n))||a.key===",")return;const c={type:"keyboard",name:"key_up",key:a.key,code:a.code,shiftKey:a.shiftKey,altKey:a.altKey,ctrlKey:a.metaKey||a.ctrlKey,metaKey:a.metaKey,accelKey:qn(a)};n.dispatch(c)};function s(a){var c,u;if(e.contains(a.target)){const h=a.touches[0].pageX,f=a.touches[0].radiusX||0;(h-f<10||h+f>n.getViewportScreenBounds().width-10)&&(((c=a.target)==null?void 0:c.tagName)==="BUTTON"&&((u=a.target)==null||u.click()),et(a))}}const i=a=>{e.contains(a.target)&&(a.ctrlKey||a.metaKey)&&et(a)};return e.addEventListener("touchstart",s,{passive:!1}),e.addEventListener("wheel",i,{passive:!1}),document.addEventListener("gesturestart",et),document.addEventListener("gesturechange",et),document.addEventListener("gestureend",et),e.addEventListener("keydown",r),e.addEventListener("keyup",o),()=>{e.removeEventListener("touchstart",s),e.removeEventListener("wheel",i),document.removeEventListener("gesturestart",et),document.removeEventListener("gesturechange",et),document.removeEventListener("gestureend",et),e.removeEventListener("keydown",r),e.removeEventListener("keyup",o)}},[n,e,t])}const c7=["input","select","button","textarea"];function jp(n){const{activeElement:e}=document;return n.menus.hasOpenMenus()||e&&(e.getAttribute("contenteditable")||c7.indexOf(e.tagName.toLowerCase())>-1)}const u7=["textarea","input"];function d7(n){const e=te();C.useEffect(()=>{const t=n.current;if(!t)return;const r=o=>{var s;if(o instanceof PointerEvent&&o.pointerType==="pen"){o.isKilled=!0;const{target:i}=o;if(u7.includes((s=i.tagName)==null?void 0:s.toLocaleLowerCase())||e.isIn("select.editing_shape"))return;et(o)}};return t.addEventListener("touchstart",r),t.addEventListener("touchend",r),()=>{t.removeEventListener("touchstart",r),t.removeEventListener("touchend",r)}},[e,n])}function h7(n,e,t){return Math.max(e,Math.min(n,t))}const An={toVector(n,e){return n===void 0&&(n=e),Array.isArray(n)?n:[n,n]},add(n,e){return[n[0]+e[0],n[1]+e[1]]},sub(n,e){return[n[0]-e[0],n[1]-e[1]]},addTo(n,e){n[0]+=e[0],n[1]+=e[1]},subTo(n,e){n[0]-=e[0],n[1]-=e[1]}};function pk(n,e,t){return e===0||Math.abs(e)===1/0?Math.pow(n,t*5):n*e*t/(e+t*n)}function fk(n,e,t,r=.15){return r===0?h7(n,e,t):n<e?-pk(e-n,t-e,r)+e:n>t?+pk(n-t,t-e,r)+t:n}function p7(n,[e,t],[r,o]){const[[s,i],[a,c]]=n;return[fk(e,s,i,r),fk(t,a,c,o)]}function f7(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function g7(n){var e=f7(n,"string");return typeof e=="symbol"?e:String(e)}function Wn(n,e,t){return e=g7(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function gk(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,r)}return t}function Yt(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?gk(Object(t),!0).forEach(function(r){Wn(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):gk(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}const qj={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function mk(n){return n?n[0].toUpperCase()+n.slice(1):""}const m7=["enter","leave"];function y7(n=!1,e){return n&&!m7.includes(e)}function v7(n,e="",t=!1){const r=qj[n],o=r&&r[e]||e;return"on"+mk(n)+mk(o)+(y7(t,o)?"Capture":"")}const S7=["gotpointercapture","lostpointercapture"];function x7(n){let e=n.substring(2).toLowerCase();const t=!!~e.indexOf("passive");t&&(e=e.replace("passive",""));const r=S7.includes(e)?"capturecapture":"capture",o=!!~e.indexOf(r);return o&&(e=e.replace("capture","")),{device:e,capture:o,passive:t}}function w7(n,e=""){const t=qj[n],r=t&&t[e]||e;return n+r}function Yj(n){return"touches"in n}function b7(n){return Yj(n)?"touch":"pointerType"in n?n.pointerType:"mouse"}function _7(n){return Array.from(n.touches).filter(e=>{var t,r;return e.target===n.currentTarget||((t=n.currentTarget)===null||t===void 0||(r=t.contains)===null||r===void 0?void 0:r.call(t,e.target))})}function pw(n,e){try{const t=e.clientX-n.clientX,r=e.clientY-n.clientY,o=(e.clientX+n.clientX)/2,s=(e.clientY+n.clientY)/2,i=Math.hypot(t,r);return{angle:-(Math.atan2(t,r)*180)/Math.PI,distance:i,origin:[o,s]}}catch{}return null}function P7(n){return _7(n).map(e=>e.identifier)}function yk(n,e){const[t,r]=Array.from(n.touches).filter(o=>e.includes(o.identifier));return pw(t,r)}const vk=40,Sk=800;function Xj(n){let{deltaX:e,deltaY:t,deltaMode:r}=n;return r===1?(e*=vk,t*=vk):r===2&&(e*=Sk,t*=Sk),[e,t]}function C7(n){const e={};if("buttons"in n&&(e.buttons=n.buttons),"shiftKey"in n){const{shiftKey:t,altKey:r,metaKey:o,ctrlKey:s}=n;Object.assign(e,{shiftKey:t,altKey:r,metaKey:o,ctrlKey:s})}return e}function ug(n,...e){return typeof n=="function"?n(...e):n}function I7(){}function E7(...n){return n.length===0?I7:n.length===1?n[0]:function(){let e;for(const t of n)e=t.apply(this,arguments)||e;return e}}function xk(n,e){return Object.assign({},e,n||{})}const k7=32;class Zj{constructor(e,t,r){this.ctrl=e,this.args=t,this.key=r,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){const{state:e,shared:t,ingKey:r,args:o}=this;t[r]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=o,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){const t=this.state,r=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=r.from?ug(r.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){const t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){const e=this.state;e._initial=e._values,e.initial=e.values}compute(e){const{state:t,config:r,shared:o}=this;t.args=this.args;let s=0;if(e&&(t.event=e,r.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,o.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,o.locked=!!document.pointerLockElement,Object.assign(o,C7(e)),o.down=o.pressed=o.buttons%2===1||o.touches>0,s=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){const A=t._delta.map(Math.abs);An.addTo(t._distance,A)}this.axisIntent&&this.axisIntent(e);const[i,a]=t._movement,[c,u]=r.threshold,{_step:h,values:f}=t;if(r.hasCustomTransform?(h[0]===!1&&(h[0]=Math.abs(i)>=c&&f[0]),h[1]===!1&&(h[1]=Math.abs(a)>=u&&f[1])):(h[0]===!1&&(h[0]=Math.abs(i)>=c&&Math.sign(i)*c),h[1]===!1&&(h[1]=Math.abs(a)>=u&&Math.sign(a)*u)),t.intentional=h[0]!==!1||h[1]!==!1,!t.intentional)return;const g=[0,0];if(r.hasCustomTransform){const[A,R]=f;g[0]=h[0]!==!1?A-h[0]:0,g[1]=h[1]!==!1?R-h[1]:0}else g[0]=h[0]!==!1?i-h[0]:0,g[1]=h[1]!==!1?a-h[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(g);const y=t.offset,v=t._active&&!t._blocked||t.active;v&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=o[this.ingKey]=t._active,e&&(t.first&&("bounds"in r&&(t._bounds=ug(r.bounds,t)),this.setup&&this.setup()),t.movement=g,this.computeOffset()));const[S,w]=t.offset,[[b,_],[T,E]]=t._bounds;t.overflow=[S<b?-1:S>_?1:0,w<T?-1:w>E?1:0],t._movementBound[0]=t.overflow[0]?t._movementBound[0]===!1?t._movement[0]:t._movementBound[0]:!1,t._movementBound[1]=t.overflow[1]?t._movementBound[1]===!1?t._movement[1]:t._movementBound[1]:!1;const M=t._active?r.rubberband||[0,0]:[0,0];if(t.offset=p7(t._bounds,t.offset,M),t.delta=An.sub(t.offset,y),this.computeMovement(),v&&(!t.last||s>k7)){t.delta=An.sub(t.offset,y);const A=t.delta.map(Math.abs);An.addTo(t.distance,A),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&s>0&&(t.velocity=[A[0]/s,A[1]/s],t.timeDelta=s)}}emit(){const e=this.state,t=this.shared,r=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!r.triggerAllEvents)return;const o=this.handler(Yt(Yt(Yt({},t),e),{},{[this.aliasKey]:e.values}));o!==void 0&&(e.memo=o)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}}function T7([n,e],t){const r=Math.abs(n),o=Math.abs(e);if(r>o&&r>t)return"x";if(o>r&&o>t)return"y"}class M7 extends Zj{constructor(...e){super(...e),Wn(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=An.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=An.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){const t=this.state,r=this.config;if(!t.axis&&e){const o=typeof r.axisThreshold=="object"?r.axisThreshold[b7(e)]:r.axisThreshold;t.axis=T7(t._movement,o)}t._blocked=(r.lockDirection||!!r.axis)&&!t.axis||!!r.axis&&r.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0;break}}}const A7=n=>n,wk=.15,Qj={enabled(n=!0){return n},eventOptions(n,e,t){return Yt(Yt({},t.shared.eventOptions),n)},preventDefault(n=!1){return n},triggerAllEvents(n=!1){return n},rubberband(n=0){switch(n){case!0:return[wk,wk];case!1:return[0,0];default:return An.toVector(n)}},from(n){if(typeof n=="function")return n;if(n!=null)return An.toVector(n)},transform(n,e,t){const r=n||t.shared.transform;return this.hasCustomTransform=!!r,r||A7},threshold(n){return An.toVector(n,0)}},j7=0,eh=Yt(Yt({},Qj),{},{axis(n,e,{axis:t}){if(this.lockDirection=t==="lock",!this.lockDirection)return t},axisThreshold(n=j7){return n},bounds(n={}){if(typeof n=="function")return s=>eh.bounds(n(s));if("current"in n)return()=>n.current;if(typeof HTMLElement=="function"&&n instanceof HTMLElement)return n;const{left:e=-1/0,right:t=1/0,top:r=-1/0,bottom:o=1/0}=n;return[[e,t],[r,o]]}}),th=typeof window<"u"&&window.document&&window.document.createElement;function Jj(){return th&&"ontouchstart"in window}function R7(){return Jj()||th&&window.navigator.maxTouchPoints>1}function O7(){return th&&"onpointerdown"in window}function D7(){return th&&"exitPointerLock"in window.document}function L7(){try{return"constructor"in GestureEvent}catch{return!1}}const Co={isBrowser:th,gesture:L7(),touch:Jj(),touchscreen:R7(),pointer:O7(),pointerLock:D7()},F7=250,N7=180,$7=.5,z7=50,B7=250,U7=10,bk={mouse:0,touch:0,pen:8};Yt(Yt({},eh),{},{device(n,e,{pointer:{touch:t=!1,lock:r=!1,mouse:o=!1}={}}){return this.pointerLock=r&&Co.pointerLock,Co.touch&&t?"touch":this.pointerLock?"mouse":Co.pointer&&!o?"pointer":Co.touch?"touch":"mouse"},preventScrollAxis(n,e,{preventScroll:t}){if(this.preventScrollDelay=typeof t=="number"?t:t||t===void 0&&n?F7:void 0,!(!Co.touchscreen||t===!1))return n||(t!==void 0?"y":void 0)},pointerCapture(n,e,{pointer:{capture:t=!0,buttons:r=1,keys:o=!0}={}}){return this.pointerButtons=r,this.keys=o,!this.pointerLock&&this.device==="pointer"&&t},threshold(n,e,{filterTaps:t=!1,tapsThreshold:r=3,axis:o=void 0}){const s=An.toVector(n,t?r:o?1:0);return this.filterTaps=t,this.tapsThreshold=r,s},swipe({velocity:n=$7,distance:e=z7,duration:t=B7}={}){return{velocity:this.transform(An.toVector(n)),distance:this.transform(An.toVector(e)),duration:t}},delay(n=0){switch(n){case!0:return N7;case!1:return 0;default:return n}},axisThreshold(n){return n?Yt(Yt({},bk),n):bk},keyboardDisplacement(n=U7){return n}});function eR(n){const[e,t]=n.overflow,[r,o]=n._delta,[s,i]=n._direction;(e<0&&r>0&&s<0||e>0&&r<0&&s>0)&&(n._movement[0]=n._movementBound[0]),(t<0&&o>0&&i<0||t>0&&o<0&&i>0)&&(n._movement[1]=n._movementBound[1])}const H7=30,K7=100;class W7 extends Zj{constructor(...e){super(...e),Wn(this,"ingKey","pinching"),Wn(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();const e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){const{type:e,movement:t,lastOffset:r}=this.state;e==="wheel"?this.state.offset=An.add(t,r):this.state.offset=[(1+t[0])*r[0],t[1]+r[1]]}computeMovement(){const{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){const e=this.state,[t,r]=e._movement;if(!e.axis){const o=Math.abs(t)*H7-Math.abs(r);o<0?e.axis="angle":o>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&(this.state.axis==="scale"?e[1]=0:this.state.axis==="angle"&&(e[0]=0))}cancel(){const e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);const t=this.state,r=this.ctrl.touchIds;if(t._active&&t._touchIds.every(s=>r.has(s))||r.size<2)return;this.start(e),t._touchIds=Array.from(r).slice(0,2);const o=yk(e,t._touchIds);o&&this.pinchStart(e,o)}pointerStart(e){if(e.buttons!=null&&e.buttons%2!==1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);const t=this.state,r=t._pointerEvents,o=this.ctrl.pointerIds;if(t._active&&Array.from(r.keys()).every(i=>o.has(i))||(r.size<2&&r.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);const s=pw(...Array.from(r.values()));s&&this.pinchStart(e,s)}pinchStart(e,t){const r=this.state;r.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;const t=yk(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){const t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;const r=pw(...Array.from(t.values()));r&&this.pinchMove(e,r)}pinchMove(e,t){const r=this.state,o=r._values[1],s=t.angle-o;let i=0;Math.abs(s)>270&&(i+=Math.sign(s)),this.computeValues([t.distance,t.angle-360*i]),r.origin=t.origin,r.turns=i,r._movement=[r._values[0]/r._initial[0]-1,r._values[1]-r._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(t=>!this.ctrl.touchIds.has(t))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){const t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch{}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();const t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;const t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];const r=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=An.sub(t._movement,r),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){const t=this.config.modifierKey;t&&(Array.isArray(t)?!t.find(r=>e[r]):!e[t])||(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){"uv"in e||e.cancelable&&e.preventDefault();const r=this.state;r._delta=[-Xj(e)[1]/K7*r.offset[0],0],An.addTo(r._movement,r._delta),eR(r),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){const t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}}const V7=Yt(Yt({},Qj),{},{device(n,e,{shared:t,pointer:{touch:r=!1}={}}){if(t.target&&!Co.touch&&Co.gesture)return"gesture";if(Co.touch&&r)return"touch";if(Co.touchscreen){if(Co.pointer)return"pointer";if(Co.touch)return"touch"}},bounds(n,e,{scaleBounds:t={},angleBounds:r={}}){const o=i=>{const a=xk(ug(t,i),{min:-1/0,max:1/0});return[a.min,a.max]},s=i=>{const a=xk(ug(r,i),{min:-1/0,max:1/0});return[a.min,a.max]};return typeof t!="function"&&typeof r!="function"?[o(),s()]:i=>[o(i),s(i)]},threshold(n,e,t){return this.lockDirection=t.axis==="lock",An.toVector(n,this.lockDirection?[.1,3]:0)},modifierKey(n){return n===void 0?"ctrlKey":n},pinchOnWheel(n=!0){return n}});Yt(Yt({},eh),{},{mouseOnly:(n=!0)=>n});class G7 extends M7{constructor(...e){super(...e),Wn(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){const t=this.state;t._delta=Xj(e),An.addTo(t._movement,t._delta),eR(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}}const q7=eh;Yt(Yt({},eh),{},{mouseOnly:(n=!0)=>n});const h1=new Map,fw=new Map;function Y7(n){h1.set(n.key,n.engine),fw.set(n.key,n.resolver)}const X7={key:"pinch",engine:W7,resolver:V7},Z7={key:"wheel",engine:G7,resolver:q7};function Q7(n,e){if(n==null)return{};var t={},r=Object.keys(n),o,s;for(s=0;s<r.length;s++)o=r[s],!(e.indexOf(o)>=0)&&(t[o]=n[o]);return t}function J7(n,e){if(n==null)return{};var t=Q7(n,e),r,o;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(o=0;o<s.length;o++)r=s[o],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}const eH={target(n){if(n)return()=>"current"in n?n.current:n},enabled(n=!0){return n},window(n=Co.isBrowser?window:void 0){return n},eventOptions({passive:n=!0,capture:e=!1}={}){return{passive:n,capture:e}},transform(n){return n}},tH=["target","eventOptions","window","enabled","transform"];function df(n={},e){const t={};for(const[r,o]of Object.entries(e))switch(typeof o){case"function":t[r]=o.call(t,n[r],r,n);break;case"object":t[r]=df(n[r],o);break;case"boolean":o&&(t[r]=n[r]);break}return t}function nH(n,e,t={}){const r=n,{target:o,eventOptions:s,window:i,enabled:a,transform:c}=r,u=J7(r,tH);if(t.shared=df({target:o,eventOptions:s,window:i,enabled:a,transform:c},eH),e){const h=fw.get(e);t[e]=df(Yt({shared:t.shared},u),h)}else for(const h in u){const f=fw.get(h);f&&(t[h]=df(Yt({shared:t.shared},u[h]),f))}return t}class tR{constructor(e,t){Wn(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,r,o,s){const i=this._listeners,a=w7(t,r),c=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},u=Yt(Yt({},c),s);e.addEventListener(a,o,u);const h=()=>{e.removeEventListener(a,o,u),i.delete(h)};return i.add(h),h}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}}class rH{constructor(){Wn(this,"_timeouts",new Map)}add(e,t,r=140,...o){this.remove(e),this._timeouts.set(e,window.setTimeout(t,r,...o))}remove(e){const t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}}class oH{constructor(e){Wn(this,"gestures",new Set),Wn(this,"_targetEventStore",new tR(this)),Wn(this,"gestureEventStores",{}),Wn(this,"gestureTimeoutStores",{}),Wn(this,"handlers",{}),Wn(this,"config",{}),Wn(this,"pointerIds",new Set),Wn(this,"touchIds",new Set),Wn(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),sH(this,e)}setEventIds(e){if(Yj(e))return this.touchIds=new Set(P7(e)),this.touchIds;if("pointerId"in e)return e.type==="pointerup"||e.type==="pointercancel"?this.pointerIds.delete(e.pointerId):e.type==="pointerdown"&&this.pointerIds.add(e.pointerId),this.pointerIds}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=nH(e,t,this.config)}clean(){this._targetEventStore.clean();for(const e of this.gestures)this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){const t=this.config.shared,r={};let o;if(!(t.target&&(o=t.target(),!o))){if(t.enabled){for(const i of this.gestures){const a=this.config[i],c=_k(r,a.eventOptions,!!o);if(a.enabled){const u=h1.get(i);new u(this,e,i).bind(c)}}const s=_k(r,t.eventOptions,!!o);for(const i in this.nativeHandlers)s(i,"",a=>this.nativeHandlers[i](Yt(Yt({},this.state.shared),{},{event:a,args:e})),void 0,!0)}for(const s in r)r[s]=E7(...r[s]);if(!o)return r;for(const s in r){const{device:i,capture:a,passive:c}=x7(s);this._targetEventStore.add(o,i,"",r[s],{capture:a,passive:c})}}}}function dc(n,e){n.gestures.add(e),n.gestureEventStores[e]=new tR(n,e),n.gestureTimeoutStores[e]=new rH}function sH(n,e){e.drag&&dc(n,"drag"),e.wheel&&dc(n,"wheel"),e.scroll&&dc(n,"scroll"),e.move&&dc(n,"move"),e.pinch&&dc(n,"pinch"),e.hover&&dc(n,"hover")}const _k=(n,e,t)=>(r,o,s,i={},a=!1)=>{var c,u;const h=(c=i.capture)!==null&&c!==void 0?c:e.capture,f=(u=i.passive)!==null&&u!==void 0?u:e.passive;let g=a?r:v7(r,o,h);t&&f&&(g+="Passive"),n[g]=n[g]||[],n[g].push(s)},iH=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function aH(n){const e={},t={},r=new Set;for(let o in n)iH.test(o)?(r.add(RegExp.lastMatch),t[o]=n[o]):e[o]=n[o];return[t,e,r]}function hc(n,e,t,r,o,s){if(!n.has(t)||!h1.has(r))return;const i=t+"Start",a=t+"End",c=u=>{let h;return u.first&&i in e&&e[i](u),t in e&&(h=e[t](u)),u.last&&a in e&&e[a](u),h};o[r]=c,s[r]=s[r]||{}}function lH(n,e){const[t,r,o]=aH(n),s={};return hc(o,t,"onDrag","drag",s,e),hc(o,t,"onWheel","wheel",s,e),hc(o,t,"onScroll","scroll",s,e),hc(o,t,"onPinch","pinch",s,e),hc(o,t,"onMove","move",s,e),hc(o,t,"onHover","hover",s,e),{handlers:s,config:e,nativeHandlers:r}}function cH(n,e={},t,r){const o=at.useMemo(()=>new oH(n),[]);if(o.applyHandlers(n,r),o.applyConfig(e,t),at.useEffect(o.effect.bind(o)),at.useEffect(()=>o.clean.bind(o),[]),e.target===void 0)return o.bind.bind(o)}function uH(n){return n.forEach(Y7),function(t,r){const{handlers:o,nativeHandlers:s,config:i}=lH(t,r||{});return cH(o,i,void 0,s)}}const Pk=10,dH=/Mac|iPod|iPhone|iPad/.test(typeof window>"u"?"node":window.navigator.platform);function nR(n){let{deltaY:e,deltaX:t}=n,r=0;return n.ctrlKey||n.altKey||n.metaKey?r=(Math.abs(e)>Pk?Pk*Math.sign(e):e)/100:n.shiftKey&&!dH&&(t=e,e=0),{x:-t,y:-e,z:-r}}const hH=uH([Z7,X7]);let pc;const pH=n=>pc===void 0?(pc=n,!1):n-pc>120&&n-pc<160?(pc=n,!0):(pc=n,!1);function fH(n){const e=te(),t=C.useMemo(()=>{let r="not sure";const o=({event:S})=>{if(!e.getInstanceState().isFocused||(r="not sure",pH(Date.now())))return;const w=e.getEditingShapeId();if(w){const T=e.getShape(w);if(T&&e.getShapeUtil(T).canScroll(T)){const M=e.getShapePageBounds(w);if(M!=null&&M.containsPoint(e.inputs.currentPagePoint))return}}et(S),cn(S);const b=nR(S);if(b.x===0&&b.y===0)return;const _={type:"wheel",name:"wheel",delta:b,point:new P(S.clientX,S.clientY),shiftKey:S.shiftKey,altKey:S.altKey,ctrlKey:S.metaKey||S.ctrlKey,metaKey:S.metaKey,accelKey:qn(S)};e.dispatch(_)};let s=1,i=1,a=1,c=0;const u=new P,h=new P,f=S=>{const w=n.current;r="not sure";const{event:b,origin:_,da:T}=S;b instanceof WheelEvent||(b.target===w||w!=null&&w.contains(b.target))&&(h.x=_[0],h.y=_[1],u.x=_[0],u.y=_[1],s=T[0],i=e.getZoomLevel(),e.dispatch({type:"pinch",name:"pinch_start",point:{x:_[0],y:_[1],z:e.getZoomLevel()},delta:{x:0,y:0},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:qn(b)}))},g=S=>{if(S&&(r="zooming"),r==="zooming")return;const w=Math.abs(c-s),b=P.Dist(u,h);switch(r){case"not sure":{w>24?r="zooming":b>16&&(r="panning");break}case"panning":{w>64&&(r="zooming");break}}};return{onWheel:o,onPinchStart:f,onPinchEnd:S=>{const w=n.current,{event:b,origin:_,offset:T}=S;if(b instanceof WheelEvent||!(b.target===w||w!=null&&w.contains(b.target)))return;const E=T[0];r="not sure",e.timers.requestAnimationFrame(()=>{e.dispatch({type:"pinch",name:"pinch_end",point:{x:_[0],y:_[1],z:E},delta:{x:_[0],y:_[1]},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:qn(b)})})},onPinch:S=>{const w=n.current,{event:b,origin:_,offset:T,da:E}=S;if(b instanceof WheelEvent||!(b.target===w||w!=null&&w.contains(b.target)))return;const M=S.type==="gesturechange"||S.type==="gestureend";c=E[0];const A=_[0]-h.x,R=_[1]-h.y;switch(h.x=_[0],h.y=_[1],g(M),r){case"zooming":{a=T[0],e.dispatch({type:"pinch",name:"pinch",point:{x:_[0],y:_[1],z:a},delta:{x:A,y:R},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:qn(b)});break}case"panning":{e.dispatch({type:"pinch",name:"pinch",point:{x:_[0],y:_[1],z:i},delta:{x:A,y:R},shiftKey:b.shiftKey,altKey:b.altKey,ctrlKey:b.metaKey||b.ctrlKey,metaKey:b.metaKey,accelKey:qn(b)});break}}}}},[e,n]);hH(t,{target:n,eventOptions:{passive:!1},pinch:{from:()=>[e.getZoomLevel(),0],scaleBounds:()=>{const r=e.getBaseZoom(),o=e.getCameraOptions().zoomSteps,s=o[0]*r,i=o[o.length-1]*r;return{from:e.getZoomLevel(),max:i,min:s}}}})}function z0(n,e,t){const r=n.getShape(e),o=n.getShapeHandles(r);return{shape:r,handle:o.find(s=>s.id===t)}}function gH(n,e){const t=te();return C.useMemo(()=>{const r=c=>{if(c.isKilled)return;const u=cg(c.currentTarget);Qd(u,c);const{shape:h,handle:f}=z0(t,n,e);f&&t.dispatch({type:"pointer",target:"handle",handle:f,shape:h,name:"pointer_down",...Qr(c)})};let o,s;return{onPointerDown:r,onPointerMove:c=>{if(c.isKilled||c.clientX===o&&c.clientY===s)return;o=c.clientX,s=c.clientY;const{shape:u,handle:h}=z0(t,n,e);h&&t.dispatch({type:"pointer",target:"handle",handle:h,shape:u,name:"pointer_move",...Qr(c)})},onPointerUp:c=>{if(c.isKilled)return;const u=cg(c.currentTarget);Jd(u,c);const{shape:h,handle:f}=z0(t,n,e);f&&t.dispatch({type:"pointer",target:"handle",handle:f,shape:h,name:"pointer_up",...Qr(c)})}}},[t,n,e])}function mH(n){const e=te();C.useLayoutEffect(()=>{const t=WM(()=>{n.current&&e.updateViewportScreenBounds(n.current)},200,{trailing:!0}),r=e.timers.setInterval(t,1e3);window.addEventListener("resize",t);const o=new ResizeObserver(a=>{a[0].contentRect&&t()}),s=n.current;let i=null;return s&&(o.observe(s),i=yH(s),i.addEventListener("scroll",t)),()=>{clearInterval(r),window.removeEventListener("resize",t),o.disconnect(),i==null||i.removeEventListener("scroll",t),t.cancel()}},[e,n])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */const yH=n=>{let e=n.parentElement;for(;e;){if(e===document.body)return document;const{overflowY:t}=window.getComputedStyle(e);if(e.scrollHeight>e.clientHeight&&(t==="auto"||t==="scroll"||t==="overlay"))return e;e=e.parentElement}return document};class xe{constructor(e=0,t=0,r=0,o=0){j(this,"x",0);j(this,"y",0);j(this,"w",0);j(this,"h",0);this.x=e,this.y=t,this.w=r,this.h=o}get point(){return new P(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new P(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new P(this.minX,this.minY),new P(this.maxX,this.minY),new P(this.maxX,this.maxY),new P(this.minX,this.maxY)]}get cornersAndCenter(){return[new P(this.minX,this.minY),new P(this.maxX,this.minY),new P(this.maxX,this.maxY),new P(this.minX,this.maxY),this.center]}get sides(){const{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new P(this.w,this.h)}toFixed(){return this.x=Mp(this.x),this.y=Mp(this.y),this.w=Mp(this.w),this.h=Mp(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,r=0,o=0){return this.x=e,this.y=t,this.w=r,this.h=o,this}expand(e){const t=Math.min(this.minX,e.minX),r=Math.min(this.minY,e.minY),o=Math.max(this.maxX,e.maxX),s=Math.max(this.maxY,e.maxY);return this.x=t,this.y=r,this.w=o-t,this.h=s-r,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=e*2,this.h+=e*2,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){const{x:e,y:t,w:r,h:o}=this;return new xe(e,t,r,o)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){const t=Math.round(this.minX/e)*e,r=Math.round(this.minY/e)*e,o=Math.round(this.maxX/e)*e,s=Math.round(this.maxY/e)*e;this.minX=t,this.minY=r,this.width=Math.max(1,o-t),this.height=Math.max(1,s-r)}collides(e){return xe.Collides(this,e)}contains(e){return xe.Contains(this,e)}includes(e){return xe.Includes(this,e)}containsPoint(e,t=0){return xe.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new P(this.minX,this.minY);case"top_right":return new P(this.maxX,this.minY);case"bottom_left":return new P(this.minX,this.maxY);case"bottom_right":return new P(this.maxX,this.maxY);case"top":return new P(this.midX,this.minY);case"right":return new P(this.maxX,this.midY);case"bottom":return new P(this.midX,this.maxY);case"left":return new P(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,r){const{minX:o,minY:s,maxX:i,maxY:a}=this;let{minX:c,minY:u,maxX:h,maxY:f}=this;switch(e){case"left":case"top_left":case"bottom_left":{c+=t;break}case"right":case"top_right":case"bottom_right":{h+=t;break}}switch(e){case"top":case"top_left":case"top_right":{u+=r;break}case"bottom":case"bottom_left":case"bottom_right":{f+=r;break}}const g=(h-c)/(i-o),y=(f-u)/(a-s),v=g<0,S=y<0;if(v){const w=h;h=c,c=w}if(S){const w=f;f=u,u=w}this.minX=c,this.minY=u,this.width=Math.abs(h-c),this.height=Math.abs(f-u)}union(e){const t=Math.min(this.minX,e.x),r=Math.min(this.minY,e.y),o=Math.max(this.maxX,e.w+e.x),s=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=r,this.width=o-t,this.height=s-r,this}static From(e){return new xe(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new xe(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){if(e.length===0)return new xe;let t=1/0,r=1/0,o=-1/0,s=-1/0,i;for(let a=0,c=e.length;a<c;a++)i=e[a],t=Math.min(i.x,t),r=Math.min(i.y,r),o=Math.max(i.x,o),s=Math.max(i.y,s);return new xe(t,r,o-t,s-r)}static Expand(e,t){const r=Math.min(t.minX,e.minX),o=Math.min(t.minY,e.minY),s=Math.max(t.maxX,e.maxX),i=Math.max(t.maxY,e.maxY);return new xe(r,o,s-r,i-o)}static ExpandBy(e,t){return new xe(e.minX-t,e.minY-t,e.width+t*2,e.height+t*2)}static Collides(e,t){return!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY)}static Contains(e,t){return e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX}static Includes(e,t){return xe.Collides(e,t)||xe.Contains(e,t)}static ContainsPoint(e,t,r=0){return!(t.x<e.minX-r||t.y<e.minY-r||t.x>e.maxX+r||t.y>e.maxY+r)}static Common(e){let t=1/0,r=1/0,o=-1/0,s=-1/0;for(let i=0;i<e.length;i++){const a=e[i];t=Math.min(t,a.minX),r=Math.min(r,a.minY),o=Math.max(o,a.maxX),s=Math.max(s,a.maxY)}return new xe(t,r,o-t,s-r)}static Sides(e,t=0){const{corners:r}=e;return[[r[0],r[1]],[r[1],r[2]],[r[2],r[3]],[r[3],r[0]]]}static Resize(e,t,r,o,s=!1){const{minX:i,minY:a,maxX:c,maxY:u}=e;let{minX:h,minY:f,maxX:g,maxY:y}=e;switch(t){case"left":case"top_left":case"bottom_left":{h+=r;break}case"right":case"top_right":case"bottom_right":{g+=r;break}}switch(t){case"top":case"top_left":case"top_right":{f+=o;break}case"bottom":case"bottom_left":case"bottom_right":{y+=o;break}}const v=(g-h)/(c-i),S=(y-f)/(u-a),w=v<0,b=S<0;if(s){const T=(c-i)/(u-a),E=Math.abs(g-h),M=Math.abs(y-f),A=E*(S<0?1:-1)*(1/T),R=M*(v<0?1:-1)*T,L=T<E/M;switch(t){case"top_left":{L?f=y+A:h=g+R;break}case"top_right":{L?f=y+A:g=h-R;break}case"bottom_right":{L?y=f-A:g=h-R;break}case"bottom_left":{L?y=f-A:h=g+R;break}case"bottom":case"top":{const K=(h+g)/2,D=M*T;h=K-D/2,g=K+D/2;break}case"left":case"right":{const K=(f+y)/2,D=E/T;f=K-D/2,y=K+D/2;break}}}if(w){const T=g;g=h,h=T}if(b){const T=y;y=f,f=T}const _=new xe(h,f,Math.abs(g-h),Math.abs(y-f));return{box:_,scaleX:+(_.width/e.width*(v>0?1:-1)).toFixed(5),scaleY:+(_.height/e.height*(S>0?1:-1)).toFixed(5)}}equals(e){return xe.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new xe(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}}function vH(n){switch(n){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return n}}function SH(n){switch(n){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return n}}function xH(n){return n==="top_left"||n==="top_right"||n==="bottom_right"||n==="bottom_left"}class ye{constructor(e,t,r,o,s,i){j(this,"a",1);j(this,"b",0);j(this,"c",0);j(this,"d",1);j(this,"e",0);j(this,"f",0);this.a=e,this.b=t,this.c=r,this.d=o,this.e=s,this.f=i}equals(e){return this===e||this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){const t=e,{a:r,b:o,c:s,d:i,e:a,f:c}=this;return this.a=r*t.a+s*t.b,this.c=r*t.c+s*t.d,this.e=r*t.e+s*t.f+a,this.b=o*t.a+i*t.b,this.d=o*t.c+i*t.d,this.f=o*t.e+i*t.f+c,this}rotate(e,t,r){return e===0?this:t===void 0?this.multiply(ye.Rotate(e)):this.translate(t,r).multiply(ye.Rotate(e)).translate(-t,-r)}translate(e,t){return this.multiply(ye.Translate(e,t))}scale(e,t){return this.multiply(ye.Scale(e,t))}invert(){const{a:e,b:t,c:r,d:o,e:s,f:i}=this,a=e*o-t*r;return this.a=o/a,this.b=t/-a,this.c=r/-a,this.d=e/a,this.e=(o*s-r*i)/-a,this.f=(t*s-e*i)/a,this}applyToPoint(e){return ye.applyToPoint(this,e)}applyToPoints(e){return ye.applyToPoints(this,e)}rotation(){return ye.Rotation(this)}point(){return ye.Point(this)}decomposed(){return ye.Decompose(this)}toCssString(){return ye.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return ye.Decompose(this)}clone(){return new ye(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new ye(1,0,0,1,0,0)}static Translate(e,t){return new ye(1,0,0,1,e,t)}static Rotate(e,t,r){if(e===0)return ye.Identity();const o=Math.cos(e),s=Math.sin(e),i=new ye(o,s,-s,o,0,0);return t===void 0?i:ye.Compose(ye.Translate(t,r),i,ye.Translate(-t,-r))}static Scale(e,t,r,o){const s=new ye(e,0,0,t,0,0);return r===void 0?s:ye.Compose(ye.Translate(r,o),s,ye.Translate(-r,-o))}static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/-t,f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){const t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:e.b/-t,c:e.c/-t,d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:(e.b*e.e-e.a*e.f)/-t}}static Compose(...e){const t=ye.Identity();for(let r=0,o=e.length;r<o;r++)t.multiply(e[r]);return t}static Point(e){return new P(e.e,e.f)}static Rotation(e){let t;if(e.a!==0||e.c!==0){const r=(e.a*e.a+e.c*e.c)**.5;t=Math.acos(e.a/r)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const r=(e.b*e.b+e.d*e.d)**.5;t=Dt+Math.acos(e.b/r)*(e.d>0?-1:1)}else t=0;return dw(t)}static Decompose(e){let t,r,o;if(e.a!==0||e.c!==0){const s=(e.a*e.a+e.c*e.c)**.5;t=s,r=(e.a*e.d-e.b*e.c)/s,o=Math.acos(e.a/s)*(e.c>0?-1:1)}else if(e.b!==0||e.d!==0){const s=(e.b*e.b+e.d*e.d)**.5;t=(e.a*e.d-e.b*e.c)/s,r=s,o=Dt+Math.acos(e.b/s)*(e.d>0?-1:1)}else t=0,r=0,o=0;return{x:e.e,y:e.f,scaleX:t,scaleY:r,rotation:dw(o)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${ee(e.a)}, ${ee(e.b)}, ${ee(e.c)}, ${ee(e.d)}, ${ee(e.e)}, ${ee(e.f)})`}static applyToPoint(e,t){return new P(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,r){return[e.a*t+e.c*r+e.e,e.b*t+e.d*r+e.f]}static applyToPoints(e,t){return t.map(r=>new P(e.a*r.x+e.c*r.y+e.e,e.b*r.x+e.d*r.y+e.f,r.z))}static applyToBounds(e,t){return new xe(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new ye(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof ye?e:ye.From(e)}}class Ea{constructor(e){j(this,"isFilled",!1);j(this,"isClosed",!0);j(this,"isLabel",!1);j(this,"debugColor");j(this,"ignore");j(this,"_vertices");j(this,"_bounds");j(this,"_area");j(this,"_length");this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,t=0,r=!1){return this.isClosed&&(this.isFilled||r)&&no(e,this.vertices)?!0:P.Dist2(e,this.nearestPoint(e))<=t*t}distanceToPoint(e,t=!1){return e.dist(this.nearestPoint(e))*(this.isClosed&&(this.isFilled||t)&&no(e,this.vertices)?-1:1)}distanceToLineSegment(e,t){if(e.equals(t))return this.distanceToPoint(e);const{vertices:r}=this;let o,s=1/0,i,a,c;for(let u=0;u<r.length;u++)a=r[u],c=P.NearestPointOnLineSegment(e,t,a,!0),i=P.Dist2(a,c),i<s&&(s=i,o=c);if(!o)throw Error("nearest point not found");return this.isClosed&&this.isFilled&&no(o,this.vertices)?-s:s}hitTestLineSegment(e,t,r=0){return this.distanceToLineSegment(e,t)<=r}nearestPointOnLineSegment(e,t){const{vertices:r}=this;let o,s=1/0,i,a,c;for(let u=0;u<r.length;u++)a=r[u],c=P.NearestPointOnLineSegment(e,t,a,!0),i=P.Dist2(a,c),i<s&&(s=i,o=c);if(!o)throw Error("nearest point not found");return o}isPointInBounds(e,t=0){const{bounds:r}=this;return!(e.x<r.minX-t||e.y<r.minY-t||e.x>r.maxX+t||e.y>r.maxY+t)}get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return xe.FromPoints(this.vertices)}get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;const{vertices:e}=this;let t=0;for(let r=0,o=e.length;r<o;r++){const s=e[r],i=e[(r+1)%o];t+=s.x*i.y-i.x*s.y}return t/2}toSimpleSvgPath(){let e="";const{vertices:t}=this,r=t.length;if(r===0)return e;e+=`M${t[0].x},${t[0].y}`;for(let o=1;o<r;o++)e+=`L${t[o].x},${t[o].y}`;return this.isClosed&&(e+="Z"),e}get length(){return this._length?this._length:(this._length=this.getLength(),this._length)}getLength(){const{vertices:e}=this;let t,r=e[0],o=0;for(let s=1;s<e.length;s++)t=e[s],o+=P.Dist2(r,t),r=t;return Math.sqrt(o)}}class To extends Ea{constructor(t){super({...t,isClosed:!0,isFilled:!1});j(this,"children",[]);j(this,"ignoredChildren",[]);for(const r of t.children)r.ignore?this.ignoredChildren.push(r):this.children.push(r);if(this.children.length===0)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(t=>!t.isLabel).flatMap(t=>t.vertices)}nearestPoint(t){let r=1/0,o;const{children:s}=this;if(s.length===0)throw Error("no children");let i,a;for(const c of s)i=c.nearestPoint(t),a=P.Dist2(i,t),a<r&&(r=a,o=i);if(!o)throw Error("nearest point not found");return o}distanceToPoint(t,r=!1){return Math.min(...this.children.map((o,s)=>o.distanceToPoint(t,r||s>0)))}hitTestPoint(t,r,o){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestPoint(t,r,o))}hitTestLineSegment(t,r,o){return!!this.children.filter(s=>!s.isLabel).find(s=>s.hitTestLineSegment(t,r,o))}getArea(){return this.children[0].area}toSimpleSvgPath(){let t="";for(const o of this.children)t+=o.toSimpleSvgPath();const r=xe.FromPoints(this.vertices).corners;for(let o=0,s=r.length;o<s;o++){const i=r[o],a=r[(o-1+s)%s],c=i.dist(a),u=r[(o+1)%s],h=i.dist(u),f=i.clone().lrp(a,4/c),g=i,y=i.clone().lrp(u,4/h);t+=`M${f.x},${f.y} L${g.x},${g.y} L${y.x},${y.y} `}return t}getLength(){return this.children.reduce((t,r)=>r.isLabel?t:t+r.length,0)}getSvgPathData(){return this.children.map((t,r)=>t.isLabel?"":t.getSvgPathData(r===0)).join(" ")}}function wH(n=!0){const[e,t]=C.useState(0),r=te();C.useEffect(()=>{if(!n)return;const o=()=>t(s=>s+1);return r.on("tick",o),()=>{r.off("tick",o)}},[r,n])}const bH=On(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:r=!0}){const o=te();wH(r);const s=o.getZoomLevel(),i=o.getRenderingShapes(),{inputs:{currentPagePoint:a}}=o;return p.jsx("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:i.map(c=>{const u=o.getShape(c.id);if(u.type==="group")return null;const h=o.getShapeGeometry(u),f=o.getShapePageTransform(u),g=o.getPointInShapeSpace(u,a),y=h.nearestPoint(g),v=h.distanceToPoint(g,!0),S=Math.abs(v)*s,w=v<0,{vertices:b}=h;return p.jsxs("g",{transform:f.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&p.jsx("g",{stroke:h.debugColor??"red",opacity:"1",strokeWidth:2/s,fill:"none",children:p.jsx(rR,{geometry:h})}),t&&b.map((_,T)=>p.jsx("circle",{cx:_.x,cy:_.y,r:2/s,fill:`hsl(${Bc(T,[0,b.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:1/s},`v${T}`)),r&&S<150&&p.jsx("line",{x1:y.x,y1:y.y,x2:g.x,y2:g.y,opacity:1-S/150,stroke:w?"goldenrod":"dodgerblue",strokeWidth:2/s})]},c.id+"_outline")})})});function rR({geometry:n}){return n instanceof To?p.jsx(p.Fragment,{children:[...n.children,...n.ignoredChildren].map((e,t)=>p.jsx(rR,{geometry:e},t))}):p.jsx("path",{d:n.toSimpleSvgPath()})}function oR(n){return s8(n)}function sR(){const n=te(),e=y9("userIds",()=>oR(n.getCollaborators().map(t=>t.userId)).sort(),{isEqual:(t,r)=>{var o;return t.join(",")===((o=r.join)==null?void 0:o.call(r,","))}},[n]);return re(e)}function Vg(n){const e=te();return re(`latestPresence:${n}`,()=>e.getCollaborators().find(r=>r.userId===n),[e,n])??null}const _H=On(function(){return sR().map(t=>p.jsx(PH,{collaboratorId:t},t))}),PH=On(function({collaboratorId:e}){const t=te(),r=Vg(e),o=IH(t,r);if(!(r&&r.currentPageId===t.getCurrentPageId()))return null;switch(o){case"inactive":{const{followingUserId:s,highlightedUserIds:i}=t.getInstanceState();if(!(s===r.userId||i.includes(r.userId)))return null;break}case"idle":{const{highlightedUserIds:s}=t.getInstanceState();if(r.followingUserId===t.user.getId()&&!(r.chatMessage||s.includes(r.userId)))return null;break}}return p.jsx(CH,{latestPresence:r})}),CH=On(function({latestPresence:e}){const t=te(),{CollaboratorBrush:r,CollaboratorScribble:o,CollaboratorCursor:s,CollaboratorHint:i,CollaboratorShapeIndicator:a}=Bt(),c=t.getZoomLevel(),u=t.getViewportPageBounds(),{userId:h,chatMessage:f,brush:g,scribbles:y,selectedShapeIds:v,userName:S,cursor:w,color:b}=e,_=!(w.x<u.minX-12/c||w.y<u.minY-16/c||w.x>u.maxX-12/c||w.y>u.maxY-16/c);return p.jsxs(p.Fragment,{children:[g&&r?p.jsx(r,{className:"tl-collaborator__brush",brush:g,color:b,opacity:.1},h+"_brush"):null,_&&s?p.jsx(s,{className:"tl-collaborator__cursor",point:w,color:b,zoom:c,name:S!=="New User"?S:null,chatMessage:f??""},h+"_cursor"):i?p.jsx(i,{className:"tl-collaborator__cursor-hint",point:w,color:b,zoom:c,viewport:u},h+"_cursor_hint"):null,o&&y.length?p.jsx(p.Fragment,{children:y.map(T=>p.jsx(o,{className:"tl-collaborator__scribble",scribble:T,color:b,zoom:c,opacity:T.color==="laser"?.5:.1},h+"_scribble_"+T.id))}):null,a&&v.filter(T=>!t.isShapeHidden(T)).map(T=>p.jsx(a,{className:"tl-collaborator__shape-indicator",shapeId:T,color:b,opacity:.5},h+"_"+T))]})});function Ck(n,e){return e>n.options.collaboratorInactiveTimeoutMs?"inactive":e>n.options.collaboratorIdleTimeoutMs?"idle":"active"}function IH(n,e){const t=C.useRef((e==null?void 0:e.lastActivityTimestamp)??-1),[r,o]=C.useState(()=>Ck(n,Date.now()-t.current));return C.useEffect(()=>{const s=n.timers.setInterval(()=>{o(Ck(n,Date.now()-t.current))},n.options.collaboratorCheckIntervalMs);return()=>clearInterval(s)},[n]),e&&(t.current=e.lastActivityTimestamp),r}function EH(){const n=te(),e=re("is menu open",()=>n.menus.hasAnyOpenMenus(),[n]),[t,r]=C.useState(!1),o=e||t,s=d1(),i=C.useRef({isDown:!1,isDragging:!1,start:new P}),a=C.useCallback(h=>{h.button===0&&(r(!0),i.current={isDown:!0,isDragging:!1,start:new P(h.clientX,h.clientY)}),n.menus.clearOpenMenus()},[n]),c=C.useCallback(h=>{var f,g,y;if(i.current.isDown){if(i.current.isDragging){(f=s.onPointerMove)==null||f.call(s,h);return}if(P.Dist2(i.current.start,new P(h.clientX,h.clientY))>n.options.dragDistanceSquared){i.current={...i.current,isDown:!0,isDragging:!0};const{x:v,y:S}=i.current.start;(g=s.onPointerDown)==null||g.call(s,{...h,clientX:v,clientY:S,button:0}),(y=s.onPointerMove)==null||y.call(s,h)}}},[s,n]),u=C.useCallback(h=>{var f;(f=s.onPointerUp)==null||f.call(s,h),r(!1),i.current={isDown:!1,isDragging:!1,start:new P(h.clientX,h.clientY)}},[s]);return o&&p.jsx("div",{className:"tlui-menu-click-capture","data-testid":"menu-click-capture.content",...s,onPointerDown:a,onPointerMove:c,onPointerUp:u})}const iR=C.memo(function({id:e,shape:t,util:r,index:o,backgroundIndex:s,opacity:i}){const a=te(),{ShapeErrorFallback:c}=Bt(),u=C.useRef(null),h=C.useRef(null),f=C.useRef({transform:"",clipPath:"none",width:0,height:0,x:0,y:0,isCulled:!1});ha("set shape stuff",()=>{const v=a.getShape(e);if(!v)return;const S=f.current,w=a.getShapeClipPath(e)??"none";w!==S.clipPath&&(Hn(u.current,"clip-path",w),Hn(h.current,"clip-path",w),S.clipPath=w);const b=a.getShapePageTransform(e),_=ye.toCssString(b),T=a.getShapeGeometry(v).bounds;_!==S.transform&&(Hn(u.current,"transform",_),Hn(h.current,"transform",_),S.transform=_);const E=Math.max(T.width,1),M=Math.max(T.height,1);(E!==S.width||M!==S.height)&&(Hn(u.current,"width",E+"px"),Hn(u.current,"height",M+"px"),Hn(h.current,"width",E+"px"),Hn(h.current,"height",M+"px"),S.width=E,S.height=M)},[a]),ha("set opacity and z-index",()=>{const v=u.current,S=h.current;Hn(v,"opacity",i),Hn(S,"opacity",i),Hn(v,"z-index",o),Hn(S,"z-index",s)},[i,o,s]),ha("set display",()=>{if(!a.getShape(e))return;const w=a.getCulledShapes().has(e);w!==f.current.isCulled&&(Hn(u.current,"display",w?"none":"block"),Hn(h.current,"display",w?"none":"block"),f.current.isCulled=w)},[a]);const g=C.useCallback(v=>a.annotateError(v,{origin:"shape",willCrashApp:!1}),[a]);if(!t)return null;const y="fill"in t.props&&t.props.fill!=="none";return p.jsxs(p.Fragment,{children:[r.backgroundComponent&&p.jsx("div",{ref:h,className:"tl-shape tl-shape-background","data-shape-type":t.type,"data-shape-id":t.id,draggable:!1,children:p.jsx(Ld,{fallback:c,onError:g,children:p.jsx(lR,{shape:t,util:r})})}),p.jsx("div",{ref:u,className:"tl-shape","data-shape-type":t.type,"data-shape-is-filled":y,"data-shape-id":t.id,draggable:!1,children:p.jsx(Ld,{fallback:c,onError:g,children:p.jsx(aR,{shape:t,util:r})})})]})}),aR=C.memo(function({shape:e,util:t}){return $g("InnerShape:"+e.type,()=>t.component(t.editor.store.unsafeGetWithoutCapture(e.id)))},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta),lR=C.memo(function({shape:e,util:t}){return $g("InnerShape:"+e.type,()=>{var r;return(r=t.backgroundComponent)==null?void 0:r.call(t,t.editor.store.unsafeGetWithoutCapture(e.id))})},(n,e)=>n.shape.props===e.shape.props&&n.shape.meta===e.shape.meta);function kH({className:n}){const e=te(),{Background:t,SvgDefs:r,ShapeIndicators:o}=Bt(),s=C.useRef(null),i=C.useRef(null),a=C.useRef(null),c=fn();mH(s),l7(),a7(),fH(s),d7(s);const u=C.useRef({lodDisableTextOutline:!1,allowTextOutline:!0});ha("position layers",function(){const{x:_,y:T,z:E}=e.getCamera();if(u.current.allowTextOutline&&kt.isSafari&&(c.style.setProperty("--tl-text-outline","none"),u.current.allowTextOutline=!1),u.current.allowTextOutline&&E<e.options.textShadowLod!==u.current.lodDisableTextOutline){const R=E<e.options.textShadowLod;c.style.setProperty("--tl-text-outline",R?"none":"var(--tl-text-outline-reference)"),u.current.lodDisableTextOutline=R}const M=E>=1?Bc(E,[1,8],[.125,.5],!0):Bc(E,[.1,1],[-2,.125],!0),A=`scale(${ee(E)}) translate(${ee(_+M)}px,${ee(T+M)}px)`;Hn(i.current,"transform",A),Hn(a.current,"transform",A)},[e,c]);const h=d1(),f=re("shapeSvgDefs",()=>{const b=new Map;for(const _ of qt(e.shapeUtils)){if(!_)return;const T=_.getCanvasSvgDefs();for(const{key:E,component:M}of T)b.has(E)||b.set(E,p.jsx(M,{},E))}return[...b.values()]},[e]),g=re("debug_shapes",()=>sn.hideShapes.get(),[sn]),y=re("debug_svg",()=>sn.debugSvg.get(),[sn]),v=re("debug_geometry",()=>sn.debugGeometry.get(),[sn]),S=re("isEditingAnything",()=>e.getEditingShapeId()!==null,[e]),w=re("isSelectingAnything",()=>!!e.getSelectedShapeIds().length,[e]);return p.jsxs(p.Fragment,{children:[p.jsxs("div",{ref:s,draggable:!1,"data-iseditinganything":S,"data-isselectinganything":w,className:Fe("tl-canvas",n),"data-testid":"canvas",...h,children:[p.jsx("svg",{className:"tl-svg-context",children:p.jsxs("defs",{children:[f,p.jsx(UH,{}),p.jsx(HH,{}),r&&p.jsx(r,{})]})}),t&&p.jsx("div",{className:"tl-background__wrapper",children:p.jsx(t,{})}),p.jsx(MH,{}),p.jsxs("div",{ref:i,className:"tl-html-layer tl-shapes",draggable:!1,children:[p.jsx(GH,{}),p.jsx(VH,{}),g?null:y?p.jsx(NH,{}):p.jsx(zH,{})]}),p.jsx("div",{className:"tl-overlays",children:p.jsxs("div",{ref:a,className:"tl-html-layer",children:[v?p.jsx(bH,{}):null,p.jsx(DH,{}),p.jsx(jH,{}),p.jsx(AH,{}),p.jsx(RH,{}),o&&p.jsx(o,{}),p.jsx(BH,{}),p.jsx(OH,{}),p.jsx(WH,{}),p.jsx(_H,{})]})}),p.jsx(qH,{})]}),p.jsx(EH,{}),p.jsx(TH,{})]})}function TH(){const{InFrontOfTheCanvas:n}=Bt();return n?p.jsx(n,{}):null}function MH(){const n=te(),e=re("gridSize",()=>n.getDocumentSettings().gridSize,[n]),{x:t,y:r,z:o}=re("camera",()=>n.getCamera(),[n]),s=re("isGridMode",()=>n.getInstanceState().isGridMode,[n]),{Grid:i}=Bt();return i&&s?p.jsx(i,{x:t,y:r,z:o,size:e}):null}function AH(){const n=te(),e=re("scribbles",()=>n.getInstanceState().scribbles,[n]),t=re("zoomLevel",()=>n.getZoomLevel(),[n]),{Scribble:r}=Bt();return r&&e.length?e.map(o=>p.jsx(r,{className:"tl-user-scribble",scribble:o,zoom:t},o.id)):null}function jH(){const n=te(),e=re("brush",()=>n.getInstanceState().brush,[n]),{Brush:t}=Bt();return t&&e?p.jsx(t,{className:"tl-user-brush",brush:e}):null}function RH(){const n=te(),e=re("zoomBrush",()=>n.getInstanceState().zoomBrush,[n]),{ZoomBrush:t}=Bt();return t&&e?p.jsx(t,{className:"tl-user-brush tl-zoom-brush",brush:e}):null}function OH(){const n=te(),e=re("snapLines",()=>n.snaps.getIndicators(),[n]),t=re("zoomLevel",()=>n.getZoomLevel(),[n]),{SnapIndicator:r}=Bt();return r&&e.length>0?e.map(o=>p.jsx(r,{className:"tl-user-snapline",line:o,zoom:t},o.id)):null}function DH(){const n=te(),e=re("handles shapeIdWithHandles",()=>{const{isReadonly:t,isChangingStyle:r}=n.getInstanceState();if(t||r)return!1;const o=n.getOnlySelectedShape();return!o||!n.getShapeHandles(o)?!1:o.id},[n]);return e?p.jsx(LH,{shapeId:e}):null}function LH({shapeId:n}){const e=te(),{Handles:t}=Bt(),r=re("zoomLevel",()=>e.getZoomLevel(),[e]),o=re("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),s=re("handles transform",()=>e.getShapePageTransform(n),[e,n]),i=re("handles",()=>{const c=e.getShapeHandles(n);if(!c)return null;const u=(o?e.options.coarseHandleRadius:e.options.handleRadius)/r*2;return c.filter(h=>h.type!=="virtual"||!c.some(f=>f!==h&&f.type==="vertex"&&P.Dist(h,f)<u)).sort(h=>h.type==="vertex"?1:-1)},[e,r,o,n]),a=re("isHidden",()=>e.isShapeHidden(n),[e,n]);return!t||!i||!s||a?null:p.jsx(t,{children:p.jsx("g",{transform:ye.toCssString(s),children:i.map(c=>p.jsx(FH,{shapeId:n,handle:c,zoom:r,isCoarse:o},c.id))})})}function FH({shapeId:n,handle:e,zoom:t,isCoarse:r}){const o=gH(n,e.id),{Handle:s}=Bt();return s?p.jsx("g",{"aria-label":"handle",transform:`translate(${e.x}, ${e.y})`,...o,children:p.jsx(s,{shapeId:n,handle:e,zoom:t,isCoarse:r})}):null}function NH(){const n=te();return re("rendering shapes",()=>n.getRenderingShapes(),[n]).map(t=>p.jsxs(C.Fragment,{children:[p.jsx(iR,{...t}),p.jsx(KH,{id:t.id,mode:"iframe"})]},t.id+"_fragment"))}function $H(){const n=te(),e=C.useRef(new Set);return ha("reflow for culled shapes",()=>{const t=n.getCulledShapes();if(e.current.size===t.size&&[...t].every(o=>e.current.has(o)))return;e.current=t;const r=document.getElementsByClassName("tl-canvas");r.length!==0&&r[0].offsetHeight},[n]),null}function zH(){const n=te(),e=re("rendering shapes",()=>n.getRenderingShapes(),[n]);return p.jsxs(p.Fragment,{children:[e.map(t=>p.jsx(iR,{...t},t.id+"_shape")),kt.isSafari&&p.jsx($H,{})]})}function BH(){const n=te(),{ShapeIndicator:e}=Bt(),t=re("hinting shape ids",()=>_b(n.getHintingShapeIds()),[n]);return!t.length||!e?null:t.map(r=>p.jsx(e,{className:"tl-user-indicator__hint",shapeId:r},r+"_hinting"))}function UH(){return p.jsxs("g",{id:Jo("cursor"),children:[p.jsxs("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[p.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),p.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),p.jsxs("g",{fill:"white",transform:"translate(-12,-12)",children:[p.jsx("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),p.jsx("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),p.jsxs("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[p.jsx("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),p.jsx("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function HH(){const n=Jo("cursor_hint");return p.jsx("path",{id:n,fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function KH({id:n,mode:e}){const t=te(),[r,o]=C.useState(null),s=re("is in root",()=>{const i=t.getShape(n);return(i==null?void 0:i.parentId)===t.getCurrentPageId()},[t,n]);return C.useEffect(()=>{if(!s)return;let i=null;const a=Ms("shape to svg",async()=>{const c=Math.random();i=c;const h=t.isShapeOfType(n,"frame")?0:10;let f=t.getShapePageBounds(n);if(!f)return;f=f.clone().expandBy(h);const g=await t.getSvgString([n],{padding:h,background:t.getInstanceState().exportBackground});if(i!==c||!g)return;const y=`data:image/svg+xml;utf8,${encodeURIComponent(g.svg)}`;o({src:y,bounds:f})});return()=>{i=null,a()}},[t,n,s]),!s||!r?null:e==="iframe"?p.jsx("iframe",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,border:"none",transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}}):p.jsx("img",{src:r.src,width:r.bounds.width,height:r.bounds.height,referrerPolicy:"no-referrer",style:{position:"absolute",top:0,left:0,transform:`translate(${r.bounds.x}px, ${r.bounds.maxY+12}px)`,outline:"1px solid black",maxWidth:"none"}})}function WH(){const n=te(),e=re("selection rotation",()=>n.getSelectionRotation(),[n]),t=re("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionForeground:r}=Bt();return!t||!r?null:p.jsx(r,{bounds:t,rotation:e})}function VH(){const n=te(),e=re("selection rotation",()=>n.getSelectionRotation(),[n]),t=re("selection bounds",()=>n.getSelectionRotatedPageBounds(),[n]),{SelectionBackground:r}=Bt();return!t||!r?null:p.jsx(r,{bounds:t,rotation:e})}function GH(){const{OnTheCanvas:n}=Bt();return n?p.jsx(n,{}):null}function qH(){const n=te(),e=re("camera state",()=>n.getCameraState(),[n]);return p.jsx("div",{className:Fe("tl-hit-test-blocker",{"tl-hit-test-blocker__hidden":e==="idle"})})}function YH({className:n,zoom:e,point:t,color:r,viewport:o,opacity:s=1}){const i=C.useRef(null);ru(i,Cn(t.x,o.minX+5/e,o.maxX-5/e),Cn(t.y,o.minY+5/e,o.maxY-5/e),1/e,P.Angle(o.center,t));const a=Jo("cursor_hint");return p.jsxs("svg",{ref:i,className:Fe("tl-overlays__item",n),children:[p.jsx("use",{href:`#${a}`,color:r,strokeWidth:3,stroke:"var(--color-background)"}),p.jsx("use",{href:`#${a}`,color:r,opacity:s})]})}const Ik=C.memo(function({className:e,zoom:t,point:r,color:o,name:s,chatMessage:i}){const a=C.useRef(null);ru(a,r==null?void 0:r.x,r==null?void 0:r.y,1/t);const c=Jo("cursor");return r?p.jsxs("div",{ref:a,className:Fe("tl-overlays__item",e),children:[p.jsx("svg",{className:"tl-cursor",children:p.jsx("use",{href:`#${c}`,color:o})}),i?p.jsxs(p.Fragment,{children:[s&&p.jsx("div",{className:"tl-nametag-title",style:{color:o},children:s}),p.jsx("div",{className:"tl-nametag-chat",style:{backgroundColor:o},children:i})]}):s&&p.jsx("div",{className:"tl-nametag",style:{backgroundColor:o},children:s})]}):null});function XH({x:n,y:e,z:t,size:r}){const o=nu("grid"),s=te(),{gridSteps:i}=s.options;return p.jsxs("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[p.jsx("defs",{children:i.map(({min:a,mid:c,step:u},h)=>{const f=u*r*t,g=.5+n*t,y=.5+e*t,v=g>0?g%f:f+g%f,S=y>0?y%f:f+y%f,w=t<c?Bc(t,[a,c],[0,1]):1;return p.jsx("pattern",{id:i1(o,`${u}`),width:f,height:f,patternUnits:"userSpaceOnUse",children:p.jsx("circle",{className:"tl-grid-dot",cx:v,cy:S,r:1,opacity:w})},h)})}),i.map(({step:a},c)=>p.jsx("rect",{width:"100%",height:"100%",fill:`url(#${o}_${a})`},c))]})}function ZH({handle:n,isCoarse:e,className:t,zoom:r}){const o=te(),s=(e?o.options.coarseHandleRadius:o.options.handleRadius)/r;if(n.type==="clone"){const a=3/r,c=`M0,${-a} A${a},${a} 0 0,1 0,${a}`,u=t7.indexOf(n.id);return p.jsxs("g",{className:Fe(`tl-handle tl-handle__${n.type}`,t),children:[p.jsx("circle",{className:"tl-handle__bg",r:s}),p.jsx("path",{className:"tl-handle__fg",d:c,transform:`rotate(${-90+90*u})`})]})}const i=(n.type==="create"&&e?3:4)/Math.max(r,.25);return p.jsxs("g",{className:Fe(`tl-handle tl-handle__${n.type}`,t),children:[p.jsx("circle",{className:"tl-handle__bg",r:s}),p.jsx("circle",{className:"tl-handle__fg",r:i})]})}const QH=({children:n})=>p.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}),JH=()=>{const{Spinner:n}=Bt();return p.jsx(A1,{children:n?p.jsx(n,{}):null})};function p1(n,e=!0){const t=n.length;if(t<2)return"";let r=n[0],o=n[1];if(t===2)return`M${pt(r)}L${pt(o)}`;let s="";for(let i=2,a=t-1;i<a;i++)r=n[i],o=n[i+1],s+=Ar(r,o);return e?`M${Ar(n[0],n[1])}Q${pt(n[1])}${Ar(n[1],n[2])}T${s}${Ar(n[t-1],n[0])}${Ar(n[0],n[1])}Z`:`M${pt(n[0])}Q${pt(n[1])}${Ar(n[1],n[2])}${n.length>3?"T":""}${s}L${pt(n[t-1])}`}function Ek({scribble:n,zoom:e,color:t,opacity:r,className:o}){return n.points.length?p.jsx("svg",{className:o&&Fe("tl-overlays__item",o),children:p.jsx("path",{className:"tl-scribble",d:p1(n.points,!1),stroke:t??`var(--color-${n.color})`,fill:"none",strokeWidth:8/e,opacity:r??n.opacity})}):null}function cR({bounds:n,rotation:e}){const t=C.useRef(null);return ru(t,n.x,n.y,1,e),C.useLayoutEffect(()=>{const r=t.current;r&&(r.style.width=ee(Math.max(1,n.width))+"px",r.style.height=ee(Math.max(1,n.height))+"px")},[n.width,n.height]),p.jsx("div",{ref:t,className:"tl-selection__bg",draggable:!1})}function eK({bounds:n,rotation:e}){const t=te(),r=C.useRef(null),o=re("only selected shape",()=>t.getOnlySelectedShape(),[t]),s=o?t.getShapeUtil(o).expandSelectionOutlinePx(o):0;return ru(r,n==null?void 0:n.x,n==null?void 0:n.y,1,e,{x:-s,y:-s}),n=n.clone().expandBy(s).zeroFix(),p.jsx("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:p.jsx("rect",{className:Fe("tl-selection__fg__outline"),width:ee(n.width),height:ee(n.height)})})}const tK=()=>p.jsx("div",{className:"tl-shape-error-boundary"}),nK=({shape:n,util:e})=>$g("Indicator: "+n.type,()=>e.indicator(e.editor.store.unsafeGetWithoutCapture(n.id))),rK=({editor:n,id:e})=>{const t=re("shape for indicator",()=>n.store.get(e),[n,e]),{ShapeIndicatorErrorFallback:r}=Bt();return!t||t.isLocked?null:p.jsx(Ld,{fallback:r,onError:o=>n.annotateError(o,{origin:"react.shapeIndicator",willCrashApp:!1}),children:p.jsx(nK,{shape:t,util:n.getShapeUtil(t)},t.id)})},kk=C.memo(function({shapeId:e,className:t,color:r,hidden:o,opacity:s}){const i=te(),a=C.useRef(null);return ha("indicator transform",()=>{const c=a.current;if(!c)return;const u=i.getShapePageTransform(e);u&&c.style.setProperty("transform",u.toCssString())},[i,e]),C.useLayoutEffect(()=>{const c=a.current;c&&c.style.setProperty("display",o?"none":"block")},[o]),p.jsx("svg",{ref:a,className:Fe("tl-overlays__item",t),children:p.jsx("g",{className:"tl-shape-indicator",stroke:r??"var(--color-selected)",opacity:s,children:p.jsx(rK,{editor:i,id:e})})})}),oK=()=>p.jsx("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"}),uR=C.memo(function(){const e=te(),t=C.useRef(new Set),r=re("should display selected ids",()=>{const i=t.current,a=new Set;if(e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle){const c=e.getSelectedShapeIds();for(const u of c)a.add(u);if(e.isInAny("select.idle","select.editing_shape")){const u=e.getInstanceState();if(u.isHoveringCanvas&&!u.isCoarsePointer){const h=e.getHoveredShapeId();h&&a.add(h)}}}if(i.size!==a.size)return t.current=a,a;for(const c of a)if(!i.has(c))return t.current=a,a;return i},[e]),o=re("rendering shapes",()=>e.getRenderingShapes(),[e]),{ShapeIndicator:s}=Bt();return s?o.map(({id:i})=>p.jsx(s,{shapeId:i,hidden:!r.has(i)},i+"_indicator")):null});function sK({points:n,zoom:e}){const t=2.5/e,r=n.reduce((g,y)=>Math.min(g,y.x),1/0),o=n.reduce((g,y)=>Math.max(g,y.x),-1/0),s=n.reduce((g,y)=>Math.min(g,y.y),1/0),i=n.reduce((g,y)=>Math.max(g,y.y),-1/0),a=n.some(g=>g.x===r&&g.y===s);let c,u,h,f;return a?(c=r,u=s,h=o,f=i):(c=r,u=i,h=o,f=s),p.jsxs("g",{className:"tl-snap-indicator",stroke:"lime",children:[p.jsx("line",{x1:c,y1:u,x2:h,y2:f}),n.map((g,y)=>p.jsx("g",{transform:`translate(${g.x},${g.y})`,children:p.jsx("path",{className:"tl-snap-point",d:`M ${-t},${-t} L ${t},${t} M ${-t},${t} L ${t},${-t}`})},y))]})}function iK({gaps:n,direction:e,zoom:t}){const r=3.5/t;let o=[-1/0,1/0],s=null;const i=e==="horizontal";for(const c of n){if(s=Vo(o[0],o[1],i?c.startEdge[0].y:c.startEdge[0].x,i?c.startEdge[1].y:c.startEdge[1].x),s)o=s;else continue;if(s=Vo(o[0],o[1],i?c.endEdge[0].y:c.endEdge[0].x,i?c.endEdge[1].y:c.endEdge[1].x),s)o=s;else continue}if(o===null)return null;const a=(o[0]+o[1])/2;return p.jsx("g",{className:"tl-snap-indicator",stroke:"cyan",children:n.map(({startEdge:c,endEdge:u},h)=>p.jsx(C.Fragment,{children:i?p.jsxs(p.Fragment,{children:[p.jsx("line",{x1:c[0].x,y1:a-2*r,x2:c[1].x,y2:a+2*r}),p.jsx("line",{x1:u[0].x,y1:a-2*r,x2:u[1].x,y2:a+2*r}),p.jsx("line",{x1:c[0].x,y1:a,x2:u[0].x,y2:a}),p.jsx("line",{x1:(c[0].x+u[0].x)/2,y1:a-r,x2:(c[0].x+u[0].x)/2,y2:a+r})]}):p.jsxs(p.Fragment,{children:[p.jsx("line",{x1:a-2*r,y1:c[0].y,x2:a+2*r,y2:c[1].y}),p.jsx("line",{x1:a-2*r,y1:u[0].y,x2:a+2*r,y2:u[1].y}),p.jsx("line",{x1:a,y1:c[0].y,x2:a,y2:u[0].y}),p.jsx("line",{x1:a-r,y1:(c[0].y+u[0].y)/2,x2:a+r,y2:(c[0].y+u[0].y)/2})]})},h))})}function aK({className:n,line:e,zoom:t}){return p.jsx("svg",{className:Fe("tl-overlays__item",n),children:e.type==="points"?p.jsx(sK,{...e,zoom:t}):e.type==="gaps"?p.jsx(iK,{...e,zoom:t}):null})}function f1(){return p.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",children:p.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[p.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),p.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:p.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}const lK=()=>null;function dR(n,e){const t=C.useRef(n);return e(n,t.current)?t.current:(t.current=n,n)}const cK=(n,e)=>(n??(n=null),e??(e=null),n===e?!0:!n||!e?!1:l8(n,e));function aa(n){return dR(n,cK)}const uK=(n,e)=>(n??(n=null),e??(e=null),n===e?!0:!n||!e?!1:ZM(n,e));function ou(n){return dR(n,uK)}const hR=C.createContext(null);function dK({overrides:n={},children:e}){const t=ou(n),r=C.useMemo(()=>({Background:qU,SvgDefs:lK,Brush:L0,ZoomBrush:L0,CollaboratorBrush:L0,Cursor:Ik,CollaboratorCursor:Ik,CollaboratorHint:YH,CollaboratorShapeIndicator:kk,Grid:XH,Scribble:Ek,SnapIndicator:aK,Handles:QH,Handle:ZH,CollaboratorScribble:Ek,ErrorFallback:fR,ShapeErrorFallback:tK,ShapeIndicatorErrorFallback:oK,Spinner:f1,SelectionBackground:cR,SelectionForeground:eK,ShapeIndicators:uR,ShapeIndicator:kk,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:kH,LoadingScreen:JH,...t}),[t]);return p.jsx(hR.Provider,{value:r,children:e})}function Bt(){const n=C.useContext(hR);if(!n)throw new Error("useEditorComponents must be used inside of <EditorComponentsProvider />");return n}const Gg={openWindow(n,e){window.open(n,e,"noopener noreferrer")},refreshPage(){window.location.reload()},async hardReset(){var n;return await((n=window.__tldraw__hardReset)==null?void 0:n.call(window))}};function pR(){Gg.hardReset()}function hK(){Gg.refreshPage()}const pK="https://github.com/tldraw/tldraw/issues/new",fR=({error:n,editor:e})=>{const t=C.useRef(null),[r,o]=C.useState(!1),[s,i]=C.useState(!1),[a,c]=C.useState(!1);let u=null;try{u=Bt().Canvas??null}catch{}const h=n instanceof Error?n.message:String(n),f=n instanceof Error?n.stack:null,g=re("isDarkMode",()=>{try{if(e)return e.user.getIsDarkMode()}catch{}return null},[e]),[y,v]=C.useState(null);C.useLayoutEffect(()=>{var M;g!==null&&v(g);let T=(M=t.current)==null?void 0:M.parentElement,E=!1;for(;T;){if(T.classList.contains("tl-theme__dark")||T.classList.contains("tl-theme__light")){E=!0;break}T=T.parentElement}if(E){v(null);return}typeof window<"u"&&"matchMedia"in window&&v(window.matchMedia("(prefers-color-scheme: dark)").matches)},[g]),C.useEffect(()=>{if(s){const T=e==null?void 0:e.timers.setTimeout(()=>{i(!1)},2e3);return()=>clearTimeout(T)}},[s,e]);const S=()=>{const T=document.createElement("textarea");T.value=f??h,document.body.appendChild(T),T.select(),document.execCommand("copy"),T.remove(),i(!0)},w=()=>{hK()},b=async()=>{pR()},_=new URL(pK);return _.searchParams.set("title",h),_.searchParams.set("labels","bug"),_.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${f??h}
\`\`\`

My browser: ${navigator.userAgent}`),p.jsxs("div",{ref:t,className:Fe("tl-container tl-error-boundary",y===null?"":y?"tl-theme__dark":"tl-theme__light"),children:[p.jsx("div",{className:"tl-error-boundary__overlay"}),e&&p.jsx(s1,{onError:Md,fallback:()=>null,children:p.jsx(l1,{editor:e,children:p.jsx("div",{className:"tl-overlay tl-error-boundary__canvas",children:u?p.jsx(u,{}):null})})}),p.jsx("div",{className:Fe("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!a}),children:a?p.jsxs(p.Fragment,{children:[p.jsx("h2",{children:"Are you sure?"}),p.jsx("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),p.jsxs("div",{className:"tl-error-boundary__content__actions",children:[p.jsx("button",{onClick:()=>c(!1),children:"Cancel"}),p.jsx("button",{className:"tl-error-boundary__reset",onClick:b,children:"Reset data"})]})]}):p.jsxs(p.Fragment,{children:[p.jsx("h2",{children:"Something went wrong"}),p.jsx("p",{children:"Please refresh the page to continue."}),p.jsxs("p",{children:["If you keep seeing this screen, you can create a"," ",p.jsx("a",{href:_.toString(),children:"GitHub issue"})," or ask for help on"," ",p.jsx("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"Discord"}),". If you are still stuck, you can reset the tldraw data on your machine. This may erase the project you were working on, so try to get help first."]}),r&&p.jsxs(p.Fragment,{children:["Message:",p.jsx("h4",{children:p.jsx("code",{children:h})}),"Stack trace:",p.jsxs("div",{className:"tl-error-boundary__content__error",children:[p.jsx("pre",{children:p.jsx("code",{children:f??h})}),p.jsx("button",{onClick:S,children:s?"Copied!":"Copy"})]})]}),p.jsxs("div",{className:"tl-error-boundary__content__actions",children:[p.jsx("button",{onClick:()=>o(!r),children:r?"Hide details":"Show details"}),p.jsxs("div",{className:"tl-error-boundary__content__actions__group",children:[p.jsx("button",{className:"tl-error-boundary__reset",onClick:()=>c(!0),children:"Reset data"}),p.jsx("button",{className:"tl-error-boundary__refresh",onClick:w,children:"Refresh Page"})]})]})]})})]})},gR="TLDRAW_USER_DATA_v3",mR=ot({id:Qe,name:Qe.nullable().optional(),color:Qe.nullable().optional(),locale:Qe.nullable().optional(),animationSpeed:We.nullable().optional(),edgeScrollSpeed:We.nullable().optional(),colorScheme:Hg("light","dark","system").optional(),isSnapMode:nt.nullable().optional(),isWrapMode:nt.nullable().optional(),isDynamicSizeMode:nt.nullable().optional(),isPasteAtCursorMode:nt.nullable().optional()}),ai={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5,AddDynamicSizeMode:6,AllowSystemColorScheme:7,AddPasteAtCursor:8},g1=Math.max(...Object.values(ai));function fK(n){n.version<ai.AddAnimationSpeed&&(n.user.animationSpeed=1),n.version<ai.AddIsSnapMode&&(n.user.isSnapMode=!1),n.version<ai.MakeFieldsNullable,n.version<ai.AddEdgeScrollSpeed&&(n.user.edgeScrollSpeed=1),n.version<ai.AddExcalidrawSelectMode&&(n.user.isWrapMode=!1),n.version<ai.AllowSystemColorScheme&&(n.user.isDarkMode===!0?n.user.colorScheme="dark":n.user.isDarkMode===!1&&(n.user.colorScheme="light"),delete n.user.isDarkMode),n.version<ai.AddDynamicSizeMode&&(n.user.isDynamicSizeMode=!1),n.version<ai.AddPasteAtCursor&&(n.user.isPasteAtCursorMode=!1),n.version=g1}const gw=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function yR(){return gw[Math.floor(Math.random()*gw.length)]}function gK(){var n,e;return typeof window<"u"&&"matchMedia"in window?((e=(n=window.matchMedia)==null?void 0:n.call(window,"(prefers-reduced-motion: reduce)"))==null?void 0:e.matches)??!1:!1}const bs=Object.freeze({name:"New User",locale:$U(),color:yR(),edgeScrollSpeed:1,animationSpeed:gK()?0:1,isSnapMode:!1,isWrapMode:!1,isDynamicSizeMode:!1,isPasteAtCursorMode:!1,colorScheme:"light"});function B0(){return{id:bt(),color:yR()}}function vR(n){if(n===null||typeof n!="object"||!("version"in n)||!("user"in n)||typeof n.version!="number")return B0();const e=zt(n);fK(e);try{return mR.validate(e.user)}catch{return B0()}}function mK(){const n=JSON.parse(Ab(gR)||"null")??null;return vR(n)}const qg=dn("globalUserData",null);function yK(){jb(gR,JSON.stringify({version:g1,user:qg.get()}))}function SR(n){mR.validate(n),qg.set(n),yK(),SK()}const vK=typeof process<"u"&&!1,Dc=typeof BroadcastChannel<"u"&&!vK?new BroadcastChannel("tldraw-user-sync"):null;Dc==null||Dc.addEventListener("message",n=>{const e=n.data;(e==null?void 0:e.type)===wR&&(e==null?void 0:e.origin)!==xR()&&qg.set(vR(e.data))});let U0=null;function xR(){return U0===null&&(U0=bt()),U0}const wR="tldraw-user-preferences-change";function SK(){Dc==null||Dc.postMessage({type:wR,origin:xR(),data:{user:bR(),version:g1}})}function bR(){let n=qg.get();return n||(n=mK(),SR(n)),n}const xK=ce("defaultLocalStorageUserPrefs",()=>bR());function _R(n={}){return{userPreferences:n.userPreferences??xK,setUserPreferences:n.setUserPreferences??SR}}var H0={exports:{}},Tk;function wK(){return Tk||(Tk=1,function(n){var e=Object.prototype.hasOwnProperty,t="~";function r(){}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(t=!1));function o(c,u,h){this.fn=c,this.context=u,this.once=h||!1}function s(c,u,h,f,g){if(typeof h!="function")throw new TypeError("The listener must be a function");var y=new o(h,f||c,g),v=t?t+u:u;return c._events[v]?c._events[v].fn?c._events[v]=[c._events[v],y]:c._events[v].push(y):(c._events[v]=y,c._eventsCount++),c}function i(c,u){--c._eventsCount===0?c._events=new r:delete c._events[u]}function a(){this._events=new r,this._eventsCount=0}a.prototype.eventNames=function(){var u=[],h,f;if(this._eventsCount===0)return u;for(f in h=this._events)e.call(h,f)&&u.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(h)):u},a.prototype.listeners=function(u){var h=t?t+u:u,f=this._events[h];if(!f)return[];if(f.fn)return[f.fn];for(var g=0,y=f.length,v=new Array(y);g<y;g++)v[g]=f[g].fn;return v},a.prototype.listenerCount=function(u){var h=t?t+u:u,f=this._events[h];return f?f.fn?1:f.length:0},a.prototype.emit=function(u,h,f,g,y,v){var S=t?t+u:u;if(!this._events[S])return!1;var w=this._events[S],b=arguments.length,_,T;if(w.fn){switch(w.once&&this.removeListener(u,w.fn,void 0,!0),b){case 1:return w.fn.call(w.context),!0;case 2:return w.fn.call(w.context,h),!0;case 3:return w.fn.call(w.context,h,f),!0;case 4:return w.fn.call(w.context,h,f,g),!0;case 5:return w.fn.call(w.context,h,f,g,y),!0;case 6:return w.fn.call(w.context,h,f,g,y,v),!0}for(T=1,_=new Array(b-1);T<b;T++)_[T-1]=arguments[T];w.fn.apply(w.context,_)}else{var E=w.length,M;for(T=0;T<E;T++)switch(w[T].once&&this.removeListener(u,w[T].fn,void 0,!0),b){case 1:w[T].fn.call(w[T].context);break;case 2:w[T].fn.call(w[T].context,h);break;case 3:w[T].fn.call(w[T].context,h,f);break;case 4:w[T].fn.call(w[T].context,h,f,g);break;default:if(!_)for(M=1,_=new Array(b-1);M<b;M++)_[M-1]=arguments[M];w[T].fn.apply(w[T].context,_)}}return!0},a.prototype.on=function(u,h,f){return s(this,u,h,f,!1)},a.prototype.once=function(u,h,f){return s(this,u,h,f,!0)},a.prototype.removeListener=function(u,h,f,g){var y=t?t+u:u;if(!this._events[y])return this;if(!h)return i(this,y),this;var v=this._events[y];if(v.fn)v.fn===h&&(!g||v.once)&&(!f||v.context===f)&&i(this,y);else{for(var S=0,w=[],b=v.length;S<b;S++)(v[S].fn!==h||g&&!v[S].once||f&&v[S].context!==f)&&w.push(v[S]);w.length?this._events[y]=w.length===1?w[0]:w:i(this,y)}return this},a.prototype.removeAllListeners=function(u){var h;return u?(h=t?t+u:u,this._events[h]&&i(this,h)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,n.exports=a}(H0)),H0.exports}var bK=wK();const _K=wa(bK),Lc="TLDRAW_TAB_ID_v2",mi=globalThis.window;function PK(){return mi?["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(mi.navigator.platform)||kt.isDarwin&&"ontouchend"in document:!1}const dg=mi?mi[Lc]??uA(Lc)??"TLDRAW_INSTANCE_STATE_V1_"+bt():"<error>";mi&&(mi[Lc]=dg,PK()?Rb(Lc,dg):dA(Lc));mi==null||mi.addEventListener("beforeunload",()=>{Rb(Lc,dg)});const PR={Initial:0},Yg=Math.max(...Object.values(PR));function CK(n){n.version<PR.Initial,n.version=Yg}const CR=ot({version:We,currentPageId:Od.optional(),isFocusMode:nt.optional(),exportBackground:nt.optional(),isDebugMode:nt.optional(),isToolLocked:nt.optional(),isGridMode:nt.optional(),pageStates:Tn(ot({pageId:Od,camera:ot({x:We,y:We,z:We}).optional(),selectedShapeIds:Tn(_o).optional(),focusedGroupId:_o.nullable().optional()})).optional()});function IK(n){if(!n||typeof n!="object")return console.warn("Invalid instance state"),null;if(!("version"in n)||typeof n.version!="number")return console.warn("No version in instance state"),null;n.version!==Yg&&(n=zt(n),CK(n));try{return CR.validate(n)}catch(e){return console.warn(e),null}}function m1(n){const e=n.query.ids("page");return ce("sessionStateSnapshot",()=>{const t=n.get(ir);if(!t)return null;const r=[...e.get()];return{version:Yg,currentPageId:t.currentPageId,exportBackground:t.exportBackground,isFocusMode:t.isFocusMode,isDebugMode:t.isDebugMode,isToolLocked:t.isToolLocked,isGridMode:t.isGridMode,pageStates:r.map(o=>{const s=n.get(Xo.createId(o)),i=n.get(Es.createId(o));return{pageId:o,camera:{x:(i==null?void 0:i.x)??0,y:(i==null?void 0:i.y)??0,z:(i==null?void 0:i.z)??1},selectedShapeIds:(s==null?void 0:s.selectedShapeIds)??[],focusedGroupId:(s==null?void 0:s.focusedGroupId)??null}})}},{isEqual:QA})}function mw(n,e,t){const r=IK(e);if(!r)return;const o=fj(n.get(ir)),s=t!=null&&t.forceOverwrite?r:o,i=t!=null&&t.forceOverwrite?o:r,a=n.schema.types.instance.create({id:ir,...o,currentPageId:r.currentPageId,isDebugMode:(s==null?void 0:s.isDebugMode)??(i==null?void 0:i.isDebugMode),isFocusMode:(s==null?void 0:s.isFocusMode)??(i==null?void 0:i.isFocusMode),isToolLocked:(s==null?void 0:s.isToolLocked)??(i==null?void 0:i.isToolLocked),isGridMode:(s==null?void 0:s.isGridMode)??(i==null?void 0:i.isGridMode),exportBackground:(s==null?void 0:s.exportBackground)??(i==null?void 0:i.exportBackground)});n.atomic(()=>{var c,u,h;for(const f of r.pageStates??[]){if(!n.has(f.pageId))continue;const g=Es.createId(f.pageId),y=Xo.createId(f.pageId),v=n.get(g),S=n.get(y);n.put([Es.create({id:g,x:((c=f.camera)==null?void 0:c.x)??(v==null?void 0:v.x),y:((u=f.camera)==null?void 0:u.y)??(v==null?void 0:v.y),z:((h=f.camera)==null?void 0:h.z)??(v==null?void 0:v.z)}),Xo.create({id:y,pageId:f.pageId,selectedShapeIds:f.selectedShapeIds??(S==null?void 0:S.selectedShapeIds),focusedGroupId:f.focusedGroupId??(S==null?void 0:S.focusedGroupId)})])}n.put([a]),n.ensureStoreIsUsable()})}function EK(n){var o;const e=[];for(const s of Object.values(n))(o=s.typeName)!=null&&o.match(/^(instance.*|pointer|camera)$/)&&e.push(s);const t=e.filter(s=>s.typeName==="instance"&&s.id!==ir)[0];if(!t)return null;const r={version:Yg,currentPageId:t.currentPageId,exportBackground:!!t.exportBackground,isFocusMode:!!t.isFocusMode,isDebugMode:!!t.isDebugMode,isToolLocked:!!t.isToolLocked,isGridMode:!1,pageStates:e.filter(s=>s.typeName==="instance_page_state"&&s.instanceId===t.id).map(s=>{const i=n[s.cameraId]??{x:0,y:0,z:1};return{pageId:s.pageId,camera:{x:i.x,y:i.y,z:i.z},selectedShapeIds:s.selectedShapeIds,focusedGroupId:s.focusedGroupId}})};try{return CR.validate(r),r}catch{return null}}function IR(n,e,t){let r={};if("store"in e){const i=n.schema.migrateStoreSnapshot(e);if(i.type!=="success")throw new Error("Failed to migrate store snapshot: "+i.reason);r.document={schema:n.schema.serialize(),store:Sd(i.value,(a,{typeName:c})=>n.scopedTypes.document.has(c))}}else r=e;const o=fj(n.get(ir)),s=ER.get(n,m1).get();n.atomic(()=>{r.document&&n.loadStoreSnapshot(r.document),o&&n.update(ir,i=>({...i,...o})),s&&mw(n,s),r.session&&mw(n,r.session,{forceOverwrite:t==null?void 0:t.forceOverwriteSessionState})})}const ER=new Os;function kK(n){const t=ER.get(n,m1).get();if(!t)throw new Error("Session state is not ready yet");return{document:n.getStoreSnapshot(),session:t}}function kR(n){const e=[],t=new Set;for(const r of n){if(t.has(r.type))throw new Error(`Binding type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}function Sa({children:n,className:e="",...t}){return p.jsx("svg",{...t,className:Fe("tl-svg-container",e),children:n})}function y1(n,e,t,r){const o=n.x-t.x,s=n.y-t.y,i=r.x-t.x,a=r.y-t.y,c=e.x-n.x,u=e.y-n.y,h=i*s-a*o,f=c*s-u*o,g=a*c-i*u;if(h===0||f===0||g===0)return null;if(g!==0){const y=h/g,v=f/g;if(0<=y&&y<=1&&0<=v&&v<=1)return P.AddXY(n,y*c,y*u)}return null}function nh(n,e,t,r){const o=(e.x-n.x)*(e.x-n.x)+(e.y-n.y)*(e.y-n.y),s=2*((e.x-n.x)*(n.x-t.x)+(e.y-n.y)*(n.y-t.y)),i=t.x*t.x+t.y*t.y+n.x*n.x+n.y*n.y-2*(t.x*n.x+t.y*n.y)-r*r,a=s*s-4*o*i;if(a<0||a===0)return null;const c=Math.sqrt(a),u=(-s+c)/(2*o),h=(-s-c)/(2*o);if((u<0||u>1)&&(h<0||h>1))return null;const f=[];return 0<=u&&u<=1&&f.push(P.Lrp(n,e,u)),0<=h&&h<=1&&f.push(P.Lrp(n,e,h)),f.length===0?null:f}function TK(n,e,t){const r=[];let o;for(let s=0,i=t.length-1;s<i;s++)o=y1(n,e,t[s],t[s+1]),o&&r.push(o);return r.length===0?null:r}function v1(n,e,t){const r=[];let o;for(let s=1,i=t.length;s<i+1;s++)o=y1(n,e,t[s-1],t[s%t.length]),o&&r.push(o);return r.length===0?null:r}function MK(n,e,t,r){let o=t.x-n.x,s=t.y-n.y;const i=Math.sqrt(o*o+s*s),a=(i*i-r*r+e*e)/(2*i),c=Math.sqrt(e*e-a*a);return o/=i,s/=i,[new P(n.x+o*a-s*c,n.y+s*a+o*c),new P(n.x+o*a+s*c,n.y+s*a-o*c)]}function yw(n,e,t){const r=[];let o,s,i;for(let a=0,c=t.length;a<c;a++)o=t[a],s=t[(a+1)%t.length],i=nh(o,s,n,e),i&&r.push(...i);return r.length===0?null:r}function Mk(n,e,t){const r=[];let o,s,i;for(let a=1,c=t.length;a<c;a++)o=t[a-1],s=t[a],i=nh(o,s,n,e),i&&r.push(...i);return r.length===0?null:r}function Rp(n,e,t){return(t.y-n.y)*(e.x-n.x)>(e.y-n.y)*(t.x-n.x)}function S1(n,e,t,r){return Rp(n,t,r)!==Rp(e,t,r)&&Rp(n,e,t)!==Rp(n,e,r)}function Ak(n,e){const t=new Map;let r,o,s,i;for(let a=0,c=n.length;a<c;a++)if(r=n[a],no(r,e)){const u=K0(r);t.has(u)||t.set(u,r)}for(let a=0,c=e.length;a<c;a++)if(r=e[a],no(r,n)){const u=K0(r);t.has(u)||t.set(u,r)}for(let a=0,c=n.length;a<c;a++){r=n[a],o=n[(a+1)%n.length];for(let u=0,h=e.length;u<h;u++){s=e[u],i=e[(u+1)%e.length];const f=y1(r,o,s,i);if(f!==null){const g=K0(f);t.has(g)||t.set(g,f)}}}return t.size===0?null:AK([...t.values()])}function K0(n){return`${n.x},${n.y}`}function AK(n){const e=P.Average(n);return n.sort((t,r)=>P.Angle(e,t)-P.Angle(e,r))}function x1(n,e){let t,r,o,s;for(let i=0,a=n.length;i<a;i++){t=n[i],r=n[(i+1)%a];for(let c=0,u=e.length;c<u;c++)if(o=e[c],s=e[(c+1)%u],S1(t,r,o,s))return!0}return!1}function jK(n,e){let t,r,o,s;for(let i=0,a=n.length;i<a;i++){t=n[i],r=n[(i+1)%a];for(let c=1,u=e.length;c<u;c++)if(o=e[c-1],s=e[c],S1(t,r,o,s))return!0}return!1}class pi extends Ea{constructor(t){super({...t,isClosed:!1,isFilled:!1});j(this,"start");j(this,"end");j(this,"d");j(this,"u");j(this,"ul");const{start:r,end:o}=t;this.start=r,this.end=o,this.d=r.clone().sub(o),this.u=this.d.clone().uni(),this.ul=this.u.len()}getLength(){return this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(t){const{start:r,end:o,d:s,u:i,ul:a}=this;if(s.len()===0||a===0)return r;const c=P.Sub(t,r).dpr(i)/a,u=r.x+i.x*c;if(u<Math.min(r.x,o.x))return r.x<o.x?r:o;if(u>Math.max(r.x,o.x))return r.x>o.x?r:o;const h=r.y+i.y*c;return h<Math.min(r.y,o.y)?r.y<o.y?r:o:h>Math.max(r.y,o.y)?r.y>o.y?r:o:new P(u,h)}hitTestLineSegment(t,r,o=0){return S1(t,r,this.start,this.end)||this.distanceToLineSegment(t,r)<=o}getSvgPathData(t=!0){const{start:r,end:o}=this;return`${t?`M${r.toFixed()}`:""} L${o.toFixed()}`}}class su extends Ea{constructor(t){super({isClosed:!1,isFilled:!1,...t});j(this,"points");j(this,"_segments");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{vertices:t}=this;for(let r=0,o=t.length-1;r<o;r++){const s=t[r],i=t[r+1];this._segments.push(new pi({start:s,end:i}))}this.isClosed&&this._segments.push(new pi({start:t[t.length-1],end:t[0]}))}return this._segments}getLength(){return this.segments.reduce((t,r)=>t+r.length,0)}getVertices(){return this.points}nearestPoint(t){const{segments:r}=this;let o=this.points[0],s=1/0,i,a;for(let c=0;c<r.length;c++)i=r[c].nearestPoint(t),a=P.Dist2(i,t),a<s&&(o=i,s=a);if(!o)throw Error("nearest point not found");return o}hitTestLineSegment(t,r,o=0){const{segments:s}=this;for(let i=0,a=s.length;i<a;i++)if(s[i].hitTestLineSegment(t,r,o))return!0;return!1}getSvgPathData(){const{vertices:t}=this;return t.length<2?"":t.reduce((r,o,s)=>s===0?`M ${o.x} ${o.y}`:`${r} L ${o.x} ${o.y}`,"")}}class on extends su{constructor(e){super({...e}),this.isClosed=!0}}class Ns extends on{constructor(t){const{x:r=0,y:o=0,width:s,height:i}=t;super({...t,points:[new P(r,o),new P(r+s,o),new P(r+s,o+i),new P(r,o+i)]});j(this,"x");j(this,"y");j(this,"w");j(this,"h");this.x=r,this.y=o,this.w=s,this.h=i}getBounds(){return new xe(this.x,this.y,this.w,this.h)}getSvgPathData(){const{x:t,y:r,w:o,h:s}=this;return`M${t},${r} h${o} v${s} h-${o}z`}}class es{constructor(e){this.editor=e}canSnap(e){return!0}canScroll(e){return!1}canBind(e){return!0}canEdit(e){return!1}canResize(e){return!0}canEditInReadOnly(e){return!1}canCrop(e){return!1}canBeLaidOut(e){return!0}providesBackgroundForChildren(e){return!1}hideResizeHandles(e){return!1}hideRotateHandle(e){return!1}hideSelectionBoundsBg(e){return!1}hideSelectionBoundsFg(e){return!1}isAspectRatioLocked(e){return!1}canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}getText(e){}}j(es,"props"),j(es,"migrations"),j(es,"type");function qo(n,e,t={}){const{closed:r=!1,snap:o=1,start:s="outset",end:i="outset",lengthRatio:a=2,style:c="dashed",forceSolid:u=!1}=t;let h=0,f=0,g=1,y=0,v=0;if(u)return{strokeDasharray:"none",strokeDashoffset:"none"};switch(c){case"dashed":{g=1,h=Math.min(e*a,n/4);break}case"dotted":{g=100,h=e/g;break}default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||(s==="outset"?(n+=h/2,v+=h/2):s==="skip"&&(n-=h,v-=h),i==="outset"?n+=h/2:i==="skip"&&(n-=h)),f=Math.floor(n/h/(2*g)),f-=f%o,f<3&&c==="dashed"?n/e<4?(h=n,f=1,y=0):(h=n*(1/3),y=n*(1/3)):(h=n/f/(2*g),r?(v=h/2,y=(n-f*h)/f):y=(n-f*h)/Math.max(1,f-1)),{strokeDasharray:[h,y].join(" "),strokeDashoffset:v.toString()}}function jk({bounds:n,className:e}){const t=te(),r=re("zoom level",()=>t.getZoomLevel(),[t]);return p.jsx("g",{className:e,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:n.sides.map((o,s)=>{const{strokeDasharray:i,strokeDashoffset:a}=qo(o[0].dist(o[1]),1/r,{style:"dashed",lengthRatio:4});return p.jsx("line",{x1:o[0].x,y1:o[0].y,x2:o[1].x,y2:o[1].y,strokeDasharray:i,strokeDashoffset:a},s)})})}class hf extends es{hideSelectionBoundsFg(){return!0}canBind(){return!1}getDefaultProps(){return{}}getGeometry(e){const t=this.editor.getSortedChildIdsForParent(e.id);return t.length===0?new Ns({width:1,height:1,isFilled:!1}):new To({children:t.map(r=>{const o=this.editor.getShape(r),s=this.editor.getShapeGeometry(r),i=this.editor.getShapeLocalTransform(o).applyToPoints(s.vertices);return s.isClosed?new on({points:i,isFilled:!0}):new su({points:i})})})}component(e){const t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:r}=this.editor.getCurrentPageState(),o=r.length>0&&r.some(a=>a!==e.id&&this.editor.isShapeOfType(this.editor.getShape(a),"group")),s=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(s||o))return null;const i=this.editor.getShapeGeometry(e).bounds;return p.jsx(Sa,{children:p.jsx(jk,{className:"tl-group",bounds:i})})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return p.jsx(jk,{className:"",bounds:t})}onChildrenChange(e){const t=this.editor.getSortedChildIdsForParent(e.id);if(t.length===0){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}else if(t.length===1){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),this.editor.deleteShapes([e.id]);return}}}j(hf,"type","group"),j(hf,"props",Ij),j(hf,"migrations",Ej);const TR=[hf],RK=new Set(TR.map(n=>n.type));function MR(n){const e=[...TR],t=new Set;for(const r of n){if(RK.has(r.type))throw new Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(t.has(r.type))throw new Error(`Shape type "${r.type}" is defined more than once`);e.push(r),t.add(r.type)}return e}var W0={exports:{}},Pr={},V0={exports:{}},G0={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rk;function OK(){return Rk||(Rk=1,function(n){function e(q,Q){var ae=q.length;q.push(Q);e:for(;0<ae;){var B=ae-1>>>1,oe=q[B];if(0<o(oe,Q))q[B]=Q,q[ae]=oe,ae=B;else break e}}function t(q){return q.length===0?null:q[0]}function r(q){if(q.length===0)return null;var Q=q[0],ae=q.pop();if(ae!==Q){q[0]=ae;e:for(var B=0,oe=q.length,pe=oe>>>1;B<pe;){var _e=2*(B+1)-1,ue=q[_e],Ne=_e+1,Te=q[Ne];if(0>o(ue,ae))Ne<oe&&0>o(Te,ue)?(q[B]=Te,q[Ne]=ae,B=Ne):(q[B]=ue,q[_e]=ae,B=_e);else if(Ne<oe&&0>o(Te,ae))q[B]=Te,q[Ne]=ae,B=Ne;else break e}}return Q}function o(q,Q){var ae=q.sortIndex-Q.sortIndex;return ae!==0?ae:q.id-Q.id}if(typeof performance=="object"&&typeof performance.now=="function"){var s=performance;n.unstable_now=function(){return s.now()}}else{var i=Date,a=i.now();n.unstable_now=function(){return i.now()-a}}var c=[],u=[],h=1,f=null,g=3,y=!1,v=!1,S=!1,w=typeof setTimeout=="function"?setTimeout:null,b=typeof clearTimeout=="function"?clearTimeout:null,_=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function T(q){for(var Q=t(u);Q!==null;){if(Q.callback===null)r(u);else if(Q.startTime<=q)r(u),Q.sortIndex=Q.expirationTime,e(c,Q);else break;Q=t(u)}}function E(q){if(S=!1,T(q),!v)if(t(c)!==null)v=!0,Z(M);else{var Q=t(u);Q!==null&&G(E,Q.startTime-q)}}function M(q,Q){v=!1,S&&(S=!1,b(L),L=-1),y=!0;var ae=g;try{for(T(Q),f=t(c);f!==null&&(!(f.expirationTime>Q)||q&&!U());){var B=f.callback;if(typeof B=="function"){f.callback=null,g=f.priorityLevel;var oe=B(f.expirationTime<=Q);Q=n.unstable_now(),typeof oe=="function"?f.callback=oe:f===t(c)&&r(c),T(Q)}else r(c);f=t(c)}if(f!==null)var pe=!0;else{var _e=t(u);_e!==null&&G(E,_e.startTime-Q),pe=!1}return pe}finally{f=null,g=ae,y=!1}}var A=!1,R=null,L=-1,K=5,D=-1;function U(){return!(n.unstable_now()-D<K)}function V(){if(R!==null){var q=n.unstable_now();D=q;var Q=!0;try{Q=R(!0,q)}finally{Q?F():(A=!1,R=null)}}else A=!1}var F;if(typeof _=="function")F=function(){_(V)};else if(typeof MessageChannel<"u"){var $=new MessageChannel,H=$.port2;$.port1.onmessage=V,F=function(){H.postMessage(null)}}else F=function(){w(V,0)};function Z(q){R=q,A||(A=!0,F())}function G(q,Q){L=w(function(){q(n.unstable_now())},Q)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(q){q.callback=null},n.unstable_continueExecution=function(){v||y||(v=!0,Z(M))},n.unstable_forceFrameRate=function(q){0>q||125<q?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):K=0<q?Math.floor(1e3/q):5},n.unstable_getCurrentPriorityLevel=function(){return g},n.unstable_getFirstCallbackNode=function(){return t(c)},n.unstable_next=function(q){switch(g){case 1:case 2:case 3:var Q=3;break;default:Q=g}var ae=g;g=Q;try{return q()}finally{g=ae}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(q,Q){switch(q){case 1:case 2:case 3:case 4:case 5:break;default:q=3}var ae=g;g=q;try{return Q()}finally{g=ae}},n.unstable_scheduleCallback=function(q,Q,ae){var B=n.unstable_now();switch(typeof ae=="object"&&ae!==null?(ae=ae.delay,ae=typeof ae=="number"&&0<ae?B+ae:B):ae=B,q){case 1:var oe=-1;break;case 2:oe=250;break;case 5:oe=1073741823;break;case 4:oe=1e4;break;default:oe=5e3}return oe=ae+oe,q={id:h++,callback:Q,priorityLevel:q,startTime:ae,expirationTime:oe,sortIndex:-1},ae>B?(q.sortIndex=ae,e(u,q),t(c)===null&&q===t(u)&&(S?(b(L),L=-1):S=!0,G(E,ae-B))):(q.sortIndex=oe,e(c,q),v||y||(v=!0,Z(M))),q},n.unstable_shouldYield=U,n.unstable_wrapCallback=function(q){var Q=g;return function(){var ae=g;g=Q;try{return q.apply(this,arguments)}finally{g=ae}}}}(G0)),G0}var Ok;function DK(){return Ok||(Ok=1,V0.exports=OK()),V0.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Dk;function LK(){if(Dk)return Pr;Dk=1;var n=Vb(),e=DK();function t(l){for(var d="https://reactjs.org/docs/error-decoder.html?invariant="+l,m=1;m<arguments.length;m++)d+="&args[]="+encodeURIComponent(arguments[m]);return"Minified React error #"+l+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var r=new Set,o={};function s(l,d){i(l,d),i(l+"Capture",d)}function i(l,d){for(o[l]=d,l=0;l<d.length;l++)r.add(d[l])}var a=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),c=Object.prototype.hasOwnProperty,u=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},f={};function g(l){return c.call(f,l)?!0:c.call(h,l)?!1:u.test(l)?f[l]=!0:(h[l]=!0,!1)}function y(l,d,m,x){if(m!==null&&m.type===0)return!1;switch(typeof d){case"function":case"symbol":return!0;case"boolean":return x?!1:m!==null?!m.acceptsBooleans:(l=l.toLowerCase().slice(0,5),l!=="data-"&&l!=="aria-");default:return!1}}function v(l,d,m,x){if(d===null||typeof d>"u"||y(l,d,m,x))return!0;if(x)return!1;if(m!==null)switch(m.type){case 3:return!d;case 4:return d===!1;case 5:return isNaN(d);case 6:return isNaN(d)||1>d}return!1}function S(l,d,m,x,I,k,O){this.acceptsBooleans=d===2||d===3||d===4,this.attributeName=x,this.attributeNamespace=I,this.mustUseProperty=m,this.propertyName=l,this.type=d,this.sanitizeURL=k,this.removeEmptyString=O}var w={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(l){w[l]=new S(l,0,!1,l,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(l){var d=l[0];w[d]=new S(d,1,!1,l[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(l){w[l]=new S(l,2,!1,l.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(l){w[l]=new S(l,2,!1,l,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(l){w[l]=new S(l,3,!1,l.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(l){w[l]=new S(l,3,!0,l,null,!1,!1)}),["capture","download"].forEach(function(l){w[l]=new S(l,4,!1,l,null,!1,!1)}),["cols","rows","size","span"].forEach(function(l){w[l]=new S(l,6,!1,l,null,!1,!1)}),["rowSpan","start"].forEach(function(l){w[l]=new S(l,5,!1,l.toLowerCase(),null,!1,!1)});var b=/[\-:]([a-z])/g;function _(l){return l[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(l){var d=l.replace(b,_);w[d]=new S(d,1,!1,l,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(l){var d=l.replace(b,_);w[d]=new S(d,1,!1,l,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(l){var d=l.replace(b,_);w[d]=new S(d,1,!1,l,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(l){w[l]=new S(l,1,!1,l.toLowerCase(),null,!1,!1)}),w.xlinkHref=new S("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(l){w[l]=new S(l,1,!1,l.toLowerCase(),null,!0,!0)});function T(l,d,m,x){var I=w.hasOwnProperty(d)?w[d]:null;(I!==null?I.type!==0:x||!(2<d.length)||d[0]!=="o"&&d[0]!=="O"||d[1]!=="n"&&d[1]!=="N")&&(v(d,m,I,x)&&(m=null),x||I===null?g(d)&&(m===null?l.removeAttribute(d):l.setAttribute(d,""+m)):I.mustUseProperty?l[I.propertyName]=m===null?I.type===3?!1:"":m:(d=I.attributeName,x=I.attributeNamespace,m===null?l.removeAttribute(d):(I=I.type,m=I===3||I===4&&m===!0?"":""+m,x?l.setAttributeNS(x,d,m):l.setAttribute(d,m))))}var E=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,M=Symbol.for("react.element"),A=Symbol.for("react.portal"),R=Symbol.for("react.fragment"),L=Symbol.for("react.strict_mode"),K=Symbol.for("react.profiler"),D=Symbol.for("react.provider"),U=Symbol.for("react.context"),V=Symbol.for("react.forward_ref"),F=Symbol.for("react.suspense"),$=Symbol.for("react.suspense_list"),H=Symbol.for("react.memo"),Z=Symbol.for("react.lazy"),G=Symbol.for("react.offscreen"),q=Symbol.iterator;function Q(l){return l===null||typeof l!="object"?null:(l=q&&l[q]||l["@@iterator"],typeof l=="function"?l:null)}var ae=Object.assign,B;function oe(l){if(B===void 0)try{throw Error()}catch(m){var d=m.stack.trim().match(/\n( *(at )?)/);B=d&&d[1]||""}return`
`+B+l}var pe=!1;function _e(l,d){if(!l||pe)return"";pe=!0;var m=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(d)if(d=function(){throw Error()},Object.defineProperty(d.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(d,[])}catch(se){var x=se}Reflect.construct(l,[],d)}else{try{d.call()}catch(se){x=se}l.call(d.prototype)}else{try{throw Error()}catch(se){x=se}l()}}catch(se){if(se&&x&&typeof se.stack=="string"){for(var I=se.stack.split(`
`),k=x.stack.split(`
`),O=I.length-1,z=k.length-1;1<=O&&0<=z&&I[O]!==k[z];)z--;for(;1<=O&&0<=z;O--,z--)if(I[O]!==k[z]){if(O!==1||z!==1)do if(O--,z--,0>z||I[O]!==k[z]){var W=`
`+I[O].replace(" at new "," at ");return l.displayName&&W.includes("<anonymous>")&&(W=W.replace("<anonymous>",l.displayName)),W}while(1<=O&&0<=z);break}}}finally{pe=!1,Error.prepareStackTrace=m}return(l=l?l.displayName||l.name:"")?oe(l):""}function ue(l){switch(l.tag){case 5:return oe(l.type);case 16:return oe("Lazy");case 13:return oe("Suspense");case 19:return oe("SuspenseList");case 0:case 2:case 15:return l=_e(l.type,!1),l;case 11:return l=_e(l.type.render,!1),l;case 1:return l=_e(l.type,!0),l;default:return""}}function Ne(l){if(l==null)return null;if(typeof l=="function")return l.displayName||l.name||null;if(typeof l=="string")return l;switch(l){case R:return"Fragment";case A:return"Portal";case K:return"Profiler";case L:return"StrictMode";case F:return"Suspense";case $:return"SuspenseList"}if(typeof l=="object")switch(l.$$typeof){case U:return(l.displayName||"Context")+".Consumer";case D:return(l._context.displayName||"Context")+".Provider";case V:var d=l.render;return l=l.displayName,l||(l=d.displayName||d.name||"",l=l!==""?"ForwardRef("+l+")":"ForwardRef"),l;case H:return d=l.displayName||null,d!==null?d:Ne(l.type)||"Memo";case Z:d=l._payload,l=l._init;try{return Ne(l(d))}catch{}}return null}function Te(l){var d=l.type;switch(l.tag){case 24:return"Cache";case 9:return(d.displayName||"Context")+".Consumer";case 10:return(d._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return l=d.render,l=l.displayName||l.name||"",d.displayName||(l!==""?"ForwardRef("+l+")":"ForwardRef");case 7:return"Fragment";case 5:return d;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Ne(d);case 8:return d===L?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof d=="function")return d.displayName||d.name||null;if(typeof d=="string")return d}return null}function we(l){switch(typeof l){case"boolean":case"number":case"string":case"undefined":return l;case"object":return l;default:return""}}function Ie(l){var d=l.type;return(l=l.nodeName)&&l.toLowerCase()==="input"&&(d==="checkbox"||d==="radio")}function Ve(l){var d=Ie(l)?"checked":"value",m=Object.getOwnPropertyDescriptor(l.constructor.prototype,d),x=""+l[d];if(!l.hasOwnProperty(d)&&typeof m<"u"&&typeof m.get=="function"&&typeof m.set=="function"){var I=m.get,k=m.set;return Object.defineProperty(l,d,{configurable:!0,get:function(){return I.call(this)},set:function(O){x=""+O,k.call(this,O)}}),Object.defineProperty(l,d,{enumerable:m.enumerable}),{getValue:function(){return x},setValue:function(O){x=""+O},stopTracking:function(){l._valueTracker=null,delete l[d]}}}}function Xe(l){l._valueTracker||(l._valueTracker=Ve(l))}function Zt(l){if(!l)return!1;var d=l._valueTracker;if(!d)return!0;var m=d.getValue(),x="";return l&&(x=Ie(l)?l.checked?"true":"false":l.value),l=x,l!==m?(d.setValue(l),!0):!1}function vt(l){if(l=l||(typeof document<"u"?document:void 0),typeof l>"u")return null;try{return l.activeElement||l.body}catch{return l.body}}function Ut(l,d){var m=d.checked;return ae({},d,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:m??l._wrapperState.initialChecked})}function St(l,d){var m=d.defaultValue==null?"":d.defaultValue,x=d.checked!=null?d.checked:d.defaultChecked;m=we(d.value!=null?d.value:m),l._wrapperState={initialChecked:x,initialValue:m,controlled:d.type==="checkbox"||d.type==="radio"?d.checked!=null:d.value!=null}}function It(l,d){d=d.checked,d!=null&&T(l,"checked",d,!1)}function tr(l,d){It(l,d);var m=we(d.value),x=d.type;if(m!=null)x==="number"?(m===0&&l.value===""||l.value!=m)&&(l.value=""+m):l.value!==""+m&&(l.value=""+m);else if(x==="submit"||x==="reset"){l.removeAttribute("value");return}d.hasOwnProperty("value")?fr(l,d.type,m):d.hasOwnProperty("defaultValue")&&fr(l,d.type,we(d.defaultValue)),d.checked==null&&d.defaultChecked!=null&&(l.defaultChecked=!!d.defaultChecked)}function ls(l,d,m){if(d.hasOwnProperty("value")||d.hasOwnProperty("defaultValue")){var x=d.type;if(!(x!=="submit"&&x!=="reset"||d.value!==void 0&&d.value!==null))return;d=""+l._wrapperState.initialValue,m||d===l.value||(l.value=d),l.defaultValue=d}m=l.name,m!==""&&(l.name=""),l.defaultChecked=!!l._wrapperState.initialChecked,m!==""&&(l.name=m)}function fr(l,d,m){(d!=="number"||vt(l.ownerDocument)!==l)&&(m==null?l.defaultValue=""+l._wrapperState.initialValue:l.defaultValue!==""+m&&(l.defaultValue=""+m))}var co=Array.isArray;function uo(l,d,m,x){if(l=l.options,d){d={};for(var I=0;I<m.length;I++)d["$"+m[I]]=!0;for(m=0;m<l.length;m++)I=d.hasOwnProperty("$"+l[m].value),l[m].selected!==I&&(l[m].selected=I),I&&x&&(l[m].defaultSelected=!0)}else{for(m=""+we(m),d=null,I=0;I<l.length;I++){if(l[I].value===m){l[I].selected=!0,x&&(l[I].defaultSelected=!0);return}d!==null||l[I].disabled||(d=l[I])}d!==null&&(d.selected=!0)}}function Ra(l,d){if(d.dangerouslySetInnerHTML!=null)throw Error(t(91));return ae({},d,{value:void 0,defaultValue:void 0,children:""+l._wrapperState.initialValue})}function Tl(l,d){var m=d.value;if(m==null){if(m=d.children,d=d.defaultValue,m!=null){if(d!=null)throw Error(t(92));if(co(m)){if(1<m.length)throw Error(t(93));m=m[0]}d=m}d==null&&(d=""),m=d}l._wrapperState={initialValue:we(m)}}function Ml(l,d){var m=we(d.value),x=we(d.defaultValue);m!=null&&(m=""+m,m!==l.value&&(l.value=m),d.defaultValue==null&&l.defaultValue!==m&&(l.defaultValue=m)),x!=null&&(l.defaultValue=""+x)}function Al(l){var d=l.textContent;d===l._wrapperState.initialValue&&d!==""&&d!==null&&(l.value=d)}function jl(l){switch(l){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function cs(l,d){return l==null||l==="http://www.w3.org/1999/xhtml"?jl(d):l==="http://www.w3.org/2000/svg"&&d==="foreignObject"?"http://www.w3.org/1999/xhtml":l}var Oo,Oa=function(l){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(d,m,x,I){MSApp.execUnsafeLocalFunction(function(){return l(d,m,x,I)})}:l}(function(l,d){if(l.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in l)l.innerHTML=d;else{for(Oo=Oo||document.createElement("div"),Oo.innerHTML="<svg>"+d.valueOf().toString()+"</svg>",d=Oo.firstChild;l.firstChild;)l.removeChild(l.firstChild);for(;d.firstChild;)l.appendChild(d.firstChild)}});function ie(l,d){if(d){var m=l.firstChild;if(m&&m===l.lastChild&&m.nodeType===3){m.nodeValue=d;return}}l.textContent=d}var Se={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ke=["Webkit","ms","Moz","O"];Object.keys(Se).forEach(function(l){Ke.forEach(function(d){d=d+l.charAt(0).toUpperCase()+l.substring(1),Se[d]=Se[l]})});function _t(l,d,m){return d==null||typeof d=="boolean"||d===""?"":m||typeof d!="number"||d===0||Se.hasOwnProperty(l)&&Se[l]?(""+d).trim():d+"px"}function ho(l,d){l=l.style;for(var m in d)if(d.hasOwnProperty(m)){var x=m.indexOf("--")===0,I=_t(m,d[m],x);m==="float"&&(m="cssFloat"),x?l.setProperty(m,I):l[m]=I}}var gr=ae({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vs(l,d){if(d){if(gr[l]&&(d.children!=null||d.dangerouslySetInnerHTML!=null))throw Error(t(137,l));if(d.dangerouslySetInnerHTML!=null){if(d.children!=null)throw Error(t(60));if(typeof d.dangerouslySetInnerHTML!="object"||!("__html"in d.dangerouslySetInnerHTML))throw Error(t(61))}if(d.style!=null&&typeof d.style!="object")throw Error(t(62))}}function Br(l,d){if(l.indexOf("-")===-1)return typeof d.is=="string";switch(l){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ur=null;function mr(l){return l=l.target||l.srcElement||window,l.correspondingUseElement&&(l=l.correspondingUseElement),l.nodeType===3?l.parentNode:l}var Hr=null,yr=null,Do=null;function Rl(l){if(l=Mu(l)){if(typeof Hr!="function")throw Error(t(280));var d=l.stateNode;d&&(d=Nh(d),Hr(l.stateNode,l.type,d))}}function Ai(l){yr?Do?Do.push(l):Do=[l]:yr=l}function Ol(){if(yr){var l=yr,d=Do;if(Do=yr=null,Rl(l),d)for(l=0;l<d.length;l++)Rl(d[l])}}function Dl(l,d){return l(d)}function Ll(){}var Gs=!1;function Sh(l,d,m){if(Gs)return l(d,m);Gs=!0;try{return Dl(l,d,m)}finally{Gs=!1,(yr!==null||Do!==null)&&(Ll(),Ol())}}function Da(l,d){var m=l.stateNode;if(m===null)return null;var x=Nh(m);if(x===null)return null;m=x[d];e:switch(d){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(x=!x.disabled)||(l=l.type,x=!(l==="button"||l==="input"||l==="select"||l==="textarea")),l=!x;break e;default:l=!1}if(l)return null;if(m&&typeof m!="function")throw Error(t(231,d,typeof m));return m}var du=!1;if(a)try{var La={};Object.defineProperty(La,"passive",{get:function(){du=!0}}),window.addEventListener("test",La,La),window.removeEventListener("test",La,La)}catch{du=!1}function Hm(l,d,m,x,I,k,O,z,W){var se=Array.prototype.slice.call(arguments,3);try{d.apply(m,se)}catch(ge){this.onError(ge)}}var ji=!1,Ri=null,po=!1,hu=null,Km={onError:function(l){ji=!0,Ri=l}};function Wm(l,d,m,x,I,k,O,z,W){ji=!1,Ri=null,Hm.apply(Km,arguments)}function Vm(l,d,m,x,I,k,O,z,W){if(Wm.apply(this,arguments),ji){if(ji){var se=Ri;ji=!1,Ri=null}else throw Error(t(198));po||(po=!0,hu=se)}}function qs(l){var d=l,m=l;if(l.alternate)for(;d.return;)d=d.return;else{l=d;do d=l,d.flags&4098&&(m=d.return),l=d.return;while(l)}return d.tag===3?m:null}function fo(l){if(l.tag===13){var d=l.memoizedState;if(d===null&&(l=l.alternate,l!==null&&(d=l.memoizedState)),d!==null)return d.dehydrated}return null}function xh(l){if(qs(l)!==l)throw Error(t(188))}function Gm(l){var d=l.alternate;if(!d){if(d=qs(l),d===null)throw Error(t(188));return d!==l?null:l}for(var m=l,x=d;;){var I=m.return;if(I===null)break;var k=I.alternate;if(k===null){if(x=I.return,x!==null){m=x;continue}break}if(I.child===k.child){for(k=I.child;k;){if(k===m)return xh(I),l;if(k===x)return xh(I),d;k=k.sibling}throw Error(t(188))}if(m.return!==x.return)m=I,x=k;else{for(var O=!1,z=I.child;z;){if(z===m){O=!0,m=I,x=k;break}if(z===x){O=!0,x=I,m=k;break}z=z.sibling}if(!O){for(z=k.child;z;){if(z===m){O=!0,m=k,x=I;break}if(z===x){O=!0,x=k,m=I;break}z=z.sibling}if(!O)throw Error(t(189))}}if(m.alternate!==x)throw Error(t(190))}if(m.tag!==3)throw Error(t(188));return m.stateNode.current===m?l:d}function wh(l){return l=Gm(l),l!==null?bh(l):null}function bh(l){if(l.tag===5||l.tag===6)return l;for(l=l.child;l!==null;){var d=bh(l);if(d!==null)return d;l=l.sibling}return null}var _h=e.unstable_scheduleCallback,us=e.unstable_cancelCallback,qm=e.unstable_shouldYield,Ym=e.unstable_requestPaint,Wt=e.unstable_now,Xm=e.unstable_getCurrentPriorityLevel,pu=e.unstable_ImmediatePriority,Fa=e.unstable_UserBlockingPriority,Fl=e.unstable_NormalPriority,Zm=e.unstable_LowPriority,Lo=e.unstable_IdlePriority,Nl=null,go=null;function Qm(l){if(go&&typeof go.onCommitFiberRoot=="function")try{go.onCommitFiberRoot(Nl,l,void 0,(l.current.flags&128)===128)}catch{}}var Kr=Math.clz32?Math.clz32:$l,Jm=Math.log,ey=Math.LN2;function $l(l){return l>>>=0,l===0?32:31-(Jm(l)/ey|0)|0}var zl=64,ds=4194304;function Oi(l){switch(l&-l){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return l&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return l&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return l}}function Na(l,d){var m=l.pendingLanes;if(m===0)return 0;var x=0,I=l.suspendedLanes,k=l.pingedLanes,O=m&268435455;if(O!==0){var z=O&~I;z!==0?x=Oi(z):(k&=O,k!==0&&(x=Oi(k)))}else O=m&~I,O!==0?x=Oi(O):k!==0&&(x=Oi(k));if(x===0)return 0;if(d!==0&&d!==x&&!(d&I)&&(I=x&-x,k=d&-d,I>=k||I===16&&(k&4194240)!==0))return d;if(x&4&&(x|=m&16),d=l.entangledLanes,d!==0)for(l=l.entanglements,d&=x;0<d;)m=31-Kr(d),I=1<<m,x|=l[m],d&=~I;return x}function ty(l,d){switch(l){case 1:case 2:case 4:return d+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return d+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ny(l,d){for(var m=l.suspendedLanes,x=l.pingedLanes,I=l.expirationTimes,k=l.pendingLanes;0<k;){var O=31-Kr(k),z=1<<O,W=I[O];W===-1?(!(z&m)||z&x)&&(I[O]=ty(z,d)):W<=d&&(l.expiredLanes|=z),k&=~z}}function fu(l){return l=l.pendingLanes&-1073741825,l!==0?l:l&1073741824?1073741824:0}function Ph(){var l=zl;return zl<<=1,!(zl&4194240)&&(zl=64),l}function Bl(l){for(var d=[],m=0;31>m;m++)d.push(l);return d}function $a(l,d,m){l.pendingLanes|=d,d!==536870912&&(l.suspendedLanes=0,l.pingedLanes=0),l=l.eventTimes,d=31-Kr(d),l[d]=m}function ry(l,d){var m=l.pendingLanes&~d;l.pendingLanes=d,l.suspendedLanes=0,l.pingedLanes=0,l.expiredLanes&=d,l.mutableReadLanes&=d,l.entangledLanes&=d,d=l.entanglements;var x=l.eventTimes;for(l=l.expirationTimes;0<m;){var I=31-Kr(m),k=1<<I;d[I]=0,x[I]=-1,l[I]=-1,m&=~k}}function Ul(l,d){var m=l.entangledLanes|=d;for(l=l.entanglements;m;){var x=31-Kr(m),I=1<<x;I&d|l[x]&d&&(l[x]|=d),m&=~I}}var ut=0;function Ys(l){return l&=-l,1<l?4<l?l&268435455?16:536870912:4:1}var Ch,gu,Fo,Ih,Eh,mu=!1,Hl=[],hs=null,Fn=null,No=null,za=new Map,ps=new Map,fs=[],yu="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function kh(l,d){switch(l){case"focusin":case"focusout":hs=null;break;case"dragenter":case"dragleave":Fn=null;break;case"mouseover":case"mouseout":No=null;break;case"pointerover":case"pointerout":za.delete(d.pointerId);break;case"gotpointercapture":case"lostpointercapture":ps.delete(d.pointerId)}}function Di(l,d,m,x,I,k){return l===null||l.nativeEvent!==k?(l={blockedOn:d,domEventName:m,eventSystemFlags:x,nativeEvent:k,targetContainers:[I]},d!==null&&(d=Mu(d),d!==null&&gu(d)),l):(l.eventSystemFlags|=x,d=l.targetContainers,I!==null&&d.indexOf(I)===-1&&d.push(I),l)}function Th(l,d,m,x,I){switch(d){case"focusin":return hs=Di(hs,l,d,m,x,I),!0;case"dragenter":return Fn=Di(Fn,l,d,m,x,I),!0;case"mouseover":return No=Di(No,l,d,m,x,I),!0;case"pointerover":var k=I.pointerId;return za.set(k,Di(za.get(k)||null,l,d,m,x,I)),!0;case"gotpointercapture":return k=I.pointerId,ps.set(k,Di(ps.get(k)||null,l,d,m,x,I)),!0}return!1}function vu(l){var d=Ha(l.target);if(d!==null){var m=qs(d);if(m!==null){if(d=m.tag,d===13){if(d=fo(m),d!==null){l.blockedOn=d,Eh(l.priority,function(){Fo(m)});return}}else if(d===3&&m.stateNode.current.memoizedState.isDehydrated){l.blockedOn=m.tag===3?m.stateNode.containerInfo:null;return}}}l.blockedOn=null}function gs(l){if(l.blockedOn!==null)return!1;for(var d=l.targetContainers;0<d.length;){var m=Mt(l.domEventName,l.eventSystemFlags,d[0],l.nativeEvent);if(m===null){m=l.nativeEvent;var x=new m.constructor(m.type,m);Ur=x,m.target.dispatchEvent(x),Ur=null}else return d=Mu(m),d!==null&&gu(d),l.blockedOn=m,!1;d.shift()}return!0}function Su(l,d,m){gs(l)&&m.delete(d)}function oy(){mu=!1,hs!==null&&gs(hs)&&(hs=null),Fn!==null&&gs(Fn)&&(Fn=null),No!==null&&gs(No)&&(No=null),za.forEach(Su),ps.forEach(Su)}function Ba(l,d){l.blockedOn===d&&(l.blockedOn=null,mu||(mu=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,oy)))}function Ua(l){function d(I){return Ba(I,l)}if(0<Hl.length){Ba(Hl[0],l);for(var m=1;m<Hl.length;m++){var x=Hl[m];x.blockedOn===l&&(x.blockedOn=null)}}for(hs!==null&&Ba(hs,l),Fn!==null&&Ba(Fn,l),No!==null&&Ba(No,l),za.forEach(d),ps.forEach(d),m=0;m<fs.length;m++)x=fs[m],x.blockedOn===l&&(x.blockedOn=null);for(;0<fs.length&&(m=fs[0],m.blockedOn===null);)vu(m),m.blockedOn===null&&fs.shift()}var N=E.ReactCurrentBatchConfig,X=!0;function de(l,d,m,x){var I=ut,k=N.transition;N.transition=null;try{ut=1,wt(l,d,m,x)}finally{ut=I,N.transition=k}}function ke(l,d,m,x){var I=ut,k=N.transition;N.transition=null;try{ut=4,wt(l,d,m,x)}finally{ut=I,N.transition=k}}function wt(l,d,m,x){if(X){var I=Mt(l,d,m,x);if(I===null)vy(l,d,x,Ye,m),kh(l,x);else if(Th(I,l,d,m,x))x.stopPropagation();else if(kh(l,x),d&4&&-1<yu.indexOf(l)){for(;I!==null;){var k=Mu(I);if(k!==null&&Ch(k),k=Mt(l,d,m,x),k===null&&vy(l,d,x,Ye,m),k===I)break;I=k}I!==null&&x.stopPropagation()}else vy(l,d,x,null,m)}}var Ye=null;function Mt(l,d,m,x){if(Ye=null,l=mr(x),l=Ha(l),l!==null)if(d=qs(l),d===null)l=null;else if(m=d.tag,m===13){if(l=fo(d),l!==null)return l;l=null}else if(m===3){if(d.stateNode.current.memoizedState.isDehydrated)return d.tag===3?d.stateNode.containerInfo:null;l=null}else d!==l&&(l=null);return Ye=l,null}function tn(l){switch(l){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Xm()){case pu:return 1;case Fa:return 4;case Fl:case Zm:return 16;case Lo:return 536870912;default:return 16}default:return 16}}var At=null,Et=null,gn=null;function vr(){if(gn)return gn;var l,d=Et,m=d.length,x,I="value"in At?At.value:At.textContent,k=I.length;for(l=0;l<m&&d[l]===I[l];l++);var O=m-l;for(x=1;x<=O&&d[m-x]===I[k-x];x++);return gn=I.slice(l,1<x?1-x:void 0)}function nn(l){var d=l.keyCode;return"charCode"in l?(l=l.charCode,l===0&&d===13&&(l=13)):l=d,l===10&&(l=13),32<=l||l===13?l:0}function bn(){return!0}function nr(){return!1}function Qt(l){function d(m,x,I,k,O){this._reactName=m,this._targetInst=I,this.type=x,this.nativeEvent=k,this.target=O,this.currentTarget=null;for(var z in l)l.hasOwnProperty(z)&&(m=l[z],this[z]=m?m(k):k[z]);return this.isDefaultPrevented=(k.defaultPrevented!=null?k.defaultPrevented:k.returnValue===!1)?bn:nr,this.isPropagationStopped=nr,this}return ae(d.prototype,{preventDefault:function(){this.defaultPrevented=!0;var m=this.nativeEvent;m&&(m.preventDefault?m.preventDefault():typeof m.returnValue!="unknown"&&(m.returnValue=!1),this.isDefaultPrevented=bn)},stopPropagation:function(){var m=this.nativeEvent;m&&(m.stopPropagation?m.stopPropagation():typeof m.cancelBubble!="unknown"&&(m.cancelBubble=!0),this.isPropagationStopped=bn)},persist:function(){},isPersistent:bn}),d}var Nn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(l){return l.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},$o=Qt(Nn),Li=ae({},Nn,{view:0,detail:0}),Kl=Qt(Li),Fi,sy,xu,Mh=ae({},Li,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ay,button:0,buttons:0,relatedTarget:function(l){return l.relatedTarget===void 0?l.fromElement===l.srcElement?l.toElement:l.fromElement:l.relatedTarget},movementX:function(l){return"movementX"in l?l.movementX:(l!==xu&&(xu&&l.type==="mousemove"?(Fi=l.screenX-xu.screenX,sy=l.screenY-xu.screenY):sy=Fi=0,xu=l),Fi)},movementY:function(l){return"movementY"in l?l.movementY:sy}}),H_=Qt(Mh),b$=ae({},Mh,{dataTransfer:0}),_$=Qt(b$),P$=ae({},Li,{relatedTarget:0}),iy=Qt(P$),C$=ae({},Nn,{animationName:0,elapsedTime:0,pseudoElement:0}),I$=Qt(C$),E$=ae({},Nn,{clipboardData:function(l){return"clipboardData"in l?l.clipboardData:window.clipboardData}}),k$=Qt(E$),T$=ae({},Nn,{data:0}),K_=Qt(T$),M$={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},A$={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},j$={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function R$(l){var d=this.nativeEvent;return d.getModifierState?d.getModifierState(l):(l=j$[l])?!!d[l]:!1}function ay(){return R$}var O$=ae({},Li,{key:function(l){if(l.key){var d=M$[l.key]||l.key;if(d!=="Unidentified")return d}return l.type==="keypress"?(l=nn(l),l===13?"Enter":String.fromCharCode(l)):l.type==="keydown"||l.type==="keyup"?A$[l.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ay,charCode:function(l){return l.type==="keypress"?nn(l):0},keyCode:function(l){return l.type==="keydown"||l.type==="keyup"?l.keyCode:0},which:function(l){return l.type==="keypress"?nn(l):l.type==="keydown"||l.type==="keyup"?l.keyCode:0}}),D$=Qt(O$),L$=ae({},Mh,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),W_=Qt(L$),F$=ae({},Li,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ay}),N$=Qt(F$),$$=ae({},Nn,{propertyName:0,elapsedTime:0,pseudoElement:0}),z$=Qt($$),B$=ae({},Mh,{deltaX:function(l){return"deltaX"in l?l.deltaX:"wheelDeltaX"in l?-l.wheelDeltaX:0},deltaY:function(l){return"deltaY"in l?l.deltaY:"wheelDeltaY"in l?-l.wheelDeltaY:"wheelDelta"in l?-l.wheelDelta:0},deltaZ:0,deltaMode:0}),U$=Qt(B$),H$=[9,13,27,32],ly=a&&"CompositionEvent"in window,wu=null;a&&"documentMode"in document&&(wu=document.documentMode);var K$=a&&"TextEvent"in window&&!wu,V_=a&&(!ly||wu&&8<wu&&11>=wu),G_=" ",q_=!1;function Y_(l,d){switch(l){case"keyup":return H$.indexOf(d.keyCode)!==-1;case"keydown":return d.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function X_(l){return l=l.detail,typeof l=="object"&&"data"in l?l.data:null}var Wl=!1;function W$(l,d){switch(l){case"compositionend":return X_(d);case"keypress":return d.which!==32?null:(q_=!0,G_);case"textInput":return l=d.data,l===G_&&q_?null:l;default:return null}}function V$(l,d){if(Wl)return l==="compositionend"||!ly&&Y_(l,d)?(l=vr(),gn=Et=At=null,Wl=!1,l):null;switch(l){case"paste":return null;case"keypress":if(!(d.ctrlKey||d.altKey||d.metaKey)||d.ctrlKey&&d.altKey){if(d.char&&1<d.char.length)return d.char;if(d.which)return String.fromCharCode(d.which)}return null;case"compositionend":return V_&&d.locale!=="ko"?null:d.data;default:return null}}var G$={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Z_(l){var d=l&&l.nodeName&&l.nodeName.toLowerCase();return d==="input"?!!G$[l.type]:d==="textarea"}function Q_(l,d,m,x){Ai(x),d=Dh(d,"onChange"),0<d.length&&(m=new $o("onChange","change",null,m,x),l.push({event:m,listeners:d}))}var bu=null,_u=null;function q$(l){mP(l,0)}function Ah(l){var d=Xl(l);if(Zt(d))return l}function Y$(l,d){if(l==="change")return d}var J_=!1;if(a){var cy;if(a){var uy="oninput"in document;if(!uy){var eP=document.createElement("div");eP.setAttribute("oninput","return;"),uy=typeof eP.oninput=="function"}cy=uy}else cy=!1;J_=cy&&(!document.documentMode||9<document.documentMode)}function tP(){bu&&(bu.detachEvent("onpropertychange",nP),_u=bu=null)}function nP(l){if(l.propertyName==="value"&&Ah(_u)){var d=[];Q_(d,_u,l,mr(l)),Sh(q$,d)}}function X$(l,d,m){l==="focusin"?(tP(),bu=d,_u=m,bu.attachEvent("onpropertychange",nP)):l==="focusout"&&tP()}function Z$(l){if(l==="selectionchange"||l==="keyup"||l==="keydown")return Ah(_u)}function Q$(l,d){if(l==="click")return Ah(d)}function J$(l,d){if(l==="input"||l==="change")return Ah(d)}function e6(l,d){return l===d&&(l!==0||1/l===1/d)||l!==l&&d!==d}var zo=typeof Object.is=="function"?Object.is:e6;function Pu(l,d){if(zo(l,d))return!0;if(typeof l!="object"||l===null||typeof d!="object"||d===null)return!1;var m=Object.keys(l),x=Object.keys(d);if(m.length!==x.length)return!1;for(x=0;x<m.length;x++){var I=m[x];if(!c.call(d,I)||!zo(l[I],d[I]))return!1}return!0}function rP(l){for(;l&&l.firstChild;)l=l.firstChild;return l}function oP(l,d){var m=rP(l);l=0;for(var x;m;){if(m.nodeType===3){if(x=l+m.textContent.length,l<=d&&x>=d)return{node:m,offset:d-l};l=x}e:{for(;m;){if(m.nextSibling){m=m.nextSibling;break e}m=m.parentNode}m=void 0}m=rP(m)}}function sP(l,d){return l&&d?l===d?!0:l&&l.nodeType===3?!1:d&&d.nodeType===3?sP(l,d.parentNode):"contains"in l?l.contains(d):l.compareDocumentPosition?!!(l.compareDocumentPosition(d)&16):!1:!1}function iP(){for(var l=window,d=vt();d instanceof l.HTMLIFrameElement;){try{var m=typeof d.contentWindow.location.href=="string"}catch{m=!1}if(m)l=d.contentWindow;else break;d=vt(l.document)}return d}function dy(l){var d=l&&l.nodeName&&l.nodeName.toLowerCase();return d&&(d==="input"&&(l.type==="text"||l.type==="search"||l.type==="tel"||l.type==="url"||l.type==="password")||d==="textarea"||l.contentEditable==="true")}function t6(l){var d=iP(),m=l.focusedElem,x=l.selectionRange;if(d!==m&&m&&m.ownerDocument&&sP(m.ownerDocument.documentElement,m)){if(x!==null&&dy(m)){if(d=x.start,l=x.end,l===void 0&&(l=d),"selectionStart"in m)m.selectionStart=d,m.selectionEnd=Math.min(l,m.value.length);else if(l=(d=m.ownerDocument||document)&&d.defaultView||window,l.getSelection){l=l.getSelection();var I=m.textContent.length,k=Math.min(x.start,I);x=x.end===void 0?k:Math.min(x.end,I),!l.extend&&k>x&&(I=x,x=k,k=I),I=oP(m,k);var O=oP(m,x);I&&O&&(l.rangeCount!==1||l.anchorNode!==I.node||l.anchorOffset!==I.offset||l.focusNode!==O.node||l.focusOffset!==O.offset)&&(d=d.createRange(),d.setStart(I.node,I.offset),l.removeAllRanges(),k>x?(l.addRange(d),l.extend(O.node,O.offset)):(d.setEnd(O.node,O.offset),l.addRange(d)))}}for(d=[],l=m;l=l.parentNode;)l.nodeType===1&&d.push({element:l,left:l.scrollLeft,top:l.scrollTop});for(typeof m.focus=="function"&&m.focus(),m=0;m<d.length;m++)l=d[m],l.element.scrollLeft=l.left,l.element.scrollTop=l.top}}var n6=a&&"documentMode"in document&&11>=document.documentMode,Vl=null,hy=null,Cu=null,py=!1;function aP(l,d,m){var x=m.window===m?m.document:m.nodeType===9?m:m.ownerDocument;py||Vl==null||Vl!==vt(x)||(x=Vl,"selectionStart"in x&&dy(x)?x={start:x.selectionStart,end:x.selectionEnd}:(x=(x.ownerDocument&&x.ownerDocument.defaultView||window).getSelection(),x={anchorNode:x.anchorNode,anchorOffset:x.anchorOffset,focusNode:x.focusNode,focusOffset:x.focusOffset}),Cu&&Pu(Cu,x)||(Cu=x,x=Dh(hy,"onSelect"),0<x.length&&(d=new $o("onSelect","select",null,d,m),l.push({event:d,listeners:x}),d.target=Vl)))}function jh(l,d){var m={};return m[l.toLowerCase()]=d.toLowerCase(),m["Webkit"+l]="webkit"+d,m["Moz"+l]="moz"+d,m}var Gl={animationend:jh("Animation","AnimationEnd"),animationiteration:jh("Animation","AnimationIteration"),animationstart:jh("Animation","AnimationStart"),transitionend:jh("Transition","TransitionEnd")},fy={},lP={};a&&(lP=document.createElement("div").style,"AnimationEvent"in window||(delete Gl.animationend.animation,delete Gl.animationiteration.animation,delete Gl.animationstart.animation),"TransitionEvent"in window||delete Gl.transitionend.transition);function Rh(l){if(fy[l])return fy[l];if(!Gl[l])return l;var d=Gl[l],m;for(m in d)if(d.hasOwnProperty(m)&&m in lP)return fy[l]=d[m];return l}var cP=Rh("animationend"),uP=Rh("animationiteration"),dP=Rh("animationstart"),hP=Rh("transitionend"),pP=new Map,fP="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Ni(l,d){pP.set(l,d),s(d,[l])}for(var gy=0;gy<fP.length;gy++){var my=fP[gy],r6=my.toLowerCase(),o6=my[0].toUpperCase()+my.slice(1);Ni(r6,"on"+o6)}Ni(cP,"onAnimationEnd"),Ni(uP,"onAnimationIteration"),Ni(dP,"onAnimationStart"),Ni("dblclick","onDoubleClick"),Ni("focusin","onFocus"),Ni("focusout","onBlur"),Ni(hP,"onTransitionEnd"),i("onMouseEnter",["mouseout","mouseover"]),i("onMouseLeave",["mouseout","mouseover"]),i("onPointerEnter",["pointerout","pointerover"]),i("onPointerLeave",["pointerout","pointerover"]),s("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),s("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),s("onBeforeInput",["compositionend","keypress","textInput","paste"]),s("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),s("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Iu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),s6=new Set("cancel close invalid load scroll toggle".split(" ").concat(Iu));function gP(l,d,m){var x=l.type||"unknown-event";l.currentTarget=m,Vm(x,d,void 0,l),l.currentTarget=null}function mP(l,d){d=(d&4)!==0;for(var m=0;m<l.length;m++){var x=l[m],I=x.event;x=x.listeners;e:{var k=void 0;if(d)for(var O=x.length-1;0<=O;O--){var z=x[O],W=z.instance,se=z.currentTarget;if(z=z.listener,W!==k&&I.isPropagationStopped())break e;gP(I,z,se),k=W}else for(O=0;O<x.length;O++){if(z=x[O],W=z.instance,se=z.currentTarget,z=z.listener,W!==k&&I.isPropagationStopped())break e;gP(I,z,se),k=W}}}if(po)throw l=hu,po=!1,hu=null,l}function Ft(l,d){var m=d[Py];m===void 0&&(m=d[Py]=new Set);var x=l+"__bubble";m.has(x)||(yP(d,l,2,!1),m.add(x))}function yy(l,d,m){var x=0;d&&(x|=4),yP(m,l,x,d)}var Oh="_reactListening"+Math.random().toString(36).slice(2);function Eu(l){if(!l[Oh]){l[Oh]=!0,r.forEach(function(m){m!=="selectionchange"&&(s6.has(m)||yy(m,!1,l),yy(m,!0,l))});var d=l.nodeType===9?l:l.ownerDocument;d===null||d[Oh]||(d[Oh]=!0,yy("selectionchange",!1,d))}}function yP(l,d,m,x){switch(tn(d)){case 1:var I=de;break;case 4:I=ke;break;default:I=wt}m=I.bind(null,d,m,l),I=void 0,!du||d!=="touchstart"&&d!=="touchmove"&&d!=="wheel"||(I=!0),x?I!==void 0?l.addEventListener(d,m,{capture:!0,passive:I}):l.addEventListener(d,m,!0):I!==void 0?l.addEventListener(d,m,{passive:I}):l.addEventListener(d,m,!1)}function vy(l,d,m,x,I){var k=x;if(!(d&1)&&!(d&2)&&x!==null)e:for(;;){if(x===null)return;var O=x.tag;if(O===3||O===4){var z=x.stateNode.containerInfo;if(z===I||z.nodeType===8&&z.parentNode===I)break;if(O===4)for(O=x.return;O!==null;){var W=O.tag;if((W===3||W===4)&&(W=O.stateNode.containerInfo,W===I||W.nodeType===8&&W.parentNode===I))return;O=O.return}for(;z!==null;){if(O=Ha(z),O===null)return;if(W=O.tag,W===5||W===6){x=k=O;continue e}z=z.parentNode}}x=x.return}Sh(function(){var se=k,ge=mr(m),me=[];e:{var fe=pP.get(l);if(fe!==void 0){var Ee=$o,je=l;switch(l){case"keypress":if(nn(m)===0)break e;case"keydown":case"keyup":Ee=D$;break;case"focusin":je="focus",Ee=iy;break;case"focusout":je="blur",Ee=iy;break;case"beforeblur":case"afterblur":Ee=iy;break;case"click":if(m.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ee=H_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ee=_$;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ee=N$;break;case cP:case uP:case dP:Ee=I$;break;case hP:Ee=z$;break;case"scroll":Ee=Kl;break;case"wheel":Ee=U$;break;case"copy":case"cut":case"paste":Ee=k$;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ee=W_}var De=(d&4)!==0,rn=!De&&l==="scroll",J=De?fe!==null?fe+"Capture":null:fe;De=[];for(var Y=se,ne;Y!==null;){ne=Y;var ve=ne.stateNode;if(ne.tag===5&&ve!==null&&(ne=ve,J!==null&&(ve=Da(Y,J),ve!=null&&De.push(ku(Y,ve,ne)))),rn)break;Y=Y.return}0<De.length&&(fe=new Ee(fe,je,null,m,ge),me.push({event:fe,listeners:De}))}}if(!(d&7)){e:{if(fe=l==="mouseover"||l==="pointerover",Ee=l==="mouseout"||l==="pointerout",fe&&m!==Ur&&(je=m.relatedTarget||m.fromElement)&&(Ha(je)||je[Xs]))break e;if((Ee||fe)&&(fe=ge.window===ge?ge:(fe=ge.ownerDocument)?fe.defaultView||fe.parentWindow:window,Ee?(je=m.relatedTarget||m.toElement,Ee=se,je=je?Ha(je):null,je!==null&&(rn=qs(je),je!==rn||je.tag!==5&&je.tag!==6)&&(je=null)):(Ee=null,je=se),Ee!==je)){if(De=H_,ve="onMouseLeave",J="onMouseEnter",Y="mouse",(l==="pointerout"||l==="pointerover")&&(De=W_,ve="onPointerLeave",J="onPointerEnter",Y="pointer"),rn=Ee==null?fe:Xl(Ee),ne=je==null?fe:Xl(je),fe=new De(ve,Y+"leave",Ee,m,ge),fe.target=rn,fe.relatedTarget=ne,ve=null,Ha(ge)===se&&(De=new De(J,Y+"enter",je,m,ge),De.target=ne,De.relatedTarget=rn,ve=De),rn=ve,Ee&&je)t:{for(De=Ee,J=je,Y=0,ne=De;ne;ne=ql(ne))Y++;for(ne=0,ve=J;ve;ve=ql(ve))ne++;for(;0<Y-ne;)De=ql(De),Y--;for(;0<ne-Y;)J=ql(J),ne--;for(;Y--;){if(De===J||J!==null&&De===J.alternate)break t;De=ql(De),J=ql(J)}De=null}else De=null;Ee!==null&&vP(me,fe,Ee,De,!1),je!==null&&rn!==null&&vP(me,rn,je,De,!0)}}e:{if(fe=se?Xl(se):window,Ee=fe.nodeName&&fe.nodeName.toLowerCase(),Ee==="select"||Ee==="input"&&fe.type==="file")var Le=Y$;else if(Z_(fe))if(J_)Le=J$;else{Le=Z$;var Be=X$}else(Ee=fe.nodeName)&&Ee.toLowerCase()==="input"&&(fe.type==="checkbox"||fe.type==="radio")&&(Le=Q$);if(Le&&(Le=Le(l,se))){Q_(me,Le,m,ge);break e}Be&&Be(l,fe,se),l==="focusout"&&(Be=fe._wrapperState)&&Be.controlled&&fe.type==="number"&&fr(fe,"number",fe.value)}switch(Be=se?Xl(se):window,l){case"focusin":(Z_(Be)||Be.contentEditable==="true")&&(Vl=Be,hy=se,Cu=null);break;case"focusout":Cu=hy=Vl=null;break;case"mousedown":py=!0;break;case"contextmenu":case"mouseup":case"dragend":py=!1,aP(me,m,ge);break;case"selectionchange":if(n6)break;case"keydown":case"keyup":aP(me,m,ge)}var Ue;if(ly)e:{switch(l){case"compositionstart":var qe="onCompositionStart";break e;case"compositionend":qe="onCompositionEnd";break e;case"compositionupdate":qe="onCompositionUpdate";break e}qe=void 0}else Wl?Y_(l,m)&&(qe="onCompositionEnd"):l==="keydown"&&m.keyCode===229&&(qe="onCompositionStart");qe&&(V_&&m.locale!=="ko"&&(Wl||qe!=="onCompositionStart"?qe==="onCompositionEnd"&&Wl&&(Ue=vr()):(At=ge,Et="value"in At?At.value:At.textContent,Wl=!0)),Be=Dh(se,qe),0<Be.length&&(qe=new K_(qe,l,null,m,ge),me.push({event:qe,listeners:Be}),Ue?qe.data=Ue:(Ue=X_(m),Ue!==null&&(qe.data=Ue)))),(Ue=K$?W$(l,m):V$(l,m))&&(se=Dh(se,"onBeforeInput"),0<se.length&&(ge=new K_("onBeforeInput","beforeinput",null,m,ge),me.push({event:ge,listeners:se}),ge.data=Ue))}mP(me,d)})}function ku(l,d,m){return{instance:l,listener:d,currentTarget:m}}function Dh(l,d){for(var m=d+"Capture",x=[];l!==null;){var I=l,k=I.stateNode;I.tag===5&&k!==null&&(I=k,k=Da(l,m),k!=null&&x.unshift(ku(l,k,I)),k=Da(l,d),k!=null&&x.push(ku(l,k,I))),l=l.return}return x}function ql(l){if(l===null)return null;do l=l.return;while(l&&l.tag!==5);return l||null}function vP(l,d,m,x,I){for(var k=d._reactName,O=[];m!==null&&m!==x;){var z=m,W=z.alternate,se=z.stateNode;if(W!==null&&W===x)break;z.tag===5&&se!==null&&(z=se,I?(W=Da(m,k),W!=null&&O.unshift(ku(m,W,z))):I||(W=Da(m,k),W!=null&&O.push(ku(m,W,z)))),m=m.return}O.length!==0&&l.push({event:d,listeners:O})}var i6=/\r\n?/g,a6=/\u0000|\uFFFD/g;function SP(l){return(typeof l=="string"?l:""+l).replace(i6,`
`).replace(a6,"")}function Lh(l,d,m){if(d=SP(d),SP(l)!==d&&m)throw Error(t(425))}function Fh(){}var Sy=null,xy=null;function wy(l,d){return l==="textarea"||l==="noscript"||typeof d.children=="string"||typeof d.children=="number"||typeof d.dangerouslySetInnerHTML=="object"&&d.dangerouslySetInnerHTML!==null&&d.dangerouslySetInnerHTML.__html!=null}var by=typeof setTimeout=="function"?setTimeout:void 0,l6=typeof clearTimeout=="function"?clearTimeout:void 0,xP=typeof Promise=="function"?Promise:void 0,c6=typeof queueMicrotask=="function"?queueMicrotask:typeof xP<"u"?function(l){return xP.resolve(null).then(l).catch(u6)}:by;function u6(l){setTimeout(function(){throw l})}function _y(l,d){var m=d,x=0;do{var I=m.nextSibling;if(l.removeChild(m),I&&I.nodeType===8)if(m=I.data,m==="/$"){if(x===0){l.removeChild(I),Ua(d);return}x--}else m!=="$"&&m!=="$?"&&m!=="$!"||x++;m=I}while(m);Ua(d)}function $i(l){for(;l!=null;l=l.nextSibling){var d=l.nodeType;if(d===1||d===3)break;if(d===8){if(d=l.data,d==="$"||d==="$!"||d==="$?")break;if(d==="/$")return null}}return l}function wP(l){l=l.previousSibling;for(var d=0;l;){if(l.nodeType===8){var m=l.data;if(m==="$"||m==="$!"||m==="$?"){if(d===0)return l;d--}else m==="/$"&&d++}l=l.previousSibling}return null}var Yl=Math.random().toString(36).slice(2),ms="__reactFiber$"+Yl,Tu="__reactProps$"+Yl,Xs="__reactContainer$"+Yl,Py="__reactEvents$"+Yl,d6="__reactListeners$"+Yl,h6="__reactHandles$"+Yl;function Ha(l){var d=l[ms];if(d)return d;for(var m=l.parentNode;m;){if(d=m[Xs]||m[ms]){if(m=d.alternate,d.child!==null||m!==null&&m.child!==null)for(l=wP(l);l!==null;){if(m=l[ms])return m;l=wP(l)}return d}l=m,m=l.parentNode}return null}function Mu(l){return l=l[ms]||l[Xs],!l||l.tag!==5&&l.tag!==6&&l.tag!==13&&l.tag!==3?null:l}function Xl(l){if(l.tag===5||l.tag===6)return l.stateNode;throw Error(t(33))}function Nh(l){return l[Tu]||null}var Cy=[],Zl=-1;function zi(l){return{current:l}}function Nt(l){0>Zl||(l.current=Cy[Zl],Cy[Zl]=null,Zl--)}function jt(l,d){Zl++,Cy[Zl]=l.current,l.current=d}var Bi={},$n=zi(Bi),Sr=zi(!1),Ka=Bi;function Ql(l,d){var m=l.type.contextTypes;if(!m)return Bi;var x=l.stateNode;if(x&&x.__reactInternalMemoizedUnmaskedChildContext===d)return x.__reactInternalMemoizedMaskedChildContext;var I={},k;for(k in m)I[k]=d[k];return x&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=d,l.__reactInternalMemoizedMaskedChildContext=I),I}function xr(l){return l=l.childContextTypes,l!=null}function $h(){Nt(Sr),Nt($n)}function bP(l,d,m){if($n.current!==Bi)throw Error(t(168));jt($n,d),jt(Sr,m)}function _P(l,d,m){var x=l.stateNode;if(d=d.childContextTypes,typeof x.getChildContext!="function")return m;x=x.getChildContext();for(var I in x)if(!(I in d))throw Error(t(108,Te(l)||"Unknown",I));return ae({},m,x)}function zh(l){return l=(l=l.stateNode)&&l.__reactInternalMemoizedMergedChildContext||Bi,Ka=$n.current,jt($n,l),jt(Sr,Sr.current),!0}function PP(l,d,m){var x=l.stateNode;if(!x)throw Error(t(169));m?(l=_P(l,d,Ka),x.__reactInternalMemoizedMergedChildContext=l,Nt(Sr),Nt($n),jt($n,l)):Nt(Sr),jt(Sr,m)}var Zs=null,Bh=!1,Iy=!1;function CP(l){Zs===null?Zs=[l]:Zs.push(l)}function p6(l){Bh=!0,CP(l)}function Ui(){if(!Iy&&Zs!==null){Iy=!0;var l=0,d=ut;try{var m=Zs;for(ut=1;l<m.length;l++){var x=m[l];do x=x(!0);while(x!==null)}Zs=null,Bh=!1}catch(I){throw Zs!==null&&(Zs=Zs.slice(l+1)),_h(pu,Ui),I}finally{ut=d,Iy=!1}}return null}var Jl=[],ec=0,Uh=null,Hh=0,mo=[],yo=0,Wa=null,Qs=1,Js="";function Va(l,d){Jl[ec++]=Hh,Jl[ec++]=Uh,Uh=l,Hh=d}function IP(l,d,m){mo[yo++]=Qs,mo[yo++]=Js,mo[yo++]=Wa,Wa=l;var x=Qs;l=Js;var I=32-Kr(x)-1;x&=~(1<<I),m+=1;var k=32-Kr(d)+I;if(30<k){var O=I-I%5;k=(x&(1<<O)-1).toString(32),x>>=O,I-=O,Qs=1<<32-Kr(d)+I|m<<I|x,Js=k+l}else Qs=1<<k|m<<I|x,Js=l}function Ey(l){l.return!==null&&(Va(l,1),IP(l,1,0))}function ky(l){for(;l===Uh;)Uh=Jl[--ec],Jl[ec]=null,Hh=Jl[--ec],Jl[ec]=null;for(;l===Wa;)Wa=mo[--yo],mo[yo]=null,Js=mo[--yo],mo[yo]=null,Qs=mo[--yo],mo[yo]=null}var Wr=null,Vr=null,Ht=!1,Bo=null;function EP(l,d){var m=wo(5,null,null,0);m.elementType="DELETED",m.stateNode=d,m.return=l,d=l.deletions,d===null?(l.deletions=[m],l.flags|=16):d.push(m)}function kP(l,d){switch(l.tag){case 5:var m=l.type;return d=d.nodeType!==1||m.toLowerCase()!==d.nodeName.toLowerCase()?null:d,d!==null?(l.stateNode=d,Wr=l,Vr=$i(d.firstChild),!0):!1;case 6:return d=l.pendingProps===""||d.nodeType!==3?null:d,d!==null?(l.stateNode=d,Wr=l,Vr=null,!0):!1;case 13:return d=d.nodeType!==8?null:d,d!==null?(m=Wa!==null?{id:Qs,overflow:Js}:null,l.memoizedState={dehydrated:d,treeContext:m,retryLane:1073741824},m=wo(18,null,null,0),m.stateNode=d,m.return=l,l.child=m,Wr=l,Vr=null,!0):!1;default:return!1}}function Ty(l){return(l.mode&1)!==0&&(l.flags&128)===0}function My(l){if(Ht){var d=Vr;if(d){var m=d;if(!kP(l,d)){if(Ty(l))throw Error(t(418));d=$i(m.nextSibling);var x=Wr;d&&kP(l,d)?EP(x,m):(l.flags=l.flags&-4097|2,Ht=!1,Wr=l)}}else{if(Ty(l))throw Error(t(418));l.flags=l.flags&-4097|2,Ht=!1,Wr=l}}}function TP(l){for(l=l.return;l!==null&&l.tag!==5&&l.tag!==3&&l.tag!==13;)l=l.return;Wr=l}function Kh(l){if(l!==Wr)return!1;if(!Ht)return TP(l),Ht=!0,!1;var d;if((d=l.tag!==3)&&!(d=l.tag!==5)&&(d=l.type,d=d!=="head"&&d!=="body"&&!wy(l.type,l.memoizedProps)),d&&(d=Vr)){if(Ty(l))throw MP(),Error(t(418));for(;d;)EP(l,d),d=$i(d.nextSibling)}if(TP(l),l.tag===13){if(l=l.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(t(317));e:{for(l=l.nextSibling,d=0;l;){if(l.nodeType===8){var m=l.data;if(m==="/$"){if(d===0){Vr=$i(l.nextSibling);break e}d--}else m!=="$"&&m!=="$!"&&m!=="$?"||d++}l=l.nextSibling}Vr=null}}else Vr=Wr?$i(l.stateNode.nextSibling):null;return!0}function MP(){for(var l=Vr;l;)l=$i(l.nextSibling)}function tc(){Vr=Wr=null,Ht=!1}function Ay(l){Bo===null?Bo=[l]:Bo.push(l)}var f6=E.ReactCurrentBatchConfig;function Au(l,d,m){if(l=m.ref,l!==null&&typeof l!="function"&&typeof l!="object"){if(m._owner){if(m=m._owner,m){if(m.tag!==1)throw Error(t(309));var x=m.stateNode}if(!x)throw Error(t(147,l));var I=x,k=""+l;return d!==null&&d.ref!==null&&typeof d.ref=="function"&&d.ref._stringRef===k?d.ref:(d=function(O){var z=I.refs;O===null?delete z[k]:z[k]=O},d._stringRef=k,d)}if(typeof l!="string")throw Error(t(284));if(!m._owner)throw Error(t(290,l))}return l}function Wh(l,d){throw l=Object.prototype.toString.call(d),Error(t(31,l==="[object Object]"?"object with keys {"+Object.keys(d).join(", ")+"}":l))}function AP(l){var d=l._init;return d(l._payload)}function jP(l){function d(J,Y){if(l){var ne=J.deletions;ne===null?(J.deletions=[Y],J.flags|=16):ne.push(Y)}}function m(J,Y){if(!l)return null;for(;Y!==null;)d(J,Y),Y=Y.sibling;return null}function x(J,Y){for(J=new Map;Y!==null;)Y.key!==null?J.set(Y.key,Y):J.set(Y.index,Y),Y=Y.sibling;return J}function I(J,Y){return J=Xi(J,Y),J.index=0,J.sibling=null,J}function k(J,Y,ne){return J.index=ne,l?(ne=J.alternate,ne!==null?(ne=ne.index,ne<Y?(J.flags|=2,Y):ne):(J.flags|=2,Y)):(J.flags|=1048576,Y)}function O(J){return l&&J.alternate===null&&(J.flags|=2),J}function z(J,Y,ne,ve){return Y===null||Y.tag!==6?(Y=bv(ne,J.mode,ve),Y.return=J,Y):(Y=I(Y,ne),Y.return=J,Y)}function W(J,Y,ne,ve){var Le=ne.type;return Le===R?ge(J,Y,ne.props.children,ve,ne.key):Y!==null&&(Y.elementType===Le||typeof Le=="object"&&Le!==null&&Le.$$typeof===Z&&AP(Le)===Y.type)?(ve=I(Y,ne.props),ve.ref=Au(J,Y,ne),ve.return=J,ve):(ve=gp(ne.type,ne.key,ne.props,null,J.mode,ve),ve.ref=Au(J,Y,ne),ve.return=J,ve)}function se(J,Y,ne,ve){return Y===null||Y.tag!==4||Y.stateNode.containerInfo!==ne.containerInfo||Y.stateNode.implementation!==ne.implementation?(Y=_v(ne,J.mode,ve),Y.return=J,Y):(Y=I(Y,ne.children||[]),Y.return=J,Y)}function ge(J,Y,ne,ve,Le){return Y===null||Y.tag!==7?(Y=el(ne,J.mode,ve,Le),Y.return=J,Y):(Y=I(Y,ne),Y.return=J,Y)}function me(J,Y,ne){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Y=bv(""+Y,J.mode,ne),Y.return=J,Y;if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case M:return ne=gp(Y.type,Y.key,Y.props,null,J.mode,ne),ne.ref=Au(J,null,Y),ne.return=J,ne;case A:return Y=_v(Y,J.mode,ne),Y.return=J,Y;case Z:var ve=Y._init;return me(J,ve(Y._payload),ne)}if(co(Y)||Q(Y))return Y=el(Y,J.mode,ne,null),Y.return=J,Y;Wh(J,Y)}return null}function fe(J,Y,ne,ve){var Le=Y!==null?Y.key:null;if(typeof ne=="string"&&ne!==""||typeof ne=="number")return Le!==null?null:z(J,Y,""+ne,ve);if(typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case M:return ne.key===Le?W(J,Y,ne,ve):null;case A:return ne.key===Le?se(J,Y,ne,ve):null;case Z:return Le=ne._init,fe(J,Y,Le(ne._payload),ve)}if(co(ne)||Q(ne))return Le!==null?null:ge(J,Y,ne,ve,null);Wh(J,ne)}return null}function Ee(J,Y,ne,ve,Le){if(typeof ve=="string"&&ve!==""||typeof ve=="number")return J=J.get(ne)||null,z(Y,J,""+ve,Le);if(typeof ve=="object"&&ve!==null){switch(ve.$$typeof){case M:return J=J.get(ve.key===null?ne:ve.key)||null,W(Y,J,ve,Le);case A:return J=J.get(ve.key===null?ne:ve.key)||null,se(Y,J,ve,Le);case Z:var Be=ve._init;return Ee(J,Y,ne,Be(ve._payload),Le)}if(co(ve)||Q(ve))return J=J.get(ne)||null,ge(Y,J,ve,Le,null);Wh(Y,ve)}return null}function je(J,Y,ne,ve){for(var Le=null,Be=null,Ue=Y,qe=Y=0,vn=null;Ue!==null&&qe<ne.length;qe++){Ue.index>qe?(vn=Ue,Ue=null):vn=Ue.sibling;var gt=fe(J,Ue,ne[qe],ve);if(gt===null){Ue===null&&(Ue=vn);break}l&&Ue&&gt.alternate===null&&d(J,Ue),Y=k(gt,Y,qe),Be===null?Le=gt:Be.sibling=gt,Be=gt,Ue=vn}if(qe===ne.length)return m(J,Ue),Ht&&Va(J,qe),Le;if(Ue===null){for(;qe<ne.length;qe++)Ue=me(J,ne[qe],ve),Ue!==null&&(Y=k(Ue,Y,qe),Be===null?Le=Ue:Be.sibling=Ue,Be=Ue);return Ht&&Va(J,qe),Le}for(Ue=x(J,Ue);qe<ne.length;qe++)vn=Ee(Ue,J,qe,ne[qe],ve),vn!==null&&(l&&vn.alternate!==null&&Ue.delete(vn.key===null?qe:vn.key),Y=k(vn,Y,qe),Be===null?Le=vn:Be.sibling=vn,Be=vn);return l&&Ue.forEach(function(Zi){return d(J,Zi)}),Ht&&Va(J,qe),Le}function De(J,Y,ne,ve){var Le=Q(ne);if(typeof Le!="function")throw Error(t(150));if(ne=Le.call(ne),ne==null)throw Error(t(151));for(var Be=Le=null,Ue=Y,qe=Y=0,vn=null,gt=ne.next();Ue!==null&&!gt.done;qe++,gt=ne.next()){Ue.index>qe?(vn=Ue,Ue=null):vn=Ue.sibling;var Zi=fe(J,Ue,gt.value,ve);if(Zi===null){Ue===null&&(Ue=vn);break}l&&Ue&&Zi.alternate===null&&d(J,Ue),Y=k(Zi,Y,qe),Be===null?Le=Zi:Be.sibling=Zi,Be=Zi,Ue=vn}if(gt.done)return m(J,Ue),Ht&&Va(J,qe),Le;if(Ue===null){for(;!gt.done;qe++,gt=ne.next())gt=me(J,gt.value,ve),gt!==null&&(Y=k(gt,Y,qe),Be===null?Le=gt:Be.sibling=gt,Be=gt);return Ht&&Va(J,qe),Le}for(Ue=x(J,Ue);!gt.done;qe++,gt=ne.next())gt=Ee(Ue,J,qe,gt.value,ve),gt!==null&&(l&&gt.alternate!==null&&Ue.delete(gt.key===null?qe:gt.key),Y=k(gt,Y,qe),Be===null?Le=gt:Be.sibling=gt,Be=gt);return l&&Ue.forEach(function(G6){return d(J,G6)}),Ht&&Va(J,qe),Le}function rn(J,Y,ne,ve){if(typeof ne=="object"&&ne!==null&&ne.type===R&&ne.key===null&&(ne=ne.props.children),typeof ne=="object"&&ne!==null){switch(ne.$$typeof){case M:e:{for(var Le=ne.key,Be=Y;Be!==null;){if(Be.key===Le){if(Le=ne.type,Le===R){if(Be.tag===7){m(J,Be.sibling),Y=I(Be,ne.props.children),Y.return=J,J=Y;break e}}else if(Be.elementType===Le||typeof Le=="object"&&Le!==null&&Le.$$typeof===Z&&AP(Le)===Be.type){m(J,Be.sibling),Y=I(Be,ne.props),Y.ref=Au(J,Be,ne),Y.return=J,J=Y;break e}m(J,Be);break}else d(J,Be);Be=Be.sibling}ne.type===R?(Y=el(ne.props.children,J.mode,ve,ne.key),Y.return=J,J=Y):(ve=gp(ne.type,ne.key,ne.props,null,J.mode,ve),ve.ref=Au(J,Y,ne),ve.return=J,J=ve)}return O(J);case A:e:{for(Be=ne.key;Y!==null;){if(Y.key===Be)if(Y.tag===4&&Y.stateNode.containerInfo===ne.containerInfo&&Y.stateNode.implementation===ne.implementation){m(J,Y.sibling),Y=I(Y,ne.children||[]),Y.return=J,J=Y;break e}else{m(J,Y);break}else d(J,Y);Y=Y.sibling}Y=_v(ne,J.mode,ve),Y.return=J,J=Y}return O(J);case Z:return Be=ne._init,rn(J,Y,Be(ne._payload),ve)}if(co(ne))return je(J,Y,ne,ve);if(Q(ne))return De(J,Y,ne,ve);Wh(J,ne)}return typeof ne=="string"&&ne!==""||typeof ne=="number"?(ne=""+ne,Y!==null&&Y.tag===6?(m(J,Y.sibling),Y=I(Y,ne),Y.return=J,J=Y):(m(J,Y),Y=bv(ne,J.mode,ve),Y.return=J,J=Y),O(J)):m(J,Y)}return rn}var nc=jP(!0),RP=jP(!1),Vh=zi(null),Gh=null,rc=null,jy=null;function Ry(){jy=rc=Gh=null}function Oy(l){var d=Vh.current;Nt(Vh),l._currentValue=d}function Dy(l,d,m){for(;l!==null;){var x=l.alternate;if((l.childLanes&d)!==d?(l.childLanes|=d,x!==null&&(x.childLanes|=d)):x!==null&&(x.childLanes&d)!==d&&(x.childLanes|=d),l===m)break;l=l.return}}function oc(l,d){Gh=l,jy=rc=null,l=l.dependencies,l!==null&&l.firstContext!==null&&(l.lanes&d&&(wr=!0),l.firstContext=null)}function vo(l){var d=l._currentValue;if(jy!==l)if(l={context:l,memoizedValue:d,next:null},rc===null){if(Gh===null)throw Error(t(308));rc=l,Gh.dependencies={lanes:0,firstContext:l}}else rc=rc.next=l;return d}var Ga=null;function Ly(l){Ga===null?Ga=[l]:Ga.push(l)}function OP(l,d,m,x){var I=d.interleaved;return I===null?(m.next=m,Ly(d)):(m.next=I.next,I.next=m),d.interleaved=m,ei(l,x)}function ei(l,d){l.lanes|=d;var m=l.alternate;for(m!==null&&(m.lanes|=d),m=l,l=l.return;l!==null;)l.childLanes|=d,m=l.alternate,m!==null&&(m.childLanes|=d),m=l,l=l.return;return m.tag===3?m.stateNode:null}var Hi=!1;function Fy(l){l.updateQueue={baseState:l.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function DP(l,d){l=l.updateQueue,d.updateQueue===l&&(d.updateQueue={baseState:l.baseState,firstBaseUpdate:l.firstBaseUpdate,lastBaseUpdate:l.lastBaseUpdate,shared:l.shared,effects:l.effects})}function ti(l,d){return{eventTime:l,lane:d,tag:0,payload:null,callback:null,next:null}}function Ki(l,d,m){var x=l.updateQueue;if(x===null)return null;if(x=x.shared,ht&2){var I=x.pending;return I===null?d.next=d:(d.next=I.next,I.next=d),x.pending=d,ei(l,m)}return I=x.interleaved,I===null?(d.next=d,Ly(x)):(d.next=I.next,I.next=d),x.interleaved=d,ei(l,m)}function qh(l,d,m){if(d=d.updateQueue,d!==null&&(d=d.shared,(m&4194240)!==0)){var x=d.lanes;x&=l.pendingLanes,m|=x,d.lanes=m,Ul(l,m)}}function LP(l,d){var m=l.updateQueue,x=l.alternate;if(x!==null&&(x=x.updateQueue,m===x)){var I=null,k=null;if(m=m.firstBaseUpdate,m!==null){do{var O={eventTime:m.eventTime,lane:m.lane,tag:m.tag,payload:m.payload,callback:m.callback,next:null};k===null?I=k=O:k=k.next=O,m=m.next}while(m!==null);k===null?I=k=d:k=k.next=d}else I=k=d;m={baseState:x.baseState,firstBaseUpdate:I,lastBaseUpdate:k,shared:x.shared,effects:x.effects},l.updateQueue=m;return}l=m.lastBaseUpdate,l===null?m.firstBaseUpdate=d:l.next=d,m.lastBaseUpdate=d}function Yh(l,d,m,x){var I=l.updateQueue;Hi=!1;var k=I.firstBaseUpdate,O=I.lastBaseUpdate,z=I.shared.pending;if(z!==null){I.shared.pending=null;var W=z,se=W.next;W.next=null,O===null?k=se:O.next=se,O=W;var ge=l.alternate;ge!==null&&(ge=ge.updateQueue,z=ge.lastBaseUpdate,z!==O&&(z===null?ge.firstBaseUpdate=se:z.next=se,ge.lastBaseUpdate=W))}if(k!==null){var me=I.baseState;O=0,ge=se=W=null,z=k;do{var fe=z.lane,Ee=z.eventTime;if((x&fe)===fe){ge!==null&&(ge=ge.next={eventTime:Ee,lane:0,tag:z.tag,payload:z.payload,callback:z.callback,next:null});e:{var je=l,De=z;switch(fe=d,Ee=m,De.tag){case 1:if(je=De.payload,typeof je=="function"){me=je.call(Ee,me,fe);break e}me=je;break e;case 3:je.flags=je.flags&-65537|128;case 0:if(je=De.payload,fe=typeof je=="function"?je.call(Ee,me,fe):je,fe==null)break e;me=ae({},me,fe);break e;case 2:Hi=!0}}z.callback!==null&&z.lane!==0&&(l.flags|=64,fe=I.effects,fe===null?I.effects=[z]:fe.push(z))}else Ee={eventTime:Ee,lane:fe,tag:z.tag,payload:z.payload,callback:z.callback,next:null},ge===null?(se=ge=Ee,W=me):ge=ge.next=Ee,O|=fe;if(z=z.next,z===null){if(z=I.shared.pending,z===null)break;fe=z,z=fe.next,fe.next=null,I.lastBaseUpdate=fe,I.shared.pending=null}}while(!0);if(ge===null&&(W=me),I.baseState=W,I.firstBaseUpdate=se,I.lastBaseUpdate=ge,d=I.shared.interleaved,d!==null){I=d;do O|=I.lane,I=I.next;while(I!==d)}else k===null&&(I.shared.lanes=0);Xa|=O,l.lanes=O,l.memoizedState=me}}function FP(l,d,m){if(l=d.effects,d.effects=null,l!==null)for(d=0;d<l.length;d++){var x=l[d],I=x.callback;if(I!==null){if(x.callback=null,x=m,typeof I!="function")throw Error(t(191,I));I.call(x)}}}var ju={},ys=zi(ju),Ru=zi(ju),Ou=zi(ju);function qa(l){if(l===ju)throw Error(t(174));return l}function Ny(l,d){switch(jt(Ou,d),jt(Ru,l),jt(ys,ju),l=d.nodeType,l){case 9:case 11:d=(d=d.documentElement)?d.namespaceURI:cs(null,"");break;default:l=l===8?d.parentNode:d,d=l.namespaceURI||null,l=l.tagName,d=cs(d,l)}Nt(ys),jt(ys,d)}function sc(){Nt(ys),Nt(Ru),Nt(Ou)}function NP(l){qa(Ou.current);var d=qa(ys.current),m=cs(d,l.type);d!==m&&(jt(Ru,l),jt(ys,m))}function $y(l){Ru.current===l&&(Nt(ys),Nt(Ru))}var Vt=zi(0);function Xh(l){for(var d=l;d!==null;){if(d.tag===13){var m=d.memoizedState;if(m!==null&&(m=m.dehydrated,m===null||m.data==="$?"||m.data==="$!"))return d}else if(d.tag===19&&d.memoizedProps.revealOrder!==void 0){if(d.flags&128)return d}else if(d.child!==null){d.child.return=d,d=d.child;continue}if(d===l)break;for(;d.sibling===null;){if(d.return===null||d.return===l)return null;d=d.return}d.sibling.return=d.return,d=d.sibling}return null}var zy=[];function By(){for(var l=0;l<zy.length;l++)zy[l]._workInProgressVersionPrimary=null;zy.length=0}var Zh=E.ReactCurrentDispatcher,Uy=E.ReactCurrentBatchConfig,Ya=0,Gt=null,hn=null,mn=null,Qh=!1,Du=!1,Lu=0,g6=0;function zn(){throw Error(t(321))}function Hy(l,d){if(d===null)return!1;for(var m=0;m<d.length&&m<l.length;m++)if(!zo(l[m],d[m]))return!1;return!0}function Ky(l,d,m,x,I,k){if(Ya=k,Gt=d,d.memoizedState=null,d.updateQueue=null,d.lanes=0,Zh.current=l===null||l.memoizedState===null?S6:x6,l=m(x,I),Du){k=0;do{if(Du=!1,Lu=0,25<=k)throw Error(t(301));k+=1,mn=hn=null,d.updateQueue=null,Zh.current=w6,l=m(x,I)}while(Du)}if(Zh.current=tp,d=hn!==null&&hn.next!==null,Ya=0,mn=hn=Gt=null,Qh=!1,d)throw Error(t(300));return l}function Wy(){var l=Lu!==0;return Lu=0,l}function vs(){var l={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return mn===null?Gt.memoizedState=mn=l:mn=mn.next=l,mn}function So(){if(hn===null){var l=Gt.alternate;l=l!==null?l.memoizedState:null}else l=hn.next;var d=mn===null?Gt.memoizedState:mn.next;if(d!==null)mn=d,hn=l;else{if(l===null)throw Error(t(310));hn=l,l={memoizedState:hn.memoizedState,baseState:hn.baseState,baseQueue:hn.baseQueue,queue:hn.queue,next:null},mn===null?Gt.memoizedState=mn=l:mn=mn.next=l}return mn}function Fu(l,d){return typeof d=="function"?d(l):d}function Vy(l){var d=So(),m=d.queue;if(m===null)throw Error(t(311));m.lastRenderedReducer=l;var x=hn,I=x.baseQueue,k=m.pending;if(k!==null){if(I!==null){var O=I.next;I.next=k.next,k.next=O}x.baseQueue=I=k,m.pending=null}if(I!==null){k=I.next,x=x.baseState;var z=O=null,W=null,se=k;do{var ge=se.lane;if((Ya&ge)===ge)W!==null&&(W=W.next={lane:0,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null}),x=se.hasEagerState?se.eagerState:l(x,se.action);else{var me={lane:ge,action:se.action,hasEagerState:se.hasEagerState,eagerState:se.eagerState,next:null};W===null?(z=W=me,O=x):W=W.next=me,Gt.lanes|=ge,Xa|=ge}se=se.next}while(se!==null&&se!==k);W===null?O=x:W.next=z,zo(x,d.memoizedState)||(wr=!0),d.memoizedState=x,d.baseState=O,d.baseQueue=W,m.lastRenderedState=x}if(l=m.interleaved,l!==null){I=l;do k=I.lane,Gt.lanes|=k,Xa|=k,I=I.next;while(I!==l)}else I===null&&(m.lanes=0);return[d.memoizedState,m.dispatch]}function Gy(l){var d=So(),m=d.queue;if(m===null)throw Error(t(311));m.lastRenderedReducer=l;var x=m.dispatch,I=m.pending,k=d.memoizedState;if(I!==null){m.pending=null;var O=I=I.next;do k=l(k,O.action),O=O.next;while(O!==I);zo(k,d.memoizedState)||(wr=!0),d.memoizedState=k,d.baseQueue===null&&(d.baseState=k),m.lastRenderedState=k}return[k,x]}function $P(){}function zP(l,d){var m=Gt,x=So(),I=d(),k=!zo(x.memoizedState,I);if(k&&(x.memoizedState=I,wr=!0),x=x.queue,qy(HP.bind(null,m,x,l),[l]),x.getSnapshot!==d||k||mn!==null&&mn.memoizedState.tag&1){if(m.flags|=2048,Nu(9,UP.bind(null,m,x,I,d),void 0,null),yn===null)throw Error(t(349));Ya&30||BP(m,d,I)}return I}function BP(l,d,m){l.flags|=16384,l={getSnapshot:d,value:m},d=Gt.updateQueue,d===null?(d={lastEffect:null,stores:null},Gt.updateQueue=d,d.stores=[l]):(m=d.stores,m===null?d.stores=[l]:m.push(l))}function UP(l,d,m,x){d.value=m,d.getSnapshot=x,KP(d)&&WP(l)}function HP(l,d,m){return m(function(){KP(d)&&WP(l)})}function KP(l){var d=l.getSnapshot;l=l.value;try{var m=d();return!zo(l,m)}catch{return!0}}function WP(l){var d=ei(l,1);d!==null&&Wo(d,l,1,-1)}function VP(l){var d=vs();return typeof l=="function"&&(l=l()),d.memoizedState=d.baseState=l,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Fu,lastRenderedState:l},d.queue=l,l=l.dispatch=v6.bind(null,Gt,l),[d.memoizedState,l]}function Nu(l,d,m,x){return l={tag:l,create:d,destroy:m,deps:x,next:null},d=Gt.updateQueue,d===null?(d={lastEffect:null,stores:null},Gt.updateQueue=d,d.lastEffect=l.next=l):(m=d.lastEffect,m===null?d.lastEffect=l.next=l:(x=m.next,m.next=l,l.next=x,d.lastEffect=l)),l}function GP(){return So().memoizedState}function Jh(l,d,m,x){var I=vs();Gt.flags|=l,I.memoizedState=Nu(1|d,m,void 0,x===void 0?null:x)}function ep(l,d,m,x){var I=So();x=x===void 0?null:x;var k=void 0;if(hn!==null){var O=hn.memoizedState;if(k=O.destroy,x!==null&&Hy(x,O.deps)){I.memoizedState=Nu(d,m,k,x);return}}Gt.flags|=l,I.memoizedState=Nu(1|d,m,k,x)}function qP(l,d){return Jh(8390656,8,l,d)}function qy(l,d){return ep(2048,8,l,d)}function YP(l,d){return ep(4,2,l,d)}function XP(l,d){return ep(4,4,l,d)}function ZP(l,d){if(typeof d=="function")return l=l(),d(l),function(){d(null)};if(d!=null)return l=l(),d.current=l,function(){d.current=null}}function QP(l,d,m){return m=m!=null?m.concat([l]):null,ep(4,4,ZP.bind(null,d,l),m)}function Yy(){}function JP(l,d){var m=So();d=d===void 0?null:d;var x=m.memoizedState;return x!==null&&d!==null&&Hy(d,x[1])?x[0]:(m.memoizedState=[l,d],l)}function eC(l,d){var m=So();d=d===void 0?null:d;var x=m.memoizedState;return x!==null&&d!==null&&Hy(d,x[1])?x[0]:(l=l(),m.memoizedState=[l,d],l)}function tC(l,d,m){return Ya&21?(zo(m,d)||(m=Ph(),Gt.lanes|=m,Xa|=m,l.baseState=!0),d):(l.baseState&&(l.baseState=!1,wr=!0),l.memoizedState=m)}function m6(l,d){var m=ut;ut=m!==0&&4>m?m:4,l(!0);var x=Uy.transition;Uy.transition={};try{l(!1),d()}finally{ut=m,Uy.transition=x}}function nC(){return So().memoizedState}function y6(l,d,m){var x=qi(l);if(m={lane:x,action:m,hasEagerState:!1,eagerState:null,next:null},rC(l))oC(d,m);else if(m=OP(l,d,m,x),m!==null){var I=or();Wo(m,l,x,I),sC(m,d,x)}}function v6(l,d,m){var x=qi(l),I={lane:x,action:m,hasEagerState:!1,eagerState:null,next:null};if(rC(l))oC(d,I);else{var k=l.alternate;if(l.lanes===0&&(k===null||k.lanes===0)&&(k=d.lastRenderedReducer,k!==null))try{var O=d.lastRenderedState,z=k(O,m);if(I.hasEagerState=!0,I.eagerState=z,zo(z,O)){var W=d.interleaved;W===null?(I.next=I,Ly(d)):(I.next=W.next,W.next=I),d.interleaved=I;return}}catch{}finally{}m=OP(l,d,I,x),m!==null&&(I=or(),Wo(m,l,x,I),sC(m,d,x))}}function rC(l){var d=l.alternate;return l===Gt||d!==null&&d===Gt}function oC(l,d){Du=Qh=!0;var m=l.pending;m===null?d.next=d:(d.next=m.next,m.next=d),l.pending=d}function sC(l,d,m){if(m&4194240){var x=d.lanes;x&=l.pendingLanes,m|=x,d.lanes=m,Ul(l,m)}}var tp={readContext:vo,useCallback:zn,useContext:zn,useEffect:zn,useImperativeHandle:zn,useInsertionEffect:zn,useLayoutEffect:zn,useMemo:zn,useReducer:zn,useRef:zn,useState:zn,useDebugValue:zn,useDeferredValue:zn,useTransition:zn,useMutableSource:zn,useSyncExternalStore:zn,useId:zn,unstable_isNewReconciler:!1},S6={readContext:vo,useCallback:function(l,d){return vs().memoizedState=[l,d===void 0?null:d],l},useContext:vo,useEffect:qP,useImperativeHandle:function(l,d,m){return m=m!=null?m.concat([l]):null,Jh(4194308,4,ZP.bind(null,d,l),m)},useLayoutEffect:function(l,d){return Jh(4194308,4,l,d)},useInsertionEffect:function(l,d){return Jh(4,2,l,d)},useMemo:function(l,d){var m=vs();return d=d===void 0?null:d,l=l(),m.memoizedState=[l,d],l},useReducer:function(l,d,m){var x=vs();return d=m!==void 0?m(d):d,x.memoizedState=x.baseState=d,l={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:l,lastRenderedState:d},x.queue=l,l=l.dispatch=y6.bind(null,Gt,l),[x.memoizedState,l]},useRef:function(l){var d=vs();return l={current:l},d.memoizedState=l},useState:VP,useDebugValue:Yy,useDeferredValue:function(l){return vs().memoizedState=l},useTransition:function(){var l=VP(!1),d=l[0];return l=m6.bind(null,l[1]),vs().memoizedState=l,[d,l]},useMutableSource:function(){},useSyncExternalStore:function(l,d,m){var x=Gt,I=vs();if(Ht){if(m===void 0)throw Error(t(407));m=m()}else{if(m=d(),yn===null)throw Error(t(349));Ya&30||BP(x,d,m)}I.memoizedState=m;var k={value:m,getSnapshot:d};return I.queue=k,qP(HP.bind(null,x,k,l),[l]),x.flags|=2048,Nu(9,UP.bind(null,x,k,m,d),void 0,null),m},useId:function(){var l=vs(),d=yn.identifierPrefix;if(Ht){var m=Js,x=Qs;m=(x&~(1<<32-Kr(x)-1)).toString(32)+m,d=":"+d+"R"+m,m=Lu++,0<m&&(d+="H"+m.toString(32)),d+=":"}else m=g6++,d=":"+d+"r"+m.toString(32)+":";return l.memoizedState=d},unstable_isNewReconciler:!1},x6={readContext:vo,useCallback:JP,useContext:vo,useEffect:qy,useImperativeHandle:QP,useInsertionEffect:YP,useLayoutEffect:XP,useMemo:eC,useReducer:Vy,useRef:GP,useState:function(){return Vy(Fu)},useDebugValue:Yy,useDeferredValue:function(l){var d=So();return tC(d,hn.memoizedState,l)},useTransition:function(){var l=Vy(Fu)[0],d=So().memoizedState;return[l,d]},useMutableSource:$P,useSyncExternalStore:zP,useId:nC,unstable_isNewReconciler:!1},w6={readContext:vo,useCallback:JP,useContext:vo,useEffect:qy,useImperativeHandle:QP,useInsertionEffect:YP,useLayoutEffect:XP,useMemo:eC,useReducer:Gy,useRef:GP,useState:function(){return Gy(Fu)},useDebugValue:Yy,useDeferredValue:function(l){var d=So();return hn===null?d.memoizedState=l:tC(d,hn.memoizedState,l)},useTransition:function(){var l=Gy(Fu)[0],d=So().memoizedState;return[l,d]},useMutableSource:$P,useSyncExternalStore:zP,useId:nC,unstable_isNewReconciler:!1};function Uo(l,d){if(l&&l.defaultProps){d=ae({},d),l=l.defaultProps;for(var m in l)d[m]===void 0&&(d[m]=l[m]);return d}return d}function Xy(l,d,m,x){d=l.memoizedState,m=m(x,d),m=m==null?d:ae({},d,m),l.memoizedState=m,l.lanes===0&&(l.updateQueue.baseState=m)}var np={isMounted:function(l){return(l=l._reactInternals)?qs(l)===l:!1},enqueueSetState:function(l,d,m){l=l._reactInternals;var x=or(),I=qi(l),k=ti(x,I);k.payload=d,m!=null&&(k.callback=m),d=Ki(l,k,I),d!==null&&(Wo(d,l,I,x),qh(d,l,I))},enqueueReplaceState:function(l,d,m){l=l._reactInternals;var x=or(),I=qi(l),k=ti(x,I);k.tag=1,k.payload=d,m!=null&&(k.callback=m),d=Ki(l,k,I),d!==null&&(Wo(d,l,I,x),qh(d,l,I))},enqueueForceUpdate:function(l,d){l=l._reactInternals;var m=or(),x=qi(l),I=ti(m,x);I.tag=2,d!=null&&(I.callback=d),d=Ki(l,I,x),d!==null&&(Wo(d,l,x,m),qh(d,l,x))}};function iC(l,d,m,x,I,k,O){return l=l.stateNode,typeof l.shouldComponentUpdate=="function"?l.shouldComponentUpdate(x,k,O):d.prototype&&d.prototype.isPureReactComponent?!Pu(m,x)||!Pu(I,k):!0}function aC(l,d,m){var x=!1,I=Bi,k=d.contextType;return typeof k=="object"&&k!==null?k=vo(k):(I=xr(d)?Ka:$n.current,x=d.contextTypes,k=(x=x!=null)?Ql(l,I):Bi),d=new d(m,k),l.memoizedState=d.state!==null&&d.state!==void 0?d.state:null,d.updater=np,l.stateNode=d,d._reactInternals=l,x&&(l=l.stateNode,l.__reactInternalMemoizedUnmaskedChildContext=I,l.__reactInternalMemoizedMaskedChildContext=k),d}function lC(l,d,m,x){l=d.state,typeof d.componentWillReceiveProps=="function"&&d.componentWillReceiveProps(m,x),typeof d.UNSAFE_componentWillReceiveProps=="function"&&d.UNSAFE_componentWillReceiveProps(m,x),d.state!==l&&np.enqueueReplaceState(d,d.state,null)}function Zy(l,d,m,x){var I=l.stateNode;I.props=m,I.state=l.memoizedState,I.refs={},Fy(l);var k=d.contextType;typeof k=="object"&&k!==null?I.context=vo(k):(k=xr(d)?Ka:$n.current,I.context=Ql(l,k)),I.state=l.memoizedState,k=d.getDerivedStateFromProps,typeof k=="function"&&(Xy(l,d,k,m),I.state=l.memoizedState),typeof d.getDerivedStateFromProps=="function"||typeof I.getSnapshotBeforeUpdate=="function"||typeof I.UNSAFE_componentWillMount!="function"&&typeof I.componentWillMount!="function"||(d=I.state,typeof I.componentWillMount=="function"&&I.componentWillMount(),typeof I.UNSAFE_componentWillMount=="function"&&I.UNSAFE_componentWillMount(),d!==I.state&&np.enqueueReplaceState(I,I.state,null),Yh(l,m,I,x),I.state=l.memoizedState),typeof I.componentDidMount=="function"&&(l.flags|=4194308)}function ic(l,d){try{var m="",x=d;do m+=ue(x),x=x.return;while(x);var I=m}catch(k){I=`
Error generating stack: `+k.message+`
`+k.stack}return{value:l,source:d,stack:I,digest:null}}function Qy(l,d,m){return{value:l,source:null,stack:m??null,digest:d??null}}function Jy(l,d){try{console.error(d.value)}catch(m){setTimeout(function(){throw m})}}var b6=typeof WeakMap=="function"?WeakMap:Map;function cC(l,d,m){m=ti(-1,m),m.tag=3,m.payload={element:null};var x=d.value;return m.callback=function(){cp||(cp=!0,fv=x),Jy(l,d)},m}function uC(l,d,m){m=ti(-1,m),m.tag=3;var x=l.type.getDerivedStateFromError;if(typeof x=="function"){var I=d.value;m.payload=function(){return x(I)},m.callback=function(){Jy(l,d)}}var k=l.stateNode;return k!==null&&typeof k.componentDidCatch=="function"&&(m.callback=function(){Jy(l,d),typeof x!="function"&&(Vi===null?Vi=new Set([this]):Vi.add(this));var O=d.stack;this.componentDidCatch(d.value,{componentStack:O!==null?O:""})}),m}function dC(l,d,m){var x=l.pingCache;if(x===null){x=l.pingCache=new b6;var I=new Set;x.set(d,I)}else I=x.get(d),I===void 0&&(I=new Set,x.set(d,I));I.has(m)||(I.add(m),l=L6.bind(null,l,d,m),d.then(l,l))}function hC(l){do{var d;if((d=l.tag===13)&&(d=l.memoizedState,d=d!==null?d.dehydrated!==null:!0),d)return l;l=l.return}while(l!==null);return null}function pC(l,d,m,x,I){return l.mode&1?(l.flags|=65536,l.lanes=I,l):(l===d?l.flags|=65536:(l.flags|=128,m.flags|=131072,m.flags&=-52805,m.tag===1&&(m.alternate===null?m.tag=17:(d=ti(-1,1),d.tag=2,Ki(m,d,1))),m.lanes|=1),l)}var _6=E.ReactCurrentOwner,wr=!1;function rr(l,d,m,x){d.child=l===null?RP(d,null,m,x):nc(d,l.child,m,x)}function fC(l,d,m,x,I){m=m.render;var k=d.ref;return oc(d,I),x=Ky(l,d,m,x,k,I),m=Wy(),l!==null&&!wr?(d.updateQueue=l.updateQueue,d.flags&=-2053,l.lanes&=~I,ni(l,d,I)):(Ht&&m&&Ey(d),d.flags|=1,rr(l,d,x,I),d.child)}function gC(l,d,m,x,I){if(l===null){var k=m.type;return typeof k=="function"&&!wv(k)&&k.defaultProps===void 0&&m.compare===null&&m.defaultProps===void 0?(d.tag=15,d.type=k,mC(l,d,k,x,I)):(l=gp(m.type,null,x,d,d.mode,I),l.ref=d.ref,l.return=d,d.child=l)}if(k=l.child,!(l.lanes&I)){var O=k.memoizedProps;if(m=m.compare,m=m!==null?m:Pu,m(O,x)&&l.ref===d.ref)return ni(l,d,I)}return d.flags|=1,l=Xi(k,x),l.ref=d.ref,l.return=d,d.child=l}function mC(l,d,m,x,I){if(l!==null){var k=l.memoizedProps;if(Pu(k,x)&&l.ref===d.ref)if(wr=!1,d.pendingProps=x=k,(l.lanes&I)!==0)l.flags&131072&&(wr=!0);else return d.lanes=l.lanes,ni(l,d,I)}return ev(l,d,m,x,I)}function yC(l,d,m){var x=d.pendingProps,I=x.children,k=l!==null?l.memoizedState:null;if(x.mode==="hidden")if(!(d.mode&1))d.memoizedState={baseLanes:0,cachePool:null,transitions:null},jt(lc,Gr),Gr|=m;else{if(!(m&1073741824))return l=k!==null?k.baseLanes|m:m,d.lanes=d.childLanes=1073741824,d.memoizedState={baseLanes:l,cachePool:null,transitions:null},d.updateQueue=null,jt(lc,Gr),Gr|=l,null;d.memoizedState={baseLanes:0,cachePool:null,transitions:null},x=k!==null?k.baseLanes:m,jt(lc,Gr),Gr|=x}else k!==null?(x=k.baseLanes|m,d.memoizedState=null):x=m,jt(lc,Gr),Gr|=x;return rr(l,d,I,m),d.child}function vC(l,d){var m=d.ref;(l===null&&m!==null||l!==null&&l.ref!==m)&&(d.flags|=512,d.flags|=2097152)}function ev(l,d,m,x,I){var k=xr(m)?Ka:$n.current;return k=Ql(d,k),oc(d,I),m=Ky(l,d,m,x,k,I),x=Wy(),l!==null&&!wr?(d.updateQueue=l.updateQueue,d.flags&=-2053,l.lanes&=~I,ni(l,d,I)):(Ht&&x&&Ey(d),d.flags|=1,rr(l,d,m,I),d.child)}function SC(l,d,m,x,I){if(xr(m)){var k=!0;zh(d)}else k=!1;if(oc(d,I),d.stateNode===null)op(l,d),aC(d,m,x),Zy(d,m,x,I),x=!0;else if(l===null){var O=d.stateNode,z=d.memoizedProps;O.props=z;var W=O.context,se=m.contextType;typeof se=="object"&&se!==null?se=vo(se):(se=xr(m)?Ka:$n.current,se=Ql(d,se));var ge=m.getDerivedStateFromProps,me=typeof ge=="function"||typeof O.getSnapshotBeforeUpdate=="function";me||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(z!==x||W!==se)&&lC(d,O,x,se),Hi=!1;var fe=d.memoizedState;O.state=fe,Yh(d,x,O,I),W=d.memoizedState,z!==x||fe!==W||Sr.current||Hi?(typeof ge=="function"&&(Xy(d,m,ge,x),W=d.memoizedState),(z=Hi||iC(d,m,z,x,fe,W,se))?(me||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"&&(d.flags|=4194308)):(typeof O.componentDidMount=="function"&&(d.flags|=4194308),d.memoizedProps=x,d.memoizedState=W),O.props=x,O.state=W,O.context=se,x=z):(typeof O.componentDidMount=="function"&&(d.flags|=4194308),x=!1)}else{O=d.stateNode,DP(l,d),z=d.memoizedProps,se=d.type===d.elementType?z:Uo(d.type,z),O.props=se,me=d.pendingProps,fe=O.context,W=m.contextType,typeof W=="object"&&W!==null?W=vo(W):(W=xr(m)?Ka:$n.current,W=Ql(d,W));var Ee=m.getDerivedStateFromProps;(ge=typeof Ee=="function"||typeof O.getSnapshotBeforeUpdate=="function")||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(z!==me||fe!==W)&&lC(d,O,x,W),Hi=!1,fe=d.memoizedState,O.state=fe,Yh(d,x,O,I);var je=d.memoizedState;z!==me||fe!==je||Sr.current||Hi?(typeof Ee=="function"&&(Xy(d,m,Ee,x),je=d.memoizedState),(se=Hi||iC(d,m,se,x,fe,je,W)||!1)?(ge||typeof O.UNSAFE_componentWillUpdate!="function"&&typeof O.componentWillUpdate!="function"||(typeof O.componentWillUpdate=="function"&&O.componentWillUpdate(x,je,W),typeof O.UNSAFE_componentWillUpdate=="function"&&O.UNSAFE_componentWillUpdate(x,je,W)),typeof O.componentDidUpdate=="function"&&(d.flags|=4),typeof O.getSnapshotBeforeUpdate=="function"&&(d.flags|=1024)):(typeof O.componentDidUpdate!="function"||z===l.memoizedProps&&fe===l.memoizedState||(d.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||z===l.memoizedProps&&fe===l.memoizedState||(d.flags|=1024),d.memoizedProps=x,d.memoizedState=je),O.props=x,O.state=je,O.context=W,x=se):(typeof O.componentDidUpdate!="function"||z===l.memoizedProps&&fe===l.memoizedState||(d.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||z===l.memoizedProps&&fe===l.memoizedState||(d.flags|=1024),x=!1)}return tv(l,d,m,x,k,I)}function tv(l,d,m,x,I,k){vC(l,d);var O=(d.flags&128)!==0;if(!x&&!O)return I&&PP(d,m,!1),ni(l,d,k);x=d.stateNode,_6.current=d;var z=O&&typeof m.getDerivedStateFromError!="function"?null:x.render();return d.flags|=1,l!==null&&O?(d.child=nc(d,l.child,null,k),d.child=nc(d,null,z,k)):rr(l,d,z,k),d.memoizedState=x.state,I&&PP(d,m,!0),d.child}function xC(l){var d=l.stateNode;d.pendingContext?bP(l,d.pendingContext,d.pendingContext!==d.context):d.context&&bP(l,d.context,!1),Ny(l,d.containerInfo)}function wC(l,d,m,x,I){return tc(),Ay(I),d.flags|=256,rr(l,d,m,x),d.child}var nv={dehydrated:null,treeContext:null,retryLane:0};function rv(l){return{baseLanes:l,cachePool:null,transitions:null}}function bC(l,d,m){var x=d.pendingProps,I=Vt.current,k=!1,O=(d.flags&128)!==0,z;if((z=O)||(z=l!==null&&l.memoizedState===null?!1:(I&2)!==0),z?(k=!0,d.flags&=-129):(l===null||l.memoizedState!==null)&&(I|=1),jt(Vt,I&1),l===null)return My(d),l=d.memoizedState,l!==null&&(l=l.dehydrated,l!==null)?(d.mode&1?l.data==="$!"?d.lanes=8:d.lanes=1073741824:d.lanes=1,null):(O=x.children,l=x.fallback,k?(x=d.mode,k=d.child,O={mode:"hidden",children:O},!(x&1)&&k!==null?(k.childLanes=0,k.pendingProps=O):k=mp(O,x,0,null),l=el(l,x,m,null),k.return=d,l.return=d,k.sibling=l,d.child=k,d.child.memoizedState=rv(m),d.memoizedState=nv,l):ov(d,O));if(I=l.memoizedState,I!==null&&(z=I.dehydrated,z!==null))return P6(l,d,O,x,z,I,m);if(k){k=x.fallback,O=d.mode,I=l.child,z=I.sibling;var W={mode:"hidden",children:x.children};return!(O&1)&&d.child!==I?(x=d.child,x.childLanes=0,x.pendingProps=W,d.deletions=null):(x=Xi(I,W),x.subtreeFlags=I.subtreeFlags&14680064),z!==null?k=Xi(z,k):(k=el(k,O,m,null),k.flags|=2),k.return=d,x.return=d,x.sibling=k,d.child=x,x=k,k=d.child,O=l.child.memoizedState,O=O===null?rv(m):{baseLanes:O.baseLanes|m,cachePool:null,transitions:O.transitions},k.memoizedState=O,k.childLanes=l.childLanes&~m,d.memoizedState=nv,x}return k=l.child,l=k.sibling,x=Xi(k,{mode:"visible",children:x.children}),!(d.mode&1)&&(x.lanes=m),x.return=d,x.sibling=null,l!==null&&(m=d.deletions,m===null?(d.deletions=[l],d.flags|=16):m.push(l)),d.child=x,d.memoizedState=null,x}function ov(l,d){return d=mp({mode:"visible",children:d},l.mode,0,null),d.return=l,l.child=d}function rp(l,d,m,x){return x!==null&&Ay(x),nc(d,l.child,null,m),l=ov(d,d.pendingProps.children),l.flags|=2,d.memoizedState=null,l}function P6(l,d,m,x,I,k,O){if(m)return d.flags&256?(d.flags&=-257,x=Qy(Error(t(422))),rp(l,d,O,x)):d.memoizedState!==null?(d.child=l.child,d.flags|=128,null):(k=x.fallback,I=d.mode,x=mp({mode:"visible",children:x.children},I,0,null),k=el(k,I,O,null),k.flags|=2,x.return=d,k.return=d,x.sibling=k,d.child=x,d.mode&1&&nc(d,l.child,null,O),d.child.memoizedState=rv(O),d.memoizedState=nv,k);if(!(d.mode&1))return rp(l,d,O,null);if(I.data==="$!"){if(x=I.nextSibling&&I.nextSibling.dataset,x)var z=x.dgst;return x=z,k=Error(t(419)),x=Qy(k,x,void 0),rp(l,d,O,x)}if(z=(O&l.childLanes)!==0,wr||z){if(x=yn,x!==null){switch(O&-O){case 4:I=2;break;case 16:I=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:I=32;break;case 536870912:I=268435456;break;default:I=0}I=I&(x.suspendedLanes|O)?0:I,I!==0&&I!==k.retryLane&&(k.retryLane=I,ei(l,I),Wo(x,l,I,-1))}return xv(),x=Qy(Error(t(421))),rp(l,d,O,x)}return I.data==="$?"?(d.flags|=128,d.child=l.child,d=F6.bind(null,l),I._reactRetry=d,null):(l=k.treeContext,Vr=$i(I.nextSibling),Wr=d,Ht=!0,Bo=null,l!==null&&(mo[yo++]=Qs,mo[yo++]=Js,mo[yo++]=Wa,Qs=l.id,Js=l.overflow,Wa=d),d=ov(d,x.children),d.flags|=4096,d)}function _C(l,d,m){l.lanes|=d;var x=l.alternate;x!==null&&(x.lanes|=d),Dy(l.return,d,m)}function sv(l,d,m,x,I){var k=l.memoizedState;k===null?l.memoizedState={isBackwards:d,rendering:null,renderingStartTime:0,last:x,tail:m,tailMode:I}:(k.isBackwards=d,k.rendering=null,k.renderingStartTime=0,k.last=x,k.tail=m,k.tailMode=I)}function PC(l,d,m){var x=d.pendingProps,I=x.revealOrder,k=x.tail;if(rr(l,d,x.children,m),x=Vt.current,x&2)x=x&1|2,d.flags|=128;else{if(l!==null&&l.flags&128)e:for(l=d.child;l!==null;){if(l.tag===13)l.memoizedState!==null&&_C(l,m,d);else if(l.tag===19)_C(l,m,d);else if(l.child!==null){l.child.return=l,l=l.child;continue}if(l===d)break e;for(;l.sibling===null;){if(l.return===null||l.return===d)break e;l=l.return}l.sibling.return=l.return,l=l.sibling}x&=1}if(jt(Vt,x),!(d.mode&1))d.memoizedState=null;else switch(I){case"forwards":for(m=d.child,I=null;m!==null;)l=m.alternate,l!==null&&Xh(l)===null&&(I=m),m=m.sibling;m=I,m===null?(I=d.child,d.child=null):(I=m.sibling,m.sibling=null),sv(d,!1,I,m,k);break;case"backwards":for(m=null,I=d.child,d.child=null;I!==null;){if(l=I.alternate,l!==null&&Xh(l)===null){d.child=I;break}l=I.sibling,I.sibling=m,m=I,I=l}sv(d,!0,m,null,k);break;case"together":sv(d,!1,null,null,void 0);break;default:d.memoizedState=null}return d.child}function op(l,d){!(d.mode&1)&&l!==null&&(l.alternate=null,d.alternate=null,d.flags|=2)}function ni(l,d,m){if(l!==null&&(d.dependencies=l.dependencies),Xa|=d.lanes,!(m&d.childLanes))return null;if(l!==null&&d.child!==l.child)throw Error(t(153));if(d.child!==null){for(l=d.child,m=Xi(l,l.pendingProps),d.child=m,m.return=d;l.sibling!==null;)l=l.sibling,m=m.sibling=Xi(l,l.pendingProps),m.return=d;m.sibling=null}return d.child}function C6(l,d,m){switch(d.tag){case 3:xC(d),tc();break;case 5:NP(d);break;case 1:xr(d.type)&&zh(d);break;case 4:Ny(d,d.stateNode.containerInfo);break;case 10:var x=d.type._context,I=d.memoizedProps.value;jt(Vh,x._currentValue),x._currentValue=I;break;case 13:if(x=d.memoizedState,x!==null)return x.dehydrated!==null?(jt(Vt,Vt.current&1),d.flags|=128,null):m&d.child.childLanes?bC(l,d,m):(jt(Vt,Vt.current&1),l=ni(l,d,m),l!==null?l.sibling:null);jt(Vt,Vt.current&1);break;case 19:if(x=(m&d.childLanes)!==0,l.flags&128){if(x)return PC(l,d,m);d.flags|=128}if(I=d.memoizedState,I!==null&&(I.rendering=null,I.tail=null,I.lastEffect=null),jt(Vt,Vt.current),x)break;return null;case 22:case 23:return d.lanes=0,yC(l,d,m)}return ni(l,d,m)}var CC,iv,IC,EC;CC=function(l,d){for(var m=d.child;m!==null;){if(m.tag===5||m.tag===6)l.appendChild(m.stateNode);else if(m.tag!==4&&m.child!==null){m.child.return=m,m=m.child;continue}if(m===d)break;for(;m.sibling===null;){if(m.return===null||m.return===d)return;m=m.return}m.sibling.return=m.return,m=m.sibling}},iv=function(){},IC=function(l,d,m,x){var I=l.memoizedProps;if(I!==x){l=d.stateNode,qa(ys.current);var k=null;switch(m){case"input":I=Ut(l,I),x=Ut(l,x),k=[];break;case"select":I=ae({},I,{value:void 0}),x=ae({},x,{value:void 0}),k=[];break;case"textarea":I=Ra(l,I),x=Ra(l,x),k=[];break;default:typeof I.onClick!="function"&&typeof x.onClick=="function"&&(l.onclick=Fh)}Vs(m,x);var O;m=null;for(se in I)if(!x.hasOwnProperty(se)&&I.hasOwnProperty(se)&&I[se]!=null)if(se==="style"){var z=I[se];for(O in z)z.hasOwnProperty(O)&&(m||(m={}),m[O]="")}else se!=="dangerouslySetInnerHTML"&&se!=="children"&&se!=="suppressContentEditableWarning"&&se!=="suppressHydrationWarning"&&se!=="autoFocus"&&(o.hasOwnProperty(se)?k||(k=[]):(k=k||[]).push(se,null));for(se in x){var W=x[se];if(z=I!=null?I[se]:void 0,x.hasOwnProperty(se)&&W!==z&&(W!=null||z!=null))if(se==="style")if(z){for(O in z)!z.hasOwnProperty(O)||W&&W.hasOwnProperty(O)||(m||(m={}),m[O]="");for(O in W)W.hasOwnProperty(O)&&z[O]!==W[O]&&(m||(m={}),m[O]=W[O])}else m||(k||(k=[]),k.push(se,m)),m=W;else se==="dangerouslySetInnerHTML"?(W=W?W.__html:void 0,z=z?z.__html:void 0,W!=null&&z!==W&&(k=k||[]).push(se,W)):se==="children"?typeof W!="string"&&typeof W!="number"||(k=k||[]).push(se,""+W):se!=="suppressContentEditableWarning"&&se!=="suppressHydrationWarning"&&(o.hasOwnProperty(se)?(W!=null&&se==="onScroll"&&Ft("scroll",l),k||z===W||(k=[])):(k=k||[]).push(se,W))}m&&(k=k||[]).push("style",m);var se=k;(d.updateQueue=se)&&(d.flags|=4)}},EC=function(l,d,m,x){m!==x&&(d.flags|=4)};function $u(l,d){if(!Ht)switch(l.tailMode){case"hidden":d=l.tail;for(var m=null;d!==null;)d.alternate!==null&&(m=d),d=d.sibling;m===null?l.tail=null:m.sibling=null;break;case"collapsed":m=l.tail;for(var x=null;m!==null;)m.alternate!==null&&(x=m),m=m.sibling;x===null?d||l.tail===null?l.tail=null:l.tail.sibling=null:x.sibling=null}}function Bn(l){var d=l.alternate!==null&&l.alternate.child===l.child,m=0,x=0;if(d)for(var I=l.child;I!==null;)m|=I.lanes|I.childLanes,x|=I.subtreeFlags&14680064,x|=I.flags&14680064,I.return=l,I=I.sibling;else for(I=l.child;I!==null;)m|=I.lanes|I.childLanes,x|=I.subtreeFlags,x|=I.flags,I.return=l,I=I.sibling;return l.subtreeFlags|=x,l.childLanes=m,d}function I6(l,d,m){var x=d.pendingProps;switch(ky(d),d.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Bn(d),null;case 1:return xr(d.type)&&$h(),Bn(d),null;case 3:return x=d.stateNode,sc(),Nt(Sr),Nt($n),By(),x.pendingContext&&(x.context=x.pendingContext,x.pendingContext=null),(l===null||l.child===null)&&(Kh(d)?d.flags|=4:l===null||l.memoizedState.isDehydrated&&!(d.flags&256)||(d.flags|=1024,Bo!==null&&(yv(Bo),Bo=null))),iv(l,d),Bn(d),null;case 5:$y(d);var I=qa(Ou.current);if(m=d.type,l!==null&&d.stateNode!=null)IC(l,d,m,x,I),l.ref!==d.ref&&(d.flags|=512,d.flags|=2097152);else{if(!x){if(d.stateNode===null)throw Error(t(166));return Bn(d),null}if(l=qa(ys.current),Kh(d)){x=d.stateNode,m=d.type;var k=d.memoizedProps;switch(x[ms]=d,x[Tu]=k,l=(d.mode&1)!==0,m){case"dialog":Ft("cancel",x),Ft("close",x);break;case"iframe":case"object":case"embed":Ft("load",x);break;case"video":case"audio":for(I=0;I<Iu.length;I++)Ft(Iu[I],x);break;case"source":Ft("error",x);break;case"img":case"image":case"link":Ft("error",x),Ft("load",x);break;case"details":Ft("toggle",x);break;case"input":St(x,k),Ft("invalid",x);break;case"select":x._wrapperState={wasMultiple:!!k.multiple},Ft("invalid",x);break;case"textarea":Tl(x,k),Ft("invalid",x)}Vs(m,k),I=null;for(var O in k)if(k.hasOwnProperty(O)){var z=k[O];O==="children"?typeof z=="string"?x.textContent!==z&&(k.suppressHydrationWarning!==!0&&Lh(x.textContent,z,l),I=["children",z]):typeof z=="number"&&x.textContent!==""+z&&(k.suppressHydrationWarning!==!0&&Lh(x.textContent,z,l),I=["children",""+z]):o.hasOwnProperty(O)&&z!=null&&O==="onScroll"&&Ft("scroll",x)}switch(m){case"input":Xe(x),ls(x,k,!0);break;case"textarea":Xe(x),Al(x);break;case"select":case"option":break;default:typeof k.onClick=="function"&&(x.onclick=Fh)}x=I,d.updateQueue=x,x!==null&&(d.flags|=4)}else{O=I.nodeType===9?I:I.ownerDocument,l==="http://www.w3.org/1999/xhtml"&&(l=jl(m)),l==="http://www.w3.org/1999/xhtml"?m==="script"?(l=O.createElement("div"),l.innerHTML="<script><\/script>",l=l.removeChild(l.firstChild)):typeof x.is=="string"?l=O.createElement(m,{is:x.is}):(l=O.createElement(m),m==="select"&&(O=l,x.multiple?O.multiple=!0:x.size&&(O.size=x.size))):l=O.createElementNS(l,m),l[ms]=d,l[Tu]=x,CC(l,d,!1,!1),d.stateNode=l;e:{switch(O=Br(m,x),m){case"dialog":Ft("cancel",l),Ft("close",l),I=x;break;case"iframe":case"object":case"embed":Ft("load",l),I=x;break;case"video":case"audio":for(I=0;I<Iu.length;I++)Ft(Iu[I],l);I=x;break;case"source":Ft("error",l),I=x;break;case"img":case"image":case"link":Ft("error",l),Ft("load",l),I=x;break;case"details":Ft("toggle",l),I=x;break;case"input":St(l,x),I=Ut(l,x),Ft("invalid",l);break;case"option":I=x;break;case"select":l._wrapperState={wasMultiple:!!x.multiple},I=ae({},x,{value:void 0}),Ft("invalid",l);break;case"textarea":Tl(l,x),I=Ra(l,x),Ft("invalid",l);break;default:I=x}Vs(m,I),z=I;for(k in z)if(z.hasOwnProperty(k)){var W=z[k];k==="style"?ho(l,W):k==="dangerouslySetInnerHTML"?(W=W?W.__html:void 0,W!=null&&Oa(l,W)):k==="children"?typeof W=="string"?(m!=="textarea"||W!=="")&&ie(l,W):typeof W=="number"&&ie(l,""+W):k!=="suppressContentEditableWarning"&&k!=="suppressHydrationWarning"&&k!=="autoFocus"&&(o.hasOwnProperty(k)?W!=null&&k==="onScroll"&&Ft("scroll",l):W!=null&&T(l,k,W,O))}switch(m){case"input":Xe(l),ls(l,x,!1);break;case"textarea":Xe(l),Al(l);break;case"option":x.value!=null&&l.setAttribute("value",""+we(x.value));break;case"select":l.multiple=!!x.multiple,k=x.value,k!=null?uo(l,!!x.multiple,k,!1):x.defaultValue!=null&&uo(l,!!x.multiple,x.defaultValue,!0);break;default:typeof I.onClick=="function"&&(l.onclick=Fh)}switch(m){case"button":case"input":case"select":case"textarea":x=!!x.autoFocus;break e;case"img":x=!0;break e;default:x=!1}}x&&(d.flags|=4)}d.ref!==null&&(d.flags|=512,d.flags|=2097152)}return Bn(d),null;case 6:if(l&&d.stateNode!=null)EC(l,d,l.memoizedProps,x);else{if(typeof x!="string"&&d.stateNode===null)throw Error(t(166));if(m=qa(Ou.current),qa(ys.current),Kh(d)){if(x=d.stateNode,m=d.memoizedProps,x[ms]=d,(k=x.nodeValue!==m)&&(l=Wr,l!==null))switch(l.tag){case 3:Lh(x.nodeValue,m,(l.mode&1)!==0);break;case 5:l.memoizedProps.suppressHydrationWarning!==!0&&Lh(x.nodeValue,m,(l.mode&1)!==0)}k&&(d.flags|=4)}else x=(m.nodeType===9?m:m.ownerDocument).createTextNode(x),x[ms]=d,d.stateNode=x}return Bn(d),null;case 13:if(Nt(Vt),x=d.memoizedState,l===null||l.memoizedState!==null&&l.memoizedState.dehydrated!==null){if(Ht&&Vr!==null&&d.mode&1&&!(d.flags&128))MP(),tc(),d.flags|=98560,k=!1;else if(k=Kh(d),x!==null&&x.dehydrated!==null){if(l===null){if(!k)throw Error(t(318));if(k=d.memoizedState,k=k!==null?k.dehydrated:null,!k)throw Error(t(317));k[ms]=d}else tc(),!(d.flags&128)&&(d.memoizedState=null),d.flags|=4;Bn(d),k=!1}else Bo!==null&&(yv(Bo),Bo=null),k=!0;if(!k)return d.flags&65536?d:null}return d.flags&128?(d.lanes=m,d):(x=x!==null,x!==(l!==null&&l.memoizedState!==null)&&x&&(d.child.flags|=8192,d.mode&1&&(l===null||Vt.current&1?pn===0&&(pn=3):xv())),d.updateQueue!==null&&(d.flags|=4),Bn(d),null);case 4:return sc(),iv(l,d),l===null&&Eu(d.stateNode.containerInfo),Bn(d),null;case 10:return Oy(d.type._context),Bn(d),null;case 17:return xr(d.type)&&$h(),Bn(d),null;case 19:if(Nt(Vt),k=d.memoizedState,k===null)return Bn(d),null;if(x=(d.flags&128)!==0,O=k.rendering,O===null)if(x)$u(k,!1);else{if(pn!==0||l!==null&&l.flags&128)for(l=d.child;l!==null;){if(O=Xh(l),O!==null){for(d.flags|=128,$u(k,!1),x=O.updateQueue,x!==null&&(d.updateQueue=x,d.flags|=4),d.subtreeFlags=0,x=m,m=d.child;m!==null;)k=m,l=x,k.flags&=14680066,O=k.alternate,O===null?(k.childLanes=0,k.lanes=l,k.child=null,k.subtreeFlags=0,k.memoizedProps=null,k.memoizedState=null,k.updateQueue=null,k.dependencies=null,k.stateNode=null):(k.childLanes=O.childLanes,k.lanes=O.lanes,k.child=O.child,k.subtreeFlags=0,k.deletions=null,k.memoizedProps=O.memoizedProps,k.memoizedState=O.memoizedState,k.updateQueue=O.updateQueue,k.type=O.type,l=O.dependencies,k.dependencies=l===null?null:{lanes:l.lanes,firstContext:l.firstContext}),m=m.sibling;return jt(Vt,Vt.current&1|2),d.child}l=l.sibling}k.tail!==null&&Wt()>cc&&(d.flags|=128,x=!0,$u(k,!1),d.lanes=4194304)}else{if(!x)if(l=Xh(O),l!==null){if(d.flags|=128,x=!0,m=l.updateQueue,m!==null&&(d.updateQueue=m,d.flags|=4),$u(k,!0),k.tail===null&&k.tailMode==="hidden"&&!O.alternate&&!Ht)return Bn(d),null}else 2*Wt()-k.renderingStartTime>cc&&m!==1073741824&&(d.flags|=128,x=!0,$u(k,!1),d.lanes=4194304);k.isBackwards?(O.sibling=d.child,d.child=O):(m=k.last,m!==null?m.sibling=O:d.child=O,k.last=O)}return k.tail!==null?(d=k.tail,k.rendering=d,k.tail=d.sibling,k.renderingStartTime=Wt(),d.sibling=null,m=Vt.current,jt(Vt,x?m&1|2:m&1),d):(Bn(d),null);case 22:case 23:return Sv(),x=d.memoizedState!==null,l!==null&&l.memoizedState!==null!==x&&(d.flags|=8192),x&&d.mode&1?Gr&1073741824&&(Bn(d),d.subtreeFlags&6&&(d.flags|=8192)):Bn(d),null;case 24:return null;case 25:return null}throw Error(t(156,d.tag))}function E6(l,d){switch(ky(d),d.tag){case 1:return xr(d.type)&&$h(),l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 3:return sc(),Nt(Sr),Nt($n),By(),l=d.flags,l&65536&&!(l&128)?(d.flags=l&-65537|128,d):null;case 5:return $y(d),null;case 13:if(Nt(Vt),l=d.memoizedState,l!==null&&l.dehydrated!==null){if(d.alternate===null)throw Error(t(340));tc()}return l=d.flags,l&65536?(d.flags=l&-65537|128,d):null;case 19:return Nt(Vt),null;case 4:return sc(),null;case 10:return Oy(d.type._context),null;case 22:case 23:return Sv(),null;case 24:return null;default:return null}}var sp=!1,Un=!1,k6=typeof WeakSet=="function"?WeakSet:Set,Me=null;function ac(l,d){var m=l.ref;if(m!==null)if(typeof m=="function")try{m(null)}catch(x){Jt(l,d,x)}else m.current=null}function av(l,d,m){try{m()}catch(x){Jt(l,d,x)}}var kC=!1;function T6(l,d){if(Sy=X,l=iP(),dy(l)){if("selectionStart"in l)var m={start:l.selectionStart,end:l.selectionEnd};else e:{m=(m=l.ownerDocument)&&m.defaultView||window;var x=m.getSelection&&m.getSelection();if(x&&x.rangeCount!==0){m=x.anchorNode;var I=x.anchorOffset,k=x.focusNode;x=x.focusOffset;try{m.nodeType,k.nodeType}catch{m=null;break e}var O=0,z=-1,W=-1,se=0,ge=0,me=l,fe=null;t:for(;;){for(var Ee;me!==m||I!==0&&me.nodeType!==3||(z=O+I),me!==k||x!==0&&me.nodeType!==3||(W=O+x),me.nodeType===3&&(O+=me.nodeValue.length),(Ee=me.firstChild)!==null;)fe=me,me=Ee;for(;;){if(me===l)break t;if(fe===m&&++se===I&&(z=O),fe===k&&++ge===x&&(W=O),(Ee=me.nextSibling)!==null)break;me=fe,fe=me.parentNode}me=Ee}m=z===-1||W===-1?null:{start:z,end:W}}else m=null}m=m||{start:0,end:0}}else m=null;for(xy={focusedElem:l,selectionRange:m},X=!1,Me=d;Me!==null;)if(d=Me,l=d.child,(d.subtreeFlags&1028)!==0&&l!==null)l.return=d,Me=l;else for(;Me!==null;){d=Me;try{var je=d.alternate;if(d.flags&1024)switch(d.tag){case 0:case 11:case 15:break;case 1:if(je!==null){var De=je.memoizedProps,rn=je.memoizedState,J=d.stateNode,Y=J.getSnapshotBeforeUpdate(d.elementType===d.type?De:Uo(d.type,De),rn);J.__reactInternalSnapshotBeforeUpdate=Y}break;case 3:var ne=d.stateNode.containerInfo;ne.nodeType===1?ne.textContent="":ne.nodeType===9&&ne.documentElement&&ne.removeChild(ne.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(ve){Jt(d,d.return,ve)}if(l=d.sibling,l!==null){l.return=d.return,Me=l;break}Me=d.return}return je=kC,kC=!1,je}function zu(l,d,m){var x=d.updateQueue;if(x=x!==null?x.lastEffect:null,x!==null){var I=x=x.next;do{if((I.tag&l)===l){var k=I.destroy;I.destroy=void 0,k!==void 0&&av(d,m,k)}I=I.next}while(I!==x)}}function ip(l,d){if(d=d.updateQueue,d=d!==null?d.lastEffect:null,d!==null){var m=d=d.next;do{if((m.tag&l)===l){var x=m.create;m.destroy=x()}m=m.next}while(m!==d)}}function lv(l){var d=l.ref;if(d!==null){var m=l.stateNode;switch(l.tag){case 5:l=m;break;default:l=m}typeof d=="function"?d(l):d.current=l}}function TC(l){var d=l.alternate;d!==null&&(l.alternate=null,TC(d)),l.child=null,l.deletions=null,l.sibling=null,l.tag===5&&(d=l.stateNode,d!==null&&(delete d[ms],delete d[Tu],delete d[Py],delete d[d6],delete d[h6])),l.stateNode=null,l.return=null,l.dependencies=null,l.memoizedProps=null,l.memoizedState=null,l.pendingProps=null,l.stateNode=null,l.updateQueue=null}function MC(l){return l.tag===5||l.tag===3||l.tag===4}function AC(l){e:for(;;){for(;l.sibling===null;){if(l.return===null||MC(l.return))return null;l=l.return}for(l.sibling.return=l.return,l=l.sibling;l.tag!==5&&l.tag!==6&&l.tag!==18;){if(l.flags&2||l.child===null||l.tag===4)continue e;l.child.return=l,l=l.child}if(!(l.flags&2))return l.stateNode}}function cv(l,d,m){var x=l.tag;if(x===5||x===6)l=l.stateNode,d?m.nodeType===8?m.parentNode.insertBefore(l,d):m.insertBefore(l,d):(m.nodeType===8?(d=m.parentNode,d.insertBefore(l,m)):(d=m,d.appendChild(l)),m=m._reactRootContainer,m!=null||d.onclick!==null||(d.onclick=Fh));else if(x!==4&&(l=l.child,l!==null))for(cv(l,d,m),l=l.sibling;l!==null;)cv(l,d,m),l=l.sibling}function uv(l,d,m){var x=l.tag;if(x===5||x===6)l=l.stateNode,d?m.insertBefore(l,d):m.appendChild(l);else if(x!==4&&(l=l.child,l!==null))for(uv(l,d,m),l=l.sibling;l!==null;)uv(l,d,m),l=l.sibling}var _n=null,Ho=!1;function Wi(l,d,m){for(m=m.child;m!==null;)jC(l,d,m),m=m.sibling}function jC(l,d,m){if(go&&typeof go.onCommitFiberUnmount=="function")try{go.onCommitFiberUnmount(Nl,m)}catch{}switch(m.tag){case 5:Un||ac(m,d);case 6:var x=_n,I=Ho;_n=null,Wi(l,d,m),_n=x,Ho=I,_n!==null&&(Ho?(l=_n,m=m.stateNode,l.nodeType===8?l.parentNode.removeChild(m):l.removeChild(m)):_n.removeChild(m.stateNode));break;case 18:_n!==null&&(Ho?(l=_n,m=m.stateNode,l.nodeType===8?_y(l.parentNode,m):l.nodeType===1&&_y(l,m),Ua(l)):_y(_n,m.stateNode));break;case 4:x=_n,I=Ho,_n=m.stateNode.containerInfo,Ho=!0,Wi(l,d,m),_n=x,Ho=I;break;case 0:case 11:case 14:case 15:if(!Un&&(x=m.updateQueue,x!==null&&(x=x.lastEffect,x!==null))){I=x=x.next;do{var k=I,O=k.destroy;k=k.tag,O!==void 0&&(k&2||k&4)&&av(m,d,O),I=I.next}while(I!==x)}Wi(l,d,m);break;case 1:if(!Un&&(ac(m,d),x=m.stateNode,typeof x.componentWillUnmount=="function"))try{x.props=m.memoizedProps,x.state=m.memoizedState,x.componentWillUnmount()}catch(z){Jt(m,d,z)}Wi(l,d,m);break;case 21:Wi(l,d,m);break;case 22:m.mode&1?(Un=(x=Un)||m.memoizedState!==null,Wi(l,d,m),Un=x):Wi(l,d,m);break;default:Wi(l,d,m)}}function RC(l){var d=l.updateQueue;if(d!==null){l.updateQueue=null;var m=l.stateNode;m===null&&(m=l.stateNode=new k6),d.forEach(function(x){var I=N6.bind(null,l,x);m.has(x)||(m.add(x),x.then(I,I))})}}function Ko(l,d){var m=d.deletions;if(m!==null)for(var x=0;x<m.length;x++){var I=m[x];try{var k=l,O=d,z=O;e:for(;z!==null;){switch(z.tag){case 5:_n=z.stateNode,Ho=!1;break e;case 3:_n=z.stateNode.containerInfo,Ho=!0;break e;case 4:_n=z.stateNode.containerInfo,Ho=!0;break e}z=z.return}if(_n===null)throw Error(t(160));jC(k,O,I),_n=null,Ho=!1;var W=I.alternate;W!==null&&(W.return=null),I.return=null}catch(se){Jt(I,d,se)}}if(d.subtreeFlags&12854)for(d=d.child;d!==null;)OC(d,l),d=d.sibling}function OC(l,d){var m=l.alternate,x=l.flags;switch(l.tag){case 0:case 11:case 14:case 15:if(Ko(d,l),Ss(l),x&4){try{zu(3,l,l.return),ip(3,l)}catch(De){Jt(l,l.return,De)}try{zu(5,l,l.return)}catch(De){Jt(l,l.return,De)}}break;case 1:Ko(d,l),Ss(l),x&512&&m!==null&&ac(m,m.return);break;case 5:if(Ko(d,l),Ss(l),x&512&&m!==null&&ac(m,m.return),l.flags&32){var I=l.stateNode;try{ie(I,"")}catch(De){Jt(l,l.return,De)}}if(x&4&&(I=l.stateNode,I!=null)){var k=l.memoizedProps,O=m!==null?m.memoizedProps:k,z=l.type,W=l.updateQueue;if(l.updateQueue=null,W!==null)try{z==="input"&&k.type==="radio"&&k.name!=null&&It(I,k),Br(z,O);var se=Br(z,k);for(O=0;O<W.length;O+=2){var ge=W[O],me=W[O+1];ge==="style"?ho(I,me):ge==="dangerouslySetInnerHTML"?Oa(I,me):ge==="children"?ie(I,me):T(I,ge,me,se)}switch(z){case"input":tr(I,k);break;case"textarea":Ml(I,k);break;case"select":var fe=I._wrapperState.wasMultiple;I._wrapperState.wasMultiple=!!k.multiple;var Ee=k.value;Ee!=null?uo(I,!!k.multiple,Ee,!1):fe!==!!k.multiple&&(k.defaultValue!=null?uo(I,!!k.multiple,k.defaultValue,!0):uo(I,!!k.multiple,k.multiple?[]:"",!1))}I[Tu]=k}catch(De){Jt(l,l.return,De)}}break;case 6:if(Ko(d,l),Ss(l),x&4){if(l.stateNode===null)throw Error(t(162));I=l.stateNode,k=l.memoizedProps;try{I.nodeValue=k}catch(De){Jt(l,l.return,De)}}break;case 3:if(Ko(d,l),Ss(l),x&4&&m!==null&&m.memoizedState.isDehydrated)try{Ua(d.containerInfo)}catch(De){Jt(l,l.return,De)}break;case 4:Ko(d,l),Ss(l);break;case 13:Ko(d,l),Ss(l),I=l.child,I.flags&8192&&(k=I.memoizedState!==null,I.stateNode.isHidden=k,!k||I.alternate!==null&&I.alternate.memoizedState!==null||(pv=Wt())),x&4&&RC(l);break;case 22:if(ge=m!==null&&m.memoizedState!==null,l.mode&1?(Un=(se=Un)||ge,Ko(d,l),Un=se):Ko(d,l),Ss(l),x&8192){if(se=l.memoizedState!==null,(l.stateNode.isHidden=se)&&!ge&&l.mode&1)for(Me=l,ge=l.child;ge!==null;){for(me=Me=ge;Me!==null;){switch(fe=Me,Ee=fe.child,fe.tag){case 0:case 11:case 14:case 15:zu(4,fe,fe.return);break;case 1:ac(fe,fe.return);var je=fe.stateNode;if(typeof je.componentWillUnmount=="function"){x=fe,m=fe.return;try{d=x,je.props=d.memoizedProps,je.state=d.memoizedState,je.componentWillUnmount()}catch(De){Jt(x,m,De)}}break;case 5:ac(fe,fe.return);break;case 22:if(fe.memoizedState!==null){FC(me);continue}}Ee!==null?(Ee.return=fe,Me=Ee):FC(me)}ge=ge.sibling}e:for(ge=null,me=l;;){if(me.tag===5){if(ge===null){ge=me;try{I=me.stateNode,se?(k=I.style,typeof k.setProperty=="function"?k.setProperty("display","none","important"):k.display="none"):(z=me.stateNode,W=me.memoizedProps.style,O=W!=null&&W.hasOwnProperty("display")?W.display:null,z.style.display=_t("display",O))}catch(De){Jt(l,l.return,De)}}}else if(me.tag===6){if(ge===null)try{me.stateNode.nodeValue=se?"":me.memoizedProps}catch(De){Jt(l,l.return,De)}}else if((me.tag!==22&&me.tag!==23||me.memoizedState===null||me===l)&&me.child!==null){me.child.return=me,me=me.child;continue}if(me===l)break e;for(;me.sibling===null;){if(me.return===null||me.return===l)break e;ge===me&&(ge=null),me=me.return}ge===me&&(ge=null),me.sibling.return=me.return,me=me.sibling}}break;case 19:Ko(d,l),Ss(l),x&4&&RC(l);break;case 21:break;default:Ko(d,l),Ss(l)}}function Ss(l){var d=l.flags;if(d&2){try{e:{for(var m=l.return;m!==null;){if(MC(m)){var x=m;break e}m=m.return}throw Error(t(160))}switch(x.tag){case 5:var I=x.stateNode;x.flags&32&&(ie(I,""),x.flags&=-33);var k=AC(l);uv(l,k,I);break;case 3:case 4:var O=x.stateNode.containerInfo,z=AC(l);cv(l,z,O);break;default:throw Error(t(161))}}catch(W){Jt(l,l.return,W)}l.flags&=-3}d&4096&&(l.flags&=-4097)}function M6(l,d,m){Me=l,DC(l)}function DC(l,d,m){for(var x=(l.mode&1)!==0;Me!==null;){var I=Me,k=I.child;if(I.tag===22&&x){var O=I.memoizedState!==null||sp;if(!O){var z=I.alternate,W=z!==null&&z.memoizedState!==null||Un;z=sp;var se=Un;if(sp=O,(Un=W)&&!se)for(Me=I;Me!==null;)O=Me,W=O.child,O.tag===22&&O.memoizedState!==null?NC(I):W!==null?(W.return=O,Me=W):NC(I);for(;k!==null;)Me=k,DC(k),k=k.sibling;Me=I,sp=z,Un=se}LC(l)}else I.subtreeFlags&8772&&k!==null?(k.return=I,Me=k):LC(l)}}function LC(l){for(;Me!==null;){var d=Me;if(d.flags&8772){var m=d.alternate;try{if(d.flags&8772)switch(d.tag){case 0:case 11:case 15:Un||ip(5,d);break;case 1:var x=d.stateNode;if(d.flags&4&&!Un)if(m===null)x.componentDidMount();else{var I=d.elementType===d.type?m.memoizedProps:Uo(d.type,m.memoizedProps);x.componentDidUpdate(I,m.memoizedState,x.__reactInternalSnapshotBeforeUpdate)}var k=d.updateQueue;k!==null&&FP(d,k,x);break;case 3:var O=d.updateQueue;if(O!==null){if(m=null,d.child!==null)switch(d.child.tag){case 5:m=d.child.stateNode;break;case 1:m=d.child.stateNode}FP(d,O,m)}break;case 5:var z=d.stateNode;if(m===null&&d.flags&4){m=z;var W=d.memoizedProps;switch(d.type){case"button":case"input":case"select":case"textarea":W.autoFocus&&m.focus();break;case"img":W.src&&(m.src=W.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(d.memoizedState===null){var se=d.alternate;if(se!==null){var ge=se.memoizedState;if(ge!==null){var me=ge.dehydrated;me!==null&&Ua(me)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Un||d.flags&512&&lv(d)}catch(fe){Jt(d,d.return,fe)}}if(d===l){Me=null;break}if(m=d.sibling,m!==null){m.return=d.return,Me=m;break}Me=d.return}}function FC(l){for(;Me!==null;){var d=Me;if(d===l){Me=null;break}var m=d.sibling;if(m!==null){m.return=d.return,Me=m;break}Me=d.return}}function NC(l){for(;Me!==null;){var d=Me;try{switch(d.tag){case 0:case 11:case 15:var m=d.return;try{ip(4,d)}catch(W){Jt(d,m,W)}break;case 1:var x=d.stateNode;if(typeof x.componentDidMount=="function"){var I=d.return;try{x.componentDidMount()}catch(W){Jt(d,I,W)}}var k=d.return;try{lv(d)}catch(W){Jt(d,k,W)}break;case 5:var O=d.return;try{lv(d)}catch(W){Jt(d,O,W)}}}catch(W){Jt(d,d.return,W)}if(d===l){Me=null;break}var z=d.sibling;if(z!==null){z.return=d.return,Me=z;break}Me=d.return}}var A6=Math.ceil,ap=E.ReactCurrentDispatcher,dv=E.ReactCurrentOwner,xo=E.ReactCurrentBatchConfig,ht=0,yn=null,un=null,Pn=0,Gr=0,lc=zi(0),pn=0,Bu=null,Xa=0,lp=0,hv=0,Uu=null,br=null,pv=0,cc=1/0,ri=null,cp=!1,fv=null,Vi=null,up=!1,Gi=null,dp=0,Hu=0,gv=null,hp=-1,pp=0;function or(){return ht&6?Wt():hp!==-1?hp:hp=Wt()}function qi(l){return l.mode&1?ht&2&&Pn!==0?Pn&-Pn:f6.transition!==null?(pp===0&&(pp=Ph()),pp):(l=ut,l!==0||(l=window.event,l=l===void 0?16:tn(l.type)),l):1}function Wo(l,d,m,x){if(50<Hu)throw Hu=0,gv=null,Error(t(185));$a(l,m,x),(!(ht&2)||l!==yn)&&(l===yn&&(!(ht&2)&&(lp|=m),pn===4&&Yi(l,Pn)),_r(l,x),m===1&&ht===0&&!(d.mode&1)&&(cc=Wt()+500,Bh&&Ui()))}function _r(l,d){var m=l.callbackNode;ny(l,d);var x=Na(l,l===yn?Pn:0);if(x===0)m!==null&&us(m),l.callbackNode=null,l.callbackPriority=0;else if(d=x&-x,l.callbackPriority!==d){if(m!=null&&us(m),d===1)l.tag===0?p6(zC.bind(null,l)):CP(zC.bind(null,l)),c6(function(){!(ht&6)&&Ui()}),m=null;else{switch(Ys(x)){case 1:m=pu;break;case 4:m=Fa;break;case 16:m=Fl;break;case 536870912:m=Lo;break;default:m=Fl}m=qC(m,$C.bind(null,l))}l.callbackPriority=d,l.callbackNode=m}}function $C(l,d){if(hp=-1,pp=0,ht&6)throw Error(t(327));var m=l.callbackNode;if(uc()&&l.callbackNode!==m)return null;var x=Na(l,l===yn?Pn:0);if(x===0)return null;if(x&30||x&l.expiredLanes||d)d=fp(l,x);else{d=x;var I=ht;ht|=2;var k=UC();(yn!==l||Pn!==d)&&(ri=null,cc=Wt()+500,Qa(l,d));do try{O6();break}catch(z){BC(l,z)}while(!0);Ry(),ap.current=k,ht=I,un!==null?d=0:(yn=null,Pn=0,d=pn)}if(d!==0){if(d===2&&(I=fu(l),I!==0&&(x=I,d=mv(l,I))),d===1)throw m=Bu,Qa(l,0),Yi(l,x),_r(l,Wt()),m;if(d===6)Yi(l,x);else{if(I=l.current.alternate,!(x&30)&&!j6(I)&&(d=fp(l,x),d===2&&(k=fu(l),k!==0&&(x=k,d=mv(l,k))),d===1))throw m=Bu,Qa(l,0),Yi(l,x),_r(l,Wt()),m;switch(l.finishedWork=I,l.finishedLanes=x,d){case 0:case 1:throw Error(t(345));case 2:Ja(l,br,ri);break;case 3:if(Yi(l,x),(x&130023424)===x&&(d=pv+500-Wt(),10<d)){if(Na(l,0)!==0)break;if(I=l.suspendedLanes,(I&x)!==x){or(),l.pingedLanes|=l.suspendedLanes&I;break}l.timeoutHandle=by(Ja.bind(null,l,br,ri),d);break}Ja(l,br,ri);break;case 4:if(Yi(l,x),(x&4194240)===x)break;for(d=l.eventTimes,I=-1;0<x;){var O=31-Kr(x);k=1<<O,O=d[O],O>I&&(I=O),x&=~k}if(x=I,x=Wt()-x,x=(120>x?120:480>x?480:1080>x?1080:1920>x?1920:3e3>x?3e3:4320>x?4320:1960*A6(x/1960))-x,10<x){l.timeoutHandle=by(Ja.bind(null,l,br,ri),x);break}Ja(l,br,ri);break;case 5:Ja(l,br,ri);break;default:throw Error(t(329))}}}return _r(l,Wt()),l.callbackNode===m?$C.bind(null,l):null}function mv(l,d){var m=Uu;return l.current.memoizedState.isDehydrated&&(Qa(l,d).flags|=256),l=fp(l,d),l!==2&&(d=br,br=m,d!==null&&yv(d)),l}function yv(l){br===null?br=l:br.push.apply(br,l)}function j6(l){for(var d=l;;){if(d.flags&16384){var m=d.updateQueue;if(m!==null&&(m=m.stores,m!==null))for(var x=0;x<m.length;x++){var I=m[x],k=I.getSnapshot;I=I.value;try{if(!zo(k(),I))return!1}catch{return!1}}}if(m=d.child,d.subtreeFlags&16384&&m!==null)m.return=d,d=m;else{if(d===l)break;for(;d.sibling===null;){if(d.return===null||d.return===l)return!0;d=d.return}d.sibling.return=d.return,d=d.sibling}}return!0}function Yi(l,d){for(d&=~hv,d&=~lp,l.suspendedLanes|=d,l.pingedLanes&=~d,l=l.expirationTimes;0<d;){var m=31-Kr(d),x=1<<m;l[m]=-1,d&=~x}}function zC(l){if(ht&6)throw Error(t(327));uc();var d=Na(l,0);if(!(d&1))return _r(l,Wt()),null;var m=fp(l,d);if(l.tag!==0&&m===2){var x=fu(l);x!==0&&(d=x,m=mv(l,x))}if(m===1)throw m=Bu,Qa(l,0),Yi(l,d),_r(l,Wt()),m;if(m===6)throw Error(t(345));return l.finishedWork=l.current.alternate,l.finishedLanes=d,Ja(l,br,ri),_r(l,Wt()),null}function vv(l,d){var m=ht;ht|=1;try{return l(d)}finally{ht=m,ht===0&&(cc=Wt()+500,Bh&&Ui())}}function Za(l){Gi!==null&&Gi.tag===0&&!(ht&6)&&uc();var d=ht;ht|=1;var m=xo.transition,x=ut;try{if(xo.transition=null,ut=1,l)return l()}finally{ut=x,xo.transition=m,ht=d,!(ht&6)&&Ui()}}function Sv(){Gr=lc.current,Nt(lc)}function Qa(l,d){l.finishedWork=null,l.finishedLanes=0;var m=l.timeoutHandle;if(m!==-1&&(l.timeoutHandle=-1,l6(m)),un!==null)for(m=un.return;m!==null;){var x=m;switch(ky(x),x.tag){case 1:x=x.type.childContextTypes,x!=null&&$h();break;case 3:sc(),Nt(Sr),Nt($n),By();break;case 5:$y(x);break;case 4:sc();break;case 13:Nt(Vt);break;case 19:Nt(Vt);break;case 10:Oy(x.type._context);break;case 22:case 23:Sv()}m=m.return}if(yn=l,un=l=Xi(l.current,null),Pn=Gr=d,pn=0,Bu=null,hv=lp=Xa=0,br=Uu=null,Ga!==null){for(d=0;d<Ga.length;d++)if(m=Ga[d],x=m.interleaved,x!==null){m.interleaved=null;var I=x.next,k=m.pending;if(k!==null){var O=k.next;k.next=I,x.next=O}m.pending=x}Ga=null}return l}function BC(l,d){do{var m=un;try{if(Ry(),Zh.current=tp,Qh){for(var x=Gt.memoizedState;x!==null;){var I=x.queue;I!==null&&(I.pending=null),x=x.next}Qh=!1}if(Ya=0,mn=hn=Gt=null,Du=!1,Lu=0,dv.current=null,m===null||m.return===null){pn=1,Bu=d,un=null;break}e:{var k=l,O=m.return,z=m,W=d;if(d=Pn,z.flags|=32768,W!==null&&typeof W=="object"&&typeof W.then=="function"){var se=W,ge=z,me=ge.tag;if(!(ge.mode&1)&&(me===0||me===11||me===15)){var fe=ge.alternate;fe?(ge.updateQueue=fe.updateQueue,ge.memoizedState=fe.memoizedState,ge.lanes=fe.lanes):(ge.updateQueue=null,ge.memoizedState=null)}var Ee=hC(O);if(Ee!==null){Ee.flags&=-257,pC(Ee,O,z,k,d),Ee.mode&1&&dC(k,se,d),d=Ee,W=se;var je=d.updateQueue;if(je===null){var De=new Set;De.add(W),d.updateQueue=De}else je.add(W);break e}else{if(!(d&1)){dC(k,se,d),xv();break e}W=Error(t(426))}}else if(Ht&&z.mode&1){var rn=hC(O);if(rn!==null){!(rn.flags&65536)&&(rn.flags|=256),pC(rn,O,z,k,d),Ay(ic(W,z));break e}}k=W=ic(W,z),pn!==4&&(pn=2),Uu===null?Uu=[k]:Uu.push(k),k=O;do{switch(k.tag){case 3:k.flags|=65536,d&=-d,k.lanes|=d;var J=cC(k,W,d);LP(k,J);break e;case 1:z=W;var Y=k.type,ne=k.stateNode;if(!(k.flags&128)&&(typeof Y.getDerivedStateFromError=="function"||ne!==null&&typeof ne.componentDidCatch=="function"&&(Vi===null||!Vi.has(ne)))){k.flags|=65536,d&=-d,k.lanes|=d;var ve=uC(k,z,d);LP(k,ve);break e}}k=k.return}while(k!==null)}KC(m)}catch(Le){d=Le,un===m&&m!==null&&(un=m=m.return);continue}break}while(!0)}function UC(){var l=ap.current;return ap.current=tp,l===null?tp:l}function xv(){(pn===0||pn===3||pn===2)&&(pn=4),yn===null||!(Xa&268435455)&&!(lp&268435455)||Yi(yn,Pn)}function fp(l,d){var m=ht;ht|=2;var x=UC();(yn!==l||Pn!==d)&&(ri=null,Qa(l,d));do try{R6();break}catch(I){BC(l,I)}while(!0);if(Ry(),ht=m,ap.current=x,un!==null)throw Error(t(261));return yn=null,Pn=0,pn}function R6(){for(;un!==null;)HC(un)}function O6(){for(;un!==null&&!qm();)HC(un)}function HC(l){var d=GC(l.alternate,l,Gr);l.memoizedProps=l.pendingProps,d===null?KC(l):un=d,dv.current=null}function KC(l){var d=l;do{var m=d.alternate;if(l=d.return,d.flags&32768){if(m=E6(m,d),m!==null){m.flags&=32767,un=m;return}if(l!==null)l.flags|=32768,l.subtreeFlags=0,l.deletions=null;else{pn=6,un=null;return}}else if(m=I6(m,d,Gr),m!==null){un=m;return}if(d=d.sibling,d!==null){un=d;return}un=d=l}while(d!==null);pn===0&&(pn=5)}function Ja(l,d,m){var x=ut,I=xo.transition;try{xo.transition=null,ut=1,D6(l,d,m,x)}finally{xo.transition=I,ut=x}return null}function D6(l,d,m,x){do uc();while(Gi!==null);if(ht&6)throw Error(t(327));m=l.finishedWork;var I=l.finishedLanes;if(m===null)return null;if(l.finishedWork=null,l.finishedLanes=0,m===l.current)throw Error(t(177));l.callbackNode=null,l.callbackPriority=0;var k=m.lanes|m.childLanes;if(ry(l,k),l===yn&&(un=yn=null,Pn=0),!(m.subtreeFlags&2064)&&!(m.flags&2064)||up||(up=!0,qC(Fl,function(){return uc(),null})),k=(m.flags&15990)!==0,m.subtreeFlags&15990||k){k=xo.transition,xo.transition=null;var O=ut;ut=1;var z=ht;ht|=4,dv.current=null,T6(l,m),OC(m,l),t6(xy),X=!!Sy,xy=Sy=null,l.current=m,M6(m),Ym(),ht=z,ut=O,xo.transition=k}else l.current=m;if(up&&(up=!1,Gi=l,dp=I),k=l.pendingLanes,k===0&&(Vi=null),Qm(m.stateNode),_r(l,Wt()),d!==null)for(x=l.onRecoverableError,m=0;m<d.length;m++)I=d[m],x(I.value,{componentStack:I.stack,digest:I.digest});if(cp)throw cp=!1,l=fv,fv=null,l;return dp&1&&l.tag!==0&&uc(),k=l.pendingLanes,k&1?l===gv?Hu++:(Hu=0,gv=l):Hu=0,Ui(),null}function uc(){if(Gi!==null){var l=Ys(dp),d=xo.transition,m=ut;try{if(xo.transition=null,ut=16>l?16:l,Gi===null)var x=!1;else{if(l=Gi,Gi=null,dp=0,ht&6)throw Error(t(331));var I=ht;for(ht|=4,Me=l.current;Me!==null;){var k=Me,O=k.child;if(Me.flags&16){var z=k.deletions;if(z!==null){for(var W=0;W<z.length;W++){var se=z[W];for(Me=se;Me!==null;){var ge=Me;switch(ge.tag){case 0:case 11:case 15:zu(8,ge,k)}var me=ge.child;if(me!==null)me.return=ge,Me=me;else for(;Me!==null;){ge=Me;var fe=ge.sibling,Ee=ge.return;if(TC(ge),ge===se){Me=null;break}if(fe!==null){fe.return=Ee,Me=fe;break}Me=Ee}}}var je=k.alternate;if(je!==null){var De=je.child;if(De!==null){je.child=null;do{var rn=De.sibling;De.sibling=null,De=rn}while(De!==null)}}Me=k}}if(k.subtreeFlags&2064&&O!==null)O.return=k,Me=O;else e:for(;Me!==null;){if(k=Me,k.flags&2048)switch(k.tag){case 0:case 11:case 15:zu(9,k,k.return)}var J=k.sibling;if(J!==null){J.return=k.return,Me=J;break e}Me=k.return}}var Y=l.current;for(Me=Y;Me!==null;){O=Me;var ne=O.child;if(O.subtreeFlags&2064&&ne!==null)ne.return=O,Me=ne;else e:for(O=Y;Me!==null;){if(z=Me,z.flags&2048)try{switch(z.tag){case 0:case 11:case 15:ip(9,z)}}catch(Le){Jt(z,z.return,Le)}if(z===O){Me=null;break e}var ve=z.sibling;if(ve!==null){ve.return=z.return,Me=ve;break e}Me=z.return}}if(ht=I,Ui(),go&&typeof go.onPostCommitFiberRoot=="function")try{go.onPostCommitFiberRoot(Nl,l)}catch{}x=!0}return x}finally{ut=m,xo.transition=d}}return!1}function WC(l,d,m){d=ic(m,d),d=cC(l,d,1),l=Ki(l,d,1),d=or(),l!==null&&($a(l,1,d),_r(l,d))}function Jt(l,d,m){if(l.tag===3)WC(l,l,m);else for(;d!==null;){if(d.tag===3){WC(d,l,m);break}else if(d.tag===1){var x=d.stateNode;if(typeof d.type.getDerivedStateFromError=="function"||typeof x.componentDidCatch=="function"&&(Vi===null||!Vi.has(x))){l=ic(m,l),l=uC(d,l,1),d=Ki(d,l,1),l=or(),d!==null&&($a(d,1,l),_r(d,l));break}}d=d.return}}function L6(l,d,m){var x=l.pingCache;x!==null&&x.delete(d),d=or(),l.pingedLanes|=l.suspendedLanes&m,yn===l&&(Pn&m)===m&&(pn===4||pn===3&&(Pn&130023424)===Pn&&500>Wt()-pv?Qa(l,0):hv|=m),_r(l,d)}function VC(l,d){d===0&&(l.mode&1?(d=ds,ds<<=1,!(ds&130023424)&&(ds=4194304)):d=1);var m=or();l=ei(l,d),l!==null&&($a(l,d,m),_r(l,m))}function F6(l){var d=l.memoizedState,m=0;d!==null&&(m=d.retryLane),VC(l,m)}function N6(l,d){var m=0;switch(l.tag){case 13:var x=l.stateNode,I=l.memoizedState;I!==null&&(m=I.retryLane);break;case 19:x=l.stateNode;break;default:throw Error(t(314))}x!==null&&x.delete(d),VC(l,m)}var GC;GC=function(l,d,m){if(l!==null)if(l.memoizedProps!==d.pendingProps||Sr.current)wr=!0;else{if(!(l.lanes&m)&&!(d.flags&128))return wr=!1,C6(l,d,m);wr=!!(l.flags&131072)}else wr=!1,Ht&&d.flags&1048576&&IP(d,Hh,d.index);switch(d.lanes=0,d.tag){case 2:var x=d.type;op(l,d),l=d.pendingProps;var I=Ql(d,$n.current);oc(d,m),I=Ky(null,d,x,l,I,m);var k=Wy();return d.flags|=1,typeof I=="object"&&I!==null&&typeof I.render=="function"&&I.$$typeof===void 0?(d.tag=1,d.memoizedState=null,d.updateQueue=null,xr(x)?(k=!0,zh(d)):k=!1,d.memoizedState=I.state!==null&&I.state!==void 0?I.state:null,Fy(d),I.updater=np,d.stateNode=I,I._reactInternals=d,Zy(d,x,l,m),d=tv(null,d,x,!0,k,m)):(d.tag=0,Ht&&k&&Ey(d),rr(null,d,I,m),d=d.child),d;case 16:x=d.elementType;e:{switch(op(l,d),l=d.pendingProps,I=x._init,x=I(x._payload),d.type=x,I=d.tag=z6(x),l=Uo(x,l),I){case 0:d=ev(null,d,x,l,m);break e;case 1:d=SC(null,d,x,l,m);break e;case 11:d=fC(null,d,x,l,m);break e;case 14:d=gC(null,d,x,Uo(x.type,l),m);break e}throw Error(t(306,x,""))}return d;case 0:return x=d.type,I=d.pendingProps,I=d.elementType===x?I:Uo(x,I),ev(l,d,x,I,m);case 1:return x=d.type,I=d.pendingProps,I=d.elementType===x?I:Uo(x,I),SC(l,d,x,I,m);case 3:e:{if(xC(d),l===null)throw Error(t(387));x=d.pendingProps,k=d.memoizedState,I=k.element,DP(l,d),Yh(d,x,null,m);var O=d.memoizedState;if(x=O.element,k.isDehydrated)if(k={element:x,isDehydrated:!1,cache:O.cache,pendingSuspenseBoundaries:O.pendingSuspenseBoundaries,transitions:O.transitions},d.updateQueue.baseState=k,d.memoizedState=k,d.flags&256){I=ic(Error(t(423)),d),d=wC(l,d,x,m,I);break e}else if(x!==I){I=ic(Error(t(424)),d),d=wC(l,d,x,m,I);break e}else for(Vr=$i(d.stateNode.containerInfo.firstChild),Wr=d,Ht=!0,Bo=null,m=RP(d,null,x,m),d.child=m;m;)m.flags=m.flags&-3|4096,m=m.sibling;else{if(tc(),x===I){d=ni(l,d,m);break e}rr(l,d,x,m)}d=d.child}return d;case 5:return NP(d),l===null&&My(d),x=d.type,I=d.pendingProps,k=l!==null?l.memoizedProps:null,O=I.children,wy(x,I)?O=null:k!==null&&wy(x,k)&&(d.flags|=32),vC(l,d),rr(l,d,O,m),d.child;case 6:return l===null&&My(d),null;case 13:return bC(l,d,m);case 4:return Ny(d,d.stateNode.containerInfo),x=d.pendingProps,l===null?d.child=nc(d,null,x,m):rr(l,d,x,m),d.child;case 11:return x=d.type,I=d.pendingProps,I=d.elementType===x?I:Uo(x,I),fC(l,d,x,I,m);case 7:return rr(l,d,d.pendingProps,m),d.child;case 8:return rr(l,d,d.pendingProps.children,m),d.child;case 12:return rr(l,d,d.pendingProps.children,m),d.child;case 10:e:{if(x=d.type._context,I=d.pendingProps,k=d.memoizedProps,O=I.value,jt(Vh,x._currentValue),x._currentValue=O,k!==null)if(zo(k.value,O)){if(k.children===I.children&&!Sr.current){d=ni(l,d,m);break e}}else for(k=d.child,k!==null&&(k.return=d);k!==null;){var z=k.dependencies;if(z!==null){O=k.child;for(var W=z.firstContext;W!==null;){if(W.context===x){if(k.tag===1){W=ti(-1,m&-m),W.tag=2;var se=k.updateQueue;if(se!==null){se=se.shared;var ge=se.pending;ge===null?W.next=W:(W.next=ge.next,ge.next=W),se.pending=W}}k.lanes|=m,W=k.alternate,W!==null&&(W.lanes|=m),Dy(k.return,m,d),z.lanes|=m;break}W=W.next}}else if(k.tag===10)O=k.type===d.type?null:k.child;else if(k.tag===18){if(O=k.return,O===null)throw Error(t(341));O.lanes|=m,z=O.alternate,z!==null&&(z.lanes|=m),Dy(O,m,d),O=k.sibling}else O=k.child;if(O!==null)O.return=k;else for(O=k;O!==null;){if(O===d){O=null;break}if(k=O.sibling,k!==null){k.return=O.return,O=k;break}O=O.return}k=O}rr(l,d,I.children,m),d=d.child}return d;case 9:return I=d.type,x=d.pendingProps.children,oc(d,m),I=vo(I),x=x(I),d.flags|=1,rr(l,d,x,m),d.child;case 14:return x=d.type,I=Uo(x,d.pendingProps),I=Uo(x.type,I),gC(l,d,x,I,m);case 15:return mC(l,d,d.type,d.pendingProps,m);case 17:return x=d.type,I=d.pendingProps,I=d.elementType===x?I:Uo(x,I),op(l,d),d.tag=1,xr(x)?(l=!0,zh(d)):l=!1,oc(d,m),aC(d,x,I),Zy(d,x,I,m),tv(null,d,x,!0,l,m);case 19:return PC(l,d,m);case 22:return yC(l,d,m)}throw Error(t(156,d.tag))};function qC(l,d){return _h(l,d)}function $6(l,d,m,x){this.tag=l,this.key=m,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=d,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=x,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wo(l,d,m,x){return new $6(l,d,m,x)}function wv(l){return l=l.prototype,!(!l||!l.isReactComponent)}function z6(l){if(typeof l=="function")return wv(l)?1:0;if(l!=null){if(l=l.$$typeof,l===V)return 11;if(l===H)return 14}return 2}function Xi(l,d){var m=l.alternate;return m===null?(m=wo(l.tag,d,l.key,l.mode),m.elementType=l.elementType,m.type=l.type,m.stateNode=l.stateNode,m.alternate=l,l.alternate=m):(m.pendingProps=d,m.type=l.type,m.flags=0,m.subtreeFlags=0,m.deletions=null),m.flags=l.flags&14680064,m.childLanes=l.childLanes,m.lanes=l.lanes,m.child=l.child,m.memoizedProps=l.memoizedProps,m.memoizedState=l.memoizedState,m.updateQueue=l.updateQueue,d=l.dependencies,m.dependencies=d===null?null:{lanes:d.lanes,firstContext:d.firstContext},m.sibling=l.sibling,m.index=l.index,m.ref=l.ref,m}function gp(l,d,m,x,I,k){var O=2;if(x=l,typeof l=="function")wv(l)&&(O=1);else if(typeof l=="string")O=5;else e:switch(l){case R:return el(m.children,I,k,d);case L:O=8,I|=8;break;case K:return l=wo(12,m,d,I|2),l.elementType=K,l.lanes=k,l;case F:return l=wo(13,m,d,I),l.elementType=F,l.lanes=k,l;case $:return l=wo(19,m,d,I),l.elementType=$,l.lanes=k,l;case G:return mp(m,I,k,d);default:if(typeof l=="object"&&l!==null)switch(l.$$typeof){case D:O=10;break e;case U:O=9;break e;case V:O=11;break e;case H:O=14;break e;case Z:O=16,x=null;break e}throw Error(t(130,l==null?l:typeof l,""))}return d=wo(O,m,d,I),d.elementType=l,d.type=x,d.lanes=k,d}function el(l,d,m,x){return l=wo(7,l,x,d),l.lanes=m,l}function mp(l,d,m,x){return l=wo(22,l,x,d),l.elementType=G,l.lanes=m,l.stateNode={isHidden:!1},l}function bv(l,d,m){return l=wo(6,l,null,d),l.lanes=m,l}function _v(l,d,m){return d=wo(4,l.children!==null?l.children:[],l.key,d),d.lanes=m,d.stateNode={containerInfo:l.containerInfo,pendingChildren:null,implementation:l.implementation},d}function B6(l,d,m,x,I){this.tag=d,this.containerInfo=l,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Bl(0),this.expirationTimes=Bl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Bl(0),this.identifierPrefix=x,this.onRecoverableError=I,this.mutableSourceEagerHydrationData=null}function Pv(l,d,m,x,I,k,O,z,W){return l=new B6(l,d,m,z,W),d===1?(d=1,k===!0&&(d|=8)):d=0,k=wo(3,null,null,d),l.current=k,k.stateNode=l,k.memoizedState={element:x,isDehydrated:m,cache:null,transitions:null,pendingSuspenseBoundaries:null},Fy(k),l}function U6(l,d,m){var x=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:A,key:x==null?null:""+x,children:l,containerInfo:d,implementation:m}}function YC(l){if(!l)return Bi;l=l._reactInternals;e:{if(qs(l)!==l||l.tag!==1)throw Error(t(170));var d=l;do{switch(d.tag){case 3:d=d.stateNode.context;break e;case 1:if(xr(d.type)){d=d.stateNode.__reactInternalMemoizedMergedChildContext;break e}}d=d.return}while(d!==null);throw Error(t(171))}if(l.tag===1){var m=l.type;if(xr(m))return _P(l,m,d)}return d}function XC(l,d,m,x,I,k,O,z,W){return l=Pv(m,x,!0,l,I,k,O,z,W),l.context=YC(null),m=l.current,x=or(),I=qi(m),k=ti(x,I),k.callback=d??null,Ki(m,k,I),l.current.lanes=I,$a(l,I,x),_r(l,x),l}function yp(l,d,m,x){var I=d.current,k=or(),O=qi(I);return m=YC(m),d.context===null?d.context=m:d.pendingContext=m,d=ti(k,O),d.payload={element:l},x=x===void 0?null:x,x!==null&&(d.callback=x),l=Ki(I,d,O),l!==null&&(Wo(l,I,O,k),qh(l,I,O)),O}function vp(l){if(l=l.current,!l.child)return null;switch(l.child.tag){case 5:return l.child.stateNode;default:return l.child.stateNode}}function ZC(l,d){if(l=l.memoizedState,l!==null&&l.dehydrated!==null){var m=l.retryLane;l.retryLane=m!==0&&m<d?m:d}}function Cv(l,d){ZC(l,d),(l=l.alternate)&&ZC(l,d)}function H6(){return null}var QC=typeof reportError=="function"?reportError:function(l){console.error(l)};function Iv(l){this._internalRoot=l}Sp.prototype.render=Iv.prototype.render=function(l){var d=this._internalRoot;if(d===null)throw Error(t(409));yp(l,d,null,null)},Sp.prototype.unmount=Iv.prototype.unmount=function(){var l=this._internalRoot;if(l!==null){this._internalRoot=null;var d=l.containerInfo;Za(function(){yp(null,l,null,null)}),d[Xs]=null}};function Sp(l){this._internalRoot=l}Sp.prototype.unstable_scheduleHydration=function(l){if(l){var d=Ih();l={blockedOn:null,target:l,priority:d};for(var m=0;m<fs.length&&d!==0&&d<fs[m].priority;m++);fs.splice(m,0,l),m===0&&vu(l)}};function Ev(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11)}function xp(l){return!(!l||l.nodeType!==1&&l.nodeType!==9&&l.nodeType!==11&&(l.nodeType!==8||l.nodeValue!==" react-mount-point-unstable "))}function JC(){}function K6(l,d,m,x,I){if(I){if(typeof x=="function"){var k=x;x=function(){var se=vp(O);k.call(se)}}var O=XC(d,x,l,0,null,!1,!1,"",JC);return l._reactRootContainer=O,l[Xs]=O.current,Eu(l.nodeType===8?l.parentNode:l),Za(),O}for(;I=l.lastChild;)l.removeChild(I);if(typeof x=="function"){var z=x;x=function(){var se=vp(W);z.call(se)}}var W=Pv(l,0,!1,null,null,!1,!1,"",JC);return l._reactRootContainer=W,l[Xs]=W.current,Eu(l.nodeType===8?l.parentNode:l),Za(function(){yp(d,W,m,x)}),W}function wp(l,d,m,x,I){var k=m._reactRootContainer;if(k){var O=k;if(typeof I=="function"){var z=I;I=function(){var W=vp(O);z.call(W)}}yp(d,O,l,I)}else O=K6(m,d,l,I,x);return vp(O)}Ch=function(l){switch(l.tag){case 3:var d=l.stateNode;if(d.current.memoizedState.isDehydrated){var m=Oi(d.pendingLanes);m!==0&&(Ul(d,m|1),_r(d,Wt()),!(ht&6)&&(cc=Wt()+500,Ui()))}break;case 13:Za(function(){var x=ei(l,1);if(x!==null){var I=or();Wo(x,l,1,I)}}),Cv(l,1)}},gu=function(l){if(l.tag===13){var d=ei(l,134217728);if(d!==null){var m=or();Wo(d,l,134217728,m)}Cv(l,134217728)}},Fo=function(l){if(l.tag===13){var d=qi(l),m=ei(l,d);if(m!==null){var x=or();Wo(m,l,d,x)}Cv(l,d)}},Ih=function(){return ut},Eh=function(l,d){var m=ut;try{return ut=l,d()}finally{ut=m}},Hr=function(l,d,m){switch(d){case"input":if(tr(l,m),d=m.name,m.type==="radio"&&d!=null){for(m=l;m.parentNode;)m=m.parentNode;for(m=m.querySelectorAll("input[name="+JSON.stringify(""+d)+'][type="radio"]'),d=0;d<m.length;d++){var x=m[d];if(x!==l&&x.form===l.form){var I=Nh(x);if(!I)throw Error(t(90));Zt(x),tr(x,I)}}}break;case"textarea":Ml(l,m);break;case"select":d=m.value,d!=null&&uo(l,!!m.multiple,d,!1)}},Dl=vv,Ll=Za;var W6={usingClientEntryPoint:!1,Events:[Mu,Xl,Nh,Ai,Ol,vv]},Ku={findFiberByHostInstance:Ha,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},V6={bundleType:Ku.bundleType,version:Ku.version,rendererPackageName:Ku.rendererPackageName,rendererConfig:Ku.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(l){return l=wh(l),l===null?null:l.stateNode},findFiberByHostInstance:Ku.findFiberByHostInstance||H6,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var bp=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!bp.isDisabled&&bp.supportsFiber)try{Nl=bp.inject(V6),go=bp}catch{}}return Pr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=W6,Pr.createPortal=function(l,d){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ev(d))throw Error(t(200));return U6(l,d,null,m)},Pr.createRoot=function(l,d){if(!Ev(l))throw Error(t(299));var m=!1,x="",I=QC;return d!=null&&(d.unstable_strictMode===!0&&(m=!0),d.identifierPrefix!==void 0&&(x=d.identifierPrefix),d.onRecoverableError!==void 0&&(I=d.onRecoverableError)),d=Pv(l,1,!1,null,null,m,!1,x,I),l[Xs]=d.current,Eu(l.nodeType===8?l.parentNode:l),new Iv(d)},Pr.findDOMNode=function(l){if(l==null)return null;if(l.nodeType===1)return l;var d=l._reactInternals;if(d===void 0)throw typeof l.render=="function"?Error(t(188)):(l=Object.keys(l).join(","),Error(t(268,l)));return l=wh(d),l=l===null?null:l.stateNode,l},Pr.flushSync=function(l){return Za(l)},Pr.hydrate=function(l,d,m){if(!xp(d))throw Error(t(200));return wp(null,l,d,!0,m)},Pr.hydrateRoot=function(l,d,m){if(!Ev(l))throw Error(t(405));var x=m!=null&&m.hydratedSources||null,I=!1,k="",O=QC;if(m!=null&&(m.unstable_strictMode===!0&&(I=!0),m.identifierPrefix!==void 0&&(k=m.identifierPrefix),m.onRecoverableError!==void 0&&(O=m.onRecoverableError)),d=XC(d,null,l,1,m??null,I,!1,k,O),l[Xs]=d.current,Eu(l),x)for(l=0;l<x.length;l++)m=x[l],I=m._getVersion,I=I(m._source),d.mutableSourceEagerHydrationData==null?d.mutableSourceEagerHydrationData=[m,I]:d.mutableSourceEagerHydrationData.push(m,I);return new Sp(d)},Pr.render=function(l,d,m){if(!xp(d))throw Error(t(200));return wp(null,l,d,!1,m)},Pr.unmountComponentAtNode=function(l){if(!xp(l))throw Error(t(40));return l._reactRootContainer?(Za(function(){wp(null,null,l,!1,function(){l._reactRootContainer=null,l[Xs]=null})}),!0):!1},Pr.unstable_batchedUpdates=vv,Pr.unstable_renderSubtreeIntoContainer=function(l,d,m,x){if(!xp(m))throw Error(t(200));if(l==null||l._reactInternals===void 0)throw Error(t(38));return wp(l,d,m,!1,x)},Pr.version="18.3.1-next-f1338f8080-20240426",Pr}var Lk;function AR(){if(Lk)return W0.exports;Lk=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),W0.exports=LK(),W0.exports}var Ei=AR();const wc=wa(Ei);var Op={},Fk;function FK(){if(Fk)return Op;Fk=1;var n=AR();return Op.createRoot=n.createRoot,Op.hydrateRoot=n.hydrateRoot,Op}var NK=FK();function jR(n,e){const t=new Map;return async function(o){const s=t.get(o);if(s)return s;const i=(async()=>{try{const a=await Ds(o,e);return yt(a.ok),await n(a)}catch(a){return console.error(a),null}})();return t.set(o,i),i}}const Xg=jR(async n=>await Yo.blobToDataUrl(await n.blob())),$K=/@import\s+(?:"([^"]+)"|'([^']+)'|url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\))([^;]+);/gi,zK=/@font-face\s*{([^}]+)}/gi,RR=/url\s*\(\s*(?:"([^"]+)"|'([^']+)'|([^'")]+))\s*\)/gi,BK=/(?:^|;)\s*font-family\s*:\s*(?:([^'"][^;\n]+)|"([^"]+)"|'([^']+)')\s*(?:;|$)/gi;function UK(n){return Array.from(n.matchAll($K),e=>({url:e[1]||e[2]||e[3]||e[4]||e[5],extras:e[6]}))}function OR(n,e){return Array.from(n.matchAll(zK),t=>{const r=t[1],o=Array.from(r.matchAll(RR),i=>{var c;const a=i[1]||i[2]||i[3];return{original:a,resolved:((c=Ge(a,e))==null?void 0:c.href)??null}}),s=new Set(Array.from(r.matchAll(BK),i=>(i[1]||i[2]||i[3]).toLowerCase()));return{fontFace:r,urls:o,fontFamilies:s}})}function HK(n){const e=/\s*(?:([^'"][^;\n\s,]+)|"([^"]+)"|'([^']+)')\s*/gi,t=/\s*,\s*/gi,r=new Set;for(;;){const o=e.exec(n);if(!o)break;const s=o[1]||o[2]||o[3];if(r.add(s.toLowerCase()),t.lastIndex=e.lastIndex,!t.exec(n))break;e.lastIndex=t.lastIndex}return r}function DR(n){return!(n.startsWith("-")||n.startsWith("animation")||n.startsWith("transition")||n==="cursor"||n==="pointer-events"||n==="user-select"||n==="touch-action")}function KK(n,e){return{imports:UK(n),fontFaces:OR(n,e)}}function WK(n){return Array.from(n.matchAll(RR),e=>({original:e[0],url:e[1]||e[2]||e[3]}))}const VK=new Set(["border-collapse","border-spacing","caption-side","color","cursor","direction","empty-cells","font-family","font-size","font-style","font-variant","font-weight","font-size-adjust","font-stretch","font","letter-spacing","line-height","list-style-image","list-style-position","list-style-type","list-style","orphans","quotes","tab-size","text-align","text-align-last","text-decoration-color","text-indent","text-justify","text-shadow","text-transform","visibility","white-space","widows","word-break","word-spacing","word-wrap"]);function LR(n){return VK.has(n)}var GK=Object.create,FR=Object.defineProperty,qK=Object.getOwnPropertyDescriptor,YK=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),NR=n=>{throw TypeError(n)},$R=(n,e,t)=>e in n?FR(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,XK=n=>[,,,GK(null)],zR=["class","method","getter","setter","accessor","field","value","get","set"],BR=n=>n!==void 0&&typeof n!="function"?NR("Function expected"):n,ZK=(n,e,t,r,o)=>({kind:zR[n],name:e,metadata:r,addInitializer:s=>t._?NR("Already initialized"):o.push(BR(s||null))}),QK=(n,e)=>$R(e,YK("metadata"),n[3]),JK=(n,e,t,r)=>{for(var o=0,s=n[e>>1],i=s&&s.length;o<i;o++)s[o].call(t);return r},eW=(n,e,t,r,o,s)=>{for(var i,a,c,u,h=e&7,f=!!(e&8),g=!!(e&16),y=2,v=zR[h+5],S=n[y]||(n[y]=[]),w=(o=o.prototype,qK(o,t)),b=r.length-1;b>=0;b--)c=ZK(h,t,a={},n[3],S),c.static=f,c.private=g,u=c.access={has:_=>t in _},u.get=_=>_[t],i=(0,r[b])(w[v],c),a._=1,BR(i)&&(w[v]=i);return w&&FR(o,t,w),o},Dp=(n,e,t)=>$R(n,typeof e!="symbol"?e+"":e,t),UR,Zg;UR=[Or];class w1{constructor(){JK(Zg,5,this),Dp(this,"fontFacesPromise",null),Dp(this,"foundFontNames",new Set),Dp(this,"fontFacesToEmbed",new Set),Dp(this,"pendingPromises",[])}startFindingCurrentDocumentFontFaces(){yt(!this.fontFacesPromise,"FontEmbedder already started"),this.fontFacesPromise=tW()}onFontFamilyValue(e){yt(this.fontFacesPromise,"FontEmbedder not started");const t=HK(e);for(const r of t){if(this.foundFontNames.has(r))return;this.foundFontNames.add(r),this.pendingPromises.push(this.fontFacesPromise.then(o=>{const s=o.filter(i=>i.fontFamilies.has(r));for(const i of s)if(!this.fontFacesToEmbed.has(i)){this.fontFacesToEmbed.add(i);for(const a of i.urls)!a.resolved||a.embedded||(a.embedded=Xg(a.resolved))}}))}}async createCss(){await Promise.all(this.pendingPromises);let e="";for(const t of this.fontFacesToEmbed){let r=`@font-face {${t.fontFace}}`;for(const o of t.urls){if(!o.embedded)continue;const s=await o.embedded;s&&(r=r.replace(o.original,s))}e+=r}return e}}Zg=XK();eW(Zg,1,"onFontFamilyValue",UR,w1);QK(Zg,w1);async function tW(){const n=[];for(const e of document.styleSheets){let t;try{t=e.cssRules}catch{}if(t)for(const r of e.cssRules)r instanceof CSSFontFaceRule?n.push(OR(r.cssText,e.href??document.baseURI)):r instanceof CSSImportRule&&n.push(vw(r.href));else e.href&&n.push(vw(e.href))}return Ze(await Promise.all(n)).flat()}const vw=jR(async n=>{const e=KK(await n.text(),n.url),t=await Promise.all(e.imports.map(({url:r})=>vw(new URL(r,n.url).href)));return[...e.fontFaces,...Ze(t).flat()]});function HR(n){if(n.shadowRoot)return n.shadowRoot.childNodes;if(sW(n)){const e=n.assignedNodes();if(e!=null&&e.length)return e}return n.childNodes}function*Sw(n){for(const e of HR(n))nW(e)&&(yield e)}function Qg(n){var e;return((e=n.ownerDocument)==null?void 0:e.defaultView)??globalThis}function nW(n){return n instanceof Qg(n).Element}function rW(n){return n instanceof Qg(n).ShadowRoot}function oW(n){return"getRootNode"in n&&rW(n.getRootNode())}function sW(n){return oW(n)&&n instanceof Qg(n).HTMLSlotElement}function iW(n){return n.style}function b1(n,e){return Qg(n).getComputedStyle(n,e)}const cl={};class aW{constructor(e){j(this,"styles",new Map);j(this,"fonts",new w1);this.root=e}readRootElementStyles(e){this.readElementStyles(e,{shouldRespectDefaults:!1,shouldSkipInheritedParentStyles:!1});const t=Array.from(Sw(e));for(;t.length;){const r=t.pop();t.push(...Sw(r)),this.readElementStyles(r,{shouldRespectDefaults:!0,shouldSkipInheritedParentStyles:!0})}}readElementStyles(e,{shouldRespectDefaults:t=!0,shouldSkipInheritedParentStyles:r=!0}){var a;const o=t?dW(e.tagName.toLowerCase()):cl,s=r?((a=this.styles.get(e.parentElement))==null?void 0:a.self)??cl:cl,i={self:lW(e,{defaultStyles:o,parentStyles:s}),before:Nk(e,"::before"),after:Nk(e,"::after")};this.styles.set(e,i)}fetchResources(){const e=[];for(const t of this.styles.values())for(const r of qt(t))if(r)for(const[o,s]of Object.entries(r)){if(!s)continue;o==="font-family"&&this.fonts.onFontFamilyValue(s);const i=WK(s);i.length!==0&&e.push(...i.map(async({url:a,original:c})=>{const u=await Xg(a)??"data:";r[o]=s.replace(c,`url("${u}")`)}))}return Promise.all(e)}unwrapCustomElements(){const e=new Set,t=(r,o)=>{if(e.has(r))return;e.add(r);const s=r.shadowRoot;if(s){const i=document.createElement("div");this.styles.set(i,this.styles.get(r)),i.setAttribute("data-tl-custom-element",r.tagName),(o??r.parentElement).appendChild(i);for(const a of s.childNodes)a instanceof Element?t(a,i):i.appendChild(a.cloneNode(!0));r.remove()}else if(o){if(r.tagName.toLowerCase()==="style")return;const i=r.cloneNode(!1);this.styles.set(i,this.styles.get(r)),o.appendChild(i);for(const a of HR(r))a instanceof Element?t(a,i):i.appendChild(a.cloneNode(!0))}};for(const r of this.styles.keys())t(r,null)}embedStyles(){let e="";for(const[t,r]of this.styles){if(r.after||r.before){const s=`pseudo-${bt()}`;t.classList.add(s),r.before&&(e+=`.${s}::before {${$k(r.before)}}
`),r.after&&(e+=`.${s}::after {${$k(r.after)}}
`)}const o=iW(t);for(const[s,i]of Object.entries(r.self))i&&o.setProperty(s,i);o.fontKerning==="auto"&&(o.fontKerning="normal")}return e}async getFontFaceCss(){return await this.fonts.createCss()}dispose(){uW()}}function lW(n,{defaultStyles:e,parentStyles:t}){return n.computedStyleMap?KR(n.computedStyleMap(),{defaultStyles:e,parentStyles:t}):_1(b1(n),{defaultStyles:e,parentStyles:t})}function Nk(n,e){const t=b1(n,e),r=t.getPropertyValue("content");if(!(r===""||r==="none"))return _1(t,{defaultStyles:cl,parentStyles:cl})}function KR(n,{defaultStyles:e,parentStyles:t}){const r={};for(const o of n.keys()){if(!DR(o))continue;const s=n.get(o).toString();e[o]!==s&&(t[o]===s&&LR(o)||(r[o]=s))}return r}function _1(n,{defaultStyles:e,parentStyles:t}){const r={};for(const o of n){if(!DR(o))continue;const s=n.getPropertyValue(o);e[o]!==s&&(t[o]===s&&LR(o)||(r[o]=s))}return r}function $k(n){let e="";for(const[t,r]of Object.entries(n))e+=`${t}: ${r};`;return e}let Fc;const zk={};function cW(){if(!Fc){const n=document.createElement("iframe");n.style.display="none",document.body.appendChild(n);const e=Mr(n.contentDocument,"frame must have a document"),t=document.createElementNS("http://www.w3.org/2000/svg","svg"),r=document.createElementNS("http://www.w3.org/2000/svg","foreignObject");t.appendChild(r),e.body.appendChild(t),Fc={iframe:n,foreignObject:r,document:e}}return Fc}function uW(){Fc&&(document.body.removeChild(Fc.iframe),Fc=void 0)}const Bk={defaultStyles:cl,parentStyles:cl};function dW(n){let e=zk[n];if(!e){const{foreignObject:t,document:r}=cW(),o=r.createElement(n);t.appendChild(o),e=o.computedStyleMap?KR(o.computedStyleMap(),Bk):_1(b1(o),Bk),t.removeChild(o),zk[n]=e}return e}function hW(n,e){Array.from(n.attributes).forEach(r=>{e.setAttribute(r.name,r.value)})}function Uk(n,e){return n.replaceWith(e),e}async function bd(n,e){const t=document.createElement("img");e&&hW(e,t),t.setAttribute("src",n??"data:"),t.setAttribute("decoding","sync"),t.setAttribute("loading","eager");try{await t.decode()}catch{}return t}async function pW(n){try{const e=n.toDataURL();return await bd(e,n)}catch{return await bd(null,n)}}async function fW(n){try{const e=await Zr.getVideoFrameAsDataUrl(n);return bd(e,n)}catch(e){console.error("Could not get video frame",e)}if(n.poster){const e=await Xg(n.poster);return bd(e,n)}return bd(null,n)}async function WR(n){if(n instanceof HTMLCanvasElement)return Uk(n,await pW(n));if(n instanceof HTMLVideoElement)return Uk(n,await fW(n));if(n instanceof HTMLImageElement){const e=n.currentSrc||n.src,t=await Xg(e);n.setAttribute("src",t??"data:"),n.setAttribute("decoding","sync"),n.setAttribute("loading","eager");try{await n.decode()}catch{}return n}else n instanceof HTMLInputElement?n.setAttribute("value",n.value):n instanceof HTMLTextAreaElement&&(n.textContent=n.value);await Promise.all(Array.from(Sw(n),e=>WR(e)))}function Jg(n){const e=C.useRef();return C.useLayoutEffect(()=>{e.current=n}),C.useDebugValue(n),C.useCallback((...t)=>{const r=e.current;return yt(r,"fn does not exist"),r(...t)},[])}const P1=C.createContext(null);function gW({context:n,editor:e,children:t}){const r=e.options.exportProvider;return p.jsx(l1,{editor:e,children:p.jsx(Gj,{container:e.getContainer(),children:p.jsx(P1.Provider,{value:n,children:p.jsx(r,{children:t})})})})}function rh(){return C.useContext(P1)}function mW(){const n=C.useContext(P1),[e]=C.useState(Pb);return C.useEffect(()=>(n==null||n.waitUntil(e),()=>{e.resolve()}),[e,n]),Jg(()=>{e.resolve()})}var yW=Object.create,VR=Object.defineProperty,vW=Object.getOwnPropertyDescriptor,SW=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),GR=n=>{throw TypeError(n)},qR=(n,e,t)=>e in n?VR(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,xW=n=>[,,,yW(null)],YR=["class","method","getter","setter","accessor","field","value","get","set"],XR=n=>n!==void 0&&typeof n!="function"?GR("Function expected"):n,wW=(n,e,t,r,o)=>({kind:YR[n],name:e,metadata:r,addInitializer:s=>t._?GR("Already initialized"):o.push(XR(s||null))}),bW=(n,e)=>qR(e,SW("metadata"),n[3]),_W=(n,e,t,r)=>{for(var o=0,s=n[e>>1],i=s&&s.length;o<i;o++)s[o].call(t);return r},PW=(n,e,t,r,o,s)=>{for(var i,a,c,u,h=e&7,f=!!(e&8),g=!!(e&16),y=2,v=YR[h+5],S=n[y]||(n[y]=[]),w=(o=o.prototype,vW(o,t)),b=r.length-1;b>=0;b--)c=wW(h,t,a={},n[3],S),c.static=f,c.private=g,u=c.access={has:_=>t in _},u.get=_=>_[t],i=(0,r[b])(w[v],c),a._=1,XR(i)&&(w[v]=i);return w&&VR(o,t,w),o},Hk=(n,e,t)=>qR(n,typeof e!="symbol"?e+"":e,t),ZR,em;ZR=[Or];class C1{constructor(e){this.maxDelayTimeMs=e,_W(em,5,this),Hk(this,"isResolved",!1),Hk(this,"promisesToWaitFor",[])}waitUntil(e){if(this.isResolved)throw new Error("Cannot `waitUntil` - the export has already been resolved. Make sure to call `waitUntil` as soon as possible during an export - ie within the first react effect after rendering.");this.promisesToWaitFor.push(e.catch(t=>console.error("Error whilst waiting for export:",t)))}async resolvePromises(){let e=null;for(;this.promisesToWaitFor.length!==e;)e=this.promisesToWaitFor.length,await Promise.allSettled(this.promisesToWaitFor),await Jx(0)}async resolve(){const e=Jx(this.maxDelayTimeMs).then(()=>"timeout"),t=this.resolvePromises().then(()=>"resolved");await Promise.race([e,t])==="timeout"&&console.warn("[tldraw] Export delay timed out after ${this.maxDelayTimeMs}ms"),this.isResolved=!0}}em=xW();PW(em,1,"waitUntil",ZR,C1);bW(em,C1);function CW(n,e,t={}){var b,_;if(!window.document)throw Error("No document");const{scale:r=1,background:o=!1,padding:s=n.options.defaultSvgPadding,preserveAspectRatio:i}=t,a=t.darkMode??n.user.getIsDarkMode(),c=n.getShapeAndDescendantIds(e),u=n.getUnorderedRenderingShapes(!1).filter(({id:T})=>c.has(T));let h=null;if(t.bounds)h=t.bounds;else for(const{id:T}of u){const E=n.getShapeMaskedPageBounds(T);E&&(h?h.union(E):h=E.clone())}if(!h)return;const f=e.length===1&&n.isShapeOfType(n.getShape(e[0]),"frame")?e[0]:null;f||h.expandBy(s);const g=h.width*r,y=h.height*r;try{(_=(b=document.body).focus)==null||_.call(b)}catch{}const v=new C1(n.options.maxExportDelayMs),S=Pb();return v.waitUntil(S),{jsx:p.jsx(IW,{editor:n,preserveAspectRatio:i,scale:r,bbox:h,background:o,singleFrameShapeId:f,isDarkMode:a,renderingShapes:u,onMount:S.resolve,waitUntil:v.waitUntil}),width:g,height:y,exportDelay:v}}function IW({editor:n,preserveAspectRatio:e,scale:t,bbox:r,background:o,singleFrameShapeId:s,isDarkMode:i,renderingShapes:a,onMount:c,waitUntil:u}){const h=nu(),f=Ii({isDarkMode:i}),g=Gb("export state",{defsById:{},shapeElements:null}),{defsById:y,shapeElements:v}=re(g),S=Jg(_=>{g.update(T=>{if(Qo(T.defsById,_.key))return T;const E=Promise.resolve(_.getElement());return u(E.then(M=>{g.update(A=>({...A,defsById:{...A.defsById,[_.key]:{pending:!1,element:M}}}))})),{...T,defsById:{...T.defsById,[_.key]:{pending:!0,element:E}}}})}),w=C.useMemo(()=>({isDarkMode:i,waitUntil:u,addExportDef:S}),[i,u,S]),b=C.useRef(!1);return C.useLayoutEffect(()=>{if(b.current)throw new Error("SvgExport should only render once - do not use with react strict mode");b.current=!0,(async()=>{const _={},T=a.map(async({id:M,opacity:A,index:R,backgroundIndex:L})=>{var V,F;if(M===s)return[];const K=n.getShape(M);if(n.isShapeOfType(K,"group"))return[];const D=[],U=n.getShapeUtil(K);if(U.toSvg||U.toBackgroundSvg){const[$,H]=await Promise.all([(V=U.toSvg)==null?void 0:V.call(U,K,w),(F=U.toBackgroundSvg)==null?void 0:F.call(U,K,w)]),Z=n.getShapePageTransform(K);let G=Z.toCssString(),q=1;"scale"in K.props&&K.props.scale!==1&&(q=K.props.scale,G=`${G} scale(${K.props.scale}, ${K.props.scale})`);const Q=n.getShapeMask(K.id),ae=Q?ye.From(ye.Inverse(Z)).applyToPoints(Q):null,B=i1(h,K.id);ae&&(_[B]={pending:!1,element:p.jsx("clipPath",{id:B,children:p.jsx("path",{d:`M${ae.map(({x:oe,y:pe})=>`${oe/q},${pe/q}`).join("L")}Z`})})}),$&&D.push({zIndex:R,element:p.jsx("g",{transform:G,opacity:A,clipPath:Q?`url(#${B})`:void 0,children:$},`fg_${K.id}`)}),H&&D.push({zIndex:L,element:p.jsx("g",{transform:G,opacity:A,clipPath:Q?`url(#${B})`:void 0,children:H},`bg_${K.id}`)})}else D.push({zIndex:R,element:p.jsx(Kk,{shape:K,util:U,component:aR,className:"tl-shape",bbox:r,opacity:A},`fg_${K.id}`)}),U.backgroundComponent&&D.push({zIndex:L,element:p.jsx(Kk,{shape:K,util:U,component:lR,className:"tl-shape tl-shape-background",bbox:r,opacity:A},`bg_${K.id}`)});return D}),E=(await Promise.all(T)).flat();Ei.flushSync(()=>{g.update(M=>({...M,shapeElements:E.sort((A,R)=>A.zIndex-R.zIndex).map(({element:A})=>A),defsById:{...M.defsById,..._}}))})})()},[r,n,w,h,a,s,g]),C.useEffect(()=>{v!==null&&c()},[c,v]),p.jsx(gW,{editor:n,context:w,children:p.jsxs("svg",{preserveAspectRatio:e,direction:"ltr",width:r.width*t,height:r.height*t,viewBox:`${r.minX} ${r.minY} ${r.width} ${r.height}`,strokeLinecap:"round",strokeLinejoin:"round",style:{backgroundColor:o?s?f.solid:f.background:"transparent"},"data-color-mode":i?"dark":"light",className:`tl-container tl-theme__force-sRGB ${i?"tl-theme__dark":"tl-theme__light"}`,children:[p.jsx("defs",{children:Object.entries(y).map(([_,T])=>T.pending?null:p.jsx(C.Fragment,{children:T.element},_))}),v]})})}function Kk({shape:n,util:e,className:t,component:r,bbox:o,opacity:s}){const i=te(),a=ye.Translate(-o.minX,-o.minY).multiply(i.getShapePageTransform(n.id)),c=i.getShapeGeometry(n.id).bounds,u=Math.max(c.width,1),h=Math.max(c.height,1);return p.jsx(s1,{fallback:()=>null,children:p.jsx("foreignObject",{x:o.minX,y:o.minY,width:o.w,height:o.h,className:"tl-shape-foreign-object",children:p.jsx("div",{className:t,"data-shape-type":n.type,style:{clipPath:i.getShapeClipPath(n.id),transform:a.toCssString(),width:u,height:h,opacity:s},children:p.jsx(r,{shape:n,util:e})})})})}let EW=1;async function kW(n,e,t={}){const r=CW(n,e,t);if(!r)return;const o=n.getContainer(),s=document.createElement("div");s.className="tldraw-svg-export",s.inert=!0,s.tabIndex=-1,Object.assign(s.style,{position:"absolute",top:"0px",left:"0px",width:r.width+"px",height:r.height+"px",pointerEvents:"none",opacity:0}),o.appendChild(s);const i=NK.createRoot(s,{identifierPrefix:`export_${EW++}_`});try{await Promise.resolve(),Ei.flushSync(()=>{i.render(r.jsx)}),await r.exportDelay.resolve();const a=s.firstElementChild;return yt(a instanceof SVGSVGElement,"Expected an SVG element"),await TW(a),{svg:a,width:r.width,height:r.height}}finally{setTimeout(()=>{i.unmount(),o.removeChild(s)},0)}}async function TW(n){const e=[...n.querySelectorAll("foreignObject.tl-shape-foreign-object > *")];if(!e.length)return;const t=new aW(n);try{t.fonts.startFindingCurrentDocumentFontFaces(),await Promise.all(e.map(s=>WR(s)));for(const s of e)t.readRootElementStyles(s);await t.fetchResources();const r=await t.getFontFaceCss();t.unwrapCustomElements();const o=t.embedStyles();if(r||o){const s=document.createElementNS("http://www.w3.org/2000/svg","style");s.textContent=`${r}
${o}`,n.prepend(s)}}finally{t.dispose()}}const Go={menus:dn("open menus",[]),getOpenMenus(n){return n?this.menus.get().filter(e=>e.endsWith("-"+n)):this.menus.get()},addOpenMenu(n,e=""){const t=e?`${n}-${e}`:n,r=new Set(this.menus.get());r.has(t)||(r.add(t),this.menus.set([...r]))},deleteOpenMenu(n,e=""){const t=e?`${n}-${e}`:n,r=new Set(this.menus.get());r.has(t)&&(r.delete(t),this.menus.set([...r]))},clearOpenMenus(n){this.menus.set(n?this.menus.get().filter(e=>!e.endsWith("-"+n)):[])},_hiddenMenus:[],hideOpenMenus(n){if(this._hiddenMenus=[...this.getOpenMenus(n)],this._hiddenMenus.length!==0)for(const e of this._hiddenMenus)this.deleteOpenMenu(e,n)},showOpenMenus(n){if(this._hiddenMenus.length!==0){for(const e of this._hiddenMenus)this.addOpenMenu(e,n);this._hiddenMenus=[]}},isMenuOpen(n,e){return this.getOpenMenus(e).includes(n)},hasOpenMenus(n){return this.getOpenMenus(n).length>0},hasAnyOpenMenus(){return this.getOpenMenus().length>0},forContext(n){return{getOpenMenus:()=>this.getOpenMenus(n),addOpenMenu:e=>this.addOpenMenu(e,n),deleteOpenMenu:e=>this.deleteOpenMenu(e,n),clearOpenMenus:()=>this.clearOpenMenus(n),isMenuOpen:e=>this.isMenuOpen(e,n),hasOpenMenus:()=>this.hasOpenMenus(n),hasAnyOpenMenus:()=>this.hasAnyOpenMenus()}}},xw=new W8,MW={maxShapesPerPage:4e3,maxFilesAtOnce:100,maxPages:40,animationMediumMs:320,followChaseViewportSnap:2,doubleClickDurationMs:450,multiClickDurationMs:200,coarseDragDistanceSquared:36,dragDistanceSquared:16,defaultSvgPadding:32,cameraSlideFriction:.09,maxPointsPerDrawShape:500,gridSteps:[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],collaboratorInactiveTimeoutMs:6e4,collaboratorIdleTimeoutMs:3e3,collaboratorCheckIntervalMs:1200,cameraMovingTimeoutMs:64,hitTestMargin:8,edgeScrollDelay:200,edgeScrollEaseDuration:200,edgeScrollSpeed:25,edgeScrollDistance:8,coarsePointerWidth:12,coarseHandleRadius:20,handleRadius:12,longPressDurationMs:500,textShadowLod:.35,adjacentShapeMargin:10,flattenImageBoundsExpand:64,flattenImageBoundsPadding:16,laserDelayMs:1200,maxExportDelayMs:5e3,temporaryAssetPreviewLifetimeMs:18e4,actionShortcutsLocation:"swap",createTextOnCanvasDoubleClick:!0,exportProvider:C.Fragment};function Wk(n,e){if(!e)return!1;switch(n.type){case"mixed":return e.type==="mixed";case"shared":return e.type==="shared"&&n.value===e.value;default:throw Sn(n)}}class AW{constructor(e){j(this,"map");this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){const t=this.get(e);if(t&&t.type!=="mixed")return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;const t=new Set;for(const[r,o]of this){if(!Wk(o,e.get(r)))return!1;t.add(r)}for(const[r,o]of e)if(!t.has(r)&&!Wk(o,this.get(r)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}}class ww extends AW{set(e,t){this.map.set(e,t)}applyValue(e,t){const r=this.get(e);if(!r){this.set(e,{type:"shared",value:t});return}switch(r.type){case"mixed":return;case"shared":r.value!==t&&this.set(e,{type:"mixed"});return;default:Sn(r,"type")}}}function jW(n,e,t){return Ds(n).then(function(r){return r.arrayBuffer()}).then(function(r){return new File([r],e,{type:t})})}const RW="https://cdn.tldraw.com";function ua(){return`${RW}/${zj}`}function OW(n){switch(n.type){case"shapes":return`s${n.shapeIds.map(t=>q0(t.slice(6))).join(".")}`;case"page":return"p"+q0(so.parseId(n.pageId));case"viewport":{const{bounds:e,pageId:t}=n;let r=`v${Math.round(e.x)}.${Math.round(e.y)}.${Math.round(e.w)}.${Math.round(e.h)}`;return t&&(r+="."+q0(so.parseId(t))),r}default:Sn(n)}}function DW(n){switch(n[0]){case"s":return{type:"shapes",shapeIds:n.slice(1).split(".").filter(Boolean).map(r=>Ct(decodeURIComponent(r)))};case"p":return{type:"page",pageId:so.createId(decodeURIComponent(n.slice(1)))};case"v":{const[t,r,o,s,i]=n.slice(1).split(".");return{type:"viewport",bounds:new xe(Number(t),Number(r),Number(o),Number(s)),pageId:i?so.createId(decodeURIComponent(i)):void 0}}default:throw Error("Invalid deep link string")}}function q0(n){return encodeURIComponent(n).replace(/\./g,"%2E")}function LW(n,e){var o;let t=n;const r=new Set(e);for(;r.has(t);)t=(o=/^.*(\d+)$/.exec(t))!=null&&o[1]?t.replace(/(\d+)(?=\D?)$/,s=>(+s+1).toString()):`${t} 1`;return t}function Lp(n,e,t,r){if(t.length===0)return[];const o=new Map;for(const i of Ze(t.map(a=>n.getShape(a)))){const{parentId:a}=i;o.has(a)||o.set(a,{children:Ze(n.getSortedChildIdsForParent(a).map(c=>n.getShape(c))),moving:new Set}),o.get(a).moving.add(i)}const s=[];switch(e){case"toBack":{o.forEach(({moving:i,children:a})=>FW(i,a,s));break}case"toFront":{o.forEach(({moving:i,children:a})=>NW(i,a,s));break}case"forward":{o.forEach(({moving:i,children:a})=>$W(n,i,a,s,r));break}case"backward":{o.forEach(({moving:i,children:a})=>zW(n,i,a,s,r));break}}return s}function FW(n,e,t){const r=e.length;if(n.size===r)return;let o,s;for(let i=0;i<r;i++){const a=e[i];if(n.has(a))o=a.index,n.delete(a);else{s=a.index;break}}if(n.size!==0){const i=Uc(o,s,n.size);t.push(...Array.from(n.values()).sort(Gn).map((a,c)=>({...a,index:i[c]})))}}function NW(n,e,t){const r=e.length;if(n.size===r)return;let o,s;for(let i=r-1;i>-1;i--){const a=e[i];if(n.has(a))s=a.index,n.delete(a);else{o=a.index;break}}if(n.size!==0){const i=Uc(o,s,n.size);t.push(...Array.from(n.values()).sort(Gn).map((a,c)=>({...a,index:i[c]})))}}function Vk(n,e){const t=n.getShapeGeometry(e),r=n.getShapePageTransform(e);return!t||!r?null:r.applyToPoints(t.vertices)}function QR(n,e){const t=Array.from(e).map(o=>{const s=Vk(n,o);return s?{shape:o,vertices:s}:null}).filter(Boolean);return o=>{const s=Vk(n,o);return s?t.some(i=>x1(i.vertices,s)):!1}}function $W(n,e,t,r,o){var c;const s=QR(n,e),i=t.length;if(e.size===i)return;let a={name:"skipping"};for(let u=0;u<i;u++){const h=e.has(t[u]);switch(a.name){case"skipping":{if(!h)continue;a={name:"selecting",selectIndex:u};break}case"selecting":{if(h||!(o!=null&&o.considerAllShapes)&&!s(t[u]))continue;const{selectIndex:f}=a;Uc(t[u].index,(c=t[u+1])==null?void 0:c.index,u-f).forEach((g,y)=>{const v=t[f+y];e.has(v)&&r.push({...v,index:g})}),a={name:"skipping"};break}}}}function zW(n,e,t,r,o){var c;const s=QR(n,e),i=t.length;if(e.size===i)return;let a={name:"skipping"};for(let u=i-1;u>-1;u--){const h=e.has(t[u]);switch(a.name){case"skipping":{if(!h)continue;a={name:"selecting",selectIndex:u};break}case"selecting":{if(h||!(o!=null&&o.considerAllShapes)&&!s(t[u]))continue;Uc((c=t[u-1])==null?void 0:c.index,t[u].index,a.selectIndex-u).forEach((f,g)=>{const y=t[u+g+1];e.has(y)&&r.push({...y,index:f})}),a={name:"skipping"};break}}}}function JR({editor:n,ids:e}){const t=Ze(e.map(i=>n.getShape(i))),r=n.getShapesSharedRotation(e),o=n.getShapesRotatedPageBounds(e);if(!o)return null;const s=o.center.clone().rotWith(o.point,r);return{pageCenter:s,initialCursorAngle:s.angle(n.inputs.originPagePoint),initialShapesRotation:r,shapeSnapshots:t.map(i=>({shape:i,initialPagePoint:n.getShapePageTransform(i.id).point()}))}}function pf({delta:n,editor:e,snapshot:t,stage:r,centerOverride:o}){const{pageCenter:s,shapeSnapshots:i}=t;e.updateShapes(i.map(({shape:c,initialPagePoint:u})=>{const h=Tr(c.parentId)?e.getShapePageTransform(c.parentId):ye.Identity(),f=P.RotWith(u,o??s,n),g=ye.applyToPoint(ye.Inverse(h),f),y=ll(c.rotation+n);return{id:c.id,type:c.type,x:g.x,y:g.y,rotation:y}}));const a=[];i.forEach(({shape:c})=>{var g,y,v;const u=e.getShape(c.id);if(!u)return;const h=e.getShapeUtil(c);if(r==="start"||r==="one-off"){const S=(g=h.onRotateStart)==null?void 0:g.call(h,c);S&&a.push(S)}const f=(y=h.onRotate)==null?void 0:y.call(h,c,u);if(f&&a.push(f),r==="end"||r==="one-off"){const S=(v=h.onRotateEnd)==null?void 0:v.call(h,c,u);S&&a.push(S)}}),a.length>0&&e.updateShapes(a)}const BW=n=>{const{store:e}=n,t=e.query.filterHistory("binding"),r=e.query.records("binding");function o(){const s=r.get(),i=new Map;for(const a of s){const{fromId:c,toId:u}=a,h=i.get(c);h?h.push(a):i.set(c,[a]);const f=i.get(u);f?f.push(a):i.set(u,[a])}return i}return ce("arrowBindingsIndex",(s,i)=>{if(il(s))return o();const a=s,c=t.getDiffSince(i);if(c===eo)return o();let u;function h(y){u??(u=new Map(a));const v=u.get(y.fromId),S=v==null?void 0:v.filter(_=>_.id!==y.id);S!=null&&S.length?u.set(y.fromId,S):u.delete(y.fromId);const w=u.get(y.toId),b=w==null?void 0:w.filter(_=>_.id!==y.id);b!=null&&b.length?u.set(y.toId,b):u.delete(y.toId)}function f(y){u??(u=new Map(a));let v=u.get(y);return v?v===a.get(y)&&(v=v.slice(0),u.set(y,v)):(v=[],u.set(y,v)),v}function g(y){f(y.fromId).push(y),f(y.toId).push(y)}for(const y of c){for(const v of qt(y.added))g(v);for(const[v,S]of qt(y.updated))h(v),g(S);for(const v of qt(y.removed))h(v)}return u??a})};function UW(n,e,t){const r=n.getShapeMaskedPageBounds(e);return r===void 0?!0:!t.includes(r)}const HW=n=>{function e(t){const r=t.getCurrentPageShapeIds(),o=t.getViewportPageBounds(),s=new Set;return r.forEach(i=>{UW(t,i,o)&&s.add(i)}),s}return ce("getCulledShapes",t=>{if(il(t))return e(n);const r=e(n);if(t.size!==r.size)return r;for(const o of t)if(!r.has(o))return r;return t})},KW=n=>{const e=n.query.ids("shape"),t=n.query.filterHistory("shape");function r(){const o={},s=e.get(),i=Array(s.size);return s.forEach(a=>i.push(n.get(a))),i.sort(Gn),i.forEach(a=>{o[a.parentId]||(o[a.parentId]=[]),o[a.parentId].push(a.id)}),o}return ce("parentsToChildrenWithIndexes",(o,s)=>{if(il(o))return r();const i=t.getDiffSince(s);if(i===eo)return r();if(i.length===0)return o;let a=null;const c=f=>{a||(a={...o}),a[f]?a[f]===o[f]&&(a[f]=[...a[f]]):a[f]=[]},u=new Set;let h;for(let f=0,g=i.length;f<g;f++){h=i[f];for(const y of Object.values(h.added))Ic(y)&&(c(y.parentId),a[y.parentId].push(y.id),u.add(a[y.parentId]));for(const[y,v]of Object.values(h.updated))if(Ic(v)&&Ic(y)){if(y.parentId!==v.parentId)c(y.parentId),c(v.parentId),a[y.parentId].splice(a[y.parentId].indexOf(v.id),1),a[v.parentId].push(v.id),u.add(a[v.parentId]);else if(y.index!==v.index){c(v.parentId);const S=a[v.parentId].indexOf(v.id);a[v.parentId][S]=v.id,u.add(a[v.parentId])}}for(const y of Object.values(h.removed))Ic(y)&&(c(y.parentId),a[y.parentId].splice(a[y.parentId].indexOf(y.id),1))}for(const f of u){const g=Ze(f.map(y=>n.get(y)));g.sort(Gn),f.splice(0,f.length,...g.map(y=>y.id))}return a??o})},Y0=(n,e,t)=>{for(;!Ir(t.parentId);){const r=n.get(t.parentId);if(!r)return!1;t=r}return t.parentId===e},WW=(n,e)=>{const t=n.query.ids("shape");let r=null;function o(){const s=e();return r=s,new Set([...t.get()].filter(i=>Y0(n,s,n.get(i))))}return ce("_shapeIdsInCurrentPage",(s,i)=>{if(il(s))return o();const a=e();if(a!==r)return o();const c=n.history.getDiffSince(i);if(c===eo)return o();const u=new lf(s);for(const f of c){for(const g of Object.values(f.added))Ic(g)&&Y0(n,a,g)&&u.add(g.id);for(const[g,y]of Object.values(f.updated))Ic(y)&&(Y0(n,a,y)?u.add(y.id):u.remove(y.id));for(const g of Object.keys(f.removed))Tr(g)&&u.remove(g)}const h=u.get();return h?ud(h.value,h.diff):s})};var VW=Object.create,eO=Object.defineProperty,GW=Object.getOwnPropertyDescriptor,qW=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),tO=n=>{throw TypeError(n)},nO=(n,e,t)=>e in n?eO(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,YW=n=>[,,,VW(null)],rO=["class","method","getter","setter","accessor","field","value","get","set"],oO=n=>n!==void 0&&typeof n!="function"?tO("Function expected"):n,XW=(n,e,t,r,o)=>({kind:rO[n],name:e,metadata:r,addInitializer:s=>t._?tO("Already initialized"):o.push(oO(s||null))}),ZW=(n,e)=>nO(e,qW("metadata"),n[3]),QW=(n,e,t,r)=>{for(var o=0,s=n[e>>1],i=s&&s.length;o<i;o++)s[o].call(t);return r},sO=(n,e,t,r,o,s)=>{for(var i,a,c,u,h=e&7,f=!!(e&8),g=!!(e&16),y=2,v=rO[h+5],S=n[y]||(n[y]=[]),w=(o=o.prototype,GW(o,t)),b=r.length-1;b>=0;b--)c=XW(h,t,a={},n[3],S),c.static=f,c.private=g,u=c.access={has:_=>t in _},u.get=_=>_[t],i=(0,r[b])(w[v],c),a._=1,oO(i)&&(w[v]=i);return w&&eO(o,t,w),o},fc=(n,e,t)=>nO(n,typeof e!="symbol"?e+"":e,t),iO,aO,oh;const JW=40;aO=[Or],iO=[Or];class tm{constructor(e){this.editor=e,QW(oh,5,this),fc(this,"_clickId",""),fc(this,"_clickTimeout"),fc(this,"_clickScreenPoint"),fc(this,"_previousScreenPoint"),fc(this,"_clickState","idle"),fc(this,"lastPointerInfo",{})}_getClickTimeout(e,t=bt()){this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=this.editor.timers.setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break}case"pendingQuadruple":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break}case"pendingOverflow":{this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"});break}}this._clickState="idle"}},e==="idle"||e==="pendingDouble"?this.editor.options.doubleClickDurationMs:this.editor.options.multiClickDurationMs)}get clickState(){return this._clickState}handlePointerEvent(e){switch(e.name){case"pointer_down":{if(!this._clickState)return e;switch(this._clickScreenPoint=P.From(e.point),this._previousScreenPoint&&P.Dist2(this._previousScreenPoint,this._clickScreenPoint)>JW**2&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"idle":{this._clickState="pendingDouble";break}case"pendingOverflow":{this._clickState="overflow";break}}return this._clickTimeout=this._getClickTimeout(this._clickState),e}case"pointer_up":{if(!this._clickState)return e;switch(this._clickScreenPoint=P.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"}}return e}case"pointer_move":return this._clickState!=="idle"&&this._clickScreenPoint&&P.Dist2(this._clickScreenPoint,this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?this.editor.options.coarseDragDistanceSquared:this.editor.options.dragDistanceSquared)&&this.cancelDoubleClickTimeout(),e}return e}cancelDoubleClickTimeout(){this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"}}oh=YW();sO(oh,1,"_getClickTimeout",aO,tm);sO(oh,1,"cancelDoubleClickTimeout",iO,tm);ZW(oh,tm);class eV{constructor(e){j(this,"_isEdgeScrolling",!1);j(this,"_edgeScrollDuration",-1);this.editor=e}updateEdgeScrolling(e){const{editor:t}=this,r=this.getEdgeScroll();if(r.x===0&&r.y===0)this._isEdgeScrolling&&(this._isEdgeScrolling=!1,this._edgeScrollDuration=0);else if(this._isEdgeScrolling||(this._isEdgeScrolling=!0,this._edgeScrollDuration=0),this._edgeScrollDuration+=e,this._edgeScrollDuration>t.options.edgeScrollDelay){const o=t.options.edgeScrollEaseDuration>0?xn.easeInCubic(Math.min(1,this._edgeScrollDuration/(t.options.edgeScrollDelay+t.options.edgeScrollEaseDuration))):1;this.moveCameraWhenCloseToEdge({x:r.x*o,y:r.y*o})}}getEdgeProximityFactors(e,t,r,o,s){const{editor:i}=this,a=i.options.edgeScrollDistance,c=r?i.options.coarsePointerWidth:0,u=e-c,h=e+c,f=o?0:a,g=s?t:t-a;return u<f?Math.min(1,(f-u)/a):h>g?-Math.min(1,(h-g)/a):0}getEdgeScroll(){const{editor:e}=this,{inputs:{currentScreenPoint:{x:t,y:r}}}=e,o=e.getViewportScreenBounds(),{isCoarsePointer:s,insets:[i,a,c,u]}=e.getInstanceState(),h=this.getEdgeProximityFactors(t,o.w,s,u,a),f=this.getEdgeProximityFactors(r,o.h,s,i,c);return{x:h,y:f}}moveCameraWhenCloseToEdge(e){const{editor:t}=this;if(!t.inputs.isDragging||t.inputs.isPanning||t.getCameraOptions().isLocked||e.x===0&&e.y===0)return;const r=t.getViewportScreenBounds(),o=r.w<1e3?.612:1,s=r.h<1e3?.612:1,i=t.getZoomLevel(),a=t.user.getEdgeScrollSpeed()*t.options.edgeScrollSpeed,c=a*e.x*o/i,u=a*e.y*s/i,{x:h,y:f,z:g}=t.getCamera();t.setCamera(new P(h+c,f+u,g))}}class tV{constructor(e,t){j(this,"disposeSideEffectListener");this.editor=e,this.disposeSideEffectListener=e.sideEffects.registerAfterChangeHandler("instance",(o,s)=>{o.isFocused!==s.isFocused&&this.updateContainerClass()});const r=e.getInstanceState().isFocused;t!==r&&e.updateInstanceState({isFocused:!!t}),this.updateContainerClass()}updateContainerClass(){const e=this.editor.getContainer();this.editor.getInstanceState().isFocused?e.classList.add("tl-container__focused"):e.classList.remove("tl-container__focused")}focus(){this.editor.getContainer().focus()}blur(){this.editor.complete(),this.editor.getContainer().blur()}dispose(){var e;(e=this.disposeSideEffectListener)==null||e.call(this)}}function ed(n){return rV}class nV{constructor(){j(this,"length",0);j(this,"head",null);j(this,"tail",this)}push(e){return new I1(e,this)}toArray(){return gi}[Symbol.iterator](){return{next(){return{value:void 0,done:!0}}}}}const rV=new nV;class I1{constructor(e,t){j(this,"length");this.head=e,this.tail=t,this.length=t.length+1}push(e){return new I1(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(e.length){const t=e.head;return e=e.tail,{value:t,done:!1}}else return{value:void 0,done:!0}}}}}class oV{constructor(e){j(this,"store");j(this,"dispose");j(this,"state","recording");j(this,"pendingDiff",new iV);j(this,"stacks",dn("HistoryManager.stacks",{undos:ed(),redos:ed()},{isEqual:(e,t)=>e.undos===t.undos&&e.redos===t.redos}));j(this,"annotateError");j(this,"_isInBatch",!1);this.store=e.store,this.annotateError=e.annotateError??Md,this.dispose=this.store.addHistoryInterceptor((t,r)=>{if(r==="user")switch(this.state){case"recording":this.pendingDiff.apply(t.changes),this.stacks.update(({undos:o})=>({undos:o,redos:ed()}));break;case"recordingPreserveRedoStack":this.pendingDiff.apply(t.changes);break;case"paused":break;default:Sn(this.state)}})}flushPendingDiff(){if(this.pendingDiff.isEmpty())return;const e=this.pendingDiff.clear();this.stacks.update(({undos:t,redos:r})=>({undos:t.push({type:"diff",diff:e}),redos:r}))}getNumUndos(){return this.stacks.get().undos.length+(this.pendingDiff.isEmpty()?0:1)}getNumRedos(){return this.stacks.get().redos.length}batch(e,t){const r=this.state;r!=="paused"&&(t!=null&&t.history)&&(this.state=sV[t.history]);try{if(this._isInBatch)return As(e),this;this._isInBatch=!0;try{As(e)}catch(o){throw this.annotateError(o),o}finally{this._isInBatch=!1}return this}finally{this.state=r}}_undo({pushToRedoStack:e,toMark:t=void 0}){var o;const r=this.state;this.state="paused";try{let{undos:s,redos:i}=this.stacks.get();const a=this.pendingDiff.clear(),c=ZA(a),u=iw(a);e&&!c&&(i=i.push({type:"diff",diff:a}));let h=!1;if(c)for(;((o=s.head)==null?void 0:o.type)==="stop";){const f=s.head;if(s=s.tail,e&&(i=i.push(f)),f.id===t){h=!0;break}}if(!h)e:for(;s.head;){const f=s.head;switch(s=s.tail,e&&(i=i.push(f)),f.type){case"diff":xd(u,[iw(f.diff)]);break;case"stop":if(!t)break e;if(f.id===t){h=!0;break e}break;default:Sn(f)}}if(!h&&t)return this;this.store.applyDiff(u,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:s,redos:i})}finally{this.state=r}return this}undo(){return this._undo({pushToRedoStack:!0}),this}redo(){var t;const e=this.state;this.state="paused";try{this.flushPendingDiff();let{undos:r,redos:o}=this.stacks.get();if(o.length===0)return this;for(;((t=o.head)==null?void 0:t.type)==="stop";)r=r.push(o.head),o=o.tail;const s=Xf();for(;o.head;){const i=o.head;if(r=r.push(i),o=o.tail,i.type==="diff")xd(s,[i.diff]);else break}this.store.applyDiff(s,{ignoreEphemeralKeys:!0}),this.store.ensureStoreIsUsable(),this.stacks.set({undos:r,redos:o})}finally{this.state=e}return this}bail(){return this._undo({pushToRedoStack:!1}),this}bailToMark(e){return this._undo({pushToRedoStack:!1,toMark:e}),this}squashToMark(e){var s;let t=this.stacks.get().undos;const r=[];for(;t.head&&!(t.head.type==="stop"&&t.head.id===e);)t.head.type==="diff"&&r.push(t.head.diff),t=t.tail;if(!t.head||((s=t.head)==null?void 0:s.id)!==e)return console.error("Could not find mark to squash to: ",e),this;if(r.length===0)return this;const o=Xf();return xd(o,r.reverse()),this.stacks.update(({redos:i})=>({undos:t.push({type:"diff",diff:o}),redos:i})),this}_mark(e){As(()=>{this.flushPendingDiff(),this.stacks.update(({undos:t,redos:r})=>({undos:t.push({type:"stop",id:e}),redos:r}))})}clear(){this.stacks.set({undos:ed(),redos:ed()}),this.pendingDiff.clear()}getMarkIdMatching(e){let t=this.stacks.get().undos;for(;t.head;){if(t.head.type==="stop"&&t.head.id.includes(e))return t.head.id;t=t.tail}return null}debug(){const{undos:e,redos:t}=this.stacks.get();return{undos:e.toArray(),redos:t.toArray(),pendingDiff:this.pendingDiff.debug(),state:this.state}}}const sV={record:"recording","record-preserveRedoStack":"recordingPreserveRedoStack",ignore:"paused"};class iV{constructor(){j(this,"diff",Xf());j(this,"isEmptyAtom",dn("PendingDiff.isEmpty",!0))}clear(){const e=this.diff;return this.diff=Xf(),this.isEmptyAtom.set(!0),e}isEmpty(){return this.isEmptyAtom.get()}apply(e){xd(this.diff,[e]),this.isEmptyAtom.set(ZA(this.diff))}debug(){return{diff:this.diff,isEmpty:this.isEmpty()}}}class aV{constructor(e){j(this,"scribbleItems",new Map);j(this,"state","paused");this.editor=e}addScribble(e,t=bt()){const r={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,r),r}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear()}stop(e){const t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t}addPoint(e,t,r,o=.5){const s=this.scribbleItems.get(e);if(!s)throw Error(`Scribble with id ${e} not found`);const{prev:i}=s,a={x:t,y:r,z:o};return(!i||P.Dist(i,a)>=1)&&(s.next=a),s}tick(e){this.scribbleItems.size!==0&&this.editor.run(()=>{this.scribbleItems.forEach(t=>{if(t.scribble.state==="starting"){const{next:c,prev:u}=t;c&&c!==u&&(t.prev=c,t.scribble.points.push(c)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);const{delayRemaining:r,timeoutMs:o,prev:s,next:i,scribble:a}=t;switch(a.state){case"active":{i&&i!==s?(t.prev=i,a.points.push(i),r===0&&a.points.length>8&&a.points.shift()):o===0&&(a.points.length>1?a.points.shift():t.delayRemaining=a.delay);break}case"stopping":{if(t.delayRemaining===0&&o===0){if(a.points.length===1){this.scribbleItems.delete(t.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}break}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:t})=>({...t,points:[...t.points]})).slice(-5)})})}}var lV=Object.create,lO=Object.defineProperty,cV=Object.getOwnPropertyDescriptor,uV=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),cO=n=>{throw TypeError(n)},uO=(n,e,t)=>e in n?lO(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,dV=n=>[,,,lV(null)],dO=["class","method","getter","setter","accessor","field","value","get","set"],hO=n=>n!==void 0&&typeof n!="function"?cO("Function expected"):n,hV=(n,e,t,r,o)=>({kind:dO[n],name:e,metadata:r,addInitializer:s=>t._?cO("Already initialized"):o.push(hO(s||null))}),pV=(n,e)=>uO(e,uV("metadata"),n[3]),fV=(n,e,t,r)=>{for(var o=0,s=n[e>>1],i=s&&s.length;o<i;o++)s[o].call(t);return r},nm=(n,e,t,r,o,s)=>{for(var i,a,c,u,h=e&7,f=!!(e&8),g=!!(e&16),y=2,v=dO[h+5],S=n[y]||(n[y]=[]),w=(o=o.prototype,cV(o,t)),b=r.length-1;b>=0;b--)c=hV(h,t,a={},n[3],S),c.static=f,c.private=g,u=c.access={has:_=>t in _},u.get=_=>_[t],i=(0,r[b])(w[v],c),a._=1,hO(i)&&(w[v]=i);return w&&lO(o,t,w),o},gV=(n,e,t)=>uO(n,e+"",t),pO,fO,gO,mO,Il;const He=n=>Math.round(n*10**8)/10**8;function li(n,e,t,r,o){const s=n.filter(a=>(r==="forward"?a.startNode.id===e:a.endNode.id===e)&&He(a.length)===He(t)&&Vo(a.breadthIntersection[0],a.breadthIntersection[1],o[0],o[1]));if(s.length===0)return[];const i=new Set;return s.forEach(a=>{const c=r==="forward"?a.endNode.id:a.startNode.id;if(!i.has(c)){i.add(c);const u=li(n,c,t,r,Vo(a.breadthIntersection[0],a.breadthIntersection[1],o[0],o[1]));s.push(...u)}}),s}function mV(n){n.sort((e,t)=>t.gaps.length-e.gaps.length);for(let e=n.length-1;e>0;e--){const t=n[e];for(let r=e-1;r>=0;r--){const o=n[r];if(o.direction===t.direction&&t.gaps.every(s=>o.gaps.some(i=>He(s.startEdge[0].x)===He(i.startEdge[0].x)&&He(s.startEdge[0].y)===He(i.startEdge[0].y)&&He(s.startEdge[1].x)===He(i.startEdge[1].x)&&He(s.startEdge[1].y)===He(i.startEdge[1].y))&&o.gaps.some(i=>He(s.endEdge[0].x)===He(i.endEdge[0].x)&&He(s.endEdge[0].y)===He(i.endEdge[0].y)&&He(s.endEdge[1].x)===He(i.endEdge[1].x)&&He(s.endEdge[1].y)===He(i.endEdge[1].y)))){n.splice(e,1);break}}}}mO=[ce],gO=[ce],fO=[ce],pO=[ce];class iu{constructor(e){this.manager=e,fV(Il,5,this),gV(this,"editor"),this.editor=e.editor}getSnapPointsCache(){const{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{const r=e.getShapePageTransform(t.id);if(!r)return;const s=e.getShapeUtil(t).getBoundsSnapGeometry(t).points??e.getShapeGeometry(t).bounds.cornersAndCenter;if(!(!r||!s))return s.map((i,a)=>{const{x:c,y:u}=ye.applyToPoint(r,i);return{x:c,y:u,id:`${t.id}:${a}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){const e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),r=[];for(const o of t){const s=e.get(o);s&&r.push(...s)}return r}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:Mr(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){const e=[],t=[];let r,o;const s=this.getSnappableGapNodes().sort((a,c)=>a.pageBounds.minX-c.pageBounds.minX);for(let a=0;a<s.length;a++){r=s[a];for(let c=a+1;c<s.length;c++)o=s[c],r.pageBounds.maxX<o.pageBounds.minX&&Ju(r.pageBounds.minY,r.pageBounds.maxY,o.pageBounds.minY,o.pageBounds.maxY)&&e.push({startNode:r,endNode:o,startEdge:[new P(r.pageBounds.maxX,r.pageBounds.minY),new P(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new P(o.pageBounds.minX,o.pageBounds.minY),new P(o.pageBounds.minX,o.pageBounds.maxY)],length:o.pageBounds.minX-r.pageBounds.maxX,breadthIntersection:Vo(r.pageBounds.minY,r.pageBounds.maxY,o.pageBounds.minY,o.pageBounds.maxY)})}const i=s.sort((a,c)=>a.pageBounds.minY-c.pageBounds.minY);for(let a=0;a<i.length;a++){r=i[a];for(let c=a+1;c<i.length;c++)o=i[c],r.pageBounds.maxY<o.pageBounds.minY&&Ju(r.pageBounds.minX,r.pageBounds.maxX,o.pageBounds.minX,o.pageBounds.maxX)&&t.push({startNode:r,endNode:o,startEdge:[new P(r.pageBounds.minX,r.pageBounds.maxY),new P(r.pageBounds.maxX,r.pageBounds.maxY)],endEdge:[new P(o.pageBounds.minX,o.pageBounds.minY),new P(o.pageBounds.maxX,o.pageBounds.minY)],length:o.pageBounds.minY-r.pageBounds.maxY,breadthIntersection:Vo(r.pageBounds.minX,r.pageBounds.maxX,o.pageBounds.minX,o.pageBounds.maxX)})}return{horizontal:e,vertical:t}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:r,dragDelta:o}){var w,b;const s=this.manager.getSnapThreshold(),i=this.getSnappablePoints(),a=t.clone().translate(o),c=r.map(({x:_,y:T},E)=>({id:"selection:"+E,x:_+o.x,y:T+o.y})),u=i,h=[],f=[],g=new P(s,s);this.collectPointSnaps({minOffset:g,nearestSnapsX:h,nearestSnapsY:f,otherNodeSnapPoints:u,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:h,nearestSnapsY:f,minOffset:g});const y=new P(e==="x"?0:((w=h[0])==null?void 0:w.nudge)??0,e==="y"?0:((b=f[0])==null?void 0:b.nudge)??0);g.x=0,g.y=0,h.length=0,f.length=0,c.forEach(_=>{_.x+=y.x,_.y+=y.y}),a.translate(y),this.collectPointSnaps({minOffset:g,nearestSnapsX:h,nearestSnapsY:f,otherNodeSnapPoints:u,selectionSnapPoints:c}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:h,nearestSnapsY:f,minOffset:g});const v=this.getPointSnapLines({nearestSnapsX:h,nearestSnapsY:f}),S=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:h,nearestSnapsY:f});return this.manager.setIndicators([...S,...v]),{nudge:y}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:t,handle:r,isAspectRatioLocked:o,isResizingFromCenter:s}){var R,L;const i=this.manager.getSnapThreshold(),{box:a,scaleX:c,scaleY:u}=xe.Resize(e,r,s?t.x*2:t.x,s?t.y*2:t.y,o);let h=r;c<0&&(h=SH(h)),u<0&&(h=vH(h)),s&&(a.center=e.center);const f=h==="top"||h==="bottom",g=h==="left"||h==="right",y=Gk(h,a),v=this.getSnappablePoints(),S=[],w=[],b=new P(i,i);this.collectPointSnaps({minOffset:b,nearestSnapsX:S,nearestSnapsY:w,otherNodeSnapPoints:v,selectionSnapPoints:y});const _=new P(f?0:((R=S[0])==null?void 0:R.nudge)??0,g?0:((L=w[0])==null?void 0:L.nudge)??0);if(o&&xH(h)&&_.len()!==0){const K=S.length&&w.length?Math.abs(_.x)<Math.abs(_.y)?"x":"y":S.length?"x":"y",D=e.aspectRatio;K==="x"?(w.length=0,_.y=_.x/D,(h==="bottom_left"||h==="top_right")&&(_.y=-_.y)):(S.length=0,_.x=_.y*D,(h==="bottom_left"||h==="top_right")&&(_.x=-_.x))}const T=P.Add(t,_),{box:E}=xe.Resize(e,r,s?T.x*2:T.x,s?T.y*2:T.y,o);s&&(E.center=e.center);const M=Gk("any",E);S.length=0,w.length=0,b.x=0,b.y=0,this.collectPointSnaps({minOffset:b,nearestSnapsX:S,nearestSnapsY:w,otherNodeSnapPoints:v,selectionSnapPoints:M});const A=this.getPointSnapLines({nearestSnapsX:S,nearestSnapsY:w});return this.manager.setIndicators([...A]),{nudge:_}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:r,nearestSnapsX:o,nearestSnapsY:s}){for(const i of e)for(const a of t){const c=P.Sub(i,a),u=Math.abs(c.x),h=Math.abs(c.y);He(u)<=He(r.x)&&(He(u)<He(r.x)&&(o.length=0),o.push({type:"points",points:{thisPoint:i,otherPoint:a},nudge:a.x-i.x}),r.x=u),He(h)<=He(r.y)&&(He(h)<He(r.y)&&(s.length=0),s.push({type:"points",points:{thisPoint:i,otherPoint:a},nudge:a.y-i.y}),r.y=h)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:r,nearestSnapsY:o}){const{horizontal:s,vertical:i}=this.getVisibleGaps();for(const a of s){if(!Ju(a.breadthIntersection[0],a.breadthIntersection[1],e.minY,e.maxY))continue;const u=a.startEdge[0].x+a.length/2-e.center.x;if(a.length>e.width&&He(Math.abs(u))<=He(t.x)){He(Math.abs(u))<He(t.x)&&(r.length=0),t.x=Math.abs(u);const b={type:"gap_center",gap:a,nudge:u},_=r.find(({type:E})=>E==="gap_center"),T=_&&Vo(a.breadthIntersection[0],a.breadthIntersection[1],_.gap.breadthIntersection[0],_.gap.breadthIntersection[1]);_&&_.gap.length>a.length&&T?r[r.indexOf(_)]=b:(!_||!T)&&r.push(b)}const f=a.startNode.pageBounds.minX-a.length,g=e.maxX,y=f-g;He(Math.abs(y))<=He(t.x)&&(He(Math.abs(y))<He(t.x)&&(r.length=0),t.x=Math.abs(y),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"left",nudge:y}));const v=a.endNode.pageBounds.maxX+a.length,S=e.minX,w=v-S;He(Math.abs(w))<=He(t.x)&&(He(Math.abs(w))<He(t.x)&&(r.length=0),t.x=Math.abs(w),r.push({type:"gap_duplicate",gap:a,protrusionDirection:"right",nudge:w}))}for(const a of i){if(!Ju(a.breadthIntersection[0],a.breadthIntersection[1],e.minX,e.maxX))continue;const u=a.startEdge[0].y+a.length/2-e.center.y;if(a.length>e.height&&He(Math.abs(u))<=He(t.y)){He(Math.abs(u))<He(t.y)&&(o.length=0),t.y=Math.abs(u);const b={type:"gap_center",gap:a,nudge:u},_=o.find(({type:E})=>E==="gap_center"),T=_&&Ju(_.gap.breadthIntersection[0],_.gap.breadthIntersection[1],a.breadthIntersection[0],a.breadthIntersection[1]);_&&_.gap.length>a.length&&T?o[o.indexOf(_)]=b:(!_||!T)&&o.push(b);continue}const f=a.startNode.pageBounds.minY-a.length,g=e.maxY,y=f-g;He(Math.abs(y))<=He(t.y)&&(He(Math.abs(y))<He(t.y)&&(o.length=0),t.y=Math.abs(y),o.push({type:"gap_duplicate",gap:a,protrusionDirection:"top",nudge:y}));const v=a.endNode.pageBounds.maxY+a.length,S=e.minY,w=v-S;He(Math.abs(w))<=He(t.y)&&(He(Math.abs(w))<He(t.y)&&(o.length=0),t.y=Math.abs(w),o.push({type:"gap_duplicate",gap:a,protrusionDirection:"bottom",nudge:w}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){const r={},o={};if(e.length>0){for(const s of e)if(s.type==="points"){const i=He(s.points.otherPoint.x);r[i]||(r[i]=[]),r[i].push(s.points)}}if(t.length>0){for(const s of t)if(s.type==="points"){const i=He(s.points.otherPoint.y);o[i]||(o[i]=[]),o[i].push(s.points)}}return Object.values(r).concat(Object.values(o)).map(s=>({id:bt(),type:"points",points:_b(s.map(i=>P.From(i.otherPoint)).concat(s.map(i=>P.From(i.thisPoint))),(i,a)=>i.equals(a))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:r}){const{vertical:o,horizontal:s}=this.getVisibleGaps(),i={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(t.length>0)for(const c of t){if(c.type==="points")continue;const{gap:{breadthIntersection:u,startEdge:h,startNode:f,endNode:g,length:y,endEdge:v}}=c;switch(c.type){case"gap_center":{const S=(y-e.width)/2,w=Vo(u[0],u[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:bt(),gaps:[...li(s,f.id,S,"backward",w),{startEdge:h,endEdge:i.left},{startEdge:i.right,endEdge:v},...li(s,g.id,S,"forward",w)]});break}case"gap_duplicate":{const S=Vo(u[0],u[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:bt(),gaps:c.protrusionDirection==="left"?[{startEdge:i.right,endEdge:h.map(w=>w.clone().addXY(-f.pageBounds.width,0))},{startEdge:h,endEdge:v},...li(s,g.id,y,"forward",S)]:[...li(s,f.id,y,"backward",S),{startEdge:h,endEdge:v},{startEdge:v.map(w=>w.clone().addXY(c.gap.endNode.pageBounds.width,0)),endEdge:i.left}]});break}}}if(r.length>0)for(const c of r){if(c.type==="points")continue;const{gap:{breadthIntersection:u,startEdge:h,startNode:f,endNode:g,length:y,endEdge:v}}=c;switch(c.type){case"gap_center":{const S=(y-e.height)/2,w=Vo(u[0],u[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:bt(),gaps:[...li(o,f.id,S,"backward",w),{startEdge:h,endEdge:i.top},{startEdge:i.bottom,endEdge:v},...li(o,c.gap.endNode.id,S,"forward",w)]});break}case"gap_duplicate":{const S=Vo(u[0],u[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:bt(),gaps:c.protrusionDirection==="top"?[{startEdge:i.bottom,endEdge:h.map(w=>w.clone().addXY(0,-f.pageBounds.height))},{startEdge:h,endEdge:v},...li(o,g.id,y,"forward",S)]:[...li(o,f.id,y,"backward",S),{startEdge:h,endEdge:v},{startEdge:v.map(w=>w.clone().addXY(0,g.pageBounds.height)),endEdge:i.top}]})}break}}return mV(a),a}}Il=dV();nm(Il,1,"getSnapPointsCache",mO,iu);nm(Il,1,"getSnappablePoints",gO,iu);nm(Il,1,"getSnappableGapNodes",fO,iu);nm(Il,1,"getVisibleGaps",pO,iu);pV(Il,iu);function Gk(n,e){const{minX:t,maxX:r,minY:o,maxY:s}=e,i=[];switch(n){case"top":case"left":case"top_left":case"any":i.push({id:"top_left",handle:"top_left",x:t,y:o})}switch(n){case"top":case"right":case"top_right":case"any":i.push({id:"top_right",handle:"top_right",x:r,y:o})}switch(n){case"bottom":case"right":case"bottom_right":case"any":i.push({id:"bottom_right",handle:"bottom_right",x:r,y:s})}switch(n){case"bottom":case"left":case"bottom_left":case"any":i.push({id:"bottom_left",handle:"bottom_left",x:t,y:s})}return i}var yV=Object.create,yO=Object.defineProperty,vV=Object.getOwnPropertyDescriptor,SV=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),vO=n=>{throw TypeError(n)},SO=(n,e,t)=>e in n?yO(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,xV=n=>[,,,yV(null)],xO=["class","method","getter","setter","accessor","field","value","get","set"],wO=n=>n!==void 0&&typeof n!="function"?vO("Function expected"):n,wV=(n,e,t,r,o)=>({kind:xO[n],name:e,metadata:r,addInitializer:s=>t._?vO("Already initialized"):o.push(wO(s||null))}),bV=(n,e)=>SO(e,SV("metadata"),n[3]),_V=(n,e,t,r)=>{for(var o=0,s=n[e>>1],i=s&&s.length;o<i;o++)s[o].call(t);return r},PV=(n,e,t,r,o,s)=>{for(var i,a,c,u,h=e&7,f=!!(e&8),g=!!(e&16),y=2,v=xO[h+5],S=n[y]||(n[y]=[]),w=(o=o.prototype,vV(o,t)),b=r.length-1;b>=0;b--)c=wV(h,t,a={},n[3],S),c.static=f,c.private=g,u=c.access={has:_=>t in _},u.get=_=>_[t],i=(0,r[b])(w[v],c),a._=1,wO(i)&&(w[v]=i);return w&&yO(o,t,w),o},CV=(n,e,t)=>SO(n,e+"",t),bO,rm;const IV=()=>null,EV=()=>[];bO=[ce];class E1{constructor(e){this.manager=e,_V(rm,5,this),CV(this,"editor"),this.editor=e.editor}getSnapGeometryCache(){const{editor:e}=this;return e.store.createComputedCache("handle snap geometry",t=>{const r=e.getShapeUtil(t).getHandleSnapGeometry(t),o=r.getSelfSnapOutline?r.getSelfSnapOutline.bind(r):IV,s=r.getSelfSnapPoints?r.getSelfSnapPoints.bind(r):EV;return{outline:r.outline===void 0?e.getShapeGeometry(t):r.outline,points:r.points??[],getSelfSnapOutline:o,getSelfSnapPoints:s}})}*iterateSnapPointsInPageSpace(e,t){var o,s;const r=(o=this.getSnapGeometryCache().get(e))==null?void 0:o.getSelfSnapPoints(t);if(r&&r.length){const i=Mr(this.editor.getShapePageTransform(e));for(const a of r)yield i.applyToPoint(a)}for(const i of this.manager.getSnappableShapes()){if(i===e)continue;const a=(s=this.getSnapGeometryCache().get(i))==null?void 0:s.points;if(!a||!a.length)continue;const c=Mr(this.editor.getShapePageTransform(i));for(const u of a)yield c.applyToPoint(u)}}*iterateSnapOutlines(e,t){var o,s;const r=(o=this.getSnapGeometryCache().get(e))==null?void 0:o.getSelfSnapOutline(t);r&&(yield{shapeId:e,outline:r});for(const i of this.manager.getSnappableShapes()){if(i===e)continue;const a=(s=this.getSnapGeometryCache().get(i))==null?void 0:s.outline;a&&(yield{shapeId:i,outline:a})}}getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:r}){const o=this.manager.getSnapThreshold();let s=o,i=null;for(const u of this.iterateSnapPointsInPageSpace(e,t))P.DistMin(r,u,s)&&(s=P.Dist(r,u),i=u);if(i)return i;let a=o,c=null;for(const{shapeId:u,outline:h}of this.iterateSnapOutlines(e,t)){const f=Mr(this.editor.getShapePageTransform(u)),g=this.editor.getPointInShapeSpace(u,r),y=h.nearestPoint(g),v=f.applyToPoint(y);P.DistMin(r,v,a)&&(a=P.Dist(r,v),c=v)}return c||null}snapHandle({currentShapeId:e,handle:t}){const o=Mr(this.editor.getShapePageTransform(e)).applyToPoint(t),s=this.getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:o});return s?(this.manager.setIndicators([{id:bt(),type:"points",points:[s]}]),{nudge:P.Sub(s,o)}):null}}rm=xV();PV(rm,1,"getSnapGeometryCache",bO,E1);bV(rm,E1);var kV=Object.create,_O=Object.defineProperty,TV=Object.getOwnPropertyDescriptor,MV=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),PO=n=>{throw TypeError(n)},CO=(n,e,t)=>e in n?_O(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,AV=n=>[,,,kV(null)],IO=["class","method","getter","setter","accessor","field","value","get","set"],EO=n=>n!==void 0&&typeof n!="function"?PO("Function expected"):n,jV=(n,e,t,r,o)=>({kind:IO[n],name:e,metadata:r,addInitializer:s=>t._?PO("Already initialized"):o.push(EO(s||null))}),RV=(n,e)=>CO(e,MV("metadata"),n[3]),OV=(n,e,t,r)=>{for(var o=0,s=n[e>>1],i=s&&s.length;o<i;o++)s[o].call(t);return r},k1=(n,e,t,r,o,s)=>{for(var i,a,c,u,h=e&7,f=!!(e&8),g=!!(e&16),y=2,v=IO[h+5],S=n[y]||(n[y]=[]),w=(o=o.prototype,TV(o,t)),b=r.length-1;b>=0;b--)c=jV(h,t,a={},n[3],S),c.static=f,c.private=g,u=c.access={has:_=>t in _},u.get=_=>_[t],i=(0,r[b])(w[v],c),a._=1,EO(i)&&(w[v]=i);return w&&_O(o,t,w),o},X0=(n,e,t)=>CO(n,typeof e!="symbol"?e+"":e,t),kO,TO,MO,au;MO=[ce],TO=[ce],kO=[ce];class sh{constructor(e){this.editor=e,OV(au,5,this),X0(this,"shapeBounds"),X0(this,"handles"),X0(this,"_snapIndicators",dn("snapLines",void 0)),this.shapeBounds=new iu(this),this.handles=new E1(this)}getIndicators(){return this._snapIndicators.get()??gi}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){const{editor:e}=this,t=e.getViewportPageBounds(),r=e.getSelectedShapeIds(),o=new Set,s=i=>{if(Tr(i)){const c=e.getShape(i);c&&e.isShapeOfType(c,"frame")&&o.add(i)}const a=e.getSortedChildIdsForParent(i);for(const c of a){if(r.includes(c))continue;const u=e.getShape(c);if(!u||!e.getShapeUtil(u).canSnap(u))continue;const f=e.getShapePageBounds(c);if(f&&t.includes(f)){if(e.isShapeOfType(u,"group")){s(c);continue}o.add(c)}}};return s(this.getCurrentCommonAncestor()??e.getCurrentPageId()),o}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}}au=AV();k1(au,1,"getSnapThreshold",MO,sh);k1(au,1,"getSnappableShapes",TO,sh);k1(au,1,"getCurrentCommonAncestor",kO,sh);RV(au,sh);const DV=/\r?\n|\r/g;function qk(n){return n.replace(DV,`
`).split(`
`).map(e=>e||" ").join(`
`)}const LV={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},FV=/\s/;class NV{constructor(e){j(this,"baseElm");this.editor=e;const t=this.editor.getContainer(),r=document.createElement("div");r.classList.add("tl-text"),r.classList.add("tl-text-measure"),r.tabIndex=-1,t.appendChild(r),this.baseElm=r,e.disposables.add(()=>{r.remove()})}measureText(e,t){var i;const r=(i=this.baseElm)==null?void 0:i.cloneNode();this.baseElm.insertAdjacentElement("afterend",r),r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-style",t.fontStyle),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("font-size",t.fontSize+"px"),r.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),r.style.setProperty("max-width",t.maxWidth===null?null:t.maxWidth+"px"),r.style.setProperty("min-width",t.minWidth===null?null:t.minWidth+"px"),r.style.setProperty("padding",t.padding),r.style.setProperty("overflow-wrap",t.disableOverflowWrapBreaking?"normal":"break-word"),r.textContent=qk(e);const o=r.scrollWidth,s=r.getBoundingClientRect();return r.remove(),{x:0,y:0,w:s.width,h:s.height,scrollWidth:o}}measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){const r=[],o=e.getBoundingClientRect(),s=-o.left,i=-o.top,a=new Range,c=e.childNodes[0];let u=0,h=null,f=null,g=0,y=0,v=!1;for(const S of e.childNodes)if(S.nodeType===Node.TEXT_NODE)for(const w of S.textContent??""){a.setStart(c,u),a.setEnd(c,u+w.length);const b=a.getClientRects(),_=b[b.length-1],T=_.top+i,E=_.left+s,M=_.right+s,A=E<y,R=FV.test(w);if(R!==f||T!==g||!h){if(h){if(t&&T!==g){v=!0;break}r.push(h)}h={box:{x:E,y:T,w:_.width,h:_.height},text:w},y=E}else A&&(h.box.x=E),h.box.w=A?h.box.w+_.width:M-h.box.x,h.text+=w;w===`
`&&(y=0),f=R,g=T,u+=w.length}return h&&r.push(h),{spans:r,didTruncate:v}}measureTextSpans(e,t){var u;if(e==="")return[];const r=(u=this.baseElm)==null?void 0:u.cloneNode();this.baseElm.insertAdjacentElement("afterend",r);const o=Math.ceil(t.width-t.padding*2);r.setAttribute("dir","auto"),r.style.setProperty("unicode-bidi","plaintext"),r.style.setProperty("width",`${o}px`),r.style.setProperty("height","min-content"),r.style.setProperty("font-size",`${t.fontSize}px`),r.style.setProperty("font-family",t.fontFamily),r.style.setProperty("font-weight",t.fontWeight),r.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),r.style.setProperty("text-align",LV[t.textAlign]);const s=t.overflow==="truncate-ellipsis"||t.overflow==="truncate-clip";s&&(r.style.setProperty("overflow-wrap","anywhere"),r.style.setProperty("word-break","break-all"));const i=qk(e);r.textContent=i;const{spans:a,didTruncate:c}=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:s});if(t.overflow==="truncate-ellipsis"&&c){r.textContent="…";const h=Math.ceil(this.measureElementTextNodeSpans(r).spans[0].box.w);r.style.setProperty("width",`${o-h}px`),r.textContent=i;const f=this.measureElementTextNodeSpans(r,{shouldTruncateToFirstLine:!0}).spans,g=f[f.length-1];return f.push({text:"…",box:{x:Math.min(g.box.x+g.box.w,t.width-t.padding-h),y:g.box.y,w:h,h:g.box.h}}),f}return r.remove(),a}}var $V=Object.create,AO=Object.defineProperty,zV=Object.getOwnPropertyDescriptor,BV=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),jO=n=>{throw TypeError(n)},RO=(n,e,t)=>e in n?AO(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,UV=n=>[,,,$V(null)],OO=["class","method","getter","setter","accessor","field","value","get","set"],DO=n=>n!==void 0&&typeof n!="function"?jO("Function expected"):n,HV=(n,e,t,r,o)=>({kind:OO[n],name:e,metadata:r,addInitializer:s=>t._?jO("Already initialized"):o.push(DO(s||null))}),KV=(n,e)=>RO(e,BV("metadata"),n[3]),WV=(n,e,t,r)=>{for(var o=0,s=n[e>>1],i=s&&s.length;o<i;o++)s[o].call(t);return r},LO=(n,e,t,r,o,s)=>{for(var i,a,c,u,h=e&7,f=!!(e&8),g=!!(e&16),y=2,v=OO[h+5],S=n[y]||(n[y]=[]),w=(o=o.prototype,zV(o,t)),b=r.length-1;b>=0;b--)c=HV(h,t,a={},n[3],S),c.static=f,c.private=g,u=c.access={has:_=>t in _},u.get=_=>_[t],i=(0,r[b])(w[v],c),a._=1,DO(i)&&(w[v]=i);return w&&AO(o,t,w),o},Fp=(n,e,t)=>RO(n,typeof e!="symbol"?e+"":e,t),FO,NO,ih;const Yk=(typeof process<"u",pA);NO=[Or],FO=[Or];class om{constructor(e){this.editor=e,WV(ih,5,this),Fp(this,"cancelRaf"),Fp(this,"isPaused",!0),Fp(this,"now",0),Fp(this,"prevPoint",new P),this.editor.disposables.add(this.dispose),this.start()}start(){var e;this.isPaused=!1,(e=this.cancelRaf)==null||e.call(this),this.cancelRaf=Yk(this.tick),this.now=Date.now()}tick(){if(this.isPaused)return;const e=Date.now(),t=e-this.now;this.now=e,this.updatePointerVelocity(t),this.editor.emit("frame",t),this.editor.emit("tick",t),this.cancelRaf=Yk(this.tick)}dispose(){var e;this.isPaused=!0,(e=this.cancelRaf)==null||e.call(this)}updatePointerVelocity(e){const{prevPoint:t,editor:{inputs:{currentScreenPoint:r,pointerVelocity:o}}}=this;if(e===0)return;const s=P.Sub(r,t);this.prevPoint=r.clone();const i=s.len(),a=i?s.div(i):new P(0,0),c=o.clone().lrp(a.mul(i/e),.5);Math.abs(c.x)<.01&&(c.x=0),Math.abs(c.y)<.01&&(c.y=0),o.equals(c)||(this.editor.inputs.pointerVelocity=c)}}ih=UV();LO(ih,1,"tick",NO,om);LO(ih,1,"dispose",FO,om);KV(ih,om);var VV=Object.create,$O=Object.defineProperty,GV=Object.getOwnPropertyDescriptor,qV=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),zO=n=>{throw TypeError(n)},BO=(n,e,t)=>e in n?$O(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,YV=n=>[,,,VV(null)],UO=["class","method","getter","setter","accessor","field","value","get","set"],HO=n=>n!==void 0&&typeof n!="function"?zO("Function expected"):n,XV=(n,e,t,r,o)=>({kind:UO[n],name:e,metadata:r,addInitializer:s=>t._?zO("Already initialized"):o.push(HO(s||null))}),ZV=(n,e)=>BO(e,qV("metadata"),n[3]),QV=(n,e,t,r)=>{for(var o=0,s=n[e>>1],i=s&&s.length;o<i;o++)s[o].call(t);return r},Ao=(n,e,t,r,o,s)=>{for(var i,a,c,u,h=e&7,f=!!(e&8),g=!!(e&16),y=2,v=UO[h+5],S=n[y]||(n[y]=[]),w=(o=o.prototype,GV(o,t)),b=r.length-1;b>=0;b--)c=XV(h,t,a={},n[3],S),c.static=f,c.private=g,u=c.access={has:_=>t in _},u.get=_=>_[t],i=(0,r[b])(w[v],c),a._=1,HO(i)&&(w[v]=i);return w&&$O(o,t,w),o},Xk=(n,e,t)=>BO(n,typeof e!="symbol"?e+"":e,t),KO,WO,VO,GO,qO,YO,XO,ZO,QO,JO,eD,tD,dr;tD=[ce],eD=[ce],JO=[ce],QO=[ce],ZO=[ce],XO=[ce],YO=[ce],qO=[ce],GO=[ce],VO=[ce],WO=[ce],KO=[ce];class $r{constructor(e,t){if(this.user=e,this.inferDarkMode=t,QV(dr,5,this),Xk(this,"systemColorScheme",dn("systemColorScheme","light")),Xk(this,"disposables",new Set),typeof window>"u"||!("matchMedia"in window))return;const r=window.matchMedia("(prefers-color-scheme: dark)");r!=null&&r.matches&&this.systemColorScheme.set("dark");const o=s=>{s.matches?this.systemColorScheme.set("dark"):this.systemColorScheme.set("light")};r==null||r.addEventListener("change",o),this.disposables.add(()=>r==null?void 0:r.removeEventListener("change",o))}dispose(){this.disposables.forEach(e=>e())}updateUserPreferences(e){this.user.setUserPreferences({...this.user.userPreferences.get(),...e})}getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),colorScheme:this.user.userPreferences.get().colorScheme,isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode(),isDynamicResizeMode:this.getIsDynamicResizeMode()}}getIsDarkMode(){switch(this.user.userPreferences.get().colorScheme){case"dark":return!0;case"light":return!1;case"system":return this.systemColorScheme.get()==="dark";default:return this.inferDarkMode?this.systemColorScheme.get()==="dark":!1}}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??bs.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??bs.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??bs.name}getLocale(){return this.user.userPreferences.get().locale??bs.locale}getColor(){return this.user.userPreferences.get().color??bs.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??bs.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??bs.isWrapMode}getIsDynamicResizeMode(){return this.user.userPreferences.get().isDynamicSizeMode??bs.isDynamicSizeMode}getIsPasteAtCursorMode(){return this.user.userPreferences.get().isPasteAtCursorMode??bs.isPasteAtCursorMode}}dr=YV();Ao(dr,1,"getUserPreferences",tD,$r);Ao(dr,1,"getIsDarkMode",eD,$r);Ao(dr,1,"getEdgeScrollSpeed",JO,$r);Ao(dr,1,"getAnimationSpeed",QO,$r);Ao(dr,1,"getId",ZO,$r);Ao(dr,1,"getName",XO,$r);Ao(dr,1,"getLocale",YO,$r);Ao(dr,1,"getColor",qO,$r);Ao(dr,1,"getIsSnapMode",GO,$r);Ao(dr,1,"getIsWrapMode",VO,$r);Ao(dr,1,"getIsDynamicResizeMode",WO,$r);Ao(dr,1,"getIsPasteAtCursorMode",KO,$r);ZV(dr,$r);const JV={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",long_press:"onLongPress",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick",tick:"onTick"},eG=["brushing","cropping","dragging","dragging_handle","drawing","erasing","lasering","resizing","rotating","scribble_brushing","translating"];class Re{constructor(e,t){j(this,"performanceTracker");j(this,"id");j(this,"type");j(this,"shapeType");j(this,"initial");j(this,"children");j(this,"isLockable");j(this,"parent");j(this,"_path");j(this,"_current");j(this,"_isActive");j(this,"_currentToolIdMask",dn("curent tool id mask",void 0));this.editor=e;const{id:r,children:o,initial:s,isLockable:i}=this.constructor;this.id=r,this._isActive=dn("toolIsActive"+this.id,!1),this._current=dn("toolState"+this.id,void 0),this._path=ce("toolPath"+this.id,()=>{const a=this.getCurrent();return this.id+(a?`.${a.getPath()}`:"")}),this.parent=t??{},this.parent?o&&s?(this.type="branch",this.initial=s,this.children=Object.fromEntries(o().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",o&&s&&(this.initial=s,this.children=Object.fromEntries(o().map(a=>[a.id,new a(this.editor,this)])),this._current.set(this.children[this.initial]))),this.isLockable=i,this.performanceTracker=new VM}getPath(){return this._path.get()}getCurrent(){return this._current.get()}getIsActive(){return this._isActive.get()}transition(e,t={}){var s;const r=e.split(".");let o=this;for(let i=0;i<r.length;i++){const a=r[i],c=o.getCurrent(),u=(s=o.children)==null?void 0:s[a];if(!u)throw Error(`${o.id} - no child state exists with the id ${a}.`);if((c==null?void 0:c.id)!==u.id&&(c==null||c.exit(t,a),o._current.set(u),u.enter(t,(c==null?void 0:c.id)||"initial"),!u.getIsActive()))break;o=u}return this}handleEvent(e){var o;const t=JV[e.name],r=this._current.__unsafe__getWithoutCapture();(o=this[t])==null||o.call(this,e),this._isActive.__unsafe__getWithoutCapture()&&r&&r===this._current.__unsafe__getWithoutCapture()&&r.handleEvent(e)}enter(e,t){var r;if(sn.measurePerformance.get()&&eG.includes(this.id)&&this.performanceTracker.start(this.id),this._isActive.set(!0),(r=this.onEnter)==null||r.call(this,e,t),this.children&&this.initial&&this.getIsActive()){const o=this.children[this.initial];this._current.set(o),o.enter(e,t)}}exit(e,t){var r,o;sn.measurePerformance.get()&&this.performanceTracker.isStarted()&&this.performanceTracker.stop(),this._isActive.set(!1),(r=this.onExit)==null||r.call(this,e,t),this.getIsActive()||(o=this.getCurrent())==null||o.exit(e,t)}getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}}j(Re,"id"),j(Re,"initial"),j(Re,"children"),j(Re,"isLockable",!0);class bw extends Re{static children(){return[]}onKeyDown(e){var t;switch(e.code){case"KeyZ":{if(!(e.shiftKey||e.ctrlKey)){const r=this.getCurrent();r&&((t=r.getCurrent())==null?void 0:t.id)==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:r.id})}break}}}}j(bw,"id","root"),j(bw,"initial","");var tG=Object.create,nD=Object.defineProperty,nG=Object.getOwnPropertyDescriptor,rD=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),oD=n=>{throw TypeError(n)},sD=(n,e,t)=>e in n?nD(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,rG=n=>[,,,tG((n==null?void 0:n[rD("metadata")])??null)],iD=["class","method","getter","setter","accessor","field","value","get","set"],aD=n=>n!==void 0&&typeof n!="function"?oD("Function expected"):n,oG=(n,e,t,r,o)=>({kind:iD[n],name:e,metadata:r,addInitializer:s=>t._?oD("Already initialized"):o.push(aD(s||null))}),sG=(n,e)=>sD(e,rD("metadata"),n[3]),iG=(n,e,t,r)=>{for(var o=0,s=n[e>>1],i=s&&s.length;o<i;o++)s[o].call(t);return r},Ce=(n,e,t,r,o,s)=>{for(var i,a,c,u,h=e&7,f=!!(e&8),g=!!(e&16),y=2,v=iD[h+5],S=n[y]||(n[y]=[]),w=(o=o.prototype,nG(o,t)),b=r.length-1;b>=0;b--)c=oG(h,t,a={},n[3],S),c.static=f,c.private=g,u=c.access={has:_=>t in _},u.get=_=>_[t],i=(0,r[b])(w[v],c),a._=1,aD(i)&&(w[v]=i);return w&&nD(o,t,w),o},ze=(n,e,t)=>sD(n,typeof e!="symbol"?e+"":e,t),lD,cD,uD,dD,hD,pD,fD,gD,mD,yD,vD,SD,xD,wD,bD,_D,PD,CD,ID,ED,kD,TD,MD,AD,jD,RD,OD,DD,LD,FD,ND,$D,zD,BD,UD,HD,KD,WD,VD,GD,qD,YD,XD,ZD,QD,JD,e3,t3,n3,r3,o3,s3,i3,a3,l3,c3,u3,d3,h3,p3,f3,g3,m3,y3,v3,S3,x3,w3,b3,_3,P3,C3,_w,Pe;class be extends(_w=_K,C3=[ce],P3=[ce],_3=[ce],b3=[ce],w3=[ce],x3=[ce],S3=[ce],v3=[ce],y3=[ce],m3=[ce],g3=[ce],f3=[ce],p3=[ce],h3=[ce],d3=[ce],u3=[ce],c3=[ce],l3=[ce],a3=[ce],i3=[ce],s3=[ce],o3=[ce],r3=[ce],n3=[ce],t3=[ce],e3=[ce],JD=[ce],QD=[ce],ZD=[ce],XD=[ce],YD=[ce],qD=[ce],GD=[ce],VD=[ce],WD=[ce],KD=[ce],HD=[ce],UD=[ce],BD=[ce],zD=[ce],$D=[ce],ND=[ce],FD=[ce],LD=[ce],DD=[ce],OD=[ce],RD=[ce],jD=[ce],AD=[ce],MD=[ce],TD=[ce],kD=[ce],ED=[ce],ID=[ce],CD=[ce],PD=[ce],_D=[ce],bD=[ce],wD=[ce],xD=[ce],SD=[ce],vD=[ce],yD=[ce],mD=[ce],gD=[ce({isEqual:(e,t)=>e.equals(t)})],fD=[ce],pD=[ce],hD=[ce],dD=[Or],uD=[Or],cD=[Or],lD=[Or],_w){constructor({store:e,user:t,shapeUtils:r,bindingUtils:o,tools:s,getContainer:i,cameraOptions:a,initialState:c,autoFocus:u,inferDarkMode:h,options:f,isShapeHidden:g}){var K;super(),iG(Pe,5,this),ze(this,"_isShapeHiddenPredicate"),ze(this,"options"),ze(this,"contextId",bt()),ze(this,"store"),ze(this,"root"),ze(this,"disposables",new Set),ze(this,"isDisposed",!1),ze(this,"_tickManager"),ze(this,"snaps"),ze(this,"timers",xw.forContext(this.contextId)),ze(this,"user"),ze(this,"textMeasure"),ze(this,"environment",kt),ze(this,"scribbles"),ze(this,"sideEffects"),ze(this,"edgeScrollManager"),ze(this,"focusManager"),ze(this,"getContainer"),ze(this,"shapeUtils"),ze(this,"styleProps"),ze(this,"bindingUtils"),ze(this,"history"),ze(this,"_shouldIgnoreShapeLock",!1),ze(this,"_crashingError",null),ze(this,"_isChangingStyleTimeout",-1),ze(this,"menus",Go.forContext(this.contextId)),ze(this,"_cameraOptions",dn("camera options",ck)),ze(this,"_viewportAnimation",null),ze(this,"_willSetInitialBounds",!0),ze(this,"_isLockedOnFollowingUser",dn("isLockedOnFollowingUser",!1)),ze(this,"_cameraState",dn("camera state","idle")),ze(this,"_cameraStateTimeoutRemaining",0),ze(this,"_currentPageShapeIds"),ze(this,"_parentIdsToChildIds"),ze(this,"animatingShapes",new Map),ze(this,"externalAssetContentHandlers",{file:null,url:null}),ze(this,"temporaryAssetPreview",new Map),ze(this,"externalContentHandlers",{text:null,files:null,embed:null,"svg-text":null,url:null}),ze(this,"inputs",{originPagePoint:new P,originScreenPoint:new P,previousPagePoint:new P,previousScreenPoint:new P,currentPagePoint:new P,currentScreenPoint:new P,keys:new Set,buttons:new Set,isPen:!1,shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1,isDragging:!1,isPointing:!1,isPinching:!1,isEditing:!1,isPanning:!1,isSpacebarPanning:!1,pointerVelocity:new P}),ze(this,"_clickManager",new tm(this)),ze(this,"_prevCursor","default"),ze(this,"_shiftKeyTimeout",-1),ze(this,"_altKeyTimeout",-1),ze(this,"_ctrlKeyTimeout",-1),ze(this,"_metaKeyTimeout",-1),ze(this,"_restoreToolId","select"),ze(this,"_pinchStart",1),ze(this,"_didPinch",!1),ze(this,"_selectedShapeIdsAtPointerDown",[]),ze(this,"_longPressTimeout",-1),ze(this,"capturedPointerId",null),ze(this,"performanceTracker"),ze(this,"performanceTrackerTimeout",-1),ze(this,"_pendingEventsForNextTick",[]),this._isShapeHiddenPredicate=g,this.options={...MW,...f},this.store=e,this.disposables.add(this.store.dispose.bind(this.store)),this.history=new oV({store:e,annotateError:D=>{this.annotateError(D,{origin:"history.batch",willCrashApp:!0}),this.crash(D)}}),this.snaps=new sh(this),this.disposables.add(this.timers.dispose),this._cameraOptions.set({...ck,...a}),this.user=new $r(t??_R(),h??!1),this.disposables.add(()=>this.user.dispose()),this.getContainer=i,this.textMeasure=new NV(this),this._tickManager=new om(this);class y extends bw{}j(y,"initial",c??""),this.root=new y(this),this.root.children={};const v=MR(r),S={},w={},b=new Map;for(const D of v){const U=new D(this);S[D.type]=U;const V=rj(D.props??{});w[D.type]=V;for(const F of V.keys())if(!b.has(F.id))b.set(F.id,F);else if(b.get(F.id)!==F)throw Error(`Multiple style props with id "${F.id}" in use. Style prop IDs must be unique.`)}this.shapeUtils=S,this.styleProps=w;const _=kR(o),T={};for(const D of _){const U=new D(this);T[D.type]=U}this.bindingUtils=T;for(const D of[...s]){if(Qo(this.root.children,D.id))throw Error(`Can't override tool with id "${D.id}"`);this.root.children[D.id]=new D(this,this.root)}this.scribbles=new aV(this);const E=(D,U)=>{let V=null;const F=D.selectedShapeIds.filter(Z=>!U.has(Z));F.length!==D.selectedShapeIds.length&&(V||(V={...D}),V.selectedShapeIds=F);const $=D.erasingShapeIds.filter(Z=>!U.has(Z));$.length!==D.erasingShapeIds.length&&(V||(V={...D}),V.erasingShapeIds=$),D.hoveredShapeId&&U.has(D.hoveredShapeId)&&(V||(V={...D}),V.hoveredShapeId=null),D.editingShapeId&&U.has(D.editingShapeId)&&(V||(V={...D}),V.editingShapeId=null);const H=D.hintingShapeIds.filter(Z=>!U.has(Z));return H.length!==D.hintingShapeIds.length&&(V||(V={...D}),V.hintingShapeIds=H),D.focusedGroupId&&U.has(D.focusedGroupId)&&(V||(V={...D}),V.focusedGroupId=null),V};this.sideEffects=this.store.sideEffects;let M=new Map;const A=new Set,R=new Set;let L=new Set;if(this.disposables.add(this.sideEffects.registerOperationCompleteHandler(()=>{var D,U,V,F;A.clear();for(const $ of R){R.delete($);const H=this.getShape($);if(!H)continue;const Z=this.getShapeUtil(H),G=(D=Z.onChildrenChange)==null?void 0:D.call(Z,H);G!=null&&G.length&&this.updateShapes(G)}if(L.size){const $=L;L=new Set;for(const H of $){const Z=this.getBindingUtil(H);(U=Z.onOperationComplete)==null||U.call(Z)}}if(M.size){const $=M;M=new Map;for(const H of $.values())(F=(V=this.getBindingUtil(H.binding)).onAfterDelete)==null||F.call(V,H)}this.emit("update")})),this.disposables.add(this.sideEffects.register({shape:{afterChange:(D,U)=>{var V,F,$,H;for(const Z of this.getBindingsInvolvingShape(U))L.add(Z.type),Z.fromId===U.id&&((F=(V=this.getBindingUtil(Z)).onAfterChangeFromShape)==null||F.call(V,{binding:Z,shapeBefore:D,shapeAfter:U})),Z.toId===U.id&&((H=($=this.getBindingUtil(Z)).onAfterChangeToShape)==null||H.call($,{binding:Z,shapeBefore:D,shapeAfter:U}));if(D.parentId!==U.parentId){const Z=G=>{var Q,ae,B,oe;const q=this.getShape(G);if(q)for(const pe of this.getBindingsInvolvingShape(q))L.add(pe.type),pe.fromId===q.id&&((ae=(Q=this.getBindingUtil(pe)).onAfterChangeFromShape)==null||ae.call(Q,{binding:pe,shapeBefore:q,shapeAfter:q})),pe.toId===q.id&&((oe=(B=this.getBindingUtil(pe)).onAfterChangeToShape)==null||oe.call(B,{binding:pe,shapeBefore:q,shapeAfter:q}))};Z(U.id),this.visitDescendants(U.id,Z)}if(D.parentId!==U.parentId&&Ir(U.parentId)){const Z=new Set([D.id]);this.visitDescendants(D.id,G=>{Z.add(G)});for(const G of this.getPageStates()){if(G.pageId===U.parentId)continue;const q=E(G,Z);q&&this.store.put([q])}}D.parentId&&Tr(D.parentId)&&R.add(D.parentId),U.parentId!==D.parentId&&Tr(U.parentId)&&R.add(U.parentId)},beforeDelete:D=>{var $,H,Z,G;if(A.has(D.id))return;D.parentId&&Tr(D.parentId)&&R.add(D.parentId),A.add(D.id);const U=[];for(const q of this.getBindingsInvolvingShape(D)){L.add(q.type),U.push(q.id);const Q=this.getBindingUtil(q);q.fromId===D.id?(($=Q.onBeforeIsolateToShape)==null||$.call(Q,{binding:q,removedShape:D}),(H=Q.onBeforeDeleteFromShape)==null||H.call(Q,{binding:q,shape:D})):((Z=Q.onBeforeIsolateFromShape)==null||Z.call(Q,{binding:q,removedShape:D}),(G=Q.onBeforeDeleteToShape)==null||G.call(Q,{binding:q,shape:D}))}U.length&&this.deleteBindings(U);const V=new Set([D.id]),F=Ze(this.getPageStates().map(q=>E(q,V)));F.length&&this.store.put(F)}},binding:{beforeCreate:D=>{var V,F;const U=(F=(V=this.getBindingUtil(D)).onBeforeCreate)==null?void 0:F.call(V,{binding:D});return U||D},afterCreate:D=>{var U,V;L.add(D.type),(V=(U=this.getBindingUtil(D)).onAfterCreate)==null||V.call(U,{binding:D})},beforeChange:(D,U)=>{var F,$;const V=($=(F=this.getBindingUtil(U)).onBeforeChange)==null?void 0:$.call(F,{bindingBefore:D,bindingAfter:U});return V||U},afterChange:(D,U)=>{var V,F;L.add(U.type),(F=(V=this.getBindingUtil(U)).onAfterChange)==null||F.call(V,{bindingBefore:D,bindingAfter:U})},beforeDelete:D=>{var U,V;(V=(U=this.getBindingUtil(D)).onBeforeDelete)==null||V.call(U,{binding:D})},afterDelete:D=>{var U,V;(V=(U=this.getBindingUtil(D)).onAfterDelete)==null||V.call(U,{binding:D}),L.add(D.type)}},page:{afterCreate:D=>{const U=Es.createId(D.id),V=Xo.createId(D.id);this.store.has(U)||this.store.put([Es.create({id:U})]),this.store.has(V)||this.store.put([Xo.create({id:V,pageId:D.id})])},afterDelete:(D,U)=>{var $,H;if((($=this.getInstanceState())==null?void 0:$.currentPageId)===D.id){const Z=(H=this.getPages().find(G=>G.id!==D.id))==null?void 0:H.id;Z?this.store.put([{...this.getInstanceState(),currentPageId:Z}]):U==="user"&&this.store.ensureStoreIsUsable()}const V=Es.createId(D.id),F=Xo.createId(D.id);this.store.remove([V,F])}},instance:{afterChange:(D,U,V)=>{var F;if(!this.store.has(U.currentPageId)){const $=this.store.has(D.currentPageId)?D.currentPageId:(F=this.getPages()[0])==null?void 0:F.id;$?this.store.update(U.id,H=>({...H,currentPageId:$})):V==="user"&&this.store.ensureStoreIsUsable()}}},instance_page_state:{afterChange:(D,U)=>{if((D==null?void 0:D.selectedShapeIds)!==(U==null?void 0:U.selectedShapeIds)){const V=U.selectedShapeIds.filter($=>{var Z,G;let H=(Z=this.getShape($))==null?void 0:Z.parentId;for(;Tr(H);){if(U.selectedShapeIds.includes(H))return!1;H=(G=this.getShape(H))==null?void 0:G.parentId}return!0});let F=null;if(V.length>0){const $=this.findCommonAncestor(Ze(V.map(H=>this.getShape(H))),H=>this.isShapeOfType(H,"group"));$&&(F=$)}else U!=null&&U.focusedGroupId&&(F=U.focusedGroupId);(V.length!==U.selectedShapeIds.length||F!==U.focusedGroupId)&&this.store.put([{...U,selectedShapeIds:V,focusedGroupId:F??null}])}}}})),this._currentPageShapeIds=WW(this.store,()=>this.getCurrentPageId()),this._parentIdsToChildIds=KW(this.store),this.disposables.add(this.store.listen(D=>{this.emit("change",D)})),this.disposables.add(this.history.dispose),this.run(()=>{this.store.ensureStoreIsUsable(),this._updateCurrentPageState({editingShapeId:null,hoveredShapeId:null,erasingShapeIds:[]})},{history:"ignore"}),c&&this.root.children[c]===void 0)throw Error(`No state found for initialState "${c}".`);if(this.root.enter(void 0,"initial"),this.edgeScrollManager=new eV(this),this.focusManager=new tV(this,u),this.disposables.add(this.focusManager.dispose.bind(this.focusManager)),this.getInstanceState().followingUserId&&this.stopFollowingUser(),this.on("tick",this._flushEventsForTick),this.timers.requestAnimationFrame(()=>{this._tickManager.start()}),this.performanceTracker=new VM,(K=this.store.props.collaboration)!=null&&K.mode){const D=this.store.props.collaboration.mode;this.disposables.add(Ms("update collaboration mode",()=>{this.store.put([{...this.getInstanceState(),isReadonly:D.get()==="readonly"}])}))}}getIsShapeHiddenCache(){return this._isShapeHiddenPredicate?this.store.createComputedCache("isShapeHidden",e=>this.findShapeAncestor(e,r=>this.isShapeHidden(r))?!0:this._isShapeHiddenPredicate(e,this)??!1):null}isShapeHidden(e){return this._isShapeHiddenPredicate?!!this.getIsShapeHiddenCache().get(typeof e=="string"?e:e.id):!1}dispose(){this.disposables.forEach(e=>e()),this.disposables.clear(),this.isDisposed=!0}getShapeUtil(e){const t=typeof e=="string"?e:e.type,r=Yn(this.shapeUtils,t);return yt(r,`No shape util found for type "${t}"`),r}getBindingUtil(e){const t=typeof e=="string"?e:e.type,r=Yn(this.bindingUtils,t);return yt(r,`No binding util found for type "${t}"`),r}undo(){return this._flushEventsForTick(0),this.complete(),this.history.undo(),this}getCanUndo(){return this.history.getNumUndos()>0}redo(){return this._flushEventsForTick(0),this.complete(),this.history.redo(),this}clearHistory(){return this.history.clear(),this}getCanRedo(){return this.history.getNumRedos()>0}mark(e){return console.warn(typeof e=="string"?`[tldraw] \`editor.history.mark("${e}")\` is deprecated. Please use \`const myMarkId = editor.markHistoryStoppingPoint()\` instead.`:"[tldraw] `editor.mark()` is deprecated. Use `editor.markHistoryStoppingPoint()` instead."),this.history._mark(e??bt()),this}markHistoryStoppingPoint(e){const t=`[${e??"stop"}]_${bt()}`;return this.history._mark(t),t}getMarkIdMatching(e){return this.history.getMarkIdMatching(e)}squashToMark(e){return this.history.squashToMark(e),this}bail(){return this.history.bail(),this}bailToMark(e){return this.history.bailToMark(e),this}run(e,t){const r=this._shouldIgnoreShapeLock;this._shouldIgnoreShapeLock=(t==null?void 0:t.ignoreShapeLock)??r;try{this.history.batch(e,t)}finally{this._shouldIgnoreShapeLock=r}return this}batch(e,t){return this.run(e,t)}annotateError(e,{origin:t,willCrashApp:r,tags:o,extras:s}){const i=this.createErrorAnnotations(t,r);return Cb(e,{tags:{...i.tags,...o},extras:{...i.extras,...s}}),r&&this.store.markAsPossiblyCorrupted(),this}createErrorAnnotations(e,t){try{const r=this.getEditingShapeId();return{tags:{origin:e,willCrashApp:t},extras:{activeStateNode:this.root.getPath(),selectedShapes:this.getSelectedShapes(),editingShape:r?this.getShape(r):void 0,inputs:this.inputs}}}catch{return{tags:{origin:e,willCrashApp:t},extras:{}}}}getCrashingError(){return this._crashingError}crash(e){return this._crashingError=e,this.store.markAsPossiblyCorrupted(),this.emit("crash",{error:e}),this}getPath(){return this.root.getPath().split("root.")[1]}isIn(e){const t=e.split(".").reverse();let r=this.root;for(;t.length>0;){const o=t.pop();if(!o)return!0;const s=r.getCurrent();if((s==null?void 0:s.id)===o){if(t.length===0)return!0;r=s;continue}else return!1}return!1}isInAny(...e){return e.some(t=>this.isIn(t))}setCurrentTool(e,t={}){return this.root.transition(e,t),this}getCurrentTool(){return this.root.getCurrent()}getCurrentToolId(){const e=this.getCurrentTool();return e?e.getCurrentToolIdMask()??e.id:""}getStateDescendant(e){var o;const t=e.split(".").reverse();let r=this.root;for(;t.length>0;){const s=t.pop();if(!s)return r;const i=(o=r.children)==null?void 0:o[s];if(!i)return;r=i}return r}getDocumentSettings(){return this.store.get(cw)}updateDocumentSettings(e){return this.run(()=>{this.store.put([{...this.getDocumentSettings(),...e}])},{history:"ignore"}),this}getInstanceState(){return this.store.get(ir)}updateInstanceState(e,t){return this._updateInstanceState(e,{history:"ignore",...t}),e.isChangingStyle!==void 0&&(clearTimeout(this._isChangingStyleTimeout),e.isChangingStyle===!0&&(this._isChangingStyleTimeout=this.timers.setTimeout(()=>{this._updateInstanceState({isChangingStyle:!1},{history:"ignore"})},2e3))),this}_updateInstanceState(e,t){this.run(()=>{this.store.put([{...this.getInstanceState(),...e}])},t)}getOpenMenus(){return this.menus.getOpenMenus()}addOpenMenu(e){return this.menus.addOpenMenu(e),this}deleteOpenMenu(e){return this.menus.deleteOpenMenu(e),this}clearOpenMenus(){return this.menus.clearOpenMenus(),this}getIsMenuOpen(){return this.menus.hasAnyOpenMenus()}setCursor(e){return this.updateInstanceState({cursor:{...this.getInstanceState().cursor,...e}}),this}getPageStates(){return this._getPageStatesQuery().get()}_getPageStatesQuery(){return this.store.query.records("instance_page_state")}getCurrentPageState(){return this.store.get(this._getCurrentPageStateId())}_getCurrentPageStateId(){return Xo.createId(this.getCurrentPageId())}updateCurrentPageState(e){return this._updateCurrentPageState(e),this}_updateCurrentPageState(e){this.store.update(e.id??this.getCurrentPageState().id,t=>({...t,...e}))}getSelectedShapeIds(){return this.getCurrentPageState().selectedShapeIds}getSelectedShapes(){const{selectedShapeIds:e}=this.getCurrentPageState();return Ze(e.map(t=>this.store.get(t)))}setSelectedShapes(e){return this.run(()=>{const t=e.map(s=>typeof s=="string"?s:s.id),{selectedShapeIds:r}=this.getCurrentPageState(),o=new Set(r);if(t.length===o.size&&t.every(s=>o.has(s)))return null;this.store.put([{...this.getCurrentPageState(),selectedShapeIds:t}])},{history:"record-preserveRedoStack"})}isAncestorSelected(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null,r=this.getShape(t);if(!r)return!1;const o=this.getSelectedShapeIds();return!!this.findShapeAncestor(r,s=>o.includes(s.id))}select(...e){const t=typeof e[0]=="string"?e:e.map(r=>r.id);return this.setSelectedShapes(t),this}deselect(...e){const t=typeof e[0]=="string"?e:e.map(o=>o.id),r=this.getSelectedShapeIds();return r.length>0&&t.length>0&&this.setSelectedShapes(r.filter(o=>!t.includes(o))),this}selectAll(){const e=this.getSortedChildIdsForParent(this.getCurrentPageId());return e.length<=0?this:(this.setSelectedShapes(this._getUnlockedShapeIds(e)),this)}selectNone(){return this.getSelectedShapeIds().length>0&&this.setSelectedShapes([]),this}getOnlySelectedShapeId(){var e;return((e=this.getOnlySelectedShape())==null?void 0:e.id)??null}getOnlySelectedShape(){const e=this.getSelectedShapes();return e.length===1?e[0]:null}getShapesPageBounds(e){const t=Ze(e.map(r=>this.getShapePageBounds(r)));return t.length===0?null:xe.Common(t)}getSelectionPageBounds(){return this.getShapesPageBounds(this.getSelectedShapeIds())}getShapesSharedRotation(e){let t=!1,r=0;for(let o=0,s=e.length;o<s;o++){const i=this.getShapePageTransform(e[o]);if(i)if(t){if(i.rotation()!==r)return 0}else t=!0,r=i.rotation()}return r}getSelectionRotation(){return this.getShapesSharedRotation(this.getSelectedShapeIds())}getShapesRotatedPageBounds(e){if(e.length===0)return;const t=this.getShapesSharedRotation(e);if(t===0)return this.getShapesPageBounds(e)??void 0;if(e.length===1){const o=this.getShapeGeometry(e[0]).bounds.clone(),s=this.getShapePageTransform(e[0]);return o.point=s.applyToPoint(o.point),o}const r=xe.FromPoints(e.flatMap(o=>{const s=this.getShapePageTransform(o);return s?s.applyToPoints(this.getShapeGeometry(o).bounds.corners):[]}).map(o=>o.rot(-t)));return r.point=r.point.rot(t),r}getSelectionRotatedPageBounds(){return this.getShapesRotatedPageBounds(this.getSelectedShapeIds())}getSelectionRotatedScreenBounds(){const e=this.getSelectionRotatedPageBounds();if(!e)return;const{x:t,y:r}=this.pageToScreen(e.point),o=this.getZoomLevel();return new xe(t,r,e.width*o,e.height*o)}getFocusedGroupId(){return this.getCurrentPageState().focusedGroupId??this.getCurrentPageId()}getFocusedGroup(){const e=this.getFocusedGroupId();return e?this.getShape(e):void 0}setFocusedGroup(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(t!==null){const r=this.getShape(t);if(!r)throw Error(`Editor.setFocusedGroup: Shape with id ${t} does not exist`);if(!this.isShapeOfType(r,"group"))throw Error(`Editor.setFocusedGroup: Cannot set focused group to shape of type ${r.type}`)}return t===this.getFocusedGroupId()?this:this.run(()=>{this.store.update(this.getCurrentPageState().id,r=>({...r,focusedGroupId:t}))},{history:"record-preserveRedoStack"})}popFocusedGroupId(){const e=this.getFocusedGroup();if(e){const t=this.findShapeAncestor(e,r=>this.isShapeOfType(r,"group"));this.setFocusedGroup((t==null?void 0:t.id)??null),this.select(e.id)}else this.setFocusedGroup(null),this.selectNone();return this}getEditingShapeId(){return this.getCurrentPageState().editingShapeId}getEditingShape(){const e=this.getEditingShapeId();return e?this.getShape(e):void 0}setEditingShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;if(t!==this.getEditingShapeId()){if(t){const r=this.getShape(t);if(r&&this.getShapeUtil(r).canEdit(r))return this.run(()=>{this._updateCurrentPageState({editingShapeId:t})},{history:"ignore"}),this}this.run(()=>{this._updateCurrentPageState({editingShapeId:null})},{history:"ignore"})}return this}getHoveredShapeId(){return this.getCurrentPageState().hoveredShapeId}getHoveredShape(){const e=this.getHoveredShapeId();return e?this.getShape(e):void 0}setHoveredShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;return t===this.getHoveredShapeId()?this:(this.run(()=>{this.updateCurrentPageState({hoveredShapeId:t})},{history:"ignore"}),this)}getHintingShapeIds(){return this.getCurrentPageState().hintingShapeIds}getHintingShape(){const e=this.getHintingShapeIds();return Ze(e.map(t=>this.getShape(t)))}setHintingShapes(e){const t=typeof e[0]=="string"?e:e.map(r=>r.id);return this.run(()=>{this._updateCurrentPageState({hintingShapeIds:_b(t)})},{history:"ignore"}),this}getErasingShapeIds(){return this.getCurrentPageState().erasingShapeIds}getErasingShapes(){const e=this.getErasingShapeIds();return Ze(e.map(t=>this.getShape(t)))}setErasingShapes(e){const t=typeof e[0]=="string"?e:e.map(o=>o.id);t.sort();const r=this.getErasingShapeIds();return this.run(()=>{if(t.length===r.length){for(let o=0;o<t.length;o++)if(t[o]!==r[o]){this._updateCurrentPageState({erasingShapeIds:t});break}}else this._updateCurrentPageState({erasingShapeIds:t})},{history:"ignore"}),this}getCroppingShapeId(){return this.getCurrentPageState().croppingShapeId}setCroppingShape(e){const t=typeof e=="string"?e:(e==null?void 0:e.id)??null;return t!==this.getCroppingShapeId()&&this.run(()=>{if(!t)this.updateCurrentPageState({croppingShapeId:null});else{const r=this.getShape(t),o=this.getShapeUtil(r);r&&o.canCrop(r)&&this.updateCurrentPageState({croppingShapeId:t})}},{history:"ignore"}),this}_unsafe_getCameraId(){return Es.createId(this.getCurrentPageId())}getCamera(){const e=this.store.get(this._unsafe_getCameraId());if(this._isLockedOnFollowingUser.get()){const t=this.getCameraForFollowing();if(t)return{...e,...t}}return e}getViewportPageBoundsForFollowing(){const e=this.getInstanceState().followingUserId;if(!e)return null;const t=this.getCollaborators().find(f=>f.userId===e);if(!t)return null;const{w:r,h:o}=t.screenBounds,{x:s,y:i,z:a}=t.camera,c=new xe(-s,-i,r/a,o/a),u=this.getViewportScreenBounds().clone(),h=u.width/u.height;return u.width=c.width,u.height=u.width/h,u.height<c.height&&(u.height=c.height,u.width=u.height*h),u.center=c.center,u}getCameraForFollowing(){const e=this.getViewportPageBoundsForFollowing();return e?{x:-e.x,y:-e.y,z:this.getViewportScreenBounds().w/e.width}:null}getZoomLevel(){return this.getCamera().z}getInitialZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.initialZoom==="default")return 1;const{zx:t,zy:r}=Qk(this,e);switch(e.constraints.initialZoom){case"fit-min":return Math.max(t,r);case"fit-max":return Math.min(t,r);case"fit-x":return t;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(t,r));case"fit-max-100":return Math.min(1,Math.min(t,r));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,r);default:throw Sn(e.constraints.initialZoom)}}getBaseZoom(){const e=this.getCameraOptions();if(!e.constraints||e.constraints.baseZoom==="default")return 1;const{zx:t,zy:r}=Qk(this,e);switch(e.constraints.baseZoom){case"fit-min":return Math.max(t,r);case"fit-max":return Math.min(t,r);case"fit-x":return t;case"fit-y":return r;case"fit-min-100":return Math.min(1,Math.max(t,r));case"fit-max-100":return Math.min(1,Math.min(t,r));case"fit-x-100":return Math.min(1,t);case"fit-y-100":return Math.min(1,r);default:throw Sn(e.constraints.baseZoom)}}getCameraOptions(){return this._cameraOptions.get()}setCameraOptions(e){var r;const t=zt({...this._cameraOptions.__unsafe__getWithoutCapture(),...e});return((r=t.zoomSteps)==null?void 0:r.length)<1&&(t.zoomSteps=[1]),this._cameraOptions.set(t),this.setCamera(this.getCamera()),this}getConstrainedCamera(e,t){const r=this.getCamera();let{x:o,y:s,z:i=r.z}=e;if(!(t!=null&&t.force)){const a=this.getCameraOptions(),c=a.zoomSteps[0],u=En(a.zoomSteps),h=this.getViewportScreenBounds();if(a.constraints){const{constraints:f}=a,g=Math.min(f.padding.y,h.w/2),y=Math.min(f.padding.x,h.h/2),v=xe.From(a.constraints.bounds),S=(h.w-y*2)/v.w,w=(h.h-g*2)/v.h,b=this.getBaseZoom(),_=u*b,T=c*b;if(t!=null&&t.reset&&(i=this.getInitialZoom()),i<T||i>_){const{x:V,y:F,z:$}=r,H=-V+h.w/$/2,Z=-F+h.h/$/2;i=Cn(i,T,_);const G=-V+h.w/i/2,q=-F+h.h/i/2;o=V+G-H,s=F+q-Z}const E=y/i-v.x,M=g/i-v.y,A=(h.w-y*2)/i-v.w,R=(h.h-g*2)/i-v.h,L=E+A*f.origin.x,K=M+R*f.origin.y,D=typeof f.behavior=="string"?f.behavior:f.behavior.x,U=typeof f.behavior=="string"?f.behavior:f.behavior.y;if(t!=null&&t.reset)o=L,s=K;else{switch(D){case"fixed":{o=L;break}case"contain":{i<S?o=L:o=Cn(o,E+A,E);break}case"inside":{i<S?o=Cn(o,E,(h.w-y)/i-v.w):o=Cn(o,E+A,E);break}case"outside":{o=Cn(o,y/i-v.w,(h.w-y)/i);break}case"free":break;default:throw Sn(D)}switch(U){case"fixed":{s=K;break}case"contain":{i<w?s=K:s=Cn(s,M+R,M);break}case"inside":{i<w?s=Cn(s,M,(h.h-g)/i-v.h):s=Cn(s,M+R,M);break}case"outside":{s=Cn(s,g/i-v.h,(h.h-g)/i);break}case"free":break;default:throw Sn(U)}}}else if(i>u||i<c){const{x:f,y:g,z:y}=r;i=Cn(i,c,u),o=f+(-f+h.w/i/2)-(-f+h.w/y/2),s=g+(-g+h.h/i/2)-(-g+h.h/y/2)}}return{x:o,y:s,z:i}}_setCamera(e,t){const r=this.getCamera(),{x:o,y:s,z:i}=this.getConstrainedCamera(e,t);return r.x===o&&r.y===s&&r.z===i?this:(As(()=>{const a={...r,x:o,y:s,z:i};this.run(()=>{this.store.put([a])},{history:"ignore"});const{currentScreenPoint:c,currentPagePoint:u}=this.inputs,{screenBounds:h}=this.store.unsafeGetWithoutCapture(ir);if(c.x/i-o!==u.x||c.y/i-s!==u.y){const f={type:"pointer",target:"canvas",name:"pointer_move",point:P.AddXY(c,h.x,h.y),pointerId:uk.CAMERA_MOVE,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,shiftKey:this.inputs.shiftKey,metaKey:this.inputs.metaKey,accelKey:qn(this.inputs),button:0,isPen:this.getInstanceState().isPenMode??!1};t!=null&&t.immediate?this._flushEventForTick(f):this.dispatch(f)}this._tickCameraState()}),this)}setCamera(e,t){const{isLocked:r}=this._cameraOptions.__unsafe__getWithoutCapture();if(r&&!(t!=null&&t.force))return this;this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser();const o=P.Cast(e);Number.isFinite(o.x)||(o.x=0),Number.isFinite(o.y)||(o.y=0),(o.z===void 0||!Number.isFinite(o.z))&&(e.z=this.getZoomLevel());const s=this.getConstrainedCamera(o,t);if(t!=null&&t.animation){const{width:i,height:a}=this.getViewportScreenBounds();this._animateToViewport(new xe(-s.x,-s.y,i/s.z,a/s.z),t)}else this._setCamera(s,{...t,force:!0});return this}centerOnPoint(e,t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const{width:o,height:s}=this.getViewportPageBounds();return this.setCamera(new P(-(e.x-o/2),-(e.y-s/2),this.getCamera().z),t),this}zoomToFit(e){const t=[...this.getCurrentPageShapeIds()];if(t.length<=0)return this;const r=xe.Common(Ze(t.map(o=>this.getShapePageBounds(o))));return this.zoomToBounds(r,e),this}resetZoom(e=this.getViewportScreenCenter(),t){const{isLocked:r,constraints:o}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const s=this.getCamera(),{x:i,y:a,z:c}=s,{x:u,y:h}=e;let f=1;if(o){const g=this.getInitialZoom();c!==g&&(f=g)}return this.setCamera(new P(i+(u/f-u)-(u/c-u),a+(h/f-h)-(h/c-h),f),t),this}zoomIn(e=this.getViewportScreenCenter(),t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const{x:o,y:s,z:i}=this.getCamera(),{zoomSteps:a}=this.getCameraOptions();if(a!==null&&a.length>1){const c=this.getBaseZoom();let u=En(a)*c;for(let h=1;h<a.length;h++){const f=a[h-1]*c,g=a[h]*c;if(!(g-i<=(g-f)/2)){u=g;break}}this.setCamera(new P(o+(e.x/u-e.x)-(e.x/i-e.x),s+(e.y/u-e.y)-(e.y/i-e.y),u),t)}return this}zoomOut(e=this.getViewportScreenCenter(),t){const{isLocked:r}=this.getCameraOptions();if(r&&!(t!=null&&t.force))return this;const{zoomSteps:o}=this.getCameraOptions();if(o!==null&&o.length>1){const s=this.getBaseZoom(),{x:i,y:a,z:c}=this.getCamera();let u=o[0]*s;for(let h=o.length-1;h>0;h--){const f=o[h-1]*s,g=o[h]*s;if(!(g-c>=(g-f)/2)){u=f;break}}this.setCamera(new P(i+(e.x/u-e.x)-(e.x/c-e.x),a+(e.y/u-e.y)-(e.y/c-e.y),u),t)}return this}zoomToSelection(e){const{isLocked:t}=this.getCameraOptions();if(t&&!(e!=null&&e.force))return this;const r=this.getSelectionPageBounds();return r&&this.zoomToBounds(r,{targetZoom:Math.max(1,this.getZoomLevel()),...e}),this}zoomToBounds(e,t){const r=this._cameraOptions.__unsafe__getWithoutCapture();if(r.isLocked&&!(t!=null&&t.force))return this;const o=this.getViewportScreenBounds(),s=(t==null?void 0:t.inset)??Math.min(n7,o.width*.28),i=this.getBaseZoom(),a=r.zoomSteps[0],c=En(r.zoomSteps);let u=Cn(Math.min((o.width-s)/e.w,(o.height-s)/e.h),a*i,c*i);return(t==null?void 0:t.targetZoom)!==void 0&&(u=Math.min(t.targetZoom,u)),this.setCamera(new P(-e.x+(o.width-e.w*u)/2/u,-e.y+(o.height-e.h*u)/2/u,u),t),this}stopCameraAnimation(){return this.emit("stop-camera-animation"),this}_animateViewport(e){if(!this._viewportAnimation)return;this._viewportAnimation.elapsed+=e;const{elapsed:t,easing:r,duration:o,start:s,end:i}=this._viewportAnimation;if(t>o){this.off("tick",this._animateViewport),this._viewportAnimation=null,this._setCamera(new P(-i.x,-i.y,this.getViewportScreenBounds().width/i.width));return}const a=o-t,c=r(1-a/o),u=s.minX+(i.minX-s.minX)*c,h=s.minY+(i.minY-s.minY)*c,f=s.maxX+(i.maxX-s.maxX)*c;this._setCamera(new P(-u,-h,this.getViewportScreenBounds().width/(f-u)),{force:!0})}_animateToViewport(e,t={animation:F0}){const{animation:r,...o}=t;if(!r)return;const{duration:s=0,easing:i=xn.easeInOutCubic}=r,a=this.user.getAnimationSpeed(),c=this.getViewportPageBounds();return this.stopCameraAnimation(),this.getInstanceState().followingUserId&&this.stopFollowingUser(),s===0||a===0?this._setCamera(new P(-e.x,-e.y,this.getViewportScreenBounds().width/e.width),{...o}):(this._viewportAnimation={elapsed:0,duration:s/a,easing:i,start:c.clone(),end:e.clone()},this.once("stop-camera-animation",()=>{this.off("tick",this._animateViewport),this._viewportAnimation=null}),this.on("tick",this._animateViewport),this)}slideCamera(e={}){const{isLocked:t}=this.getCameraOptions();if(t&&!(e!=null&&e.force))return this;if(this.user.getAnimationSpeed()===0)return this;this.stopCameraAnimation();const{speed:o,friction:s=this.options.cameraSlideFriction,direction:i,speedThreshold:a=.01}=e;let c=Math.min(o,1);const u=()=>{this.off("tick",h),this.off("stop-camera-animation",u)};this.once("stop-camera-animation",u);const h=f=>{const{x:g,y,z:v}=this.getCamera(),S=P.Mul(i,c*f/v);c*=1-s,c<a?u():this._setCamera(new P(g+S.x,y+S.y,v))};return this.on("tick",h),this}zoomToUser(e,t={animation:{duration:500}}){const r=this.getCollaborators().find(o=>o.userId===e);return r?(this.run(()=>{this.getInstanceState().followingUserId!==null&&this.stopFollowingUser();const o=r.currentPageId===this.getCurrentPageId();o||this.setCurrentPage(r.currentPageId),t&&t.animation&&!o&&(t.animation=void 0),this.centerOnPoint(r.cursor,t);const{highlightedUserIds:s}=this.getInstanceState();this.updateInstanceState({highlightedUserIds:[...s,e]}),this.timers.setTimeout(()=>{const i=[...this.getInstanceState().highlightedUserIds],a=i.indexOf(e);a<0||(i.splice(a,1),this.updateInstanceState({highlightedUserIds:i}))},this.options.collaboratorIdleTimeoutMs)}),this):this}updateViewportScreenBounds(e,t=!1){if(e instanceof HTMLElement){const a=e.getBoundingClientRect();e=new xe(a.left||a.x,a.top||a.y,Math.max(a.width,1),Math.max(a.height,1))}else e.width=Math.max(e.width,1),e.height=Math.max(e.height,1);const r=[e.minY!==0,!pa(document.body.scrollWidth,e.maxX,1),!pa(document.body.scrollHeight,e.maxY,1),e.minX!==0],{_willSetInitialBounds:o}=this;this._willSetInitialBounds=!1;const{screenBounds:s,insets:i}=this.getInstanceState();if(e.equals(s)&&r.every((a,c)=>a===i[c]))return this;if(o)this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.setCamera(this.getCamera());else if(t&&!this.getInstanceState().followingUserId){const a=this.getViewportPageBounds().center;this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this.centerOnPoint(a)}else this.updateInstanceState({screenBounds:e.toJson(),insets:r}),this._setCamera(P.From({...this.getCamera()}));return this._tickCameraState(),this}getViewportScreenBounds(){const{x:e,y:t,w:r,h:o}=this.getInstanceState().screenBounds;return new xe(e,t,r,o)}getViewportScreenCenter(){const e=this.getViewportScreenBounds();return new P(e.midX-e.minX,e.midY-e.minY)}getViewportPageBounds(){const{w:e,h:t}=this.getViewportScreenBounds(),{x:r,y:o,z:s}=this.getCamera();return new xe(-r,-o,e/s,t/s)}screenToPage(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(ir),{x:r,y:o,z:s=1}=this.getCamera();return new P((e.x-t.x)/s-r,(e.y-t.y)/s-o,e.z??.5)}pageToScreen(e){const{screenBounds:t}=this.store.unsafeGetWithoutCapture(ir),{x:r,y:o,z:s=1}=this.getCamera();return new P((e.x+r)*s+t.x,(e.y+o)*s+t.y,e.z??.5)}pageToViewport(e){const{x:t,y:r,z:o=1}=this.getCamera();return new P((e.x+t)*o,(e.y+r)*o,e.z??.5)}_getCollaboratorsQuery(){return this.store.query.records("instance_presence",()=>({userId:{neq:this.user.getId()}}))}getCollaborators(){const e=this._getCollaboratorsQuery().get();return e.length?[...new Set(e.map(r=>r.userId))].sort().map(r=>e.filter(s=>s.userId===r).sort((s,i)=>i.lastActivityTimestamp-s.lastActivityTimestamp)[0]):gi}getCollaboratorsOnCurrentPage(){const e=this.getCurrentPageId();return this.getCollaborators().filter(t=>t.currentPageId===e)}startFollowingUser(e){this.stopFollowingUser();const t=this._getCollaboratorsQuery().get().filter(s=>s.userId===e);if(!t.length)return console.warn("User not found"),this;const r=this.user.getId();if(r||console.warn("You should set the userId for the current instance before following a user"),t.some(s=>s.followingUserId===r))return this;const o=ce("latestLeaderPresence",()=>this.getCollaborators().find(s=>s.userId===e));return As(()=>{this.updateInstanceState({followingUserId:e},{history:"ignore"});const s=Ms("update current page",()=>{const c=o.get();if(!c){this.stopFollowingUser();return}c.currentPageId!==this.getCurrentPageId()&&this.getPage(c.currentPageId)&&this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:c.currentPageId}]),this._isLockedOnFollowingUser.set(!0)},{history:"ignore"})}),i=()=>{s(),this._isLockedOnFollowingUser.set(!1),this.off("frame",a),this.off("stop-following",i)},a=()=>{if(!o.get()){this.stopFollowingUser();return}if(this._isLockedOnFollowingUser.get())return;const u=this.user.getAnimationSpeed();if(u===0){this._isLockedOnFollowingUser.set(!0);return}const h=this.getViewportPageBoundsForFollowing();if(!h){this.stopFollowingUser();return}const f=this.getViewportPageBounds(),g=Math.abs(h.minX-f.minX)+Math.abs(h.maxX-f.maxX),y=Math.abs(h.minY-f.minY)+Math.abs(h.maxY-f.maxY);if(g<this.options.followChaseViewportSnap&&y<this.options.followChaseViewportSnap){this._isLockedOnFollowingUser.set(!0);return}const v=Cn(u*.5,.1,.8),S=new xe(it(f.minX,h.minX,v),it(f.minY,h.minY,v),it(f.width,h.width,v),it(f.height,h.height,v)),w=new P(-S.x,-S.y,this.getViewportScreenBounds().width/S.width);this.stopCameraAnimation(),this._setCamera(w)};this.once("stop-following",i),this.addListener("frame",a),a()}),this}stopFollowingUser(){return this.run(()=>{this.store.put([this.getCamera()]),this._isLockedOnFollowingUser.set(!1),this.updateInstanceState({followingUserId:null}),this.emit("stop-following")},{history:"ignore"}),this}getUnorderedRenderingShapes(e){const t=[];let r=this.options.maxShapesPerPage*2,o=this.options.maxShapesPerPage;const s=this.getErasingShapeIds(),i=(c,u,h)=>{const f=this.getShape(c);if(!f||this.isShapeHidden(f))return;u*=f.opacity;let g=!1;const y=this.getShapeUtil(f);e&&(g=!h&&s.includes(c),g&&(u*=.32)),t.push({id:c,shape:f,util:y,index:r,backgroundIndex:o,opacity:u}),r+=1,o+=1;const v=this.getSortedChildIdsForParent(c);if(!v.length)return;let S=null;y.providesBackgroundForChildren(f)&&(S=o,o=r,r+=this.options.maxShapesPerPage);for(const w of v)i(w,u,h||g);S!==null&&(o=S)},a=e?[this.getCurrentPage()]:this.getPages();for(const c of a)for(const u of this.getSortedChildIdsForParent(c.id))i(u,1,!1);return t}_decayCameraStateTimeout(e){this._cameraStateTimeoutRemaining-=e,!(this._cameraStateTimeoutRemaining>0)&&(this.off("tick",this._decayCameraStateTimeout),this._cameraState.set("idle"))}_tickCameraState(){this._cameraStateTimeoutRemaining=this.options.cameraMovingTimeoutMs,this._cameraState.__unsafe__getWithoutCapture()==="idle"&&(this._cameraState.set("moving"),this.on("tick",this._decayCameraStateTimeout))}getCameraState(){return this._cameraState.get()}getRenderingShapes(){return this.getUnorderedRenderingShapes(!0).sort($8)}_getAllPagesQuery(){return this.store.query.records("page")}getPages(){return this._getAllPagesQuery().get().sort(Gn)}getCurrentPage(){return this.getPage(this.getCurrentPageId())}getCurrentPageId(){return this.getInstanceState().currentPageId}getPage(e){return this.store.get(typeof e=="string"?e:e.id)}getCurrentPageShapeIds(){return this._currentPageShapeIds.get()}getCurrentPageShapeIdsSorted(){return Array.from(this.getCurrentPageShapeIds()).sort()}getPageShapeIds(e){const t=typeof e=="string"?e:e.id,r=this.store.query.exec("shape",{parentId:{eq:t}});return this.getShapeAndDescendantIds(r.map(o=>o.id))}setCurrentPage(e){const t=typeof e=="string"?e:e.id;return this.store.has(t)?(this.stopFollowingUser(),this.complete(),this.run(()=>{this.store.put([{...this.getInstanceState(),currentPageId:t}]),this.setCamera(this.getCamera())},{history:"record-preserveRedoStack"})):(console.error("Tried to set the current page id to a page that doesn't exist."),this)}updatePage(e){return this.getIsReadonly()?this:this.getPage(e.id)?this.run(()=>this.store.update(e.id,r=>({...r,...e}))):this}createPage(e){return this.run(()=>{if(this.getIsReadonly()||this.getPages().length>=this.options.maxPages)return;const t=this.getPages(),r=LW(e.name??"Page 1",t.map(i=>i.name));let o=e.index;(!o||t.some(i=>i.index===o))&&(o=Is(t[t.length-1].index));const s=so.create({meta:{},...e,name:r,index:o});this.store.put([s])}),this}deletePage(e){const t=typeof e=="string"?e:e.id;return this.run(()=>{if(this.getIsReadonly())return;const r=this.getPages();if(r.length===1)return;const o=this.getPage(t);if(o){if(t===this.getCurrentPageId()){const s=r.findIndex(a=>a.id===t),i=r[s-1]??r[s+1];this.setCurrentPage(i.id)}this.store.remove([o.id])}}),this}duplicatePage(e,t=so.createId()){if(this.getPages().length>=this.options.maxPages)return this;const r=typeof e=="string"?e:e.id,o=this.getPage(r);if(!o)return this;const s={...this.getCamera()},i=this.getContentFromCurrentPage(this.getSortedChildIdsForParent(o.id));return this.run(()=>{var u;const a=this.getPages(),c=jd(o.index,(u=a[a.indexOf(o)+1])==null?void 0:u.index);if(this.createPage({name:o.name+" Copy",id:t,index:c}),this.setCurrentPage(t),this.setCamera(s),i)return this.putContentOntoCurrentPage(i)}),this}renamePage(e,t){const r=typeof e=="string"?e:e.id;return this.getIsReadonly()?this:(this.updatePage({id:r,name:t}),this)}_getAllAssetsQuery(){return this.store.query.records("asset")}getAssets(){return this._getAllAssetsQuery().get()}createAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>this.store.put(e),{history:"ignore"}),this)}updateAssets(e){return this.getIsReadonly()?this:e.length<=0?this:(this.run(()=>{this.store.put(e.map(t=>({...this.store.get(t.id),...t})))},{history:"ignore"}),this)}deleteAssets(e){if(this.getIsReadonly())return this;const t=typeof e[0]=="string"?e:e.map(r=>r.id);return t.length<=0?this:(this.run(()=>this.store.remove(t),{history:"ignore"}),this)}getAsset(e){return this.store.get(typeof e=="string"?e:e.id)}async resolveAssetUrl(e,t){if(!e)return null;const r=this.getAsset(e);if(!r)return null;const{screenScale:o=1,shouldResolveToOriginal:s=!1}=t,a=Math.max(.125,(h=>Math.pow(2,Math.ceil(Math.log2(h))))(o)),c="connection"in navigator?navigator.connection.effectiveType:null,u=this.getInstanceState().devicePixelRatio;return await this.store.props.assets.resolve(r,{screenScale:o||1,steppedScreenScale:a,dpr:u,networkEffectiveType:c,shouldResolveToOriginal:s})}async uploadAsset(e,t){return await this.store.props.assets.upload(e,t)}_getShapeGeometryCache(){return this.store.createComputedCache("bounds",e=>this.getShapeUtil(e).getGeometry(e),(e,t)=>e.props===t.props)}getShapeGeometry(e){return this._getShapeGeometryCache().get(typeof e=="string"?e:e.id)}_getShapeHandlesCache(){return this.store.createComputedCache("handles",e=>{var t,r;return(r=(t=this.getShapeUtil(e)).getHandles)==null?void 0:r.call(t,e)})}getShapeHandles(e){return this._getShapeHandlesCache().get(typeof e=="string"?e:e.id)}getShapeLocalTransform(e){const t=typeof e=="string"?e:e.id,r=this.getShape(t);if(!r)throw Error("Editor.getTransform: shape not found");return ye.Identity().translate(r.x,r.y).rotate(r.rotation)}_getShapePageTransformCache(){return this.store.createComputedCache("pageTransformCache",e=>{if(Ir(e.parentId))return this.getShapeLocalTransform(e);const t=this._getShapePageTransformCache().get(e.parentId)??ye.Identity();return ye.Compose(t,this.getShapeLocalTransform(e))})}getShapeParentTransform(e){const t=typeof e=="string"?e:e.id,r=this.getShape(t);return!r||Ir(r.parentId)?ye.Identity():this._getShapePageTransformCache().get(r.parentId)??ye.Identity()}getShapePageTransform(e){const t=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(t)??ye.Identity()}_getShapePageBoundsCache(){return this.store.createComputedCache("pageBoundsCache",e=>{const t=this._getShapePageTransformCache().get(e.id);return t?xe.FromPoints(ye.applyToPoints(t,this.getShapeGeometry(e).vertices)):new xe})}getShapePageBounds(e){return this._getShapePageBoundsCache().get(typeof e=="string"?e:e.id)}_getShapeClipPathCache(){return this.store.createComputedCache("clipPathCache",e=>{const t=this._getShapeMaskCache().get(e.id);if(!t)return;if(t.length===0)return"polygon(0px 0px, 0px 0px, 0px 0px)";const r=this._getShapePageTransformCache().get(e.id);return r?`polygon(${ye.applyToPoints(ye.Inverse(r),t).map(s=>`${s.x}px ${s.y}px`).join(",")})`:void 0})}getShapeClipPath(e){return this._getShapeClipPathCache().get(typeof e=="string"?e:e.id)}_getShapeMaskCache(){return this.store.createComputedCache("pageMaskCache",e=>{if(Ir(e.parentId))return;const t=this.getShapeAncestors(e.id).filter(o=>this.isShapeOfType(o,"frame"));return t.length===0?void 0:t.map(o=>this._getShapePageTransformCache().get(o.id).applyToPoints(this.getShapeGeometry(o).vertices)).reduce((o,s)=>{if(!(s&&o))return;const i=Ak(o,s);return i?i.map(P.Cast):[]})})}getShapeMask(e){return this._getShapeMaskCache().get(typeof e=="string"?e:e.id)}getShapeMaskedPageBounds(e){return typeof e!="string"&&(e=e.id),this._getShapeMaskedPageBoundsCache().get(e)}_getShapeMaskedPageBoundsCache(){return this.store.createComputedCache("shapeMaskedPageBoundsCache",e=>{const t=this._getShapePageBoundsCache().get(e.id);if(!t)return;const r=this._getShapeMaskCache().get(e.id);if(r){if(r.length===0)return;const{corners:o}=t;if(o.every((i,a)=>i&&P.Equals(i,r[a])))return t.clone();const s=Ak(r,o);return s?xe.FromPoints(s):void 0}return t})}getShapeAncestors(e,t=[]){const r=typeof e=="string"?e:e.id,o=this.getShape(r);if(!o)return t;const s=o.parentId;if(Ir(s))return t.reverse(),t;const i=this.store.get(s);return i?(t.push(i),this.getShapeAncestors(i,t)):t}findShapeAncestor(e,t){const r=typeof e=="string"?e:e.id,o=this.getShape(r);if(!o)return;const s=o.parentId;if(Ir(s))return;const i=this.getShape(s);if(i)return t(i)?i:this.findShapeAncestor(i,t)}hasAncestor(e,t){const r=typeof e=="string"?e:e==null?void 0:e.id,o=r&&this.getShape(r);return o?o.parentId===t?!0:this.hasAncestor(this.getShapeParent(o),t):!1}findCommonAncestor(e,t){var c;if(e.length===0)return;const r=typeof e[0]=="string"?e:e.map(u=>u.id),o=Ze(r.map(u=>this.getShape(u)));if(o.length===1){const u=o[0].parentId;return Ir(u)?void 0:t?(c=this.findShapeAncestor(o[0],t))==null?void 0:c.id:u}const[s,...i]=o;let a=this.getShapeParent(s);for(;a;){if(t&&!t(a)){a=this.getShapeParent(a);continue}if(i.every(u=>this.hasAncestor(u,a.id)))return a.id;a=this.getShapeParent(a)}}isShapeOrAncestorLocked(e){const t=typeof e=="string"?this.getShape(e):e;return t===void 0?!1:t.isLocked?!0:this.isShapeOrAncestorLocked(this.getShapeParent(t))}_notVisibleShapes(){return HW(this)}getCulledShapes(){const e=this._notVisibleShapes().get(),t=this.getSelectedShapeIds(),r=this.getEditingShapeId(),o=new Set(e);return r&&o.delete(r),t.forEach(s=>{o.delete(s)}),o}getCurrentPageBounds(){let e;return this.getCurrentPageShapeIdsSorted().forEach(t=>{const r=this.getShapeMaskedPageBounds(t);r&&(e?e=e.expand(r):e=r.clone())}),e}getSelectedShapeAtPoint(e){const t=this.getSelectedShapeIds();return this.getCurrentPageShapesSorted().filter(r=>r.type!=="group"&&t.includes(r.id)).reverse().find(r=>this.isPointInShape(r,e,{hitInside:!0,margin:0}))}getShapeAtPoint(e,t={}){const r=this.getZoomLevel(),o=this.getViewportPageBounds(),{filter:s,margin:i=0,hitLocked:a=!1,hitLabels:c=!1,hitInside:u=!1,hitFrameInside:h=!1}=t;let f=1/0,g=null,y=1/0,v=null;const S=(t.renderingOnly?this.getCurrentPageRenderingShapesSorted():this.getCurrentPageShapesSorted()).filter(w=>{if(w.isLocked&&!a||this.isShapeHidden(w)||this.isShapeOfType(w,"group"))return!1;const b=this.getShapeMask(w);return b&&!no(e,b)?!1:s?s(w):!0});for(let w=S.length-1;w>=0;w--){const b=S[w],_=this.getShapeGeometry(b),T=_ instanceof To,E=this.getPointInShapeSpace(b,e);if(this.isShapeOfType(b,"frame")||(this.isShapeOfType(b,"arrow")||this.isShapeOfType(b,"geo")&&b.props.fill==="none")&&b.props.text.trim()){for(const A of _.children)if(A.isLabel&&A.isPointInBounds(E))return b}if(this.isShapeOfType(b,"frame")){const A=_.distanceToPoint(E,u);if(Math.abs(A)<=i)return v||b;if(_.hitTestPoint(E,0,!0))return v||g||(h?b:void 0);continue}let M;if(T){let A=1/0;for(const R of _.children){if(R.isLabel&&!c)continue;const L=R.distanceToPoint(E,u);L<A&&(A=L)}M=A}else i===0&&(_.bounds.w<1||_.bounds.h<1)||_.bounds.containsPoint(E,i)?M=_.distanceToPoint(E,u):M=1/0;if(_.isClosed){if(M<=i){if(_.isFilled||T&&_.children[0].isFilled)return v||b;if(this.getShapePageBounds(b).contains(o))continue;if(Math.abs(M)<i)Math.abs(M)<y&&(y=Math.abs(M),v=b);else if(!v){const{area:A}=_;A<f&&(f=A,g=b)}}}else if(M<this.options.hitTestMargin/r)return b}return v||g||void 0}getShapesAtPoint(e,t={}){return this.getCurrentPageShapes().filter(r=>!this.isShapeHidden(r)&&this.isPointInShape(r,e,t))}isPointInShape(e,t,r={}){const{hitInside:o=!1,margin:s=0}=r,i=typeof e=="string"?e:e.id,a=this.getShapeMask(i);return a&&!no(t,a)?!1:this.getShapeGeometry(i).hitTestPoint(this.getPointInShapeSpace(e,t),s,o)}getPointInShapeSpace(e,t){const r=typeof e=="string"?e:e.id;return this._getShapePageTransformCache().get(r).clone().invert().applyToPoint(t)}getPointInParentSpace(e,t){const r=typeof e=="string"?e:e.id,o=this.getShape(r);if(!o)return new P(0,0);if(Ir(o.parentId))return P.From(t);const s=this.getShapePageTransform(o.parentId);return s?s.clone().invert().applyToPoint(t):P.From(t)}getCurrentPageShapes(){return Array.from(this.getCurrentPageShapeIds(),e=>this.store.get(e))}getCurrentPageShapesSorted(){const e=[],t=this.getSortedChildIdsForParent(this.getCurrentPageId());for(let r=0,o=t.length;r<o;r++)I3(this,t[r],e);return e}getCurrentPageRenderingShapesSorted(){const e=this.getCulledShapes();return this.getCurrentPageShapesSorted().filter(({id:t})=>!e.has(t)&&!this.isShapeHidden(t))}isShapeOfType(e,t){const r=typeof e=="string"?this.getShape(e):e;return r?r.type===t:!1}getShape(e){const t=typeof e=="string"?e:e.id;if(Tr(t))return this.store.get(t)}getShapeParent(e){const t=typeof e=="string"?e:e==null?void 0:e.id;if(!t)return;const r=this.getShape(t);if(!(r===void 0||!Tr(r.parentId)))return this.store.get(r.parentId)}getShapeNearestSibling(e,t){return t?t.parentId===e.parentId?t:this.findShapeAncestor(t,o=>o.parentId===e.parentId):void 0}isShapeInPage(e,t=this.getCurrentPageId()){const r=typeof e=="string"?e:e.id,o=this.getShape(r);if(!o)return!1;let s=!1;if(o.parentId===t)s=!0;else{let i=this.getShape(o.parentId);e:for(;i;){if(i.parentId===t){s=!0;break e}i=this.getShape(i.parentId)}}return s}getAncestorPageId(e){const t=typeof e=="string"?e:e==null?void 0:e.id,r=t&&this.getShape(t);if(r)return Ir(r.parentId)?r.parentId:this.getAncestorPageId(this.getShape(r.parentId))}reparentShapes(e,t,r){const o=typeof e[0]=="string"?e:e.map(g=>g.id);if(o.length===0)return this;const s=[],i=Ir(t)?ye.Identity():this.getShapePageTransform(t),a=i.rotation();let c=[];const u=Ze(this.getSortedChildIdsForParent(t).map(g=>this.getShape(g)));if(r){const g=u.find(y=>y.index===r);if(g){const y=u[u.indexOf(g)+1];y?c=Uc(r,y.index,o.length):c=Ov(r,o.length)}else{const y=u.sort(Gn).find(v=>v.index>r);y?c=Uc(r,y.index,o.length):c=Ov(r,o.length)}}else{const g=u.length&&u[u.length-1];c=g?Ov(g.index,o.length):Rd(o.length)}const h=i.clone().invert(),f=Ze(o.map(g=>this.getShape(g)));return this.run(()=>{for(let g=0;g<f.length;g++){const y=f[g],v=this.getShapePageTransform(y);if(!v)continue;const S=v.point();if(!S)continue;const w=h.applyToPoint(S),b=v.rotation()-a;s.push({id:y.id,type:y.type,parentId:t,x:w.x,y:w.y,rotation:b,index:c[g]})}this.updateShapes(s)},{ignoreShapeLock:!0}),this}getHighestIndexForParent(e){const t=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[t];if(!r||r.length===0)return"a1";const o=this.getShape(r[r.length-1]);return Is(o.index)}getSortedChildIdsForParent(e){const t=typeof e=="string"?e:e.id,r=this._parentIdsToChildIds.get()[t];return r||gi}visitDescendants(e,t){const r=typeof e=="string"?e:e.id,o=this.getSortedChildIdsForParent(r);for(const s of o)t(s)!==!1&&this.visitDescendants(s,t);return this}getShapeAndDescendantIds(e){const t=new Set;for(const r of e.map(o=>this.getShape(o)).sort(Gn))t.add(r.id),this.visitDescendants(r,o=>{t.add(o)});return t}getDroppingOverShape(e,t=[]){const r=this.getCurrentPageShapesSorted();for(let o=r.length-1;o>=0;o--){const s=r[o];if(this.isShapeHidden(s)||this.getSelectedShapeIds().includes(s.id)||!this.getShapeUtil(s).canDropShapes(s,t)||t.find(a=>a.id===s.id||this.hasAncestor(s,a.id)))continue;const i=this.getShapeMaskedPageBounds(s.id);if(i&&i.containsPoint(e)&&this.getShapeGeometry(s).hitTestPoint(this.getPointInShapeSpace(s,e),0,!0))return s}}getOutermostSelectableShape(e,t){const r=typeof e=="string"?e:e.id,o=this.getShape(r);let s=o,i=o;const a=this.getFocusedGroup();for(;i;){if(this.isShapeOfType(i,"group")&&(a==null?void 0:a.id)!==i.id&&!this.hasAncestor(a,i.id)&&((t==null?void 0:t(i))??!0))s=i;else if((a==null?void 0:a.id)===i.id)break;i=this.getShapeParent(i)}return s}_getBindingsIndexCache(){const e=BW(this);return this.store.createComputedCache("bindingsIndex",t=>e.get().get(t.id))}getBinding(e){return this.store.get(e)}getBindingsFromShape(e,t){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(o=>o.fromId===r&&o.type===t)}getBindingsToShape(e,t){const r=typeof e=="string"?e:e.id;return this.getBindingsInvolvingShape(r).filter(o=>o.toId===r&&o.type===t)}getBindingsInvolvingShape(e,t){const r=typeof e=="string"?e:e.id,o=this._getBindingsIndexCache().get(r)??gi;return t?o.filter(s=>s.type===t):o}createBindings(e){const t=[];for(const r of e){const o=this.getShape(r.fromId),s=this.getShape(r.toId);if(!o||!s||!this.canBindShapes({fromShape:o,toShape:s,binding:r}))continue;const a=this.getBindingUtil(r.type).getDefaultProps(),c=this.store.schema.types.binding.create({...r,id:r.id??al(),props:{...a,...r.props}});t.push(c)}return this.store.put(t),this}createBinding(e){return this.createBindings([e])}updateBindings(e){const t=[];for(const r of e){if(!r)continue;const o=this.getBinding(r.id);if(!o)continue;const s=xs(o,r);if(s===o)continue;const i=this.getShape(s.fromId),a=this.getShape(s.toId);!i||!a||this.canBindShapes({fromShape:i,toShape:a,binding:s})&&t.push(s)}return this.store.put(t),this}updateBinding(e){return this.updateBindings([e])}deleteBindings(e,{isolateShapes:t=!1}={}){const r=e.map(o=>typeof o=="string"?o:o.id);return t?this.store.atomic(()=>{var o,s;for(const i of r){const a=this.getBinding(i);if(!a)continue;const c=this.getBindingUtil(a);(o=c.onBeforeIsolateFromShape)==null||o.call(c,{binding:a,removedShape:this.getShape(a.toId)}),(s=c.onBeforeIsolateToShape)==null||s.call(c,{binding:a,removedShape:this.getShape(a.fromId)}),this.store.remove([i])}}):this.store.remove(r),this}deleteBinding(e,t){return this.deleteBindings([e],t)}canBindShapes({fromShape:e,toShape:t,binding:r}){const o=typeof e=="string"?e:e.type,s=typeof t=="string"?t:t.type,i=typeof r=="string"?r:r.type,a={fromShapeType:o,toShapeType:s,bindingType:i};return o===s?this.getShapeUtil(o).canBind(a):this.getShapeUtil(o).canBind(a)&&this.getShapeUtil(s).canBind(a)}rotateShapesBy(e,t,r){const o=typeof e[0]=="string"?e:e.map(i=>i.id);if(o.length<=0)return this;const s=JR({editor:this,ids:o});return s?(pf({delta:t,snapshot:s,editor:this,stage:"one-off",centerOverride:r==null?void 0:r.center}),this):this}getChangesToTranslateShape(e,t){var s,i,a;let r=e;const o=this.getShapeUtil(e);return r=xs(r,((s=o.onTranslateStart)==null?void 0:s.call(o,r))??void 0),r=xs(r,{id:e.id,type:e.type,x:t.x,y:t.y}),r=xs(r,((i=o.onTranslate)==null?void 0:i.call(o,e,r))??void 0),r=xs(r,((a=o.onTranslateEnd)==null?void 0:a.call(o,e,r))??void 0),r}nudgeShapes(e,t){const r=typeof e[0]=="string"?e:e.map(s=>s.id);if(r.length<=0)return this;const o=[];for(const s of r){const i=this.getShape(s),a=P.From(t),c=this.getShapeParentTransform(i);c&&a.rot(-c.rotation()),o.push(this.getChangesToTranslateShape(i,a.add(i)))}return this.updateShapes(o),this}duplicateShapes(e,t){return this.run(()=>{const r=typeof e[0]=="string"?e:e.map(g=>g.id);if(r.length<=0)return this;const o=new Set(r),s=this.getShapeAndDescendantIds(r),i=[...s].reverse(),a=new Map;for(const g of s)a.set(g,Ct());const{shapesToCreateWithOriginals:c,bindingsToCreate:u}=Zk(this,s,g=>{const y=[];for(const S of g){const w=this.getBinding(S);if(!w)continue;const b=al();y.push({...w,id:b,fromId:Mr(a.get(w.fromId)),toId:Mr(a.get(w.toId))})}const v=[];for(const S of i){const w=Mr(a.get(S)),b=this.getShape(S);if(!b)continue;let _=0,T=0;if(t&&o.has(S)){const E=this.getShapeParentTransform(b),M=new P(t.x,t.y).rot(-E.rotation());_=M.x,T=M.y}v.push({shape:{...b,id:w,x:b.x+_,y:b.y+T,index:"a1",parentId:a.get(b.parentId)??b.parentId},originalShape:b})}return{shapesToCreateWithOriginals:v,bindingsToCreate:y}});c.forEach(({shape:g,originalShape:y})=>{const v=y.parentId,S=this.getSortedChildIdsForParent(v),w=S.indexOf(y.id),b=S[w+1],_=b?this.getShape(b):void 0,T=jd(y.index,_==null?void 0:_.index);g.index=T});const h=c.map(({shape:g})=>g);if(h.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage){Np(this);return}if(this.createShapes(h),this.createBindings(u),this.setSelectedShapes(Ze(r.map(g=>a.get(g)))),t!==void 0){const g=this.getSelectionPageBounds(),y=this.getViewportPageBounds();g&&!y.contains(g)&&this.centerOnPoint(g.center,{animation:{duration:this.options.animationMediumMs}})}}),this}moveShapesToPage(e,t){const r=typeof e[0]=="string"?e:e.map(a=>a.id);if(r.length===0)return this;if(this.getIsReadonly())return this;const o=this.getCurrentPageId();if(t===o)return this;if(!this.store.has(t))return this;const s=this.getContentFromCurrentPage(r);if(!s)return this;if(this.getPageShapeIds(t).size+s.shapes.length>this.options.maxShapesPerPage)return Np(this,t),this;const i=this.getCamera().z;return this.run(()=>{this.deleteShapes(r),this.setCurrentPage(t),this.setFocusedGroup(null),this.selectNone(),this.putContentOntoCurrentPage(s,{select:!0,preserveIds:!0,preservePosition:!0}),this.setCamera({...this.getCamera(),z:i}),this.centerOnPoint(this.getSelectionRotatedPageBounds().center)}),this}toggleLock(e){const t=typeof e[0]=="string"?e:e.map(i=>i.id);if(this.getIsReadonly()||t.length===0)return this;let r=!0,o=!0;const s=[];for(const i of t){const a=this.getShape(i);a&&(s.push(a),a.isLocked?o=!1:r=!1)}return this.run(()=>{o?(this.updateShapes(s.map(i=>({id:i.id,type:i.type,isLocked:!0}))),this.setSelectedShapes([])):r?this.updateShapes(s.map(i=>({id:i.id,type:i.type,isLocked:!1}))):this.updateShapes(s.map(i=>({id:i.id,type:i.type,isLocked:!0})))}),this}sendToBack(e){const t=typeof e[0]=="string"?e:e.map(o=>o.id),r=Lp(this,"toBack",t,{considerAllShapes:!0});return r&&this.updateShapes(r),this}sendBackward(e,t={}){const r=typeof e[0]=="string"?e:e.map(s=>s.id),o=Lp(this,"backward",r,t);return o&&this.updateShapes(o),this}bringForward(e,t={}){const r=typeof e[0]=="string"?e:e.map(s=>s.id),o=Lp(this,"forward",r,t);return o&&this.updateShapes(o),this}bringToFront(e){const t=typeof e[0]=="string"?e:e.map(o=>o.id),r=Lp(this,"toFront",t);return r&&this.updateShapes(r),this}flipShapes(e,t){const r=typeof e[0]=="string"?e:e.map(i=>i.id);if(this.getIsReadonly())return this;let o=Ze(r.map(i=>this.getShape(i)));if(!o.length)return this;o=Ze(o.map(i=>this.isShapeOfType(i,"group")?this.getSortedChildIdsForParent(i.id).map(a=>this.getShape(a)):i).flat());const s=xe.Common(Ze(o.map(i=>this.getShapePageBounds(i)))).center;return this.run(()=>{for(const i of o){const a=this.getShapeGeometry(i).bounds,c=this.getShapePageTransform(i.id);c&&this.resizeShape(i.id,{x:t==="horizontal"?-1:1,y:t==="vertical"?-1:1},{initialBounds:a,initialPageTransform:c,initialShape:i,mode:"scale_shape",isAspectRatioLocked:this.getShapeUtil(i).isAspectRatioLocked(i),scaleOrigin:s,scaleAxisRotation:0})}}),this}stackShapes(e,t,r){const o=typeof e[0]=="string"?e:e.map(S=>S.id);if(this.getIsReadonly())return this;const s=o.map(S=>this.getShape(S)).filter(S=>S?this.getShapeUtil(S).canBeLaidOut(S):!1),i=s.length;if(r===0&&i<3||i<2)return this;const a=Object.fromEntries(s.map(S=>[S.id,this.getShapePageBounds(S)]));let c,u,h,f;t==="horizontal"?(c="x",u="minX",h="maxX",f="width"):(c="y",u="minY",h="maxY",f="height");let g;if(r===0){const S=[];s.sort((b,_)=>a[b.id][u]-a[_.id][u]);for(let b=0;b<i-1;b++){const _=s[b],T=s[b+1],E=a[_.id],A=a[T.id][u]-E[h],R=S.find(L=>L.gap===A);R?R.count++:S.push({gap:A,count:1})}let w=0;S.forEach(b=>{b.count>w&&(w=b.count,g=b.gap)}),w===1&&(g=Math.max(0,S.reduce((b,_)=>b+_.gap*_.count,0)/(i-1)))}else g=r;const y=[];let v=a[s[0].id][h];return s.forEach((S,w)=>{var M,A;if(w===0)return;const b={x:0,y:0};b[c]=v+g-a[S.id][c];const _=this.getShapeParent(S),T=_?P.Rot(b,-this.getShapePageTransform(_).decompose().rotation):b,E=(A=(M=this.getShapeUtil(S)).onTranslateStart)==null?void 0:A.call(M,S);y.push(E?{...E,[c]:S[c]+T[c]}:{id:S.id,type:S.type,[c]:S[c]+T[c]}),v+=a[S.id][f]+g}),this.updateShapes(y),this}packShapes(e,t){var A,R;const r=typeof e[0]=="string"?e:e.map(L=>L.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const o=r.map(L=>this.getShape(L)).filter(L=>L?this.getShapeUtil(L).canBeLaidOut(L):!1),s={},i={};let a,c,u=0;for(let L=0;L<o.length;L++)a=o[L],c=this.getShapePageBounds(a),s[a.id]=c,i[a.id]=c.clone(),u+=c.width*c.height;const h=xe.Common(Ze(Object.values(s))),f=h.width;o.sort((L,K)=>s[K.id].height-s[L.id].height);const g=Math.max(Math.ceil(Math.sqrt(u/.95)),f),y=[new xe(h.x,h.y,g,1/0)];let v=0,S=0,w,b;for(let L=0;L<o.length;L++){a=o[L],c=i[a.id];for(let K=y.length-1;K>=0;K--)if(w=y[K],!(c.width>w.width||c.height>w.height)){c.x=w.x,c.y=w.y,S=Math.max(S,c.maxY),v=Math.max(v,c.maxX),c.width===w.width&&c.height===w.height?(b=y.pop(),K<y.length&&(y[K]=b)):c.height===w.height?(w.x+=c.width+t,w.width-=c.width+t):c.width===w.width?(w.y+=c.height+t,w.height-=c.height+t):(y.push(new xe(w.x+(c.width+t),w.y,w.width-(c.width+t),c.height)),w.y+=c.height+t,w.height-=c.height+t);break}}const _=xe.Common(Object.values(i)),T=P.Sub(h.center,_.center);let E;const M=[];for(let L=0;L<o.length;L++){a=o[L],c=s[a.id],E=i[a.id];const K=P.Sub(E.point,c.point).add(T),D=this.getShapeParentTransform(a);D&&K.rot(-D.rotation());const U={id:a.id,type:a.type,x:a.x+K.x,y:a.y+K.y},V=(R=(A=this.getShapeUtil(a)).onTranslateStart)==null?void 0:R.call(A,{...a,...U});V?M.push({...U,...V}):M.push(U)}return M.length&&this.updateShapes(M),this}alignShapes(e,t){const r=typeof e[0]=="string"?e:e.map(c=>c.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const o=Ze(r.map(c=>this.getShape(c))),s=Object.fromEntries(o.map(c=>[c.id,this.getShapePageBounds(c)])),i=xe.Common(Ze(Object.values(s))),a=[];return o.forEach(c=>{const u=s[c.id];if(!u)return;const h={x:0,y:0};switch(t){case"top":{h.y=i.minY-u.minY;break}case"center-vertical":{h.y=i.midY-u.minY-u.height/2;break}case"bottom":{h.y=i.maxY-u.minY-u.height;break}case"left":{h.x=i.minX-u.minX;break}case"center-horizontal":{h.x=i.midX-u.minX-u.width/2;break}case"right":{h.x=i.maxX-u.minX-u.width;break}}const f=this.getShapeParent(c),g=f?P.Rot(h,-this.getShapePageTransform(f).decompose().rotation):h;a.push(this.getChangesToTranslateShape(c,P.Add(c,g)))}),this.updateShapes(a),this}distributeShapes(e,t){const r=typeof e[0]=="string"?e:e.map(_=>_.id);if(this.getIsReadonly())return this;if(r.length<3)return this;const o=r.length,s=Ze(r.map(_=>this.getShape(_))),i=Object.fromEntries(s.map(_=>[_.id,this.getShapePageBounds(_)]));let a,c,u,h,f;t==="horizontal"?(a="x",c="minX",u="maxX",h="midX",f="width"):(a="y",c="minY",u="maxY",h="midY",f="height");const g=[],y=s.sort((_,T)=>i[_.id][c]-i[T.id][c])[0],v=s.sort((_,T)=>i[T.id][u]-i[_.id][u])[0],S=i[y.id][h],w=(i[v.id][h]-S)/(o-1),b=S+w;return s.filter(_=>_!==y&&_!==v).sort((_,T)=>i[_.id][h]-i[T.id][h]).forEach((_,T)=>{const E={x:0,y:0};E[a]=b+w*T-i[_.id][f]/2-i[_.id][a];const M=this.getShapeParent(_),A=M?P.Rot(E,-this.getShapePageTransform(M).rotation()):E;g.push(this.getChangesToTranslateShape(_,P.Add(_,A)))}),this.updateShapes(g),this}stretchShapes(e,t){const r=typeof e[0]=="string"?e:e.map(c=>c.id);if(this.getIsReadonly())return this;if(r.length<2)return this;const o=Ze(r.map(c=>this.getShape(c))),s=Object.fromEntries(r.map(c=>[c,this.getShapeGeometry(c).bounds])),i=Object.fromEntries(r.map(c=>[c,this.getShapePageBounds(c)])),a=xe.Common(Ze(Object.values(i)));switch(t){case"vertical":{this.run(()=>{for(const c of o){if(this.getShapePageTransform(c).rotation()%xt)continue;const h=s[c.id],f=i[c.id],g=new P(0,a.minY-f.minY),y=this.getShapeParentTransform(c);y&&g.rot(-y.rotation());const{x:v,y:S}=P.Add(g,c);this.updateShapes([{id:c.id,type:c.type,x:v,y:S}]);const w=new P(1,a.height/f.height);this.resizeShape(c.id,w,{initialBounds:h,scaleOrigin:new P(f.center.x,a.minY),isAspectRatioLocked:this.getShapeUtil(c).isAspectRatioLocked(c),scaleAxisRotation:0})}});break}case"horizontal":{this.run(()=>{for(const c of o){const u=s[c.id],h=i[c.id];if(this.getShapePageTransform(c).rotation()%xt)continue;const g=new P(a.minX-h.minX,0),y=this.getShapeParentTransform(c);y&&g.rot(-y.rotation());const{x:v,y:S}=P.Add(g,c);this.updateShapes([{id:c.id,type:c.type,x:v,y:S}]);const w=new P(a.width/h.width,1);this.resizeShape(c.id,w,{initialBounds:u,scaleOrigin:new P(a.minX,h.center.y),isAspectRatioLocked:this.getShapeUtil(c).isAspectRatioLocked(c),scaleAxisRotation:0})}});break}}return this}resizeShape(e,t,r={}){var y,v,S;const o=typeof e=="string"?e:e.id;if(this.getIsReadonly())return this;Number.isFinite(t.x)||(t=new P(1,t.y)),Number.isFinite(t.y)||(t=new P(t.x,1));const s=r.initialShape??this.getShape(o);if(!s)return this;const i=r.scaleOrigin??((y=this.getShapePageBounds(o))==null?void 0:y.center);if(!i)return this;const a=r.initialPageTransform?ye.Cast(r.initialPageTransform):this.getShapePageTransform(o);if(!a)return this;const c=a.rotation();if(c==null)return this;const u=r.scaleAxisRotation??c,h=r.initialBounds??this.getShapeGeometry(o).bounds;if(!h)return this;const f=r.isAspectRatioLocked??this.getShapeUtil(s).isAspectRatioLocked(s);if(!Kj(c,u))return this._resizeUnalignedShape(o,t,{...r,initialBounds:h,scaleOrigin:i,scaleAxisRotation:u,initialPageTransform:a,isAspectRatioLocked:f,initialShape:s});const g=this.getShapeUtil(s);if(f&&(Math.abs(t.x)>Math.abs(t.y)?t=new P(t.x,Math.sign(t.y)*Math.abs(t.x)):t=new P(Math.sign(t.x)*Math.abs(t.y),t.y)),g.onResize&&g.canResize(s)){const w=this._scalePagePoint(ye.applyToPoint(a,new P(0,0)),i,t,u),b=this.getPointInParentSpace(s.id,w),_=new P(t.x,t.y),T=pa((c-u)%Math.PI,0);_.x=T?t.x:t.y,_.y=T?t.y:t.x;const E=ye.applyToPoint(a,new P),{x:M,y:A}=this.getPointInParentSpace(s.id,E);let R=s;r.skipStartAndEndCallbacks||(R=xs(s,((v=g.onResizeStart)==null?void 0:v.call(g,s))??void 0)),R=xs(R,{id:o,type:s.type,x:b.x,y:b.y,...g.onResize({...s,x:M,y:A},{newPoint:b,handle:r.dragHandle??"bottom_right",mode:r.mode??"scale_shape",scaleX:_.x,scaleY:_.y,initialBounds:h,initialShape:s})}),r.skipStartAndEndCallbacks||(R=xs(R,((S=g.onResizeEnd)==null?void 0:S.call(g,s,R))??void 0)),this.updateShapes([R])}else{const w=ye.applyToPoint(a,h.center),b=this._scalePagePoint(w,i,t,u),_=this.getPointInParentSpace(s.id,w),T=this.getPointInParentSpace(s.id,b),E=P.Sub(T,_);this.updateShapes([{id:o,type:s.type,x:s.x+E.x,y:s.y+E.y}])}return this}_scalePagePoint(e,t,r,o){const s=P.RotWith(e,t,-o).sub(t),i=P.MulV(s,r);return P.Add(i,t).rotWith(t,o)}_resizeUnalignedShape(e,t,r){const{type:o}=r.initialShape,s=new P(t.x,t.y);if(Math.abs(t.x)>Math.abs(t.y)?s.x=Math.sign(t.x)*Math.abs(t.y):s.y=Math.sign(t.y)*Math.abs(t.x),this.resizeShape(e,s,{initialShape:r.initialShape,initialBounds:r.initialBounds,isAspectRatioLocked:r.isAspectRatioLocked}),Math.sign(t.x)*Math.sign(t.y)<0){let{rotation:w}=ye.Decompose(r.initialPageTransform);w-=2*w,this.updateShapes([{id:e,type:o,rotation:w}])}const i=ye.applyToPoint(r.initialPageTransform,r.initialBounds.center),a=this._scalePagePoint(i,r.scaleOrigin,t,r.scaleAxisRotation),c=this.getShapePageBounds(e),u=this.getShapePageTransform(e),h=c.center,f=u.point();if(!h||!f)return this;const g=P.Sub(a,h),y=P.Add(f,g),{x:v,y:S}=this.getPointInParentSpace(e,y);return this.updateShapes([{id:e,type:o,x:v,y:S}]),this}getInitialMetaForShape(e){return{}}createShape(e){return this.createShapes([e]),this}createShapes(e){if(!Array.isArray(e))throw Error("Editor.createShapes: must provide an array of shapes or shape partials");if(this.getIsReadonly())return this;if(e.length<=0)return this;const t=this.getCurrentPageShapeIds();if(e.length+t.size>this.options.maxShapesPerPage)return Np(this),this;const o=this.getFocusedGroupId();return this.run(()=>{var h,f;const s=this.getCurrentPageShapesSorted(),i=e.map(g=>{if(g.id||(g={id:Ct(),...g}),!g.parentId||!(this.store.has(g.parentId)||e.some(y=>y.id===g.parentId))){let y=this.getFocusedGroupId();for(let S=s.length-1;S>=0;S--){const w=s[S];if(!this.isShapeHidden(w)&&this.getShapeUtil(w).canReceiveNewChildrenOfType(w,g.type)&&this.isPointInShape(w,{x:g.x??0,y:g.y??0},{margin:0,hitInside:!0})){y=w.id;break}}const v=g.parentId;if(y===g.id&&(y=o),y!==v&&(g={...g},g.parentId=y,Tr(y))){const S=this.getPointInShapeSpace(this.getShape(y),{x:g.x??0,y:g.y??0});g.x=S.x,g.y=S.y,g.rotation=-this.getShapePageTransform(y).rotation()+(g.rotation??0)}}return g}),a=new Map,c=[],{opacityForNextShape:u}=this.getInstanceState();for(const g of i){const y=this.getShapeUtil(g);let v=g.index;if(!v){const _=g.parentId??o;a.has(_)||a.set(_,this.getHighestIndexForParent(_)),v=a.get(_),a.set(_,Is(v))}const S=y.getDefaultProps();for(const[_,T]of this.styleProps[g.type])S[T]=this.getStyleForNextShape(_);let w=this.store.schema.types.shape.create({...g,index:v,opacity:g.opacity??u,parentId:g.parentId??o,props:"props"in g?{...S,...g.props}:S});if(w.index===void 0)throw Error("no index!");const b=(f=(h=this.getShapeUtil(w)).onBeforeCreate)==null?void 0:f.call(h,w);b&&(w=b),c.push(w)}c.forEach(g=>{g.meta={...this.getInitialMetaForShape(g),...g.meta}}),this.store.put(c)}),this}animateShape(e,t={animation:F0}){return this.animateShapes([e],t)}animateShapes(e,t={animation:F0}){if(!t.animation)return this;const{duration:r=500,easing:o=xn.linear}=t.animation,s=bt();let i=r,a;const c=[];let u,h;for(let g=0,y=e.length;g<y;g++){if(u=e[g],!u)continue;const v=this.getShape(u.id);v&&(h={start:zt(v),end:xs(zt(v),u)},c.push(h),this.animatingShapes.set(v.id,s))}const f=g=>{var w,b;if(i-=g,i<0){const{animatingShapes:_}=this,T=e.filter(E=>E&&_.get(E.id)===s);T.length&&this.updateShapes(T),this.off("tick",f);return}a=o(1-i/r);const{animatingShapes:y}=this,v=[];let S;for(let _=0,T=c.length;_<T;_++){const{start:E,end:M}=c[_];S=y.get(E.id),S===s&&v.push({...M,x:E.x+(M.x-E.x)*a,y:E.y+(M.y-E.y)*a,opacity:E.opacity+(M.opacity-E.opacity)*a,rotation:E.rotation+(M.rotation-E.rotation)*a,props:((b=(w=this.getShapeUtil(M)).getInterpolatedProps)==null?void 0:b.call(w,E,M,a))??M.props})}this._updateShapes(v)};return this.on("tick",f),this}groupShapes(e,t={}){var v;const{groupId:r=Ct(),select:o=!0}=t;if(!Array.isArray(e))throw Error("Editor.groupShapes: must provide an array of shapes or shape ids");if(this.getIsReadonly())return this;const s=typeof e[0]=="string"?e:e.map(S=>S.id);if(s.length<=1)return this;const i=Ze((this._shouldIgnoreShapeLock?s:this._getUnlockedShapeIds(s)).map(S=>this.getShape(S))),a=i.sort(Gn).map(S=>S.id),c=xe.Common(Ze(i.map(S=>this.getShapePageBounds(S)))),{x:u,y:h}=c.point,f=this.findCommonAncestor(i)??this.getCurrentPageId();if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const g=i.filter(S=>S.parentId===f).sort(Gn),y=(v=g[g.length-1])==null?void 0:v.index;return this.run(()=>{this.createShapes([{id:r,type:"group",parentId:f,index:y,x:u,y:h,opacity:1,props:{}}]),this.reparentShapes(a,r),o&&this.select(r)}),this}ungroupShapes(e,t={}){if(this.getIsReadonly())return this;const{select:r=!0}=t,o=typeof e[0]=="string"?e:e.map(c=>c.id),s=Ze((this._shouldIgnoreShapeLock?o:this._getUnlockedShapeIds(o)).map(c=>this.getShape(c)));if(s.length===0)return this;if(this.getCurrentToolId()!=="select")return this;this.isIn("select.idle")||this.cancel();const i=new Set,a=[];return s.forEach(c=>{this.isShapeOfType(c,"group")?a.push(c):i.add(c.id)}),a.length===0?this:(this.run(()=>{let c;for(let u=0,h=a.length;u<h;u++){c=a[u];const f=this.getSortedChildIdsForParent(c.id);for(let g=0,y=f.length;g<y;g++)i.add(f[g]);this.reparentShapes(f,c.parentId,c.index)}this.deleteShapes(a.map(u=>u.id)),r&&this.select(...i)}),this)}updateShape(e){return this.updateShapes([e]),this}updateShapes(e){const t=Array(e.length);for(let r=0,o=e.length;r<o;r++){const s=e[r];if(!s)continue;const i=this.getShape(s.id);if(i){if(!this._shouldIgnoreShapeLock){if(i.isLocked){if(!(Object.hasOwn(s,"isLocked")&&!s.isLocked))continue}else if(this.isShapeOrAncestorLocked(i))continue}this.animatingShapes.delete(s.id),t.push(s)}}return this._updateShapes(t),this}_updateShapes(e){this.getIsReadonly()||this.run(()=>{var s,i;const t=[];let r,o;for(let a=0,c=e.length;a<c;a++){const u=e[a];u&&(r=this.getShape(u.id),r&&(o=xs(r,u),o!==r&&(o=((i=(s=this.getShapeUtil(r)).onBeforeUpdate)==null?void 0:i.call(s,r,o))??o,t.push(o))))}this.store.put(t)})}_getUnlockedShapeIds(e){return e.filter(t=>{var r;return!((r=this.getShape(t))!=null&&r.isLocked)})}deleteShapes(e){if(this.getIsReadonly())return this;if(!Array.isArray(e))throw Error("Editor.deleteShapes: must provide an array of shapes or shapeIds");const t=typeof e[0]=="string"?e:e.map(s=>s.id),r=this._shouldIgnoreShapeLock?t:this._getUnlockedShapeIds(t);if(r.length===0)return this;const o=new Set(r);for(const s of r)this.visitDescendants(s,i=>{o.add(i)});return this.run(()=>this.store.remove([...o]))}deleteShape(e){return this.deleteShapes([typeof e=="string"?e:e.id]),this}_extractSharedStyles(e,t){if(this.isShapeOfType(e,"group")){const r=this._parentIdsToChildIds.get()[e.id];if(!r)return;for(let o=0,s=r.length;o<s;o++)this._extractSharedStyles(this.getShape(r[o]),t)}else for(const[r,o]of this.styleProps[e.type])t.applyValue(r,Yn(e.props,o))}_getSelectionSharedStyles(){const e=this.getSelectedShapes(),t=new ww;for(const r of e)this._extractSharedStyles(r,t);return t}getStyleForNextShape(e){const t=this.getInstanceState().stylesForNextShape[e.id];return t===void 0?e.defaultValue:t}getShapeStyleIfExists(e,t){const r=this.styleProps[e.type].get(t);if(r!==void 0)return Yn(e.props,r)}getSharedStyles(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0)return this._getSelectionSharedStyles();const e=this.root.getCurrent(),t=new ww;if(!e)return t;if(e.shapeType)for(const r of this.styleProps[e.shapeType].keys())t.applyValue(r,this.getStyleForNextShape(r));return t}getSharedOpacity(){if(this.isIn("select")&&this.getSelectedShapeIds().length>0){const e=[],t=o=>{const s=this.getShape(o);if(s)if(this.isShapeOfType(s,"group"))for(const i of this.getSortedChildIdsForParent(s.id))t(i);else e.push(s)};for(const o of this.getSelectedShapeIds())t(o);let r=null;for(const o of e)if(r===null)r=o.opacity;else if(r!==o.opacity)return{type:"mixed"};if(r!==null)return{type:"shared",value:r}}return{type:"shared",value:this.getInstanceState().opacityForNextShape}}setOpacityForNextShapes(e,t){return this.updateInstanceState({opacityForNextShape:e},t),this}setOpacityForSelectedShapes(e){const t=this.getSelectedShapes();if(t.length>0){const r=[],o=s=>{if(this.isShapeOfType(s,"group")){const i=this.getSortedChildIdsForParent(s);for(const a of i)o(this.getShape(a))}else r.push(s)};for(const s of t)o(s);this.updateShapes(r.map(s=>({id:s.id,type:s.type,opacity:e})))}return this}setStyleForNextShapes(e,t,r){const o=this.getInstanceState().stylesForNextShape;return this.updateInstanceState({stylesForNextShape:{...o,[e.id]:t}},r),this}setStyleForSelectedShapes(e,t){const r=this.getSelectedShapes();if(r.length>0){const o=[],s=i=>{if(this.isShapeOfType(i,"group")){const a=this.getSortedChildIdsForParent(i.id);for(const c of a)s(this.getShape(c))}else{const a=this.getShapeUtil(i),c=this.styleProps[i.type].get(e);if(c){const u={id:i.id,type:i.type,props:{[c]:t}};o.push({util:a,originalShape:i,updatePartial:u})}}};for(const i of r)s(i);this.updateShapes(o.map(({updatePartial:i})=>i))}return this}registerExternalAssetHandler(e,t){return this.externalAssetContentHandlers[e]=t,this}createTemporaryAssetPreview(e,t){if(this.temporaryAssetPreview.has(e))return this.temporaryAssetPreview.get(e);const r=URL.createObjectURL(t);return this.temporaryAssetPreview.set(e,r),setTimeout(()=>{this.temporaryAssetPreview.delete(e),URL.revokeObjectURL(r)},this.options.temporaryAssetPreviewLifetimeMs),r}getTemporaryAssetPreview(e){return this.temporaryAssetPreview.get(e)}async getAssetForExternalContent(e){var t,r;return await((r=(t=this.externalAssetContentHandlers)[e.type])==null?void 0:r.call(t,e))}hasExternalAssetHandler(e){return!!this.externalAssetContentHandlers[e]}registerExternalContentHandler(e,t){return this.externalContentHandlers[e]=t,this}async putExternalContent(e){var t,r;return(r=(t=this.externalContentHandlers)[e.type])==null?void 0:r.call(t,e)}getContentFromCurrentPage(e){const t=typeof e[0]=="string"?e:e.map(o=>o.id);if(!t||t.length===0)return;const r=this.getShapeAndDescendantIds(t);return Zk(this,r,o=>{const s=[];for(const h of o){const f=this.getBinding(h);f&&s.push(f)}const i=[],a=[];for(const h of r){const f=this.getShape(h);if(!f)continue;if(!r.has(f.parentId)){const y=this.getShapePageTransform(f.id),v=y.point();a.push({...f,x:v.x,y:v.y,rotation:y.rotation(),parentId:this.getCurrentPageId()}),i.push(f.id)}else a.push(f)}const c=[],u=new Set;for(const h of a){if(!("assetId"in h.props))continue;const f=h.props.assetId;if(!f||u.has(f))continue;u.add(f);const g=this.getAsset(f);g&&c.push(g)}return{schema:this.store.schema.serialize(),shapes:a,rootShapeIds:i,bindings:s,assets:c}})}async resolveAssetsInContent(e){if(!e)return;const t=[];return await Promise.allSettled(e.assets.map(async r=>{var o,s,i;if((r.type==="image"||r.type==="video")&&!((o=r.props.src)!=null&&o.startsWith("data:image"))&&!((s=r.props.src)!=null&&s.startsWith("data:video"))&&!((i=r.props.src)!=null&&i.startsWith("http"))){const a=zt(r),c=await this.store.props.assets.resolve(r,{screenScale:1,steppedScreenScale:1,dpr:1,networkEffectiveType:null,shouldResolveToOriginal:!0});a.props.src=await Yo.blobToDataUrl(await Ds(c).then(u=>u.blob())),t.push(a)}else t.push(r)})),e.assets=t,e}putContentOntoCurrentPage(e,t={}){var D,U,V;if(this.getIsReadonly())return this;if(!e.schema)throw Error(`Could not put content:
content is missing a schema.`);const{select:r=!1,preserveIds:o=!1,preservePosition:s=!1}=t;let{point:i=void 0}=t;const a=this.getCurrentPageId(),{rootShapeIds:c}=e,u=[],h=[],f=[],g={store:{...Object.fromEntries(e.assets.map(F=>[F.id,F])),...Object.fromEntries(e.shapes.map(F=>[F.id,F])),...Object.fromEntries(((D=e.bindings)==null?void 0:D.map(F=>[F.id,F]))??[])},schema:e.schema},y=this.store.schema.migrateStoreSnapshot(g);if(y.type==="error")throw Error("Could not put content: could not migrate content");for(const F of Object.values(y.value))switch(F.typeName){case"asset":{u.push(F);break}case"shape":{h.push(F);break}case"binding":{f.push(F);break}}const v=new Map(o?h.map(F=>[F.id,F.id]):h.map(F=>[F.id,Ct()])),S=new Map(o?f.map(F=>[F.id,F.id]):f.map(F=>[F.id,al()]));let w=this.getCurrentPageId(),b=1/0,_=[];for(const F of this.getSelectedShapes()){if(b===0)break;const $=this.isShapeOfType(F,"frame"),H=this.getShapeAncestors(F);$&&H.push(F);const Z=$?H.length+1:H.length;if(Z<b)b=Z,_=H,w=$?F.id:F.parentId;else if(Z===b){if(_.length!==H.length)throw Error(`Ancestors: ${_.length} !== ${H.length}`);if(_.length===0){w=a;break}else{w=a;for(let G=0;G<_.length&&H[G]===_[G];G++)w=H[G].id}}}let T=!1;if(!Ir(w)){const F=this.getShape(w);if(F){if(!this.getViewportPageBounds().includes(this.getShapePageBounds(F)))w=a;else if(c.length===1){const $=h.find(H=>H.id===c[0]);this.isShapeOfType(F,"frame")&&this.isShapeOfType($,"frame")&&$.props.w===(F==null?void 0:F.props.w)&&$.props.h===(F==null?void 0:F.props.h)&&(T=!0)}}else w=a}T||(T=v.has(w)),T&&(w=this.getShape(w).parentId);let E=this.getHighestIndexForParent(w);const M=[],A=h.map(F=>{const $=v.get(F.id),H={...F,id:$};return c.includes(F.id)&&(H.parentId=a,M.push(H)),v.has(H.parentId)?H.parentId=v.get(F.parentId):(c.push(H.id),H.index=E,E=Is(E)),H});if(A.length+this.getCurrentPageShapeIds().size>this.options.maxShapesPerPage)return Np(this),this;const R=f.map(F=>({...F,id:Mr(S.get(F.id)),fromId:Mr(v.get(F.fromId)),toId:Mr(v.get(F.toId))})),L=[],K=[];for(const F of u)this.store.has(F.id)||((F.type==="image"&&((U=F.props.src)!=null&&U.startsWith("data:image"))||F.type==="video"&&((V=F.props.src)!=null&&V.startsWith("data:video")))&&(K.push(zt(F)),F.props.src=null),L.push(F));return Promise.allSettled(K.map(async F=>{const $=await jW(F.props.src,F.props.name,F.props.mimeType??"image/png"),H=await this.getAssetForExternalContent({type:"file",file:$,assetId:F.id});if(!H){this.deleteAssets([F.id]);return}this.updateAssets([{...H,id:F.id}])})),this.run(()=>{L.length>0&&this.createAssets(L),this.createShapes(A),this.createBindings(R),r&&this.select(...M.map(G=>G.id)),w!==a&&this.reparentShapes(M.map(G=>G.id),w);const F=A.map(G=>this.getShape(G.id)),$=xe.Common(F.map(G=>this.getShapePageBounds(G)));if(i===void 0)if(Ir(w)){const G=this.getViewportPageBounds();s||G.includes(xe.From($))?i=$.center:i=G.center}else{const G=this.getShape(w);i=ye.applyToPoint(this.getShapePageTransform(G),this.getShapeGeometry(G).bounds.center)}if(M.length===1){const G=M[0];if(this.isShapeOfType(G,"frame"))for(;this.getShapesAtPoint(i).some(q=>this.isShapeOfType(q,"frame")&&q.props.w===G.props.w&&q.props.h===G.props.h);)i.x+=$.w+16}const H=xe.Common(Ze(M.map(({id:G})=>this.getShapePageBounds(G)))).center,Z=P.Sub(i,H);this.updateShapes(M.map(({id:G})=>{const q=this.getShape(G),Q=this.getShapeParentTransform(G).decompose().rotation,ae=P.Rot(Z,-Q);return{id:q.id,type:q.type,x:q.x+ae.x,y:q.y+ae.y}}))}),this}async getSvgElement(e,t={}){const r=typeof e[0]=="string"?e:e.map(o=>o.id);if(r.length!==0)return kW(this,r,t)}async getSvgString(e,t={}){const r=await this.getSvgElement(e,t);return r?{svg:new XMLSerializer().serializeToString(r.svg),width:r.width,height:r.height}:void 0}async getSvg(e,t={}){const r=await this.getSvgElement(e,t);if(r)return r.svg}_updateInputsFromEvent(e){const{pointerVelocity:t,previousScreenPoint:r,previousPagePoint:o,currentScreenPoint:s,currentPagePoint:i}=this.inputs,{screenBounds:a}=this.store.unsafeGetWithoutCapture(ir),{x:c,y:u,z:h}=Pp(()=>this.getCamera()),f=e.point.x-a.x,g=e.point.y-a.y,y=e.point.z??.5;r.setTo(s),o.setTo(i),s.set(f,g);const v=f/h-c,S=g/h-u;isFinite(v)&&isFinite(S)&&i.set(v,S,y),this.inputs.isPen=e.type==="pointer"&&e.isPen,(e.name==="pointer_down"||this.inputs.isPinching)&&(t.set(0,0),this.inputs.originScreenPoint.setTo(s),this.inputs.originPagePoint.setTo(i)),this.run(()=>{var w;this.store.put([{id:og,typeName:"pointer",x:i.x,y:i.y,lastActivityTimestamp:e.type==="pointer"&&e.pointerId===uk.CAMERA_MOVE?((w=this.store.unsafeGetWithoutCapture(og))==null?void 0:w.lastActivityTimestamp)??this._tickManager.now:this._tickManager.now,meta:{}}])},{history:"ignore"})}cancel(){return this.dispatch({type:"misc",name:"cancel"}),this}interrupt(){return this.dispatch({type:"misc",name:"interrupt"}),this}complete(){return this.dispatch({type:"misc",name:"complete"}),this}focus({focusContainer:e=!0}={}){return this.getIsFocused()?this:(e&&this.focusManager.focus(),this.updateInstanceState({isFocused:!0}),this)}blur({blurContainer:e=!0}={}){return this.getIsFocused()?(e?this.focusManager.blur():this.complete(),this.updateInstanceState({isFocused:!1}),this):this}getIsFocused(){return this.getInstanceState().isFocused}getIsReadonly(){return this.getInstanceState().isReadonly}getSnapshot(){return kK(this.store)}loadSnapshot(e,t){return IR(this.store,e,t),this}_zoomToFitPageContentAt100Percent(){const e=this.getCurrentPageBounds();e&&this.zoomToBounds(e,{immediate:!0,targetZoom:this.getBaseZoom()})}_navigateToDeepLink(e){this.run(()=>{switch(e.type){case"page":{const t=this.getPage(e.pageId);t&&this.setCurrentPage(t),this._zoomToFitPageContentAt100Percent();return}case"shapes":{const t=Ze(e.shapeIds.map(i=>this.getShape(i))),r={};for(const i of t){const a=this.getAncestorPageId(i);a&&(r[a]??(r[a]=[]),r[a].push(i))}const[o,s]=Object.entries(r).sort(([i,a],[c,u])=>u.length-a.length)[0]??["",[]];if(!o||!s.length)this._zoomToFitPageContentAt100Percent();else{this.setCurrentPage(o);const i=xe.Common(s.map(a=>this.getShapePageBounds(a)));this.zoomToBounds(i,{immediate:!0,targetZoom:this.getBaseZoom()})}return}case"viewport":{if(e.pageId){if(!this.getPage(e.pageId)){this._zoomToFitPageContentAt100Percent();return}this.setCurrentPage(e.pageId)}this.zoomToBounds(e.bounds,{immediate:!0,inset:0});return}default:Sn(e)}})}navigateToDeepLink(e){if(e&&"type"in e)return this._navigateToDeepLink(e),this;const r=new URL((e==null?void 0:e.url)??window.location.href).searchParams.get((e==null?void 0:e.param)??"d");if(!r)return this._zoomToFitPageContentAt100Percent(),this;try{this._navigateToDeepLink(DW(r))}catch(o){console.warn(o),this._zoomToFitPageContentAt100Percent()}return this}createDeepLink(e){const t=new URL((e==null?void 0:e.url)??window.location.href);return t.searchParams.set((e==null?void 0:e.param)??"d",OW((e==null?void 0:e.to)??{type:"viewport",pageId:this.options.maxPages===1?void 0:this.getCurrentPageId(),bounds:this.getViewportPageBounds()})),t}registerDeepLinkListener(e){if(e!=null&&e.getUrl&&!(e!=null&&e.onChange))throw Error("[tldraw:urlStateSync] If you specify getUrl, you must also specify the onChange callback.");const t=ce("url with state",()=>{var c,u;const i=((c=e==null?void 0:e.getUrl)==null?void 0:c.call(e,this))??window.location.href;return this.createDeepLink({param:e==null?void 0:e.param,url:i,to:(u=e==null?void 0:e.getTarget)==null?void 0:u.call(e,this)}).toString()}),r=(e==null?void 0:e.onChange)??(()=>{var a;const i=this.createDeepLink({param:e==null?void 0:e.param,to:(a=e==null?void 0:e.getTarget)==null?void 0:a.call(e,this)});window.history.replaceState({},document.title,i.toString())}),o=Ag(i=>i(),(e==null?void 0:e.debounceMs)??500),s=Ms("update url on state change",()=>r(new URL(t.get()),this),{scheduleEffect:o});return()=>{s(),o.cancel()}}cancelDoubleClick(){this._clickManager.cancelDoubleClickTimeout()}_setShiftKeyTimeout(){this.inputs.shiftKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Shift",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:qn(this.inputs),code:"ShiftLeft"})}_setAltKeyTimeout(){this.inputs.altKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Alt",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:qn(this.inputs),code:"AltLeft"})}_setCtrlKeyTimeout(){this.inputs.ctrlKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Ctrl",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:qn(this.inputs),code:"ControlLeft"})}_setMetaKeyTimeout(){this.inputs.metaKey=!1,this.dispatch({type:"keyboard",name:"key_up",key:"Meta",shiftKey:this.inputs.shiftKey,ctrlKey:this.inputs.ctrlKey,altKey:this.inputs.altKey,metaKey:this.inputs.metaKey,accelKey:qn(this.inputs),code:"MetaLeft"})}dispatch(e){return this._pendingEventsForNextTick.push(e),e.type==="pointer"&&e.name==="pointer_move"||e.type==="wheel"||e.type==="pinch"||this._flushEventsForTick(0),this}_flushEventsForTick(e){this.run(()=>{if(this._pendingEventsForNextTick.length>0){const t=[...this._pendingEventsForNextTick];this._pendingEventsForNextTick.length=0;for(const r of t)this._flushEventForTick(r)}e>0&&this.root.handleEvent({type:"misc",name:"tick",elapsed:e}),this.scribbles.tick(e)})}_flushEventForTick(e){if(this.getCrashingError())return this;const{inputs:t}=this,{type:r}=e;if(e.type==="misc"){(e.name==="cancel"||e.name==="complete")&&(this.inputs.isDragging=!1,this.inputs.isPanning&&(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0}))),this.root.handleEvent(e);return}e.shiftKey?(clearTimeout(this._shiftKeyTimeout),this._shiftKeyTimeout=-1,t.shiftKey=!0):!e.shiftKey&&t.shiftKey&&this._shiftKeyTimeout===-1&&(this._shiftKeyTimeout=this.timers.setTimeout(this._setShiftKeyTimeout,150)),e.altKey?(clearTimeout(this._altKeyTimeout),this._altKeyTimeout=-1,t.altKey=!0):!e.altKey&&t.altKey&&this._altKeyTimeout===-1&&(this._altKeyTimeout=this.timers.setTimeout(this._setAltKeyTimeout,150)),e.ctrlKey?(clearTimeout(this._ctrlKeyTimeout),this._ctrlKeyTimeout=-1,t.ctrlKey=!0):!e.ctrlKey&&t.ctrlKey&&this._ctrlKeyTimeout===-1&&(this._ctrlKeyTimeout=this.timers.setTimeout(this._setCtrlKeyTimeout,150)),e.metaKey?(clearTimeout(this._metaKeyTimeout),this._metaKeyTimeout=-1,t.metaKey=!0):!e.metaKey&&t.metaKey&&this._metaKeyTimeout===-1&&(this._metaKeyTimeout=this.timers.setTimeout(this._setMetaKeyTimeout,150));const{originPagePoint:o,currentPagePoint:s}=t;t.isPointing||(t.isDragging=!1);const i=this.store.unsafeGetWithoutCapture(ir),a=this.store.get(this._getCurrentPageStateId()),c=this._cameraOptions.__unsafe__getWithoutCapture();switch(r){case"pinch":{if(c.isLocked)return;switch(clearTimeout(this._longPressTimeout),this._updateInputsFromEvent(e),e.name){case"pinch_start":{if(t.isPinching)return;t.isEditing||(this._pinchStart=this.getCamera().z,this._selectedShapeIdsAtPointerDown.length||(this._selectedShapeIdsAtPointerDown=[...a.selectedShapeIds]),this._didPinch=!0,t.isPinching=!0,this.interrupt());return}case"pinch":{if(!t.isPinching)return;const{point:{z:u=1},delta:{x:h,y:f}}=e,{x:g,y}=P.SubXY(e.point,i.screenBounds.x,i.screenBounds.y);this.stopCameraAnimation(),i.followingUserId&&this.stopFollowingUser();const{x:v,y:S,z:w}=Pp(()=>this.getCamera()),{panSpeed:b,zoomSpeed:_}=c;this._setCamera(new P(v+h*b/w-g/w+g/(u*_),S+f*b/w-y/w+y/(u*_),u*_),{immediate:!0});return}case"pinch_end":{if(!t.isPinching)return this;t.isPinching=!1;const{_selectedShapeIdsAtPointerDown:u}=this;this.setSelectedShapes(this._selectedShapeIdsAtPointerDown),this._selectedShapeIdsAtPointerDown=[],this._didPinch&&(this._didPinch=!1,u.length>0&&this.once("tick",()=>{this._didPinch||this.setSelectedShapes(u)}));return}}}case"wheel":{if(c.isLocked)return;this._updateInputsFromEvent(e);const{panSpeed:u,zoomSpeed:h,wheelBehavior:f}=c;if(f!=="none"){this.stopCameraAnimation(),i.followingUserId&&this.stopFollowingUser();const{x:g,y,z:v}=Pp(()=>this.getCamera()),{x:S,y:w,z:b=0}=e.delta;let _=f;switch(t.ctrlKey&&(_=f==="pan"?"zoom":"pan"),_){case"zoom":{const{x:T,y:E}=this.inputs.currentScreenPoint;let M=b;f==="zoom"&&(Math.abs(w)>10?M=10*Math.sign(w)/100:M=w/100);const A=v+(M??0)*h*v;this._setCamera(new P(g+(T/A-T)-(T/v-T),y+(E/A-E)-(E/v-E),A),{immediate:!0}),this.maybeTrackPerformance("Zooming");return}case"pan":{this._setCamera(new P(g+S*u/v,y+w*u/v,v),{immediate:!0}),this.maybeTrackPerformance("Panning");return}}}break}case"pointer":{if(t.isPinching)return;this._updateInputsFromEvent(e);const{isPen:u}=e,{isPenMode:h}=i;switch(e.name){case"pointer_down":{if(h&&!u)return;if(this.inputs.isPanning||(this._longPressTimeout=this.timers.setTimeout(()=>{const f=this.getViewportScreenBounds();this.dispatch({...e,point:this.inputs.originScreenPoint.clone().addXY(f.x,f.y),name:"long_press"})},this.options.longPressDurationMs)),this._selectedShapeIdsAtPointerDown=this.getSelectedShapeIds(),e.button===dk&&(this.capturedPointerId=e.pointerId),t.buttons.add(e.button),t.isPointing=!0,t.isDragging=!1,!h&&u&&this.updateInstanceState({isPenMode:!0}),e.button===hk?(this._restoreToolId=this.getCurrentToolId(),this.complete(),this.setCurrentTool("eraser")):e.button===Ap&&(this.inputs.isPanning||(this._prevCursor=this.getInstanceState().cursor.type),this.inputs.isPanning=!0,clearTimeout(this._longPressTimeout)),this.inputs.isPanning)return this.stopCameraAnimation(),this.setCursor({type:"grabbing",rotation:0}),this;break}case"pointer_move":{if(!u&&h)return;const{x:f,y:g,z:y}=Pp(()=>this.getCamera());if(this.inputs.isPanning&&this.inputs.isPointing){const{currentScreenPoint:v,previousScreenPoint:S}=this.inputs,{panSpeed:w}=c,b=P.Sub(v,S);this.setCamera(new P(f+b.x*w/y,g+b.y*w/y,y),{immediate:!0}),this.maybeTrackPerformance("Panning");return}t.isPointing&&!t.isDragging&&P.Dist2(o,s)*this.getZoomLevel()>(i.isCoarsePointer?this.options.coarseDragDistanceSquared:this.options.dragDistanceSquared)/y&&(t.isDragging=!0,clearTimeout(this._longPressTimeout));break}case"pointer_up":{if(t.isDragging=!1,t.isPointing=!1,clearTimeout(this._longPressTimeout),t.buttons.delete(e.button),i.isPenMode&&!u)return;if(this.capturedPointerId===e.pointerId&&(this.capturedPointerId=null,e.button=0),t.isPanning){t.keys.has("Space")||(t.isPanning=!1,t.isSpacebarPanning=!1);const f=this.inputs.pointerVelocity,g=Math.min(2,f.len());switch(e.button){case dk:{this.setCursor({type:"grab",rotation:0});break}case Ap:this.inputs.keys.has(" ")?this.setCursor({type:"grab",rotation:0}):this.setCursor({type:this._prevCursor,rotation:0})}g>0&&this.slideCamera({speed:g,direction:f})}else e.button===hk&&(this.complete(),this.setCurrentTool(this._restoreToolId));break}}break}case"keyboard":{switch(e.key==="ShiftRight"&&(e.key="ShiftLeft"),e.key==="AltRight"&&(e.key="AltLeft"),e.code==="ControlRight"&&(e.code="ControlLeft"),e.code==="MetaRight"&&(e.code="MetaLeft"),e.name){case"key_down":{if(t.keys.add(e.code),e.code==="Space"&&!e.ctrlKey&&(this.inputs.isPanning||(this._prevCursor=i.cursor.type),this.inputs.isPanning=!0,this.inputs.isSpacebarPanning=!0,clearTimeout(this._longPressTimeout),this.setCursor({type:this.inputs.isPointing?"grabbing":"grab",rotation:0})),this.inputs.isSpacebarPanning){let u;switch(e.code){case"ArrowUp":{u=new P(0,-1);break}case"ArrowRight":{u=new P(1,0);break}case"ArrowDown":{u=new P(0,1);break}case"ArrowLeft":{u=new P(-1,0);break}}if(u){const h=this.getViewportPageBounds(),f=h.clone().translate(u.mulV({x:h.w,y:h.h}));this._animateToViewport(f,{animation:{duration:320}})}}break}case"key_up":{t.keys.delete(e.code),e.code==="Space"&&(this.inputs.buttons.has(Ap)||(this.inputs.isPanning=!1,this.inputs.isSpacebarPanning=!1,this.setCursor({type:this._prevCursor,rotation:0})));break}}break}}if(e.type==="pointer"){e.button===Ap?e.name="middle_click":e.button===u1&&(e.name="right_click");const{isPenMode:u}=this.store.unsafeGetWithoutCapture(ir);if(e.isPen===u){const h=this._clickManager.handlePointerEvent(e);if(e.name!==h.name){this.root.handleEvent(e),this.emit("event",e),this.root.handleEvent(h),this.emit("event",h);return}}}return this.root.handleEvent(e),this.emit("event",e),e.type==="pointer"&&e.name==="pointer_down"&&this.menus.clearOpenMenus(),this}maybeTrackPerformance(e){sn.measurePerformance.get()&&(this.performanceTracker.isStarted()?clearTimeout(this.performanceTrackerTimeout):this.performanceTracker.start(e),this.performanceTrackerTimeout=this.timers.setTimeout(()=>{this.performanceTracker.stop()},50))}}Pe=rG(_w);Ce(Pe,1,"getIsShapeHiddenCache",C3,be);Ce(Pe,1,"getCanUndo",P3,be);Ce(Pe,1,"getCanRedo",_3,be);Ce(Pe,1,"getPath",b3,be);Ce(Pe,1,"getCurrentTool",w3,be);Ce(Pe,1,"getCurrentToolId",x3,be);Ce(Pe,1,"getDocumentSettings",S3,be);Ce(Pe,1,"getInstanceState",v3,be);Ce(Pe,1,"getOpenMenus",y3,be);Ce(Pe,1,"getIsMenuOpen",m3,be);Ce(Pe,1,"getPageStates",g3,be);Ce(Pe,1,"_getPageStatesQuery",f3,be);Ce(Pe,1,"getCurrentPageState",p3,be);Ce(Pe,1,"_getCurrentPageStateId",h3,be);Ce(Pe,1,"getSelectedShapeIds",d3,be);Ce(Pe,1,"getSelectedShapes",u3,be);Ce(Pe,1,"getOnlySelectedShapeId",c3,be);Ce(Pe,1,"getOnlySelectedShape",l3,be);Ce(Pe,1,"getSelectionPageBounds",a3,be);Ce(Pe,1,"getSelectionRotation",i3,be);Ce(Pe,1,"getSelectionRotatedPageBounds",s3,be);Ce(Pe,1,"getSelectionRotatedScreenBounds",o3,be);Ce(Pe,1,"getFocusedGroupId",r3,be);Ce(Pe,1,"getFocusedGroup",n3,be);Ce(Pe,1,"getEditingShapeId",t3,be);Ce(Pe,1,"getEditingShape",e3,be);Ce(Pe,1,"getHoveredShapeId",JD,be);Ce(Pe,1,"getHoveredShape",QD,be);Ce(Pe,1,"getHintingShapeIds",ZD,be);Ce(Pe,1,"getHintingShape",XD,be);Ce(Pe,1,"getErasingShapeIds",YD,be);Ce(Pe,1,"getErasingShapes",qD,be);Ce(Pe,1,"_unsafe_getCameraId",GD,be);Ce(Pe,1,"getCamera",VD,be);Ce(Pe,1,"getViewportPageBoundsForFollowing",WD,be);Ce(Pe,1,"getCameraForFollowing",KD,be);Ce(Pe,1,"getZoomLevel",HD,be);Ce(Pe,1,"getViewportScreenBounds",UD,be);Ce(Pe,1,"getViewportScreenCenter",BD,be);Ce(Pe,1,"getViewportPageBounds",zD,be);Ce(Pe,1,"_getCollaboratorsQuery",$D,be);Ce(Pe,1,"getCollaborators",ND,be);Ce(Pe,1,"getCollaboratorsOnCurrentPage",FD,be);Ce(Pe,1,"getRenderingShapes",LD,be);Ce(Pe,1,"_getAllPagesQuery",DD,be);Ce(Pe,1,"getPages",OD,be);Ce(Pe,1,"getCurrentPageId",RD,be);Ce(Pe,1,"getCurrentPageShapeIdsSorted",jD,be);Ce(Pe,1,"_getAllAssetsQuery",AD,be);Ce(Pe,1,"_getShapeGeometryCache",MD,be);Ce(Pe,1,"_getShapeHandlesCache",TD,be);Ce(Pe,1,"_getShapePageTransformCache",kD,be);Ce(Pe,1,"_getShapePageBoundsCache",ED,be);Ce(Pe,1,"_getShapeClipPathCache",ID,be);Ce(Pe,1,"_getShapeMaskCache",CD,be);Ce(Pe,1,"_getShapeMaskedPageBoundsCache",PD,be);Ce(Pe,1,"_notVisibleShapes",_D,be);Ce(Pe,1,"getCulledShapes",bD,be);Ce(Pe,1,"getCurrentPageBounds",wD,be);Ce(Pe,1,"getCurrentPageShapes",xD,be);Ce(Pe,1,"getCurrentPageShapesSorted",SD,be);Ce(Pe,1,"getCurrentPageRenderingShapesSorted",vD,be);Ce(Pe,1,"_getBindingsIndexCache",yD,be);Ce(Pe,1,"_getSelectionSharedStyles",mD,be);Ce(Pe,1,"getSharedStyles",gD,be);Ce(Pe,1,"getSharedOpacity",fD,be);Ce(Pe,1,"getIsFocused",pD,be);Ce(Pe,1,"getIsReadonly",hD,be);Ce(Pe,1,"_setShiftKeyTimeout",dD,be);Ce(Pe,1,"_setAltKeyTimeout",uD,be);Ce(Pe,1,"_setCtrlKeyTimeout",cD,be);Ce(Pe,1,"_setMetaKeyTimeout",lD,be);sG(Pe,be);function Np(n,e=n.getCurrentPageId()){const t=n.getPage(e).name;n.emit("max-shapes",{name:t,pageId:e,count:n.options.maxShapesPerPage})}function xs(n,e){if(!e)return n;let t=null;const r=Object.entries(e);for(let o=0,s=r.length;o<s;o++){const[i,a]=r[o];if(a!==void 0&&!(i==="id"||i==="type"||i==="typeName")&&a!==n[i]){if(t||(t={...n}),i==="props"||i==="meta"){t[i]={...n[i]};for(const[c,u]of Object.entries(a))u!==void 0&&(t[i][c]=u);continue}t[i]=a}}return t||n}function I3(n,e,t){const r=n.getShape(e);if(!r)return;t.push(r);const o=n.getSortedChildIdsForParent(e);for(let s=0,i=o.length;s<i;s++)I3(n,o[s],t)}function Zk(n,e,t){let r;if(n.run(()=>{const o=n.store.extractingChanges(()=>{const s=new Set,i=new Set;for(const a of e)if(n.getShape(a))for(const u of n.getBindingsInvolvingShape(a)){const h=e.has(u.fromId),f=e.has(u.toId);if(h&&f){s.add(u.id);continue}(!h||!f)&&i.add(u.id)}n.deleteBindings([...i],{isolateShapes:!0});try{r=da.ok(t(s))}catch(a){r=da.err(a)}});n.store.applyDiff(iw(o))},{history:"ignore"}),r.ok)return r.value;throw r.error}function Qk(n,e){if(!e.constraints)throw Error("Should have constraints here");const{padding:{x:t,y:r}}=e.constraints,o=n.getViewportScreenBounds(),s=xe.From(e.constraints.bounds),i=(o.w-t*2)/s.w,a=(o.h-r*2)/s.h;return{zx:i,zy:a}}function ah(){const n=te(),e=rh();return re("isDarkMode",()=>(e==null?void 0:e.isDarkMode)??n.user.getIsDarkMode(),[e,n])}const Jk="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",eT="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",$p='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function Ji(n,e,t,r,o,s=16,i=16){const a=(-t-e)*(ft/180),c=Math.sin(a),u=Math.cos(a),h=1*u-1*c,f=1*c+1*u;return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${o};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${h}' dy='${f}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${e+t} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+n.replaceAll('"',"'")+`</g></svg>") ${s} ${i}, pointer`}const aG=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],lG={none:()=>"none","ew-resize":(n,e,t)=>Ji(eT,n,0,e,t),"ns-resize":(n,e,t)=>Ji(eT,n,90,e,t),"nesw-resize":(n,e,t)=>Ji(Jk,n,0,e,t),"nwse-resize":(n,e,t)=>Ji(Jk,n,90,e,t),"nwse-rotate":(n,e,t)=>Ji($p,n,0,e,t),"nesw-rotate":(n,e,t)=>Ji($p,n,90,e,t),"senw-rotate":(n,e,t)=>Ji($p,n,180,e,t),"swne-rotate":(n,e,t)=>Ji($p,n,270,e,t)};function qr(n,e=0,t="black"){return lG[n](QU(e),!1,t)}function cG(){const n=te(),e=fn(),t=ah();ha("useCursor",()=>{const{type:r,rotation:o}=n.getInstanceState().cursor;if(aG.includes(r)){e.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}e.style.setProperty("--tl-cursor",qr(r,o,t?"white":"black"))},[n,e,t])}function uG(){const n=te(),e=fn(),t=ah(),r=re(sn.forceSrgb);at.useEffect(()=>{t?(e.setAttribute("data-color-mode","dark"),e.classList.remove("tl-theme__light"),e.classList.add("tl-theme__dark")):(e.setAttribute("data-color-mode","light"),e.classList.remove("tl-theme__dark"),e.classList.add("tl-theme__light")),r?e.classList.add("tl-theme__force-sRGB"):e.classList.remove("tl-theme__force-sRGB")},[n,e,r,t])}function dG(){const[n,e]=C.useState(0);C.useEffect(()=>e(t=>t+1),[])}const hG=n=>n.props.src,pG={upload:(n,e)=>Yo.blobToDataUrl(e)};function fG(n){return"schema"in n&&n.schema?n.schema:NU({shapes:"shapeUtils"in n&&n.shapeUtils?tT(MR(n.shapeUtils)):void 0,bindings:"bindingUtils"in n&&n.bindingUtils?tT(kR(n.bindingUtils)):void 0,migrations:"migrations"in n?n.migrations:void 0})}function hg({initialData:n,defaultName:e="",id:t,assets:r=pG,onMount:o,collaboration:s,...i}={}){const a=fG(i),c=new Yb({id:t,schema:a,initialData:n,props:{defaultName:e,assets:{upload:r.upload,resolve:r.resolve??hG},onMount:u=>{yt(u instanceof be),o==null||o(u)},collaboration:s}});if(i.snapshot){if(n)throw new Error("Cannot provide both initialData and snapshot");IR(c,i.snapshot)}return c}function tT(n){return Object.fromEntries(n.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}const gG=(n,e)=>e.some(t=>n instanceof t);let nT,rT;function mG(){return nT||(nT=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function yG(){return rT||(rT=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const E3=new WeakMap,Pw=new WeakMap,k3=new WeakMap,Z0=new WeakMap,T1=new WeakMap;function vG(n){const e=new Promise((t,r)=>{const o=()=>{n.removeEventListener("success",s),n.removeEventListener("error",i)},s=()=>{t(yi(n.result)),o()},i=()=>{r(n.error),o()};n.addEventListener("success",s),n.addEventListener("error",i)});return e.then(t=>{t instanceof IDBCursor&&E3.set(t,n)}).catch(()=>{}),T1.set(e,n),e}function SG(n){if(Pw.has(n))return;const e=new Promise((t,r)=>{const o=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",i),n.removeEventListener("abort",i)},s=()=>{t(),o()},i=()=>{r(n.error||new DOMException("AbortError","AbortError")),o()};n.addEventListener("complete",s),n.addEventListener("error",i),n.addEventListener("abort",i)});Pw.set(n,e)}let Cw={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Pw.get(n);if(e==="objectStoreNames")return n.objectStoreNames||k3.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return yi(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function xG(n){Cw=n(Cw)}function wG(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){const r=n.call(Q0(this),e,...t);return k3.set(r,e.sort?e.sort():[e]),yi(r)}:yG().includes(n)?function(...e){return n.apply(Q0(this),e),yi(E3.get(this))}:function(...e){return yi(n.apply(Q0(this),e))}}function bG(n){return typeof n=="function"?wG(n):(n instanceof IDBTransaction&&SG(n),gG(n,mG())?new Proxy(n,Cw):n)}function yi(n){if(n instanceof IDBRequest)return vG(n);if(Z0.has(n))return Z0.get(n);const e=bG(n);return e!==n&&(Z0.set(n,e),T1.set(e,n)),e}const Q0=n=>T1.get(n);function T3(n,e,{blocked:t,upgrade:r,blocking:o,terminated:s}={}){const i=indexedDB.open(n,e),a=yi(i);return r&&i.addEventListener("upgradeneeded",c=>{r(yi(i.result),c.oldVersion,c.newVersion,yi(i.transaction),c)}),t&&i.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),o&&c.addEventListener("versionchange",u=>o(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}function M3(n,{blocked:e}={}){const t=indexedDB.deleteDatabase(n);return e&&t.addEventListener("blocked",r=>e(r.oldVersion,r)),yi(t).then(()=>{})}const _G=["get","getKey","getAll","getAllKeys","count"],PG=["put","add","delete","clear"],J0=new Map;function oT(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(J0.get(e))return J0.get(e);const t=e.replace(/FromIndex$/,""),r=e!==t,o=PG.includes(t);if(!(t in(r?IDBIndex:IDBObjectStore).prototype)||!(o||_G.includes(t)))return;const s=async function(i,...a){const c=this.transaction(i,o?"readwrite":"readonly");let u=c.store;return r&&(u=u.index(a.shift())),(await Promise.all([u[t](...a),o&&c.done]))[0]};return J0.set(e,s),s}xG(n=>({...n,get:(e,t,r)=>oT(e,t)||n.get(e,t,r),has:(e,t)=>!!oT(e,t)||n.has(e,t)}));const CG="TLDRAW_DOCUMENT_v2",IG="TLDRAW_ASSET_STORE_v1",A3="TLDRAW_DB_NAME_INDEX_v2",st={Records:"records",Schema:"schema",SessionState:"session_state",Assets:"assets"};async function j3(n){const e=CG+n;return kG(e),await T3(e,4,{upgrade(t){t.objectStoreNames.contains(st.Records)||t.createObjectStore(st.Records),t.objectStoreNames.contains(st.Schema)||t.createObjectStore(st.Schema),t.objectStoreNames.contains(st.SessionState)||t.createObjectStore(st.SessionState),t.objectStoreNames.contains(st.Assets)||t.createObjectStore(st.Assets)}})}async function EG(n){const e=window.indexedDB.databases?(await window.indexedDB.databases()).map(g=>g.name):M1(),t=IG+n;if(!e.find(g=>g===t))return;const o=await T3(t,1,{upgrade(g){g.objectStoreNames.contains("assets")||g.createObjectStore("assets")}});if(!o.objectStoreNames.contains("assets"))return;const s=o.transaction(["assets"],"readonly"),i=s.objectStore("assets"),a=await i.getAllKeys(),c=await Promise.all(a.map(async g=>[g,await i.get(g)]));await s.done;const u=await j3(n),h=u.transaction([st.Assets],"readwrite"),f=h.objectStore(st.Assets);for(const[g,y]of c)f.put(y,g);await h.done,o.close(),u.close(),await M3(t)}const Ed=class Ed{constructor(e){j(this,"getDbPromise");j(this,"isClosed",!1);j(this,"pendingTransactionSet",new Set);Ed.connectedInstances.add(this),this.getDbPromise=(async()=>(await EG(e),await j3(e)))()}getDb(){return this.getDbPromise}pending(){return Promise.allSettled([this.getDbPromise,...this.pendingTransactionSet]).then(Md)}async close(){this.isClosed||(this.isClosed=!0,await this.pending(),(await this.getDb()).close(),Ed.connectedInstances.delete(this))}tx(e,t,r){const o=(async()=>{yt(!this.isClosed,"db is closed");const i=(await this.getDb()).transaction(t,e),a=i.done.catch(c=>{if(!this.isClosed)throw c});try{return await r(i)}finally{this.isClosed?i.abort():await a}})();return this.pendingTransactionSet.add(o),o.finally(()=>this.pendingTransactionSet.delete(o)),o}async load({sessionId:e}={}){return await this.tx("readonly",[st.Records,st.Schema,st.SessionState],async t=>{var c,u;const r=t.objectStore(st.Records),o=t.objectStore(st.Schema),s=t.objectStore(st.SessionState);let i=e?(c=await s.get(e))==null?void 0:c.snapshot:null;return i||(i=(u=(await s.getAll()).sort((f,g)=>f.updatedAt-g.updatedAt).pop())==null?void 0:u.snapshot),{records:await r.getAll(),schema:await o.get(st.Schema),sessionStateSnapshot:i}})}async storeChanges({schema:e,changes:t,sessionId:r,sessionStateSnapshot:o}){await this.tx("readwrite",[st.Records,st.Schema,st.SessionState],async s=>{const i=s.objectStore(st.Records),a=s.objectStore(st.Schema),c=s.objectStore(st.SessionState);for(const[u,h]of Object.entries(t.added))await i.put(h,u);for(const[u,h]of Object.values(t.updated))await i.put(h,h.id);for(const u of Object.keys(t.removed))await i.delete(u);a.put(e.serialize(),st.Schema),o&&r?c.put({snapshot:o,updatedAt:Date.now(),id:r},r):(o||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async storeSnapshot({schema:e,snapshot:t,sessionId:r,sessionStateSnapshot:o}){await this.tx("readwrite",[st.Records,st.Schema,st.SessionState],async s=>{const i=s.objectStore(st.Records),a=s.objectStore(st.Schema),c=s.objectStore(st.SessionState);await i.clear();for(const[u,h]of Object.entries(t))await i.put(h,u);a.put(e.serialize(),st.Schema),o&&r?c.put({snapshot:o,updatedAt:Date.now(),id:r},r):(o||r)&&console.error("sessionStateSnapshot and instanceId must be provided together")})}async pruneSessions(){await this.tx("readwrite",[st.SessionState],async e=>{const t=e.objectStore(st.SessionState),r=(await t.getAll()).sort((s,i)=>s.updatedAt-i.updatedAt);if(r.length<10){await e.done;return}const o=r.slice(0,r.length-10);for(const{id:s}of o)await t.delete(s)})}async getAsset(e){return await this.tx("readonly",[st.Assets],async t=>await t.objectStore(st.Assets).get(e))}async storeAsset(e,t){await this.tx("readwrite",[st.Assets],async r=>{await r.objectStore(st.Assets).put(t,e)})}};j(Ed,"connectedInstances",new Set);let pg=Ed;function M1(){const n=JSON.parse(Ab(A3)||"[]")??[];return Array.isArray(n)?n:[]}function kG(n){const e=new Set(M1());e.add(n),jb(A3,JSON.stringify([...e]))}function TG(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
• If your hard disk is full, try clearing up some space and then reload the page.`)}function MG(){window.alert(`Oops! We could not access your browser's storage—and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
• If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}const AG=350,jG=1e4,sT=Symbol("UPDATE_INSTANCE_STATE"),RG=n=>n;class OG{constructor(e){j(this,"onmessage")}postMessage(e){}close(){}}const DG=typeof BroadcastChannel>"u"?OG:BroadcastChannel;class LG{constructor(e,{persistenceKey:t,sessionId:r=dg,onLoad:o,onLoadError:s},i=new DG(`tldraw-tab-sync-${t}`)){j(this,"disposables",new Set);j(this,"diffQueue",[]);j(this,"didDispose",!1);j(this,"shouldDoFullDBWrite",!0);j(this,"isReloading",!1);j(this,"persistenceKey");j(this,"sessionId");j(this,"serializedSchema");j(this,"isDebugging",!1);j(this,"documentTypes");j(this,"$sessionStateSnapshot");j(this,"db");j(this,"initTime",Date.now());j(this,"isPersisting",!1);j(this,"didLastWriteError",!1);j(this,"scheduledPersistTimeout",null);this.store=e,this.channel=i,typeof window<"u"&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=r,this.db=new pg(t),this.disposables.add(()=>this.db.close()),this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=m1(this.store),this.disposables.add(e.listen(({changes:a})=>{this.diffQueue.push(a),this.channel.postMessage(RG({type:"diff",storeId:this.store.id,changes:a,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(sT),this.schedulePersist()},{scope:"session"})),this.connect(o,s),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(a=>a.scope==="document").map(a=>a.typeName))}debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){this.debug("connecting");let r;try{r=await this.db.load({sessionId:this.sessionId})}catch(o){t(o),MG();return}if(this.debug("loaded data from store",r,"didDispose",this.didDispose),!this.didDispose)try{if(r){const o=Object.fromEntries(r.records.map(c=>[c.id,c])),s=r.sessionStateSnapshot??EK(o),i=this.store.schema.migrateStoreSnapshot({store:o,schema:r.schema??this.store.schema.serializeEarliestVersion()});if(i.type==="error"){console.error("failed to migrate store",i),t(new Error(`Failed to migrate store: ${i.reason}`));return}const a=Object.values(i.value).filter(c=>this.documentTypes.has(c.typeName));a.length>0&&this.store.mergeRemoteChanges(()=>{this.store.put(a,"initialize")}),s&&mw(this.store,s)}this.channel.onmessage=({data:o})=>{var a,c;this.debug("got message",o);const s=o,i=this.store.schema.getMigrationsSince(s.schema);if(i.ok){if(i.value.length>0){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}}else{if(Date.now()-this.initTime<5e3){t(new Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,(c=(a=window==null?void 0:window.location)==null?void 0:a.reload)==null||c.call(a);return}s.type==="diff"&&(this.debug("applying diff"),As(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(s.changes)})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(o){if(this.debug("error loading data from store",o),this.didDispose)return;t(o);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),!this.scheduledPersistTimeout&&(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?jG:AG))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),!this.isPersisting&&(this.isReloading||this.store.isPossiblyCorrupted()||(this.shouldDoFullDBWrite||this.diffQueue.length>0)&&this.doPersist())}async doPersist(){if(yt(!this.isPersisting,"persist already in progress"),this.didDispose)return;this.isPersisting=!0,this.debug("doPersist start");const e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await this.db.storeSnapshot({schema:this.store.schema,snapshot:this.store.serialize(),sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{const t=qb(e.filter(r=>r!==sT));await this.db.storeChanges({changes:t,schema:this.store.schema,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(t){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",t),TG(),typeof window<"u"&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}}function R3(n){const e=C.useRef(n),[t,r]=C.useState(n);t!==e.current&&r(e.current);const o=C.useCallback(s=>{typeof s=="function"?e.current=s(e.current):e.current=s,r(e.current)},[]);return[t,o]}function FG(n){const[e,t]=R3({status:"loading"});return n=ou(n),C.useEffect(()=>{const{persistenceKey:r,sessionId:o,...s}=n;if(!r){t({status:"not-synced",store:hg(s)});return}t({status:"loading"});const i=new Os,a={upload:async(f,g)=>(await h.db.storeAsset(f.id,g),f.id),resolve:async f=>f.props.src?f.props.src.startsWith("asset:")?await i.get(f,async()=>{const g=await h.db.getAsset(f.id);return g?URL.createObjectURL(g):null}):f.props.src:null,...s.assets},c=hg({...s,assets:a});let u=!1;const h=new LG(c,{sessionId:o,persistenceKey:r,onLoad(){u||t({store:c,status:"synced-local"})},onLoadError(f){u||t({status:"error",error:f})}});return()=>{u=!0,h.close()}},[n,t]),e}function NG(){const n=te(),e=fn();C.useEffect(()=>{const t=s=>e.style.setProperty("--tl-zoom",s.toString()),r=Ag(t,100),o=new tu("useZoomCss",()=>{n.getCurrentPageShapeIds().size<300?t(n.getZoomLevel()):r(n.getZoomLevel())});return o.attach(),o.execute(),()=>{o.detach(),r.cancel()}},[n,e])}function Iw(n){const e=new ArrayBuffer(n.length),t=new Uint8Array(e);for(let r=0,o=n.length;r<o;r++)t[r]=n.charCodeAt(r);return e}function $G(n){const e=atob(n),t=Iw(e);return crypto.subtle.importKey("spki",new Uint8Array(t),{name:"ECDSA",namedCurve:"P-256"},!0,["verify"])}const zG=5,hd={ANNUAL_LICENSE:1,PERPETUAL_LICENSE:2,INTERNAL_LICENSE:4,WITH_WATERMARK:8},BG=Math.max(...Object.values(hd)),pd={ID:0,HOSTS:1,FLAGS:2,EXPIRY_DATE:3},UG=Object.keys(pd).length,ex="sales@tldraw.com",HG=`${ua()}/watermarks/watermark-track.svg`;class sm{constructor(e,t,r){j(this,"publicKey","MFkwEwYHKoZIzj0CAQYIKoZIzj0DAQcDQgAEHJh0uUfxHtCGyerXmmatE368Hd9rI6LH9oPDQihnaCryRFWEVeOvf9U/SPbyxX74LFyJs5tYeAHq5Nc0Ax25LQ");j(this,"isDevelopment");j(this,"isTest");j(this,"isCryptoAvailable");j(this,"state",dn("license state","pending"));j(this,"verbose",!0);this.isTest=!1,this.isDevelopment=this.getIsDevelopment(r),this.publicKey=t||this.publicKey,this.isCryptoAvailable=!!crypto.subtle,this.getLicenseFromKey(e).then(o=>{const s=KG(o);!this.isDevelopment&&s&&Ds(HG),s?this.state.set("unlicensed"):o.isLicensedWithWatermark?this.state.set("licensed-with-watermark"):this.state.set("licensed")})}getIsDevelopment(e){return e==="development"?!0:e==="production"?!1:window.location.protocol!=="https:"}async extractLicenseKey(e){const[t,r]=e.split("."),[o,s]=t.split("/");if(!o.startsWith("tldraw-"))throw new Error(`Unsupported prefix '${o}'`);const i=await $G(this.publicKey);let a;try{a=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},i,new Uint8Array(Iw(atob(r))),new Uint8Array(Iw(atob(s))))}catch(u){throw console.error(u),new Error("Could not perform signature validation")}if(!a)throw new Error("Invalid signature");let c;try{c=JSON.parse(atob(s))}catch{throw new Error("Could not parse object")}return c.length>UG&&this.outputMessages(["License key contains some unknown properties.","You may want to update tldraw packages to a newer version to get access to new functionality."]),{id:c[pd.ID],hosts:c[pd.HOSTS],flags:c[pd.FLAGS],expiryDate:c[pd.EXPIRY_DATE]}}async getLicenseFromKey(e){if(!e)return this.isDevelopment||this.outputNoLicenseKeyProvided(),{isLicenseParseable:!1,reason:"no-key-provided"};if(this.isDevelopment&&!this.isCryptoAvailable)return this.verbose&&(console.log("tldraw: you seem to be in a development environment that does not support crypto. License not verified."),console.log("You should check that this works in production separately.")),{isLicenseParseable:!1,reason:"has-key-development-mode"};let t=e.replace(/[\u200B-\u200D\uFEFF]/g,"");t=t.replace(/\r?\n|\r/g,"");try{const r=await this.extractLicenseKey(t),o=new Date(r.expiryDate),s=this.isFlagEnabled(r.flags,hd.ANNUAL_LICENSE),i=this.isFlagEnabled(r.flags,hd.PERPETUAL_LICENSE),a={license:r,isLicenseParseable:!0,isDevelopment:this.isDevelopment,isDomainValid:this.isDomainValid(r),expiryDate:o,isAnnualLicense:s,isAnnualLicenseExpired:s&&this.isAnnualLicenseExpired(o),isPerpetualLicense:i,isPerpetualLicenseExpired:i&&this.isPerpetualLicenseExpired(o),isInternalLicense:this.isFlagEnabled(r.flags,hd.INTERNAL_LICENSE),isLicensedWithWatermark:this.isFlagEnabled(r.flags,hd.WITH_WATERMARK)};return this.outputLicenseInfoIfNeeded(a),a}catch(r){return this.outputInvalidLicenseKey(r.message),{isLicenseParseable:!1,reason:"invalid-license-key"}}}isDomainValid(e){const t=window.location.hostname.toLowerCase();return e.hosts.some(r=>{const o=r.toLowerCase().trim();if(o===t||`www.${o}`===t||o===`www.${t}`||r==="*")return!0;if(r.includes("*")){const s=new RegExp(r.replace(/\*/g,".*?"));return s.test(t)||s.test(`www.${t}`)}return!1})}getExpirationDateWithoutGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate())}getExpirationDateWithGracePeriod(e){return new Date(e.getFullYear(),e.getMonth(),e.getDate()+zG+1)}isAnnualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),r=new Date>=t;return!r&&new Date>=this.getExpirationDateWithoutGracePeriod(e)&&this.outputMessages(["tldraw license is about to expire, you are in a grace period.",`Please reach out to ${ex} if you would like to renew your license.`]),r}isPerpetualLicenseExpired(e){const t=this.getExpirationDateWithGracePeriod(e),r={major:new Date(ik.major),minor:new Date(ik.minor)};return r.major>=t||r.minor>=t}isFlagEnabled(e,t){return(e&t)===t}outputNoLicenseKeyProvided(){}outputInvalidLicenseKey(e){this.outputMessages(["Invalid tldraw license key",`Reason: ${e}`])}outputLicenseInfoIfNeeded(e){e.isAnnualLicenseExpired&&this.outputMessages(["Your tldraw license has expired!",`Please reach out to ${ex} to renew.`]),!e.isDomainValid&&!e.isDevelopment&&this.outputMessages(["This tldraw license key is not valid for this domain!",`Please reach out to ${ex} if you would like to use tldraw on other domains.`]),e.license.flags>=BG*2&&this.outputMessages(["This tldraw license contains some unknown flags.","You may want to update tldraw packages to a newer version to get access to new functionality."])}outputMessages(e){if(!this.isTest&&this.verbose){this.outputDelimiter();for(const t of e)console.log(`%c${t}`,"color: white; background: crimson; padding: 2px; border-radius: 3px;");this.outputDelimiter()}}outputDelimiter(){console.log("%c-------------------------------------------------------------------","color: white; background: crimson; padding: 2px; border-radius: 3px;")}}j(sm,"className","tl-watermark_SEE-LICENSE");function KG(n){if(!n.isLicenseParseable||!n.isDomainValid&&!n.isDevelopment)return!0;if(n.isPerpetualLicenseExpired||n.isAnnualLicenseExpired){if(n.isInternalLicense)throw new Error("License: Internal license expired.");return!0}return!1}const O3=C.createContext({}),WG=()=>C.useContext(O3);function VG({licenseKey:n,children:e}){const[t]=C.useState(()=>new sm(n));return p.jsx(O3.Provider,{value:t,children:e})}function ka(n){if(!n)throw Error("usePassThroughWheelEvents must be passed a ref");const e=fn();C.useEffect(()=>{function t(o){if(o.isSpecialRedispatchedEvent)return;et(o);const s=e.querySelector(".tl-canvas");if(!s)return;const i=new WheelEvent("wheel",o);i.isSpecialRedispatchedEvent=!0,s.dispatchEvent(i)}const r=n.current;if(r)return r.addEventListener("wheel",t,{passive:!1}),()=>{r.removeEventListener("wheel",t)}},[e,n])}const GG='<svg xmlns="http://www.w3.org/2000/svg" width="3001" height="1000" fill="none"><path fill="#000" d="M590.656 300.449c0 49.706-40.294 90-90 90-49.705 0-90-40.294-90-90 0-49.705 40.295-90 90-90 49.706 0 90 40.295 90 90M569.431 719.011c-15.247 32.821-56.006 91.589-98.338 91.438-32.004-.115-38.642-30.904-17.414-50.856 17.381-16.337 28.246-48.075 31.995-72.719.415-2.728-1.556-5.197-4.272-5.679-39.666-7.04-70.746-40.877-70.746-83.417 0-48.23 38.983-87.329 87.07-87.329 39.936 0 70.172 22.237 83.369 52.397 18.839 43.055 7.117 115.733-11.664 156.165M2613.29 385.681V239.319c0-11.363 9.22-20.569 20.59-20.569h8.26c11.37 0 20.59 9.206 20.59 20.569v36.911c0 8.629 7 15.625 15.63 15.625h35.25c8.63 0 15.63-6.996 15.63-15.625v-36.911c0-11.363 9.22-20.569 20.59-20.569h8.17c11.37 0 20.59 9.206 20.59 20.569v146.362c0 11.363-9.22 20.569-20.59 20.569h-8.17c-11.37 0-20.59-9.206-20.59-20.569v-36.999c0-8.63-7-15.625-15.63-15.625h-35.25c-8.63 0-15.63 6.995-15.63 15.625v36.999c0 11.363-9.22 20.569-20.59 20.569h-8.26c-11.37 0-20.59-9.206-20.59-20.569M2391.97 239.319v146.362c0 11.348-9.16 20.569-20.49 20.569h-8.2c-11.33 0-20.49-9.221-20.49-20.569V239.319c0-11.348 9.16-20.569 20.49-20.569h8.2c11.33 0 20.49 9.221 20.49 20.569M2098.23 391.43l-42.69-146.361c-3.85-13.171 6.06-26.319 19.79-26.319h10.6c9.59 0 17.93 6.611 20.08 15.952l17.01 73.045c1.48 6.348 10.47 6.478 12.14.176l19.47-73.838c2.38-9.04 10.57-15.335 19.93-15.335h12.1c9.37 0 17.56 6.3 19.94 15.346l19.49 74.067c1.66 6.305 10.65 6.178 12.13-.171l17.09-73.294c2.15-9.339 10.49-15.948 20.08-15.948h10.53c13.72 0 23.63 13.141 19.79 26.31l-42.63 146.361c-2.56 8.789-10.63 14.829-19.79 14.829h-15.68c-9.12 0-17.16-5.98-19.76-14.709l-21.17-71.059c-1.77-5.948-10.19-5.957-11.97-.012l-21.33 71.071c-2.6 8.729-10.64 14.709-19.76 14.709h-15.59c-9.17 0-17.23-6.035-19.8-14.82M2443.23 218.75h118.59c11.38 0 20.62 9.195 20.62 20.557s-9.24 20.556-20.62 20.556h-24.79c-5.53 0-10 4.477-10 10v115.818c0 11.368-9.25 20.569-20.63 20.569h-7.65c-11.39 0-20.63-9.201-20.63-20.569V269.863c0-5.523-4.48-10-10-10h-24.89c-11.37 0-20.61-9.195-20.61-20.556s9.24-20.557 20.61-20.557M1174.15 218.75h24.64c8.35 0 15.88 5.042 19.04 12.764l34.61 83.942c2.13 5.161 9.44 5.155 11.56-.01l34.43-83.932a20.58 20.58 0 0 1 19.04-12.764h24.64c11.37 0 20.58 9.208 20.58 20.569v146.362c0 11.361-9.21 20.569-20.58 20.569h-7.09c-11.36 0-20.58-9.208-20.58-20.569l-.12-50.645c-.01-6.888-9.53-8.688-12.06-2.283l-23.46 59.332a20.57 20.57 0 0 1-19.14 13.009h-3.03a20.57 20.57 0 0 1-19.15-13.046l-23.47-59.68c-2.52-6.416-12.05-4.623-12.06 2.271l-.13 51.042c0 11.361-9.21 20.569-20.57 20.569h-7.1c-11.36 0-20.57-9.208-20.57-20.569V239.319c0-11.361 9.21-20.569 20.57-20.569"/><path fill="#000" fill-rule="evenodd" d="m1449.94 391.836 6.12-19.392a6.255 6.255 0 0 1 5.96-4.369l50.22-.061a6.24 6.24 0 0 1 5.96 4.348l6.23 19.486c2.71 8.581 10.71 14.402 19.74 14.402h9.34c14.13 0 24.15-13.791 19.61-27.151l-49.74-146.361c-2.85-8.37-10.74-13.988-19.61-13.988h-33.16c-8.87 0-16.77 5.618-19.61 13.988l-49.74 146.361c-4.54 13.36 5.48 27.151 19.61 27.151h9.32c9.04 0 17.04-5.827 19.75-14.414m31.1-98.858c1.85-5.807 10.08-5.796 11.91.016l8.83 27.916c1.28 4.028-1.73 8.134-5.96 8.134h-17.74c-4.23 0-7.24-4.119-5.95-8.151zM1681.81 406.25c18.91 0 35.39-3.686 49.36-11.168 13.97-7.544 24.73-18.394 32.24-32.489 7.56-14.105 11.29-30.866 11.29-50.182 0-19.256-3.73-35.957-11.29-50.004-7.57-14.094-18.35-24.912-32.32-32.397-13.91-7.545-30.4-11.26-49.37-11.26h-49.5c-11.38 0-20.63 9.201-20.63 20.569v146.362c0 11.368 9.25 20.569 20.63 20.569zm23.13-47.701c-6.62 3.215-14.85 4.886-24.79 4.886-10.49 0-19-8.507-19-19v-64.34c0-10.149 8.23-18.376 18.38-18.376 10.18 0 18.56 1.703 25.23 4.974 6.59 3.149 11.63 8.315 15.08 15.633 3.45 7.269 5.28 17.268 5.28 30.162 0 12.891-1.82 22.951-5.28 30.347-3.39 7.319-8.36 12.509-14.9 15.714" clip-rule="evenodd"/><path fill="#000" d="M1804.21 385.681V239.319c0-11.361 9.21-20.569 20.58-20.569h91.28c11.36 0 20.57 9.202 20.57 20.557s-9.21 20.556-20.57 20.556h-54.64a7.807 7.807 0 0 0-7.81 7.813v16.366a7.806 7.806 0 0 0 7.81 7.812h48.13c11.37 0 20.58 9.246 20.58 20.602s-9.21 20.601-20.58 20.601h-48.13a7.806 7.806 0 0 0-7.81 7.812v16.455a7.807 7.807 0 0 0 7.81 7.813h54.64c11.36 0 20.57 9.202 20.57 20.556s-9.21 20.557-20.57 20.557h-91.28c-11.37 0-20.58-9.208-20.58-20.569"/><path fill="#000" fill-rule="evenodd" d="M2875.5 68.75h-2750c-31.066 0-56.25 25.184-56.25 56.25v750c0 31.066 25.184 56.25 56.25 56.25h2750c31.07 0 56.25-25.184 56.25-56.25V125c0-31.066-25.18-56.25-56.25-56.25M125.5 0C56.464 0 .5 55.964.5 125v750c0 69.036 55.965 125 125 125h2750c69.04 0 125-55.964 125-125V125c0-69.036-55.96-125-125-125z" clip-rule="evenodd"/><path fill="#000" d="M2476.06 804.813c-10.54 0-19.82-6.947-22.81-17.068L2390.79 575.7c-4.49-15.248 6.92-30.534 22.8-30.534h27.75c11.1 0 20.72 7.686 23.18 18.52L2489 671.402c2.07 9.093 14.93 9.321 17.32.308l28.83-108.844c2.76-10.435 12.19-17.7 22.98-17.7h25.17c10.8 0 20.25 7.293 22.99 17.755l28.27 107.739c2.36 9.001 15.18 8.829 17.3-.232l25.01-106.888c2.51-10.763 12.1-18.374 23.14-18.374h27.87c15.88 0 27.29 15.286 22.8 30.534l-62.46 212.045a23.78 23.78 0 0 1-22.81 17.068h-32.12c-10.39 0-19.58-6.763-22.69-16.696l-32.08-102.694c-2.62-8.397-14.51-8.331-17.04.095l-30.74 102.346c-3.02 10.061-12.27 16.949-22.76 16.949zM1742.44 804.813h-75.81c-13.09 0-23.71-10.656-23.71-23.801V568.967c0-13.145 10.62-23.801 23.71-23.801h74.8c26.6 0 49.59 5.198 68.95 15.594 19.45 10.312 34.44 25.187 44.96 44.627 10.61 19.355 15.91 42.556 15.91 69.602q0 40.57-15.78 69.73c-10.53 19.355-25.43 34.231-44.71 44.627-19.28 10.311-42.05 15.467-68.32 15.467m-29.3-83.642c0 13.145 10.61 23.801 23.71 23.801h3.06c12.8 0 23.7-2.07 32.71-6.212 9.09-4.141 16-11.283 20.71-21.426q7.2-15.213 7.2-42.345 0-27.13-7.32-42.344c-4.8-10.143-11.87-17.285-21.22-21.426-9.26-4.142-20.63-6.212-34.1-6.212h-1.04c-13.1 0-23.71 10.656-23.71 23.801zM1460.86 804.813c-13.12 0-23.76-10.656-23.76-23.801V568.967c0-13.145 10.64-23.801 23.76-23.801h22.84c13.13 0 23.76 10.656 23.76 23.801v155.247c0 13.145 10.64 23.801 23.76 23.801h57.27c13.12 0 23.76 10.656 23.76 23.801v9.196c0 13.145-10.64 23.801-23.76 23.801zM1204.45 601.964c-13.13 0-23.77-10.656-23.77-23.801v-9.196c0-13.145 10.64-23.801 23.77-23.801h177.89c13.13 0 23.78 10.656 23.78 23.801v9.196c0 13.145-10.65 23.801-23.78 23.801h-39.38c-8.21 0-14.86 6.66-14.86 14.875v164.173c0 13.145-10.64 23.801-23.78 23.801h-21.85c-13.13 0-23.78-10.656-23.78-23.801V616.839c0-8.215-6.65-14.875-14.86-14.875z"/><path fill="#000" fill-rule="evenodd" d="M2223.05 787.891c-3.02 10.047-12.27 16.922-22.74 16.922h-25.43c-16.19 0-27.64-15.862-22.57-31.261l69.88-212.045c3.21-9.753 12.31-16.341 22.56-16.341h61.84c10.25 0 19.35 6.588 22.56 16.341l69.87 212.045c5.08 15.399-6.37 31.261-22.56 31.261h-25.43c-10.48 0-19.72-6.875-22.74-16.922l-6.7-22.2a14.84 14.84 0 0 0-14.21-10.576h-63.42c-6.55 0-12.32 4.296-14.22 10.576zm76.13-96.945-14.13-48.436c-2.46-8.451-14.36-8.602-17.04-.217l-15.46 48.436c-1.84 5.759 2.45 11.645 8.48 11.645h29.6c5.94 0 10.22-5.715 8.55-11.428" clip-rule="evenodd"/><path fill="#000" d="M1939.6 804.813c-13.13 0-23.77-10.656-23.77-23.801V568.967c0-13.145 10.64-23.801 23.77-23.801h88.13c19.24 0 36.08 3.508 50.51 10.523s25.65 17.115 33.67 30.3q12.03 19.779 12.03 47.416c0 18.595-4.14 34.273-12.41 47.036-7.64 11.913-18.18 21.101-31.63 27.564-16.98 8.159-36 11.104-54.7 11.104h-43.07c-76.56 0 4.08-135.84 4.08-84.706v7.996c0 12.117 9.81 21.941 21.91 21.941 8.12 0 16.3-.345 24.04-3.043 5.91-2.113 10.43-5.451 13.55-10.015 3.2-4.565 4.81-10.523 4.81-17.877 0-7.437-1.61-13.481-4.81-18.129-3.12-4.733-7.64-8.199-13.55-10.396-7.05-2.766-14.67-3.423-22.18-3.423-13.13 0-23.77 10.656-23.77 23.801v47.71c0 11.825 11.14 16.003 19.91 20.752 12.31 6.671 7.58 25.389-6.42 25.389-7.45 0-13.49 6.048-13.49 13.508v48.395c0 13.145-10.63 23.801-23.76 23.801zm134.89-106.758 5.41 9.95 33.51 61.622c8.62 15.86-2.84 35.186-20.87 35.186h-22.27c-8.74 0-16.77-4.798-20.92-12.496l-35.05-65.04a15.52 15.52 0 0 0-13.66-8.168c-42.24 0 40.62-82.154 73.85-21.054M931.652 0h68.748v1000h-68.748z"/></svg>',qG='<svg xmlns="http://www.w3.org/2000/svg" width="400" height="1601" fill="none"><path fill="#000" d="M72 1319.8c0-10.73 7.071-20.18 17.372-23.22l215.823-63.62c15.519-4.57 31.078 7.05 31.078 23.22v28.26c0 11.31-7.824 21.1-18.85 23.61l-109.636 24.94c-9.254 2.1-9.487 15.2-.313 17.63l110.784 29.37a24.21 24.21 0 0 1 18.015 23.4v25.64c0 11-7.423 20.62-18.071 23.41l-109.659 28.79c-9.162 2.41-8.986 15.47.236 17.63l108.792 25.46c10.955 2.56 18.702 12.33 18.702 23.57v28.39c0 16.17-15.559 27.79-31.078 23.22l-215.823-63.62c-10.3-3.04-17.372-12.49-17.372-23.22v-32.72c0-10.59 6.883-19.95 16.994-23.11l104.523-32.67c8.547-2.67 8.479-14.79-.096-17.36l-104.17-31.3C79.01 1372.42 72 1363 72 1352.31zM72 572.638V495.43c0-13.336 10.846-24.147 24.225-24.147h215.823c13.379 0 24.225 10.811 24.225 24.147v76.179q0 40.645-15.872 70.228-15.743 29.712-45.422 45.79-29.55 16.206-70.843 16.206-41.292 0-70.971-16.078-29.55-16.077-45.422-45.532Q72 612.767 72 572.638m85.132-29.84c-13.379 0-24.225 10.81-24.225 24.146v3.122q0 19.55 6.323 33.313 6.323 13.89 21.807 21.094 15.485 7.332 43.099 7.331t43.1-7.46q15.484-7.33 21.807-21.608 6.323-14.15 6.323-34.728v-1.064c0-13.336-10.846-24.146-24.225-24.146zM72 285.858c0-13.363 10.846-24.197 24.225-24.197h215.823c13.379 0 24.225 10.834 24.225 24.197v23.27c0 13.364-10.846 24.197-24.225 24.197H154.035c-13.379 0-24.225 10.834-24.225 24.197v58.328c0 13.364-10.846 24.197-24.225 24.197h-9.36C82.845 440.047 72 429.214 72 415.85zM278.463 24.72c0-13.374 10.846-24.216 24.225-24.216h9.36c13.379 0 24.225 10.842 24.225 24.216v181.174c0 13.374-10.846 24.216-24.225 24.216h-9.36c-13.379 0-24.225-10.842-24.225-24.216v-40.108c0-8.359-6.779-15.135-15.141-15.135H96.225c-13.38 0-24.225-10.842-24.225-24.216v-22.256c0-13.374 10.846-24.216 24.225-24.216h167.097c8.362 0 15.141-6.776 15.141-15.135z"/><path fill="#000" fill-rule="evenodd" d="M89.224 1062.13C78.997 1059.04 72 1049.63 72 1038.96v-25.9c0-16.486 16.145-28.147 31.818-22.979l215.823 71.169a24.19 24.19 0 0 1 16.632 22.98v62.97c0 10.45-6.706 19.71-16.632 22.98l-215.823 71.17C88.145 1246.51 72 1234.86 72 1218.37v-25.9c0-10.67 6.997-20.08 17.224-23.17l22.595-6.81a15.13 15.13 0 0 0 10.765-14.48v-64.59a15.13 15.13 0 0 0-10.765-14.48zm98.672 77.53 49.299-14.39c8.601-2.51 8.755-14.62.22-17.35l-49.299-15.75c-5.861-1.88-11.852 2.49-11.852 8.64v30.14c0 6.05 5.817 10.41 11.632 8.71" clip-rule="evenodd"/><path fill="#000" d="M72 773.439c0-13.367 10.846-24.203 24.225-24.203h215.823c13.379 0 24.225 10.836 24.225 24.203v89.762q0 29.395-10.711 51.439-10.71 22.046-30.84 34.293t-48.261 12.248q-28.388 0-47.873-12.635-18.187-11.672-28.056-32.218c-8.303-17.289-11.301-36.661-11.301-55.705v-43.867c0-77.976 138.26 4.16 86.215 4.16h-8.138c-12.334 0-22.332 9.989-22.332 22.311 0 8.269.351 16.6 3.097 24.487q3.225 9.024 10.194 13.794 6.968 4.899 18.194 4.899 11.356 0 18.453-4.899 7.226-4.77 10.581-13.794c2.815-7.188 3.484-14.944 3.484-22.596 0-13.366-10.846-24.202-24.225-24.202h-48.56c-12.036 0-16.288 11.345-21.122 20.272-6.79 12.539-25.841 7.72-25.841-6.536 0-7.586-6.156-13.736-13.749-13.736H96.225C82.845 820.916 72 810.08 72 796.714zm108.66 137.378-10.128 5.511-62.72 34.131C91.67 959.243 72 947.569 72 929.205V906.52a24.2 24.2 0 0 1 12.719-21.299l66.199-35.696a15.82 15.82 0 0 0 8.313-13.921c0-43.012 83.618 41.371 21.429 75.213"/></svg>';function YG(n){return re("watermarkState",()=>n.state.get(),[n])}const XG=`data:image/svg+xml;utf8,${encodeURIComponent(GG)}`,ZG=`data:image/svg+xml;utf8,${encodeURIComponent(qG)}`,QG=C.memo(function(){const e=WG(),t=te(),r=re("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),o=YG(e);return["licensed-with-watermark","unlicensed"].includes(o)?p.jsxs(p.Fragment,{children:[p.jsx(eq,{}),p.jsx(JG,{src:r?ZG:XG})]}):null}),JG=C.memo(function({src:e}){const t=te(),r=re("debug mode",()=>t.getInstanceState().isDebugMode,[t]),o=re("is mobile",()=>t.getViewportScreenBounds().width<700,[t]),s=d1(),i=C.useRef(null);ka(i);const a=`url('${e}') center 100% / 100% no-repeat`,c="https://tldraw.dev";return p.jsx("div",{ref:i,className:sm.className,"data-debug":r,"data-mobile":o,draggable:!1,...s,children:kt.isWebview?p.jsx("a",{draggable:!1,role:"button",onPointerDown:u=>{cn(u),et(u)},onClick:()=>Gg.openWindow(c,"_blank"),style:{mask:a,WebkitMask:a}}):p.jsx("a",{href:c,target:"_blank",rel:"noreferrer",draggable:!1,onPointerDown:u=>{cn(u)},style:{mask:a,WebkitMask:a}})})}),eq=C.memo(function(){const e=sm.className,t=`/* ------------------- SEE LICENSE -------------------
The tldraw watermark is part of tldraw's license. It is shown for unlicensed
or "licensed-with-watermark" users. By using this library, you agree to
preserve the watermark's behavior, keeping it visible, unobscured, and
available to user-interaction.

To remove the watermark, please purchase a license at tldraw.dev.
*/

	.${e} {
		position: absolute;
		bottom: var(--space-2);
		right: var(--space-2);
		width: 96px;
		height: 32px;
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: var(--layer-watermark) !important;
		background-color: color-mix(in srgb, var(--color-background) 62%, transparent);
		opacity: 1;
		border-radius: 5px;
		pointer-events: all;
		padding: 2px;
		box-sizing: content-box;
	}

	.${e} > a {
		position: absolute;
		width: 96px;
		height: 32px;
		pointer-events: all;
		cursor: inherit;
		color: var(--color-text);
		opacity: .38;
		background-color: currentColor;
	}

	.${e}[data-debug='true'] {
		bottom: 46px;
	}

	.${e}[data-mobile='true'] {
		border-radius: 4px 0px 0px 4px;
		right: -2px;
		width: 8px;
		height: 48px;
	}

	.${e}[data-mobile='true'] > a {
		width: 8px;
		height: 32px;
	}

	@media (hover: hover) {
		.${e} > a {
			pointer-events: none;
		}

		.${e}:hover {
			background-color: var(--color-background);
			transition: background-color 0.2s ease-in-out;
			transition-delay: 0.32s;
		}

		.${e}:hover > a {
			animation: delayed_link 0.2s forwards ease-in-out;
			animation-delay: 0.32s;
		}
	}

	@keyframes delayed_link {
		0% {
			cursor: inherit;
			opacity: .38;
			pointer-events: none;
		}
		100% {
			cursor: pointer;
			opacity: 1;
			pointer-events: all;
		}
	}`;return p.jsx("style",{children:t})}),tq=[],nq=[],rq=[],oq="tl-container",sq=C.memo(function({store:e,components:t,className:r,user:o,options:s,...i}){const[a,c]=C.useState(null),u=C.useMemo(()=>o??_R(),[o]),h=(t==null?void 0:t.ErrorFallback)===void 0?fR:t==null?void 0:t.ErrorFallback,f={...i,shapeUtils:i.shapeUtils??tq,bindingUtils:i.bindingUtils??nq,tools:i.tools??rq,components:t,options:ou(s)};return p.jsx("div",{ref:c,"data-tldraw":zj,draggable:!1,className:Fe(`${oq} tl-theme__light`,r),onPointerDown:cn,tabIndex:-1,children:p.jsx(Ld,{fallback:h,onError:g=>Cb(g,{tags:{origin:"react.tldraw-before-app"}}),children:a&&p.jsx(VG,{licenseKey:i.licenseKey,children:p.jsx(Gj,{container:a,children:p.jsx(dK,{overrides:t,children:e?e instanceof Yb?p.jsx(L3,{...f,store:e,user:u}):p.jsx(D3,{...f,store:e,user:u}):p.jsx(iq,{...f,store:e,user:u})})})})})})});function iq(n){const{defaultName:e,snapshot:t,initialData:r,shapeUtils:o,bindingUtils:s,persistenceKey:i,sessionId:a,user:c,assets:u}=n,h=FG({shapeUtils:o,bindingUtils:s,initialData:r,persistenceKey:i,sessionId:a,defaultName:e,snapshot:t,assets:u});return p.jsx(D3,{...n,store:h,user:c})}const D3=C.memo(function({store:e,user:t,...r}){const o=fn();C.useLayoutEffect(()=>{t.userPreferences.get().colorScheme==="dark"&&(o.classList.remove("tl-theme__light"),o.classList.add("tl-theme__dark"))},[o,t]);const{LoadingScreen:s}=Bt();switch(e.status){case"error":throw e.error;case"loading":return s?p.jsx(s,{}):null}return p.jsx(L3,{...r,store:e.store,user:t})}),tx=()=>document.location.search.includes("tldraw_preserve_focus");function L3({onMount:n,children:e,store:t,tools:r,shapeUtils:o,bindingUtils:s,user:i,initialState:a,autoFocus:c=!0,inferDarkMode:u,cameraOptions:h,options:f,licenseKey:g,deepLinks:y,isShapeHidden:v}){const{ErrorFallback:S}=Bt(),w=fn(),[b,_]=R3(null),T=C.useRef(null),E=ou(y===!0?{}:y),M=C.useRef({autoFocus:c&&!tx(),inferDarkMode:u,initialState:a,cameraOptions:h,deepLinks:E});C.useLayoutEffect(()=>{M.current={autoFocus:c&&!tx(),inferDarkMode:u,initialState:a,cameraOptions:h,deepLinks:E}},[c,u,a,h,E]),C.useLayoutEffect(()=>{const{autoFocus:L,inferDarkMode:K,initialState:D,cameraOptions:U,deepLinks:V}=M.current,F=new be({store:t,shapeUtils:o,bindingUtils:s,tools:r,getContainer:()=>w,user:i,initialState:D,autoFocus:L,inferDarkMode:K,cameraOptions:U,options:f,licenseKey:g,isShapeHidden:v});return F.updateViewportScreenBounds(T.current??w),V&&(V!=null&&V.getUrl?F.navigateToDeepLink({...V,url:V.getUrl(F)}):F.navigateToDeepLink(V)),_(F),()=>{F.dispose()}},[s,w,f,o,t,r,i,_,g,v]),C.useLayoutEffect(()=>{if(b&&E)return b.registerDeepLinkListener(E)},[b,E]),C.useLayoutEffect(()=>{b&&h&&b.setCameraOptions(h)},[b,h]);const A=C.useSyncExternalStore(C.useCallback(L=>b?(b.on("crash",L),()=>b.off("crash",L)):()=>{},[b]),()=>(b==null?void 0:b.getCrashingError())??null);C.useEffect(function(){if(!b)return;function K(){b&&b.focus()}function D(){b&&b.blur()}if(c&&tx())return b.getContainer().addEventListener("pointerdown",K),document.body.addEventListener("pointerdown",D),()=>{var U;(U=b.getContainer())==null||U.removeEventListener("pointerdown",K),document.body.removeEventListener("pointerdown",D)}},[b,c]);const{Canvas:R}=Bt();return b?p.jsx(Ld,{fallback:S,onError:L=>b.annotateError(L,{origin:"react.tldraw",willCrashApp:!0}),children:A?p.jsx(lq,{crashingError:A}):p.jsx(l1,{editor:b,children:p.jsxs(aq,{onMount:n,children:[e??(R?p.jsx(R,{}):null),p.jsx(QG,{})]})})}):p.jsx("div",{className:"tl-canvas",ref:T})}function aq({children:n,onMount:e}){return NG(),cG(),uG(),dG(),N3(t=>{const r=t.store.props.onMount(t),o=e==null?void 0:e(t);return()=>{r==null||r(),o==null||o()}}),n}function lq({crashingError:n}){throw n}function A1({children:n}){return p.jsx("div",{className:"tl-loading",children:n})}function F3({children:n}){return p.jsx("div",{className:"tl-loading",children:n})}function N3(n){const e=te(),t=Jg(r=>{let o;return r.run(()=>{o=n==null?void 0:n(r),r.emit("mount")},{history:"ignore"}),window.tldrawReady=!0,o});at.useLayoutEffect(()=>{if(e)return t==null?void 0:t(e)},[e,t])}function fa({children:n,className:e="",...t}){return p.jsx("div",{...t,className:Fe("tl-html-container",e),children:n})}class ff{constructor(e){this.editor=e}}j(ff,"props"),j(ff,"migrations"),j(ff,"type");function im(n,e,t={}){const{newPoint:r,handle:o,scaleX:s,scaleY:i}=e,{minWidth:a=1,maxWidth:c=1/0,minHeight:u=1,maxHeight:h=1/0}=t;let f=n.props.w*s,g=n.props.h*i;const y=new P(0,0);if(f>0){if(f<a){switch(o){case"top_left":case"left":case"bottom_left":{y.x=f-a;break}case"top":case"bottom":{y.x=(f-a)/2;break}default:y.x=0}f=a}}else if(y.x=f,f=-f,f<a){switch(o){case"top_left":case"left":case"bottom_left":{y.x=-f;break}default:y.x=-a}f=a}if(g>0){if(g<u){switch(o){case"top_left":case"top":case"top_right":{y.y=g-u;break}case"right":case"left":{y.y=(g-u)/2;break}default:y.y=0}g=u}}else if(y.y=g,g=-g,g<u){switch(o){case"top_left":case"top":case"top_right":{y.y=-g;break}default:y.y=-u}g=u}const{x:v,y:S}=y.rot(n.rotation).add(r);return{...n,x:v,y:S,props:{w:Math.min(c,f),h:Math.min(h,g)}}}class lu extends es{getGeometry(e){return new Ns({width:e.props.w,height:e.props.h,isFilled:!0})}onResize(e,t){return im(e,t)}getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}getInterpolatedProps(e,t,r){return{...t.props,w:it(e.props.w,t.props.w,r),h:it(e.props.h,t.props.h,r)}}}var Ax;let cq=(Ax=class extends Re{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},j(Ax,"id","idle"),Ax);var jx;let uq=(jx=class extends Re{onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=this.parent.shapeType,o=Ct(),s=this.editor.markHistoryStoppingPoint(`creating_box:${o}`),i=ns(t,this.editor);this.editor.createShapes([{id:o,type:r,x:i.x,y:i.y,props:{w:1,h:1}}]).select(o);const a=this.parent;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:s,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:a.onCreate?c=>{var u;return(u=a.onCreate)==null?void 0:u.call(a,c)}:void 0})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=this.parent.shapeType,r=Ct();this.editor.markHistoryStoppingPoint(`creating_box:${r}`),this.editor.createShapes([{id:r,type:t,x:e.x,y:e.y}]);const o=this.editor.getShape(r);if(!o){this.cancel();return}let{w:s,h:i}=o.props;const a=new P(s/2,i/2),c=this.editor.getShapeParentTransform(o);c&&a.rot(-c.rotation());let u=1;this.editor.user.getIsDynamicResizeMode()&&(u=1/this.editor.getZoomLevel(),s*=u,i*=u,a.mul(u));const h=zt(o),f=ns(new P(o.x-a.x,o.y-a.y),this.editor);h.x=f.x,h.y=f.y,h.props.w=s,h.props.h=i,"scale"in o.props&&(h.props.scale=u),this.editor.updateShape(h),this.editor.setSelectedShapes([r]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}},j(jx,"id","pointing"),jx);function ns(n,e){const t=e.getInstanceState().isGridMode,r=e.getDocumentSettings().gridSize;return t?n.clone().snapToGrid(r):n.clone()}class Ew extends Re{static children(){return[cq,uq]}}j(Ew,"id","box"),j(Ew,"initial","idle");function dq(n,e,t){const r=C.useRef(!1),o=C.useCallback(i=>{r.current=i,i?Go.addOpenMenu(n):Go.deleteOpenMenu(n),e==null||e(i)},[n,e]),s=re("is menu open",()=>Go.getOpenMenus().includes(n),[n]);return C.useEffect(()=>(r.current&&(t==null||t("open-menu"),Go.addOpenMenu(n)),()=>{r.current&&(Go.deleteOpenMenu(n),Go.getOpenMenus().forEach(i=>{i.startsWith(n)&&(t==null||t("close-menu"),Go.deleteOpenMenu(i))}),r.current=!1)}),[n,t]),[s,o]}function am(n){const e=te();return re("isEditing",()=>e.getEditingShapeId()===n,[e,n])}function _s(n){const e=te();return C.useMemo(function(){const o=u=>{if(u.isKilled)return;if(u.button===u1){e.dispatch({type:"pointer",target:"selection",handle:n,name:"right_click",...Qr(u)});return}if(u.button!==0)return;const h=cg(u.currentTarget);function f(){h.removeEventListener("pointerup",f),Jd(h,u)}Qd(h,u),h.addEventListener("pointerup",f),e.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:n,...Qr(u)}),cn(u)};let s,i;function a(u){u.isKilled||u.button===0&&(u.clientX===s&&u.clientY===i||(s=u.clientX,i=u.clientY,e.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:n,...Qr(u)})))}return{onPointerDown:o,onPointerMove:a,onPointerUp:u=>{u.isKilled||u.button===0&&e.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:n,...Qr(u)})}}},[e,n])}function hq(n){const[e,t]=C.useState(()=>({store:hg(n),opts:n}));if(!ZM(e.opts,n)){const r={store:hg(n),opts:n};return t(r),r.store}return e.store}const pq=20,fq=8;function j1(n,e=pq){return Math.max(fq,Math.ceil(n/e))}class Ec extends Ea{constructor(t){super({...t,isFilled:!1,isClosed:!1});j(this,"_center");j(this,"radius");j(this,"start");j(this,"end");j(this,"largeArcFlag");j(this,"sweepFlag");j(this,"measure");j(this,"angleStart");j(this,"angleEnd");const{center:r,sweepFlag:o,largeArcFlag:s,start:i,end:a}=t;if(i.equals(a))throw Error("Arc must have different start and end points.");this.angleStart=P.Angle(r,i),this.angleEnd=P.Angle(r,a),this.radius=P.Dist(r,i),this.measure=JU(this.angleStart,this.angleEnd,o,s),this.start=i,this.end=a,this.sweepFlag=o,this.largeArcFlag=s,this._center=r}nearestPoint(t){const{_center:r,measure:o,radius:s,angleEnd:i,angleStart:a,start:c,end:u}=this,h=hw(o,a,i,r.angle(t));if(h<=0)return c;if(h>=1)return u;const f=r.clone().add(t.clone().sub(r).uni().mul(s));let g,y=1/0,v;for(const S of[c,u,f])v=P.Dist2(t,S),v<y&&(g=S,y=v);if(!g)throw Error("nearest point not found");return g}hitTestLineSegment(t,r){const{_center:o,radius:s,measure:i,angleStart:a,angleEnd:c}=this,u=nh(t,r,o,s);return u===null?!1:u.some(h=>{const f=hw(i,a,c,o.angle(h));return f>=0&&f<=1})}getVertices(){const{_center:t,measure:r,length:o,radius:s,angleStart:i}=this,a=[];for(let c=0,u=j1(Math.abs(o));c<u+1;c++){const h=c/u*r,f=i+h;a.push(gl(t,s,f))}return a}getSvgPathData(t=!0){const{start:r,end:o,radius:s,largeArcFlag:i,sweepFlag:a}=this;return`${t?`M${r.toFixed()}`:""} A${s} ${s} 0 ${i} ${a} ${o.toFixed()}`}getLength(){return this.measure*this.radius}}class R1 extends Ea{constructor(t){super({isClosed:!0,...t});j(this,"_center");j(this,"radius");j(this,"x");j(this,"y");this.config=t;const{x:r=0,y:o=0,radius:s}=t;this.x=r,this.y=o,this._center=new P(s+r,s+o),this.radius=s}getBounds(){return new xe(this.x,this.y,this.radius*2,this.radius*2)}getVertices(){const{_center:t,radius:r}=this,o=xt*r,s=[];for(let i=0,a=j1(o);i<a;i++){const c=i/a*xt;s.push(gl(t,r,c))}return s}nearestPoint(t){const{_center:r,radius:o}=this;return r.equals(t)?P.AddXY(r,o,0):r.clone().add(t.clone().sub(r).uni().mul(o))}hitTestLineSegment(t,r,o=0){const{_center:s,radius:i}=this;return nh(t,r,s,i+o)!==null}getSvgPathData(){const{_center:t,radius:r}=this;return`M${t.x+r},${t.y} a${r},${r} 0 1,0 ${r*2},0a${r},${r} 0 1,0 -${r*2},0`}}class Vn extends su{constructor(t){const{start:r,cp1:o,cp2:s,end:i}=t;super({...t,points:[r,i]});j(this,"a");j(this,"b");j(this,"c");j(this,"d");this.a=r,this.b=o,this.c=s,this.d=i}getVertices(){const t=[],{a:r,b:o,c:s,d:i}=this;for(let a=0,c=10;a<=c;a++){const u=a/c;t.push(new P((1-u)*(1-u)*(1-u)*r.x+3*((1-u)*(1-u))*u*o.x+3*(1-u)*(u*u)*s.x+u*u*u*i.x,(1-u)*(1-u)*(1-u)*r.y+3*((1-u)*(1-u))*u*o.y+3*(1-u)*(u*u)*s.y+u*u*u*i.y))}return t}midPoint(){return Vn.GetAtT(this,.5)}nearestPoint(t){let r,o=1/0,s,i;for(const a of this.segments)i=a.nearestPoint(t),s=P.Dist2(i,t),s<o&&(r=i,o=s);if(!r)throw Error("nearest point not found");return r}getSvgPathData(t=!0){const{a:r,b:o,c:s,d:i}=this;return`${t?`M ${r.toFixed()} `:""} C${o.toFixed()} ${s.toFixed()} ${i.toFixed()}`}static GetAtT(t,r){const{a:o,b:s,c:i,d:a}=t;return new P((1-r)*(1-r)*(1-r)*o.x+3*((1-r)*(1-r))*r*s.x+3*(1-r)*(r*r)*i.x+r*r*r*a.x,(1-r)*(1-r)*(1-r)*o.y+3*((1-r)*(1-r))*r*s.y+3*(1-r)*(r*r)*i.y+r*r*r*a.y)}getLength(t=32){let r,o=this.a,s=0;for(let i=1;i<=t;i++)r=Vn.GetAtT(this,i/t),s+=P.Dist(o,r),o=r;return s}}class gq extends Ea{constructor(t){super({...t,isClosed:!1,isFilled:!1});j(this,"points");j(this,"_segments");const{points:r}=t;this.points=r}get segments(){if(!this._segments){this._segments=[];const{points:t}=this,r=t.length,o=r-2,s=1.25;for(let i=0;i<r-1;i++){const a=i===0?t[0]:t[i-1],c=t[i],u=t[i+1],h=i===o?u:t[i+2],f=c,g=i===0?a:new P(c.x+(u.x-a.x)/6*s,c.y+(u.y-a.y)/6*s),y=i===o?u:new P(u.x-(h.x-c.x)/6*s,u.y-(h.y-c.y)/6*s),v=u;this._segments.push(new Vn({start:f,cp1:g,cp2:y,end:v}))}}return this._segments}getLength(){return this.segments.reduce((t,r)=>t+r.length,0)}getVertices(){const t=this.segments.reduce((r,o)=>r.concat(o.vertices),[]);return t.push(this.points[this.points.length-1]),t}nearestPoint(t){let r,o=1/0,s,i;for(const a of this.segments)i=a.nearestPoint(t),s=P.Dist2(i,t),s<o&&(r=i,o=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){return this.segments.some(o=>o.hitTestLineSegment(t,r))}getSvgPathData(){let t=this.segments.reduce((r,o,s)=>r+o.getSvgPathData(s===0),"");return this.isClosed&&(t+="Z"),t}}class mq extends Ea{constructor(t){super({...t,isClosed:!0});j(this,"w");j(this,"h");j(this,"_edges");this.config=t;const{width:r,height:o}=t;this.w=r,this.h=o}get edges(){if(!this._edges){const{vertices:t}=this;this._edges=[];for(let r=0,o=t.length;r<o;r++){const s=t[r],i=t[(r+1)%o];this._edges.push(new pi({start:s,end:i}))}}return this._edges}getVertices(){const t=Math.max(1,this.w),r=Math.max(1,this.h),o=t/2,s=r/2,i=Math.pow(o-s,2)/Math.pow(o+s,2),a=ft*(o+s)*(1+3*i/(10+Math.sqrt(4-3*i))),c=j1(a),u=xt/c,h=Math.cos(u),f=Math.sin(u);let g=0,y=1,v=0,S=1;const w=Array(c);for(let b=0;b<c;b++)w[b]=new P(o+o*y,s+s*g),v=f*y+h*g,S=h*y-f*g,g=v,y=S;return w}nearestPoint(t){let r,o=1/0,s,i;for(const a of this.edges)i=a.nearestPoint(t),s=P.Dist2(i,t),s<o&&(r=i,o=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){return this.edges.some(o=>o.hitTestLineSegment(t,r))}getBounds(){return new xe(0,0,this.w,this.h)}getLength(){const{w:t,h:r}=this,o=t/2,s=r/2,i=Math.max(0,o),a=Math.max(0,s);return Uj(i,a)}getSvgPathData(t=!1){const{w:r,h:o}=this,s=r/2,i=o/2,a=Math.max(0,s),c=Math.max(0,i);return`${t?`M${s-a},${i}`:""} a${a},${c},0,1,1,${a*2},0a${a},${c},0,1,1,-${a*2},0`}}class yq extends Ea{constructor(t){super({...t,isClosed:!0});j(this,"w");j(this,"h");j(this,"a");j(this,"b");j(this,"c");j(this,"d");this.config=t;const{width:r,height:o}=t;if(this.w=r,this.h=o,o>r){const s=r/2;this.a=new Ec({start:new P(0,s),end:new P(r,s),center:new P(r/2,s),sweepFlag:1,largeArcFlag:1}),this.b=new pi({start:new P(r,s),end:new P(r,o-s)}),this.c=new Ec({start:new P(r,o-s),end:new P(0,o-s),center:new P(r/2,o-s),sweepFlag:1,largeArcFlag:1}),this.d=new pi({start:new P(0,o-s),end:new P(0,s)})}else{const s=o/2;this.a=new Ec({start:new P(s,o),end:new P(s,0),center:new P(s,s),sweepFlag:1,largeArcFlag:1}),this.b=new pi({start:new P(s,0),end:new P(r-s,0)}),this.c=new Ec({start:new P(r-s,0),end:new P(r-s,o),center:new P(r-s,s),sweepFlag:1,largeArcFlag:1}),this.d=new pi({start:new P(r-s,o),end:new P(s,o)})}}nearestPoint(t){let r,o=1/0,s,i;const{a,b:c,c:u,d:h}=this;for(const f of[a,c,u,h])i=f.nearestPoint(t),s=P.Dist2(i,t),s<o&&(r=i,o=s);if(!r)throw Error("nearest point not found");return r}hitTestLineSegment(t,r){const{a:o,b:s,c:i,d:a}=this;return[o,s,i,a].some(c=>c.hitTestLineSegment(t,r))}getVertices(){const{a:t,b:r,c:o,d:s}=this;return[t,r,o,s].reduce((i,a)=>(i.push(...a.vertices),i),[])}getBounds(){return new xe(0,0,this.w,this.h)}getLength(){const{h:t,w:r}=this;return t>r?(ft*(r/2)+(t-r))*2:(ft*(t/2)+(r-t))*2}getSvgPathData(){const{a:t,b:r,c:o,d:s}=this;return[t,r,o,s].map((i,a)=>i.getSvgPathData(a===0)).join(" ")+" Z"}}async function vq({shouldReload:n=!0}={}){B8();for(const e of pg.connectedInstances)await e.close();await Promise.all(M1().map(e=>M3(e))),z8(),n&&window.location.reload()}typeof window<"u"&&(window.__tldraw__hardReset=vq);function Sq(n,e="_blank"){Gg.openWindow(n,e)}ba("@tldraw/editor","3.6.0","esm");const $3=()=>{},z3=C.createContext(null);function xq({onEvent:n,children:e}){return p.jsx(z3.Provider,{value:n??$3,children:e})}function Ln(){return C.useContext(z3)??$3}function Ae(n,e,{checkForDefaultPrevented:t=!0}={}){return function(o){if(n==null||n(o),t===!1||!o.defaultPrevented)return e==null?void 0:e(o)}}function wq(n,e){const t=C.createContext(e);function r(s){const{children:i,...a}=s,c=C.useMemo(()=>a,Object.values(a));return p.jsx(t.Provider,{value:c,children:i})}function o(s){const i=C.useContext(t);if(i)return i;if(e!==void 0)return e;throw new Error(`\`${s}\` must be used within \`${n}\``)}return r.displayName=n+"Provider",[r,o]}function Ks(n,e=[]){let t=[];function r(s,i){const a=C.createContext(i),c=t.length;t=[...t,i];function u(f){const{scope:g,children:y,...v}=f,S=(g==null?void 0:g[n][c])||a,w=C.useMemo(()=>v,Object.values(v));return p.jsx(S.Provider,{value:w,children:y})}function h(f,g){const y=(g==null?void 0:g[n][c])||a,v=C.useContext(y);if(v)return v;if(i!==void 0)return i;throw new Error(`\`${f}\` must be used within \`${s}\``)}return u.displayName=s+"Provider",[u,h]}const o=()=>{const s=t.map(i=>C.createContext(i));return function(a){const c=(a==null?void 0:a[n])||s;return C.useMemo(()=>({[`__scope${n}`]:{...a,[n]:c}}),[a,c])}};return o.scopeName=n,[r,bq(o,...e)]}function bq(...n){const e=n[0];if(n.length===1)return e;const t=()=>{const r=n.map(o=>({useScope:o(),scopeName:o.scopeName}));return function(s){const i=r.reduce((a,{useScope:c,scopeName:u})=>{const f=c(s)[`__scope${u}`];return{...a,...f}},{});return C.useMemo(()=>({[`__scope${e.scopeName}`]:i}),[i])}};return t.scopeName=e.scopeName,t}function _q(n,e){typeof n=="function"?n(e):n!=null&&(n.current=e)}function lm(...n){return e=>n.forEach(t=>_q(t,e))}function Lt(...n){return C.useCallback(lm(...n),n)}var ml=C.forwardRef((n,e)=>{const{children:t,...r}=n,o=C.Children.toArray(t),s=o.find(Cq);if(s){const i=s.props.children,a=o.map(c=>c===s?C.Children.count(i)>1?C.Children.only(null):C.isValidElement(i)?i.props.children:null:c);return p.jsx(kw,{...r,ref:e,children:C.isValidElement(i)?C.cloneElement(i,void 0,a):null})}return p.jsx(kw,{...r,ref:e,children:t})});ml.displayName="Slot";var kw=C.forwardRef((n,e)=>{const{children:t,...r}=n;if(C.isValidElement(t)){const o=Eq(t);return C.cloneElement(t,{...Iq(r,t.props),ref:e?lm(e,o):o})}return C.Children.count(t)>1?C.Children.only(null):null});kw.displayName="SlotClone";var Pq=({children:n})=>p.jsx(p.Fragment,{children:n});function Cq(n){return C.isValidElement(n)&&n.type===Pq}function Iq(n,e){const t={...e};for(const r in e){const o=n[r],s=e[r];/^on[A-Z]/.test(r)?o&&s?t[r]=(...a)=>{s(...a),o(...a)}:o&&(t[r]=o):r==="style"?t[r]={...o,...s}:r==="className"&&(t[r]=[o,s].filter(Boolean).join(" "))}return{...n,...t}}function Eq(n){var r,o;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(o=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:o.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}var kq=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],dt=kq.reduce((n,e)=>{const t=C.forwardRef((r,o)=>{const{asChild:s,...i}=r,a=s?ml:e;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),p.jsx(a,{...i,ref:o})});return t.displayName=`Primitive.${e}`,{...n,[e]:t}},{});function O1(n,e){n&&Ei.flushSync(()=>n.dispatchEvent(e))}function cm(n){const e=n+"CollectionProvider",[t,r]=Ks(e),[o,s]=t(e,{collectionRef:{current:null},itemMap:new Map}),i=y=>{const{scope:v,children:S}=y,w=at.useRef(null),b=at.useRef(new Map).current;return p.jsx(o,{scope:v,itemMap:b,collectionRef:w,children:S})};i.displayName=e;const a=n+"CollectionSlot",c=at.forwardRef((y,v)=>{const{scope:S,children:w}=y,b=s(a,S),_=Lt(v,b.collectionRef);return p.jsx(ml,{ref:_,children:w})});c.displayName=a;const u=n+"CollectionItemSlot",h="data-radix-collection-item",f=at.forwardRef((y,v)=>{const{scope:S,children:w,...b}=y,_=at.useRef(null),T=Lt(v,_),E=s(u,S);return at.useEffect(()=>(E.itemMap.set(_,{ref:_,...b}),()=>void E.itemMap.delete(_))),p.jsx(ml,{[h]:"",ref:T,children:w})});f.displayName=u;function g(y){const v=s(n+"CollectionConsumer",y);return at.useCallback(()=>{const w=v.collectionRef.current;if(!w)return[];const b=Array.from(w.querySelectorAll(`[${h}]`));return Array.from(v.itemMap.values()).sort((E,M)=>b.indexOf(E.ref.current)-b.indexOf(M.ref.current))},[v.collectionRef,v.itemMap])}return[{Provider:i,Slot:c,ItemSlot:f},g,r]}var Tq=C.createContext(void 0);function D1(n){const e=C.useContext(Tq);return n||e||"ltr"}function Rn(n){const e=C.useRef(n);return C.useEffect(()=>{e.current=n}),C.useMemo(()=>(...t)=>{var r;return(r=e.current)==null?void 0:r.call(e,...t)},[])}function Mq(n,e=globalThis==null?void 0:globalThis.document){const t=Rn(n);C.useEffect(()=>{const r=o=>{o.key==="Escape"&&t(o)};return e.addEventListener("keydown",r,{capture:!0}),()=>e.removeEventListener("keydown",r,{capture:!0})},[t,e])}var Aq="DismissableLayer",Tw="dismissableLayer.update",jq="dismissableLayer.pointerDownOutside",Rq="dismissableLayer.focusOutside",iT,B3=C.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),lh=C.forwardRef((n,e)=>{const{disableOutsidePointerEvents:t=!1,onEscapeKeyDown:r,onPointerDownOutside:o,onFocusOutside:s,onInteractOutside:i,onDismiss:a,...c}=n,u=C.useContext(B3),[h,f]=C.useState(null),g=(h==null?void 0:h.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,y]=C.useState({}),v=Lt(e,R=>f(R)),S=Array.from(u.layers),[w]=[...u.layersWithOutsidePointerEventsDisabled].slice(-1),b=S.indexOf(w),_=h?S.indexOf(h):-1,T=u.layersWithOutsidePointerEventsDisabled.size>0,E=_>=b,M=Dq(R=>{const L=R.target,K=[...u.branches].some(D=>D.contains(L));!E||K||(o==null||o(R),i==null||i(R),R.defaultPrevented||a==null||a())},g),A=Lq(R=>{const L=R.target;[...u.branches].some(D=>D.contains(L))||(s==null||s(R),i==null||i(R),R.defaultPrevented||a==null||a())},g);return Mq(R=>{_===u.layers.size-1&&(r==null||r(R),!R.defaultPrevented&&a&&(R.preventDefault(),a()))},g),C.useEffect(()=>{if(h)return t&&(u.layersWithOutsidePointerEventsDisabled.size===0&&(iT=g.body.style.pointerEvents,g.body.style.pointerEvents="none"),u.layersWithOutsidePointerEventsDisabled.add(h)),u.layers.add(h),aT(),()=>{t&&u.layersWithOutsidePointerEventsDisabled.size===1&&(g.body.style.pointerEvents=iT)}},[h,g,t,u]),C.useEffect(()=>()=>{h&&(u.layers.delete(h),u.layersWithOutsidePointerEventsDisabled.delete(h),aT())},[h,u]),C.useEffect(()=>{const R=()=>y({});return document.addEventListener(Tw,R),()=>document.removeEventListener(Tw,R)},[]),p.jsx(dt.div,{...c,ref:v,style:{pointerEvents:T?E?"auto":"none":void 0,...n.style},onFocusCapture:Ae(n.onFocusCapture,A.onFocusCapture),onBlurCapture:Ae(n.onBlurCapture,A.onBlurCapture),onPointerDownCapture:Ae(n.onPointerDownCapture,M.onPointerDownCapture)})});lh.displayName=Aq;var Oq="DismissableLayerBranch",U3=C.forwardRef((n,e)=>{const t=C.useContext(B3),r=C.useRef(null),o=Lt(e,r);return C.useEffect(()=>{const s=r.current;if(s)return t.branches.add(s),()=>{t.branches.delete(s)}},[t.branches]),p.jsx(dt.div,{...n,ref:o})});U3.displayName=Oq;function Dq(n,e=globalThis==null?void 0:globalThis.document){const t=Rn(n),r=C.useRef(!1),o=C.useRef(()=>{});return C.useEffect(()=>{const s=a=>{if(a.target&&!r.current){let c=function(){H3(jq,t,u,{discrete:!0})};const u={originalEvent:a};a.pointerType==="touch"?(e.removeEventListener("click",o.current),o.current=c,e.addEventListener("click",o.current,{once:!0})):c()}else e.removeEventListener("click",o.current);r.current=!1},i=window.setTimeout(()=>{e.addEventListener("pointerdown",s)},0);return()=>{window.clearTimeout(i),e.removeEventListener("pointerdown",s),e.removeEventListener("click",o.current)}},[e,t]),{onPointerDownCapture:()=>r.current=!0}}function Lq(n,e=globalThis==null?void 0:globalThis.document){const t=Rn(n),r=C.useRef(!1);return C.useEffect(()=>{const o=s=>{s.target&&!r.current&&H3(Rq,t,{originalEvent:s},{discrete:!1})};return e.addEventListener("focusin",o),()=>e.removeEventListener("focusin",o)},[e,t]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function aT(){const n=new CustomEvent(Tw);document.dispatchEvent(n)}function H3(n,e,t,{discrete:r}){const o=t.originalEvent.target,s=new CustomEvent(n,{bubbles:!1,cancelable:!0,detail:t});e&&o.addEventListener(n,e,{once:!0}),r?O1(o,s):o.dispatchEvent(s)}var Fq=lh,Nq=U3,nx=0;function L1(){C.useEffect(()=>{const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",n[0]??lT()),document.body.insertAdjacentElement("beforeend",n[1]??lT()),nx++,()=>{nx===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),nx--}},[])}function lT(){const n=document.createElement("span");return n.setAttribute("data-radix-focus-guard",""),n.tabIndex=0,n.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",n}var rx="focusScope.autoFocusOnMount",ox="focusScope.autoFocusOnUnmount",cT={bubbles:!1,cancelable:!0},$q="FocusScope",um=C.forwardRef((n,e)=>{const{loop:t=!1,trapped:r=!1,onMountAutoFocus:o,onUnmountAutoFocus:s,...i}=n,[a,c]=C.useState(null),u=Rn(o),h=Rn(s),f=C.useRef(null),g=Lt(e,S=>c(S)),y=C.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;C.useEffect(()=>{if(r){let S=function(T){if(y.paused||!a)return;const E=T.target;a.contains(E)?f.current=E:na(f.current,{select:!0})},w=function(T){if(y.paused||!a)return;const E=T.relatedTarget;E!==null&&(a.contains(E)||na(f.current,{select:!0}))},b=function(T){if(document.activeElement===document.body)for(const M of T)M.removedNodes.length>0&&na(a)};document.addEventListener("focusin",S),document.addEventListener("focusout",w);const _=new MutationObserver(b);return a&&_.observe(a,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",S),document.removeEventListener("focusout",w),_.disconnect()}}},[r,a,y.paused]),C.useEffect(()=>{if(a){dT.add(y);const S=document.activeElement;if(!a.contains(S)){const b=new CustomEvent(rx,cT);a.addEventListener(rx,u),a.dispatchEvent(b),b.defaultPrevented||(zq(Wq(K3(a)),{select:!0}),document.activeElement===S&&na(a))}return()=>{a.removeEventListener(rx,u),setTimeout(()=>{const b=new CustomEvent(ox,cT);a.addEventListener(ox,h),a.dispatchEvent(b),b.defaultPrevented||na(S??document.body,{select:!0}),a.removeEventListener(ox,h),dT.remove(y)},0)}}},[a,u,h,y]);const v=C.useCallback(S=>{if(!t&&!r||y.paused)return;const w=S.key==="Tab"&&!S.altKey&&!S.ctrlKey&&!S.metaKey,b=document.activeElement;if(w&&b){const _=S.currentTarget,[T,E]=Bq(_);T&&E?!S.shiftKey&&b===E?(S.preventDefault(),t&&na(T,{select:!0})):S.shiftKey&&b===T&&(S.preventDefault(),t&&na(E,{select:!0})):b===_&&S.preventDefault()}},[t,r,y.paused]);return p.jsx(dt.div,{tabIndex:-1,...i,ref:g,onKeyDown:v})});um.displayName=$q;function zq(n,{select:e=!1}={}){const t=document.activeElement;for(const r of n)if(na(r,{select:e}),document.activeElement!==t)return}function Bq(n){const e=K3(n),t=uT(e,n),r=uT(e.reverse(),n);return[t,r]}function K3(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function uT(n,e){for(const t of n)if(!Uq(t,{upTo:e}))return t}function Uq(n,{upTo:e}){if(getComputedStyle(n).visibility==="hidden")return!0;for(;n;){if(e!==void 0&&n===e)return!1;if(getComputedStyle(n).display==="none")return!0;n=n.parentElement}return!1}function Hq(n){return n instanceof HTMLInputElement&&"select"in n}function na(n,{select:e=!1}={}){if(n&&n.focus){const t=document.activeElement;n.focus({preventScroll:!0}),n!==t&&Hq(n)&&e&&n.select()}}var dT=Kq();function Kq(){let n=[];return{add(e){const t=n[0];e!==t&&(t==null||t.pause()),n=hT(n,e),n.unshift(e)},remove(e){var t;n=hT(n,e),(t=n[0])==null||t.resume()}}}function hT(n,e){const t=[...n],r=t.indexOf(e);return r!==-1&&t.splice(r,1),t}function Wq(n){return n.filter(e=>e.tagName!=="A")}var xa=globalThis!=null&&globalThis.document?C.useLayoutEffect:()=>{},Vq=f9.useId||(()=>{}),Gq=0;function vi(n){const[e,t]=C.useState(Vq());return xa(()=>{n||t(r=>r??String(Gq++))},[n]),n||(e?`radix-${e}`:"")}var gf=typeof document<"u"?C.useLayoutEffect:C.useEffect;function fg(n,e){if(n===e)return!0;if(typeof n!=typeof e)return!1;if(typeof n=="function"&&n.toString()===e.toString())return!0;let t,r,o;if(n&&e&&typeof n=="object"){if(Array.isArray(n)){if(t=n.length,t!==e.length)return!1;for(r=t;r--!==0;)if(!fg(n[r],e[r]))return!1;return!0}if(o=Object.keys(n),t=o.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!{}.hasOwnProperty.call(e,o[r]))return!1;for(r=t;r--!==0;){const s=o[r];if(!(s==="_owner"&&n.$$typeof)&&!fg(n[s],e[s]))return!1}return!0}return n!==n&&e!==e}function W3(n){return typeof window>"u"?1:(n.ownerDocument.defaultView||window).devicePixelRatio||1}function pT(n,e){const t=W3(n);return Math.round(e*t)/t}function fT(n){const e=C.useRef(n);return gf(()=>{e.current=n}),e}function qq(n){n===void 0&&(n={});const{placement:e="bottom",strategy:t="absolute",middleware:r=[],platform:o,elements:{reference:s,floating:i}={},transform:a=!0,whileElementsMounted:c,open:u}=n,[h,f]=C.useState({x:0,y:0,strategy:t,placement:e,middlewareData:{},isPositioned:!1}),[g,y]=C.useState(r);fg(g,r)||y(r);const[v,S]=C.useState(null),[w,b]=C.useState(null),_=C.useCallback(G=>{G!==A.current&&(A.current=G,S(G))},[]),T=C.useCallback(G=>{G!==R.current&&(R.current=G,b(G))},[]),E=s||v,M=i||w,A=C.useRef(null),R=C.useRef(null),L=C.useRef(h),K=c!=null,D=fT(c),U=fT(o),V=C.useCallback(()=>{if(!A.current||!R.current)return;const G={placement:e,strategy:t,middleware:g};U.current&&(G.platform=U.current),Zz(A.current,R.current,G).then(q=>{const Q={...q,isPositioned:!0};F.current&&!fg(L.current,Q)&&(L.current=Q,Ei.flushSync(()=>{f(Q)}))})},[g,e,t,U]);gf(()=>{u===!1&&L.current.isPositioned&&(L.current.isPositioned=!1,f(G=>({...G,isPositioned:!1})))},[u]);const F=C.useRef(!1);gf(()=>(F.current=!0,()=>{F.current=!1}),[]),gf(()=>{if(E&&(A.current=E),M&&(R.current=M),E&&M){if(D.current)return D.current(E,M,V);V()}},[E,M,V,D,K]);const $=C.useMemo(()=>({reference:A,floating:R,setReference:_,setFloating:T}),[_,T]),H=C.useMemo(()=>({reference:E,floating:M}),[E,M]),Z=C.useMemo(()=>{const G={position:t,left:0,top:0};if(!H.floating)return G;const q=pT(H.floating,h.x),Q=pT(H.floating,h.y);return a?{...G,transform:"translate("+q+"px, "+Q+"px)",...W3(H.floating)>=1.5&&{willChange:"transform"}}:{position:t,left:q,top:Q}},[t,a,H.floating,h.x,h.y]);return C.useMemo(()=>({...h,update:V,refs:$,elements:H,floatingStyles:Z}),[h,V,$,H,Z])}const Yq=n=>{function e(t){return{}.hasOwnProperty.call(t,"current")}return{name:"arrow",options:n,fn(t){const{element:r,padding:o}=typeof n=="function"?n(t):n;return r&&e(r)?r.current!=null?aI({element:r.current,padding:o}).fn(t):{}:r?aI({element:r,padding:o}).fn(t):{}}}},Xq=(n,e)=>({...Wz(n),options:[n,e]}),Zq=(n,e)=>({...Vz(n),options:[n,e]}),Qq=(n,e)=>({...Xz(n),options:[n,e]}),Jq=(n,e)=>({...Gz(n),options:[n,e]}),eY=(n,e)=>({...qz(n),options:[n,e]}),tY=(n,e)=>({...Yz(n),options:[n,e]}),nY=(n,e)=>({...Yq(n),options:[n,e]});var rY="Arrow",V3=C.forwardRef((n,e)=>{const{children:t,width:r=10,height:o=5,...s}=n;return p.jsx(dt.svg,{...s,ref:e,width:r,height:o,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:n.asChild?t:p.jsx("polygon",{points:"0,0 30,0 15,10"})})});V3.displayName=rY;var oY=V3;function G3(n){const[e,t]=C.useState(void 0);return xa(()=>{if(n){t({width:n.offsetWidth,height:n.offsetHeight});const r=new ResizeObserver(o=>{if(!Array.isArray(o)||!o.length)return;const s=o[0];let i,a;if("borderBoxSize"in s){const c=s.borderBoxSize,u=Array.isArray(c)?c[0]:c;i=u.inlineSize,a=u.blockSize}else i=n.offsetWidth,a=n.offsetHeight;t({width:i,height:a})});return r.observe(n,{box:"border-box"}),()=>r.unobserve(n)}else t(void 0)},[n]),e}var F1="Popper",[q3,dm]=Ks(F1),[sY,Y3]=q3(F1),X3=n=>{const{__scopePopper:e,children:t}=n,[r,o]=C.useState(null);return p.jsx(sY,{scope:e,anchor:r,onAnchorChange:o,children:t})};X3.displayName=F1;var Z3="PopperAnchor",Q3=C.forwardRef((n,e)=>{const{__scopePopper:t,virtualRef:r,...o}=n,s=Y3(Z3,t),i=C.useRef(null),a=Lt(e,i);return C.useEffect(()=>{s.onAnchorChange((r==null?void 0:r.current)||i.current)}),r?null:p.jsx(dt.div,{...o,ref:a})});Q3.displayName=Z3;var N1="PopperContent",[iY,aY]=q3(N1),J3=C.forwardRef((n,e)=>{var Te,we,Ie,Ve,Xe,Zt;const{__scopePopper:t,side:r="bottom",sideOffset:o=0,align:s="center",alignOffset:i=0,arrowPadding:a=0,avoidCollisions:c=!0,collisionBoundary:u=[],collisionPadding:h=0,sticky:f="partial",hideWhenDetached:g=!1,updatePositionStrategy:y="optimized",onPlaced:v,...S}=n,w=Y3(N1,t),[b,_]=C.useState(null),T=Lt(e,vt=>_(vt)),[E,M]=C.useState(null),A=G3(E),R=(A==null?void 0:A.width)??0,L=(A==null?void 0:A.height)??0,K=r+(s!=="center"?"-"+s:""),D=typeof h=="number"?h:{top:0,right:0,bottom:0,left:0,...h},U=Array.isArray(u)?u:[u],V=U.length>0,F={padding:D,boundary:U.filter(cY),altBoundary:V},{refs:$,floatingStyles:H,placement:Z,isPositioned:G,middlewareData:q}=qq({strategy:"fixed",placement:K,whileElementsMounted:(...vt)=>Kz(...vt,{animationFrame:y==="always"}),elements:{reference:w.anchor},middleware:[Xq({mainAxis:o+L,alignmentAxis:i}),c&&Zq({mainAxis:!0,crossAxis:!1,limiter:f==="partial"?Qq():void 0,...F}),c&&Jq({...F}),eY({...F,apply:({elements:vt,rects:Ut,availableWidth:St,availableHeight:It})=>{const{width:tr,height:ls}=Ut.reference,fr=vt.floating.style;fr.setProperty("--radix-popper-available-width",`${St}px`),fr.setProperty("--radix-popper-available-height",`${It}px`),fr.setProperty("--radix-popper-anchor-width",`${tr}px`),fr.setProperty("--radix-popper-anchor-height",`${ls}px`)}}),E&&nY({element:E,padding:a}),uY({arrowWidth:R,arrowHeight:L}),g&&tY({strategy:"referenceHidden",...F})]}),[Q,ae]=nL(Z),B=Rn(v);xa(()=>{G&&(B==null||B())},[G,B]);const oe=(Te=q.arrow)==null?void 0:Te.x,pe=(we=q.arrow)==null?void 0:we.y,_e=((Ie=q.arrow)==null?void 0:Ie.centerOffset)!==0,[ue,Ne]=C.useState();return xa(()=>{b&&Ne(window.getComputedStyle(b).zIndex)},[b]),p.jsx("div",{ref:$.setFloating,"data-radix-popper-content-wrapper":"",style:{...H,transform:G?H.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:ue,"--radix-popper-transform-origin":[(Ve=q.transformOrigin)==null?void 0:Ve.x,(Xe=q.transformOrigin)==null?void 0:Xe.y].join(" "),...((Zt=q.hide)==null?void 0:Zt.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:n.dir,children:p.jsx(iY,{scope:t,placedSide:Q,onArrowChange:M,arrowX:oe,arrowY:pe,shouldHideArrow:_e,children:p.jsx(dt.div,{"data-side":Q,"data-align":ae,...S,ref:T,style:{...S.style,animation:G?void 0:"none"}})})})});J3.displayName=N1;var eL="PopperArrow",lY={top:"bottom",right:"left",bottom:"top",left:"right"},tL=C.forwardRef(function(e,t){const{__scopePopper:r,...o}=e,s=aY(eL,r),i=lY[s.placedSide];return p.jsx("span",{ref:s.onArrowChange,style:{position:"absolute",left:s.arrowX,top:s.arrowY,[i]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[s.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[s.placedSide],visibility:s.shouldHideArrow?"hidden":void 0},children:p.jsx(oY,{...o,ref:t,style:{...o.style,display:"block"}})})});tL.displayName=eL;function cY(n){return n!==null}var uY=n=>({name:"transformOrigin",options:n,fn(e){var w,b,_;const{placement:t,rects:r,middlewareData:o}=e,i=((w=o.arrow)==null?void 0:w.centerOffset)!==0,a=i?0:n.arrowWidth,c=i?0:n.arrowHeight,[u,h]=nL(t),f={start:"0%",center:"50%",end:"100%"}[h],g=(((b=o.arrow)==null?void 0:b.x)??0)+a/2,y=(((_=o.arrow)==null?void 0:_.y)??0)+c/2;let v="",S="";return u==="bottom"?(v=i?f:`${g}px`,S=`${-c}px`):u==="top"?(v=i?f:`${g}px`,S=`${r.floating.height+c}px`):u==="right"?(v=`${-c}px`,S=i?f:`${y}px`):u==="left"&&(v=`${r.floating.width+c}px`,S=i?f:`${y}px`),{data:{x:v,y:S}}}});function nL(n){const[e,t="center"]=n.split("-");return[e,t]}var $1=X3,z1=Q3,rL=J3,oL=tL,dY="Portal",ch=C.forwardRef((n,e)=>{var a;const{container:t,...r}=n,[o,s]=C.useState(!1);xa(()=>s(!0),[]);const i=t||o&&((a=globalThis==null?void 0:globalThis.document)==null?void 0:a.body);return i?wc.createPortal(p.jsx(dt.div,{...r,ref:e}),i):null});ch.displayName=dY;function hY(n,e){return C.useReducer((t,r)=>e[t][r]??t,n)}var ss=n=>{const{present:e,children:t}=n,r=pY(e),o=typeof t=="function"?t({present:r.isPresent}):C.Children.only(t),s=Lt(r.ref,fY(o));return typeof t=="function"||r.isPresent?C.cloneElement(o,{ref:s}):null};ss.displayName="Presence";function pY(n){const[e,t]=C.useState(),r=C.useRef({}),o=C.useRef(n),s=C.useRef("none"),i=n?"mounted":"unmounted",[a,c]=hY(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return C.useEffect(()=>{const u=zp(r.current);s.current=a==="mounted"?u:"none"},[a]),xa(()=>{const u=r.current,h=o.current;if(h!==n){const g=s.current,y=zp(u);n?c("MOUNT"):y==="none"||(u==null?void 0:u.display)==="none"?c("UNMOUNT"):c(h&&g!==y?"ANIMATION_OUT":"UNMOUNT"),o.current=n}},[n,c]),xa(()=>{if(e){const u=f=>{const y=zp(r.current).includes(f.animationName);f.target===e&&y&&Ei.flushSync(()=>c("ANIMATION_END"))},h=f=>{f.target===e&&(s.current=zp(r.current))};return e.addEventListener("animationstart",h),e.addEventListener("animationcancel",u),e.addEventListener("animationend",u),()=>{e.removeEventListener("animationstart",h),e.removeEventListener("animationcancel",u),e.removeEventListener("animationend",u)}}else c("ANIMATION_END")},[e,c]),{isPresent:["mounted","unmountSuspended"].includes(a),ref:C.useCallback(u=>{u&&(r.current=getComputedStyle(u)),t(u)},[])}}function zp(n){return(n==null?void 0:n.animationName)||"none"}function fY(n){var r,o;let e=(r=Object.getOwnPropertyDescriptor(n.props,"ref"))==null?void 0:r.get,t=e&&"isReactWarning"in e&&e.isReactWarning;return t?n.ref:(e=(o=Object.getOwnPropertyDescriptor(n,"ref"))==null?void 0:o.get,t=e&&"isReactWarning"in e&&e.isReactWarning,t?n.props.ref:n.props.ref||n.ref)}function Ta({prop:n,defaultProp:e,onChange:t=()=>{}}){const[r,o]=gY({defaultProp:e,onChange:t}),s=n!==void 0,i=s?n:r,a=Rn(t),c=C.useCallback(u=>{if(s){const f=typeof u=="function"?u(n):u;f!==n&&a(f)}else o(u)},[s,n,o,a]);return[i,c]}function gY({defaultProp:n,onChange:e}){const t=C.useState(n),[r]=t,o=C.useRef(r),s=Rn(e);return C.useEffect(()=>{o.current!==r&&(s(r),o.current=r)},[r,o,s]),t}var sx="rovingFocusGroup.onEntryFocus",mY={bubbles:!1,cancelable:!0},hm="RovingFocusGroup",[Mw,sL,yY]=cm(hm),[vY,iL]=Ks(hm,[yY]),[SY,xY]=vY(hm),aL=C.forwardRef((n,e)=>p.jsx(Mw.Provider,{scope:n.__scopeRovingFocusGroup,children:p.jsx(Mw.Slot,{scope:n.__scopeRovingFocusGroup,children:p.jsx(wY,{...n,ref:e})})}));aL.displayName=hm;var wY=C.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,orientation:r,loop:o=!1,dir:s,currentTabStopId:i,defaultCurrentTabStopId:a,onCurrentTabStopIdChange:c,onEntryFocus:u,preventScrollOnEntryFocus:h=!1,...f}=n,g=C.useRef(null),y=Lt(e,g),v=D1(s),[S=null,w]=Ta({prop:i,defaultProp:a,onChange:c}),[b,_]=C.useState(!1),T=Rn(u),E=sL(t),M=C.useRef(!1),[A,R]=C.useState(0);return C.useEffect(()=>{const L=g.current;if(L)return L.addEventListener(sx,T),()=>L.removeEventListener(sx,T)},[T]),p.jsx(SY,{scope:t,orientation:r,dir:v,loop:o,currentTabStopId:S,onItemFocus:C.useCallback(L=>w(L),[w]),onItemShiftTab:C.useCallback(()=>_(!0),[]),onFocusableItemAdd:C.useCallback(()=>R(L=>L+1),[]),onFocusableItemRemove:C.useCallback(()=>R(L=>L-1),[]),children:p.jsx(dt.div,{tabIndex:b||A===0?-1:0,"data-orientation":r,...f,ref:y,style:{outline:"none",...n.style},onMouseDown:Ae(n.onMouseDown,()=>{M.current=!0}),onFocus:Ae(n.onFocus,L=>{const K=!M.current;if(L.target===L.currentTarget&&K&&!b){const D=new CustomEvent(sx,mY);if(L.currentTarget.dispatchEvent(D),!D.defaultPrevented){const U=E().filter(Z=>Z.focusable),V=U.find(Z=>Z.active),F=U.find(Z=>Z.id===S),H=[V,F,...U].filter(Boolean).map(Z=>Z.ref.current);uL(H,h)}}M.current=!1}),onBlur:Ae(n.onBlur,()=>_(!1))})})}),lL="RovingFocusGroupItem",cL=C.forwardRef((n,e)=>{const{__scopeRovingFocusGroup:t,focusable:r=!0,active:o=!1,tabStopId:s,...i}=n,a=vi(),c=s||a,u=xY(lL,t),h=u.currentTabStopId===c,f=sL(t),{onFocusableItemAdd:g,onFocusableItemRemove:y}=u;return C.useEffect(()=>{if(r)return g(),()=>y()},[r,g,y]),p.jsx(Mw.ItemSlot,{scope:t,id:c,focusable:r,active:o,children:p.jsx(dt.span,{tabIndex:h?0:-1,"data-orientation":u.orientation,...i,ref:e,onMouseDown:Ae(n.onMouseDown,v=>{r?u.onItemFocus(c):v.preventDefault()}),onFocus:Ae(n.onFocus,()=>u.onItemFocus(c)),onKeyDown:Ae(n.onKeyDown,v=>{if(v.key==="Tab"&&v.shiftKey){u.onItemShiftTab();return}if(v.target!==v.currentTarget)return;const S=PY(v,u.orientation,u.dir);if(S!==void 0){if(v.metaKey||v.ctrlKey||v.altKey||v.shiftKey)return;v.preventDefault();let b=f().filter(_=>_.focusable).map(_=>_.ref.current);if(S==="last")b.reverse();else if(S==="prev"||S==="next"){S==="prev"&&b.reverse();const _=b.indexOf(v.currentTarget);b=u.loop?CY(b,_+1):b.slice(_+1)}setTimeout(()=>uL(b))}})})})});cL.displayName=lL;var bY={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function _Y(n,e){return e!=="rtl"?n:n==="ArrowLeft"?"ArrowRight":n==="ArrowRight"?"ArrowLeft":n}function PY(n,e,t){const r=_Y(n.key,t);if(!(e==="vertical"&&["ArrowLeft","ArrowRight"].includes(r))&&!(e==="horizontal"&&["ArrowUp","ArrowDown"].includes(r)))return bY[r]}function uL(n,e=!1){const t=document.activeElement;for(const r of n)if(r===t||(r.focus({preventScroll:e}),document.activeElement!==t))return}function CY(n,e){return n.map((t,r)=>n[(e+r)%n.length])}var IY=aL,EY=cL,kY=function(n){if(typeof document>"u")return null;var e=Array.isArray(n)?n[0]:n;return e.ownerDocument.body},gc=new WeakMap,Bp=new WeakMap,Up={},ix=0,dL=function(n){return n&&(n.host||dL(n.parentNode))},TY=function(n,e){return e.map(function(t){if(n.contains(t))return t;var r=dL(t);return r&&n.contains(r)?r:(console.error("aria-hidden",t,"in not contained inside",n,". Doing nothing"),null)}).filter(function(t){return!!t})},MY=function(n,e,t,r){var o=TY(e,Array.isArray(n)?n:[n]);Up[t]||(Up[t]=new WeakMap);var s=Up[t],i=[],a=new Set,c=new Set(o),u=function(f){!f||a.has(f)||(a.add(f),u(f.parentNode))};o.forEach(u);var h=function(f){!f||c.has(f)||Array.prototype.forEach.call(f.children,function(g){if(a.has(g))h(g);else try{var y=g.getAttribute(r),v=y!==null&&y!=="false",S=(gc.get(g)||0)+1,w=(s.get(g)||0)+1;gc.set(g,S),s.set(g,w),i.push(g),S===1&&v&&Bp.set(g,!0),w===1&&g.setAttribute(t,"true"),v||g.setAttribute(r,"true")}catch(b){console.error("aria-hidden: cannot operate on ",g,b)}})};return h(e),a.clear(),ix++,function(){i.forEach(function(f){var g=gc.get(f)-1,y=s.get(f)-1;gc.set(f,g),s.set(f,y),g||(Bp.has(f)||f.removeAttribute(r),Bp.delete(f)),y||f.removeAttribute(t)}),ix--,ix||(gc=new WeakMap,gc=new WeakMap,Bp=new WeakMap,Up={})}},B1=function(n,e,t){t===void 0&&(t="data-aria-hidden");var r=Array.from(Array.isArray(n)?n:[n]),o=kY(n);return o?(r.push.apply(r,Array.from(o.querySelectorAll("[aria-live]"))),MY(r,o,t,"aria-hidden")):function(){return null}},mf="right-scroll-bar-position",yf="width-before-scroll-bar",AY="with-scroll-bars-hidden",jY="--removed-body-scroll-bar-size";function ax(n,e){return typeof n=="function"?n(e):n&&(n.current=e),n}function RY(n,e){var t=C.useState(function(){return{value:n,callback:e,facade:{get current(){return t.value},set current(r){var o=t.value;o!==r&&(t.value=r,t.callback(r,o))}}}})[0];return t.callback=e,t.facade}var OY=typeof window<"u"?C.useLayoutEffect:C.useEffect,gT=new WeakMap;function DY(n,e){var t=RY(null,function(r){return n.forEach(function(o){return ax(o,r)})});return OY(function(){var r=gT.get(t);if(r){var o=new Set(r),s=new Set(n),i=t.current;o.forEach(function(a){s.has(a)||ax(a,null)}),s.forEach(function(a){o.has(a)||ax(a,i)})}gT.set(t,n)},[n]),t}function LY(n){return n}function FY(n,e){e===void 0&&(e=LY);var t=[],r=!1,o={read:function(){if(r)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return t.length?t[t.length-1]:n},useMedium:function(s){var i=e(s,r);return t.push(i),function(){t=t.filter(function(a){return a!==i})}},assignSyncMedium:function(s){for(r=!0;t.length;){var i=t;t=[],i.forEach(s)}t={push:function(a){return s(a)},filter:function(){return t}}},assignMedium:function(s){r=!0;var i=[];if(t.length){var a=t;t=[],a.forEach(s),i=t}var c=function(){var h=i;i=[],h.forEach(s)},u=function(){return Promise.resolve().then(c)};u(),t={push:function(h){i.push(h),u()},filter:function(h){return i=i.filter(h),t}}}};return o}function NY(n){n===void 0&&(n={});var e=FY(null);return e.options=oa({async:!0,ssr:!1},n),e}var hL=function(n){var e=n.sideCar,t=LM(n,["sideCar"]);if(!e)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var r=e.read();if(!r)throw new Error("Sidecar medium not found");return C.createElement(r,oa({},t))};hL.isSideCarExport=!0;function $Y(n,e){return n.useMedium(e),hL}var pL=NY(),lx=function(){},pm=C.forwardRef(function(n,e){var t=C.useRef(null),r=C.useState({onScrollCapture:lx,onWheelCapture:lx,onTouchMoveCapture:lx}),o=r[0],s=r[1],i=n.forwardProps,a=n.children,c=n.className,u=n.removeScrollBar,h=n.enabled,f=n.shards,g=n.sideCar,y=n.noIsolation,v=n.inert,S=n.allowPinchZoom,w=n.as,b=w===void 0?"div":w,_=n.gapMode,T=LM(n,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as","gapMode"]),E=g,M=DY([t,e]),A=oa(oa({},T),o);return C.createElement(C.Fragment,null,h&&C.createElement(E,{sideCar:pL,removeScrollBar:u,shards:f,noIsolation:y,inert:v,setCallbacks:s,allowPinchZoom:!!S,lockRef:t,gapMode:_}),i?C.cloneElement(C.Children.only(a),oa(oa({},A),{ref:M})):C.createElement(b,oa({},A,{className:c,ref:M}),a))});pm.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};pm.classNames={fullWidth:yf,zeroRight:mf};var zY=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function BY(){if(!document)return null;var n=document.createElement("style");n.type="text/css";var e=zY();return e&&n.setAttribute("nonce",e),n}function UY(n,e){n.styleSheet?n.styleSheet.cssText=e:n.appendChild(document.createTextNode(e))}function HY(n){var e=document.head||document.getElementsByTagName("head")[0];e.appendChild(n)}var KY=function(){var n=0,e=null;return{add:function(t){n==0&&(e=BY())&&(UY(e,t),HY(e)),n++},remove:function(){n--,!n&&e&&(e.parentNode&&e.parentNode.removeChild(e),e=null)}}},WY=function(){var n=KY();return function(e,t){C.useEffect(function(){return n.add(e),function(){n.remove()}},[e&&t])}},fL=function(){var n=WY(),e=function(t){var r=t.styles,o=t.dynamic;return n(r,o),null};return e},VY={left:0,top:0,right:0,gap:0},cx=function(n){return parseInt(n||"",10)||0},GY=function(n){var e=window.getComputedStyle(document.body),t=e[n==="padding"?"paddingLeft":"marginLeft"],r=e[n==="padding"?"paddingTop":"marginTop"],o=e[n==="padding"?"paddingRight":"marginRight"];return[cx(t),cx(r),cx(o)]},qY=function(n){if(n===void 0&&(n="margin"),typeof window>"u")return VY;var e=GY(n),t=document.documentElement.clientWidth,r=window.innerWidth;return{left:e[0],top:e[1],right:e[2],gap:Math.max(0,r-t+e[2]-e[0])}},YY=fL(),Nc="data-scroll-locked",XY=function(n,e,t,r){var o=n.left,s=n.top,i=n.right,a=n.gap;return t===void 0&&(t="margin"),`
  .`.concat(AY,` {
   overflow: hidden `).concat(r,`;
   padding-right: `).concat(a,"px ").concat(r,`;
  }
  body[`).concat(Nc,`] {
    overflow: hidden `).concat(r,`;
    overscroll-behavior: contain;
    `).concat([e&&"position: relative ".concat(r,";"),t==="margin"&&`
    padding-left: `.concat(o,`px;
    padding-top: `).concat(s,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(a,"px ").concat(r,`;
    `),t==="padding"&&"padding-right: ".concat(a,"px ").concat(r,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(mf,` {
    right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(yf,` {
    margin-right: `).concat(a,"px ").concat(r,`;
  }
  
  .`).concat(mf," .").concat(mf,` {
    right: 0 `).concat(r,`;
  }
  
  .`).concat(yf," .").concat(yf,` {
    margin-right: 0 `).concat(r,`;
  }
  
  body[`).concat(Nc,`] {
    `).concat(jY,": ").concat(a,`px;
  }
`)},mT=function(){var n=parseInt(document.body.getAttribute(Nc)||"0",10);return isFinite(n)?n:0},ZY=function(){C.useEffect(function(){return document.body.setAttribute(Nc,(mT()+1).toString()),function(){var n=mT()-1;n<=0?document.body.removeAttribute(Nc):document.body.setAttribute(Nc,n.toString())}},[])},QY=function(n){var e=n.noRelative,t=n.noImportant,r=n.gapMode,o=r===void 0?"margin":r;ZY();var s=C.useMemo(function(){return qY(o)},[o]);return C.createElement(YY,{styles:XY(s,!e,o,t?"":"!important")})},Aw=!1;if(typeof window<"u")try{var Hp=Object.defineProperty({},"passive",{get:function(){return Aw=!0,!0}});window.addEventListener("test",Hp,Hp),window.removeEventListener("test",Hp,Hp)}catch{Aw=!1}var mc=Aw?{passive:!1}:!1,JY=function(n){return n.tagName==="TEXTAREA"},gL=function(n,e){var t=window.getComputedStyle(n);return t[e]!=="hidden"&&!(t.overflowY===t.overflowX&&!JY(n)&&t[e]==="visible")},eX=function(n){return gL(n,"overflowY")},tX=function(n){return gL(n,"overflowX")},yT=function(n,e){var t=e.ownerDocument,r=e;do{typeof ShadowRoot<"u"&&r instanceof ShadowRoot&&(r=r.host);var o=mL(n,r);if(o){var s=yL(n,r),i=s[1],a=s[2];if(i>a)return!0}r=r.parentNode}while(r&&r!==t.body);return!1},nX=function(n){var e=n.scrollTop,t=n.scrollHeight,r=n.clientHeight;return[e,t,r]},rX=function(n){var e=n.scrollLeft,t=n.scrollWidth,r=n.clientWidth;return[e,t,r]},mL=function(n,e){return n==="v"?eX(e):tX(e)},yL=function(n,e){return n==="v"?nX(e):rX(e)},oX=function(n,e){return n==="h"&&e==="rtl"?-1:1},sX=function(n,e,t,r,o){var s=oX(n,window.getComputedStyle(e).direction),i=s*r,a=t.target,c=e.contains(a),u=!1,h=i>0,f=0,g=0;do{var y=yL(n,a),v=y[0],S=y[1],w=y[2],b=S-w-s*v;(v||b)&&mL(n,a)&&(f+=b,g+=v),a instanceof ShadowRoot?a=a.host:a=a.parentNode}while(!c&&a!==document.body||c&&(e.contains(a)||e===a));return(h&&(Math.abs(f)<1||!o)||!h&&(Math.abs(g)<1||!o))&&(u=!0),u},Kp=function(n){return"changedTouches"in n?[n.changedTouches[0].clientX,n.changedTouches[0].clientY]:[0,0]},vT=function(n){return[n.deltaX,n.deltaY]},ST=function(n){return n&&"current"in n?n.current:n},iX=function(n,e){return n[0]===e[0]&&n[1]===e[1]},aX=function(n){return`
  .block-interactivity-`.concat(n,` {pointer-events: none;}
  .allow-interactivity-`).concat(n,` {pointer-events: all;}
`)},lX=0,yc=[];function cX(n){var e=C.useRef([]),t=C.useRef([0,0]),r=C.useRef(),o=C.useState(lX++)[0],s=C.useState(fL)[0],i=C.useRef(n);C.useEffect(function(){i.current=n},[n]),C.useEffect(function(){if(n.inert){document.body.classList.add("block-interactivity-".concat(o));var S=lz([n.lockRef.current],(n.shards||[]).map(ST),!0).filter(Boolean);return S.forEach(function(w){return w.classList.add("allow-interactivity-".concat(o))}),function(){document.body.classList.remove("block-interactivity-".concat(o)),S.forEach(function(w){return w.classList.remove("allow-interactivity-".concat(o))})}}},[n.inert,n.lockRef.current,n.shards]);var a=C.useCallback(function(S,w){if("touches"in S&&S.touches.length===2)return!i.current.allowPinchZoom;var b=Kp(S),_=t.current,T="deltaX"in S?S.deltaX:_[0]-b[0],E="deltaY"in S?S.deltaY:_[1]-b[1],M,A=S.target,R=Math.abs(T)>Math.abs(E)?"h":"v";if("touches"in S&&R==="h"&&A.type==="range")return!1;var L=yT(R,A);if(!L)return!0;if(L?M=R:(M=R==="v"?"h":"v",L=yT(R,A)),!L)return!1;if(!r.current&&"changedTouches"in S&&(T||E)&&(r.current=M),!M)return!0;var K=r.current||M;return sX(K,w,S,K==="h"?T:E,!0)},[]),c=C.useCallback(function(S){var w=S;if(!(!yc.length||yc[yc.length-1]!==s)){var b="deltaY"in w?vT(w):Kp(w),_=e.current.filter(function(M){return M.name===w.type&&(M.target===w.target||w.target===M.shadowParent)&&iX(M.delta,b)})[0];if(_&&_.should){w.cancelable&&w.preventDefault();return}if(!_){var T=(i.current.shards||[]).map(ST).filter(Boolean).filter(function(M){return M.contains(w.target)}),E=T.length>0?a(w,T[0]):!i.current.noIsolation;E&&w.cancelable&&w.preventDefault()}}},[]),u=C.useCallback(function(S,w,b,_){var T={name:S,delta:w,target:b,should:_,shadowParent:uX(b)};e.current.push(T),setTimeout(function(){e.current=e.current.filter(function(E){return E!==T})},1)},[]),h=C.useCallback(function(S){t.current=Kp(S),r.current=void 0},[]),f=C.useCallback(function(S){u(S.type,vT(S),S.target,a(S,n.lockRef.current))},[]),g=C.useCallback(function(S){u(S.type,Kp(S),S.target,a(S,n.lockRef.current))},[]);C.useEffect(function(){return yc.push(s),n.setCallbacks({onScrollCapture:f,onWheelCapture:f,onTouchMoveCapture:g}),document.addEventListener("wheel",c,mc),document.addEventListener("touchmove",c,mc),document.addEventListener("touchstart",h,mc),function(){yc=yc.filter(function(S){return S!==s}),document.removeEventListener("wheel",c,mc),document.removeEventListener("touchmove",c,mc),document.removeEventListener("touchstart",h,mc)}},[]);var y=n.removeScrollBar,v=n.inert;return C.createElement(C.Fragment,null,v?C.createElement(s,{styles:aX(o)}):null,y?C.createElement(QY,{gapMode:n.gapMode}):null)}function uX(n){for(var e=null;n!==null;)n instanceof ShadowRoot&&(e=n.host,n=n.host),n=n.parentNode;return e}const dX=$Y(pL,cX);var fm=C.forwardRef(function(n,e){return C.createElement(pm,oa({},n,{ref:e,sideCar:dX}))});fm.classNames=pm.classNames;var jw=["Enter"," "],hX=["ArrowDown","PageUp","Home"],vL=["ArrowUp","PageDown","End"],pX=[...hX,...vL],fX={ltr:[...jw,"ArrowRight"],rtl:[...jw,"ArrowLeft"]},gX={ltr:["ArrowLeft"],rtl:["ArrowRight"]},uh="Menu",[Fd,mX,yX]=cm(uh),[El,gm]=Ks(uh,[yX,dm,iL]),dh=dm(),SL=iL(),[xL,Ma]=El(uh),[vX,hh]=El(uh),wL=n=>{const{__scopeMenu:e,open:t=!1,children:r,dir:o,onOpenChange:s,modal:i=!0}=n,a=dh(e),[c,u]=C.useState(null),h=C.useRef(!1),f=Rn(s),g=D1(o);return C.useEffect(()=>{const y=()=>{h.current=!0,document.addEventListener("pointerdown",v,{capture:!0,once:!0}),document.addEventListener("pointermove",v,{capture:!0,once:!0})},v=()=>h.current=!1;return document.addEventListener("keydown",y,{capture:!0}),()=>{document.removeEventListener("keydown",y,{capture:!0}),document.removeEventListener("pointerdown",v,{capture:!0}),document.removeEventListener("pointermove",v,{capture:!0})}},[]),p.jsx($1,{...a,children:p.jsx(xL,{scope:e,open:t,onOpenChange:f,content:c,onContentChange:u,children:p.jsx(vX,{scope:e,onClose:C.useCallback(()=>f(!1),[f]),isUsingKeyboardRef:h,dir:g,modal:i,children:r})})})};wL.displayName=uh;var SX="MenuAnchor",U1=C.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,o=dh(t);return p.jsx(z1,{...o,...r,ref:e})});U1.displayName=SX;var H1="MenuPortal",[xX,bL]=El(H1,{forceMount:void 0}),_L=n=>{const{__scopeMenu:e,forceMount:t,children:r,container:o}=n,s=Ma(H1,e);return p.jsx(xX,{scope:e,forceMount:t,children:p.jsx(ss,{present:t||s.open,children:p.jsx(ch,{asChild:!0,container:o,children:r})})})};_L.displayName=H1;var ko="MenuContent",[wX,K1]=El(ko),PL=C.forwardRef((n,e)=>{const t=bL(ko,n.__scopeMenu),{forceMount:r=t.forceMount,...o}=n,s=Ma(ko,n.__scopeMenu),i=hh(ko,n.__scopeMenu);return p.jsx(Fd.Provider,{scope:n.__scopeMenu,children:p.jsx(ss,{present:r||s.open,children:p.jsx(Fd.Slot,{scope:n.__scopeMenu,children:i.modal?p.jsx(bX,{...o,ref:e}):p.jsx(_X,{...o,ref:e})})})})}),bX=C.forwardRef((n,e)=>{const t=Ma(ko,n.__scopeMenu),r=C.useRef(null),o=Lt(e,r);return C.useEffect(()=>{const s=r.current;if(s)return B1(s)},[]),p.jsx(W1,{...n,ref:o,trapFocus:t.open,disableOutsidePointerEvents:t.open,disableOutsideScroll:!0,onFocusOutside:Ae(n.onFocusOutside,s=>s.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>t.onOpenChange(!1)})}),_X=C.forwardRef((n,e)=>{const t=Ma(ko,n.__scopeMenu);return p.jsx(W1,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>t.onOpenChange(!1)})}),W1=C.forwardRef((n,e)=>{const{__scopeMenu:t,loop:r=!1,trapFocus:o,onOpenAutoFocus:s,onCloseAutoFocus:i,disableOutsidePointerEvents:a,onEntryFocus:c,onEscapeKeyDown:u,onPointerDownOutside:h,onFocusOutside:f,onInteractOutside:g,onDismiss:y,disableOutsideScroll:v,...S}=n,w=Ma(ko,t),b=hh(ko,t),_=dh(t),T=SL(t),E=mX(t),[M,A]=C.useState(null),R=C.useRef(null),L=Lt(e,R,w.onContentChange),K=C.useRef(0),D=C.useRef(""),U=C.useRef(0),V=C.useRef(null),F=C.useRef("right"),$=C.useRef(0),H=v?fm:C.Fragment,Z=v?{as:ml,allowPinchZoom:!0}:void 0,G=Q=>{var Te,we;const ae=D.current+Q,B=E().filter(Ie=>!Ie.disabled),oe=document.activeElement,pe=(Te=B.find(Ie=>Ie.ref.current===oe))==null?void 0:Te.textValue,_e=B.map(Ie=>Ie.textValue),ue=DX(_e,ae,pe),Ne=(we=B.find(Ie=>Ie.textValue===ue))==null?void 0:we.ref.current;(function Ie(Ve){D.current=Ve,window.clearTimeout(K.current),Ve!==""&&(K.current=window.setTimeout(()=>Ie(""),1e3))})(ae),Ne&&setTimeout(()=>Ne.focus())};C.useEffect(()=>()=>window.clearTimeout(K.current),[]),L1();const q=C.useCallback(Q=>{var B,oe;return F.current===((B=V.current)==null?void 0:B.side)&&FX(Q,(oe=V.current)==null?void 0:oe.area)},[]);return p.jsx(wX,{scope:t,searchRef:D,onItemEnter:C.useCallback(Q=>{q(Q)&&Q.preventDefault()},[q]),onItemLeave:C.useCallback(Q=>{var ae;q(Q)||((ae=R.current)==null||ae.focus(),A(null))},[q]),onTriggerLeave:C.useCallback(Q=>{q(Q)&&Q.preventDefault()},[q]),pointerGraceTimerRef:U,onPointerGraceIntentChange:C.useCallback(Q=>{V.current=Q},[]),children:p.jsx(H,{...Z,children:p.jsx(um,{asChild:!0,trapped:o,onMountAutoFocus:Ae(s,Q=>{var ae;Q.preventDefault(),(ae=R.current)==null||ae.focus({preventScroll:!0})}),onUnmountAutoFocus:i,children:p.jsx(lh,{asChild:!0,disableOutsidePointerEvents:a,onEscapeKeyDown:u,onPointerDownOutside:h,onFocusOutside:f,onInteractOutside:g,onDismiss:y,children:p.jsx(IY,{asChild:!0,...T,dir:b.dir,orientation:"vertical",loop:r,currentTabStopId:M,onCurrentTabStopIdChange:A,onEntryFocus:Ae(c,Q=>{b.isUsingKeyboardRef.current||Q.preventDefault()}),preventScrollOnEntryFocus:!0,children:p.jsx(rL,{role:"menu","aria-orientation":"vertical","data-state":BL(w.open),"data-radix-menu-content":"",dir:b.dir,..._,...S,ref:L,style:{outline:"none",...S.style},onKeyDown:Ae(S.onKeyDown,Q=>{const B=Q.target.closest("[data-radix-menu-content]")===Q.currentTarget,oe=Q.ctrlKey||Q.altKey||Q.metaKey,pe=Q.key.length===1;B&&(Q.key==="Tab"&&Q.preventDefault(),!oe&&pe&&G(Q.key));const _e=R.current;if(Q.target!==_e||!pX.includes(Q.key))return;Q.preventDefault();const Ne=E().filter(Te=>!Te.disabled).map(Te=>Te.ref.current);vL.includes(Q.key)&&Ne.reverse(),RX(Ne)}),onBlur:Ae(n.onBlur,Q=>{Q.currentTarget.contains(Q.target)||(window.clearTimeout(K.current),D.current="")}),onPointerMove:Ae(n.onPointerMove,Nd(Q=>{const ae=Q.target,B=$.current!==Q.clientX;if(Q.currentTarget.contains(ae)&&B){const oe=Q.clientX>$.current?"right":"left";F.current=oe,$.current=Q.clientX}}))})})})})})})});PL.displayName=ko;var PX="MenuGroup",V1=C.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return p.jsx(dt.div,{role:"group",...r,ref:e})});V1.displayName=PX;var CX="MenuLabel",CL=C.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return p.jsx(dt.div,{...r,ref:e})});CL.displayName=CX;var gg="MenuItem",xT="menu.itemSelect",mm=C.forwardRef((n,e)=>{const{disabled:t=!1,onSelect:r,...o}=n,s=C.useRef(null),i=hh(gg,n.__scopeMenu),a=K1(gg,n.__scopeMenu),c=Lt(e,s),u=C.useRef(!1),h=()=>{const f=s.current;if(!t&&f){const g=new CustomEvent(xT,{bubbles:!0,cancelable:!0});f.addEventListener(xT,y=>r==null?void 0:r(y),{once:!0}),O1(f,g),g.defaultPrevented?u.current=!1:i.onClose()}};return p.jsx(IL,{...o,ref:c,disabled:t,onClick:Ae(n.onClick,h),onPointerDown:f=>{var g;(g=n.onPointerDown)==null||g.call(n,f),u.current=!0},onPointerUp:Ae(n.onPointerUp,f=>{var g;u.current||(g=f.currentTarget)==null||g.click()}),onKeyDown:Ae(n.onKeyDown,f=>{const g=a.searchRef.current!=="";t||g&&f.key===" "||jw.includes(f.key)&&(f.currentTarget.click(),f.preventDefault())})})});mm.displayName=gg;var IL=C.forwardRef((n,e)=>{const{__scopeMenu:t,disabled:r=!1,textValue:o,...s}=n,i=K1(gg,t),a=SL(t),c=C.useRef(null),u=Lt(e,c),[h,f]=C.useState(!1),[g,y]=C.useState("");return C.useEffect(()=>{const v=c.current;v&&y((v.textContent??"").trim())},[s.children]),p.jsx(Fd.ItemSlot,{scope:t,disabled:r,textValue:o??g,children:p.jsx(EY,{asChild:!0,...a,focusable:!r,children:p.jsx(dt.div,{role:"menuitem","data-highlighted":h?"":void 0,"aria-disabled":r||void 0,"data-disabled":r?"":void 0,...s,ref:u,onPointerMove:Ae(n.onPointerMove,Nd(v=>{r?i.onItemLeave(v):(i.onItemEnter(v),v.defaultPrevented||v.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:Ae(n.onPointerLeave,Nd(v=>i.onItemLeave(v))),onFocus:Ae(n.onFocus,()=>f(!0)),onBlur:Ae(n.onBlur,()=>f(!1))})})})}),IX="MenuCheckboxItem",EL=C.forwardRef((n,e)=>{const{checked:t=!1,onCheckedChange:r,...o}=n;return p.jsx(jL,{scope:n.__scopeMenu,checked:t,children:p.jsx(mm,{role:"menuitemcheckbox","aria-checked":mg(t)?"mixed":t,...o,ref:e,"data-state":Y1(t),onSelect:Ae(o.onSelect,()=>r==null?void 0:r(mg(t)?!0:!t),{checkForDefaultPrevented:!1})})})});EL.displayName=IX;var kL="MenuRadioGroup",[EX,kX]=El(kL,{value:void 0,onValueChange:()=>{}}),TL=C.forwardRef((n,e)=>{const{value:t,onValueChange:r,...o}=n,s=Rn(r);return p.jsx(EX,{scope:n.__scopeMenu,value:t,onValueChange:s,children:p.jsx(V1,{...o,ref:e})})});TL.displayName=kL;var ML="MenuRadioItem",AL=C.forwardRef((n,e)=>{const{value:t,...r}=n,o=kX(ML,n.__scopeMenu),s=t===o.value;return p.jsx(jL,{scope:n.__scopeMenu,checked:s,children:p.jsx(mm,{role:"menuitemradio","aria-checked":s,...r,ref:e,"data-state":Y1(s),onSelect:Ae(r.onSelect,()=>{var i;return(i=o.onValueChange)==null?void 0:i.call(o,t)},{checkForDefaultPrevented:!1})})})});AL.displayName=ML;var G1="MenuItemIndicator",[jL,TX]=El(G1,{checked:!1}),RL=C.forwardRef((n,e)=>{const{__scopeMenu:t,forceMount:r,...o}=n,s=TX(G1,t);return p.jsx(ss,{present:r||mg(s.checked)||s.checked===!0,children:p.jsx(dt.span,{...o,ref:e,"data-state":Y1(s.checked)})})});RL.displayName=G1;var MX="MenuSeparator",OL=C.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n;return p.jsx(dt.div,{role:"separator","aria-orientation":"horizontal",...r,ref:e})});OL.displayName=MX;var AX="MenuArrow",DL=C.forwardRef((n,e)=>{const{__scopeMenu:t,...r}=n,o=dh(t);return p.jsx(oL,{...o,...r,ref:e})});DL.displayName=AX;var q1="MenuSub",[jX,LL]=El(q1),FL=n=>{const{__scopeMenu:e,children:t,open:r=!1,onOpenChange:o}=n,s=Ma(q1,e),i=dh(e),[a,c]=C.useState(null),[u,h]=C.useState(null),f=Rn(o);return C.useEffect(()=>(s.open===!1&&f(!1),()=>f(!1)),[s.open,f]),p.jsx($1,{...i,children:p.jsx(xL,{scope:e,open:r,onOpenChange:f,content:u,onContentChange:h,children:p.jsx(jX,{scope:e,contentId:vi(),triggerId:vi(),trigger:a,onTriggerChange:c,children:t})})})};FL.displayName=q1;var fd="MenuSubTrigger",NL=C.forwardRef((n,e)=>{const t=Ma(fd,n.__scopeMenu),r=hh(fd,n.__scopeMenu),o=LL(fd,n.__scopeMenu),s=K1(fd,n.__scopeMenu),i=C.useRef(null),{pointerGraceTimerRef:a,onPointerGraceIntentChange:c}=s,u={__scopeMenu:n.__scopeMenu},h=C.useCallback(()=>{i.current&&window.clearTimeout(i.current),i.current=null},[]);return C.useEffect(()=>h,[h]),C.useEffect(()=>{const f=a.current;return()=>{window.clearTimeout(f),c(null)}},[a,c]),p.jsx(U1,{asChild:!0,...u,children:p.jsx(IL,{id:o.triggerId,"aria-haspopup":"menu","aria-expanded":t.open,"aria-controls":o.contentId,"data-state":BL(t.open),...n,ref:lm(e,o.onTriggerChange),onClick:f=>{var g;(g=n.onClick)==null||g.call(n,f),!(n.disabled||f.defaultPrevented)&&(f.currentTarget.focus(),t.open||t.onOpenChange(!0))},onPointerMove:Ae(n.onPointerMove,Nd(f=>{s.onItemEnter(f),!f.defaultPrevented&&!n.disabled&&!t.open&&!i.current&&(s.onPointerGraceIntentChange(null),i.current=window.setTimeout(()=>{t.onOpenChange(!0),h()},100))})),onPointerLeave:Ae(n.onPointerLeave,Nd(f=>{var y,v;h();const g=(y=t.content)==null?void 0:y.getBoundingClientRect();if(g){const S=(v=t.content)==null?void 0:v.dataset.side,w=S==="right",b=w?-5:5,_=g[w?"left":"right"],T=g[w?"right":"left"];s.onPointerGraceIntentChange({area:[{x:f.clientX+b,y:f.clientY},{x:_,y:g.top},{x:T,y:g.top},{x:T,y:g.bottom},{x:_,y:g.bottom}],side:S}),window.clearTimeout(a.current),a.current=window.setTimeout(()=>s.onPointerGraceIntentChange(null),300)}else{if(s.onTriggerLeave(f),f.defaultPrevented)return;s.onPointerGraceIntentChange(null)}})),onKeyDown:Ae(n.onKeyDown,f=>{var y;const g=s.searchRef.current!=="";n.disabled||g&&f.key===" "||fX[r.dir].includes(f.key)&&(t.onOpenChange(!0),(y=t.content)==null||y.focus(),f.preventDefault())})})})});NL.displayName=fd;var $L="MenuSubContent",zL=C.forwardRef((n,e)=>{const t=bL(ko,n.__scopeMenu),{forceMount:r=t.forceMount,...o}=n,s=Ma(ko,n.__scopeMenu),i=hh(ko,n.__scopeMenu),a=LL($L,n.__scopeMenu),c=C.useRef(null),u=Lt(e,c);return p.jsx(Fd.Provider,{scope:n.__scopeMenu,children:p.jsx(ss,{present:r||s.open,children:p.jsx(Fd.Slot,{scope:n.__scopeMenu,children:p.jsx(W1,{id:a.contentId,"aria-labelledby":a.triggerId,...o,ref:u,align:"start",side:i.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:h=>{var f;i.isUsingKeyboardRef.current&&((f=c.current)==null||f.focus()),h.preventDefault()},onCloseAutoFocus:h=>h.preventDefault(),onFocusOutside:Ae(n.onFocusOutside,h=>{h.target!==a.trigger&&s.onOpenChange(!1)}),onEscapeKeyDown:Ae(n.onEscapeKeyDown,h=>{i.onClose(),h.preventDefault()}),onKeyDown:Ae(n.onKeyDown,h=>{var y;const f=h.currentTarget.contains(h.target),g=gX[i.dir].includes(h.key);f&&g&&(s.onOpenChange(!1),(y=a.trigger)==null||y.focus(),h.preventDefault())})})})})})});zL.displayName=$L;function BL(n){return n?"open":"closed"}function mg(n){return n==="indeterminate"}function Y1(n){return mg(n)?"indeterminate":n?"checked":"unchecked"}function RX(n){const e=document.activeElement;for(const t of n)if(t===e||(t.focus(),document.activeElement!==e))return}function OX(n,e){return n.map((t,r)=>n[(e+r)%n.length])}function DX(n,e,t){const o=e.length>1&&Array.from(e).every(u=>u===e[0])?e[0]:e,s=t?n.indexOf(t):-1;let i=OX(n,Math.max(s,0));o.length===1&&(i=i.filter(u=>u!==t));const c=i.find(u=>u.toLowerCase().startsWith(o.toLowerCase()));return c!==t?c:void 0}function LX(n,e){const{x:t,y:r}=n;let o=!1;for(let s=0,i=e.length-1;s<e.length;i=s++){const a=e[s].x,c=e[s].y,u=e[i].x,h=e[i].y;c>r!=h>r&&t<(u-a)*(r-c)/(h-c)+a&&(o=!o)}return o}function FX(n,e){if(!e)return!1;const t={x:n.clientX,y:n.clientY};return LX(t,e)}function Nd(n){return e=>e.pointerType==="mouse"?n(e):void 0}var UL=wL,HL=U1,KL=_L,WL=PL,VL=V1,GL=CL,qL=mm,YL=EL,XL=TL,ZL=AL,QL=RL,JL=OL,e5=DL,t5=FL,n5=NL,r5=zL,X1="ContextMenu",[NX,tle]=Ks(X1,[gm]),Jn=gm(),[$X,o5]=NX(X1),s5=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,dir:o,modal:s=!0}=n,[i,a]=C.useState(!1),c=Jn(e),u=Rn(r),h=C.useCallback(f=>{a(f),u(f)},[u]);return p.jsx($X,{scope:e,open:i,onOpenChange:h,modal:s,children:p.jsx(UL,{...c,dir:o,open:i,onOpenChange:h,modal:s,children:t})})};s5.displayName=X1;var i5="ContextMenuTrigger",a5=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,disabled:r=!1,...o}=n,s=o5(i5,t),i=Jn(t),a=C.useRef({x:0,y:0}),c=C.useRef({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...a.current})}),u=C.useRef(0),h=C.useCallback(()=>window.clearTimeout(u.current),[]),f=g=>{a.current={x:g.clientX,y:g.clientY},s.onOpenChange(!0)};return C.useEffect(()=>h,[h]),C.useEffect(()=>void(r&&h()),[r,h]),p.jsxs(p.Fragment,{children:[p.jsx(HL,{...i,virtualRef:c}),p.jsx(dt.span,{"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,...o,ref:e,style:{WebkitTouchCallout:"none",...n.style},onContextMenu:r?n.onContextMenu:Ae(n.onContextMenu,g=>{h(),f(g),g.preventDefault()}),onPointerDown:r?n.onPointerDown:Ae(n.onPointerDown,Wp(g=>{h(),u.current=window.setTimeout(()=>f(g),700)})),onPointerMove:r?n.onPointerMove:Ae(n.onPointerMove,Wp(h)),onPointerCancel:r?n.onPointerCancel:Ae(n.onPointerCancel,Wp(h)),onPointerUp:r?n.onPointerUp:Ae(n.onPointerUp,Wp(h))})]})});a5.displayName=i5;var zX="ContextMenuPortal",Z1=n=>{const{__scopeContextMenu:e,...t}=n,r=Jn(e);return p.jsx(KL,{...r,...t})};Z1.displayName=zX;var l5="ContextMenuContent",c5=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=o5(l5,t),s=Jn(t),i=C.useRef(!1);return p.jsx(WL,{...s,...r,ref:e,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:a=>{var c;(c=n.onCloseAutoFocus)==null||c.call(n,a),!a.defaultPrevented&&i.current&&a.preventDefault(),i.current=!1},onInteractOutside:a=>{var c;(c=n.onInteractOutside)==null||c.call(n,a),!a.defaultPrevented&&!o.modal&&(i.current=!0)},style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});c5.displayName=l5;var BX="ContextMenuGroup",u5=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=Jn(t);return p.jsx(VL,{...o,...r,ref:e})});u5.displayName=BX;var UX="ContextMenuLabel",HX=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=Jn(t);return p.jsx(GL,{...o,...r,ref:e})});HX.displayName=UX;var KX="ContextMenuItem",d5=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=Jn(t);return p.jsx(qL,{...o,...r,ref:e})});d5.displayName=KX;var WX="ContextMenuCheckboxItem",h5=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=Jn(t);return p.jsx(YL,{...o,...r,ref:e})});h5.displayName=WX;var VX="ContextMenuRadioGroup",GX=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=Jn(t);return p.jsx(XL,{...o,...r,ref:e})});GX.displayName=VX;var qX="ContextMenuRadioItem",YX=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=Jn(t);return p.jsx(ZL,{...o,...r,ref:e})});YX.displayName=qX;var XX="ContextMenuItemIndicator",ZX=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=Jn(t);return p.jsx(QL,{...o,...r,ref:e})});ZX.displayName=XX;var QX="ContextMenuSeparator",JX=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=Jn(t);return p.jsx(JL,{...o,...r,ref:e})});JX.displayName=QX;var eZ="ContextMenuArrow",tZ=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=Jn(t);return p.jsx(e5,{...o,...r,ref:e})});tZ.displayName=eZ;var nZ="ContextMenuSub",p5=n=>{const{__scopeContextMenu:e,children:t,onOpenChange:r,open:o,defaultOpen:s}=n,i=Jn(e),[a,c]=Ta({prop:o,defaultProp:s,onChange:r});return p.jsx(t5,{...i,open:a,onOpenChange:c,children:t})};p5.displayName=nZ;var rZ="ContextMenuSubTrigger",f5=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=Jn(t);return p.jsx(n5,{...o,...r,ref:e})});f5.displayName=rZ;var oZ="ContextMenuSubContent",g5=C.forwardRef((n,e)=>{const{__scopeContextMenu:t,...r}=n,o=Jn(t);return p.jsx(r5,{...o,...r,ref:e,style:{...n.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});g5.displayName=oZ;function Wp(n){return e=>e.pointerType!=="mouse"?n(e):void 0}var sZ=s5,iZ=a5,aZ=Z1,lZ=c5,cZ=h5,Q1="DropdownMenu",[uZ,nle]=Ks(Q1,[gm]),er=gm(),[dZ,m5]=uZ(Q1),y5=n=>{const{__scopeDropdownMenu:e,children:t,dir:r,open:o,defaultOpen:s,onOpenChange:i,modal:a=!0}=n,c=er(e),u=C.useRef(null),[h=!1,f]=Ta({prop:o,defaultProp:s,onChange:i});return p.jsx(dZ,{scope:e,triggerId:vi(),triggerRef:u,contentId:vi(),open:h,onOpenChange:f,onOpenToggle:C.useCallback(()=>f(g=>!g),[f]),modal:a,children:p.jsx(UL,{...c,open:h,onOpenChange:f,dir:r,modal:a,children:t})})};y5.displayName=Q1;var v5="DropdownMenuTrigger",S5=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,disabled:r=!1,...o}=n,s=m5(v5,t),i=er(t);return p.jsx(HL,{asChild:!0,...i,children:p.jsx(dt.button,{type:"button",id:s.triggerId,"aria-haspopup":"menu","aria-expanded":s.open,"aria-controls":s.open?s.contentId:void 0,"data-state":s.open?"open":"closed","data-disabled":r?"":void 0,disabled:r,...o,ref:lm(e,s.triggerRef),onPointerDown:Ae(n.onPointerDown,a=>{!r&&a.button===0&&a.ctrlKey===!1&&(s.onOpenToggle(),s.open||a.preventDefault())}),onKeyDown:Ae(n.onKeyDown,a=>{r||(["Enter"," "].includes(a.key)&&s.onOpenToggle(),a.key==="ArrowDown"&&s.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(a.key)&&a.preventDefault())})})})});S5.displayName=v5;var hZ="DropdownMenuPortal",x5=n=>{const{__scopeDropdownMenu:e,...t}=n,r=er(e);return p.jsx(KL,{...r,...t})};x5.displayName=hZ;var w5="DropdownMenuContent",b5=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,o=m5(w5,t),s=er(t),i=C.useRef(!1);return p.jsx(WL,{id:o.contentId,"aria-labelledby":o.triggerId,...s,...r,ref:e,onCloseAutoFocus:Ae(n.onCloseAutoFocus,a=>{var c;i.current||(c=o.triggerRef.current)==null||c.focus(),i.current=!1,a.preventDefault()}),onInteractOutside:Ae(n.onInteractOutside,a=>{const c=a.detail.originalEvent,u=c.button===0&&c.ctrlKey===!0,h=c.button===2||u;(!o.modal||h)&&(i.current=!0)}),style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});b5.displayName=w5;var pZ="DropdownMenuGroup",_5=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,o=er(t);return p.jsx(VL,{...o,...r,ref:e})});_5.displayName=pZ;var fZ="DropdownMenuLabel",gZ=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,o=er(t);return p.jsx(GL,{...o,...r,ref:e})});gZ.displayName=fZ;var mZ="DropdownMenuItem",P5=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,o=er(t);return p.jsx(qL,{...o,...r,ref:e})});P5.displayName=mZ;var yZ="DropdownMenuCheckboxItem",C5=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,o=er(t);return p.jsx(YL,{...o,...r,ref:e})});C5.displayName=yZ;var vZ="DropdownMenuRadioGroup",SZ=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,o=er(t);return p.jsx(XL,{...o,...r,ref:e})});SZ.displayName=vZ;var xZ="DropdownMenuRadioItem",wZ=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,o=er(t);return p.jsx(ZL,{...o,...r,ref:e})});wZ.displayName=xZ;var bZ="DropdownMenuItemIndicator",_Z=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,o=er(t);return p.jsx(QL,{...o,...r,ref:e})});_Z.displayName=bZ;var PZ="DropdownMenuSeparator",CZ=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,o=er(t);return p.jsx(JL,{...o,...r,ref:e})});CZ.displayName=PZ;var IZ="DropdownMenuArrow",EZ=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,o=er(t);return p.jsx(e5,{...o,...r,ref:e})});EZ.displayName=IZ;var kZ=n=>{const{__scopeDropdownMenu:e,children:t,open:r,onOpenChange:o,defaultOpen:s}=n,i=er(e),[a=!1,c]=Ta({prop:r,defaultProp:s,onChange:o});return p.jsx(t5,{...i,open:a,onOpenChange:c,children:t})},TZ="DropdownMenuSubTrigger",I5=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,o=er(t);return p.jsx(n5,{...o,...r,ref:e})});I5.displayName=TZ;var MZ="DropdownMenuSubContent",E5=C.forwardRef((n,e)=>{const{__scopeDropdownMenu:t,...r}=n,o=er(t);return p.jsx(r5,{...o,...r,ref:e,style:{...n.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});E5.displayName=MZ;var J1=y5,e_=S5,ym=x5,t_=b5,AZ=_5,jZ=P5,RZ=C5,OZ=kZ,DZ=I5,LZ=E5;function Rt(n,e){var o;const t=new Set;for(const s of e){const i=n.getShape(s);if(!i)continue;n.getShapeUtil(i).onDragShapesOut&&t.add(i);const a=n.getShape(i.parentId);a&&n.getShapeUtil(a).onDragShapesOut&&t.add(a)}const r=new Map;for(const s of t){const i=k5(n,s);i.length&&r.set(s,i)}for(const[s,i]of r){const a=n.getShapeUtil(s),c=Ze(i.map(u=>n.getShape(u)));(o=a.onDragShapesOut)==null||o.call(a,s,c)}}function k5(n,e){const t=n.getSortedChildIdsForParent(e.id);if(t.length===0)return[];const r=n.getShapePageBounds(e);if(!r)return[];let o,s,i;const a=[];for(const c of t){const u=n.getShapePageBounds(c);if(!u)continue;if(!r.includes(u)){a.push(c);continue}o??(o=n.getShapeGeometry(e)),s??(s=n.getShapePageTransform(e)),i??(i=s.applyToPoints(o.vertices));const h=n.getShapePageTransform(c).clone().invert().applyToPoints(i),{vertices:f,isClosed:g}=n.getShapeGeometry(c);if(!f.some(y=>no(y,h))){if(g){if(x1(h,f))continue}else if(jK(h,f))continue;a.push(c)}}return a}function yg(n,e,t=!1){n.select(e),n.setEditingShape(e),n.setCurrentTool("select.editing_shape",{target:"shape",shape:e}),t&&n.emit("select-all-text",{shapeId:e.id})}function FZ(n,e){const t=Ze(e.map(o=>n.getShape(o)).filter(o=>o&&n.isShapeOfType(o,"frame")));if(!t.length)return;const r=[];n.run(()=>{t.map(o=>{const s=n.getSortedChildIdsForParent(o.id);s.length&&(n.reparentShapes(s,o.parentId,o.index),r.push(...s))}),n.setSelectedShapes(r),n.deleteShapes(e)})}const NZ=50;function $Z(n,e,t={}){const r=n.getShape(e);if(!r)return;const o=n.getSortedChildIdsForParent(r.id),s=Ze(o.map(y=>n.getShape(y)));if(!s.length)return;const i=xe.FromPoints(s.flatMap(y=>{const v=n.getShapeGeometry(y.id);return n.getShapeLocalTransform(y).applyToPoints(v.vertices)})),{padding:a=NZ}=t,c=i.w+2*a,u=i.h+2*a,h=a-i.minX,f=a-i.minY;if(h===0&&f===0&&r.props.w===c&&r.props.h===u)return;const g=new P(h,f).rot(r.rotation);n.run(()=>{const y=o.map(v=>{const S=n.getShape(v);return{id:S.id,type:S.type,x:S.x+h,y:S.y+f}});y.push({id:r.id,type:r.type,x:r.x-g.x,y:r.y-g.y,props:{w:c,h:u}}),n.updateShapes(y)})}const T5=C.createContext(null);function zZ({assetUrls:n,children:e}){return C.useEffect(()=>{for(const t of Object.values(n.icons)){const r=Ad();r.src=t,r.decode()}for(const t of Object.values(n.embedIcons)){const r=Ad();r.src=t,r.decode()}},[n]),p.jsx(T5.Provider,{value:n,children:e})}function n_(){const n=C.useContext(T5);if(!n)throw new Error("useAssetUrls must be used within an AssetUrlsProvider");return n}const Rw={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.fork-project-on-tldraw":"Fork project on tldraw","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.paste-error-title":"Pasting failed","action.paste-error-description":"Could not paste due to missing clipboard permissions. Please enable the permissions and try again.","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-paste-at-cursor.menu":"Paste at cursor","action.toggle-paste-at-cursor":"Toggle paste at cursor","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-dynamic-size-mode.menu":"Dynamic size","action.toggle-dynamic-size-mode":"Toggle dynamic size","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.flatten-to-image":"Flatten","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.size-too-big":"File size is too big","assets.files.type-not-allowed":"File type is not allowed","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","theme.dark":"Dark","theme.light":"Light","theme.system":"System","color-style.white":"White","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","fill-style.fill":"Fill","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","tool.pointer-down":"Pointer down","menu.title":"Menu","menu.theme":"Theme","menu.copy-as":"Copy as","menu.edit":"Edit","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.help":"Help","menu.view":"View","context-menu.edit":"Edit","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy editor link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy viewer link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to access this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","share-menu.creating-project":"Creating the new project…","share-menu.copied":"Copied link","document-name-menu.copy-link":"Copy link","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.import-tldr-file":"Import file...","help-menu.title":"Help and resources","help-menu.about":"About tldraw","help-menu.docs":"Documentation & API","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","help-menu.terms":"Terms of service","help-menu.privacy":"Privacy policy","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.label-align":"Label align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},BZ=new Set(["ar","fa","he","ur","ku"]),vc={locale:"en",label:"English",messages:Rw,dir:"ltr"};async function UZ(n,e){if(!(await Ds(e.translations.en)).ok)return console.warn("No main translations found."),vc;if(n==="en")return vc;const r=Dd.find(a=>a.locale===n);if(!r)return console.warn(`No translation found for locale ${n}`),vc;const s=await(await Ds(e.translations[r.locale])).json();if(!s)return console.warn(`No messages found for locale ${n}`),vc;const i=[];for(const a in vc.messages)s[a]||i.push(a);return i.length>0,{locale:n,label:r.label,dir:BZ.has(r.locale)?"rtl":"ltr",messages:{...vc.messages,...s}}}const M5=C.createContext(null);function A5(){const n=C.useContext(M5);if(!n)throw new Error("useCurrentTranslation must be used inside of <TldrawUiContextProvider />");return n}function HZ({overrides:n,locale:e,children:t}){const r=n_(),[o,s]=C.useState(()=>n&&n.en?{locale:"en",label:"English",dir:"ltr",messages:{...Rw,...n.en}}:{locale:"en",label:"English",dir:"ltr",messages:Rw});return C.useEffect(()=>{let i=!1;async function a(){const c=await UZ(e,r);c&&!i&&(n&&n[e]?s({...c,messages:{...c.messages,...n[e]}}):s(c))}return a(),()=>{i=!0}},[r,e,n]),p.jsx(M5.Provider,{value:o,children:t})}function lt(){const n=A5();return C.useCallback(function(t){return n.messages[t]??t},[n])}const $e=C.forwardRef(function({children:e,type:t,...r},o){return p.jsx("button",{ref:o,type:"button",draggable:!1,...r,className:Fe("tlui-button",`tlui-button__${t}`,r.className),children:e})});function an({children:n}){return p.jsx("span",{className:"tlui-button__label",children:n})}var r_="Dialog",[j5,rle]=Ks(r_),[KZ,is]=j5(r_),R5=n=>{const{__scopeDialog:e,children:t,open:r,defaultOpen:o,onOpenChange:s,modal:i=!0}=n,a=C.useRef(null),c=C.useRef(null),[u=!1,h]=Ta({prop:r,defaultProp:o,onChange:s});return p.jsx(KZ,{scope:e,triggerRef:a,contentRef:c,contentId:vi(),titleId:vi(),descriptionId:vi(),open:u,onOpenChange:h,onOpenToggle:C.useCallback(()=>h(f=>!f),[h]),modal:i,children:t})};R5.displayName=r_;var O5="DialogTrigger",WZ=C.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,o=is(O5,t),s=Lt(e,o.triggerRef);return p.jsx(dt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":i_(o.open),...r,ref:s,onClick:Ae(n.onClick,o.onOpenToggle)})});WZ.displayName=O5;var o_="DialogPortal",[VZ,D5]=j5(o_,{forceMount:void 0}),L5=n=>{const{__scopeDialog:e,forceMount:t,children:r,container:o}=n,s=is(o_,e);return p.jsx(VZ,{scope:e,forceMount:t,children:C.Children.map(r,i=>p.jsx(ss,{present:t||s.open,children:p.jsx(ch,{asChild:!0,container:o,children:i})}))})};L5.displayName=o_;var vg="DialogOverlay",F5=C.forwardRef((n,e)=>{const t=D5(vg,n.__scopeDialog),{forceMount:r=t.forceMount,...o}=n,s=is(vg,n.__scopeDialog);return s.modal?p.jsx(ss,{present:r||s.open,children:p.jsx(GZ,{...o,ref:e})}):null});F5.displayName=vg;var GZ=C.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,o=is(vg,t);return p.jsx(fm,{as:ml,allowPinchZoom:!0,shards:[o.contentRef],children:p.jsx(dt.div,{"data-state":i_(o.open),...r,ref:e,style:{pointerEvents:"auto",...r.style}})})}),yl="DialogContent",N5=C.forwardRef((n,e)=>{const t=D5(yl,n.__scopeDialog),{forceMount:r=t.forceMount,...o}=n,s=is(yl,n.__scopeDialog);return p.jsx(ss,{present:r||s.open,children:s.modal?p.jsx(qZ,{...o,ref:e}):p.jsx(YZ,{...o,ref:e})})});N5.displayName=yl;var qZ=C.forwardRef((n,e)=>{const t=is(yl,n.__scopeDialog),r=C.useRef(null),o=Lt(e,t.contentRef,r);return C.useEffect(()=>{const s=r.current;if(s)return B1(s)},[]),p.jsx($5,{...n,ref:o,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ae(n.onCloseAutoFocus,s=>{var i;s.preventDefault(),(i=t.triggerRef.current)==null||i.focus()}),onPointerDownOutside:Ae(n.onPointerDownOutside,s=>{const i=s.detail.originalEvent,a=i.button===0&&i.ctrlKey===!0;(i.button===2||a)&&s.preventDefault()}),onFocusOutside:Ae(n.onFocusOutside,s=>s.preventDefault())})}),YZ=C.forwardRef((n,e)=>{const t=is(yl,n.__scopeDialog),r=C.useRef(!1),o=C.useRef(!1);return p.jsx($5,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var i,a;(i=n.onCloseAutoFocus)==null||i.call(n,s),s.defaultPrevented||(r.current||(a=t.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{var c,u;(c=n.onInteractOutside)==null||c.call(n,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;((u=t.triggerRef.current)==null?void 0:u.contains(i))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),$5=C.forwardRef((n,e)=>{const{__scopeDialog:t,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,...i}=n,a=is(yl,t),c=C.useRef(null),u=Lt(e,c);return L1(),p.jsxs(p.Fragment,{children:[p.jsx(um,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:p.jsx(lh,{role:"dialog",id:a.contentId,"aria-describedby":a.descriptionId,"aria-labelledby":a.titleId,"data-state":i_(a.open),...i,ref:u,onDismiss:()=>a.onOpenChange(!1)})}),p.jsxs(p.Fragment,{children:[p.jsx(ZZ,{titleId:a.titleId}),p.jsx(JZ,{contentRef:c,descriptionId:a.descriptionId})]})]})}),s_="DialogTitle",z5=C.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,o=is(s_,t);return p.jsx(dt.h2,{id:o.titleId,...r,ref:e})});z5.displayName=s_;var B5="DialogDescription",XZ=C.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,o=is(B5,t);return p.jsx(dt.p,{id:o.descriptionId,...r,ref:e})});XZ.displayName=B5;var U5="DialogClose",H5=C.forwardRef((n,e)=>{const{__scopeDialog:t,...r}=n,o=is(U5,t);return p.jsx(dt.button,{type:"button",...r,ref:e,onClick:Ae(n.onClick,()=>o.onOpenChange(!1))})});H5.displayName=U5;function i_(n){return n?"open":"closed"}var K5="DialogTitleWarning",[ole,W5]=wq(K5,{contentName:yl,titleName:s_,docsSlug:"dialog"}),ZZ=({titleId:n})=>{const e=W5(K5),t=`\`${e.contentName}\` requires a \`${e.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${e.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${e.docsSlug}`;return C.useEffect(()=>{n&&(document.getElementById(n)||console.error(t))},[t,n]),null},QZ="DialogDescriptionWarning",JZ=({contentRef:n,descriptionId:e})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${W5(QZ).contentName}}.`;return C.useEffect(()=>{var s;const o=(s=n.current)==null?void 0:s.getAttribute("aria-describedby");e&&o&&(document.getElementById(e)||console.warn(r))},[r,n,e]),null},eQ=R5,tQ=L5,nQ=F5,rQ=N5;const $s=C.memo(function({small:e,invertIcon:t,icon:r,color:o,className:s,...i}){const a=n_(),c=a.icons[r]??a.icons["question-mark-circle"],u=C.useRef(null);return C.useLayoutEffect(()=>{c||console.error(`Icon not found: ${r}. Add it to the assetUrls.icons object.`),u!=null&&u.current&&(u.current.style.webkitMask=`url(${c}) center 100% / 100% no-repeat`)},[u,c,r]),r==="none"?p.jsx("div",{className:Fe("tlui-icon tlui-icon__placeholder",{"tlui-icon__small":e},s)}):p.jsx("div",{...i,ref:u,className:Fe("tlui-icon",{"tlui-icon__small":e},s),style:{color:o,mask:`url(${c}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})});function rt({icon:n,small:e,invertIcon:t}){return p.jsx($s,{className:"tlui-button__icon",icon:n,small:e,invertIcon:t})}function vm({className:n,children:e}){return p.jsx("div",{className:Fe("tlui-dialog__header",n),children:e})}function Sm({className:n,children:e}){return p.jsx(z5,{dir:"ltr",className:Fe("tlui-dialog__header__title",n),children:e})}function xm(){return p.jsx("div",{className:"tlui-dialog__header__close",children:p.jsx(H5,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:p.jsx($e,{type:"icon","aria-label":"Close",onTouchEnd:n=>n.target.click(),children:p.jsx(rt,{small:!0,icon:"cross-2"})})})})}function $d({className:n,children:e,style:t}){return p.jsx("div",{className:Fe("tlui-dialog__body",n),style:t,children:e})}function a_({className:n,children:e}){return p.jsx("div",{className:Fe("tlui-dialog__footer",n),children:e})}const wm=C.forwardRef(function({className:e,label:t,icon:r,iconLeft:o,autoSelect:s=!1,autoFocus:i=!1,defaultValue:a,placeholder:c,onComplete:u,onValueChange:h,onCancel:f,onFocus:g,onBlur:y,shouldManuallyMaintainScrollPositionWhenFocused:v=!1,children:S,value:w},b){const _=Ia(),T=C.useRef(null);C.useImperativeHandle(b,()=>T.current);const E=lt(),M=C.useRef(a??""),A=C.useRef(a??""),[R,L]=C.useState(!1),K=C.useCallback(F=>{L(!0);const $=F.currentTarget;A.current=$.value,_?_.timers.requestAnimationFrame(()=>{s&&$.select()}):xw.requestAnimationFrame("anon",()=>{s&&$.select()}),g==null||g()},[s,_,g]),D=C.useCallback(F=>{const $=F.currentTarget.value;A.current=$,h==null||h($)},[h]),U=C.useCallback(F=>{switch(F.key){case"Enter":{F.currentTarget.blur(),cn(F),u==null||u(F.currentTarget.value);break}case"Escape":{F.currentTarget.value=M.current,f==null||f(F.currentTarget.value),F.currentTarget.blur(),cn(F);break}}},[u,f]),V=C.useCallback(F=>{L(!1);const $=F.currentTarget.value;y==null||y($)},[y]);return C.useEffect(()=>{if(!kt.isIos)return;const F=window.visualViewport;if(R&&v&&F){const $=()=>{var H;(H=T.current)==null||H.scrollIntoView({block:"center"})};return F.addEventListener("resize",$),F.addEventListener("scroll",$),_?_.timers.requestAnimationFrame(()=>{var H;(H=T.current)==null||H.scrollIntoView({block:"center"})}):xw.requestAnimationFrame("anon",()=>{var H;(H=T.current)==null||H.scrollIntoView({block:"center"})}),()=>{F.removeEventListener("resize",$),F.removeEventListener("scroll",$)}}},[R,_,v]),p.jsxs("div",{draggable:!1,className:"tlui-input__wrapper",children:[S,t&&p.jsx("label",{children:E(t)}),o&&p.jsx($s,{icon:o,className:"tlui-icon-left",small:!0}),p.jsx("input",{ref:T,className:Fe("tlui-input",e),type:"text",defaultValue:a,onKeyDownCapture:U,onChange:D,onFocus:K,onBlur:V,autoFocus:i,placeholder:c,value:w}),r&&p.jsx($s,{icon:r,small:!!t})]})});function wT(n){return ro.isValid(n)?{isValid:!0,hasProtocol:!0}:ro.isValid("https://"+n)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}const oQ=On(function({onClose:e}){const r=te().getOnlySelectedShape();return r&&"url"in r.props&&typeof r.props.url=="string"?p.jsx(sQ,{onClose:e,selectedShape:r}):null}),sQ=On(function({onClose:e,selectedShape:t}){const r=te(),o=lt(),s=C.useRef(null);C.useEffect(()=>{r.timers.requestAnimationFrame(()=>{var v;return(v=s.current)==null?void 0:v.focus()})},[r]);const i=C.useRef(t.props.url),[a,c]=C.useState(()=>{const v=wT(t.props.url),S=v.isValid===!0?v.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:S,safe:S,valid:!0}}),u=C.useCallback(v=>{const S=v.replace(/https?:\/\/(https?:\/\/)/,(_,T)=>T),w=wT(S),b=w.isValid===!0?w.hasProtocol?S:"https://"+S:"https://";c({actual:S,safe:b,valid:w.isValid})},[]),h=C.useCallback(()=>{const v=r.getOnlySelectedShape();v&&(r.updateShapes([{id:v.id,type:v.type,props:{url:""}}]),e())},[r,e]),f=C.useCallback(()=>{const v=r.getOnlySelectedShape();v&&(v&&"url"in v.props&&v.props.url!==a.safe&&r.updateShapes([{id:v.id,type:v.type,props:{url:a.safe}}]),e())},[r,e,a]),g=C.useCallback(()=>{e()},[e]);if(!t)return e(),null;const y=i.current&&!a.valid;return p.jsxs(p.Fragment,{children:[p.jsxs(vm,{children:[p.jsx(Sm,{children:o("edit-link-dialog.title")}),p.jsx(xm,{})]}),p.jsx($d,{children:p.jsxs("div",{className:"tlui-edit-link-dialog",children:[p.jsx(wm,{ref:s,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autoFocus:!0,value:a.actual,onValueChange:u,onComplete:f,onCancel:g}),p.jsx("div",{children:a.valid?o("edit-link-dialog.detail"):o("edit-link-dialog.invalid-url")})]})}),p.jsxs(a_,{className:"tlui-dialog__footer__actions",children:[p.jsx($e,{type:"normal",onClick:g,onTouchEnd:g,children:p.jsx(an,{children:o("edit-link-dialog.cancel")})}),y?p.jsx($e,{type:"danger",onTouchEnd:h,onClick:h,children:p.jsx(an,{children:o("edit-link-dialog.clear")})}):p.jsx($e,{type:"primary",disabled:!a.valid,onTouchEnd:f,onClick:f,children:p.jsx(an,{children:o("edit-link-dialog.save")})})]})]})});var iQ={};const bT=/(^\/r\/[^/]+\/?$)/,l_=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(bT))return n},fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(bT))return n}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{if(n.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!n.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${n}`},fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/^\/embed\/?$/)){const t=e.searchParams.get("url");if(t)return t}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,overridePermissions:{"allow-presentation":!0},toEmbedUrl:n=>{if(n.includes("/maps/")){const e=n.match(/@(.*),(.*),(.*)z/);let t;if(e){const[,r,o,s]=e;t=`https://${new URL(n).host.replace("www.","")}/maps/embed/v1/view?key=${iQ.NEXT_PUBLIC_GC_API_KEY}&center=${r},${o}&zoom=${s}`}else t="";return t}},fromEmbedUrl:n=>{const e=Ge(n);if(!e)return;if(e.pathname.match(/^\/maps\/embed\/v1\/view\/?$/)&&e.searchParams.has("center")&&e.searchParams.get("zoom")){const r=e.searchParams.get("zoom"),[o,s]=e.searchParams.get("center").split(",");return`https://www.google.com/maps/@${o},${s},${r}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ge(n),t=e&&e.pathname.match(/\/v\/(.+)\/?/);if(t)return`https://www.val.town/embed/${t[1]}`},fromEmbedUrl:n=>{const e=Ge(n),t=e&&e.pathname.match(/\/embed\/(.+)\/?/);if(t)return`https://www.val.town/v/${t[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ge(n),t=e&&e.pathname.match(/\/s\/([^/]+)\/?/);if(t)return`https://codesandbox.io/embed/${t[1]}`},fromEmbedUrl:n=>{const e=Ge(n),t=e&&e.pathname.match(/\/embed\/([^/]+)\/?/);if(t)return`https://codesandbox.io/s/${t[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,toEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/,t=n.match(e);if(t){const[r,o,s]=t;return`https://codepen.io/${o}/embed/${s}`}},fromEmbedUrl:n=>{const e=/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,o,s]=t;return`https://codepen.io/${o}/pen/${s}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,toEmbedUrl:n=>{const e=/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/,t=n.match(e);if(t){const[r,o]=t;return`https://scratch.mit.edu/projects/embed/${o}`}},fromEmbedUrl:n=>{const e=/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/,t=n.match(e);if(t){const[r,o]=t;return`https://scratch.mit.edu/projects/${o}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,overridePermissions:{"allow-presentation":!0,"allow-popups-to-escape-sandbox":!0},isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Ge(n);if(!e)return;const t=e.hostname.replace(/^www./,"");if(t==="youtu.be")return`https://www.youtube.com/embed/${e.pathname.split("/").filter(Boolean)[0]}`;if((t==="youtube.com"||t==="m.youtube.com")&&e.pathname.match(/^\/watch/))return`https://www.youtube.com/embed/${e.searchParams.get("v")}`},fromEmbedUrl:n=>{const e=Ge(n);if(!e)return;if(e.hostname.replace(/^www./,"")==="youtube.com"){const r=e.pathname.match(/^\/embed\/([^/]+)\/?/);if(r)return`https://www.youtube.com/watch?v=${r[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=Ge(n),t=e==null?void 0:e.searchParams.get("cid");if(e!=null&&e.pathname.match(/\/calendar\/u\/0/)&&t){e.pathname="/calendar/embed";const r=Array.from(e.searchParams.keys());for(const o of r)e.searchParams.delete(o);return e.searchParams.set("src",t),e.href}},fromEmbedUrl:n=>{const e=Ge(n),t=e==null?void 0:e.searchParams.get("src");if(e!=null&&e.pathname.match(/\/calendar\/embed/)&&t){e.pathname="/calendar/u/0";const r=Array.from(e.searchParams.keys());for(const o of r)e.searchParams.delete(o);return e.searchParams.set("cid",t),e.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,overridePermissions:{"allow-popups-to-escape-sandbox":!0},toEmbedUrl:n=>{const e=Ge(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/pub\/?$/))){e.pathname=e.pathname.replace(/\/pub$/,"/embed");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}},fromEmbedUrl:n=>{const e=Ge(n);if(e!=null&&e.pathname.match(/^\/presentation/)&&(e!=null&&e.pathname.match(/\/embed\/?$/))){e.pathname=e.pathname.replace(/\/embed$/,"/pub");const t=Array.from(e.searchParams.keys());for(const r of t)e.searchParams.delete(r);return e.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0},fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/\/([^/]+)\/([^/]+)/))return n.split("/").pop()?n:void 0}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${n}?embed=true`},fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/\/@([^/]+)\/([^/]+)/)&&e.searchParams.has("embed"))return e.searchParams.delete("embed"),e.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,toEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/^\/map\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/^\/embed\/map\//))return e.pathname=e.pathname.replace(/^\/embed/,""),e.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,toEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/^\/(artist|album)\//))return e.origin+"/embed"+e.pathname},fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/^\/embed\/(artist|album)\//))return e.origin+e.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Ge(n);if(e&&e.hostname==="vimeo.com"&&e.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+e.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.hostname==="player.vimeo.com"){const t=e.pathname.match(/^\/video\/([^/]+)\/?$/);if(t)return"https://vimeo.com/"+t[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!0,toEmbedUrl:n=>{const e=Ge(n);if(e&&e.hash.match(/#room=/))return n},fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.hash.match(/#room=/))return n}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}/embed${e.pathname}?cell=*`;if(e&&e.pathname.match(/^\/d\/([^/]+)\/?$/)){const t=e.pathname.replace(/^\/d/,"");return`${e.origin}/embed${t}?cell=*`}},fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","")}#cell-*`;if(e&&e.pathname.match(/^\/embed\/([^/]+)\/?$/))return`${e.origin}${e.pathname.replace("/embed","/d")}#cell-*`}},{type:"desmos",title:"Desmos",hostnames:["desmos.com"],width:700,height:450,doesResize:!0,toEmbedUrl:n=>{const e=Ge(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search===""&&e.hash==="")return`${n}?embed`},fromEmbedUrl:n=>{const e=Ge(n);if(e&&e.hostname==="www.desmos.com"&&e.pathname.match(/^\/calculator\/([^/]+)\/?$/)&&e.search==="?embed"&&e.hash==="")return n.replace("?embed","")}}],aQ={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},lQ=l_.map(n=>n.type);function cQ(n){return lQ.includes(n)}function uQ(n){return"icon"in n}function V5(){return te().getShapeUtil("embed")}function c_(){const n=V5();return e=>n?n.getEmbedDefinition(e):void 0}function dQ(){const n=V5();return n?n.getEmbedDefinitions():[]}const G5=On(function({onClose:e}){const t=te(),r=lt(),o=n_(),[s,i]=C.useState(null),[a,c]=C.useState(""),[u,h]=C.useState(null),[f,g]=C.useState(!1),y=C.useRef(-1),v=dQ(),S=c_();return p.jsxs(p.Fragment,{children:[p.jsxs(vm,{children:[p.jsx(Sm,{children:s?`${r("embed-dialog.title")} — ${s.title}`:r("embed-dialog.title")}),p.jsx(xm,{})]}),s?p.jsxs(p.Fragment,{children:[p.jsxs($d,{className:"tlui-embed-dialog__enter",children:[p.jsx(wm,{className:"tlui-embed-dialog__input",label:"embed-dialog.url",placeholder:"https://example.com",autoFocus:!0,onValueChange:w=>{c(w);const b=S(w);h(b&&b.definition.type===s.type?b:null),g(!1),clearTimeout(y.current),y.current=t.timers.setTimeout(()=>g(!b),320)}}),a===""?p.jsxs("div",{className:"tlui-embed-dialog__instruction",children:[p.jsx("span",{children:r("embed-dialog.instruction")})," ",s.instructionLink&&p.jsxs("a",{target:"_blank",rel:"noopener noreferrer",href:s.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",p.jsx($s,{icon:"external-link",small:!0})]})]}):p.jsx("div",{className:"tlui-embed-dialog__warning",children:f?r("embed-dialog.invalid-url"):" "})]}),p.jsxs(a_,{className:"tlui-dialog__footer__actions",children:[p.jsx($e,{type:"normal",onClick:()=>{i(null),h(null),c("")},children:p.jsx(an,{children:r("embed-dialog.back")})}),p.jsx("div",{className:"tlui-embed__spacer"}),p.jsx($e,{type:"normal",onClick:e,children:p.jsx(an,{children:r("embed-dialog.cancel")})}),p.jsx($e,{type:"primary",disabled:!u,onClick:()=>{u&&(t.putExternalContent({type:"embed",url:a,point:t.getViewportPageBounds().center,embed:u.definition}),e())},children:p.jsx(an,{children:r("embed-dialog.create")})})]})]}):p.jsx(p.Fragment,{children:p.jsx($d,{className:"tlui-embed-dialog__list",children:v.map(w=>{const b=cQ(w.type)?o.embedIcons[w.type]:uQ(w)?w.icon:void 0;return p.jsxs($e,{type:"menu",onClick:()=>i(w),children:[p.jsx(an,{children:w.title}),b&&p.jsx("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${b})`}})]},w.type)})})})]})});async function hQ(n,e,t){const r=Ze(e.map(a=>{const c=n.getShape(a);if(!(!c||n.getShapeUtil(c.type).toSvg===void 0))return c}));if(r.length===0)return;if(r.length===1){const a=r[0];if(!a||n.isShapeOfType(a,"image"))return}const o=[];if(t!==void 0){const a=r.map(c=>({shape:c,bounds:n.getShapeMaskedPageBounds(c).clone().expandBy(t)}));for(let c=0;c<a.length;c++){const u=a[c];if(c===0){o[0]={shapes:[u.shape],bounds:u.bounds};continue}let h=!1;for(const f of o)if(f.bounds.includes(u.bounds)){f.shapes.push(u.shape),f.bounds.expand(u.bounds),h=!0;break}h||o.push({shapes:[u.shape],bounds:u.bounds})}}else{const a=xe.Common(r.map(c=>n.getShapeMaskedPageBounds(c)));o.push({shapes:r,bounds:a})}const s=n.options.flattenImageBoundsPadding;for(const a of o){t!==void 0&&a.bounds.expandBy(-t);const c=await n.getSvgString(a.shapes,{padding:s});if(!(c!=null&&c.svg))continue;const u=new Blob([c.svg],{type:"image/svg+xml"}),h=await n.getAssetForExternalContent({type:"file",file:new File([u],"asset.svg",{type:"image/svg+xml"})});h&&(a.asset=h)}const i=[];return As(()=>{for(const a of o){const{asset:c,bounds:u,shapes:h}=a;if(!c)continue;const f=n.findCommonAncestor(h)??n.getCurrentPageId();if(!f)continue;let g="a1";for(const b of h)if(b.parentId===f){b.index>g&&(g=b.index);break}let y,v,S;if(Tr(f)){const b=n.getShape(f);if(!b)continue;const _=n.getPointInShapeSpace(b,{x:u.x,y:u.y});S=n.getShapePageTransform(f).rotation(),_.sub(new P(s,s).rot(-S)),y=_.x,v=_.y}else y=u.x-s,v=u.y-s,S=0;n.deleteShapes(h),n.createAssets([{...c,id:c.id}]);const w=Ct();n.createShape({id:w,type:"image",index:g,parentId:f,x:y,y:v,rotation:-S,props:{assetId:c.id,w:u.w+s*2,h:u.h+s*2}}),i.push(w)}}),i}function bm(){const n=Ia();return(n==null?void 0:n.store.props.collaboration)!==void 0}function pQ(){const n=Ia();return re("sync status",()=>{var e;return(e=n==null?void 0:n.store.props.collaboration)!=null&&e.status?n.store.props.collaboration.status.get():null},[n])}const ux=[0,389,436,476,580,640,840,1023];var en=(n=>(n[n.ZERO=0]="ZERO",n[n.MOBILE_XXS=1]="MOBILE_XXS",n[n.MOBILE_XS=2]="MOBILE_XS",n[n.MOBILE_SM=3]="MOBILE_SM",n[n.MOBILE=4]="MOBILE",n[n.TABLET_SM=5]="TABLET_SM",n[n.TABLET=6]="TABLET",n[n.DESKTOP=7]="DESKTOP",n))(en||{});const q5=at.createContext(null);function fQ({forceMobile:n=!1,children:e}){const t=Ia(),r=re("breakpoint",()=>{const{width:o}=(t==null?void 0:t.getViewportScreenBounds())??{width:window.innerWidth},s=n?en.MOBILE_SM:ux.length-1;for(let i=0;i<s;i++)if(o>ux[i]&&o<=ux[i+1])return i;return s},[t]);return p.jsx(q5.Provider,{value:r,children:e})}function hr(){const n=C.useContext(q5);if(n===null)throw new Error("useBreakpoint must be used inside of the <BreakpointProvider /> component");return n}const Y5=C.createContext(null);function gQ({context:n,children:e}){const t=Ln(),r=Gb("dialogs",[]),o=C.useMemo(()=>({dialogs:r,addDialog(s){const i=s.id??bt();return r.update(a=>[...a.filter(c=>c.id!==s.id),{...s,id:i}]),t("open-menu",{source:"dialog",id:i}),Go.addOpenMenu(i,n),i},removeDialog(s){var a;const i=r.get().find(c=>c.id===s);return i&&((a=i.onClose)==null||a.call(i),t("close-menu",{source:"dialog",id:s}),Go.deleteOpenMenu(s,n),r.update(c=>c.filter(u=>u!==i))),s},clearDialogs(){const s=r.get();s.length!==0&&(s.forEach(i=>{var a;(a=i.onClose)==null||a.call(i),t("close-menu",{source:"dialog",id:i.id}),Go.deleteOpenMenu(i.id,n)}),r.set([]))}}),[t,r,n]);return p.jsx(Y5.Provider,{value:o,children:e})}function ph(){const n=C.useContext(Y5);if(!n)throw new Error("useDialogs must be used within a DialogsProvider");return n}var mQ="VisuallyHidden",u_=C.forwardRef((n,e)=>p.jsx(dt.span,{...n,ref:e,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...n.style}}));u_.displayName=mQ;var d_="ToastProvider",[h_,yQ,vQ]=cm("Toast"),[X5,sle]=Ks("Toast",[vQ]),[SQ,_m]=X5(d_),Z5=n=>{const{__scopeToast:e,label:t="Notification",duration:r=5e3,swipeDirection:o="right",swipeThreshold:s=50,children:i}=n,[a,c]=C.useState(null),[u,h]=C.useState(0),f=C.useRef(!1),g=C.useRef(!1);return t.trim()||console.error(`Invalid prop \`label\` supplied to \`${d_}\`. Expected non-empty \`string\`.`),p.jsx(h_.Provider,{scope:e,children:p.jsx(SQ,{scope:e,label:t,duration:r,swipeDirection:o,swipeThreshold:s,toastCount:u,viewport:a,onViewportChange:c,onToastAdd:C.useCallback(()=>h(y=>y+1),[]),onToastRemove:C.useCallback(()=>h(y=>y-1),[]),isFocusedToastEscapeKeyDownRef:f,isClosePausedRef:g,children:i})})};Z5.displayName=d_;var Q5="ToastViewport",xQ=["F8"],Ow="toast.viewportPause",Dw="toast.viewportResume",J5=C.forwardRef((n,e)=>{const{__scopeToast:t,hotkey:r=xQ,label:o="Notifications ({hotkey})",...s}=n,i=_m(Q5,t),a=yQ(t),c=C.useRef(null),u=C.useRef(null),h=C.useRef(null),f=C.useRef(null),g=Lt(e,f,i.onViewportChange),y=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),v=i.toastCount>0;C.useEffect(()=>{const w=b=>{var T;r.every(E=>b[E]||b.code===E)&&((T=f.current)==null||T.focus())};return document.addEventListener("keydown",w),()=>document.removeEventListener("keydown",w)},[r]),C.useEffect(()=>{const w=c.current,b=f.current;if(v&&w&&b){const _=()=>{if(!i.isClosePausedRef.current){const A=new CustomEvent(Ow);b.dispatchEvent(A),i.isClosePausedRef.current=!0}},T=()=>{if(i.isClosePausedRef.current){const A=new CustomEvent(Dw);b.dispatchEvent(A),i.isClosePausedRef.current=!1}},E=A=>{!w.contains(A.relatedTarget)&&T()},M=()=>{w.contains(document.activeElement)||T()};return w.addEventListener("focusin",_),w.addEventListener("focusout",E),w.addEventListener("pointermove",_),w.addEventListener("pointerleave",M),window.addEventListener("blur",_),window.addEventListener("focus",T),()=>{w.removeEventListener("focusin",_),w.removeEventListener("focusout",E),w.removeEventListener("pointermove",_),w.removeEventListener("pointerleave",M),window.removeEventListener("blur",_),window.removeEventListener("focus",T)}}},[v,i.isClosePausedRef]);const S=C.useCallback(({tabbingDirection:w})=>{const _=a().map(T=>{const E=T.ref.current,M=[E,...RQ(E)];return w==="forwards"?M:M.reverse()});return(w==="forwards"?_.reverse():_).flat()},[a]);return C.useEffect(()=>{const w=f.current;if(w){const b=_=>{var M,A,R;const T=_.altKey||_.ctrlKey||_.metaKey;if(_.key==="Tab"&&!T){const L=document.activeElement,K=_.shiftKey;if(_.target===w&&K){(M=u.current)==null||M.focus();return}const V=S({tabbingDirection:K?"backwards":"forwards"}),F=V.findIndex($=>$===L);dx(V.slice(F+1))?_.preventDefault():K?(A=u.current)==null||A.focus():(R=h.current)==null||R.focus()}};return w.addEventListener("keydown",b),()=>w.removeEventListener("keydown",b)}},[a,S]),p.jsxs(Nq,{ref:c,role:"region","aria-label":o.replace("{hotkey}",y),tabIndex:-1,style:{pointerEvents:v?void 0:"none"},children:[v&&p.jsx(Lw,{ref:u,onFocusFromOutsideViewport:()=>{const w=S({tabbingDirection:"forwards"});dx(w)}}),p.jsx(h_.Slot,{scope:t,children:p.jsx(dt.ol,{tabIndex:-1,...s,ref:g})}),v&&p.jsx(Lw,{ref:h,onFocusFromOutsideViewport:()=>{const w=S({tabbingDirection:"backwards"});dx(w)}})]})});J5.displayName=Q5;var eF="ToastFocusProxy",Lw=C.forwardRef((n,e)=>{const{__scopeToast:t,onFocusFromOutsideViewport:r,...o}=n,s=_m(eF,t);return p.jsx(u_,{"aria-hidden":!0,tabIndex:0,...o,ref:e,style:{position:"fixed"},onFocus:i=>{var u;const a=i.relatedTarget;!((u=s.viewport)!=null&&u.contains(a))&&r()}})});Lw.displayName=eF;var Pm="Toast",wQ="toast.swipeStart",bQ="toast.swipeMove",_Q="toast.swipeCancel",PQ="toast.swipeEnd",tF=C.forwardRef((n,e)=>{const{forceMount:t,open:r,defaultOpen:o,onOpenChange:s,...i}=n,[a=!0,c]=Ta({prop:r,defaultProp:o,onChange:s});return p.jsx(ss,{present:t||a,children:p.jsx(EQ,{open:a,...i,ref:e,onClose:()=>c(!1),onPause:Rn(n.onPause),onResume:Rn(n.onResume),onSwipeStart:Ae(n.onSwipeStart,u=>{u.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:Ae(n.onSwipeMove,u=>{const{x:h,y:f}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","move"),u.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${h}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${f}px`)}),onSwipeCancel:Ae(n.onSwipeCancel,u=>{u.currentTarget.setAttribute("data-swipe","cancel"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:Ae(n.onSwipeEnd,u=>{const{x:h,y:f}=u.detail.delta;u.currentTarget.setAttribute("data-swipe","end"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),u.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),u.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${h}px`),u.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${f}px`),c(!1)})})})});tF.displayName=Pm;var[CQ,IQ]=X5(Pm,{onClose(){}}),EQ=C.forwardRef((n,e)=>{const{__scopeToast:t,type:r="foreground",duration:o,open:s,onClose:i,onEscapeKeyDown:a,onPause:c,onResume:u,onSwipeStart:h,onSwipeMove:f,onSwipeCancel:g,onSwipeEnd:y,...v}=n,S=_m(Pm,t),[w,b]=C.useState(null),_=Lt(e,$=>b($)),T=C.useRef(null),E=C.useRef(null),M=o||S.duration,A=C.useRef(0),R=C.useRef(M),L=C.useRef(0),{onToastAdd:K,onToastRemove:D}=S,U=Rn(()=>{var H;(w==null?void 0:w.contains(document.activeElement))&&((H=S.viewport)==null||H.focus()),i()}),V=C.useCallback($=>{!$||$===1/0||(window.clearTimeout(L.current),A.current=new Date().getTime(),L.current=window.setTimeout(U,$))},[U]);C.useEffect(()=>{const $=S.viewport;if($){const H=()=>{V(R.current),u==null||u()},Z=()=>{const G=new Date().getTime()-A.current;R.current=R.current-G,window.clearTimeout(L.current),c==null||c()};return $.addEventListener(Ow,Z),$.addEventListener(Dw,H),()=>{$.removeEventListener(Ow,Z),$.removeEventListener(Dw,H)}}},[S.viewport,M,c,u,V]),C.useEffect(()=>{s&&!S.isClosePausedRef.current&&V(M)},[s,M,S.isClosePausedRef,V]),C.useEffect(()=>(K(),()=>D()),[K,D]);const F=C.useMemo(()=>w?lF(w):null,[w]);return S.viewport?p.jsxs(p.Fragment,{children:[F&&p.jsx(kQ,{__scopeToast:t,role:"status","aria-live":r==="foreground"?"assertive":"polite","aria-atomic":!0,children:F}),p.jsx(CQ,{scope:t,onClose:U,children:Ei.createPortal(p.jsx(h_.ItemSlot,{scope:t,children:p.jsx(Fq,{asChild:!0,onEscapeKeyDown:Ae(a,()=>{S.isFocusedToastEscapeKeyDownRef.current||U(),S.isFocusedToastEscapeKeyDownRef.current=!1}),children:p.jsx(dt.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":s?"open":"closed","data-swipe-direction":S.swipeDirection,...v,ref:_,style:{userSelect:"none",touchAction:"none",...n.style},onKeyDown:Ae(n.onKeyDown,$=>{$.key==="Escape"&&(a==null||a($.nativeEvent),$.nativeEvent.defaultPrevented||(S.isFocusedToastEscapeKeyDownRef.current=!0,U()))}),onPointerDown:Ae(n.onPointerDown,$=>{$.button===0&&(T.current={x:$.clientX,y:$.clientY})}),onPointerMove:Ae(n.onPointerMove,$=>{if(!T.current)return;const H=$.clientX-T.current.x,Z=$.clientY-T.current.y,G=!!E.current,q=["left","right"].includes(S.swipeDirection),Q=["left","up"].includes(S.swipeDirection)?Math.min:Math.max,ae=q?Q(0,H):0,B=q?0:Q(0,Z),oe=$.pointerType==="touch"?10:2,pe={x:ae,y:B},_e={originalEvent:$,delta:pe};G?(E.current=pe,Vp(bQ,f,_e,{discrete:!1})):_T(pe,S.swipeDirection,oe)?(E.current=pe,Vp(wQ,h,_e,{discrete:!1}),$.target.setPointerCapture($.pointerId)):(Math.abs(H)>oe||Math.abs(Z)>oe)&&(T.current=null)}),onPointerUp:Ae(n.onPointerUp,$=>{const H=E.current,Z=$.target;if(Z.hasPointerCapture($.pointerId)&&Z.releasePointerCapture($.pointerId),E.current=null,T.current=null,H){const G=$.currentTarget,q={originalEvent:$,delta:H};_T(H,S.swipeDirection,S.swipeThreshold)?Vp(PQ,y,q,{discrete:!0}):Vp(_Q,g,q,{discrete:!0}),G.addEventListener("click",Q=>Q.preventDefault(),{once:!0})}})})})}),S.viewport)})]}):null}),kQ=n=>{const{__scopeToast:e,children:t,...r}=n,o=_m(Pm,e),[s,i]=C.useState(!1),[a,c]=C.useState(!1);return AQ(()=>i(!0)),C.useEffect(()=>{const u=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(u)},[]),a?null:p.jsx(ch,{asChild:!0,children:p.jsx(u_,{...r,children:s&&p.jsxs(p.Fragment,{children:[o.label," ",t]})})})},TQ="ToastTitle",nF=C.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return p.jsx(dt.div,{...r,ref:e})});nF.displayName=TQ;var MQ="ToastDescription",rF=C.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n;return p.jsx(dt.div,{...r,ref:e})});rF.displayName=MQ;var oF="ToastAction",sF=C.forwardRef((n,e)=>{const{altText:t,...r}=n;return t.trim()?p.jsx(aF,{altText:t,asChild:!0,children:p.jsx(p_,{...r,ref:e})}):(console.error(`Invalid prop \`altText\` supplied to \`${oF}\`. Expected non-empty \`string\`.`),null)});sF.displayName=oF;var iF="ToastClose",p_=C.forwardRef((n,e)=>{const{__scopeToast:t,...r}=n,o=IQ(iF,t);return p.jsx(aF,{asChild:!0,children:p.jsx(dt.button,{type:"button",...r,ref:e,onClick:Ae(n.onClick,o.onClose)})})});p_.displayName=iF;var aF=C.forwardRef((n,e)=>{const{__scopeToast:t,altText:r,...o}=n;return p.jsx(dt.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0,...o,ref:e})});function lF(n){const e=[];return Array.from(n.childNodes).forEach(r=>{if(r.nodeType===r.TEXT_NODE&&r.textContent&&e.push(r.textContent),jQ(r)){const o=r.ariaHidden||r.hidden||r.style.display==="none",s=r.dataset.radixToastAnnounceExclude==="";if(!o)if(s){const i=r.dataset.radixToastAnnounceAlt;i&&e.push(i)}else e.push(...lF(r))}}),e}function Vp(n,e,t,{discrete:r}){const o=t.originalEvent.currentTarget,s=new CustomEvent(n,{bubbles:!0,cancelable:!0,detail:t});e&&o.addEventListener(n,e,{once:!0}),r?O1(o,s):o.dispatchEvent(s)}var _T=(n,e,t=0)=>{const r=Math.abs(n.x),o=Math.abs(n.y),s=r>o;return e==="left"||e==="right"?s&&r>t:!s&&o>t};function AQ(n=()=>{}){const e=Rn(n);xa(()=>{let t=0,r=0;return t=window.requestAnimationFrame(()=>r=window.requestAnimationFrame(e)),()=>{window.cancelAnimationFrame(t),window.cancelAnimationFrame(r)}},[e])}function jQ(n){return n.nodeType===n.ELEMENT_NODE}function RQ(n){const e=[],t=document.createTreeWalker(n,NodeFilter.SHOW_ELEMENT,{acceptNode:r=>{const o=r.tagName==="INPUT"&&r.type==="hidden";return r.disabled||r.hidden||o?NodeFilter.FILTER_SKIP:r.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;t.nextNode();)e.push(t.currentNode);return e}function dx(n){const e=document.activeElement;return n.some(t=>t===e?!0:(t.focus(),document.activeElement!==e))}var OQ=tF,DQ=nF,LQ=rF,FQ=sF,PT=p_;const cF=C.createContext(null);function NQ({children:n}){const e=Gb("toasts",[]),t=C.useMemo(()=>({toasts:e,addToast(r){const o=r.id??bt();return e.update(s=>[...s.filter(i=>i.id!==r.id),{...r,id:o}]),o},removeToast(r){return e.update(o=>o.filter(s=>s.id!==r)),r},clearToasts(){e.set([])}}),[e]);return p.jsx(Z5,{children:p.jsx(cF.Provider,{value:t,children:n})})}function ki(){const n=C.useContext(cF);if(!n)throw new Error("useToasts must be used within a ToastsProvider");return n}var vf={exports:{}};vf.exports;var CT;function $Q(){return CT||(CT=1,function(n){var e=function(){var t=String.fromCharCode,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",s={};function i(c,u){if(!s[c]){s[c]={};for(var h=0;h<c.length;h++)s[c][c.charAt(h)]=h}return s[c][u]}var a={compressToBase64:function(c){if(c==null)return"";var u=a._compress(c,6,function(h){return r.charAt(h)});switch(u.length%4){default:case 0:return u;case 1:return u+"===";case 2:return u+"==";case 3:return u+"="}},decompressFromBase64:function(c){return c==null?"":c==""?null:a._decompress(c.length,32,function(u){return i(r,c.charAt(u))})},compressToUTF16:function(c){return c==null?"":a._compress(c,15,function(u){return t(u+32)})+" "},decompressFromUTF16:function(c){return c==null?"":c==""?null:a._decompress(c.length,16384,function(u){return c.charCodeAt(u)-32})},compressToUint8Array:function(c){for(var u=a.compress(c),h=new Uint8Array(u.length*2),f=0,g=u.length;f<g;f++){var y=u.charCodeAt(f);h[f*2]=y>>>8,h[f*2+1]=y%256}return h},decompressFromUint8Array:function(c){if(c==null)return a.decompress(c);for(var u=new Array(c.length/2),h=0,f=u.length;h<f;h++)u[h]=c[h*2]*256+c[h*2+1];var g=[];return u.forEach(function(y){g.push(t(y))}),a.decompress(g.join(""))},compressToEncodedURIComponent:function(c){return c==null?"":a._compress(c,6,function(u){return o.charAt(u)})},decompressFromEncodedURIComponent:function(c){return c==null?"":c==""?null:(c=c.replace(/ /g,"+"),a._decompress(c.length,32,function(u){return i(o,c.charAt(u))}))},compress:function(c){return a._compress(c,16,function(u){return t(u)})},_compress:function(c,u,h){if(c==null)return"";var f,g,y={},v={},S="",w="",b="",_=2,T=3,E=2,M=[],A=0,R=0,L;for(L=0;L<c.length;L+=1)if(S=c.charAt(L),Object.prototype.hasOwnProperty.call(y,S)||(y[S]=T++,v[S]=!0),w=b+S,Object.prototype.hasOwnProperty.call(y,w))b=w;else{if(Object.prototype.hasOwnProperty.call(v,b)){if(b.charCodeAt(0)<256){for(f=0;f<E;f++)A=A<<1,R==u-1?(R=0,M.push(h(A)),A=0):R++;for(g=b.charCodeAt(0),f=0;f<8;f++)A=A<<1|g&1,R==u-1?(R=0,M.push(h(A)),A=0):R++,g=g>>1}else{for(g=1,f=0;f<E;f++)A=A<<1|g,R==u-1?(R=0,M.push(h(A)),A=0):R++,g=0;for(g=b.charCodeAt(0),f=0;f<16;f++)A=A<<1|g&1,R==u-1?(R=0,M.push(h(A)),A=0):R++,g=g>>1}_--,_==0&&(_=Math.pow(2,E),E++),delete v[b]}else for(g=y[b],f=0;f<E;f++)A=A<<1|g&1,R==u-1?(R=0,M.push(h(A)),A=0):R++,g=g>>1;_--,_==0&&(_=Math.pow(2,E),E++),y[w]=T++,b=String(S)}if(b!==""){if(Object.prototype.hasOwnProperty.call(v,b)){if(b.charCodeAt(0)<256){for(f=0;f<E;f++)A=A<<1,R==u-1?(R=0,M.push(h(A)),A=0):R++;for(g=b.charCodeAt(0),f=0;f<8;f++)A=A<<1|g&1,R==u-1?(R=0,M.push(h(A)),A=0):R++,g=g>>1}else{for(g=1,f=0;f<E;f++)A=A<<1|g,R==u-1?(R=0,M.push(h(A)),A=0):R++,g=0;for(g=b.charCodeAt(0),f=0;f<16;f++)A=A<<1|g&1,R==u-1?(R=0,M.push(h(A)),A=0):R++,g=g>>1}_--,_==0&&(_=Math.pow(2,E),E++),delete v[b]}else for(g=y[b],f=0;f<E;f++)A=A<<1|g&1,R==u-1?(R=0,M.push(h(A)),A=0):R++,g=g>>1;_--,_==0&&(_=Math.pow(2,E),E++)}for(g=2,f=0;f<E;f++)A=A<<1|g&1,R==u-1?(R=0,M.push(h(A)),A=0):R++,g=g>>1;for(;;)if(A=A<<1,R==u-1){M.push(h(A));break}else R++;return M.join("")},decompress:function(c){return c==null?"":c==""?null:a._decompress(c.length,32768,function(u){return c.charCodeAt(u)})},_decompress:function(c,u,h){var f=[],g=4,y=4,v=3,S="",w=[],b,_,T,E,M,A,R,L={val:h(0),position:u,index:1};for(b=0;b<3;b+=1)f[b]=b;for(T=0,M=Math.pow(2,2),A=1;A!=M;)E=L.val&L.position,L.position>>=1,L.position==0&&(L.position=u,L.val=h(L.index++)),T|=(E>0?1:0)*A,A<<=1;switch(T){case 0:for(T=0,M=Math.pow(2,8),A=1;A!=M;)E=L.val&L.position,L.position>>=1,L.position==0&&(L.position=u,L.val=h(L.index++)),T|=(E>0?1:0)*A,A<<=1;R=t(T);break;case 1:for(T=0,M=Math.pow(2,16),A=1;A!=M;)E=L.val&L.position,L.position>>=1,L.position==0&&(L.position=u,L.val=h(L.index++)),T|=(E>0?1:0)*A,A<<=1;R=t(T);break;case 2:return""}for(f[3]=R,_=R,w.push(R);;){if(L.index>c)return"";for(T=0,M=Math.pow(2,v),A=1;A!=M;)E=L.val&L.position,L.position>>=1,L.position==0&&(L.position=u,L.val=h(L.index++)),T|=(E>0?1:0)*A,A<<=1;switch(R=T){case 0:for(T=0,M=Math.pow(2,8),A=1;A!=M;)E=L.val&L.position,L.position>>=1,L.position==0&&(L.position=u,L.val=h(L.index++)),T|=(E>0?1:0)*A,A<<=1;f[y++]=t(T),R=y-1,g--;break;case 1:for(T=0,M=Math.pow(2,16),A=1;A!=M;)E=L.val&L.position,L.position>>=1,L.position==0&&(L.position=u,L.val=h(L.index++)),T|=(E>0?1:0)*A,A<<=1;f[y++]=t(T),R=y-1,g--;break;case 2:return w.join("")}if(g==0&&(g=Math.pow(2,v),v++),f[R])S=f[R];else if(R===y)S=_+_.charAt(0);else return null;w.push(S),f[y++]=_+S.charAt(0),g--,_=S,g==0&&(g=Math.pow(2,v),v++)}}};return a}();n!=null?n.exports=e:typeof angular<"u"&&angular!=null&&angular.module("LZString",[]).factory("LZString",function(){return e})}(vf)),vf.exports}var zQ=$Q();const uF=wa(zQ),f_="web image/vnd.tldraw+png",BQ={"image/png":f_},UQ={[f_]:"image/png"};function HQ(n){return Yn(BQ,n)??null}function KQ(n){return Yn(UQ,n)??n}function WQ(n){return typeof ClipboardItem<"u"&&"supports"in ClipboardItem&&ClipboardItem.supports(n)}function VQ(n){const e=Object.entries(n);for(const[t,r]of e)r.catch(o=>console.error(o));return navigator.clipboard.write([new ClipboardItem(n)]).catch(t=>(console.error(t),Promise.all(e.map(async([r,o])=>[r,await o])).then(r=>{const o=Eb(r);return navigator.clipboard.write([new ClipboardItem(o)])})))}async function GQ(n,e,t){var b,_,T;const{elements:r,files:o}=e,s={shapes:[],bindings:[],rootShapeIds:[],assets:[],schema:n.store.schema.serialize()},i=new Map,a=new Map,c=n.getCurrentPageId(),u=new Map,h=[],f=new Set;r.forEach(E=>{if(u.set(E.id,Ct()),E.boundElements!==null)for(const M of E.boundElements)M.type==="text"&&f.add(M.id)});let g=cA;for(const E of r){if(f.has(E.id))continue;const M=u.get(E.id),A={id:M,typeName:"shape",parentId:c,index:g,x:E.x,y:E.y,rotation:0,isLocked:E.locked,opacity:qQ(E.opacity),meta:{}};switch(E.angle!==0&&a.set(M,E.angle),E.groupIds&&E.groupIds.length>0?i.has(E.groupIds[0])?(b=i.get(E.groupIds[0]))==null||b.push(M):i.set(E.groupIds[0],[M]):h.push(M),E.type){case"rectangle":case"ellipse":case"diamond":{let R="",L="middle";if(E.boundElements!==null){for(const D of E.boundElements)if(D.type==="text"){const U=r.find(V=>V.id===D.id);U&&(R=U.text,L=tJ[U.textAlign])}}const K=E.backgroundColor==="transparent"?E.strokeColor:E.backgroundColor;s.shapes.push({...A,type:"geo",props:{geo:E.type,url:E.link??"",w:E.width,h:E.height,size:Gp[E.strokeWidth]??"draw",color:td[K]??"black",text:R,align:L,dash:qp(E),fill:oJ(E)}});break}case"freedraw":{s.shapes.push({...A,type:"draw",props:{dash:qp(E),size:Gp[E.strokeWidth],color:td[E.strokeColor]??"black",segments:[{type:"free",points:E.points.map(([R,L,K=.5])=>({x:R,y:L,z:K}))}]}});break}case"line":{if(E.points.slice().length<2)break;const L=Rd(E.points.length);s.shapes.push({...A,type:"line",props:{dash:qp(E),size:Gp[E.strokeWidth],color:td[E.strokeColor]??"black",spline:E.roundness?"cubic":"line",points:{...Object.fromEntries(E.points.map(([K,D],U)=>{const V=L[U];return[V,{id:V,index:V,x:K,y:D}]}))}}});break}case"arrow":{let R="";if(E.boundElements!==null){for(const V of E.boundElements)if(V.type==="text"){const F=r.find($=>$.id===V.id);F&&(R=F.text)}}const L=E.points[0],K=E.points[E.points.length-1],D=u.get((_=E.startBinding)==null?void 0:_.elementId),U=u.get((T=E.endBinding)==null?void 0:T.elementId);s.shapes.push({...A,type:"arrow",props:{text:R,bend:rJ(E,L,K),dash:qp(E),size:Gp[E.strokeWidth]??"m",color:td[E.strokeColor]??"black",start:{x:L[0],y:L[1]},end:{x:K[0],y:K[1]},arrowheadEnd:IT[E.endArrowhead]??"none",arrowheadStart:IT[E.startArrowhead]??"none"}}),D&&s.bindings.push({id:al(),typeName:"binding",type:"arrow",fromId:M,toId:D,props:{terminal:"start",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}}),U&&s.bindings.push({id:al(),typeName:"binding",type:"arrow",fromId:M,toId:U,props:{terminal:"end",normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1},meta:{}});break}case"text":{const{size:R,scale:L}=XQ(E.fontSize);s.shapes.push({...A,type:"text",props:{size:R,scale:L,font:ZQ[E.fontFamily]??"draw",color:td[E.strokeColor]??"black",text:E.text,textAlign:nJ[E.textAlign]}});break}case"image":{const R=o[E.fileId];if(!R)break;const L=sa.createId();s.assets.push({id:L,typeName:"asset",type:"image",props:{w:E.width,h:E.height,fileSize:R.size,name:E.id??"Untitled",isAnimated:!1,mimeType:R.mimeType,src:R.dataURL},meta:{}}),s.shapes.push({...A,type:"image",props:{w:E.width,h:E.height,assetId:L}})}}g=Is(g)}const y=t??(n.inputs.shiftKey?n.inputs.currentPagePoint:void 0);n.markHistoryStoppingPoint("paste"),n.putContentOntoCurrentPage(s,{point:y,select:!1,preserveIds:!0});for(const E of i.values())if(E.length>1){n.groupShapes(E);const M=n.getShape(E[0]);M!=null&&M.parentId&&Tr(M.parentId)&&h.push(M.parentId)}for(const[E,M]of a)n.select(E),n.rotateShapesBy([E],M);const v=Ze(h.map(E=>n.getShape(E))),S=xe.Common(v.map(E=>n.getShapePageBounds(E))),w=n.getViewportPageBounds().center;n.updateShapes(v.map(E=>{const M={x:(E.x??0)-(S.x+S.w/2),y:(E.y??0)-(S.y+S.h/2)};return{id:E.id,type:E.type,x:w.x+M.x,y:w.y+M.y}})),n.setSelectedShapes(h)}const qQ=n=>{const e=n/100;return e<.2?.1:e<.4?.25:e<.6?.5:e<.8?.75:1},Gp={1:"s",2:"m",3:"l",4:"xl"},YQ={16:"s",20:"m",28:"l",36:"xl"};function XQ(n){const e=YQ[n];return e?{size:e,scale:1}:n<16?{size:"s",scale:n/16}:n>36?{size:"xl",scale:n/36}:{size:"m",scale:1}}const ZQ={1:"draw",2:"sans",3:"mono"},QQ={gray:["#f8f9fa","#e9ecef","#ced4da","#868e96","#343a40"],red:["#fff5f5","#ffc9c9","#ff8787","#fa5252","#e03131"],pink:["#fff0f6","#fcc2d7","#f783ac","#e64980","#c2255c"],grape:["#f8f0fc","#eebefa","#da77f2","#be4bdb","#9c36b5"],violet:["#f3f0ff","#d0bfff","#9775fa","#7950f2","#6741d9"],indigo:["#edf2ff","#bac8ff","#748ffc","#4c6ef5","#3b5bdb"],blue:["#e7f5ff","#a5d8ff","#4dabf7","#228be6","#1971c2"],cyan:["#e3fafc","#99e9f2","#3bc9db","#15aabf","#0c8599"],teal:["#e6fcf5","#96f2d7","#38d9a9","#12b886","#099268"],green:["#ebfbee","#b2f2bb","#69db7c","#40c057","#2f9e44"],lime:["#f4fce3","#d8f5a2","#a9e34b","#82c91e","#66a80f"],yellow:["#fff9db","#ffec99","#ffd43b","#fab005","#f08c00"],orange:["#fff4e6","#ffd8a8","#ffa94d","#fd7e14","#e8590c"]};function ws(n,e,t){const r=[0,1,2,3,4].map(o=>QQ[n][o]);return Object.fromEntries(r.map((o,s)=>[o,s<3?e:t]))}const td={...ws("gray","grey","black"),...ws("red","light-red","red"),...ws("pink","light-red","red"),...ws("grape","light-violet","violet"),...ws("blue","light-blue","blue"),...ws("cyan","light-blue","blue"),...ws("teal","light-green","green"),...ws("green","light-green","green"),...ws("yellow","yellow","orange"),...ws("orange","yellow","orange"),"#ffffff":"white","#000000":"black"},JQ={solid:"draw",dashed:"dashed",dotted:"dotted"},eJ={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},tJ={left:"start",center:"middle",right:"end"},nJ={left:"start",center:"middle",right:"end"},IT={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function rJ(n,e,t){let r=0;if(n.points.length>2){const o=new P(e[0],e[1]),s=new P(t[0],t[1]),i=new P(n.points[1][0],n.points[1][1]),a=P.Sub(s,o),c=P.Per(a),u=P.Med(s,o),h=P.Sub(u,c),f=P.Add(u,c),g=P.NearestPointOnLineSegment(h,f,i,!1);r=P.Dist(g,u),P.Clockwise(g,s,u)&&(r*=-1)}return r}const qp=n=>{let e=JQ[n.strokeStyle]??"draw";return e==="draw"&&n.roughness===0&&(e="solid"),e},oJ=n=>n.backgroundColor==="transparent"?"none":eJ[n.fillStyle]??"solid";async function sJ(n,e,t,r){const o=e.map(s=>s instanceof File?s:new File([s],"tldrawFile",{type:s.type}));n.markHistoryStoppingPoint("paste"),await n.putExternalContent({type:"files",files:o,point:t,ignoreParent:!1,sources:r})}function iJ(n,e,t){const r=n.getSelectionPageBounds();n.markHistoryStoppingPoint("paste"),n.putContentOntoCurrentPage(e,{point:t,select:!0});const o=n.getSelectionPageBounds();r&&o&&(r!=null&&r.collides(o))&&(n.updateInstanceState({isChangingStyle:!0}),n.timers.setTimeout(()=>{n.updateInstanceState({isChangingStyle:!1})},150))}async function Fw(n,e,t,r){return n.markHistoryStoppingPoint("paste"),await n.putExternalContent({type:"url",point:t,url:e,sources:r})}const aJ=[f_,"image/png","image/jpeg","image/webp","image/svg+xml"];function lJ(n){const e=document.implementation.createHTMLDocument("");return e.documentElement.innerHTML=n.trim(),e.body.textContent||e.body.innerText||""}const cJ=n=>{try{const e=new URL(n);return e.protocol==="http:"||e.protocol==="https:"}catch{return!1}},uJ=n=>{const e=n.split(/[\n\s]/);for(const t of e)try{const r=new URL(t);if(!(r.protocol==="http:"||r.protocol==="https:"))return}catch{return}return oR(e)},dJ=n=>/^<svg/.test(n),hJ=["input","select","textarea"];function hx(n){const{activeElement:e}=document;return n.menus.hasAnyOpenMenus()||e&&(e.getAttribute("contenteditable")||hJ.indexOf(e.tagName.toLowerCase())>-1)}const px=(n,e,t,r)=>{const o=uJ(e);if(o)for(const s of o)Fw(n,s,t);else cJ(e)?Fw(n,e,t):dJ(e)?(n.markHistoryStoppingPoint("paste"),n.putExternalContent({type:"svg-text",text:e,point:t,sources:r})):(n.markHistoryStoppingPoint("paste"),n.putExternalContent({type:"text",text:e,point:t,sources:r}))},pJ=async(n,e,t)=>{if(n.getEditingShapeId()!==null)return;if(!e)throw Error("No clipboard data");const r=[];for(const o of Object.values(e.items))switch(o.kind){case"file":{r.push({type:"file",source:new Promise(s=>s(o.getAsFile()))});break}case"string":{o.type==="text/html"?r.push({type:"html",source:new Promise(s=>o.getAsString(s))}):o.type==="text/plain"?r.push({type:"text",source:new Promise(s=>o.getAsString(s))}):r.push({type:o.type,source:new Promise(s=>o.getAsString(s))});break}}hF(n,r,t)},dF=async(n,e,t)=>{const r=[];for(const o of e){for(const s of aJ)if(o.types.includes(s)){const i=o.getType(s).then(a=>Yo.rewriteMimeType(a,KQ(s)));r.push({type:"blob",source:i});break}o.types.includes("text/html")&&r.push({type:"html",source:(async()=>{const s=await o.getType("text/html");return await Yo.blobToText(s)})()}),o.types.includes("text/uri-list")&&r.push({type:"url",source:(async()=>{const s=await o.getType("text/uri-list");return await Yo.blobToText(s)})()}),o.types.includes("text/plain")&&r.push({type:"text",source:(async()=>{const s=await o.getType("text/plain");return await Yo.blobToText(s)})()})}return await hF(n,r,t)};async function hF(n,e,t){const r=e.filter(s=>(s.type==="file"||s.type==="blob")&&s.source!==null);if(r.length){if(r.length>n.options.maxFilesAtOnce)throw Error("Too many files");const s=Ze(await Promise.all(r.map(i=>i.source)));return await sJ(n,s,t)}const o=await Promise.all(e.filter(s=>s.type!=="file").map(s=>new Promise(i=>{const a=s;if(a.type==="file"){i({type:"error",data:null,reason:"unexpected file"});return}a.source.then(c=>{var h;const u=(h=c.match(/<div data-tldraw[^>]*>(.*)<\/div>/))==null?void 0:h[1];if(u)try{const f=uF.decompressFromBase64(u);if(f===null){i({type:"error",data:f,reason:"found tldraw data comment but could not parse base64"});return}else{const g=JSON.parse(f);if(g.type!=="application/tldraw"&&i({type:"error",data:g,reason:`found tldraw data comment but JSON was of a different type: ${g.type}`}),typeof g.data=="string"){i({type:"error",data:g,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}i({type:"tldraw",data:g.data});return}}catch{i({type:"error",data:u,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if(a.type==="html"){i({type:"text",data:c,subtype:"html"});return}if(a.type==="url"){i({type:"text",data:c,subtype:"url"});return}try{const f=JSON.parse(c);if(f.type==="excalidraw/clipboard"){i({type:"excalidraw",data:f});return}else{i({type:"text",data:c,subtype:"json"});return}}catch{i({type:"text",data:c,subtype:"text"});return}}i({type:"error",data:c,reason:"unhandled case"})})})));for(const s of o)if(s.type==="tldraw"){iJ(n,s.data,t);return}for(const s of o)if(s.type==="excalidraw"){GQ(n,s.data,t);return}for(const s of o)if(s.type==="text"&&s.subtype==="html"){const a=new DOMParser().parseFromString(s.data,"text/html").querySelector("body");if(a&&Array.from(a.children).filter(u=>u.nodeType===1).length===1&&a.firstElementChild&&a.firstElementChild.tagName==="A"&&a.firstElementChild.hasAttribute("href")&&a.firstElementChild.getAttribute("href")!==""){const u=a.firstElementChild.getAttribute("href");px(n,u,t,o);return}if(!o.some(u=>u.type==="text"&&u.subtype!=="html")&&s.data.trim()){px(n,lJ(s.data),t,o);return}}for(const s of o)if(s.type==="text"&&s.subtype==="url"){Fw(n,s.data,t,o);return}for(const s of o)if(s.type==="text"&&s.subtype==="text"&&s.data.trim()){px(n,s.data,t,o);return}}const Sg=async n=>{var r;const e=await n.resolveAssetsInContent(n.getContentFromCurrentPage(n.getSelectedShapeIds()));if(!e){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}const t=uF.compressToBase64(JSON.stringify({type:"application/tldraw",kind:"content",data:e}));if(!(typeof navigator>"u")){const o=e.shapes.map(s=>n.getShapeUtil(s).getText(s)).filter(V8);if((r=navigator.clipboard)!=null&&r.write){const s=new Blob([`<div data-tldraw>${t}</div>`],{type:"text/html"});let i=o.join(" ");i===""&&(i=" "),navigator.clipboard.write([new ClipboardItem({"text/html":s,"text/plain":new Blob([i],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<div data-tldraw>${t}</div>`)}};function fJ(){const n=te(),e=Ln(),t=C.useCallback(async function(i){n.getSelectedShapeIds().length!==0&&(await Sg(n),e("copy",{source:i}))},[n,e]),r=C.useCallback(async function(i){n.getSelectedShapeIds().length!==0&&(await Sg(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:i}))},[n,e]),o=C.useCallback(async function(i,a,c){n.getEditingShapeId()===null&&(Array.isArray(i)&&i[0]instanceof ClipboardItem?(dF(n,i,c),e("paste",{source:"menu"})):navigator.clipboard.read().then(u=>{o(u,a,c)}))},[n,e]);return{copy:t,cut:r,paste:o}}function gJ(){const n=te(),e=Ln(),t=re("editor.isFocused",()=>n.getInstanceState().isFocused,[n]);C.useEffect(()=>{if(!t)return;const r=async c=>{n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||hx(n)||(et(c),await Sg(n),e("copy",{source:"kbd"}))};async function o(c){n.getSelectedShapeIds().length===0||n.getEditingShapeId()!==null||hx(n)||(et(c),await Sg(n),n.deleteShapes(n.getSelectedShapeIds()),e("cut",{source:"kbd"}))}let s=!1;const i=c=>{c.button===1&&(s=!0,n.timers.requestAnimationFrame(()=>{s=!1}))},a=c=>{var g;if(s){cn(c);return}if(n.getEditingShapeId()!==null||hx(n))return;let u,h=!1;n.inputs.shiftKey&&(h=!0),n.user.getIsPasteAtCursorMode()&&(h=!h),h&&(u=n.inputs.currentPagePoint);const f=()=>{c.clipboardData&&pJ(n,c.clipboardData,u)};(g=navigator.clipboard)!=null&&g.read?navigator.clipboard.read().then(y=>{Array.isArray(y)&&y[0]instanceof ClipboardItem&&dF(n,y,u)},()=>{f()}):f(),et(c),e("paste",{source:"kbd"})};return document.addEventListener("copy",r),document.addEventListener("cut",o),document.addEventListener("paste",a),document.addEventListener("pointerup",i),()=>{document.removeEventListener("copy",r),document.removeEventListener("cut",o),document.removeEventListener("paste",a),document.removeEventListener("pointerup",i)}},[n,e,t])}/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function mJ(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,o,s,i,a=[],c=!0,u=!1;try{if(s=(t=t.call(n)).next,e===0){if(Object(t)!==t)return;c=!1}else for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(h){u=!0,o=h}finally{try{if(!c&&t.return!=null&&(i=t.return(),Object(i)!==i))return}finally{if(u)throw o}}return a}}function ET(n,e){var t=Object.keys(n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(n);e&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),t.push.apply(t,r)}return t}function Yr(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?ET(Object(t),!0).forEach(function(r){yJ(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):ET(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function yJ(n,e,t){return e=IJ(e),e in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function vJ(n,e){if(n==null)return{};var t={},r=Object.keys(n),o,s;for(s=0;s<r.length;s++)o=r[s],!(e.indexOf(o)>=0)&&(t[o]=n[o]);return t}function SJ(n,e){if(n==null)return{};var t=vJ(n,e),r,o;if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);for(o=0;o<s.length;o++)r=s[o],!(e.indexOf(r)>=0)&&Object.prototype.propertyIsEnumerable.call(n,r)&&(t[r]=n[r])}return t}function kT(n,e){return wJ(n)||mJ(n,e)||pF(n,e)||PJ()}function Yp(n){return xJ(n)||bJ(n)||pF(n)||_J()}function xJ(n){if(Array.isArray(n))return Nw(n)}function wJ(n){if(Array.isArray(n))return n}function bJ(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function pF(n,e){if(n){if(typeof n=="string")return Nw(n,e);var t=Object.prototype.toString.call(n).slice(8,-1);if(t==="Object"&&n.constructor&&(t=n.constructor.name),t==="Map"||t==="Set")return Array.from(n);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Nw(n,e)}}function Nw(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=new Array(e);t<e;t++)r[t]=n[t];return r}function _J(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PJ(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function CJ(n,e){if(typeof n!="object"||n===null)return n;var t=n[Symbol.toPrimitive];if(t!==void 0){var r=t.call(n,e||"default");if(typeof r!="object")return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(n)}function IJ(n){var e=CJ(n,"string");return typeof e=="symbol"?e:String(e)}function _d(n){var e=n.sizes.shift(),t=Math.max(Math.ceil(e[0]),1),r=Math.max(Math.ceil(e[1]),1),o=[t-1,r-1,1,1],s=Date.now(),i=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope,a,c;i?(a=new OffscreenCanvas(1,1),c=new OffscreenCanvas(t,r)):(a=document.createElement("canvas"),a.width=1,a.height=1,c=document.createElement("canvas"),c.width=t,c.height=r);var u=a.getContext("2d"),h=c.getContext("2d");h&&(h.fillRect.apply(h,o),u.drawImage(c,t-1,r-1,1,1,0,0,1,1));var f=u&&u.getImageData(0,0,1,1).data[3]!==0,g=Date.now()-s;return[a,c].forEach(function(y){y.height=0,y.width=0}),i?(postMessage({width:t,height:r,benchmark:g,isTestPass:f}),!f&&n.sizes.length&&_d(n)):f?n.onSuccess(t,r,g):(n.onError(t,r,g),n.sizes.length&&_d(n)),f}var fx={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},EJ=["onError","onSuccess"],kc={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},nd={};function gx(n){var e=n.width===n.height,t=n.height===1,r=n.width===1,o=[];if(!n.width||!n.height)n.sizes.forEach(function(h){var f=e||t?h:1,g=e||r?h:1;o.push([f,g])});else for(var s=n.min||kc.min,i=n.step||kc.step,a=Math.max(n.width,n.height);a>=s;){var c=e||t?a:1,u=e||r?a:1;o.push([c,u]),a-=i}return o}function Xp(n){var e=window&&"HTMLCanvasElement"in window,t=window&&"OffscreenCanvas"in window,r=Date.now(),o=n.onError,s=n.onSuccess,i=SJ(n,EJ),a=null;if(!e)return!1;if(n.useWorker&&t){var c=`
            var canvasTest = `.concat(_d.toString(),`;
            onmessage = function(e) {
                canvasTest(e.data);
            };
        `),u=new Blob([c],{type:"application/javascript"}),h=URL.createObjectURL(u);a=new Worker(h),URL.revokeObjectURL(h),a.onmessage=function(f){var g=f.data,y=g.width,v=g.height,S=g.benchmark,w=g.isTestPass;w?(nd[r].onSuccess(y,v,S),delete nd[r]):nd[r].onError(y,v,S)}}if(n.usePromise)return new Promise(function(f,g){var y=Yr(Yr({},n),{},{onError:function(b,_,T){var E;if(n.sizes.length===0)E=!0;else{var M=n.sizes.slice(-1),A=kT(M,1),R=kT(A[0],2),L=R[0],K=R[1];E=b===L&&_===K}o(b,_,T),E&&g({width:b,height:_,benchmark:T})},onSuccess:function(b,_,T){s(b,_,T),f({width:b,height:_,benchmark:T})}});if(a){var v=y.onError,S=y.onSuccess;nd[r]={onError:v,onSuccess:S},a.postMessage(i)}else _d(y)});if(a)nd[r]={onError:o,onSuccess:s},a.postMessage(i);else return _d(n)}var mx={maxArea:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=gx({width:e.max,height:e.max,min:e.min,step:e.step,sizes:Yp(fx.area)}),r=Yr(Yr(Yr({},kc),e),{},{sizes:t});return Xp(r)},maxHeight:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=gx({width:1,height:e.max,min:e.min,step:e.step,sizes:Yp(fx.height)}),r=Yr(Yr(Yr({},kc),e),{},{sizes:t});return Xp(r)},maxWidth:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=gx({width:e.max,height:1,min:e.min,step:e.step,sizes:Yp(fx.width)}),r=Yr(Yr(Yr({},kc),e),{},{sizes:t});return Xp(r)},test:function(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Yr(Yr({},kc),e);return t.sizes=Yp(t.sizes),t.width&&t.height&&(t.sizes=[[t.width,t.height]]),Xp(t)}};let yx=null;function kJ(){return yx||(yx=TJ()),yx}async function TJ(){const n=await mx.maxWidth({usePromise:!0}),e=await mx.maxHeight({usePromise:!0}),t=await mx.maxArea({usePromise:!0});return{maxWidth:n.width,maxHeight:e.height,maxArea:t.width*t.height}}const TT=8192,MJ=4096*4096;async function AJ(n,e){if(n<=TT&&e<=TT&&n*e<=MJ)return[n,e];const{maxWidth:t,maxHeight:r,maxArea:o}=await kJ(),s=n/e;if(n>t&&(n=t,e=n/s),e>r&&(e=r,n=e*s),n*e>o){const i=Math.sqrt(o/(n*e));n*=i,e*=i}return[n,e]}async function fF(n,e,t){const{type:r,width:o,height:s,quality:i=1,pixelRatio:a=2}=t;let[c,u]=await AJ(o*a,s*a);c=Math.floor(c),u=Math.floor(u);const h=c/o,f=await Yo.blobToDataUrl(new Blob([e],{type:"image/svg+xml"})),g=await new Promise(v=>{const S=Ad();S.crossOrigin="anonymous",S.onload=async()=>{kt.isSafari&&await Jx(250);const w=document.createElement("canvas"),b=w.getContext("2d");w.width=c,w.height=u,b.imageSmoothingEnabled=!0,b.imageSmoothingQuality="high",b.drawImage(S,0,0,c,u),URL.revokeObjectURL(f),v(w)},S.onerror=()=>{v(null)},S.src=f});if(!g)return null;const y=await new Promise(v=>g.toBlob(S=>{(!S||sn.throwToBlob.get())&&v(null),v(S)},"image/"+r,i));if(!y)return null;if(r==="png"){const v=new DataView(await y.arrayBuffer());return Ps.setPhysChunk(v,h,{type:"image/"+r})}else return y}async function gF(n,e,t){const r=await n.getSvgString(e!=null&&e.length?e:[...n.getCurrentPageShapeIds()],{scale:t.scale??1,background:n.getInstanceState().exportBackground,...t});if(!r)throw new Error("Could not construct SVG.");return r}async function $w(n,e,t,r={}){var o;switch(t){case"svg":return(o=await gF(n,e,r))==null?void 0:o.svg;case"json":{const s=await n.resolveAssetsInContent(n.getContentFromCurrentPage(e));return JSON.stringify(s)}default:Sn(t)}}async function mF({editor:n,ids:e,format:t,opts:r={}}){switch(t){case"svg":return new Blob([await $w(n,e,"svg",r)],{type:"text/plain"});case"json":return new Blob([await $w(n,e,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{const o=await gF(n,e,r);if(!o)throw new Error("Could not construct image.");const s=await fF(n,o.svg,{type:t,quality:r.quality,pixelRatio:r.pixelRatio,width:o.width,height:o.height});if(!s)throw new Error("Could not construct image.");return s}default:Sn(t)}}const jJ={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function RJ(n,e,t,r={}){return{blobPromise:mF({editor:n,ids:e,format:t,opts:r}),mimeType:jJ[t]}}function OJ(n,e,t="svg",r={}){if(!navigator.clipboard)return Promise.reject(new Error("Copy not supported"));if(navigator.clipboard.write){const{blobPromise:o,mimeType:s}=RJ(n,e,t,r),i={[s]:o},a=HQ(s);return a&&WQ(a)&&(i[a]=o.then(c=>Yo.rewriteMimeType(c,a))),VQ(i)}switch(t){case"json":case"svg":return DJ(async()=>$w(n,e,t,r));case"jpeg":case"png":throw new Error("Copy not supported");default:Sn(t)}}async function DJ(n){var e,t;await((t=(e=navigator.clipboard)==null?void 0:e.writeText)==null?void 0:t.call(e,await n()))}function LJ(){const n=te(),{addToast:e}=ki(),t=lt();return C.useCallback((r,o="svg")=>{OJ(n,r,o).catch(()=>{e({id:"copy-fail",severity:"warning",title:t("toast.error.copy-fail.title"),description:t("toast.error.copy-fail.desc")})})},[n,e,t])}async function FJ(n,e,t="png",r,o={}){if(!r&&(r=`shapes at ${MT()}`,e.length===1)){const a=n.getShape(e[0]);n.isShapeOfType(a,"frame")?r=a.props.name||"frame":r=`${Wg(a.id)} at ${MT()}`}r+=`.${t}`;const s=await mF({editor:n,ids:e,format:t,opts:o}),i=new File([s],r,{type:s.type});NJ(i)}function MT(){const n=new Date,e=String(n.getFullYear()).slice(2),t=String(n.getMonth()+1).padStart(2,"0"),r=String(n.getDate()).padStart(2,"0"),o=String(n.getHours()).padStart(2,"0"),s=String(n.getMinutes()).padStart(2,"0"),i=String(n.getSeconds()).padStart(2,"0");return`${e}-${t}-${r} ${o}.${s}.${i}`}function NJ(n){const e=document.createElement("a"),t=URL.createObjectURL(n);e.href=t,e.download=n.name,e.click(),URL.revokeObjectURL(t)}function $J(){const n=te(),{addToast:e}=ki(),t=lt();return C.useCallback((r,o="png",s)=>{FJ(n,r,o,s,{scale:1,background:n.getInstanceState().exportBackground}).catch(i=>{console.error(i.message),e({id:"export-fail",title:t("toast.error.export-fail.title"),description:t("toast.error.export-fail.desc"),severity:"error"})})},[n,e,t])}const yF=at.createContext([]);function zJ(){const n=te(),e=C.useRef(),t=aa(at.useContext(yF));return C.useEffect(()=>{const r=window.document.createElement("input");r.type="file",r.accept=(t==null?void 0:t.join(","))??w8,r.multiple=!0,e.current=r;async function o(s){const i=s.target.files;!i||i.length===0||(n.markHistoryStoppingPoint("insert media"),await n.putExternalContent({type:"files",files:Array.from(i),point:n.getViewportPageBounds().center,ignoreParent:!1}),r.value="")}return r.addEventListener("change",o),()=>{e.current=void 0,r.removeEventListener("change",o)}},[n,t]),C.useCallback(()=>{var r;(r=e.current)==null||r.click()},[e])}function BJ(){const n=te(),e=C.useRef(null),t=C.useRef(null);return C.useCallback(async function(){const o=document.createElement("div"),s=document.createElement("style"),i=(b,_)=>{b&&(b.innerHTML=""),_&&document.head.contains(_)&&document.head.removeChild(_),b&&document.body.contains(b)&&document.body.removeChild(b)};i(e.current,t.current),e.current=o,t.current=s;const a=`tl-print-surface-${bt()}`;o.className=a,s.innerHTML=`
			.${a} {
				display: none;
			}

			.${a} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${a} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${a}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${a}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${a}__item__header {
					display: none;
				}

				.${a}__item__footer {
					display: none;
					text-align: right;
				}

				.${a}__item__footer__hide {
					display: none;
				}

				
			}

		`;const c=()=>{document.head.appendChild(s),document.body.appendChild(o)},u=()=>{n.once("tick",()=>{i(o,s)})};window.addEventListener("beforeprint",c),window.addEventListener("afterprint",u);function h(b,_,T){try{o.innerHTML+=`<div class="${a}__item">
        <div class="${a}__item__header">
          ${b.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${a}__item__main">
          ${T}
        </div>
        <div class="${a}__item__footer ${a}__item__footer__${_?"":"hide"}">
          ${_??""}
        </div>
      </div>`}catch(E){console.error(E)}}function f(){kt.isChromeForIos?(c(),window.print()):kt.isSafari?(c(),document.execCommand("print",!1)):window.print()}const g=n.getSelectedShapeIds(),y=n.getCurrentPageId(),v=n.getPages(),w={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(n.getSelectedShapeIds().length>0){const b=await n.getSvgString(g,w);if(b){const _=v.find(T=>T.id===y);h(`tldraw — ${_==null?void 0:_.name}`,null,b.svg),f()}}else{const b=n.getCurrentPage(),_=await n.getSvgString(n.getSortedChildIdsForParent(b.id),w);_&&(h(`tldraw — ${b.name}`,null,_.svg),f())}window.removeEventListener("beforeprint",c),window.removeEventListener("afterprint",u)},[n])}function g_(){const{addToast:n,removeToast:e,clearToasts:t}=ki(),{addDialog:r,clearDialogs:o,removeDialog:s}=ph(),i=lt(),a=zJ(),c=BJ(),{cut:u,copy:h,paste:f}=fJ(),g=LJ(),y=$J(),v=c_(),w=hr()<en.TABLET_SM;return C.useMemo(()=>({addToast:n,removeToast:e,clearToasts:t,addDialog:r,removeDialog:s,clearDialogs:o,msg:i,isMobile:w,insertMedia:a,printSelectionOrPages:c,cut:u,copy:h,paste:f,copyAs:g,exportAs:y,getEmbedDefinition:v}),[n,e,t,r,s,o,i,w,a,c,u,h,f,g,y,v])}function UJ(n,e){const t={};for(const r of n)if(r.translations)for(const[o,s]of Lr(r.translations)){let i=t[o];i||(i=t[o]={}),Object.assign(i,s)}return{actions:(r,o,s)=>{for(const i of n)i.actions&&(o=i.actions(r,o,s));return o},tools:(r,o,s)=>{for(const i of n)i.tools&&(o=i.tools(r,o,{...e,...s}));return o},translations:t}}function vF(n){return C.useMemo(()=>n,n)}function HJ(n){const e=vF(n==null?[]:Array.isArray(n)?n:[n]);return C.useMemo(()=>{const t={};for(const r of e)if(r.translations)for(const[o,s]of Lr(r.translations)){let i=t[o];i||(i=t[o]={}),Object.assign(i,s)}return t},[e])}function KJ(n){const e=g_(),t=vF(n==null?[]:Array.isArray(n)?n:[n]);return C.useMemo(()=>UJ(t,e),[t,e])}const SF=C.createContext(null);function WJ(n){return Object.fromEntries(n.map(e=>[e.id,e]))}function Sc(n,e){if(n.getSelectedShapes().length===0)return n.getDocumentSettings().name||e}function VJ({overrides:n,children:e}){const t=te(),r=bm(),o=g_(),s=Ln(),i=o.msg("document.default-name"),a=C.useMemo(()=>{function c(){return t.isIn("select")||(t.complete(),t.setCurrentTool("select")),!1}function u(){return t.isIn("select")&&t.getSelectedShapeIds().length>0}const h=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(g){u()&&(c()||(s("edit-link",{source:g}),t.markHistoryStoppingPoint("edit-link"),o.addDialog({component:oQ})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(g){s("insert-embed",{source:g}),o.addDialog({component:G5})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(g){s("insert-media",{source:g}),o.insertMedia()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(g){s("undo",{source:g}),t.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(g){s("redo",{source:g}),t.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(g){let y=t.getSelectedShapeIds();y.length===0&&(y=Array.from(t.getCurrentPageShapeIds().values())),y.length!==0&&(s("export-as",{format:"svg",source:g}),o.exportAs(y,"svg",Sc(t,i)))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(g){let y=t.getSelectedShapeIds();y.length===0&&(y=Array.from(t.getCurrentPageShapeIds().values())),y.length!==0&&(s("export-as",{format:"png",source:g}),o.exportAs(y,"png",Sc(t,i)))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(g){let y=t.getSelectedShapeIds();y.length===0&&(y=Array.from(t.getCurrentPageShapeIds().values())),y.length!==0&&(s("export-as",{format:"json",source:g}),o.exportAs(y,"json",Sc(t,i)))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(g){let y=t.getSelectedShapeIds();y.length===0&&(y=Array.from(t.getCurrentPageShapeIds().values())),y.length!==0&&(s("export-all-as",{format:"svg",source:g}),o.exportAs(Array.from(t.getCurrentPageShapeIds()),"svg",Sc(t,i)))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(g){const y=Array.from(t.getCurrentPageShapeIds().values());y.length!==0&&(s("export-all-as",{format:"png",source:g}),o.exportAs(y,"png",Sc(t,i)))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(g){const y=Array.from(t.getCurrentPageShapeIds().values());y.length!==0&&(s("export-all-as",{format:"json",source:g}),o.exportAs(y,"json",Sc(t,i)))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(g){let y=t.getSelectedShapeIds();y.length===0&&(y=Array.from(t.getCurrentPageShapeIds().values())),y.length!==0&&(s("copy-as",{format:"svg",source:g}),o.copyAs(y,"svg"))}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(g){let y=t.getSelectedShapeIds();y.length===0&&(y=Array.from(t.getCurrentPageShapeIds().values())),y.length!==0&&(s("copy-as",{format:"png",source:g}),o.copyAs(y,"png"))}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(g){let y=t.getSelectedShapeIds();y.length===0&&(y=Array.from(t.getCurrentPageShapeIds().values())),y.length!==0&&(s("copy-as",{format:"json",source:g}),o.copyAs(y,"json"))}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(g){if(!u()||c())return;s("toggle-auto-size",{source:g}),t.markHistoryStoppingPoint("toggling auto size");const y=t.getSelectedShapes().filter(v=>t.isShapeOfType(v,"text")&&v.props.autoSize===!1);t.updateShapes(y.map(v=>({id:v.id,type:v.type,props:{...v.props,w:8,autoSize:!0}}))),Rt(t,y.map(v=>v.id))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(g){s("open-embed-link",{source:g});const y=t.getSelectedShapeIds(),v="No embed shapes selected";if(y.length!==1){console.error(v);return}const S=t.getShape(y[0]);if(!S||!t.isShapeOfType(S,"embed")){console.error(v);return}Sq(S.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(g){var y,v;if(((y=t.root.getCurrent())==null?void 0:y.id)!=="zoom"&&(s("zoom-tool",{source:g}),!(t.inputs.shiftKey||t.inputs.ctrlKey))){const S=t.root.getCurrent();S&&((v=S.getCurrent())==null?void 0:v.id)==="idle"&&t.setCurrentTool("zoom",{onInteractionEnd:S.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(g){u()&&(c()||t.run(()=>{s("convert-to-bookmark",{source:g});const y=t.getSelectedShapes(),v=[],S=[];for(const w of y){if(!w||!t.isShapeOfType(w,"embed")||!w.props.url)continue;const b=new P(w.x,w.y);b.rot(-w.rotation),b.add(new P(w.props.w/2-300/2,w.props.h/2-320/2)),b.rot(w.rotation);const _={id:Ct(),type:"bookmark",rotation:w.rotation,x:b.x,y:b.y,opacity:1,props:{url:w.props.url}};v.push(_),S.push(w.id)}t.markHistoryStoppingPoint("convert shapes to bookmark"),t.deleteShapes(S),t.createShapes(v)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(g){u()&&(c()||(s("convert-to-embed",{source:g}),t.run(()=>{const y=t.getSelectedShapeIds(),v=Ze(y.map(b=>t.getShape(b))),S=[],w=[];for(const b of v){if(!t.isShapeOfType(b,"bookmark"))continue;const{url:_}=b.props,T=o.getEmbedDefinition(_);if(!T||!T.definition)continue;const{width:E,height:M}=T.definition,A=new P(b.x,b.y);A.rot(-b.rotation),A.add(new P(b.props.w/2-E/2,b.props.h/2-M/2)),A.rot(b.rotation);const R={id:Ct(),type:"embed",x:A.x,y:A.y,rotation:b.rotation,props:{url:_,w:E,h:M}};S.push(R),w.push(b.id)}t.markHistoryStoppingPoint("convert shapes to embed"),t.deleteShapes(w),t.createShapes(S)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(g){if(!u()||c())return;s("duplicate-shapes",{source:g});const y=t.getInstanceState();let v,S;if(y.duplicateProps)v=y.duplicateProps.shapeIds,S=y.duplicateProps.offset;else{v=t.getSelectedShapeIds();const w=xe.Common(Ze(v.map(b=>t.getShapePageBounds(b))));S=t.getCameraOptions().isLocked?{x:t.options.adjacentShapeMargin,y:t.options.adjacentShapeMargin}:{x:w.width+t.options.adjacentShapeMargin,y:0}}t.markHistoryStoppingPoint("duplicate shapes"),t.duplicateShapes(v,S),y.duplicateProps&&t.updateInstanceState({duplicateProps:{...y.duplicateProps,shapeIds:t.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(g){u()&&(c()||(s("ungroup-shapes",{source:g}),t.markHistoryStoppingPoint("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(g){if(!u()||c())return;s("group-shapes",{source:g});const y=t.getOnlySelectedShape();y&&t.isShapeOfType(y,"group")?(t.markHistoryStoppingPoint("ungroup"),t.ungroupShapes(t.getSelectedShapeIds())):(t.markHistoryStoppingPoint("group"),t.groupShapes(t.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(g){if(!u())return;s("remove-frame",{source:g});const y=t.getSelectedShapes();y.length>0&&y.every(v=>t.isShapeOfType(v,"frame"))&&(t.markHistoryStoppingPoint("remove-frame"),FZ(t,y.map(v=>v.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(g){if(!u())return;s("fit-frame-to-content",{source:g});const y=t.getOnlySelectedShape();y&&t.isShapeOfType(y,"frame")&&(t.markHistoryStoppingPoint("fit-frame-to-content"),$Z(t,y.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(g){if(!u()||c())return;s("align-shapes",{operation:"left",source:g}),t.markHistoryStoppingPoint("align left");const y=t.getSelectedShapeIds();t.alignShapes(y,"left"),Rt(t,y)}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(g){if(!u()||c())return;s("align-shapes",{operation:"center-horizontal",source:g}),t.markHistoryStoppingPoint("align center horizontal");const y=t.getSelectedShapeIds();t.alignShapes(y,"center-horizontal"),Rt(t,y)}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(g){if(!u()||c())return;s("align-shapes",{operation:"right",source:g}),t.markHistoryStoppingPoint("align right");const y=t.getSelectedShapeIds();t.alignShapes(y,"right"),Rt(t,y)}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(g){if(!u()||c())return;s("align-shapes",{operation:"center-vertical",source:g}),t.markHistoryStoppingPoint("align center vertical");const y=t.getSelectedShapeIds();t.alignShapes(y,"center-vertical"),Rt(t,y)}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(g){if(!u()||c())return;s("align-shapes",{operation:"top",source:g}),t.markHistoryStoppingPoint("align top");const y=t.getSelectedShapeIds();t.alignShapes(y,"top"),Rt(t,y)}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(g){if(!u()||c())return;s("align-shapes",{operation:"bottom",source:g}),t.markHistoryStoppingPoint("align bottom");const y=t.getSelectedShapeIds();t.alignShapes(y,"bottom"),Rt(t,y)}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(g){if(!u()||c())return;s("distribute-shapes",{operation:"horizontal",source:g}),t.markHistoryStoppingPoint("distribute horizontal");const y=t.getSelectedShapeIds();t.distributeShapes(y,"horizontal"),Rt(t,y)}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(g){if(!u()||c())return;s("distribute-shapes",{operation:"vertical",source:g}),t.markHistoryStoppingPoint("distribute vertical");const y=t.getSelectedShapeIds();t.distributeShapes(y,"vertical"),Rt(t,y)}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(g){if(!u()||c())return;s("stretch-shapes",{operation:"horizontal",source:g}),t.markHistoryStoppingPoint("stretch horizontal");const y=t.getSelectedShapeIds();t.stretchShapes(y,"horizontal"),Rt(t,y)}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(g){if(!u()||c())return;s("stretch-shapes",{operation:"vertical",source:g}),t.markHistoryStoppingPoint("stretch vertical");const y=t.getSelectedShapeIds();t.stretchShapes(y,"vertical"),Rt(t,y)}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(g){if(!u()||c())return;s("flip-shapes",{operation:"horizontal",source:g}),t.markHistoryStoppingPoint("flip horizontal");const y=t.getSelectedShapeIds();t.flipShapes(y,"horizontal"),Rt(t,y)}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(g){if(!u()||c())return;s("flip-shapes",{operation:"vertical",source:g}),t.markHistoryStoppingPoint("flip vertical");const y=t.getSelectedShapeIds();t.flipShapes(y,"vertical"),Rt(t,y)}},{id:"pack",label:"action.pack",icon:"pack",onSelect(g){if(!u()||c())return;s("pack-shapes",{source:g}),t.markHistoryStoppingPoint("pack");const y=t.getSelectedShapeIds();t.packShapes(y,t.options.adjacentShapeMargin),Rt(t,y)}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(g){if(!u()||c())return;s("stack-shapes",{operation:"vertical",source:g}),t.markHistoryStoppingPoint("stack-vertical");const y=t.getSelectedShapeIds();t.stackShapes(y,"vertical",16),Rt(t,y)}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(g){if(!u()||c())return;s("stack-shapes",{operation:"horizontal",source:g}),t.markHistoryStoppingPoint("stack-horizontal");const y=t.getSelectedShapeIds();t.stackShapes(y,"horizontal",16),Rt(t,y)}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(g){u()&&(c()||(s("reorder-shapes",{operation:"toFront",source:g}),t.markHistoryStoppingPoint("bring to front"),t.bringToFront(t.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(g){u()&&(c()||(s("reorder-shapes",{operation:"forward",source:g}),t.markHistoryStoppingPoint("bring forward"),t.bringForward(t.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(g){u()&&(c()||(s("reorder-shapes",{operation:"backward",source:g}),t.markHistoryStoppingPoint("send backward"),t.sendBackward(t.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(g){u()&&(c()||(s("reorder-shapes",{operation:"toBack",source:g}),t.markHistoryStoppingPoint("send to back"),t.sendToBack(t.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(g){u()&&(c()||(t.markHistoryStoppingPoint("cut"),o.cut(g)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(g){u()&&(c()||o.copy(g))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(g){var y;(y=navigator.clipboard)==null||y.read().then(v=>{o.paste(v,g,g==="context-menu"?t.inputs.currentPagePoint:void 0)}).catch(()=>{o.addToast({title:o.msg("action.paste-error-title"),description:o.msg("action.paste-error-description"),severity:"error"})})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(g){t.run(()=>{c()||(s("select-all-shapes",{source:g}),t.markHistoryStoppingPoint("select all kbd"),t.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(g){u()&&(c()||(s("select-none-shapes",{source:g}),t.markHistoryStoppingPoint("select none"),t.selectNone()))}},{id:"delete",label:"action.delete",kbd:"⌫,del,backspace",icon:"trash",onSelect(g){u()&&(c()||(s("delete-shapes",{source:g}),t.markHistoryStoppingPoint("delete"),t.deleteShapes(t.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(g){if(!u()||c())return;s("rotate-cw",{source:g}),t.markHistoryStoppingPoint("rotate-cw");const y=t.getSelectionRotation()%(Dt/2),v=pa(y,0)||pa(y,Dt/2),S=t.getSelectedShapeIds();t.rotateShapesBy(S,Dt/2-(v?0:y)),Rt(t,S)}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(g){if(!u()||c())return;s("rotate-ccw",{source:g}),t.markHistoryStoppingPoint("rotate-ccw");const y=t.getSelectionRotation()%(Dt/2),v=pa(y,0),S=t.getSelectedShapeIds();t.rotateShapesBy(S,v?-(Dt/2):-y),Rt(t,S)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(g){s("zoom-in",{source:g}),t.zoomIn(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(g){s("zoom-out",{source:g}),t.zoomOut(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(g){s("reset-zoom",{source:g}),t.resetZoom(void 0,{animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(g){s("zoom-to-fit",{source:g}),t.zoomToFit({animation:{duration:t.options.animationMediumMs}})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(g){u()&&(c()||(s("zoom-to-selection",{source:g}),t.zoomToSelection({animation:{duration:t.options.animationMediumMs}})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(g){s("toggle-snap-mode",{source:g}),t.user.updateUserPreferences({isSnapMode:!t.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(g){const y=t.user.getIsDarkMode()?"light":"dark";s("color-scheme",{source:g,value:y}),t.user.updateUserPreferences({colorScheme:y})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(g){s("toggle-wrap-mode",{source:g}),t.user.updateUserPreferences({isWrapMode:!t.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-dynamic-size-mode",label:{default:"action.toggle-dynamic-size-mode",menu:"action.toggle-dynamic-size-mode.menu"},readonlyOk:!1,onSelect(g){s("toggle-dynamic-size-mode",{source:g}),t.user.updateUserPreferences({isDynamicSizeMode:!t.user.getIsDynamicResizeMode()})},checkbox:!0},{id:"toggle-paste-at-cursor",label:{default:"action.toggle-paste-at-cursor",menu:"action.toggle-paste-at-cursor.menu"},readonlyOk:!1,onSelect(g){s("toggle-paste-at-cursor",{source:g}),t.user.updateUserPreferences({isPasteAtCursorMode:!t.user.getIsPasteAtCursorMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(g){s("toggle-reduce-motion",{source:g}),t.user.updateUserPreferences({animationSpeed:t.user.getAnimationSpeed()===0?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(g){s("toggle-edge-scrolling",{source:g}),t.user.updateUserPreferences({edgeScrollSpeed:t.user.getEdgeScrollSpeed()===0?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(g){s("toggle-transparent",{source:g}),t.updateInstanceState({exportBackground:!t.getInstanceState().exportBackground})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(g){s("toggle-tool-lock",{source:g}),t.updateInstanceState({isToolLocked:!t.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(g){s("unlock-all",{source:g});const y=[];for(const v of t.getCurrentPageShapes())v.isLocked&&y.push({id:v.id,type:v.type,isLocked:!1});y.length>0&&t.updateShapes(y)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(g){t.timers.requestAnimationFrame(()=>{t.run(()=>{s("toggle-focus-mode",{source:g}),o.clearDialogs(),o.clearToasts(),t.updateInstanceState({isFocusMode:!t.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(g){s("toggle-grid-mode",{source:g}),t.updateInstanceState({isGridMode:!t.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(g){s("toggle-debug-mode",{source:g}),t.updateInstanceState({isDebugMode:!t.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(g){s("print",{source:g}),o.printSelectionOrPages()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(g){s("exit-pen-mode",{source:g}),t.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(g){s("stop-following",{source:g}),t.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(g){s("zoom-to-content",{source:g});const y=t.getSelectionPageBounds()??t.getCurrentPageBounds();y&&t.zoomToBounds(y,{targetZoom:Math.min(1,t.getZoomLevel()),animation:{duration:220}})}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(g){t.markHistoryStoppingPoint("locking"),s("toggle-lock",{source:g}),t.toggleLock(t.getSelectedShapeIds())}},{id:"move-to-new-page",label:"context.pages.new-page",onSelect(g){const y=so.createId(),v=t.getSelectedShapeIds();t.run(()=>{t.markHistoryStoppingPoint("move_shapes_to_page"),t.createPage({name:o.msg("page-menu.new-page-initial-name"),id:y}),t.moveShapesToPage(v,y)}),s("move-to-new-page",{source:g})}},{id:"select-white-color",label:"color-style.white",kbd:"?t",onSelect(g){const y=oo;t.run(()=>{t.markHistoryStoppingPoint("change-color"),t.isIn("select")&&t.setStyleForSelectedShapes(y,"white"),t.setStyleForNextShapes(y,"white")}),s("set-style",{source:g,id:y.id,value:"white"})}},{id:"select-fill-fill",label:"fill-style.fill",kbd:"?f",onSelect(g){const y=fl;t.run(()=>{t.markHistoryStoppingPoint("change-fill"),t.isIn("select")&&t.setStyleForSelectedShapes(y,"fill"),t.setStyleForNextShapes(y,"fill")}),s("set-style",{source:g,id:y.id,value:"fill"})}},{id:"flatten-to-image",label:"action.flatten-to-image",kbd:"!f",onSelect:async g=>{const y=t.getSelectedShapeIds();if(y.length===0)return;t.markHistoryStoppingPoint("flattening to image"),s("flatten-to-image",{source:g});const v=await hQ(t,y,t.options.flattenImageBoundsExpand);v!=null&&v.length&&t.setSelectedShapes(v)}}];r&&h.push({id:"open-cursor-chat",label:"action.open-cursor-chat",readonlyOk:!0,kbd:"/",onSelect(g){s("open-cursor-chat",{source:g}),!t.getInstanceState().isCoarsePointer&&t.timers.requestAnimationFrame(()=>{t.updateInstanceState({isChatting:!0})})}});const f=WJ(h);return n?n(t,f,o):f},[o,t,s,n,i,r]);return p.jsx(SF.Provider,{value:a,children:e})}function kl(){const n=C.useContext(SF);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function zd(n,e){return n?typeof n=="string"?n:e?n[e]??n.default:void 0:void 0}function ao(){const n=Ia();return re("isReadonlyMode",()=>!!(n!=null&&n.getIsReadonly()),[n])}const GJ=kt.isDarwin?"⌘":"Ctrl",qJ=kt.isDarwin?"⌥":"Alt";function xF(n){return n===","?[","]:n.split(",")[0].split("").map(e=>{const t=e.replace(/\$/g,GJ).replace(/\?/g,qJ).replace(/!/g,"⇧");return t[0].toUpperCase()+t.slice(1)})}function zw(n){return"— "+xF(n).join(" ")}function Pd({children:n,visibleOnMobileLayout:e=!1}){const t=hr();return!e&&t<en.MOBILE?null:p.jsx("kbd",{className:"tlui-kbd",children:xF(n).map((r,o)=>p.jsx("span",{children:r},o))})}const wF=C.createContext(null);function Cm(){const n=C.useContext(wF);if(!n)throw new Error("useTldrawUiMenuContext must be used within a TldrawUiMenuContextProvider");return n}function Mo({type:n,sourceId:e,children:t}){return p.jsx(wF.Provider,{value:{type:n,sourceId:e},children:t})}function Im({id:n,kbd:e,label:t,readonlyOk:r,onSelect:o,toggle:s=!1,disabled:i=!1,checked:a=!1}){const{type:c,sourceId:u}=Cm(),h=ao(),f=lt();if(h&&!r)return null;const g=zd(t,c),y=g?f(g):void 0;switch(c){case"menu":return p.jsxs(RZ,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:y,onSelect:v=>{o==null||o(u),et(v)},disabled:i,checked:a,children:[p.jsx($s,{small:!0,icon:s?a?"toggle-on":"toggle-off":a?"check":"none"}),y&&p.jsx("span",{className:"tlui-button__label",draggable:!1,children:y}),e&&p.jsx(Pd,{children:e})]});case"context-menu":return p.jsxs(cZ,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:y,onSelect:v=>{o(u),et(v)},disabled:i,checked:a,children:[p.jsx($s,{small:!0,icon:s?a?"toggle-on":"toggle-off":a?"check":"none"}),y&&p.jsx("span",{className:"tlui-button__label",draggable:!1,children:y}),e&&p.jsx(Pd,{children:e})]},n);default:return null}}function Ti(n,e){const t=Ia(),r=C.useCallback(i=>{i&&(t==null||t.complete()),e==null||e(i)},[t,e]),o=Ln(),s=C.useCallback(i=>{o(i,{source:"unknown",id:n})},[n,o]);return dq(t?`${n}-${t.contextId}`:n,r,s)}function vl({id:n,children:e,modal:t=!1,debugOpen:r=!1}){const[o,s]=Ti(n);return p.jsx(J1,{open:r||o,dir:"ltr",modal:t,onOpenChange:s,children:e})}function Sl({children:n,...e}){return p.jsx(e_,{dir:"ltr",asChild:!0,onTouchEnd:t=>et(t),...e,children:n})}function xl({className:n,side:e="bottom",align:t="start",sideOffset:r=8,alignOffset:o=8,children:s}){const i=fn();return p.jsx(ym,{container:i,children:p.jsx(t_,{className:Fe("tlui-menu",n),side:e,sideOffset:r,align:t,alignOffset:o,collisionPadding:4,children:s})})}function YJ({id:n,children:e}){const[t,r]=Ti(n);return p.jsx(OZ,{open:t,onOpenChange:r,children:e})}function XJ({id:n,label:e,title:t,disabled:r}){return p.jsx(DZ,{dir:"ltr",asChild:!0,disabled:r,children:p.jsxs($e,{"data-testid":n,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:t,children:[p.jsx(an,{children:e}),p.jsx(rt,{icon:"chevron-right",small:!0})]})})}function ZJ({id:n,alignOffset:e=-1,sideOffset:t=-6,size:r="small",children:o}){const s=fn();return p.jsx(ym,{container:s,children:p.jsx(LZ,{"data-testid":n,className:"tlui-menu tlui-menu__submenu__content",alignOffset:e,sideOffset:t,collisionPadding:4,"data-size":r,children:o})})}function QJ({children:n}){return p.jsx(AZ,{dir:"ltr",className:"tlui-menu__group",children:n})}function Bd({noClose:n,children:e}){return p.jsx(jZ,{dir:"ltr",asChild:!0,onClick:n?et:void 0,children:e})}function Je({id:n,label:e,children:t}){const{type:r,sourceId:o}=Cm(),s=lt(),i=zd(e,r),a=i?s(i):void 0;switch(r){case"panel":return p.jsx("div",{className:"tlui-menu__group","data-testid":`${o}-group.${n}`,children:t});case"menu":return p.jsx(QJ,{"data-testid":`${o}-group.${n}`,children:t});case"context-menu":return p.jsx(u5,{dir:"ltr",className:"tlui-menu__group","data-testid":`${o}-group.${n}`,children:t});case"keyboard-shortcuts":return p.jsxs("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${o}-group.${n}`,children:[p.jsx("h2",{className:"tlui-shortcuts-dialog__group__title",children:a}),p.jsx("div",{className:"tlui-shortcuts-dialog__group__content",children:t})]});default:return t}}function zr({id:n,disabled:e=!1,label:t,size:r="small",children:o}){const{type:s,sourceId:i}=Cm(),a=fn(),c=lt(),u=t?typeof t=="string"?t:t[s]??t.default:void 0,h=u?c(u):void 0;switch(s){case"menu":return p.jsxs(YJ,{id:`${i}-sub.${n}`,children:[p.jsx(XJ,{id:`${i}-sub.${n}-button`,disabled:e,label:h,title:h}),p.jsx(ZJ,{id:`${i}-sub.${n}-content`,size:r,children:o})]});case"context-menu":return e?null:p.jsxs(JJ,{id:`${i}-sub.${n}`,children:[p.jsx(f5,{dir:"ltr",disabled:e,asChild:!0,children:p.jsxs($e,{"data-testid":`${i}-sub.${n}-button`,type:"menu",className:"tlui-menu__submenu__trigger",children:[p.jsx(an,{children:h}),p.jsx(rt,{icon:"chevron-right",small:!0})]})}),p.jsx(Z1,{container:a,children:p.jsx(g5,{"data-testid":`${i}-sub.${n}-content`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":r,children:o})})]});default:return o}}function JJ({id:n,children:e}){const[t,r]=Ti(n);return p.jsx(p5,{open:t,onOpenChange:r,children:e})}const eee=[{colorScheme:"light",label:"theme.light"},{colorScheme:"dark",label:"theme.dark"},{colorScheme:"system",label:"theme.system"}];function tee(){const n=te(),e=Ln(),t=re("colorScheme",()=>n.user.getUserPreferences().colorScheme??(n.user.getIsDarkMode()?"dark":"light"),[n]);return p.jsx(zr,{id:"help menu color-scheme",label:"menu.theme",children:p.jsx(Je,{id:"theme",children:eee.map(({colorScheme:r,label:o})=>p.jsx(Im,{id:`color-scheme-${r}`,label:o,checked:r===t,readonlyOk:!0,onSelect:()=>{n.user.updateUserPreferences({colorScheme:r}),e("color-scheme",{source:"menu",value:r})}},r))})})}const nee=({id:n,component:e,onClose:t})=>{const{removeDialog:r}=ph(),o=fn(),s=C.useCallback(i=>{if(!i){if(t)try{t()}catch(a){console.warn(a)}r(n)}},[n,t,r]);return p.jsx(eQ,{onOpenChange:s,defaultOpen:!0,children:p.jsx(tQ,{container:o,children:p.jsx(nQ,{dir:"ltr",className:"tlui-dialog__overlay",onClick:i=>{i.target===i.currentTarget&&s(!1)},children:p.jsx(rQ,{dir:"ltr",className:"tlui-dialog__content","aria-describedby":void 0,children:p.jsx(e,{onClose:()=>s(!1)})})})})})},ree=C.memo(function(){const{dialogs:e}=ph();return re("dialogs",()=>e.get(),[e]).map(r=>p.jsx(nee,{...r},r.id))}),oee=4e3,see={success:"check-circle",warning:"warning-triangle",error:"cross-circle",info:"info-circle"};function iee({toast:n}){const{removeToast:e}=ki(),t=lt(),r=i=>{i||e(n.id)},o=n.actions&&n.actions.length>0,s=n.icon||n.severity&&see[n.severity];return p.jsxs(OQ,{onOpenChange:r,className:"tlui-toast__container",duration:n.keepOpen?1/0:oee,"data-severity":n.severity,children:[s&&p.jsx("div",{className:"tlui-toast__icon",children:p.jsx($s,{icon:s})}),p.jsxs("div",{className:"tlui-toast__main","data-title":!!n.title,"data-description":!!n.description,"data-actions":!!n.actions,children:[p.jsxs("div",{className:"tlui-toast__content",children:[n.title&&p.jsx(DQ,{className:"tlui-toast__title",children:n.title}),n.description&&p.jsx(LQ,{className:"tlui-toast__description",children:n.description})]}),n.actions&&p.jsxs("div",{className:"tlui-toast__actions",children:[n.actions.map((i,a)=>p.jsx(FQ,{altText:i.label,asChild:!0,onClick:i.onClick,children:p.jsx($e,{type:i.type,children:p.jsx(an,{children:i.label})})},a)),p.jsx(PT,{asChild:!0,children:p.jsx($e,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:p.jsx(an,{children:n.closeLabel??t("toast.close")})})})]})]}),!o&&p.jsx(PT,{asChild:!0,children:p.jsx($e,{type:"normal",className:"tlui-toast__close",children:p.jsx(an,{children:n.closeLabel??t("toast.close")})})})]})}const aee=C.memo(function(){const{toasts:e}=ki(),t=re("toasts",()=>e.get(),[]);return p.jsxs(p.Fragment,{children:[t.map(r=>p.jsx(iee,{toast:r},r.id)),p.jsx(J5,{className:"tlui-toast__viewport"})]})});function as({actionId:n="",...e}){const r=kl()[n];return r?p.jsx(Im,{...r,...e}):null}function AT(n){return p.jsx("svg",{width:16,height:16,viewBox:"0 0 16 16",...n,children:p.jsxs("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[p.jsx("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),p.jsx("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:p.jsx("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}function kn({disabled:n=!1,spinner:e=!1,readonlyOk:t=!1,id:r,kbd:o,label:s,icon:i,onSelect:a,noClose:c,isSelected:u}){const{type:h,sourceId:f}=Cm(),g=lt(),[y,v]=C.useState(!1);if(ao()&&!t)return null;const w=zd(s,h),b=o?zw(o):void 0,_=w?g(w):void 0,T=_&&b?`${_} ${b}`:_;switch(h){case"menu":return p.jsx(Bd,{children:p.jsxs($e,{type:"menu","data-testid":`${f}.${r}`,disabled:n,title:T,onClick:E=>{c&&et(E),y?v(!1):a(f)},children:[p.jsx(an,{children:_}),o&&p.jsx(Pd,{children:o})]})});case"context-menu":return n?null:p.jsxs(d5,{dir:"ltr",title:T,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${f}.${r}`,onSelect:E=>{c&&et(E),y?v(!1):a(f)},children:[p.jsx("span",{className:"tlui-button__label",draggable:!1,children:_}),o&&p.jsx(Pd,{children:o}),e&&p.jsx(AT,{})]});case"panel":return p.jsxs($e,{"data-testid":`${f}.${r}`,type:"menu",title:T,disabled:n,onClick:()=>a(f),children:[p.jsx(an,{children:_}),e?p.jsx(AT,{}):i&&p.jsx(rt,{icon:i})]});case"small-icons":case"icons":return p.jsx($e,{"data-testid":`${f}.${r}`,type:"icon",title:T,disabled:n,onClick:()=>a(f),children:p.jsx(rt,{icon:i,small:h==="small-icons"})});case"keyboard-shortcuts":return o?p.jsxs("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${f}.${r}`,children:[p.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:_}),p.jsx("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:p.jsx(Pd,{visibleOnMobileLayout:!0,children:o})})]}):(console.warn(`Menu item '${s}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null);case"helper-buttons":return p.jsxs($e,{type:"low",onClick:()=>a(f),children:[p.jsx(rt,{icon:i}),p.jsx(an,{children:_})]});case"toolbar":return p.jsx($e,{type:"tool","data-testid":`tools.${r}`,"aria-label":w,"data-value":r,onClick:()=>a("toolbar"),title:T,disabled:n,onTouchStart:E=>{et(E),a("toolbar")},role:"radio","aria-checked":u?"true":"false",children:p.jsx(rt,{icon:i})});case"toolbar-overflow":return p.jsx(Bd,{"aria-label":s,children:p.jsx($e,{type:"icon",className:"tlui-button-grid__button",onClick:()=>{a("toolbar")},"data-testid":`tools.more.${r}`,title:T,disabled:n,role:"radio","aria-checked":u?"true":"false","data-value":r,children:p.jsx(rt,{icon:i})})});default:throw Sn(h)}}function le({actionId:n="",...e}){const r=kl()[n];return r?p.jsx(kn,{...r,...e}):null}const bF=C.createContext(null);function lee({overrides:n,children:e}){const t=te(),r=Ln(),o=g_(),s=C.useMemo(()=>{const i=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(c){if(t.isIn("select")){const u=t.root.getCurrent();u.exit({},u.id),u.enter({},u.id)}t.setCurrentTool("select"),r("select-tool",{source:c,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(c){t.setCurrentTool("hand"),r("select-tool",{source:c,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(c){t.setCurrentTool("eraser"),r("select-tool",{source:c,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(c){t.setCurrentTool("draw"),r("select-tool",{source:c,id:"draw"})}},...[...Zo.values].map(c=>({id:c,label:`tool.${c}`,meta:{geo:c},kbd:c==="rectangle"?"r":c==="ellipse"?"o":void 0,icon:"geo-"+c,onSelect(u){t.run(()=>{t.setStyleForNextShapes(Zo,c),t.setCurrentTool("geo"),r("select-tool",{source:u,id:`geo-${c}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(c){t.setCurrentTool("arrow"),r("select-tool",{source:c,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(c){t.setCurrentTool("line"),r("select-tool",{source:c,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(c){t.setCurrentTool("frame"),r("select-tool",{source:c,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(c){t.setCurrentTool("text"),r("select-tool",{source:c,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(c){o.insertMedia(),r("select-tool",{source:c,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(c){t.setCurrentTool("note"),r("select-tool",{source:c,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(c){t.setCurrentTool("laser"),r("select-tool",{source:c,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"dot",onSelect(c){o.addDialog({component:G5}),r("select-tool",{source:c,id:"embed"})}},{id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(c){t.setCurrentTool("highlight"),r("select-tool",{source:c,id:"highlight"})}}];i.push();const a=Object.fromEntries(i.map(c=>[c.id,c]));return n?n(t,a,o):a},[n,t,r,o]);return p.jsx(bF.Provider,{value:s,children:e})}function m_(){const n=C.useContext(bF);if(!n)throw new Error("useTools must be used within a ToolProvider");return n}function Er({toolId:n="",...e}){const r=m_()[n];return r?p.jsx(kn,{...r,...e}):null}function cee({children:n}){const e=te();return re("shouldDisplayHandles",()=>{if(e.isInAny("select.idle","select.pointing_handle","select.pointing_shape"))return!0;if(e.isInAny("select.editing_shape")){const r=e.getOnlySelectedShape();return r&&e.isShapeOfType(r,"note")}return!1},[e])?p.jsx("svg",{className:"tl-user-handles tl-overlays__item",children:n}):null}const{PI:uee}=Math,$c=uee+1e-4;function _F(n,e={}){const{size:t=16,smoothing:r=.5}=e;if(n.length===0||t<=0)return{left:[],right:[]};const o=n[0],s=n[n.length-1],i=s.runningLength,a=Math.pow(t*r,2),c=[],u=[];let h=n[0].vector,f=n[0].point,g=f,y=f,v=g,S=!1,w;for(let b=0;b<n.length;b++){w=n[b];const{point:_,vector:T}=n[b],E=w.vector.dpr(h),M=(b<n.length-1?n[b+1]:n[b]).vector,A=b<n.length-1?M.dpr(w.vector):1,R=E<0&&!S,L=A!==null&&A<.2;if(R||L){if(A>-.62&&i-w.runningLength>w.radius){const D=h.clone().mul(w.radius);h.clone().cpr(M)<0?(y=P.Add(_,D),v=P.Sub(_,D)):(y=P.Sub(_,D),v=P.Add(_,D)),c.push(y),u.push(v)}else{const D=h.clone().mul(w.radius).per(),U=P.Sub(w.input,D);for(let V=1/13,F=0;F<1;F+=V)y=P.RotWith(U,w.input,$c*F),c.push(y),v=P.RotWith(U,w.input,$c+$c*-F),u.push(v)}f=y,g=v,L&&(S=!0);continue}if(S=!1,w===o||w===s){const D=P.Per(T).mul(w.radius);c.push(P.Sub(_,D)),u.push(P.Add(_,D));continue}const K=P.Lrp(M,T,A).per().mul(w.radius);y=P.Sub(_,K),(b<=1||P.Dist2(f,y)>a)&&(c.push(y),f=y),v=P.Add(_,K),(b<=1||P.Dist2(g,v)>a)&&(u.push(v),g=v),h=T}return{left:c,right:u}}function y_(n,e={}){const{size:t=16,start:r={},end:o={},last:s=!1}=e,{cap:i=!0}=r,{cap:a=!0}=o;if(n.length===0||t<=0)return[];const c=n[0],u=n[n.length-1],h=u.runningLength,f=r.taper===!1?0:r.taper===!0?Math.max(t,h):r.taper,g=o.taper===!1?0:o.taper===!0?Math.max(t,h):o.taper,{left:y,right:v}=_F(n,e),S=c.point,w=n.length>1?n[n.length-1].point:P.AddXY(c.point,1,1);if(n.length===1&&(!(f||g)||s)){const E=P.Add(S,P.Sub(S,w).uni().per().mul(-c.radius)),M=[];for(let A=1/13,R=A;R<=1;R+=A)M.push(P.RotWith(E,S,$c*2*R));return M}const b=[];if(!(f||g&&n.length===1))if(i)for(let E=1/8,M=E;M<=1;M+=E){const A=P.RotWith(v[0],S,$c*M);b.push(A)}else{const E=P.Sub(y[0],v[0]),M=P.Mul(E,.5),A=P.Mul(E,.51);b.push(P.Sub(S,M),P.Sub(S,A),P.Add(S,A),P.Add(S,M))}const _=[],T=u.vector.clone().per().neg();if(g||f&&n.length===1)_.push(w);else if(a){const E=P.Add(w,P.Mul(T,u.radius));for(let M=1/29,A=M;A<1;A+=M)_.push(P.RotWith(E,w,$c*3*A))}else _.push(P.Add(w,P.Mul(T,u.radius)),P.Add(w,P.Mul(T,u.radius*.99)),P.Sub(w,P.Mul(T,u.radius*.99)),P.Sub(w,P.Mul(T,u.radius)));return y.concat(_,v.reverse(),b)}const dee=.025,hee=.01;function zs(n,e={}){var w;const{streamline:t=.5,size:r=16,simulatePressure:o=!1}=e;if(n.length===0)return[];const s=.15+(1-t)*.85;let i=n.map(P.From),a=0;if(!o){let b=i[0];for(;b&&!(b.z>=dee);)i.shift(),b=i[0]}if(!o){let b=i[i.length-1];for(;b&&!(b.z>=hee);)i.pop(),b=i[i.length-1]}if(i.length===0)return[{point:P.From(n[0]),input:P.From(n[0]),pressure:o?.5:.15,vector:new P(1,1),distance:0,runningLength:0,radius:1}];let c=i[1];for(;c&&!(P.Dist2(c,i[0])>(r/3)**2);)i[0].z=Math.max(i[0].z,c.z),i.splice(1,1),c=i[1];const u=i.pop();for(c=i[i.length-1];c&&!(P.Dist2(c,u)>(r/3)**2);)i.pop(),c=i[i.length-1],a++;i.push(u);const h=e.last||!e.simulatePressure||i.length>1&&P.Dist2(i[i.length-1],i[i.length-2])<r**2||a>0;if(i.length===2&&e.simulatePressure){const b=i[1];i=i.slice(0,-1);for(let _=1;_<5;_++){const T=P.Lrp(i[0],b,_/4);T.z=(i[0].z+(b.z-i[0].z))*_/4,i.push(T)}}const f=[{point:i[0],input:i[0],pressure:o?.5:i[0].z,vector:new P(1,1),distance:0,runningLength:0,radius:1}];let g=0,y=f[0],v,S;h&&t>0&&i.push(i[i.length-1].clone());for(let b=1,_=i.length;b<_;b++)v=!s||e.last&&b===_-1?i[b].clone():i[b].clone().lrp(y.point,1-s),!y.point.equals(v)&&(S=P.Dist(v,y.point),g+=S,!(b<4&&g<r)&&(y={input:i[b],point:v,pressure:o?.5:i[b].z,vector:P.Sub(y.point,v).uni(),distance:S,runningLength:g,radius:1},f.push(y)));if((w=f[1])!=null&&w.vector&&(f[0].vector=f[1].vector.clone()),g<1){const b=Math.max(.5,...f.map(_=>_.pressure));f.forEach(_=>_.pressure=b)}return f}const{min:ea}=Math,vx=.275;function Em(n,e){const{size:t=16,thinning:r=.5,simulatePressure:o=!0,easing:s=w=>w,start:i={},end:a={}}=e,{easing:c=xn.easeOutQuad}=i,{easing:u=xn.easeOutCubic}=a,h=n[n.length-1].runningLength;let f,g=n[0].pressure,y;if(!o&&h<t){const w=n.reduce((b,_)=>Math.max(b,_.pressure),.5);return n.forEach(b=>{b.pressure=w,b.radius=t*s(.5-r*(.5-b.pressure))}),n}else{let w;for(let b=0,_=n.length;b<_&&(y=n[b],!(y.runningLength>t*5));b++){const T=ea(1,y.distance/t);if(o){const E=ea(1,1-T);w=ea(1,g+(E-g)*(T*vx))}else w=ea(1,g+(y.pressure-g)*.5);g=g+(w-g)*.5}for(let b=0;b<n.length;b++){if(y=n[b],r){let{pressure:_}=y;const T=ea(1,y.distance/t);if(o){const E=ea(1,1-T);_=ea(1,g+(E-g)*(T*vx))}else _=ea(1,g+(_-g)*(T*vx));y.radius=t*s(.5-r*(.5-_)),g=_}else y.radius=t/2;f===void 0&&(f=y.radius)}}const v=i.taper===!1?0:i.taper===!0?Math.max(t,h):i.taper,S=a.taper===!1?0:a.taper===!0?Math.max(t,h):a.taper;if(v||S)for(let w=0;w<n.length;w++){y=n[w];const{runningLength:b}=y,_=b<v?c(b/v):1,T=h-b<S?u((h-b)/S):1;y.radius=Math.max(.01,y.radius*Math.min(_,T))}return n}function pee(n,e={}){return y_(Em(zs(n,e),e),e)}function jT({scribble:n,zoom:e,color:t,opacity:r,className:o}){if(!n.points.length)return null;const s=pee(n.points,{size:n.size/e,start:{taper:n.taper,easing:xn.linear},last:n.state==="stopping",simulatePressure:!1,streamline:.32});let i;if(s.length<4){const a=n.size/e/2,{x:c,y:u}=n.points[n.points.length-1];i=`M ${c-a},${u} a ${a},${a} 0 1,0 ${a*2},0 a ${a},${a} 0 1,0 ${-a*2},0`}else i=p1(s);return p.jsx("svg",{className:o&&Fe("tl-overlays__item",o),children:p.jsx("path",{className:"tl-scribble",d:i,fill:t??`var(--color-${n.color})`,opacity:r??n.opacity})})}const fee=({bounds:n,rotation:e})=>{const t=te();return re("should display",()=>t.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[t])?p.jsx(cR,{bounds:n,rotation:e}):null};function gee({size:n,width:e,height:t,hideAlternateHandles:r}){const o=ee(n/3),s=o/2;return p.jsxs("svg",{className:"tl-overlays__item",children:[p.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${ee(0-s)},${ee(n)} 
						${ee(0-s)},${ee(0-s)} 
						${ee(n)},${ee(0-s)}`,strokeWidth:o,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),p.jsx("line",{className:Fe("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ee(e/2-n),y1:ee(0-s),x2:ee(e/2+n),y2:ee(0-s),strokeWidth:o,"data-testid":"selection.crop.top","aria-label":"top handle"}),p.jsx("polyline",{className:Fe("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${ee(e-n)},${ee(0-s)} 
						${ee(e+s)},${ee(0-s)} 
						${ee(e+s)},${ee(n)}`,strokeWidth:o,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),p.jsx("line",{className:Fe("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ee(e+s),y1:ee(t/2-n),x2:ee(e+s),y2:ee(t/2+n),strokeWidth:o,"data-testid":"selection.crop.right","aria-label":"right handle"}),p.jsx("polyline",{className:"tl-corner-crop-handle",points:`
						${ee(e+s)},${ee(t-n)} 
						${ee(e+s)},${ee(t+s)}
						${ee(e-n)},${ee(t+s)}`,strokeWidth:o,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),p.jsx("line",{className:Fe("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ee(e/2-n),y1:ee(t+s),x2:ee(e/2+n),y2:ee(t+s),strokeWidth:o,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),p.jsx("polyline",{className:Fe("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${ee(0+n)},${ee(t+s)} 
						${ee(0-s)},${ee(t+s)}
						${ee(0-s)},${ee(t-n)}`,strokeWidth:o,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),p.jsx("line",{className:Fe("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:ee(0-s),y1:ee(t/2-n),x2:ee(0-s),y2:ee(t/2+n),strokeWidth:o,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}const mee=On(function({bounds:e,rotation:t}){const r=te(),o=C.useRef(null),s=ao(),i=_s("top"),a=_s("right"),c=_s("bottom"),u=_s("left"),h=_s("top_left"),f=_s("top_right"),g=_s("bottom_right"),y=_s("bottom_left"),v=r.getInstanceState().cursor.type==="default",S=r.getInstanceState().isCoarsePointer,w=r.getOnlySelectedShape(),b=w&&r.isShapeOrAncestorLocked(w),_=w?r.getShapeUtil(w).expandSelectionOutlinePx(w):0;if(ru(o,e==null?void 0:e.x,e==null?void 0:e.y,1,r.getSelectionRotation(),{x:-_,y:-_}),w&&r.isShapeHidden(w)||!e)return null;e=e.clone().expandBy(_).zeroFix();const T=r.getZoomLevel(),E=r.getInstanceState().isChangingStyle,M=e.width,A=e.height,R=8/T,L=M<R*2,K=A<R*2,D=M<R*4,U=A<R*4,V=M<R*5,F=A<R*5,$=S?1.75:1,H=6/T*$,Z=(D?H/2:H)*($*.75),G=(U?H/2:H)*($*.75),q=(w?!r.getShapeUtil(w).hideSelectionBoundsFg(w):!0)&&!E;let Q=q&&r.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle","select.pointing_resize_handle")||q&&r.isIn("select.resizing")&&w&&r.isShapeOfType(w,"text");w&&Q&&kt.isFirefox&&r.isShapeOfType(w,"embed")&&(Q=!1);const ae=r.isInAny("select.crop.idle","select.crop.pointing_crop","select.crop.pointing_crop_handle")&&!E&&!s,B=r.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!E&&!s,oe=!S&&!(L||K)&&(B||ae)&&(w?!r.getShapeUtil(w).hideRotateHandle(w):!0)&&!b,pe=S&&(!D||!U)&&(B||ae)&&(w?!r.getShapeUtil(w).hideRotateHandle(w):!0)&&!b,_e=B&&(w?r.getShapeUtil(w).canResize(w)&&!r.getShapeUtil(w).hideResizeHandles(w):!0)&&!ae&&!b,ue=L||K,Ne=L&&K,Te=V||F,we=_e||ae,Ie=!oe,Ve=!B||!pe,Xe=!B||!we,Zt=!B||!we||ue,vt=!B||!we||ue,Ut=!B||!we||Ne&&!ae;let St=!0,It=!0;if(ae)St=Te,It=Te;else if(_e){St=ue||Ne||S;const fr=S&&w&&w.type==="text";It=St&&!fr}const tr=Math.min(24/T,A-G*3),ls=B&&S&&w&&r.isShapeOfType(w,"text")&&tr*T>=4;return p.jsx("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:p.jsxs("g",{ref:o,children:[Q&&p.jsx("rect",{className:"tl-selection__fg__outline",width:ee(M),height:ee(A)}),p.jsx(Zp,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:H,corner:"top_left_rotate",cursor:v?qr("nwse-rotate",t):void 0,isHidden:Ie}),p.jsx(Zp,{"data-testid":"selection.rotate.top-right",cx:M+H*3,cy:0,targetSize:H,corner:"top_right_rotate",cursor:v?qr("nesw-rotate",t):void 0,isHidden:Ie}),p.jsx(Zp,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:A+H*3,targetSize:H,corner:"bottom_left_rotate",cursor:v?qr("swne-rotate",t):void 0,isHidden:Ie}),p.jsx(Zp,{"data-testid":"selection.rotate.bottom-right",cx:M+H*3,cy:A+H*3,targetSize:H,corner:"bottom_right_rotate",cursor:v?qr("senw-rotate",t):void 0,isHidden:Ie}),p.jsx(vee,{"data-testid":"selection.rotate.mobile",cx:D?-H*1.5:M/2,cy:D?A/2:-H*1.5,size:R,isHidden:Ve}),p.jsx("rect",{className:Fe("tl-transparent",{"tl-hidden":St}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:ee(0-(U?G*2:G)),width:ee(M),height:ee(Math.max(1,G*2)),style:v?{cursor:qr("ns-resize",t)}:void 0,...i}),p.jsx("rect",{className:Fe("tl-transparent",{"tl-hidden":It}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:ee(M-(D?0:Z)),y:0,height:ee(A),width:ee(Math.max(1,Z*2)),style:v?{cursor:qr("ew-resize",t)}:void 0,...a}),p.jsx("rect",{className:Fe("tl-transparent",{"tl-hidden":St}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:ee(A-(U?0:G)),width:ee(M),height:ee(Math.max(1,G*2)),style:v?{cursor:qr("ns-resize",t)}:void 0,...c}),p.jsx("rect",{className:Fe("tl-transparent",{"tl-hidden":It}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:ee(0-(D?Z*2:Z)),y:0,height:ee(A),width:ee(Math.max(1,Z*2)),style:v?{cursor:qr("ew-resize",t)}:void 0,...u}),p.jsx("rect",{className:Fe("tl-transparent",{"tl-hidden":Xe}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:ee(0-(D?Z*2:Z*1.5)),y:ee(0-(U?G*2:G*1.5)),width:ee(Z*3),height:ee(G*3),style:v?{cursor:qr("nwse-resize",t)}:void 0,...h}),p.jsx("rect",{className:Fe("tl-transparent",{"tl-hidden":Zt}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:ee(M-(D?0:Z*1.5)),y:ee(0-(U?G*2:G*1.5)),width:ee(Z*3),height:ee(G*3),style:v?{cursor:qr("nesw-resize",t)}:void 0,...f}),p.jsx("rect",{className:Fe("tl-transparent",{"tl-hidden":Ut}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:ee(M-(D?Z:Z*1.5)),y:ee(A-(U?G:G*1.5)),width:ee(Z*3),height:ee(G*3),style:v?{cursor:qr("nwse-resize",t)}:void 0,...g}),p.jsx("rect",{className:Fe("tl-transparent",{"tl-hidden":vt}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:ee(0-(D?Z*3:Z*1.5)),y:ee(A-(U?0:G*1.5)),width:ee(Z*3),height:ee(G*3),style:v?{cursor:qr("nesw-resize",t)}:void 0,...y}),_e&&p.jsxs(p.Fragment,{children:[p.jsx("rect",{"data-testid":"selection.resize.top-left",className:Fe("tl-corner-handle",{"tl-hidden":Xe}),"aria-label":"top_left handle",x:ee(0-R/2),y:ee(0-R/2),width:ee(R),height:ee(R)}),p.jsx("rect",{"data-testid":"selection.resize.top-right",className:Fe("tl-corner-handle",{"tl-hidden":Zt}),"aria-label":"top_right handle",x:ee(M-R/2),y:ee(0-R/2),width:ee(R),height:ee(R)}),p.jsx("rect",{"data-testid":"selection.resize.bottom-right",className:Fe("tl-corner-handle",{"tl-hidden":Ut}),"aria-label":"bottom_right handle",x:ee(M-R/2),y:ee(A-R/2),width:ee(R),height:ee(R)}),p.jsx("rect",{"data-testid":"selection.resize.bottom-left",className:Fe("tl-corner-handle",{"tl-hidden":vt}),"aria-label":"bottom_left handle",x:ee(0-R/2),y:ee(A-R/2),width:ee(R),height:ee(R)})]}),ls&&p.jsxs(p.Fragment,{children:[p.jsx("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:ee(0-R/4),y:ee(A/2-tr/2),rx:R/4,width:ee(R/2),height:ee(tr)}),p.jsx("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:R/4,x:ee(M-R/4),y:ee(A/2-tr/2),width:ee(R/2),height:ee(tr)})]}),ae&&p.jsx(gee,{size:R,width:M,height:A,hideAlternateHandles:Te})]})})}),Zp=function({cx:e,cy:t,targetSize:r,corner:o,cursor:s,isHidden:i,"data-testid":a}){const c=_s(o);return p.jsx("rect",{className:Fe("tl-transparent","tl-rotate-corner",{"tl-hidden":i}),"data-testid":a,"aria-label":`${o} target`,pointerEvents:"all",x:ee(e-r*3),y:ee(t-r*3),width:ee(Math.max(1,r*3)),height:ee(Math.max(1,r*3)),cursor:s,...c})},yee=Math.sqrt(Math.PI),vee=function({cx:e,cy:t,size:r,isHidden:o,"data-testid":s}){const i=_s("mobile_rotate"),a=te(),c=re("zoom level",()=>a.getZoomLevel(),[a]),u=Math.max(14*(1/c),20/Math.max(1,c));return p.jsxs("g",{children:[p.jsx("circle",{"data-testid":s,pointerEvents:"all",className:Fe("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":o}),cx:e,cy:t,r:u,...i}),p.jsx("circle",{className:Fe("tl-mobile-rotate__fg",{"tl-hidden":o}),cx:e,cy:t,r:r/yee})]})};function See(){const n=te();return re("is in a valid select state",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle"),[n])?p.jsx(uR,{}):null}function Bw(n,e,t){const{arrowheadStart:r,arrowheadEnd:o}=e.props,s=Tc(n,e,t),i=s.start.clone(),a=s.end.clone(),c=P.Med(i,a);if(P.Equals(i,a))return{bindings:t,isStraight:!0,start:{handle:i,point:i,arrowhead:e.props.arrowheadStart},end:{handle:a,point:a,arrowhead:e.props.arrowheadEnd},middle:c,isValid:!1,length:0};const u=P.Sub(a,i).uni(),h=xg(n,e,"start"),f=xg(n,e,"end"),g=n.getShapePageTransform(e);RT(a,s.start,g,f),RT(i,s.end,g,h);let y=0,v=0,S=0,w=0,b=Mc*e.props.scale;const _=h&&f&&h.shape===f.shape,T=h&&f?v_(n,h.shape.id,f.shape.id):"safe";T==="safe"&&h&&f&&!_&&!h.isExact&&!f.isExact&&(f.didIntersect&&!h.didIntersect?h.isClosed&&i.setTo(a.clone().add(u.clone().mul(Mc*e.props.scale))):f.didIntersect||f.isClosed&&a.setTo(i.clone().sub(u.clone().mul(Mc*e.props.scale))));const E=P.Sub(a,i),M=P.Len(E)?E.uni():P.From(E),A=!P.Equals(M,u);_||(T!=="start-contains-end"&&h&&r!=="none"&&!h.isExact&&(S=Ts[e.props.size]/2+("size"in h.shape.props?Ts[h.shape.props.size]/2:0),y=(wg+S)*e.props.scale,b+=S*e.props.scale),T!=="end-contains-start"&&f&&o!=="none"&&!f.isExact&&(w=Ts[e.props.size]/2+("size"in f.shape.props?Ts[f.shape.props.size]/2:0),v=(wg+w)*e.props.scale,b+=w*e.props.scale));const R=i.clone().add(M.clone().mul(y*(A?-1:1))),L=a.clone().sub(M.clone().mul(v*(A?-1:1)));P.DistMin(R,L,b)&&(y!==0&&v!==0?(y*=-1.5,v*=-1.5):y!==0?y*=-1:v!==0&&(v*=-1)),i.add(M.clone().mul(y*(A?-1:1))),a.sub(M.clone().mul(v*(A?-1:1))),A?(h&&f&&a.setTo(P.Add(i,M.clone().mul(-Mc*e.props.scale))),c.setTo(P.Med(s.start,s.end))):c.setTo(P.Med(i,a));const K=P.Dist(i,a);return{bindings:t,isStraight:!0,start:{handle:s.start,point:i,arrowhead:e.props.arrowheadStart},end:{handle:s.end,point:a,arrowhead:e.props.arrowheadEnd},middle:c,isValid:K>0,length:K}}function RT(n,e,t,r){if(r===void 0||r.isExact)return;const o=ye.applyToPoint(t,e),s=ye.applyToPoint(t,n),i=ye.applyToPoint(ye.Inverse(r.transform),o),a=ye.applyToPoint(ye.Inverse(r.transform),s),c=r.isClosed,h=(c?v1:TK)(i,a,r.outline);let f;if(h!==null&&(f=h.sort((v,S)=>P.Dist2(v,i)-P.Dist2(S,i))[0]??(c?void 0:a)),f===void 0)return;const g=ye.applyToPoint(r.transform,f),y=ye.applyToPoint(ye.Inverse(t),g);n.setTo(y),r.didIntersect=!0}function xee(n,e,t){const{arrowheadEnd:r,arrowheadStart:o}=e.props,s=e.props.bend;if(Math.abs(s)>Math.abs(e.props.bend*(Cee*e.props.scale)))return Bw(n,e,t);const i=Tc(n,e,t),a=P.Med(i.start,i.end),c=P.Sub(i.end,i.start),u=P.Len(c)?c.uni():P.From(c),h=P.Add(a,u.per().mul(-s)),f=xg(n,e,"start"),g=xg(n,e,"end"),y=i.start.clone(),v=i.end.clone(),S=h.clone();if(P.Equals(y,v))return{bindings:t,isStraight:!0,start:{handle:y,point:y,arrowhead:e.props.arrowheadStart},end:{handle:v,point:v,arrowhead:e.props.arrowheadEnd},middle:S,isValid:!1,length:0};const w=e.props.bend<0,b=w?Zd:Hj,_=OT(y,v,S),T=P.Angle(_.center,y),E=P.Angle(_.center,v),M=b(T,E);if(_.length===0||_.size===0||!lk(_.length)||!lk(_.size))return Bw(n,e,t);const A=y.clone(),R=v.clone(),L=S.clone(),K=n.getShapePageTransform(e);let D=0,U=0,V=Mc*e.props.scale;if(f&&!f.isExact){const ae=ye.applyToPoint(K,A),B=ye.applyToPoint(K,_.center),oe=ye.applyToPoint(K,R),pe=ye.Inverse(f.transform),_e=ye.applyToPoint(pe,ae),ue=ye.applyToPoint(pe,B),Ne=ye.applyToPoint(pe,oe),{isClosed:Te}=f,we=Te?yw:Mk;let Ie,Ve=we(ue,_.radius,f.outline);if(Ve){const Xe=ue.angle(_e),Zt=ue.angle(Ne),vt=b(Xe,Zt);Ve=Ve.filter(St=>b(Xe,ue.angle(St))<=vt);const Ut=vt*.25;Ve.sort(Te?(St,It)=>Math.abs(b(Xe,ue.angle(St))-Ut)<Math.abs(b(Xe,ue.angle(It))-Ut)?-1:1:(St,It)=>b(Xe,ue.angle(St))<b(Xe,ue.angle(It))?-1:1),Ie=Ve[0]??(Te?void 0:_e)}else Ie=Te?void 0:_e;if(Ie&&(A.setTo(n.getPointInShapeSpace(e,ye.applyToPoint(f.transform,Ie))),f.didIntersect=!0,o!=="none")){const Xe=Ts[e.props.size]/2+("size"in f.shape.props?Ts[f.shape.props.size]/2:0);D=(wg+Xe)*e.props.scale,V+=Xe*e.props.scale}}if(g&&!g.isExact){const ae=ye.applyToPoint(K,A),B=ye.applyToPoint(K,R),oe=ye.applyToPoint(K,_.center),pe=ye.Inverse(g.transform),_e=ye.applyToPoint(pe,ae),ue=ye.applyToPoint(pe,oe),Ne=ye.applyToPoint(pe,B),Te=g.isClosed,we=Te?yw:Mk;let Ie,Ve=we(ue,_.radius,g.outline);if(Ve){const Xe=ue.angle(_e),Zt=ue.angle(Ne),vt=b(Xe,Zt),Ut=vt*.75;Ve=Ve.filter(St=>b(Xe,ue.angle(St))<=vt),Ve.sort(Te?(St,It)=>Math.abs(b(Xe,ue.angle(St))-Ut)<Math.abs(b(Xe,ue.angle(It))-Ut)?-1:1:(St,It)=>b(Xe,ue.angle(St))<b(Xe,ue.angle(It))?-1:1),Ve[0]?Ie=Ve[0]:Ie=Te?void 0:Ne}else Ie=Te?void 0:Ne;if(Ie&&(R.setTo(n.getPointInShapeSpace(e,ye.applyToPoint(g.transform,Ie))),g.didIntersect=!0,r!=="none")){const Xe=Ts[e.props.size]/2+("size"in g.shape.props?Ts[g.shape.props.size]/2:0);U=(wg+Xe)*e.props.scale,V+=Xe*e.props.scale}}let F=P.Angle(_.center,A),$=P.Angle(_.center,R),H=b(F,$),Z=H*_.radius;const G=A.clone(),q=R.clone();if(D!==0&&G.setTo(_.center).add(P.FromAngle(F+H*(D/Z*(w?1:-1))).mul(_.radius)),U!==0&&q.setTo(_.center).add(P.FromAngle($+H*(U/Z*(w?-1:1))).mul(_.radius)),P.DistMin(G,q,V)&&(D!==0&&U!==0?(D*=-1.5,U*=-1.5):D!==0?D*=-2:U!==0&&(U*=-2)),D!==0&&A.setTo(_.center).add(P.FromAngle(F+H*(D/Z*(w?1:-1))).mul(_.radius)),U!==0&&R.setTo(_.center).add(P.FromAngle($+H*(U/Z*(w?-1:1))).mul(_.radius)),f&&g&&!f.isExact&&!g.isExact){F=P.Angle(_.center,A),$=P.Angle(_.center,R),H=b(F,$),Z=H*_.radius;const ae=v_(n,f.shape.id,g.shape.id);ae==="double-bound"&&Z<30?(A.setTo(y),R.setTo(v),L.setTo(S)):ae==="safe"&&(f&&!f.didIntersect&&A.setTo(y),(g&&!g.didIntersect||b(T,F)>b(T,$))&&R.setTo(_.center).add(P.FromAngle(F+H*(Math.min(.9,Mc*e.props.scale/Z)*(w?1:-1))).mul(_.radius)))}wee(_.center,_.radius,A,R,L,M,w),A.equals(R)&&(A.setTo(L.clone().addXY(1,1)),R.setTo(L.clone().subXY(1,1))),y.setTo(A),v.setTo(R),S.setTo(L);const Q=OT(y,v,S);return{bindings:t,isStraight:!1,start:{point:y,handle:i.start,arrowhead:e.props.arrowheadStart},end:{point:v,handle:i.end,arrowhead:e.props.arrowheadEnd},middle:S,handleArc:_,bodyArc:Q,isValid:Q.length!==0&&isFinite(Q.center.x)&&isFinite(Q.center.y)}}function OT(n,e,t){const r=c1(n,e,t)??P.Med(n,e),o=P.Dist(r,n),s=+P.Clockwise(n,t,e),i=((n.y-e.y)**2+(n.x-e.x)**2)**.5,a=((e.y-t.y)**2+(e.x-t.x)**2)**.5,c=((t.y-n.y)**2+(t.x-n.x)**2)**.5,u=Math.acos((a*a+c*c-i*i)/(2*a*c))*2,h=+(ft>u),f=(xt-u)*(s?1:-1),g=f*o;return{center:r,radius:o,size:f,length:g,largeArcFlag:h,sweepFlag:s}}function wee(n,e,t,r,o,s,i){const a=P.Angle(n,t),c=P.Angle(n,r);let u=Zd(a,c);if(i||(u=xt-u),o.setTo(n).add(P.FromAngle(a+u*(.5*(i?1:-1))).mul(e)),u>s){o.rotWith(n,ft);const h=r.clone();r.setTo(t),t.setTo(h)}}const bee=8;function _ee(n){return Math.abs(n.props.bend)<bee*n.props.scale}function xg(n,e,t){const r=n.getBindingsFromShape(e,"arrow").find(c=>c.props.terminal===t);if(!r)return;const o=n.getShape(r.toId);if(!o)return;const s=n.getShapePageTransform(o),i=n.getShapeGeometry(o),a=i instanceof To?i.children[0].vertices:i.vertices;return{shape:o,transform:s,isClosed:i.isClosed,isExact:r.props.isExact,didIntersect:!1,outline:a}}function DT(n,e,t,r){const o=n.getShape(t.toId);if(o){const{point:s,size:i}=n.getShapeGeometry(o).bounds,a=P.Add(s,P.MulV(t.props.isPrecise||r?t.props.normalizedAnchor:{x:.5,y:.5},i)),c=ye.applyToPoint(n.getShapePageTransform(o),a);return ye.applyToPoint(ye.Inverse(e),c)}else return new P(0,0)}function jr(n,e){const t=n.getBindingsFromShape(e,"arrow");return{start:t.find(r=>r.props.terminal==="start"),end:t.find(r=>r.props.terminal==="end")}}const Pee=I9("arrow info",(n,e)=>{const t=jr(n,e);return _ee(e)?Bw(n,e,t):xee(n,e,t)});function ks(n,e){const t=typeof e=="string"?e:e.id;return Pee.get(n,t)}function Tc(n,e,t){var a,c;const r=n.getShapePageTransform(e),o=v_(n,(a=t.start)==null?void 0:a.toId,(c=t.end)==null?void 0:c.toId),s=t.start?DT(n,r,t.start,o==="double-bound"||o==="start-contains-end"):P.From(e.props.start),i=t.end?DT(n,r,t.end,o==="double-bound"||o==="end-contains-start"):P.From(e.props.end);return{start:s,end:i}}function rd(n,e,t,r){const o=typeof e=="string"?e:e.id,s=typeof t=="string"?t:t.id,i=n.getBindingsFromShape(o,"arrow").filter(c=>c.props.terminal===r.terminal);i.length>1&&n.deleteBindings(i.slice(1));const a=i[0];a?n.updateBinding({...a,toId:s,props:r}):n.createBinding({type:"arrow",fromId:o,toId:s,props:r})}function Sf(n,e,t){const r=n.getBindingsFromShape(e,"arrow").filter(o=>o.props.terminal===t);n.deleteBindings(r)}const Mc=10,wg=10,Cee=10,Ts={s:2,m:3.5,l:5,xl:10};function v_(n,e,t){if(!e||!t)return"safe";if(e===t)return"double-bound";const r=n.getShapePageBounds(e),o=n.getShapePageBounds(t);if(r&&o){if(r.contains(o))return"start-contains-end";if(o.contains(r))return"end-contains-start"}return"safe"}class xf extends ff{getDefaultProps(){return{isPrecise:!1,isExact:!1,normalizedAnchor:{x:.5,y:.5}}}onAfterCreate({binding:e}){const t=this.editor.getShape(e.fromId);t&&Sx(this.editor,t)}onAfterChange({bindingAfter:e}){const t=this.editor.getShape(e.fromId);t&&Sx(this.editor,t)}onAfterChangeFromShape({shapeAfter:e}){Sx(this.editor,e)}onAfterChangeToShape({binding:e}){PF(this.editor,e.fromId)}onBeforeIsolateFromShape({binding:e}){const t=this.editor.getShape(e.fromId);t&&bg({editor:this.editor,arrow:t,terminal:e.props.terminal})}}j(xf,"type","arrow"),j(xf,"props",uj),j(xf,"migrations",dj);function PF(n,e){var w;const t=n.getShape(e);if(!t)return;const r=jr(n,t),{start:o,end:s}=r,i=o?n.getShape(o.toId):void 0,a=s?n.getShape(s.toId):void 0,c=n.getAncestorPageId(t);if(!c)return;let u;if(i&&a)u=n.findCommonAncestor([i,a])??c;else if(i||a){const b=(w=i||a)==null?void 0:w.parentId;b&&b===t.parentId?u=t.parentId:u=c}else return;u&&u!==t.parentId&&n.reparentShapes([e],u);const h=n.getShape(e);if(!h)throw Error("no reparented arrow");const f=n.getShapeNearestSibling(h,i),g=n.getShapeNearestSibling(h,a);let y;if(f&&g)y=f.index>g.index?f:g;else if(f&&!g)y=f;else if(g&&!f)y=g;else return;let v;const S=n.getSortedChildIdsForParent(y.parentId).map(b=>n.getShape(b)).filter(b=>b.index>y.index);if(S.length){const b=S.find(_=>_.type!=="arrow");if(h.index>y.index&&(!b||h.index<b.index))return;v=jd(y.index,S[0].index)}else v=Is(y.index);v!==h.index&&n.updateShapes([{id:e,type:"arrow",index:v}])}function Sx(n,e){const t=jr(n,e);for(const r of["start","end"]){const o=t[r];if(!o)continue;const s=n.getShape(o.toId),i=n.getAncestorPageId(e)===n.getAncestorPageId(s);(!s||!i)&&bg({editor:n,arrow:e,terminal:r,unbind:!0})}PF(n,e.id)}function bg({editor:n,arrow:e,terminal:t,unbind:r=!1,useHandle:o=!1}){const s=ks(n,e);if(!s)throw new Error("expected arrow info");const i=o?s.start.handle:s.start.point,a=o?s.end.handle:s.end.point,c=t==="start"?i:a,u={id:e.id,type:"arrow",props:{[t]:{x:c.x,y:c.y},bend:e.props.bend}};if(!s.isStraight){const h=t==="start"?i:s.start.handle,f=t==="end"?a:s.end.handle,g=P.Med(h,f),y=P.Sub(h,f).per().uni().mul(s.handleArc.radius*2*Math.sign(e.props.bend)),v=nh(s.handleArc.center,P.Add(g,y),s.handleArc.center,s.handleArc.radius);yt((v==null?void 0:v.length)===1);const S=P.Dist(g,v[0])*Math.sign(e.props.bend);pa(S,u.props.bend)||(u.props.bend=S)}n.updateShape(u),r&&Sf(n,e,t)}const CF=[xf],Zn={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},Xn={s:2,m:3.5,l:5,xl:10},Hc={s:18,m:24,l:36,xl:44},Si={s:18,m:22,l:26,xl:32},Iee={s:18,m:20,l:24,xl:28},bi={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"},Eee=20,_g=4.25,Po=16;function kee(n,e){const t=n.w/e.w,r=n.h/e.h;return t<=1&&r<=1?n:t>r?{w:n.w/t,h:n.h/t}:{w:n.w/r,h:n.h/r}}/*!
 * MIT License
 * Adapted (mostly copied) the work of https://github.com/fregante/text-field-edit
 * Copyright (c) Federico Brigante <opensource@bfred.it> (bfred.it)
 */const Ac="  ",sr=class sr{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){const r=e.ownerDocument,o=r.activeElement;o!==e&&e.focus(),r.execCommand("insertText",!1,t)||sr.insertTextFirefox(e,t),o===r.body?e.blur():o instanceof HTMLElement&&o!==e&&o.focus()}static set(e,t){e.select(),sr.insert(e,t)}static getSelection(e){const{selectionStart:t,selectionEnd:r}=e;return e.value.slice(t||void 0,r||void 0)}static wrapSelection(e,t,r){const{selectionStart:o,selectionEnd:s}=e,i=sr.getSelection(e);sr.insert(e,t+i+(r??t)),e.selectionStart=(o||0)+t.length,e.selectionEnd=(s||0)+t.length}static replace(e,t,r){let o=0;e.value.replace(t,(...s)=>{const i=o+s[s.length-2],a=s[0].length;e.selectionStart=i,e.selectionEnd=i+a;const c=typeof r=="string"?r:r(...s);return sr.insert(e,c),e.selectionStart=i,o+=c.length-a,c})}static findLineEnd(e,t){const r=e.lastIndexOf(`
`,t-1)+1;return e.charAt(r)!=="	"?t:r+1}static indent(e){var a;const{selectionStart:t,selectionEnd:r,value:o}=e,s=o.slice(t,r),i=(a=/\n/g.exec(s))==null?void 0:a.length;if(i&&i>0){const c=o.lastIndexOf(`
`,t-1)+1,u=e.value.slice(c,r-1),h=u.replace(/^|\n/g,`$&${Ac}`),f=h.length-u.length;e.setSelectionRange(c,r-1),sr.insert(e,h),e.setSelectionRange(t+1,r+f)}else sr.insert(e,Ac)}static unindent(e){const{selectionStart:t,selectionEnd:r,value:o}=e,s=o.lastIndexOf(`
`,t-1)+1,i=sr.findLineEnd(o,r),a=e.value.slice(s,i),c=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=a.length-c.length;e.setSelectionRange(s,i),sr.insert(e,c);const h=/\t| {1,2}/.exec(o.slice(s,t)),f=h?h[0].length:0,g=t-f;e.setSelectionRange(t-f,Math.max(g,r-u))}static indentCE(e){var c;const t=window.getSelection(),r=e.innerText,o=Qp(e)??0,s=Qp(e)??0,i=r.slice(o,s),a=(c=/\n/g.exec(i))==null?void 0:c.length;if(a&&a>0){const u=r.lastIndexOf(`
`,o-1)+1,h=r.slice(u,s-1),g=h.replace(/^|\n/g,`$&${Ac}`).length-h.length;t&&t.setBaseAndExtent(e,o+1,e,s+g)}else{const u=window.getSelection();e.innerText=r.slice(0,o)+Ac+r.slice(o),u==null||u.setBaseAndExtent(e,o+1,e,o+2)}}static unindentCE(e){const t=window.getSelection(),r=e.innerText,o=Qp(e)??0,s=Qp(e)??0,i=r.lastIndexOf(`
`,o-1)+1,a=sr.findLineEnd(r,s),c=r.slice(i,a),u=c.replace(/(^|\n)(\t| {1,2})/g,"$1"),h=c.length-u.length;if(t){t.setBaseAndExtent(e,i,e,a);const f=/\t| {1,2}/.exec(r.slice(i,o)),g=f?f[0].length:0,y=o-g;t.setBaseAndExtent(e,o-g,e,Math.max(y,s-h))}}static normalizeText(e){return e.replace(sr.fixNewLines,`
`)}static normalizeTextForDom(e){return e.replace(sr.fixNewLines,`
`).split(`
`).map(t=>t||" ").join(`
`)}};j(sr,"fixNewLines",/\r?\n|\r/g);let Kc=sr;function Qp(n){if(typeof window.getSelection>"u")return;const e=window.getSelection();if(!e)return;let t=0;if(e.rangeCount!==0){const r=e.getRangeAt(0),o=r.cloneRange();o.selectNodeContents(n),o.setEnd(r.endContainer,r.endOffset),t=o.toString().length}return t}const Tee=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function IF(n){return Tee.test(n)}function Mee(n){return n.replace(/\t/g,Ac)}function Aee(n){const e=n.split(`
`);for(;e[0]&&e[0].trim().length===0;)e.shift();let t=1/0;for(const r of e)if(r.trim().length>0){const o=r.length-r.trimStart().length;t=Math.min(t,o)}return e.map(r=>r.slice(t)).join(`
`)}const EF={"&amp;":"&","&quot;":'"',"&apos;":"'","&#34;":'"',"&#38;":"&","&#39;":"'","&#8211;":"–","&#8212;":"—","&#8216;":"‘","&#8217;":"’","&#8220;":"“","&#8221;":"”","&#8230;":"…"},jee=new RegExp(Object.keys(EF).join("|"),"g");function Ree(n){return n.replace(jee,e=>EF[e])}function Oee(n){return n.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function Dee(n){return Oee(Aee(Mee(n)))}function Lee(n,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:o},{toasts:s,msg:i}){n.registerExternalAssetHandler("file",async({file:a,assetId:c})=>{const u=r.includes(a.type),h=o.includes(a.type);!u&&!h&&s.addToast({title:i("assets.files.type-not-allowed"),severity:"error"}),yt(u||h,`File type not allowed: ${a.type}`),a.size>t&&s.addToast({title:i("assets.files.size-too-big"),severity:"error"}),yt(a.size<=t,`File size too big: ${(a.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`);const f=pI(await a.arrayBuffer());c=c??sa.createId(f);const g=await LT(a,c,u,h);if(isFinite(e)){const y={w:g.props.w,h:g.props.h},v=kee(y,{w:e,h:e});y!==v&&Zr.isStaticImageType(a.type)&&(g.props.w=v.w,g.props.h=v.h)}return g.props.src=await n.uploadAsset(g,a),sa.create(g)}),n.registerExternalAssetHandler("url",async({url:a})=>{var u,h,f,g,y;let c;try{const S=await(await Ds(a,{method:"GET",mode:"no-cors"})).text(),w=new DOMParser().parseFromString(S,"text/html");c={image:((u=w.head.querySelector('meta[property="og:image"]'))==null?void 0:u.getAttribute("content"))??"",favicon:((h=w.head.querySelector('link[rel="apple-touch-icon"]'))==null?void 0:h.getAttribute("href"))??((f=w.head.querySelector('link[rel="icon"]'))==null?void 0:f.getAttribute("href"))??"",title:((g=w.head.querySelector('meta[property="og:title"]'))==null?void 0:g.getAttribute("content"))??a,description:((y=w.head.querySelector('meta[property="og:description"]'))==null?void 0:y.getAttribute("content"))??""},c.image.startsWith("http")||(c.image=new URL(c.image,a).href),c.favicon.startsWith("http")||(c.favicon=new URL(c.favicon,a).href)}catch(v){console.error(v),s.addToast({title:i("assets.url.failed"),severity:"error"}),c={image:"",favicon:"",title:"",description:""}}return{id:sa.createId(ew(a)),typeName:"asset",type:"bookmark",props:{src:a,description:c.description,image:c.image,favicon:c.favicon,title:c.title},meta:{}}}),n.registerExternalContentHandler("svg-text",async({point:a,text:c})=>{const u=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),h=new DOMParser().parseFromString(c,"image/svg+xml").querySelector("svg");if(!h)throw new Error("No <svg/> element present");let f=parseFloat(h.getAttribute("width")||"0"),g=parseFloat(h.getAttribute("height")||"0");if(!(f&&g)){document.body.appendChild(h);const v=h.getBoundingClientRect();document.body.removeChild(h),f=v.width,g=v.height}const y=await n.getAssetForExternalContent({type:"file",file:new File([c],"asset.svg",{type:"image/svg+xml"})});if(!y)throw Error("Could not create an asset");FT(n,[y],u)}),n.registerExternalContentHandler("embed",({point:a,url:c,embed:u})=>{const h=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),{width:f,height:g}=u,y=Ct(),v={id:y,type:"embed",x:h.x-(f||450)/2,y:h.y-(g||450)/2,props:{w:f,h:g,url:c}};n.createShapes([v]).select(y)}),n.registerExternalContentHandler("files",async({point:a,files:c})=>{if(c.length>n.options.maxFilesAtOnce)throw Error("Too many files");const u=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),h=new P(u.x,u.y),f=[],g=[];for(const y of c){if(y.size>t){s.addToast({title:i("assets.files.size-too-big"),severity:"error"}),console.warn(`File size too big: ${(y.size/1024).toFixed()}kb > ${(t/1024).toFixed()}kb`);continue}if(!y.type){s.addToast({title:i("assets.files.upload-failed"),severity:"error"}),console.error("No mime type");continue}if(!r.concat(o).includes(y.type)){s.addToast({title:i("assets.files.type-not-allowed"),severity:"error"}),console.warn(`${y.name} not loaded - Mime type not allowed ${y.type}.`);continue}const v=r.includes(y.type),S=o.includes(y.type),w=pI(await y.arrayBuffer()),b=sa.createId(w),_=await LT(y,b,v,S);let T;v&&(T=n.createTemporaryAssetPreview(b,y)),f.push(_),g.push({asset:_,file:y,temporaryAssetPreview:T})}Promise.allSettled(g.map(async y=>{try{const v=await n.getAssetForExternalContent({type:"file",file:y.file});if(!v)throw Error("Could not create an asset");n.updateAssets([{...v,id:y.asset.id}])}catch(v){s.addToast({title:i("assets.files.upload-failed"),severity:"error"}),console.error(v);return}})),FT(n,f,h)}),n.registerExternalContentHandler("text",async({point:a,text:c})=>{const u=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),h=n.getShapeUtil("text").getDefaultProps(),f=Dee(c),g=n.getOnlySelectedShape();if(g&&"text"in g.props){n.updateShapes([{id:g.id,type:g.type,props:{text:f}}]);return}let y,v,S,w="middle";const b=f.split(`
`).length>1,_=IF(f);b&&(w=b?_?"end":"start":"middle");const T=n.textMeasure.measureText(f,{...Zn,fontFamily:bi[h.font],fontSize:Hc[h.size],maxWidth:null}),E=Math.min(b?n.getViewportPageBounds().width*.9:920,Math.max(200,n.getViewportPageBounds().width*.9));if(T.w>E){const M=n.textMeasure.measureText(f,{...Zn,fontFamily:bi[h.font],fontSize:Hc[h.size],maxWidth:E});y=M.w,v=M.h,S=!1,w=_?"end":"start"}else y=T.w,v=T.h,S=!0;u.y-v/2<n.getViewportPageBounds().minY+40&&(u.y=n.getViewportPageBounds().minY+40+v/2),n.createShapes([{id:Ct(),type:"text",x:u.x-y/2,y:u.y-v/2,props:{text:f,textAlign:w,autoSize:S,w:y}}])}),n.registerExternalContentHandler("url",async({point:a,url:c})=>{const u=n.getShapeUtil("embed"),h=u==null?void 0:u.getEmbedDefinition(c);if(h)return n.putExternalContent({type:"embed",url:h.url,point:a,embed:h.definition});const f=a??(n.inputs.shiftKey?n.inputs.currentPagePoint:n.getViewportPageBounds().center),g=sa.createId(ew(c)),y=Fee(n,c,f);let v=n.getAsset(g),S=!1;if(!v){S=!0;try{const w=await n.getAssetForExternalContent({type:"url",url:c});if(!w)throw Error("Could not create an asset");v=w}catch{s.addToast({title:i("assets.url.failed"),severity:"error"});return}}n.run(()=>{S&&n.createAssets([v]),n.updateShapes([{id:y.id,type:y.type,props:{assetId:v.id}}])})})}async function LT(n,e,t,r){let o=n.type;n.type==="video/quicktime"&&(o="video/mp4");const s=t?await Zr.getImageSize(n):await Zr.getVideoSize(n),i=await Zr.isAnimated(n)||r;return{id:e,type:t?"image":"video",typeName:"asset",props:{name:n.name,src:"",w:s.w,h:s.h,fileSize:n.size,mimeType:o,isAnimated:i},meta:{}}}async function FT(n,e,t){if(!e.length)return[];const r=P.From(t),o=[];for(let s=0;s<e.length;s++){const i=e[s];switch(i.type){case"image":{o.push({id:Ct(),type:"image",x:r.x,y:r.y,opacity:1,props:{assetId:i.id,w:i.props.w,h:i.props.h}}),r.x+=i.props.w;break}case"video":o.push({id:Ct(),type:"video",x:r.x,y:r.y,opacity:1,props:{assetId:i.id,w:i.props.w,h:i.props.h}}),r.x+=i.props.w}}return n.run(()=>{const s=e.filter(i=>!n.getAsset(i.id));s.length&&n.createAssets(s),n.createShapes(o).select(...o.map(i=>i.id)),kF(n,t)}),o.map(s=>s.id)}function kF(n,e){const t=n.getViewportPageBounds();let r=n.getSelectionPageBounds();if(r){const o=r.center.sub(e);n.updateShapes(n.getSelectedShapes().map(s=>{const i=n.getShapeParentTransform(s).decompose().rotation,a=P.Rot(o,-i);return{id:s.id,type:s.type,x:s.x-a.x,y:s.y-a.y}}))}if(r=n.getSelectionPageBounds(),r&&n.getInstanceState().isGridMode){const o=n.getDocumentSettings().gridSize,s=new P(r.minX,r.minY),i=s.clone().snapToGrid(o),a=P.Sub(s,i);n.updateShapes(n.getSelectedShapes().map(c=>{const u={x:c.x-a.x,y:c.y-a.y};return{id:c.id,type:c.type,x:u.x,y:u.y}}))}r=n.getSelectionPageBounds(),r&&!t.contains(r)&&n.zoomToSelection({animation:{duration:n.options.animationMediumMs}})}function Fee(n,e,t){const r={id:Ct(),type:"bookmark",x:t.x-150,y:t.y-160,opacity:1,props:{assetId:null,url:e}};return n.run(()=>{n.createShapes([r]).select(r.id),kF(n,t)}),n.getShape(r.id)}var Rx;let Nee=(Rx=class extends Re{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}onKeyUp(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}}},j(Rx,"id","idle"),Rx);var Ox;let $ee=(Ox=class extends Re{constructor(){super(...arguments);j(this,"shape");j(this,"markId","");j(this,"preciseTimeout",-1);j(this,"didTimeout",!1)}onEnter(){this.markId="",this.didTimeout=!1;const t=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:r=>!r.isLocked&&this.editor.canBindShapes({fromShape:"arrow",toShape:r,binding:"arrow"}),margin:0,hitInside:!0,renderingOnly:!0});t?this.editor.setHintingShapes([t.id]):this.createArrowShape(),this.startPreciseTimeout()}onExit(){this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()}onPointerMove(){if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:{id:"end",type:"vertex",index:"a3",x:0,y:0},isCreating:!0,creatingMarkId:this.markId||void 0,onInteractionEnd:"arrow"})}}onPointerUp(){this.cancel()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){var f;const{originPagePoint:t}=this.editor.inputs,r=Ct();this.markId=this.editor.markHistoryStoppingPoint(`creating_arrow:${r}`);const o=ns(t,this.editor);this.editor.createShape({id:r,type:"arrow",x:o.x,y:o.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const s=this.editor.getShape(r);if(!s)throw Error("expected shape");const i=this.editor.getShapeHandles(s);if(!i)throw Error("expected handles for arrow");const a=this.editor.getShapeUtil("arrow"),c=this.shape,u=i.find(g=>g.id==="start"),h=(f=a.onHandleDrag)==null?void 0:f.call(a,s,{handle:{...u,x:0,y:0},isPrecise:!0,initial:c});h&&this.editor.updateShapes([h]),this.shape=this.editor.getShape(r),this.editor.select(r)}updateArrowShapeEndHandle(){var o,s;const t=this.shape;if(!t)throw Error("expected shape");const r=this.editor.getShapeHandles(t);if(!r)throw Error("expected handles for arrow");{const i=this.editor.getShapeUtil("arrow"),a=this.shape,c=r.find(h=>h.id==="start"),u=(o=i.onHandleDrag)==null?void 0:o.call(i,t,{handle:{...c,x:0,y:0},isPrecise:this.didTimeout,initial:a});u&&this.editor.updateShapes([u])}{const i=this.editor.getShapeUtil("arrow"),a=this.shape,c=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint),u=r.find(f=>f.id==="end"),h=(s=i.onHandleDrag)==null?void 0:s.call(i,this.editor.getShape(t),{handle:{...u,x:c.x,y:c.y},isPrecise:!1,initial:a});h&&this.editor.updateShapes([h])}this.shape=this.editor.getShape(t.id)}startPreciseTimeout(){this.preciseTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}},j(Ox,"id","pointing"),Ox);class Uw extends Re{constructor(){super(...arguments);j(this,"shapeType","arrow")}static children(){return[Nee,$ee]}}j(Uw,"id","arrow"),j(Uw,"initial","idle");class S_ extends Re{constructor(){super(...arguments);j(this,"info",{});j(this,"initialShape");j(this,"shapeType",this.parent.id==="highlight"?"highlight":"draw");j(this,"util",this.editor.getShapeUtil(this.shapeType));j(this,"isPen",!1);j(this,"isPenOrStylus",!1);j(this,"segmentMode","free");j(this,"didJustShiftClickToExtendPreviousShapeLine",!1);j(this,"pagePointWhereCurrentSegmentChanged",{});j(this,"pagePointWhereNextSegmentChanged",null);j(this,"lastRecordedPoint",{});j(this,"mergeNextPoint",!1);j(this,"currentLineLength",0);j(this,"markId",null)}onEnter(t){this.markId=null,this.info=t,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.startShape()}onPointerMove(){const{inputs:t}=this.editor;if(this.isPen&&!t.isPen&&this.markId){this.editor.bailToMark(this.markId),this.startShape();return}this.isPenOrStylus?P.Dist(t.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=t.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateDrawingShape()}onKeyDown(t){if(t.key==="Shift")switch(this.segmentMode){case"free":{this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_free":this.segmentMode="starting_straight"}this.updateDrawingShape()}onKeyUp(t){if(t.key==="Shift")switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":{this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break}case"starting_straight":{this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";break}}this.updateDrawingShape()}onExit(){this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()}canClose(){return this.shapeType!=="highlight"}getIsClosed(t,r,o){if(!this.canClose())return!1;const s=Xn[r],i=t[0].points[0],a=t[t.length-1],c=a.points[a.points.length-1];return i!==c&&this.currentLineLength>s*4*o&&P.DistMin(i,c,s*2*o)}startShape(){const{inputs:{originPagePoint:t,isPen:r}}=this.editor;this.markId=this.editor.markHistoryStoppingPoint("draw start");const{z:o=.5}=this.info.point;this.isPen=r,this.isPenOrStylus=r||o>0&&o<.5||o>.5&&o<1;const s=this.isPenOrStylus?o*1.25:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=t.clone(),this.initialShape){const a=this.editor.getShape(this.initialShape.id);if(a&&this.segmentMode==="straight"){this.didJustShiftClickToExtendPreviousShapeLine=!0;const c=En(a.props.segments);if(!c)throw Error("Expected a previous segment!");const u=En(c.points);if(!u)throw Error("Expected a previous point!");const{x:h,y:f}=this.editor.getPointInShapeSpace(a,t).toFixed(),g={type:this.segmentMode,points:[{x:u.x,y:u.y,z:+s.toFixed(2)},{x:h,y:f,z:+s.toFixed(2)}]},y=ye.applyToPoint(this.editor.getShapePageTransform(a.id),u);this.pagePointWhereCurrentSegmentChanged=y,this.pagePointWhereNextSegmentChanged=null;const v=[...a.props.segments,g];this.currentLineLength<Xn[a.props.size]*4&&(this.currentLineLength=this.getLineLength(v));const S={id:a.id,type:this.shapeType,props:{segments:v}};this.canClose()&&(S.props.isClosed=this.getIsClosed(v,a.props.size,a.props.scale)),this.editor.updateShapes([S]);return}}this.pagePointWhereCurrentSegmentChanged=t.clone();const i=Ct();this.editor.createShapes([{id:i,type:this.shapeType,x:t.x,y:t.y,props:{isPen:this.isPenOrStylus,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+s.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(i)}updateDrawingShape(){const{initialShape:t}=this,{inputs:r}=this.editor;if(!t)return;const{id:o,props:{size:s,scale:i}}=t,a=this.editor.getShape(o);if(!a)return;const{segments:c}=a.props,{x:u,y:h,z:f}=this.editor.getPointInShapeSpace(a,r.currentPagePoint).toFixed(),g=this.isPenOrStylus?+(r.currentPagePoint.z*1.25).toFixed(2):.5,y={x:u,y:h,z:g};switch(this.segmentMode){case"starting_straight":{const{pagePointWhereNextSegmentChanged:v}=this;if(v===null)throw Error("We should have a point where the segment changed");if(P.Dist2(v,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";const w=En(c);if(!w)throw Error("Expected a previous segment!");const b=En(w.points);if(!b)throw Error("Expected a previous last point!");let _;const T=this.editor.getPointInShapeSpace(a,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if(w.type==="straight"){this.currentLineLength+=P.Dist(b,T),_={type:"straight",points:[{...b},T]};const M=this.editor.getShapePageTransform(a);this.pagePointWhereCurrentSegmentChanged=ye.applyToPoint(M,b)}else _={type:"straight",points:[T,y]};const E={id:o,type:this.shapeType,props:{segments:[...c,_]}};this.canClose()&&(E.props.isClosed=this.getIsClosed(c,s,i)),this.editor.updateShapes([E])}break}case"starting_free":{const{pagePointWhereNextSegmentChanged:v}=this;if(v===null)throw Error("We should have a point where the segment changed");if(P.Dist2(v,r.currentPagePoint)>this.editor.options.dragDistanceSquared){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";const w=c.slice(),b=w[w.length-1],_=En(b.points);if(!_)throw Error("No previous point!");const T={type:"free",points:[...P.PointsBetween(_,y,6).map(A=>({x:di(A.x),y:di(A.y),z:di(A.z)}))]},E=[...w,T];this.currentLineLength<Xn[a.props.size]*4&&(this.currentLineLength=this.getLineLength(E));const M={id:o,type:this.shapeType,props:{segments:E}};this.canClose()&&(M.props.isClosed=this.getIsClosed(E,s,i)),this.editor.updateShapes([M])}break}case"straight":{const v=c.slice(),S=v[v.length-1],{pagePointWhereCurrentSegmentChanged:w}=this,{ctrlKey:b,currentPagePoint:_}=this.editor.inputs;if(!w)throw Error("We should have a point where the segment changed");let T,E=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(E=!b,this.didJustShiftClickToExtendPreviousShapeLine=!1):E=!b;let M=this.editor.getPointInShapeSpace(a,_).toFixed().toJson(),A=!1,R;if((this.editor.user.getIsSnapMode()?!b:b)&&v.length>2){let D,U=8/this.editor.getZoomLevel();for(let V=0,F=c.length-2;V<F;V++){const $=c[V];if(!$)break;if($.type==="free")continue;const H=$.points[0],Z=En($.points);if(!(H&&Z))continue;const G=P.NearestPointOnLineSegment(H,Z,M);if(P.DistMin(G,M,U)){D=G.toFixed().toJson(),U=P.Dist(G,M),R=$;break}}D&&(A=!0,M=D)}if(A&&R){const D=this.editor.getShapePageTransform(a),U=R.points[0],V=En(R.points);if(!V)throw Error("Expected a last point!");const F=ye.applyToPoint(D,U),$=ye.applyToPoint(D,V),H=ye.applyToPoint(D,M);this.editor.snaps.setIndicators([{id:bt(),type:"points",points:[F,H,$]}])}else{if(this.editor.snaps.clearIndicators(),E){const D=P.Angle(w,_),V=lg(D,24)-D;T=P.RotWith(_,w,V)}else T=_;M=this.editor.getPointInShapeSpace(a,T).toFixed().toJson()}this.currentLineLength+=P.Dist(S.points[0],M),v[v.length-1]={...S,type:"straight",points:[S.points[0],M]};const K={id:o,type:this.shapeType,props:{segments:v}};this.canClose()&&(K.props.isClosed=this.getIsClosed(c,s,i)),this.editor.updateShapes([K]);break}case"free":{const v=c.slice(),S=v[v.length-1],w=[...S.points];if(w.length&&this.mergeNextPoint){const{z:_}=w[w.length-1];w[w.length-1]={x:y.x,y:y.y,z:_?Math.max(_,y.z):y.z}}else this.currentLineLength+=P.Dist(w[w.length-1],y),w.push(y);v[v.length-1]={...S,points:w},this.currentLineLength<Xn[a.props.size]*4&&(this.currentLineLength=this.getLineLength(v));const b={id:o,type:this.shapeType,props:{segments:v}};if(this.canClose()&&(b.props.isClosed=this.getIsClosed(v,s,i)),this.editor.updateShapes([b]),w.length>this.editor.options.maxPointsPerDrawShape){this.editor.updateShapes([{id:o,type:this.shapeType,props:{isComplete:!0}}]);const _=Ct(),T=this.editor.getShape(o).props;this.editor.createShapes([{id:_,type:this.shapeType,x:di(r.currentPagePoint.x),y:di(r.currentPagePoint.y),props:{isPen:this.isPenOrStylus,scale:T.scale,segments:[{type:"free",points:[{x:0,y:0,z:this.isPenOrStylus?+(f*1.25).toFixed():.5}]}]}}]),this.initialShape=zt(this.editor.getShape(_)),this.mergeNextPoint=!1,this.lastRecordedPoint=r.currentPagePoint.clone(),this.currentLineLength=0}break}}}getLineLength(t){let r=0;for(const o of t)for(let s=0;s<o.points.length-1;s++){const i=o.points[s],a=o.points[s+1];r+=P.Dist2(a,i)}return Math.sqrt(r)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())}complete(){const{initialShape:t}=this;t&&(this.editor.updateShapes([{id:t.id,type:t.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}}j(S_,"id","drawing");var Dx;let TF=(Dx=class extends Re{onPointerDown(e){this.parent.transition("drawing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},j(Dx,"id","idle"),Dx);class wf extends Re{constructor(){super(...arguments);j(this,"shapeType","draw")}static children(){return[TF,S_]}onExit(){const t=this.children.drawing;t.initialShape=void 0}}j(wf,"id","draw"),j(wf,"initial","idle"),j(wf,"isLockable",!1);class Hw extends Ew{constructor(){super(...arguments);j(this,"shapeType","frame")}onCreate(t){if(!t)return;const r=this.editor.getShapePageBounds(t),o=[],s=this.editor.getShapeAncestors(t).map(i=>i.id);this.editor.getSortedChildIdsForParent(t.parentId).map(i=>{const a=this.editor.getShape(i);if(!a||a.id===t.id||a.isLocked)return;const c=this.editor.getShapePageBounds(a);c&&r.contains(c)&&zee(a,s,t)&&o.push(a.id)}),this.editor.reparentShapes(o,t.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}}j(Hw,"id","frame"),j(Hw,"initial","idle");function zee(n,e,t){return e.includes(n.id)?!1:n.parentId===t.parentId}var Lx;let Bee=(Lx=class extends Re{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onKeyUp(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}}onCancel(){this.editor.setCurrentTool("select")}},j(Lx,"id","idle"),Lx);var Fx;let Uee=(Fx=class extends Re{onPointerUp(){this.complete()}onPointerMove(e){if(this.editor.inputs.isDragging){const{originPagePoint:t}=this.editor.inputs,r=Ct(),o=this.editor.markHistoryStoppingPoint(`creating_geo:${r}`),s=ns(t,this.editor);this.editor.createShapes([{id:r,type:"geo",x:s.x,y:s.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(Zo),scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]).select(r).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creatingMarkId:o,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}complete(){const{originPagePoint:e}=this.editor.inputs,t=Ct();this.editor.markHistoryStoppingPoint(`creating_geo:${t}`);const r=this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1,o=this.editor.getStyleForNextShape(Zo),s=o==="star"?{w:200,h:190}:o==="cloud"?{w:300,h:180}:{w:200,h:200};this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(Zo),scale:r,...s}}]);const i=this.editor.getShape(t);if(!i)return;const{w:a,h:c}=i.props,u=new P(a/2,c/2).mul(r),h=this.editor.getShapeParentTransform(i);h&&u.rot(-h.rotation());const f=ns(new P(i.x-u.x,i.y-u.y),this.editor);this.editor.select(t),this.editor.updateShape({id:i.id,type:"geo",x:f.x,y:f.y,props:{geo:this.editor.getStyleForNextShape(Zo),w:a*r,h:c*r}}),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}},j(Fx,"id","pointing"),Fx);class Kw extends Re{constructor(){super(...arguments);j(this,"shapeType","geo")}static children(){return[Bee,Uee]}}j(Kw,"id","geo"),j(Kw,"initial","idle");class bf extends Re{constructor(){super(...arguments);j(this,"shapeType","highlight")}static children(){return[TF,S_]}onExit(){const t=this.children.drawing;t.initialShape=void 0}}j(bf,"id","highlight"),j(bf,"initial","idle"),j(bf,"isLockable",!1);var Nx;let Hee=(Nx=class extends Re{constructor(){super(...arguments);j(this,"shapeId","")}onEnter(t){this.shapeId=t.shapeId,this.editor.setCursor({type:"cross",rotation:0})}onPointerDown(){this.parent.transition("pointing",{shapeId:this.shapeId})}onCancel(){this.editor.setCurrentTool("select")}},j(Nx,"id","idle"),Nx);const NT=2;var $x;let Kee=($x=class extends Re{constructor(){super(...arguments);j(this,"shape",{});j(this,"markId")}onEnter(t){const{inputs:r}=this.editor,{currentPagePoint:o}=r;this.markId=void 0;const s=t.shapeId&&this.editor.getShape(t.shapeId);if(s&&r.shiftKey){this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${s.id}`),this.shape=s;const i=this.editor.getShapeHandles(this.shape);if(!i)return;const a=i.filter(v=>v.type==="vertex").sort(Gn),c=a[a.length-1],u=a[a.length-2],h=ye.applyToPoint(this.editor.getShapeParentTransform(this.shape),new P(this.shape.x,this.shape.y)),f=P.Sub(o,h).addXY(.1,.1),g=ns(f,this.editor),y=zt(this.shape.props.points);if(P.DistMin(c,u,NT)||P.DistMin(g,c,NT))y[c.id]={id:c.id,index:c.index,x:g.x,y:g.y};else{const v=Is(c.index);y[v]={id:v,index:v,x:g.x,y:g.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:y}}])}else{const i=Ct();this.markId=this.editor.markHistoryStoppingPoint(`creating_line:${i}`);const a=ns(o,this.editor);this.editor.createShapes([{id:i,type:"line",x:a.x,y:a.y,props:{scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}}]),this.editor.select(i),this.shape=this.editor.getShape(i)}}onPointerMove(){if(this.shape&&this.editor.inputs.isDragging){const t=this.editor.getShapeHandles(this.shape);if(!t)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");const r=En(t);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,creatingMarkId:this.markId,handle:{...r,x:r.x-.1,y:r.y-.1},onInteractionEnd:"line"})}}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()}complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}},j($x,"id","pointing"),$x);class Ww extends Re{constructor(){super(...arguments);j(this,"shapeType","line")}static children(){return[Hee,Kee]}}j(Ww,"id","line"),j(Ww,"initial","idle");var zx;let Wee=(zx=class extends Re{onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onCancel(){this.editor.setCurrentTool("select")}},j(zx,"id","idle"),zx);const Vee=0,Pt=200,km=new P(Pt/2,Pt/2),MF=10,Gee=n=>[[["a1"],new P(Pt*.5,Pt*-.5-n.options.adjacentShapeMargin)],[["a2"],new P(Pt*1.5+n.options.adjacentShapeMargin,Pt*.5)],[["a3"],new P(Pt*.5,Pt*1.5+n.options.adjacentShapeMargin)],[["a4"],new P(Pt*-.5-n.options.adjacentShapeMargin,Pt*.5)]];function qee(n,e){if(e===1)return Gee(n);const t=Pt*e,r=n.options.adjacentShapeMargin*e;return[[["a1"],new P(t*.5,t*-.5-r)],[["a2"],new P(t*1.5+r,t*.5)],[["a3"],new P(t*.5,t*1.5+r)],[["a4"],new P(t*-.5-r,t*.5)]]}function AF(n,e,t,r,o,s){return Object.fromEntries(qee(n,s).map(([i,a],c)=>{const u=a.clone();return c===0&&o?u.y-=o:c===2&&r&&(u.y+=r),[i,u.rot(t).add(e)]}))}function jF(n,e,t,r){const o=new Set(n.getSelectedShapeIds()),s=(Pt+n.options.adjacentShapeMargin+r)**2,i=new Map,a=[];for(const h of n.getCurrentPageShapes()){if(!n.isShapeOfType(h,"note")||t!==h.props.scale||o.has(h.id))continue;const f=n.getShapePageTransform(h.id);e===f.rotation()&&(i.set(h,n.getShapePageBounds(h).center),a.push(...Object.values(AF(n,f.point(),e,h.props.growY,r,t))))}const c=a.length;let u;for(const[h,f]of i)for(let g=0;g<c;g++)u=a[g],u&&(P.Dist2(f,u)>s||n.isPointInShape(h,u)&&(a[g]=void 0));return Ze(a)}function RF(n,e,t,r,o=!1){let s;const i=n.getCurrentPageShapesSorted(),a=(Pt+n.options.adjacentShapeMargin**2)**e.props.scale;for(let c=i.length-1;c>=0;c--){const u=i[c];if(u.type==="note"&&u.id!==e.id){const h=n.getShapePageBounds(u);if(h&&P.Dist2(h.center,t)<a&&n.isPointInShape(u,t)){s=u;break}}}if(n.complete(),!s||o){n.markHistoryStoppingPoint("creating note shape");const c=Ct();n.createShape({id:c,type:"note",x:t.x,y:t.y,rotation:r,opacity:e.opacity,props:{...e.props,text:"",growY:0,fontSizeAdjustment:0,url:""}});const u=n.getShape(c);if(!u)return;const h=n.getPointInParentSpace(u,P.Sub(t,P.Rot(km.clone().mul(u.props.scale),r)));n.updateShape({id:c,type:"note",x:h.x,y:h.y}),s=n.getShape(c)}return Xee(n),s}const Yee=16;function Xee(n){const e=n.getSelectionPageBounds(),t=n.getViewportPageBounds();if(e&&!t.contains(e)){const r=e.clone().expandBy(Yee/n.getZoomLevel()).expand(t),o=t.clone().translate({x:(r.center.x-t.center.x)*2,y:(r.center.y-t.center.y)*2});n.zoomToBounds(o,{animation:{duration:n.options.animationMediumMs},inset:0})}}var Bx;let Zee=(Bx=class extends Re{constructor(){super(...arguments);j(this,"dragged",!1);j(this,"info",{});j(this,"markId","");j(this,"shape",{})}onEnter(){const{editor:t}=this,r=Ct();this.markId=t.markHistoryStoppingPoint(`creating_note:${r}`);const o=this.editor.inputs.originPagePoint.clone(),s=Qee(this.editor,o,this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1);s&&o.sub(s),this.shape=Jee(this.editor,r,o)}onPointerMove(t){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.translating",{...t,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,creatingMarkId:this.markId,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}})}onPointerUp(){this.complete()}onInterrupt(){this.cancel()}onComplete(){this.complete()}onCancel(){this.cancel()}complete(){this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape}))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}},j(Bx,"id","pointing"),Bx);function Qee(n,e,t){let r=MF/n.getZoomLevel(),o;for(const s of jF(n,0,t,0)){const i=P.Sub(e,s),a=i.len();a<r&&(r=a,o=i)}return o}function Jee(n,e,t){n.createShape({id:e,type:"note",x:t.x,y:t.y,props:{scale:n.user.getIsDynamicResizeMode()?1/n.getZoomLevel():1}}).select(e);const r=n.getShape(e),o=n.getShapeGeometry(r).bounds,s=ns(new P(r.x-o.width/2,r.y-o.height/2),n);return n.updateShapes([{id:e,type:"note",x:s.x,y:s.y}]),n.getShape(e)}class Vw extends Re{constructor(){super(...arguments);j(this,"shapeType","note")}static children(){return[Wee,Zee]}}j(Vw,"id","note"),j(Vw,"initial","idle");function ete(n){const e=n.getShapeAtPoint(n.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),renderingOnly:!0});if(!e)return n.setHoveredShape(null);let t;const r=n.getOutermostSelectableShape(e);return r===e||r.id===n.getFocusedGroupId()||n.getSelectedShapeIds().includes(r.id)?t=e:t=r,n.setHoveredShape(t.id)}const fi=WM(ete,32);var Ux;let tte=(Ux=class extends Re{onPointerMove(e){switch(e.target){case"shape":case"canvas":fi(this.editor)}}onPointerDown(e){this.parent.transition("pointing",e)}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}onExit(){fi.cancel()}onKeyDown(e){var t;if(e.key==="Enter"){if(this.editor.getIsReadonly())return null;const r=this.editor.getOnlySelectedShape();r&&this.editor.getShapeUtil(r).canEdit(r)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(r.id),(t=this.editor.root.getCurrent())==null||t.transition("editing_shape",{...e,target:"shape",shape:r}))}}onCancel(){this.editor.setCurrentTool("select")}},j(Ux,"id","idle"),Ux);var Hx;let nte=(Hx=class extends Re{constructor(){super(...arguments);j(this,"shape");j(this,"markId","");j(this,"enterTime",0)}onEnter(){this.enterTime=Date.now()}onExit(){this.editor.setHintingShapes([])}onPointerMove(t){if(Date.now()-this.enterTime<150)return;const{editor:r}=this,{isPointing:o}=r.inputs;if(!o)return;const{originPagePoint:s,currentPagePoint:i}=r.inputs,a=Math.abs(s.x-i.x),u=Math.sqrt(r.getInstanceState().isCoarsePointer?r.options.coarseDragDistanceSquared:r.options.dragDistanceSquared)*6/r.getZoomLevel();if(a>u){const h=Ct();this.markId=r.markHistoryStoppingPoint(`creating_text:${h}`);const f=this.createTextShape(h,s,!1,a);if(!f){this.cancel();return}this.shape=r.getShape(f),r.select(h),r.setCurrentTool("select.resizing",{...t,target:"selection",handle:"right",isCreating:!0,creatingMarkId:this.markId,creationCursorOffset:{x:a,y:1},onInteractionEnd:"text",onCreate:()=>{r.setEditingShape(f.id)}})}}onPointerUp(){this.complete()}onComplete(){this.cancel()}onCancel(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.editor.markHistoryStoppingPoint("creating text shape");const t=Ct(),{originPagePoint:r}=this.editor.inputs;this.createTextShape(t,r,!0,20)&&(this.editor.select(t),this.editor.setEditingShape(t))}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}createTextShape(t,r,o,s){this.editor.createShape({id:t,type:"text",x:r.x,y:r.y,props:{text:"",autoSize:o,w:s,scale:this.editor.user.getIsDynamicResizeMode()?1/this.editor.getZoomLevel():1}});const i=this.editor.getShape(t);if(!i){this.cancel();return}const a=this.editor.getShapePageBounds(i),c=new P;if(o)switch(i.props.textAlign){case"start":{c.x=0;break}case"middle":{c.x=-a.width/2;break}case"end":{c.x=-a.width;break}}else c.x=0;if(c.y=-a.height/2,Tr(i.parentId)){const f=this.editor.getShapeParentTransform(i);c.rot(-f.rotation())}const u=i.x+c.x,h=i.y+c.y;if(this.editor.getInstanceState().isGridMode){const f=new P(u,h),g=ns(f,this.editor),y=P.Sub(f,g);this.editor.updateShape({...i,x:u-y.x,y:h-y.y})}else this.editor.updateShape({...i,x:u,y:h});return i}},j(Hx,"id","pointing"),Hx);class Gw extends Re{constructor(){super(...arguments);j(this,"shapeType","text")}static children(){return[tte,nte]}}j(Gw,"id","text"),j(Gw,"initial","idle");const rte=[Gw,wf,Kw,Vw,Ww,Hw,Uw,bf];function jo(){return Ii({isDarkMode:ah()})}function Tm(n){return{key:`${Ls.id}:${n}`,async getElement(){const e=ote(n);if(!e)return null;const{url:t,fontFaceRule:r}=e,o=await(await Ds(t)).blob(),s=await Yo.blobToDataUrl(o),i=r.replace(t,s);return p.jsx("style",{children:i})}}}function ote(n){const e=ij[n];for(const t of document.fonts)if(e.includes(t.family)&&"$$_url"in t&&typeof t.$$_url=="string"&&"$$_fontface"in t&&typeof t.$$_fontface=="string")return{url:t.$$_url,fontFaceRule:t.$$_fontface};return null}function x_(n){return{key:`${Ls.id}:${n}`,async getElement(){return n!=="pattern"?null:p.jsx(ste,{})}}}function ste(){const n=b_(),e=nu(),t=jo(),r=8/12;return p.jsxs(p.Fragment,{children:[p.jsxs("mask",{id:e,children:[p.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:"white"}),p.jsxs("g",{strokeLinecap:"round",stroke:"black",children:[p.jsx("line",{x1:r*1,y1:r*3,x2:r*3,y2:r*1}),p.jsx("line",{x1:r*5,y1:r*7,x2:r*7,y2:r*5}),p.jsx("line",{x1:r*9,y1:r*11,x2:r*11,y2:r*9})]})]}),p.jsx("pattern",{id:n(1,t.id),width:"8",height:"8",patternUnits:"userSpaceOnUse",children:p.jsx("rect",{x:"0",y:"0",width:"8",height:"8",fill:t.solid,mask:`url(#${e})`})})]})}function w_(){return{key:`${Ls.id}:pattern`,component:cte}}const gd=8,$T=(n,e,t)=>new Promise((r,o)=>{const s=gd*e*n,i=document.createElement("canvas");i.width=s,i.height=s;const a=i.getContext("2d");if(!a)return;a.fillStyle=t?tg.darkMode.solid:tg.lightMode.solid,a.fillRect(0,0,s,s),a.globalCompositeOperation="destination-out",a.lineCap="round",a.lineWidth=1.25*e*n;const c=8/12,u=h=>h*e*n;a.beginPath(),a.moveTo(u(c*1),u(c*3)),a.lineTo(u(c*3),u(c*1)),a.moveTo(u(c*5),u(c*7)),a.lineTo(u(c*7),u(c*5)),a.moveTo(u(c*9),u(c*11)),a.lineTo(u(c*11),u(c*9)),a.stroke(),i.toBlob(h=>{!h||sn.throwToBlob.get()?o():r(h)})}),zT=(n,e)=>{const t=document.createElement("canvas");t.width=n[0],t.height=n[1];const r=t.getContext("2d");return r?(e(r),t.toDataURL()):""};let xx=null;function ite(){return xx||(xx={white:zT([1,1],n=>{n.fillStyle="#f8f9fa",n.fillRect(0,0,1,1)}),black:zT([1,1],n=>{n.fillStyle="#212529",n.fillRect(0,0,1,1)})}),xx}function OF(n){return Math.ceil(Math.log2(Math.max(1,n)))}function b_(){const n=Jo("hash_pattern");return C.useCallback((e,t)=>{const r=OF(e);return i1(n,`${t}_${r}`)},[n])}function DF(n){const e=[],r=OF(n);for(let o=0;o<=r;o++)e.push(Math.pow(2,o));return e}function ate(n){const e=ite();return DF(n).flatMap(t=>[{zoom:t,url:e.white,theme:"light"},{zoom:t,url:e.black,theme:"dark"}])}function lte(){const n=te(),e=re("devicePixelRatio",()=>n.getInstanceState().devicePixelRatio,[n]),t=re("maxZoom",()=>Math.ceil(En(n.getCameraOptions().zoomSteps)),[n]),[r,o]=C.useState(!1),[s,i]=C.useState(()=>ate(t)),a=b_();return C.useEffect(()=>{const u=Promise.all(DF(t).flatMap(f=>[$T(e,f,!1).then(g=>({zoom:f,theme:"light",url:URL.createObjectURL(g)})),$T(e,f,!0).then(g=>({zoom:f,theme:"dark",url:URL.createObjectURL(g)}))]));let h=!1;return u.then(f=>{h||(i(f),o(!0))}),()=>{h=!0,o(!1),u.then(f=>{for(const{url:g}of f)URL.revokeObjectURL(g)})}},[e,t]),{defs:p.jsx(p.Fragment,{children:s.map(u=>{const h=a(u.zoom,u.theme);return p.jsx("pattern",{id:h,width:gd,height:gd,patternUnits:"userSpaceOnUse",children:p.jsx("image",{href:u.url,width:gd,height:gd})},h)})}),isReady:r}}function cte(){const n=te(),e=C.useRef(null),{defs:t,isReady:r}=lte();return C.useEffect(()=>{if(r&&kt.isSafari){const o=LF(e.current);o&&n.timers.requestAnimationFrame(()=>{o.style.display="none",n.timers.requestAnimationFrame(()=>{o.style.display=""})})}},[n,r]),p.jsx("g",{ref:e,"data-testid":r?"ready-pattern-fill-defs":void 0,children:t})}function LF(n){return n.classList.contains("tl-html-layer")?n:n.parentElement?LF(n.parentElement):null}const Kn=at.memo(function({theme:e,d:t,color:r,fill:o,scale:s}){switch(o){case"none":return null;case"solid":return p.jsx("path",{fill:e[r].semi,d:t});case"semi":return p.jsx("path",{fill:e.solid,d:t});case"fill":return p.jsx("path",{fill:e[r].fill,d:t});case"pattern":return p.jsx(ute,{theme:e,color:r,fill:o,d:t,scale:s})}});function ute({d:n,color:e,theme:t}){const r=te(),o=rh(),s=re("zoomLevel",()=>r.getZoomLevel(),[r]),i=b_(),a=r.getZoomLevel()<=.18;return p.jsxs(p.Fragment,{children:[p.jsx("path",{fill:t[e].pattern,d:n}),p.jsx("path",{fill:o?`url(#${i(1,t.id)})`:a?t[e].semi:`url(#${i(s,t.id)})`,d:n})]})}function dte(n){return n.replace(/\s/g," ")}function qw(n,e,t){const{padding:r=0}=t;if(e.length===0)return null;const o=xe.From(e[0].box);for(const{box:u}of e)o.union(u);const s=r+(t.offsetX??0),i=(t.offsetY??0)+t.fontSize/2+(t.verticalTextAlign==="start"?r:t.verticalTextAlign==="end"?t.height-r-o.height:(Math.ceil(t.height)-o.height)/2);let a=null;const c=[];for(const{text:u,box:h}of e)a!==null&&h.y>a&&c.push(p.jsx("tspan",{alignmentBaseline:"mathematical",x:s,y:h.y+i,children:`
`},c.length)),c.push(p.jsx("tspan",{alignmentBaseline:"mathematical",x:h.x+s,y:h.y+i,unicodeBidi:"plaintext",children:dte(u)},c.length)),a=h.y;return p.jsx("text",{fontSize:t.fontSize,fontFamily:t.fontFamily,fontStyle:t.fontStyle,fontWeight:t.fontWeight,dominantBaseline:"mathematical",alignmentBaseline:"mathematical",stroke:t.stroke,strokeWidth:t.strokeWidth,fill:t.fill,children:c})}function hte(n,e,t,r){if((n==="start-legacy"||n==="end-legacy")&&t.length!==0){const o=xe.From(t[0].box);for(const{box:s}of t)o.union(s);if(n==="start-legacy")return(r-2*e-o.width)/2;if(n==="end-legacy")return-(r-2*e-o.width)/2}}function pte(n){return n==="start-legacy"||n==="middle-legacy"||n==="end-legacy"}function Mm({fontSize:n,font:e,align:t,verticalAlign:r,text:o,labelColor:s,bounds:i,padding:a=16,stroke:c=!0}){const u=te(),h=jo(),f={fontSize:n,fontFamily:ij[e],textAlign:t,verticalTextAlign:r,width:Math.ceil(i.width),height:Math.ceil(i.height),padding:a,lineHeight:Zn.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0,offsetY:0,fill:s,stroke:void 0,strokeWidth:void 0},g=u.textMeasure.measureTextSpans(o,f),y=hte(t,a,g,i.width);y&&(f.offsetX=y),f.offsetX+=i.x,f.offsetY+=i.y;const v=qw(u,g,f);let S=null;return c&&(f.fill=h.background,f.stroke=h.background,f.strokeWidth=2,S=qw(u,g,f)),p.jsxs(p.Fragment,{children:[S,v]})}const fte=C.forwardRef(function({isEditing:e,text:t,handleFocus:r,handleChange:o,handleKeyDown:s,handleBlur:i,handleInputPointerDown:a,handleDoubleClick:c},u){return p.jsx("textarea",{ref:u,className:"tl-text tl-text-input",name:"text",tabIndex:-1,readOnly:!e,autoComplete:"off",autoCapitalize:"off",autoCorrect:"off",autoSave:"off",placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",defaultValue:t,onFocus:r,onChange:o,onKeyDown:s,onBlur:i,onTouchEnd:cn,onContextMenu:e?cn:void 0,onPointerDown:a,onDoubleClick:c,onDragStart:et})});function gte(n,e,t){const r=te(),o=C.useRef(null),s=re("isEditing",()=>r.getEditingShapeId()===n,[r]),i=re("isEditingAnything",()=>!!r.getEditingShapeId(),[r]);C.useEffect(()=>{function h(f){var g;f.shapeId===n&&((g=o.current)==null||g.select())}return r.on("select-all-text",h),()=>{r.off("select-all-text",h)}},[r,n,s]),C.useEffect(()=>{var h,f,g,y;s&&(document.activeElement!==o.current&&((h=o.current)==null||h.focus()),r.getInstanceState().isCoarsePointer&&((f=o.current)==null||f.select()),kt.isSafari&&((g=o.current)==null||g.blur(),(y=o.current)==null||y.focus()))},[r,s]);const a=C.useCallback(h=>{if(r.getEditingShapeId()===n)switch(h.key){case"Enter":{(h.ctrlKey||h.metaKey)&&r.complete();break}}},[r,n]),c=C.useCallback(h=>{if(r.getEditingShapeId()!==n)return;let f=Kc.normalizeText(h.currentTarget.value);const g=f.replace(/\t/g,Ac);if(g!==f){const y=h.currentTarget.selectionStart;h.currentTarget.value=g,h.currentTarget.selectionStart=y+(g.length-f.length),h.currentTarget.selectionEnd=y+(g.length-f.length),f=g}r.updateShape({id:n,type:e,props:{text:f}})},[r,n,e]),u=C.useCallback(h=>{r.dispatch({...Qr(h),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(n)}),cn(h)},[r,n]);return{rInput:o,handleFocus:Md,handleBlur:Md,handleKeyDown:a,handleChange:c,handleInputPointerDown:u,handleDoubleClick:cn,isEmpty:t.trim().length===0,isEditing:s,isEditingAnything:i}}const Am=at.memo(function({shapeId:e,type:t,text:r,labelColor:o,font:s,fontSize:i,lineHeight:a,align:c,verticalAlign:u,wrap:h,isSelected:f,padding:g=0,onKeyDown:y,classNamePrefix:v,style:S,textWidth:w,textHeight:b}){const{rInput:_,isEmpty:T,isEditing:E,isEditingAnything:M,...A}=gte(e,t,r),[R,L]=C.useState(r);C.useEffect(()=>{E||L(r)},[E,r]);const K=Kc.normalizeTextForDom(r),D=K.length>0,U=pte(c);if(!E&&!D)return null;const V=v||"tl-text";return p.jsx("div",{className:`${V}-label tl-text-wrapper`,"data-font":s,"data-align":c,"data-hastext":!T,"data-isediting":E,"data-iseditinganything":M,"data-textwrap":!!h,"data-isselected":f,style:{justifyContent:c==="middle"||U?"center":c,alignItems:u==="middle"?"center":u,padding:g,...S},children:p.jsxs("div",{className:`${V}-label__inner tl-text-content__wrapper`,style:{fontSize:i,lineHeight:Math.floor(i*a)+"px",minHeight:Math.floor(i*a)+"px",minWidth:Math.ceil(w||0),color:o,width:w?Math.ceil(w):void 0,height:b?Math.ceil(b):void 0},children:[p.jsx("div",{className:`${V} tl-text tl-text-content`,dir:"auto",children:K.split(`
`).map((F,$)=>p.jsx("div",{dir:"auto",children:F},$))}),(M||f)&&p.jsx(fte,{ref:_,text:r,isEditing:E,...A,handleKeyDown:y??A.handleKeyDown},R)]})})}),mte=new Os;function yte(n){return mte.get(n,()=>n.store.createComputedCache("arrowLabelSize",e=>{const t=ks(n,e);let r=0,o=0;const s=t.isStraight?new pi({start:P.From(t.start.point),end:P.From(t.end.point)}):new Ec({center:P.Cast(t.handleArc.center),start:P.Cast(t.start.point),end:P.Cast(t.end.point),sweepFlag:t.bodyArc.sweepFlag,largeArcFlag:t.bodyArc.largeArcFlag});if(e.props.text.trim()){const i=s.bounds,a=Yw(e),{w:c,h:u}=n.textMeasure.measureText(e.props.text,{...Zn,fontFamily:bi[e.props.font],fontSize:a,maxWidth:null});r=c,o=u;let h=!1;if(i.width>i.height?(r=Math.max(Math.min(c,64),Math.min(i.width-64,c)),h=!0):r>16*a&&(r=16*a,h=!0),h){const{w:f,h:g}=n.textMeasure.measureText(e.props.text,{...Zn,fontFamily:bi[e.props.font],fontSize:a,maxWidth:r});r=f,o=g}}return new P(r,o).addScalar(_g*2*e.props.scale)}))}function __(n,e){return e.props.text.trim()===""?new P(0,0).addScalar(_g*2*e.props.scale):yte(n).get(e.id)??new P(0,0)}function FF(n){const e=Xn[n.props.size];return(Eee+(e-Xn.s)*2+(e===Xn.xl?20:0))*n.props.scale}function vte(n,e,t){const r=__(n,e),o=FF(e),s=P.Nudge(t.start.point,t.end.point,o),i=P.Nudge(t.end.point,t.start.point,o),a=v1(s,i,xe.FromCenter(t.middle,r).corners);if(!a||a.length!==2)return{start:.5,end:.5};let[c,u]=a;P.Dist2(c,s)>P.Dist2(u,s)&&([u,c]=a);const h=s.add(P.Sub(t.middle,c)),f=i.add(P.Sub(t.middle,u)),g=P.Dist(t.start.point,h)/t.length,y=P.Dist(t.start.point,f)/t.length;return{start:g,end:y}}function Ste(n,e,t){const r=__(n,e),o=FF(e),s=Math.sign(e.props.bend),i=o/t.handleArc.radius*s,a=P.Angle(t.bodyArc.center,t.start.point)-i,c=P.Angle(t.bodyArc.center,t.end.point)+i,u=gl(t.bodyArc.center,t.bodyArc.radius,a),h=gl(t.bodyArc.center,t.bodyArc.radius,c),f=[],g=UT(t.bodyArc.center,t.bodyArc.radius,a,c,s,xe.FromCenter(u,r).corners);f.push(new on({points:xe.FromCenter(u,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));const y=UT(t.bodyArc.center,t.bodyArc.radius,a,c,s,xe.FromCenter(h,r).corners);f.push(new on({points:xe.FromCenter(h,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));for(const R of[...g??[],...y??[],u,h])f.push(new R1({x:R.x-3,y:R.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));const v=(g&&HT(t.start.point,g))??t.middle,S=(y&&HT(t.end.point,y))??t.middle,w=P.Angle(t.bodyArc.center,t.start.point),b=P.Angle(t.bodyArc.center,t.end.point),_=P.Angle(t.bodyArc.center,v),T=P.Angle(t.bodyArc.center,S);if(ia(w,_,s)>ia(w,T,s))return{start:.5,end:.5,dbg:f};const E=ia(w,b,s),M=ia(w,_,s)/E,A=ia(w,T,s)/E;return{start:M,end:A,dbg:f}}function _f(n,e){let t;const r=[],o=ks(n,e),s={hasStartBinding:!!o.bindings.start,hasEndBinding:!!o.bindings.end,hasStartArrowhead:o.start.arrowhead!=="none",hasEndArrowhead:o.end.arrowhead!=="none"};if(o.isStraight){const a=vte(n,e,o),c=BT(n,e,a,s);t=P.Lrp(o.start.point,o.end.point,c)}else{const a=Ste(n,e,o);a.dbg&&r.push(...a.dbg);const c=BT(n,e,a,s),u=xte(P.Angle(o.bodyArc.center,o.start.point),P.Angle(o.bodyArc.center,o.end.point),Math.sign(e.props.bend),c);t=gl(o.bodyArc.center,o.bodyArc.radius,u)}const i=__(n,e);return{box:xe.FromCenter(t,i),debugGeom:r}}function BT(n,e,t,r){const{hasEndArrowhead:o,hasEndBinding:s,hasStartBinding:i,hasStartArrowhead:a}=r,c=BF(n,e);let u=Cn(e.props.labelPosition,a||i?t.start:0,o||s?t.end:1);const h=Math.min(.02,500/c*.02);return u=u>=.5-h&&u<=.5+h?.5:u,u}function UT(n,e,t,r,o,s){const i=yw(n,e,s),a=ia(t,r,o);return i==null?void 0:i.filter(c=>{const u=ia(t,P.Angle(n,c),o);return u>=0&&u<=a})}function HT(n,e){let t=null,r=-1/0;for(const o of e){const s=P.Dist2(n,o);s>r&&(t=o,r=s)}return t}function xte(n,e,t,r){const o=ia(n,e,t);return n+o*r*t*-1}function Yw(n){return Iee[n.props.size]*n.props.scale}function wte(n,e,t){const r=e==="end"?n.end.point:n.start.point,o=e==="end"?n.start.point:n.end.point,s=n.isStraight?P.Dist(o,r):Math.abs(n.bodyArc.length),i=Math.max(Math.min(s/5,t*3),t);let a;if(n.isStraight)a=P.Nudge(r,o,i);else{const c=MK(r,i,n.handleArc.center,n.handleArc.radius);a=e==="end"?n.handleArc.sweepFlag?c[0]:c[1]:n.handleArc.sweepFlag?c[1]:c[0]}return P.IsNaN(a)&&(a=n.start.point),{point:r,int:a}}function bte({point:n,int:e}){const t=P.RotWith(e,n,ft/6),r=P.RotWith(e,n,-ft/6);return`M ${t.x} ${t.y} L ${n.x} ${n.y} L ${r.x} ${r.y}`}function _te({point:n,int:e}){const t=P.RotWith(e,n,ft/6),r=P.RotWith(e,n,-ft/6);return`M ${t.x} ${t.y} L ${r.x} ${r.y} L ${n.x} ${n.y} Z`}function Pte({point:n,int:e}){const t=P.Sub(e,n).div(2),r=P.Add(n,P.Rot(t,Dt)),o=P.Sub(n,P.Rot(t,Dt));return`M ${r.x} ${r.y} L ${e.x} ${e.y} L ${o.x} ${o.y} Z`}function Cte({point:n,int:e}){const t=P.Lrp(n,e,.45),r=P.Dist(t,n);return`M ${t.x-r},${t.y}
  a ${r},${r} 0 1,0 ${r*2},0
  a ${r},${r} 0 1,0 -${r*2},0 `}function Ite({point:n,int:e}){const t=P.Lrp(n,e,.75),r=P.RotWith(t,n,ft/4),o=P.RotWith(t,n,-ft/4),s=P.Lrp(r,o,.5);return s.add(P.Sub(s,n)),`M ${s.x} ${s.y} L ${o.x} ${o.y} ${n.x} ${n.y} L ${r.x} ${r.y} Z`}function Ete({int:n,point:e}){const t=P.Lrp(e,n,.85),r=P.Sub(t,e).div(2),o=P.Add(e,P.Rot(r,Dt)),s=P.Sub(e,P.Rot(r,Dt)),i=P.Add(t,P.Rot(r,Dt)),a=P.Sub(t,P.Rot(r,Dt));return`M ${o.x} ${o.y} L ${i.x} ${i.y} L ${a.x} ${a.y} L ${s.x} ${s.y} Z`}function kte({int:n,point:e}){const t=P.Sub(n,e).div(2),r=P.Add(e,P.Rot(t,Dt)),o=P.Sub(e,P.Rot(t,Dt));return`M ${r.x} ${r.y} L ${o.x} ${o.y}`}function Pg(n,e,t){const r=e==="end"?n.end.arrowhead:n.start.arrowhead;if(r==="none")return;const o=wte(n,e,t);if(o){switch(r){case"bar":return kte(o);case"square":return Ete(o);case"diamond":return Ite(o);case"dot":return Cte(o);case"inverted":return Pte(o);case"arrow":return bte(o);case"triangle":return _te(o)}return""}}function Tte(n){const{start:e,end:t,handleArc:{radius:r,largeArcFlag:o,sweepFlag:s}}=n;return`M${e.handle.x},${e.handle.y} A${r} ${r} 0 ${o} ${s} ${t.handle.x},${t.handle.y}`}function NF(n){const{start:e,end:t,bodyArc:{radius:r,largeArcFlag:o,sweepFlag:s}}=n;return`M${e.point.x},${e.point.y} A${r} ${r} 0 ${o} ${s} ${t.point.x},${t.point.y}`}function $F(n,e){return`M${n.x},${n.y}L${e.x},${e.y}`}function Mte(n){return $F(n.start.handle,n.end.handle)}function zF(n){return $F(n.start.point,n.end.point)}class Pf extends es{constructor(){super(...arguments);j(this,"_resizeInitialBindings",new Os)}canEdit(){return!0}canBind({toShapeType:t}){return t!=="arrow"}canSnap(){return!1}hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsBg(){return!0}hideSelectionBoundsFg(){return!0}canBeLaidOut(t){const r=jr(this.editor,t);return!r.start&&!r.end}getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{x:0,y:0},end:{x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw",scale:1}}getGeometry(t){const r=ks(this.editor,t),o=[],s=r.isStraight?new pi({start:P.From(r.start.point),end:P.From(r.end.point)}):new Ec({center:P.Cast(r.handleArc.center),start:P.Cast(r.start.point),end:P.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});let i;if(t.props.text.trim()){const a=_f(this.editor,t);o.push(...a.debugGeom),i=new Ns({x:a.box.x,y:a.box.y,width:a.box.w,height:a.box.h,isFilled:!0,isLabel:!0})}return new To({children:[...i?[s,i]:[s],...o]})}getHandles(t){const r=ks(this.editor,t);return[{id:"start",type:"vertex",index:"a0",x:r.start.handle.x,y:r.start.handle.y},{id:"middle",type:"virtual",index:"a2",x:r.middle.x,y:r.middle.y},{id:"end",type:"vertex",index:"a3",x:r.end.handle.x,y:r.end.handle.y}].filter(Boolean)}getText(t){return t.props.text}onHandleDrag(t,{handle:r,isPrecise:o}){const s=r.id,i=jr(this.editor,t);if(s==="middle"){const{start:A,end:R}=Tc(this.editor,t,i),L=P.Sub(R,A),K=P.Per(L),D=P.Med(R,A),U=P.Sub(D,K),V=P.Add(D,K),F=P.NearestPointOnLineSegment(U,V,r,!1);let $=P.Dist(F,D);return P.Clockwise(F,R,D)&&($*=-1),{id:t.id,type:t.type,props:{bend:$}}}const a={id:t.id,type:"arrow",props:{}},c=i[s],h=i[s==="start"?"end":"start"];if(this.editor.inputs.ctrlKey)return Sf(this.editor,t,s),a.props[s]={x:r.x,y:r.y},a;const f=this.editor.getShapePageTransform(t.id).applyToPoint(r),g=this.editor.getShapeAtPoint(f,{hitInside:!0,hitFrameInside:!0,margin:0,filter:A=>!A.isLocked&&this.editor.canBindShapes({fromShape:t,toShape:A,binding:"arrow"})});if(!g){Sf(this.editor,t,s);const A=ns(new P(r.x,r.y),this.editor);return a.props[s]={x:A.x,y:A.y},a}const y=this.editor.getShapeGeometry(g),v=xe.ZeroFix(y.bounds),w=this.editor.getShapePageTransform(a.id).applyToPoint(r),b=this.editor.getPointInShapeSpace(g,w);let _=o;_||(!c||c&&g.id!==c.toId)&&(_=this.editor.inputs.pointerVelocity.len()<.5),o||(y.isClosed||(_=!0),h&&g.id===h.toId&&h.props.isPrecise&&(_=!0));const T={x:(b.x-v.minX)/v.width,y:(b.y-v.minY)/v.height};_&&P.Dist(b,v.center)<Math.max(4,Math.min(Math.min(v.width,v.height)*.15,16))/this.editor.getZoomLevel()&&(T.x=.5,T.y=.5);const E={terminal:s,normalizedAnchor:T,isPrecise:_,isExact:this.editor.inputs.altKey};rd(this.editor,t,g.id,E),this.editor.setHintingShapes([g.id]);const M=jr(this.editor,t);return M.start&&M.end&&M.start.toId===M.end.toId&&P.Equals(M.start.props.normalizedAnchor,M.end.props.normalizedAnchor)&&rd(this.editor,t,M.end.toId,{...M.end.props,normalizedAnchor:{x:M.end.props.normalizedAnchor.x+.05,y:M.end.props.normalizedAnchor.y}}),a}onTranslateStart(t){const r=jr(this.editor,t),o=Tc(this.editor,t,r),s=this.editor.getShapePageTransform(t.id),i=this.editor.getSelectedShapeIds();if(!(r.start&&(i.includes(r.start.toId)||this.editor.isAncestorSelected(r.start.toId))||r.end&&(i.includes(r.end.toId)||this.editor.isAncestorSelected(r.end.toId)))){WT.set(t,{pagePosition:s.applyToPoint(t),terminalBindings:Wd(o,(a,c)=>{const u=r[a];return u?{binding:u,shapePosition:c,pagePosition:s.applyToPoint(c)}:null})}),r.start&&(bg({editor:this.editor,arrow:t,terminal:"start",useHandle:!0}),t=this.editor.getShape(t.id)),r.end&&bg({editor:this.editor,arrow:t,terminal:"end",useHandle:!0});for(const a of["start","end"]){const c=r[a];c&&this.editor.updateBinding({...c,props:{...c.props,isPrecise:!0}})}}}onTranslate(t,r){const o=WT.get(t);if(!o)return;const s=this.editor.getShapePageTransform(r.id),i=P.Sub(s.applyToPoint(r),o.pagePosition);for(const a of Object.values(o.terminalBindings)){if(!a)continue;const c=P.Add(a.pagePosition,P.Mul(i,.5)),u=this.editor.getShapeAtPoint(c,{hitInside:!0,hitFrameInside:!0,margin:0,filter:h=>!h.isLocked&&this.editor.canBindShapes({fromShape:r,toShape:h,binding:"arrow"})});if((u==null?void 0:u.id)===a.binding.toId){const h=xe.ZeroFix(this.editor.getShapeGeometry(u).bounds),f=this.editor.getPointInShapeSpace(u,c),g={x:(f.x-h.minX)/h.width,y:(f.y-h.minY)/h.height};rd(this.editor,r,u.id,{...a.binding.props,normalizedAnchor:g,isPrecise:!0})}else Sf(this.editor,r,a.binding.props.terminal)}}onResize(t,r){const{scaleX:o,scaleY:s}=r,i=this._resizeInitialBindings.get(t,()=>jr(this.editor,t)),a=Tc(this.editor,t,i),{start:c,end:u}=zt(t.props);let{bend:h}=t.props;i.start||(c.x=a.start.x*o,c.y=a.start.y*s),i.end||(u.x=a.end.x*o,u.y=a.end.y*s);const f=Math.abs(o),g=Math.abs(s),y=i!=null&&i.start?P.From(i.start.props.normalizedAnchor):null,v=i!=null&&i.end?P.From(i.end.props.normalizedAnchor):null;return o<0&&s>=0?(h!==0&&(h*=-1,h*=Math.max(f,g)),y&&(y.x=1-y.x),v&&(v.x=1-v.x)):o>=0&&s<0?(h!==0&&(h*=-1,h*=Math.max(f,g)),y&&(y.y=1-y.y),v&&(v.y=1-v.y)):o>=0&&s>=0?h!==0&&(h*=Math.max(f,g)):o<0&&s<0&&(h!==0&&(h*=Math.max(f,g)),y&&(y.x=1-y.x,y.y=1-y.y),v&&(v.x=1-v.x,v.y=1-v.y)),i.start&&y&&rd(this.editor,t,i.start.toId,{...i.start.props,normalizedAnchor:y.toJson()}),i.end&&v&&rd(this.editor,t,i.end.toId,{...i.end.props,normalizedAnchor:v.toJson()}),{props:{start:c,end:u,bend:h}}}onDoubleClickHandle(t,r){switch(r.id){case"start":return{id:t.id,type:t.type,props:{...t.props,arrowheadStart:t.props.arrowheadStart==="none"?"arrow":"none"}};case"end":return{id:t.id,type:t.type,props:{...t.props,arrowheadEnd:t.props.arrowheadEnd==="none"?"arrow":"none"}}}}component(t){const r=jo(),o=this.editor.getOnlySelectedShape(),s=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getIsReadonly(),i=ks(this.editor,t);if(!(i!=null&&i.isValid))return null;const a=_f(this.editor,t),c=t.id===this.editor.getOnlySelectedShapeId(),h=this.editor.getEditingShapeId()===t.id||t.props.text;return p.jsxs(p.Fragment,{children:[p.jsx(Sa,{style:{minWidth:50,minHeight:50},children:p.jsx(KT,{shape:t,shouldDisplayHandles:s&&(o==null?void 0:o.id)===t.id})}),h&&p.jsx(Am,{shapeId:t.id,classNamePrefix:"tl-arrow",type:"arrow",font:t.props.font,fontSize:Yw(t),lineHeight:Zn.lineHeight,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:r[t.props.labelColor].solid,textWidth:a.box.w-_g*2*t.props.scale,isSelected:c,padding:0,style:{transform:`translate(${a.box.center.x}px, ${a.box.center.y}px)`}})]})}indicator(t){const r=am(t.id),o=Jo(t.id+"_clip"),s=ks(this.editor,t);if(!s)return null;const{start:i,end:a}=Tc(this.editor,t,s==null?void 0:s.bindings),c=this.editor.getShapeGeometry(t),u=c.bounds,h=t.props.text.trim()?c.children[1]:null;if(P.Equals(i,a))return null;const f=Xn[t.props.size]*t.props.scale,g=s.start.arrowhead&&Pg(s,"start",f),y=s.end.arrowhead&&Pg(s,"end",f),v=s.isStraight?zF(s):NF(s),S=g&&s.start.arrowhead!=="arrow"||y&&s.end.arrowhead!=="arrow"||!!h;if(r&&h)return p.jsx("rect",{x:ee(h.x),y:ee(h.y),width:h.w,height:h.h,rx:3.5*t.props.scale,ry:3.5*t.props.scale});const w=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),b=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow");return p.jsxs("g",{children:[S&&p.jsx("defs",{children:p.jsx(UF,{hasText:t.props.text.trim().length>0,bounds:u,labelBounds:h?h.getBounds():new xe(0,0,0,0),as:w&&g?g:"",ae:b&&y?y:""})}),p.jsxs("g",{style:{clipPath:S?`url(#${o})`:void 0,WebkitClipPath:S?`url(#${o})`:void 0},children:[S&&p.jsx("rect",{x:u.minX-100,y:u.minY-100,width:u.width+200,height:u.height+200,opacity:0}),p.jsx("path",{d:v})]}),g&&p.jsx("path",{d:g}),y&&p.jsx("path",{d:y}),h&&p.jsx("rect",{x:ee(h.x),y:ee(h.y),width:h.w,height:h.h,rx:3.5,ry:3.5})]})}onEditEnd(t){const{id:r,type:o,props:{text:s}}=t;s.trimEnd()!==t.props.text&&this.editor.updateShapes([{id:r,type:o,props:{text:s.trimEnd()}}])}toSvg(t,r){r.addExportDef(x_(t.props.fill)),t.props.text&&r.addExportDef(Tm(t.props.font));const o=Ii(r),s=1/t.props.scale;return p.jsxs("g",{transform:`scale(${s})`,children:[p.jsx(KT,{shape:t,shouldDisplayHandles:!1}),p.jsx(Mm,{fontSize:Yw(t),font:t.props.font,align:"middle",verticalAlign:"middle",text:t.props.text,labelColor:o[t.props.labelColor].solid,bounds:_f(this.editor,t).box.clone().expandBy(-_g*t.props.scale),padding:0})]})}getCanvasSvgDefs(){return[w_(),{key:"arrow:dot",component:Ate},{key:"arrow:cross",component:jte}]}getInterpolatedProps(t,r,o){return{...o>.5?r.props:t.props,scale:it(t.props.scale,r.props.scale,o),start:{x:it(t.props.start.x,r.props.start.x,o),y:it(t.props.start.y,r.props.start.y,o)},end:{x:it(t.props.end.x,r.props.end.x,o),y:it(t.props.end.y,r.props.end.y,o)},bend:it(t.props.bend,r.props.bend,o),labelPosition:it(t.props.labelPosition,r.props.labelPosition,o)}}}j(Pf,"type","arrow"),j(Pf,"props",lj),j(Pf,"migrations",cj);function BF(n,e){const t=ks(n,e);return t.isStraight?P.Dist(t.start.handle,t.end.handle):Math.abs(t.handleArc.length)}const KT=On(function({shape:e,shouldDisplayHandles:t}){const r=te(),o=jo(),s=ks(r,e),i=xe.ZeroFix(r.getShapeGeometry(e).bounds),a=jr(r,e),c=re("force solid",()=>r.getZoomLevel()<.2,[r]),u=Jo(e.id+"_clip"),h=Jo("arrowhead-dot"),f=Jo("arrowhead-cross");if(!(s!=null&&s.isValid))return null;const g=Xn[e.props.size]*e.props.scale,y=s.start.arrowhead&&Pg(s,"start",g),v=s.end.arrowhead&&Pg(s,"end",g),S=s.isStraight?zF(s):NF(s);let w=null;if(t){const A=2/r.getZoomLevel(),{strokeDasharray:R,strokeDashoffset:L}=qo(BF(r,e),A,{end:"skip",start:"skip",lengthRatio:2.5});w=a.start||a.end?p.jsx("path",{className:"tl-arrow-hint",d:s.isStraight?Mte(s):Tte(s),strokeDasharray:R,strokeDashoffset:L,strokeWidth:A,markerStart:a.start?a.start.props.isExact?"":a.start.props.isPrecise?`url(#${f})`:`url(#${h})`:"",markerEnd:a.end?a.end.props.isExact?"":a.end.props.isPrecise?`url(#${f})`:`url(#${h})`:"",opacity:.16}):null}const{strokeDasharray:b,strokeDashoffset:_}=qo(s.isStraight?s.length:Math.abs(s.bodyArc.length),g,{style:e.props.dash,forceSolid:c}),T=_f(r,e),E=!(s.start.arrowhead==="none"||s.start.arrowhead==="arrow"),M=!(s.end.arrowhead==="none"||s.end.arrowhead==="arrow");return p.jsxs(p.Fragment,{children:[p.jsx("defs",{children:p.jsx("clipPath",{id:u,children:p.jsx(UF,{hasText:e.props.text.trim().length>0,bounds:i,labelBounds:T.box,as:E&&y?y:"",ae:M&&v?v:""})})}),p.jsxs("g",{fill:"none",stroke:o[e.props.color].solid,strokeWidth:g,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[w,p.jsxs("g",{style:{clipPath:`url(#${u})`,WebkitClipPath:`url(#${u})`},children:[p.jsx("rect",{x:ee(i.minX-100),y:ee(i.minY-100),width:ee(i.width+200),height:ee(i.height+200),opacity:0}),p.jsx("path",{d:S,strokeDasharray:b,strokeDashoffset:_})]}),y&&E&&e.props.fill!=="none"&&p.jsx(Kn,{theme:o,d:y,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),v&&M&&e.props.fill!=="none"&&p.jsx(Kn,{theme:o,d:v,color:e.props.color,fill:e.props.fill,scale:e.props.scale}),y&&p.jsx("path",{d:y}),v&&p.jsx("path",{d:v})]})]})});function UF({hasText:n,bounds:e,labelBounds:t,as:r,ae:o}){const s=`M${ee(e.minX-100)},${ee(e.minY-100)} h${e.width+200} v${e.height+200} h-${e.width+200} Z`,i=`M${ee(t.minX)},${ee(t.minY)} v${t.height} h${t.width} v-${t.height} Z`;return p.jsx("path",{d:`${s}${n?i:""}${r}${o}`})}const WT=new WeakMap;function Ate(){const n=Jo("arrowhead-dot");return p.jsx("marker",{id:n,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:p.jsx("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function jte(){const n=Jo("arrowhead-cross");return p.jsxs("marker",{id:n,className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[p.jsx("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),p.jsx("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}const VT="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function Wc({url:n}){const e=te(),t=re("zoomLevel",()=>e.getZoomLevel()<.32,[e]);return p.jsx("a",{className:Fe("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t}),href:n,target:"_blank",rel:"noopener noreferrer",onPointerDown:cn,onPointerUp:cn,title:n,draggable:!1,children:p.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${VT}") center 100% / 100% no-repeat`,WebkitMask:`url("${VT}") center 100% / 100% no-repeat`}})})}const GT="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E",Rte=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function Cg(n){return Rte.map(t=>{const{offsetX:r,offsetY:o,blur:s,spread:i,color:a}=t,c=new P(r,o),{x:u,y:h}=c.rot(-n);return`${u}px ${h}px ${s}px ${i}px ${a}`}).join(", ")}const Ote=300,HF=320,Dte=46,Lte=101;class Cf extends lu{canResize(){return!1}hideSelectionBoundsFg(){return!0}getText(e){return e.props.url}getDefaultProps(){return{url:"",w:Ote,h:HF,assetId:null}}component(e){return p.jsx(Fte,{shape:e,util:this})}indicator(e){return p.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h),rx:"6",ry:"6"})}onBeforeCreate(e){return qT(this.editor,e)}onBeforeUpdate(e,t){if(e.props.url!==t.props.url)if(ro.isValid(t.props.url))$te(this.editor,t);else return{...t,props:{...t.props,url:e.props.url}};if(e.props.assetId!==t.props.assetId)return qT(this.editor,t)}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:it(e.props.w,t.props.w,r),h:it(e.props.h,t.props.h,r)}}}j(Cf,"type","bookmark"),j(Cf,"props",gj),j(Cf,"migrations",mj);function Fte({shape:n,util:e}){const t=n.props.assetId?e.editor.getAsset(n.props.assetId):null,r=!!rh()&&kt.isSafari,o=e.editor.getShapePageTransform(n).rotation(),s=Nte(n),[i,a]=C.useState(!0),c=()=>a(!1);return p.jsx(fa,{children:p.jsxs("div",{className:Fe("tl-bookmark__container",r&&"tl-bookmark__container--safariExport"),style:{boxShadow:r?void 0:Cg(o),maxHeight:n.props.h},children:[(!t||t.props.image)&&p.jsxs("div",{className:"tl-bookmark__image_container",children:[t?p.jsx("img",{className:"tl-bookmark__image",draggable:!1,referrerPolicy:"strict-origin-when-cross-origin",src:t==null?void 0:t.props.image,alt:(t==null?void 0:t.props.title)||""}):p.jsx("div",{className:"tl-bookmark__placeholder"}),(t==null?void 0:t.props.image)&&p.jsx(Wc,{url:n.props.url})]}),p.jsxs("div",{className:"tl-bookmark__copy_container",children:[t!=null&&t.props.title?p.jsx("h2",{className:"tl-bookmark__heading",children:Ree(t.props.title)}):null,t!=null&&t.props.description&&(t!=null&&t.props.image)?p.jsx("p",{className:"tl-bookmark__description",children:t.props.description}):null,p.jsxs("a",{className:"tl-bookmark__link",href:n.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:cn,onPointerUp:cn,onClick:cn,children:[i&&(t!=null&&t.props.favicon)?p.jsx("img",{className:"tl-bookmark__favicon",src:t==null?void 0:t.props.favicon,referrerPolicy:"strict-origin-when-cross-origin",onError:c,alt:`favicon of ${s}`}):p.jsx("div",{className:"tl-hyperlink__icon",style:{mask:`url("${GT}") center 100% / 100% no-repeat`,WebkitMask:`url("${GT}") center 100% / 100% no-repeat`}}),p.jsx("span",{children:s})]})]})]})})}function qT(n,e){const t=e.props.assetId?n.getAsset(e.props.assetId):null;let r=HF;return t&&(t.props.image||(t.props.title?r=Lte:r=Dte)),{...e,props:{...e.props,h:r}}}const Nte=n=>{try{return new URL(n.props.url).hostname.replace(/^www\./,"")}catch{return n.props.url}};function $te(n,e){const{url:t}=e.props,r=sa.createId(ew(t));n.getAsset(r)?e.props.assetId!==r&&n.updateShapes([{id:e.id,type:e.type,props:{assetId:r}}]):(n.updateShapes([{id:e.id,type:e.type,props:{assetId:null}}]),zte(n,e))}const zte=Ag(async(n,e)=>{if(n.isDisposed)return;const{url:t}=e.props,r=await n.getAssetForExternalContent({type:"url",url:t});r&&n.run(()=>{n.createAssets([r]),n.updateShapes([{id:e.id,type:e.type,props:{assetId:r.id}}])})},500);function wl(n,e=!1){const t=n.length;if(t<2)return"";let r=n[0].point,o=n[1].point;if(t===2)return`M${pt(r)}L${pt(o)}`;let s="";for(let i=2,a=t-1;i<a;i++)r=n[i].point,o=n[i+1].point,s+=Ar(r,o);return e?`M${Ar(n[0].point,n[1].point)}Q${pt(n[1].point)}${Ar(n[1].point,n[2].point)}T${s}${Ar(n[t-1].point,n[0].point)}${Ar(n[0].point,n[1].point)}Z`:`M${pt(n[0].point)}Q${pt(n[1].point)}${Ar(n[1].point,n[2].point)}${n.length>3?"T":""}${s}L${pt(n[t-1].point)}`}function Bte(n,e={}){const{start:t={},end:r={}}=e,{cap:o=!0}=t,{cap:s=!0}=r;yt(!t.taper&&!r.taper,"cap taper not supported here"),yt(!t.easing&&!r.easing,"cap easing not supported here"),yt(o&&s,"cap must be true");const i=zs(n,e);Em(i,e);const a=Ute(i);let c="";for(const u of a)c+=Kte(u,e);return c}function Ute(n){if(n.length<=2)return[n];const e=[];let t=[n[0]],r=P.Sub(n[1].point,n[0].point).uni(),o,s,i,a,c;for(let u=1,h=n.length;u<h-1;u++){if(i=n[u-1],a=n[u],c=n[u+1],o=P.Sub(c.point,a.point).uni(),s=P.Dpr(r,o),r=o,s<-.8){const f={...a,point:a.input};t.push(f),e.push(wx(t)),t=[f];continue}if(t.push(a),!(s>.7)&&(P.Dist2(i.point,a.point)+P.Dist2(a.point,c.point))/((i.radius+a.radius+c.radius)/3)**2<1.5){t.push(a),e.push(wx(t)),t=[a];continue}}return t.push(n[n.length-1]),e.push(wx(t)),e}function wx(n){const e=n[0];let t;for(;n.length>2&&(t=n[1],P.Dist2(e.point,t.point)<((e.radius+t.radius)/2*.5)**2);)n.splice(1,1);const r=n[n.length-1];let o;for(;n.length>2&&(o=n[n.length-2],P.Dist2(r.point,o.point)<((r.radius+o.radius)/2*.5)**2);)n.splice(n.length-2,1);return n.length>1&&(n[0]={...n[0],vector:P.Sub(n[0].point,n[1].point).uni()},n[n.length-1]={...n[n.length-1],vector:P.Sub(n[n.length-2].point,n[n.length-1].point).uni()}),n}function Hte(n,e,t){return"M "+n+" "+e+" m -"+t+", 0 a "+t+","+t+" 0 1,1 "+t*2+",0 a "+t+","+t+" 0 1,1 -"+t*2+",0"}function Kte(n,e={}){if(n.length===0)return"";if(n.length===1)return Hte(n[0].point.x,n[0].point.y,n[0].radius);const{left:t,right:r}=_F(n,e);r.reverse();let o=`M${pt(t[0])}T`;for(let s=1;s<t.length;s++)o+=Ar(t[s-1],t[s]);{const s=n[n.length-1],i=s.radius,a=s.vector.clone().per().neg(),c=P.Add(s.point,P.Mul(a,i)),u=P.Add(s.point,P.Mul(a,-i));o+=`${pt(c)}A${ee(i)},${ee(i)} 0 0 1 ${pt(u)}T`}for(let s=1;s<r.length;s++)o+=Ar(r[s-1],r[s]);{const s=n[0],i=s.radius,a=s.vector.clone().per(),c=P.Add(s.point,P.Mul(a,i)),u=P.Add(s.point,P.Mul(a,-i));o+=`${pt(c)}A${ee(i)},${ee(i)} 0 0 1 ${pt(u)}Z`}return o}const KF=(n,e,t)=>{const r=[],o=[];n.forEach(u=>r.push(...u.points)),e.forEach(u=>o.push(...u.points));const s=Math.max(r.length,o.length),i=[],a=[];for(let u=0;u<s;u++)i.push(r[u]||r[r.length-1]),a.push(o[u]||o[o.length-1]);return[{type:"free",points:i.map((u,h)=>{let f=.5;return a[h].z!==void 0&&u.z!==void 0&&(f=it(u.z,a[h].z,t)),{x:it(u.x,a[h].x,t),y:it(u.y,a[h].y,t),z:f}})}]},Wte=n=>n*.65+XU(n*ft/2)*.35,Vte=n=>({size:n,thinning:.5,streamline:Bc(n,[9,16],[.64,.74],!0),smoothing:.62,easing:xn.easeOutSine,simulatePressure:!0}),Gte=n=>({size:1+n*1.2,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:Wte}),YT=n=>({size:n,thinning:0,streamline:Bc(n,[9,16],[.64,.74],!0),smoothing:.62,simulatePressure:!1,easing:xn.linear}),qte=n=>({size:n,thinning:0,streamline:.62,smoothing:.62,simulatePressure:!1,easing:xn.linear});function P_({strokeWidth:n,showAsComplete:e}){return{size:1+n,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:xn.easeOutSine,last:e}}function Xw(n,e,t,r){const o=n.isComplete||t;return r?n.isPen?{...qte(e),last:o}:{...YT(e),last:o}:n.dash==="draw"?n.isPen?{...Gte(e),last:o}:{...Vte(e),last:o}:{...YT(e),last:o}}function Vc(n){const e=[];for(const t of n)if(t.type==="free"||t.points.length<2)e.push(...t.points.map(P.Cast));else{const r=Math.max(4,Math.floor(P.Dist(t.points[0],t.points[1])/16));e.push(...P.PointsBetween(t.points[0],t.points[1],r))}return e}function Yte(n,e,t){return{draw:"none",solid:"none",dotted:`${t} ${e*2}`,dashed:`${e*2} ${e*2}`}[n.props.dash]}class If extends es{hideResizeHandles(e){return bx(e)}hideRotateHandle(e){return bx(e)}hideSelectionBoundsFg(e){return bx(e)}getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1,scale:1}}getGeometry(e){const t=Vc(e.props.segments),r=(Xn[e.props.size]+1)*e.props.scale;if(e.props.segments.length===1){const s=xe.FromPoints(t);if(s.width<r*2&&s.height<r*2)return new R1({x:-r,y:-r,radius:r,isFilled:!0})}const o=zs(t,Xw(e.props,r,e.props.isPen,!0)).map(s=>s.point);return e.props.isClosed?new on({points:o,isFilled:e.props.fill!=="none"}):new su({points:o})}component(e){return p.jsx(Sa,{children:p.jsx(XT,{shape:e})})}indicator(e){var h;const t=Vc(e.props.segments);let r=(Xn[e.props.size]+1)*e.props.scale;const o=this.editor.getZoomLevel();!(o<.5&&o<1.5/r)&&!e.props.isPen&&e.props.dash==="draw"&&t.length===1&&(r+=rs(e.id)()*(r/6));const i=e.props.isComplete||((h=En(e.props.segments))==null?void 0:h.type)==="straight",a=Xw(e.props,r,i,!0),c=zs(t,a),u=c.length>1?wl(c,e.props.isClosed):WF(t[0],r);return p.jsx("path",{d:u})}toSvg(e,t){t.addExportDef(x_(e.props.fill));const r=1/e.props.scale;return p.jsx("g",{transform:`scale(${r})`,children:p.jsx(XT,{shape:e,zoomOverride:1})})}getCanvasSvgDefs(){return[w_()]}onResize(e,t){const{scaleX:r,scaleY:o}=t,s=[];for(const i of e.props.segments)s.push({...i,points:i.points.map(({x:a,y:c,z:u})=>({x:di(r*a),y:di(o*c),z:u}))});return{props:{segments:s}}}expandSelectionOutlinePx(e){const t=e.props.dash==="draw"?1.6:1;return Xn[e.props.size]*t/2*e.props.scale}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,segments:KF(e.props.segments,t.props.segments,r),scale:it(e.props.scale,t.props.scale,r)}}}j(If,"type","draw"),j(If,"props",vj),j(If,"migrations",Sj);function WF(n,e){const t=(e+1)*.5;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function bx(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function XT({shape:n,zoomOverride:e}){var y;const t=jo(),r=te(),o=Vc(n.props.segments),s=n.props.isComplete||((y=En(n.props.segments))==null?void 0:y.type)==="straight";let i=(Xn[n.props.size]+1)*n.props.scale;const a=re("force solid",()=>{const v=e??r.getZoomLevel();return v<.5&&v<1.5/i},[r,i,e]),c=re("dot adjustment",()=>(e??r.getZoomLevel())<.2?0:.1,[r,e]);!a&&!n.props.isPen&&n.props.dash==="draw"&&o.length===1&&(i+=rs(n.id)()*(i/6));const u=Xw(n.props,i,s,a);if(!a&&n.props.dash==="draw")return p.jsxs(p.Fragment,{children:[n.props.isClosed&&n.props.fill&&o.length>1?p.jsx(Kn,{d:wl(zs(o,u),n.props.isClosed),theme:t,color:n.props.color,fill:n.props.isClosed?n.props.fill:"none",scale:n.props.scale}):null,p.jsx("path",{d:Bte(o,u),strokeLinecap:"round",fill:t[n.props.color].solid})]});const h=zs(o,u),f=h.length<2,g=f?WF(o[0],0):wl(h,n.props.isClosed);return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{d:g,theme:t,color:n.props.color,fill:f||n.props.isClosed?n.props.fill:"none",scale:n.props.scale}),p.jsx("path",{d:g,strokeLinecap:"round",fill:f?t[n.props.color].solid:"none",stroke:t[n.props.color].solid,strokeWidth:i,strokeDasharray:f?"none":Yte(n,i,c),strokeDashoffset:"0"})]})}function Xte(n){if(typeof n!="string")throw new TypeError("Expected a string");return n.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function Zte(n,e){const t=Ge(e);if(!t)return;const r=t.host.replace("www.","");for(const o of n)if(VF(o.hostnames,r)){const s=o.fromEmbedUrl(e);if(s)return{definition:o,url:s,embedUrl:e}}}const Qte=n=>n.split("*").map(e=>Xte(e)).join(".+"),VF=(n,e)=>!!n.find(t=>{const r=new RegExp(Qte(t));return e.match(r)});function Jte(n,e){const t=Ge(e);if(!t)return;const r=t.host.replace("www.","");for(const o of n)if(VF(o.hostnames,r)){const s=o.toEmbedUrl(e);if(s)return{definition:o,embedUrl:s,url:e}}}function ene(n,e){try{return Jte(n,e)??Zte(n,e)}catch{return}}const tne=n=>Object.entries(n).filter(([e,t])=>t).map(([e])=>e).join(" "),ui=class ui extends lu{static setEmbedDefinitions(e){ui.embedDefinitions=e}getEmbedDefinitions(){return ui.embedDefinitions}getEmbedDefinition(e){return ene(ui.embedDefinitions,e)}getText(e){return e.props.url}hideSelectionBoundsFg(e){return!this.canResize(e)}canEdit(){return!0}canResize(e){var t,r;return!!((r=(t=this.getEmbedDefinition(e.props.url))==null?void 0:t.definition)!=null&&r.doesResize)}canEditInReadOnly(){return!0}getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked(e){const t=this.getEmbedDefinition(e.props.url);return(t==null?void 0:t.definition.isAspectRatioLocked)??!1}onResize(e,t){const r=this.isAspectRatioLocked(e),o=this.getEmbedDefinition(e.props.url);let s=(o==null?void 0:o.definition.minWidth)??200,i=(o==null?void 0:o.definition.minHeight)??200;if(r){const a=e.props.w/e.props.h;a>1?s*=a:i/=a}return im(e,t,{minWidth:s,minHeight:i})}component(e){const t=rh(),{w:r,h:o,url:s}=e.props,i=am(e.id),a=this.getEmbedDefinition(s),c=re("is hovering",()=>{const{editingShapeId:y,hoveredShapeId:v}=this.editor.getCurrentPageState();if(y&&v!==y){const S=this.editor.getShape(y);if(S&&this.editor.isShapeOfType(S,"embed"))return!0}return!1},[]),u=this.editor.getShapePageTransform(e).rotation();if(t)return p.jsx(fa,{className:"tl-embed-container",id:e.id,children:p.jsx("div",{className:"tl-embed",style:{border:0,boxShadow:Cg(u),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:(a==null?void 0:a.definition.backgroundColor)??"var(--color-background)",width:r,height:o}})});const h=i||c;if(typeof window<"u"&&(window!==window.top||window.self!==window.parent)&&(a==null?void 0:a.definition.type)==="tldraw")return null;if((a==null?void 0:a.definition.type)==="github_gist"){const y=a.url.split("/").pop();if(!y)throw Error("No gist id!");return p.jsx(fa,{className:"tl-embed-container",id:e.id,children:p.jsx(nne,{id:y,width:ee(r),height:ee(o),isInteractive:h,pageRotation:u})})}const g=tne({...aQ,...(a==null?void 0:a.definition.overridePermissions)??{}});return p.jsx(fa,{className:"tl-embed-container",id:e.id,children:a!=null&&a.definition?p.jsx("iframe",{className:"tl-embed",sandbox:g,src:a.embedUrl,width:ee(r),height:ee(o),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:h?"auto":"none",zIndex:h?"":"-1",boxShadow:Cg(u),borderRadius:(a==null?void 0:a.definition.overrideOutlineRadius)??8,background:a==null?void 0:a.definition.backgroundColor}}):null})}indicator(e){const t=this.getEmbedDefinition(e.props.url);return p.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h),rx:(t==null?void 0:t.definition.overrideOutlineRadius)??8,ry:(t==null?void 0:t.definition.overrideOutlineRadius)??8})}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:it(e.props.w,t.props.w,r),h:it(e.props.h,t.props.h,r)}}};j(ui,"type","embed"),j(ui,"props",xj),j(ui,"migrations",wj),j(ui,"embedDefinitions",l_);let Ig=ui;function nne({id:n,file:e,isInteractive:t,width:r,height:o,style:s,pageRotation:i}){return p.jsx("iframe",{className:"tl-embed",draggable:!1,width:ee(r),height:ee(o),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...s,pointerEvents:t?"all":"none",zIndex:t?"":"-1",boxShadow:Cg(i)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=${`https://gist.github.com/${n}.js${e?`?file=${e}`:""}`}><\/script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}function Zw(n,e){const o=((ll(n.getShapePageTransform(e.id).rotation())+Math.PI/4)*(2/Math.PI)+4)%4;return Math.floor(o)}function ZT(n,e,t){const r=n.textMeasure.measureTextSpans(qF(e.props.name,"Frame")+"​",t),o=r[0],s=En(r),i=s.box.w+s.box.x-o.box.x;return{box:new xe(0,-t.height,i,t.height),spans:r}}function QT(n,e){return{fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:n.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle",fill:e,offsetY:-34,offsetX:2}}function GF(n,e,t){const r=t?"":"px",o=t?"":"deg";let s;switch(e){case 0:s="";break;case 3:s=`translate(${ee(n.props.w)}${r}, 0${r}) rotate(90${o})`;break;case 2:s=`translate(${ee(n.props.w)}${r}, ${ee(n.props.h)}${r}) rotate(180${o})`;break;case 1:s=`translate(0${r}, ${ee(n.props.h)}${r}) rotate(270${o})`;break;default:throw Error("labelSide out of bounds")}return s}const rne=C.forwardRef(({id:n,name:e,isEditing:t},r)=>{const o=te(),s=C.useCallback(c=>{c.key==="Enter"&&!c.nativeEvent.isComposing&&(cn(c),c.currentTarget.blur(),o.setEditingShape(null))},[o]),i=C.useCallback(c=>{const u=o.getShape(n);if(!u)return;const h=u.props.name,f=c.currentTarget.value.trim();h!==f&&o.updateShapes([{id:n,type:"frame",props:{name:f}}])},[n,o]),a=C.useCallback(c=>{const u=o.getShape(n);if(!u)return;const h=u.props.name,f=c.currentTarget.value;h!==f&&o.updateShapes([{id:n,type:"frame",props:{name:f}}])},[n,o]);return p.jsxs("div",{className:`tl-frame-label ${t?"tl-frame-label__editing":""}`,children:[p.jsx("input",{className:"tl-frame-name-input",ref:r,style:{display:t?void 0:"none"},value:e,autoFocus:!0,onKeyDown:s,onBlur:i,onChange:a}),qF(e,"Frame")+"​"]})});function one({id:n,name:e,width:t,height:r}){const o=te(),{side:s,translation:i}=re("shape rotation",()=>{const u=o.getShape(n);if(!u)return{side:0,translation:"translate(0, 0)"};const h=Zw(o,u);return{side:h,translation:GF(u,h,!1)}},[o,n]),a=C.useRef(null),c=am(n);return C.useEffect(()=>{const u=a.current;u&&c&&(u.focus(),u.select())},[a,c]),p.jsx("div",{className:"tl-frame-heading",style:{overflow:c?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${Math.ceil(s===0||s===2?t:r)}px + var(--space-5))`,bottom:"100%",transform:`${i} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},children:p.jsx("div",{className:"tl-frame-heading-hit-area",children:p.jsx(rne,{ref:a,id:n,name:e,isEditing:c})})})}function qF(n,e){return n.match(/^\s*$/)?e:n}class Ef extends lu{canEdit(){return!0}getDefaultProps(){return{w:160*2,h:90*2,name:""}}getGeometry(e){const{editor:t}=this,r=t.getZoomLevel(),o=QT(e,"black"),s=ZT(t,e,o),i=Zw(t,e);let a,c,u,h;const{w:f,h:g}=s.box,y=Math.min(f,e.props.w*r),v=Math.min(g,e.props.h*r);switch(i){case 0:{a=-8/r,c=(-g-4)/r,u=(y+16)/r,h=g/r;break}case 1:{a=(-g-4)/r,h=(v+16)/r,c=e.props.h-h+8/r,u=g/r;break}case 2:{a=e.props.w-(y+8)/r,c=e.props.h+4/r,u=(v+16)/r,h=g/r;break}case 3:{a=e.props.w+4/r,h=(v+16)/r,c=-8/r,u=g/r;break}}return new To({children:[new Ns({width:e.props.w,height:e.props.h,isFilled:!1}),new Ns({x:a,y:c,width:u,height:h,isFilled:!0,isLabel:!0})]})}getText(e){return e.props.name}component(e){const t=this.editor.getShapeGeometry(e).bounds,r=jo(),o=re("is creating this shape",()=>{const s=this.editor.getStateDescendant("select.resizing");if(!s||!s.getIsActive())return!1;const i=s==null?void 0:s.info;return i?i.isCreating&&this.editor.getOnlySelectedShapeId()===e.id:!1},[e.id]);return p.jsxs(p.Fragment,{children:[p.jsx(Sa,{children:p.jsx("rect",{className:Fe("tl-frame__body",{"tl-frame__creating":o}),width:t.width,height:t.height,fill:r.solid,stroke:r.text})}),o?null:p.jsx(one,{id:e.id,name:e.props.name,width:t.width,height:t.height})]})}toSvg(e,t){const r=Ii({isDarkMode:t.isDarkMode}),o=Zw(this.editor,e),s=GF(e,o,!0),i=QT(e,r.text),{box:a,spans:c}=ZT(this.editor,e,i),u=qw(this.editor,c,i);return p.jsxs(p.Fragment,{children:[p.jsx("rect",{width:e.props.w,height:e.props.h,fill:r.solid,stroke:r.black.solid,strokeWidth:1,rx:1,ry:1}),p.jsxs("g",{transform:s,children:[p.jsx("rect",{x:a.x-8,y:a.y-4,width:a.width+20,height:a.height,fill:r.background,rx:4,ry:4}),u]})]})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds;return p.jsx("rect",{width:ee(t.width),height:ee(t.height),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType(e,t){return!e.isLocked}providesBackgroundForChildren(){return!0}canDropShapes(e,t){return!e.isLocked}onDragShapesOver(e,t){t.every(r=>r.parentId===e.id)||this.editor.reparentShapes(t,e.id)}onDragShapesOut(e,t){const r=this.editor.getShape(e.parentId);r&&this.editor.isShapeOfType(r,"group")?this.editor.reparentShapes(t,r.id):this.editor.reparentShapes(t,this.editor.getCurrentPageId())}onResize(e,t){return im(e,t)}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:it(e.props.w,t.props.w,r),h:it(e.props.h,t.props.h,r)}}}j(Ef,"type","frame"),j(Ef,"props",bj),j(Ef,"migrations",_j);function JT(n,e){return n>e?(ft*(e/2)+(n-e))*2:(ft*(n/2)+(e-n))*2}function YF(n,e){return C_(n,e).map((t,r)=>t.getSvgPathData(r===0)).join(" ")+" Z"}function sne(n,e,t,r){const o=n/4,s=e/4,i=rs(r),a=t*.75,c=_=>_.addXY(i()*a,i()*a),u=new P(n/2,e),h=new P(0,s*1.2),f=new P(n/2,s*.9),g=new P(n,s*1.2),y=c(new P(n/2,e)),v=c(new P(0,s*1.2)),S=c(new P(n/2,s*.9)),w=c(new P(n,s*1.2));return[new Vn({start:u,cp1:new P(o*1.5,s*3),cp2:new P(0,s*2.5),end:h}),new Vn({start:h,cp1:new P(0,-s*.32),cp2:new P(o*1.85,-s*.32),end:f}),new Vn({start:f,cp1:new P(o*2.15,-s*.32),cp2:new P(n,-s*.32),end:g}),new Vn({start:g,cp1:new P(n,s*2.5),cp2:new P(o*2.5,s*3),end:y}),new Vn({start:y,cp1:new P(o*1.5,s*3),cp2:new P(0,s*2.5),end:v}),new Vn({start:v,cp1:new P(0,-s*.32),cp2:new P(o*1.85,-s*.32),end:S}),new Vn({start:S,cp1:new P(o*2.15,-s*.32),cp2:new P(n,-s*.32),end:w}),new Vn({start:w,cp1:new P(n,s*2.5),cp2:new P(o*2.5,s*3),end:u})].map((_,T)=>_.getSvgPathData(T===0)).join(" ")+" Z"}function C_(n,e){const t=n/4,r=e/4;return[new Vn({start:new P(n/2,e),cp1:new P(t*1.5,r*3),cp2:new P(0,r*2.5),end:new P(0,r*1.2)}),new Vn({start:new P(0,r*1.2),cp1:new P(0,-r*.32),cp2:new P(t*1.85,-r*.32),end:new P(n/2,r*.9)}),new Vn({start:new P(n/2,r*.9),cp1:new P(t*2.15,-r*.32),cp2:new P(n,-r*.32),end:new P(n,r*1.2)}),new Vn({start:new P(n,r*1.2),cp1:new P(n,r*2.5),cp2:new P(t*2.5,r*3),end:new P(n/2,e)})]}function ine(n){return{size:1+n,thinning:.25,end:{taper:n},start:{taper:n},streamline:0,smoothing:1,simulatePressure:!1}}function ane(n,e,t,r){const o=rs(n),s=e/2,i=t/2,a=Uj(s,i),c=[],u=xt*o(),h=xt+Dt/2+Math.abs(o())*Dt,f=Math.max(16,a/10);for(let g=0;g<f;g++){const y=g/(f-1),v=u+y*h,S=Math.cos(v),w=Math.sin(v);c.push(new P(s*S+e*.5+.05*o(),i*w+t/2+.05*o(),Math.min(1,.5+Math.abs(.5-(o()>0?xn.easeInOutSine(y):xn.easeInExpo(y)))/2)))}return zs(c,ine(r))}function lne(n,e,t,r){return wl(ane(n,e,t,r))}function Qw(n){let e="M";const t=n.length;let r,o,s;for(let i=0,a=t;i<a;i+=3)r=n[i],o=n[i+1],s=n[i+2],e+=`${pt(r)}L${pt(o)}Q${pt(s)}`;return e+=`${pt(n[0])}`,e}function Jw(n,e,t,r,o){const s=[],i=rs(n);let a=e[0],c;const u=e.length;for(let h=0,f=u*o;h<f;h++){c=P.AddXY(e[(h+1)%u],i()*t,i()*t);const g=P.Sub(c,a),y=P.Len(g),v=P.Div(g,y).mul(Math.min(y/4,r));s.push(P.Add(a,v),P.Add(c,v.neg()),c),a=c}return s}function cne(n,e,t){const r=Math.min(n,e)/2,o=Math.max(n,e)-r*2,i=(Math.PI*(r*2)+2*o)/t,a=n>e?[{type:"straight",start:new P(r,0),delta:new P(1,0)},{type:"arc",center:new P(n-r,r),startAngle:-ft/2},{type:"straight",start:new P(n-r,e),delta:new P(-1,0)},{type:"arc",center:new P(r,r),startAngle:ft/2}]:[{type:"straight",start:new P(n,r),delta:new P(0,1)},{type:"arc",center:new P(r,e-r),startAngle:0},{type:"straight",start:new P(0,e-r),delta:new P(0,-1)},{type:"arc",center:new P(r,r),startAngle:ft}];let c=0;const u=[];for(let h=0;h<t;h++){const f=a[0];f.type==="straight"?u.push(P.Add(f.start,P.Mul(f.delta,c))):u.push(gl(f.center,r,f.startAngle+c/r)),c+=i;let g=f.type==="straight"?o:ft*r;for(;c>g;)c-=g,a.push(a.shift()),g=a[0].type==="straight"?o:ft*r}return u}const une={s:50,m:70,l:100,xl:130},dne=.2;function jm(n,e,t,r,o){const s=rs(t),i=JT(n,e),a=Math.max(Math.ceil(i/une[r]),6,Math.ceil(i/Math.min(n,e))),c=i/a*dne,u=Math.max(n-c*2,1),h=Math.max(e-c*2,1),g=JT(u,h)/a,y=(n-u)/2,v=(e-h)/2,S=cne(u,h,a).map(E=>E.addXY(y,v)),w=n<20?0:c*.3,b=e<20?0:c*.3,_=S.slice(0);for(let E=0;E<Math.floor(a/2);E++)_[E]=P.AddXY(_[E],s()*w*o,s()*b*o),_[a-E-1]=P.AddXY(_[a-E-1],s()*w*o,s()*b*o);const T=[];for(let E=0;E<_.length;E++){const M=E===_.length-1?0:E+1,A=_[E],R=_[M],L=S[E],K=S[M],D=P.Dist(L,K),U=g-D,F=P.Dist(A,R)/D,$=(Math.max(y,v)+U)*F,H=P.Lrp(L,K,.5).add(P.Sub(K,L).uni().per().mul($));H.x<0?H.x=0:H.x>n&&(H.x=n),H.y<0?H.y=0:H.y>e&&(H.y=e);const Z=c1(A,R,H),G=P.Dist(Z||P.Average([A,R]),A);T.push({leftPoint:A,rightPoint:R,arcPoint:H,center:Z,radius:G})}return T}function hne(n,e,t,r,o){const s=[],i=jm(n,e,t,r,o);for(const{center:a,radius:c,leftPoint:u,rightPoint:h}of i)s.push(...e7(u,h,a,c,10));return s}function eb(n,e,t,r,o){const s=jm(n,e,t,r,o);let i=`M${s[0].leftPoint.toFixed()}`;for(const{leftPoint:a,rightPoint:c,radius:u,center:h}of s){if(h===null){i+=` L${c.toFixed()}`;continue}const f=P.Clockwise(a,c,h)?"0":"1";i+=` A${ee(u)},${ee(u)} 0 ${f},1 ${c.toFixed()}`}return i+=" Z",i}const pne={s:.5,m:.7,l:.9,xl:1.6};function fne(n,e,t,r,o){const s=rs(t),i=pne[r]*o,a=jm(n,e,t,r,o),h=a.reduce((v,S)=>v+P.Dist2(S.leftPoint,S.rightPoint),0)/a.length>(i*15)**2?v=>P.AddXY(v,s()*i*2,s()*i*2):v=>v;let f=`M${a[0].leftPoint.toFixed()}`,g=h(a[0].leftPoint),y=`M${g.toFixed()}`;for(const{leftPoint:v,center:S,rightPoint:w,radius:b,arcPoint:_}of a){if(S===null){f+=` L${w.toFixed()}`;const L=h(w);y+=` L${L.toFixed()}`,g=L;continue}const T=P.Clockwise(v,w,S)?"0":"1";f+=` A${ee(b)},${ee(b)} 0 ${T},1 ${w.toFixed()}`;const E=h(w),M=h(_),A=c1(g,E,M);if(!A){y+=` L${E.toFixed()}`,g=E;continue}const R=Math.abs(P.Dist(A,g));y+=` A${ee(R)},${ee(R)} 0 ${T},1 ${E.toFixed()}`,g=E}return f+y+" Z"}function tb(n,e){switch(n.geo){case"x-box":return gne(n.w,n.h,e,n.dash);case"check-box":return mne(n.w,n.h);default:return}}function gne(n,e,t,r){const o=r==="draw"?.62:0;if(r==="dashed")return[[new P(0,0),new P(n/2,e/2)],[new P(n,e),new P(n/2,e/2)],[new P(0,e),new P(n/2,e/2)],[new P(n,0),new P(n/2,e/2)]];const s=a=>Math.max(0,Math.min(n,a)),i=a=>Math.max(0,Math.min(e,a));return[[new P(s(t*o),i(t*o)),new P(s(n-t*o),i(e-t*o))],[new P(s(t*o),i(e-t*o)),new P(s(n-t*o),i(t*o))]]}function mne(n,e){const t=Math.min(n,e)*.82,r=(n-t)/2,o=(e-t)/2,s=a=>Math.max(0,Math.min(n,a)),i=a=>Math.max(0,Math.min(e,a));return[[new P(s(r+t*.25),i(o+t*.52)),new P(s(r+t*.45),i(o+t*.82))],[new P(s(r+t*.45),i(o+t*.82)),new P(s(r+t*.82),i(o+t*.22))]]}function eM({shape:n,shouldScale:e,forceSolid:t}){const r=e?n.props.scale:1,o=te(),s=jo(),{id:i,props:a}=n,{w:c,color:u,fill:h,dash:f,growY:g,size:y,scale:v}=a,S=Xn[y]*r,w=a.h+g;switch(a.geo){case"cloud":if(f==="solid"){const b=eb(c,w,i,y,v);return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{theme:s,d:b,color:u,fill:h,scale:r}),p.jsx("path",{d:b,stroke:s[u].solid,strokeWidth:S,fill:"none"})]})}else if(f==="draw"){const b=fne(c,w,i,y,v);return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{theme:s,d:b,color:u,fill:h,scale:r}),p.jsx("path",{d:b,stroke:s[u].solid,strokeWidth:S,fill:"none"})]})}else{const b=eb(c,w,i,y,v),_=jm(c,w,i,y,v);return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{theme:s,d:b,color:u,fill:h,scale:r}),p.jsx("g",{strokeWidth:S,stroke:s[u].solid,fill:"none",pointerEvents:"all",children:_.map(({leftPoint:T,rightPoint:E,center:M,radius:A},R)=>{const L=M?A*ll(ll(P.Angle(M,E))-ll(P.Angle(M,T))):P.Dist(T,E),{strokeDasharray:K,strokeDashoffset:D}=qo(L,S,{style:f,start:"outset",end:"outset",forceSolid:t});return p.jsx("path",{d:M?`M${T.x},${T.y}A${A},${A},0,0,1,${E.x},${E.y}`:`M${T.x},${T.y}L${E.x},${E.y}`,strokeDasharray:K,strokeDashoffset:D},R)})})]})}case"ellipse":{const b=e?o.getShapeGeometry(n):o.getShapeUtil(n).getGeometry(n),_=b.getSvgPathData(!0);if(f==="dashed"||f==="dotted"){const T=b.length,{strokeDasharray:E,strokeDashoffset:M}=qo(T<64?T*2:T,S,{style:f,snap:4,closed:!0,forceSolid:t});return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{theme:s,d:_,color:u,fill:h,scale:r}),p.jsx("path",{d:_,strokeWidth:S,fill:"none",stroke:s[u].solid,strokeDasharray:E,strokeDashoffset:M})]})}else{const E=(e?o.getShapeGeometry(n):o.getShapeUtil(n).getGeometry(n)).getSvgPathData(!0);return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{theme:s,d:E,color:u,fill:h,scale:r}),p.jsx("path",{d:E,stroke:s[u].solid,strokeWidth:S,fill:"none"})]})}}case"oval":{const b=e?o.getShapeGeometry(n):o.getShapeUtil(n).getGeometry(n),_=b.getSvgPathData(!0);if(f==="dashed"||f==="dotted"){const T=b.getLength(),{strokeDasharray:E,strokeDashoffset:M}=qo(T<64?T*2:T,S,{style:f,snap:4,start:"outset",end:"outset",closed:!0,forceSolid:t});return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{theme:s,d:_,color:u,fill:h,scale:r}),p.jsx("path",{d:_,strokeWidth:S,fill:"none",stroke:s[u].solid,strokeDasharray:E,strokeDashoffset:M})]})}else return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{theme:s,d:_,color:u,fill:h,scale:r}),p.jsx("path",{d:_,stroke:s[u].solid,strokeWidth:S,fill:"none"})]})}case"heart":if(f==="dashed"||f==="dotted"||f==="solid"){const b=YF(c,w),_=C_(c,w);return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{theme:s,d:b,color:u,fill:h,scale:r}),_.map((T,E)=>{const{strokeDasharray:M,strokeDashoffset:A}=qo(T.length,S,{style:f,snap:1,start:"outset",end:"outset",closed:!0,forceSolid:t});return p.jsx("path",{d:T.getSvgPathData(),strokeWidth:S,fill:"none",stroke:s[u].solid,strokeDasharray:M,strokeDashoffset:A,pointerEvents:"all"},`curve_${E}`)})]})}else{const b=sne(c,w,S,n.id);return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{theme:s,d:b,color:u,fill:h,scale:r}),p.jsx("path",{d:b,stroke:s[u].solid,strokeWidth:S,fill:"none"})]})}default:{const b=e?o.getShapeGeometry(n):o.getShapeUtil(n).getGeometry(n),_=b instanceof To?b.children[0].vertices:b.vertices,T=tb(n.props,S);if(f==="solid"){let E="M"+_[0]+"L"+_.slice(1)+"Z";if(T)for(const[M,A]of T)E+=`M${M.x},${M.y}L${A.x},${A.y}`;return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{theme:s,d:E,color:u,fill:h,scale:r}),p.jsx("path",{d:E,stroke:s[u].solid,strokeWidth:S,fill:"none"})]})}else if(f==="dashed"||f==="dotted"){const E="M"+_[0]+"L"+_.slice(1)+"Z";return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{theme:s,d:E,color:u,fill:h,scale:r}),p.jsxs("g",{strokeWidth:S,stroke:s[u].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(_.length)).map((M,A)=>{const R=P.ToFixed(_[A]),L=P.ToFixed(_[(A+1)%_.length]),K=P.Dist(R,L),{strokeDasharray:D,strokeDashoffset:U}=qo(K,S,{style:f,start:"outset",end:"outset",forceSolid:t});return p.jsx("line",{x1:R.x,y1:R.y,x2:L.x,y2:L.y,strokeDasharray:D,strokeDashoffset:U},A)}),T&&T.map(([M,A],R)=>{const L=P.Dist(M,A),{strokeDasharray:K,strokeDashoffset:D}=qo(L,S,{style:f,start:"skip",end:"skip",snap:f==="dotted"?4:void 0,forceSolid:t});return p.jsx("path",{d:`M${M.x},${M.y}L${A.x},${A.y}`,stroke:s[u].solid,strokeWidth:S,fill:"none",strokeDasharray:K,strokeDashoffset:D},`line_fg_${R}`)})]})]})}else if(f==="draw"){let E=Qw(Jw(i,_,S/3,S*2,2));if(T)for(const[A,R]of T)E+=`M${A.toFixed()}L${R.toFixed()}`;const M=Qw(Jw(i,_,0,S*2,1));return p.jsxs(p.Fragment,{children:[p.jsx(Kn,{theme:s,d:M,color:u,fill:h,scale:r}),p.jsx("path",{d:E,stroke:s[u].solid,strokeWidth:S,fill:"none"})]})}}}}const tM=17*3;class kf extends lu{canEdit(){return!0}getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:"",scale:1}}getGeometry(e){const t=Math.max(1,e.props.w),r=Math.max(1,e.props.h+e.props.growY),o=t/2,s=r/2,i=e.props.fill!=="none";let a;switch(e.props.geo){case"cloud":{a=new on({points:hne(t,r,e.id,e.props.size,e.props.scale),isFilled:i});break}case"triangle":{a=new on({points:[new P(o,0),new P(t,r),new P(0,r)],isFilled:i});break}case"diamond":{a=new on({points:[new P(o,0),new P(t,s),new P(o,r),new P(0,s)],isFilled:i});break}case"pentagon":{a=new on({points:D0(t,r,5),isFilled:i});break}case"hexagon":{a=new on({points:D0(t,r,6),isFilled:i});break}case"octagon":{a=new on({points:D0(t,r,8),isFilled:i});break}case"ellipse":{a=new mq({width:t,height:r,isFilled:i});break}case"oval":{a=new yq({width:t,height:r,isFilled:i});break}case"star":{const _=xt/5/2,T=Math.floor(5/4)*2,E=5*2-T,M=0,A=Math.floor(5/2)*2,R=Math.cos(-Dt+T*_)*t/2,L=Math.cos(-Dt+E*_)*t/2,K=Math.sin(-Dt+M*_)*r/2,D=Math.sin(-Dt+A*_)*r/2,U=t-Math.abs(R-L),V=r-Math.abs(D-K),F=t/2+L-(t/2-R),$=r/2+K-(r/2-D),H=1,Z=(t-F)/2,G=(r-$)/2,q=(t+U)/2,Q=(r+V)/2,ae=q*H/2,B=Q*H/2;a=new on({points:Array.from(Array(5*2)).map((oe,pe)=>{const _e=-Dt+pe*_;return new P(Z+(pe%2?ae:q)*Math.cos(_e),G+(pe%2?B:Q)*Math.sin(_e))}),isFilled:i});break}case"rhombus":{const b=Math.min(t*.38,r*.38);a=new on({points:[new P(b,0),new P(t,0),new P(t-b,r),new P(0,r)],isFilled:i});break}case"rhombus-2":{const b=Math.min(t*.38,r*.38);a=new on({points:[new P(0,0),new P(t-b,0),new P(t,r),new P(b,r)],isFilled:i});break}case"trapezoid":{const b=Math.min(t*.38,r*.38);a=new on({points:[new P(b,0),new P(t-b,0),new P(t,r),new P(0,r)],isFilled:i});break}case"arrow-right":{const b=Math.min(t,r)*.38,_=r*.16;a=new on({points:[new P(0,_),new P(t-b,_),new P(t-b,0),new P(t,r/2),new P(t-b,r),new P(t-b,r-_),new P(0,r-_)],isFilled:i});break}case"arrow-left":{const b=Math.min(t,r)*.38,_=r*.16;a=new on({points:[new P(b,0),new P(b,_),new P(t,_),new P(t,r-_),new P(b,r-_),new P(b,r),new P(0,r/2)],isFilled:i});break}case"arrow-up":{const b=t*.16,_=Math.min(t,r)*.38;a=new on({points:[new P(t/2,0),new P(t,_),new P(t-b,_),new P(t-b,r),new P(b,r),new P(b,_),new P(0,_)],isFilled:i});break}case"arrow-down":{const b=t*.16,_=Math.min(t,r)*.38;a=new on({points:[new P(b,0),new P(t-b,0),new P(t-b,r-_),new P(t,r-_),new P(t/2,r),new P(0,r-_),new P(b,r-_)],isFilled:i});break}case"check-box":case"x-box":case"rectangle":{a=new Ns({width:t,height:r,isFilled:i});break}case"heart":{const _=C_(t,r).reduce((T,E)=>(T.push(...E.vertices),T),[]);a=new on({points:_,isFilled:i});break}default:Sn(e.props.geo)}const c=Jp(this.editor,e),u=t/e.props.scale,h=r/e.props.scale,f=Math.min(100,u/2),g=Math.min(Si[e.props.size]*Zn.lineHeight+Po*2,h/2),y=Math.min(u,Math.max(c.w,Math.min(f,Math.max(1,u-8)))),v=Math.min(h,Math.max(c.h,Math.min(g,Math.max(1,h-8)))),S=tb(e.props,Xn[e.props.size]*e.props.scale),w=S?S.map(b=>new su({points:b})):[];return new To({children:[a,new Ns({x:e.props.align==="start"?0:e.props.align==="end"?(u-y)*e.props.scale:(u-y)/2*e.props.scale,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?(h-v)*e.props.scale:(h-v)/2*e.props.scale,width:y*e.props.scale,height:v*e.props.scale,isFilled:!0,isLabel:!0}),...w]})}getHandleSnapGeometry(e){const t=this.getGeometry(e),r=t.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:r,points:[...r.getVertices(),t.bounds.center]};case"cloud":case"ellipse":case"heart":case"oval":return{outline:r,points:[t.bounds.center]};default:Sn(e.props.geo)}}getText(e){return e.props.text}onEditEnd(e){const{id:t,type:r,props:{text:o}}=e;o.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:o.trimEnd()}}])}component(e){const{id:t,type:r,props:o}=e,{fill:s,font:i,align:a,verticalAlign:c,size:u,text:h}=o,f=jo(),{editor:g}=this,y=re("isGeoOnlySelected",()=>e.id===g.getOnlySelectedShapeId(),[]),S=g.getEditingShapeId()!==null||e.props.text,w=re("force solid",()=>g.getZoomLevel()<.2,[g]);return p.jsxs(p.Fragment,{children:[p.jsx(Sa,{children:p.jsx(eM,{shape:e,shouldScale:!0,forceSolid:w})}),S&&p.jsx(fa,{style:{overflow:"hidden",width:e.props.w,height:e.props.h+o.growY},children:p.jsx(Am,{shapeId:t,type:r,font:i,fontSize:Si[u]*e.props.scale,lineHeight:Zn.lineHeight,padding:Po*e.props.scale,fill:s,align:a,verticalAlign:c,text:h,isSelected:y,labelColor:f[o.labelColor].solid,wrap:!0})}),e.props.url&&p.jsx(Wc,{url:e.props.url})]})}indicator(e){const{id:t,props:r}=e,{w:o,size:s}=r,i=r.h+r.growY,a=Xn[s],c=this.editor.getShapeGeometry(e);switch(r.geo){case"ellipse":return r.dash==="draw"?p.jsx("path",{d:lne(t,o,i,a)}):p.jsx("path",{d:c.getSvgPathData(!0)});case"heart":return p.jsx("path",{d:YF(o,i)});case"oval":return p.jsx("path",{d:c.getSvgPathData(!0)});case"cloud":return p.jsx("path",{d:eb(o,i,t,s,e.props.scale)});default:{const u=this.editor.getShapeGeometry(e),h=u instanceof To?u.children[0].vertices:u.vertices;let f;if(r.dash==="draw"){const y=Jw(t,h,0,a*2*e.props.scale,1);f=Qw(y)}else f="M"+h[0]+"L"+h.slice(1)+"Z";const g=tb(e.props,a);if(g)for(const[y,v]of g)f+=`M${y.x},${y.y}L${v.x},${v.y}`;return p.jsx("path",{d:f})}}}toSvg(e,t){const r={...e,props:{...e.props,w:e.props.w/e.props.scale,h:e.props.h/e.props.scale}},o=r.props;t.addExportDef(x_(o.fill));let s;if(o.text){t.addExportDef(Tm(o.font));const i=Ii(t),a=new xe(0,0,o.w,o.h+o.growY);s=p.jsx(Mm,{fontSize:Si[o.size],font:o.font,align:o.align,verticalAlign:o.verticalAlign,text:o.text,labelColor:i[o.labelColor].solid,bounds:a,padding:16})}return p.jsxs(p.Fragment,{children:[p.jsx(eM,{shouldScale:!1,shape:r,forceSolid:!1}),s]})}getCanvasSvgDefs(){return[w_()]}onResize(e,{handle:t,newPoint:r,scaleX:o,scaleY:s,initialShape:i}){const a=i.props.w/i.props.scale,c=i.props.h/i.props.scale,u=i.props.growY/i.props.scale;let h=a*o,f=(c+u)*s,g=0,y=0;const v=tM;if(e.props.text.trim()){let E=Math.max(Math.abs(h),v),M=Math.max(Math.abs(f),v);E<v&&M===v&&(E=v),E===v&&M<v&&(M=v);const A=Jp(this.editor,{...e,props:{...e.props,w:E*e.props.scale,h:M*e.props.scale}}),R=Math.max(Math.abs(h),A.w)*Math.sign(h),L=Math.max(Math.abs(f),A.h)*Math.sign(f);g=Math.abs(R)-Math.abs(h),y=Math.abs(L)-Math.abs(f),h=R,f=L}const S=h*e.props.scale,w=f*e.props.scale,b=new P(0,0);o<0&&(b.x+=S),(t==="left"||t==="top_left"||t==="bottom_left")&&(b.x+=o<0?g:-g),s<0&&(b.y+=w),(t==="top"||t==="top_left"||t==="top_right")&&(b.y+=s<0?y:-y);const{x:_,y:T}=b.rot(e.rotation).add(r);return{x:_,y:T,props:{w:Math.max(Math.abs(S),1),h:Math.max(Math.abs(w),1),growY:0}}}onBeforeCreate(e){if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;const t=e.props.h/e.props.scale,r=Jp(this.editor,e).h;let o=null;if(r>t?o=r-t:e.props.growY&&(o=0),o!==null)return{...e,props:{...e.props,growY:o*e.props.scale}}}onBeforeUpdate(e,t){const r=e.props.text,o=t.props.text;if(r===o&&e.props.font===t.props.font&&e.props.size===t.props.size)return;if(r&&!o)return{...t,props:{...t.props,growY:0}};const s=e.props.w/e.props.scale,i=e.props.h/e.props.scale,a=e.props.growY/e.props.scale,c=Jp(this.editor,t);if(!r&&o&&o.length===1){let h=Math.max(s,c.w),f=Math.max(i,c.h);const g=tM;return s<g&&i<g&&(h=Math.max(h,g),f=Math.max(f,g),h=Math.max(h,f),f=Math.max(h,f)),{...t,props:{...t.props,w:h*t.props.scale,h:f*t.props.scale,growY:0}}}let u=null;if(c.h>i?u=c.h-i:a&&(u=0),u!==null){const h=t.props.w/t.props.scale;return{...t,props:{...t.props,growY:u*t.props.scale,w:Math.max(h,c.w)*t.props.scale}}}if(c.w>s)return{...t,props:{...t.props,w:c.w*t.props.scale}}}onDoubleClick(e){if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,w:it(e.props.w,t.props.w,r),h:it(e.props.h,t.props.h,r),scale:it(e.props.scale,t.props.scale,r)}}}j(kf,"type","geo"),j(kf,"props",Pj),j(kf,"migrations",Cj);function Jp(n,e){const{text:t,font:r,size:o,w:s}=e.props;if(!t)return{w:0,h:0};const i=n.textMeasure.measureText("w",{...Zn,fontFamily:bi[r],fontSize:Si[o],maxWidth:100}),a={s:2,m:3.5,l:5,xl:10},c=n.textMeasure.measureText(t,{...Zn,fontFamily:bi[r],fontSize:Si[o],minWidth:i.w,maxWidth:Math.max(0,Math.ceil(i.w+a[o]),Math.ceil(s/e.props.scale-Po*2))});return{w:c.w+Po*2,h:c.h+Po*2}}function yne(){const[n,e]=C.useState(!1);return C.useEffect(()=>{const r=CSS.supports("color","color(display-p3 1 1 1)"),o=matchMedia("(color-gamut: p3)");e(r&&o.matches);const s=()=>e(r&&o.matches);return o.addEventListener("change",s),()=>o.removeEventListener("change",s)},[]),re(sn.forceSrgb)||!n?"srgb":"p3"}const nM=.35,rM=.82;class Tf extends es{hideResizeHandles(e){return ef(e)}hideRotateHandle(e){return ef(e)}hideSelectionBoundsFg(e){return ef(e)}getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1,scale:1}}getGeometry(e){const t=rl(e);if(ef(e))return new R1({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});const{strokePoints:r,sw:o}=oM(e,t,!0),s=P_({strokeWidth:o,showAsComplete:!0});return Em(r,s),new on({points:y_(r,s),isFilled:!0})}component(e){const t=_x(this.editor,e),r=rl(e);return p.jsx(Sa,{children:p.jsx(tf,{shape:e,forceSolid:t,strokeWidth:r,opacity:nM})})}backgroundComponent(e){const t=_x(this.editor,e),r=rl(e);return p.jsx(Sa,{children:p.jsx(tf,{shape:e,forceSolid:t,strokeWidth:r,opacity:rM})})}indicator(e){const t=_x(this.editor,e),r=rl(e),{strokePoints:o,sw:s}=oM(e,r,t),i=Vc(e.props.segments);let a;return o.length<2?a=Sne(i[0],s):a=wl(o,!1),p.jsx("path",{d:a})}toSvg(e){const t=rl(e),r=t<1.5,o=1/e.props.scale;return p.jsx("g",{transform:`scale(${o})`,children:p.jsx(tf,{forceSolid:r,strokeWidth:t,shape:e,opacity:nM})})}toBackgroundSvg(e){const t=rl(e),r=t<1.5,o=1/e.props.scale;return p.jsx("g",{transform:`scale(${o})`,children:p.jsx(tf,{forceSolid:r,strokeWidth:t,shape:e,opacity:rM})})}onResize(e,t){const{scaleX:r,scaleY:o}=t,s=[];for(const i of e.props.segments)s.push({...i,points:i.points.map(({x:a,y:c,z:u})=>({x:r*a,y:o*c,z:u}))});return{props:{segments:s}}}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,...t.props,segments:KF(e.props.segments,t.props.segments,r),scale:it(e.props.scale,t.props.scale,r)}}}j(Tf,"type","highlight"),j(Tf,"props",kj),j(Tf,"migrations",Tj);function vne(n){return`M ${n.x} ${n.y} m -${.1}, 0 a ${.1},${.1} 0 1,0 ${.1*2},0 a ${.1},${.1} 0 1,0 -${.1*2},0`}function Sne(n,e){const t=e/2;return`M ${n.x} ${n.y} m -${t}, 0 a ${t},${t} 0 1,0 ${t*2},0 a ${t},${t} 0 1,0 -${t*2},0`}function oM(n,e,t){var c;const r=Vc(n.props.segments),o=n.props.isComplete||((c=En(n.props.segments))==null?void 0:c.type)==="straight";let s=e;!t&&!n.props.isPen&&r.length===1&&(s+=rs(n.id)()*(e/6));const i=P_({strokeWidth:s,showAsComplete:o});return{strokePoints:zs(r,i),sw:s}}function rl(n){return Hc[n.props.size]*1.12*n.props.scale}function ef(n){return n.props.segments.length===1&&n.props.segments[0].points.length<2}function tf({strokeWidth:n,forceSolid:e,shape:t,opacity:r}){var g;const o=jo(),s=Vc(t.props.segments);let i=n;!e&&!t.props.isPen&&s.length===1&&(i+=rs(t.id)()*(i/6));const a=P_({strokeWidth:i,showAsComplete:t.props.isComplete||((g=En(t.props.segments))==null?void 0:g.type)==="straight"}),c=zs(s,a),u=c.length>1?wl(c,!1):vne(t.props.segments[0].points[0]),h=yne(),f=o[t.props.color].highlight[h];return p.jsx("path",{d:u,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:f,strokeWidth:i,opacity:r})}function _x(n,e){return re("forceSolid",()=>{const t=rl(e),r=n.getZoomLevel();return t/r<1.5},[n])}function XF(){return p.jsxs("svg",{width:"15",height:"15",viewBox:"0 0 30 30",xmlns:"http://www.w3.org/2000/svg",fill:"none",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round",children:[p.jsx("path",{d:"M3,11 L3,3 11,3",strokeWidth:"2"}),p.jsx("path",{d:"M19,27 L27,27 L27,19",strokeWidth:"2"}),p.jsx("path",{d:"M27,3 L3,27",strokeWidth:"2"})]})}function ZF({shapeId:n,assetId:e}){const t=te(),r=!!rh(),o=mW(),s=C.useMemo(()=>Ag(sM,500),[]),[i,a]=C.useState(()=>({asset:e?t.getAsset(e)??null:null,url:null})),c=C.useRef(!1),u=C.useRef(null);return C.useEffect(()=>{if(!e)return;let h=!1,f;const g=Ms("update state",()=>{if(!r&&t.getCulledShapes().has(n))return;const y=t.getAsset(e);if(!y)return;const v=t.getShape(n);if(!v)return;if(!y.props.src){const b=t.getTemporaryAssetPreview(y.id);if(b){u.current!==b&&(u.current=b,a(_=>({..._,isPlaceholder:!0,url:b})),o());return}}const S=t.getZoomLevel()*(v.props.w/y.props.w);function w(b,_){h||u.current!==_&&(c.current=!0,u.current=_,a({asset:b,url:_}),o())}c.current?(s(t,e,S,r,b=>w(y,b)),f=s.cancel):sM(t,e,S,r,b=>w(y,b))});return()=>{g(),f==null||f(),h=!0}},[t,e,r,o,n,s]),i}function sM(n,e,t,r,o){n.resolveAssetUrl(e,{screenScale:t,shouldResolveToOriginal:r}).then(s=>{o(s)})}function QF(){const[n,e]=C.useState(!1);return C.useEffect(()=>{if(typeof window>"u"||!("matchMedia"in window))return;const t=window.matchMedia("(prefers-reduced-motion: reduce)"),r=()=>{e(t.matches)};return r(),t.addEventListener("change",r),()=>t.removeEventListener("change",r)},[]),n}async function xne(n){const t=await(await Ds(n)).blob();return Yo.blobToDataUrl(t)}class Mf extends lu{isAspectRatioLocked(){return!0}canCrop(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null,flipX:!1,flipY:!1}}onResize(e,t){let r=im(e,t);const{flipX:o,flipY:s}=t.initialShape.props,{scaleX:i,scaleY:a,mode:c}=t;if(r={...r,props:{...r.props,flipX:i<0!==o,flipY:a<0!==s}},!e.props.crop)return r;const u=c==="scale_shape"&&i===-1||c==="resize_bounds"&&o!==r.props.flipX,h=c==="scale_shape"&&a===-1||c==="resize_bounds"&&s!==r.props.flipY,{topLeft:f,bottomRight:g}=e.props.crop;return r.props.crop={topLeft:{x:u?1-g.x:f.x,y:h?1-g.y:f.y},bottomRight:{x:u?1-f.x:g.x,y:h?1-f.y:g.y}},r}component(e){return p.jsx(wne,{shape:e})}indicator(e){return this.editor.getCroppingShapeId()===e.id?null:p.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h)})}async toSvg(e){if(!e.props.assetId||!this.editor.getAsset(e.props.assetId))return null;let r=await this.editor.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});return r?((r.startsWith("blob:")||r.startsWith("http")||r.startsWith("/")||r.startsWith("./"))&&(r=await xne(r)||""),p.jsx(_ne,{shape:e,src:r})):null}onDoubleClickEdge(e){const t=e.props;if(!t||this.editor.getCroppingShapeId()!==e.id)return;const r=zt(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},o=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,s=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,i=new P(r.topLeft.x*o,r.topLeft.y*s).rot(e.rotation),a={id:e.id,type:e.type,x:e.x-i.x,y:e.y-i.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:o,h:s}};this.editor.updateShapes([a])}getInterpolatedProps(e,t,r){function o(s,i){var f,g,y,v;if(s.props.crop===null&&i.props.crop===null)return null;const a=((f=s.props.crop)==null?void 0:f.topLeft)||{x:0,y:0},c=((g=s.props.crop)==null?void 0:g.bottomRight)||{x:1,y:1},u=((y=i.props.crop)==null?void 0:y.topLeft)||{x:0,y:0},h=((v=i.props.crop)==null?void 0:v.bottomRight)||{x:1,y:1};return{topLeft:{x:it(a.x,u.x,r),y:it(a.y,u.y,r)},bottomRight:{x:it(c.x,h.x,r),y:it(c.y,h.y,r)}}}return{...r>.5?t.props:e.props,w:it(e.props.w,t.props.w,r),h:it(e.props.h,t.props.h,r),crop:o(e,t)}}}j(Mf,"type","image"),j(Mf,"props",Mj),j(Mf,"migrations",Aj);const wne=C.memo(function({shape:e}){var b;const t=te(),{asset:r,url:o}=ZF({shapeId:e.id,assetId:e.props.assetId}),s=QF(),[i,a]=C.useState(""),[c,u]=C.useState(null),h=bne(t,e);C.useEffect(()=>{if(o&&h){let _=!1;const T=Ad();return T.onload=()=>{if(_)return;const E=document.createElement("canvas");E.width=T.width,E.height=T.height;const M=E.getContext("2d");M&&(M.drawImage(T,0,0),a(E.toDataURL()),u(o))},T.crossOrigin="anonymous",T.src=o,()=>{_=!0}}},[t,h,s,o]);const f=re("show crop preview",()=>e.id===t.getOnlySelectedShapeId()&&t.getCroppingShapeId()===e.id&&t.isIn("select.crop"),[t,e.id]),g=s&&(((b=r==null?void 0:r.props.mimeType)==null?void 0:b.includes("video"))||h),y=JF(e),v=o===c?null:o,S=g?i:c;if(!o&&!(r!=null&&r.props.src))return p.jsxs(fa,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h,color:"var(--color-text-3)",backgroundColor:"var(--color-low)",border:"1px solid var(--color-low-border)"},children:[p.jsx("div",{className:Fe("tl-image-container",r&&"tl-image-container-loading"),style:y,children:r?null:p.jsx(XF,{})}),"url"in e.props&&e.props.url&&p.jsx(Wc,{url:e.props.url})]});const w=h?"anonymous":void 0;return p.jsxs(p.Fragment,{children:[f&&S&&p.jsx("div",{style:y,children:p.jsx("img",{className:"tl-image",style:{...Cd(e),opacity:.1},crossOrigin:w,src:S,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1})}),p.jsxs(fa,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[p.jsxs("div",{className:Fe("tl-image-container"),style:y,children:[S&&p.jsx("img",{className:"tl-image",style:Cd(e),crossOrigin:w,src:S,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1},S),v&&p.jsx("img",{className:"tl-image",style:Cd(e),crossOrigin:w,src:v,referrerPolicy:"strict-origin-when-cross-origin",draggable:!1,onLoad:()=>u(v)},v)]}),e.props.url&&p.jsx(Wc,{url:e.props.url})]})]})});function bne(n,e){const t=e.props.assetId?n.getAsset(e.props.assetId):void 0;return t?"mimeType"in t.props&&Zr.isAnimatedImageType(t==null?void 0:t.props.mimeType)||"isAnimated"in t.props&&t.props.isAnimated:!1}function JF(n){const e=n.props.crop,t=e==null?void 0:e.topLeft;if(!t)return{width:n.props.w,height:n.props.h};const r=1/(e.bottomRight.x-e.topLeft.x)*n.props.w,o=1/(e.bottomRight.y-e.topLeft.y)*n.props.h,s=-t.x*r,i=-t.y*o;return{transform:`translate(${s}px, ${i}px)`,width:r,height:o}}function Cd(n,e){const{flipX:t,flipY:r}=n.props;if(!t&&!r)return;const o=`scale(${t?-1:1}, ${r?-1:1})`;return{transform:`${e?`translate(${t?e.width:0}px, ${r?e.height:0}px)`:""} ${o}`,transformOrigin:e?"0 0":"center center"}}function _ne({shape:n,src:e}){const t=nu(),r=JF(n),o=n.props.crop;if(r.transform&&o){const{transform:s,width:i,height:a}=r,c=(o.bottomRight.x-o.topLeft.x)*i,u=(o.bottomRight.y-o.topLeft.y)*a,h=[new P(0,0),new P(c,0),new P(c,u),new P(0,u)],f=Cd(n,{width:i,height:a});return p.jsxs(p.Fragment,{children:[p.jsx("defs",{children:p.jsx("clipPath",{id:t,children:p.jsx("polygon",{points:h.map(g=>`${g.x},${g.y}`).join(" ")})})}),p.jsx("g",{clipPath:`url(#${t})`,children:p.jsx("image",{href:e,width:i,height:a,style:f?{...f,transform:`${s} ${f.transform}`}:{transform:s}})})]})}else return p.jsx("image",{href:e,width:n.props.w,height:n.props.h,style:Cd(n,{width:n.props.w,height:n.props.h})})}function eN(n){return{size:n,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function tN(n,e,t){const r=e.vertices,o=eN(t);return zs(r,o)}function Pne(n,e,t){const r=eN(t);return y_(Em(tN(n,e,t),r),r)}function Cne(n,e,t){const r=Pne(n,e,t);return p1(r)}function Ine(n,e,t){if(n.props.dash==="draw"){const r=tN(n,e,t);return wl(r)}return e.getSvgPathData()}function nN(n,e,t){let r=`M ${pt(e[0])}L`,o=`M ${pt(e[0])}L`;const s=t/3,i=t*2,a=rs(n);let c=e[0],u,h=e[0],f;const g=e.length;for(let y=0,v=g-1;y<v;y++){u=e[y+1],f=P.AddXY(e[y+1],a()*s,a()*s);const S=P.Sub(u,c),w=P.Len(S),b=P.Div(S,w).mul(Math.min(w/4,i)),_=P.Add(c,b),T=P.Add(u,b.neg()),E=P.Sub(f,h),M=P.Len(E),A=P.Div(E,M).mul(Math.min(M/4,i)),R=P.Add(h,A),L=P.Add(f,A.neg());y===v-1?(r+=`${pt(_)}L ${pt(u)}`,o+=`${pt(R)}L ${pt(f)}`):(r+=`${pt(_)}L ${pt(T)}Q ${pt(u)}`,o+=`${pt(R)}L ${pt(L)}Q ${pt(f)}`,c=u,h=f)}return[r,r+o]}const Ene=new Os;class Af extends es{hideResizeHandles(){return!0}hideRotateHandle(){return!0}hideSelectionBoundsFg(){return!0}hideSelectionBoundsBg(){return!0}getDefaultProps(){const[e,t]=Rd(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[t]:{id:t,index:t,x:.1,y:.1}},scale:1}}getGeometry(e){return yd(e)}getHandles(e){return Ene.get(e.props,()=>{const t=yd(e),r=md(e),o=r.map(s=>({...s,id:s.index,type:"vertex",canSnap:!0}));for(let s=0;s<r.length-1;s++){const i=jd(r[s].index,r[s+1].index),c=t.segments[s].midPoint();o.push({id:i,type:"create",index:i,x:c.x,y:c.y,canSnap:!0})}return o.sort(Gn)})}onResize(e,t){const{scaleX:r,scaleY:o}=t;return{props:{points:Wd(e.props.points,(s,{id:i,index:a,x:c,y:u})=>({id:i,index:a,x:c*r,y:u*o}))}}}onBeforeCreate(e){const{props:{points:t}}=e,r=Object.keys(t);if(r.length<2)return;const o=t[r[0]];if(r.every(i=>{const a=t[i];return a.x===o.x&&a.y===o.y})){const i=r[r.length-1];return t[i]={...t[i],x:t[i].x+.1,y:t[i].y+.1},e}}onHandleDrag(e,{handle:t}){if(t.type!=="vertex")return;const r=ns(new P(t.x,t.y),this.editor);return{...e,props:{...e.props,points:{...e.props.points,[t.id]:{id:t.id,index:t.index,x:r.x,y:r.y}}}}}component(e){return p.jsx(Sa,{children:p.jsx(iM,{shape:e})})}indicator(e){const t=Ts[e.props.size]*e.props.scale,r=yd(e),{dash:o}=e.props;let s;if(e.props.spline==="line"){const i=r.points;if(o==="solid"||o==="dotted"||o==="dashed")s="M"+i[0]+"L"+i.slice(1);else{const[a]=nN(e.id,i,t);s=a}}else s=Ine(e,r,t);return p.jsx("path",{d:s})}toSvg(e){return p.jsx(iM,{shouldScale:!0,shape:e})}getHandleSnapGeometry(e){const t=md(e);return{points:t,getSelfSnapPoints:r=>{const o=this.getHandles(e).filter(s=>s.type==="vertex").findIndex(s=>s.id===r.id);return t.filter((s,i)=>Math.abs(i-o)>1).map(P.From)},getSelfSnapOutline:r=>{const o=this.getHandles(e).filter(i=>i.type==="vertex").findIndex(i=>i.id===r.id),s=yd(e).segments.filter((i,a)=>a!==o-1&&a!==o);return s.length?new To({children:s}):null}}}getInterpolatedProps(e,t,r){const o=md(e),s=md(t),i=[],a=[];let c=cA;if(o.length>s.length)for(let u=0;u<o.length;u++)i[u]={...o[u]},s[u]===void 0?a[u]={...s[s.length-1],id:c}:a[u]={...s[u],id:c},c=Is(c);else if(s.length>o.length)for(let u=0;u<s.length;u++)a[u]={...s[u]},o[u]===void 0?i[u]={...o[o.length-1],id:c}:i[u]={...o[u],id:c},c=Is(c);else for(let u=0;u<s.length;u++)i[u]=o[u],a[u]=s[u];return{...r>.5?t.props:e.props,points:Object.fromEntries(i.map((u,h)=>{const f=a[h];return[u.id,{...u,x:it(u.x,f.x,r),y:it(u.y,f.y,r)}]})),scale:it(e.props.scale,t.props.scale,r)}}}j(Af,"type","line"),j(Af,"props",jj),j(Af,"migrations",Rj);function md(n){return Object.values(n.props.points).sort(Gn)}function yd(n){const e=md(n).map(P.From);switch(n.props.spline){case"cubic":return new gq({points:e});case"line":return new su({points:e})}}function iM({shape:n,shouldScale:e=!1,forceSolid:t=!1}){const r=jo(),o=yd(n),{dash:s,color:i,size:a}=n.props,c=1/n.props.scale,u=e?c:1,h=Ts[a]*n.props.scale;if(n.props.spline==="line"){if(s==="solid"){const f=o.points,g="M"+f[0]+"L"+f.slice(1);return p.jsx("path",{d:g,stroke:r[i].solid,strokeWidth:h,fill:"none",transform:`scale(${u})`})}if(s==="dashed"||s==="dotted")return p.jsx("g",{stroke:r[i].solid,strokeWidth:h,transform:`scale(${u})`,children:o.segments.map((f,g)=>{const{strokeDasharray:y,strokeDashoffset:v}=t?{strokeDasharray:"none",strokeDashoffset:"none"}:qo(f.length,h,{style:s,start:g>0?"outset":"none",end:g<o.segments.length-1?"outset":"none"});return p.jsx("path",{strokeDasharray:y,strokeDashoffset:v,d:f.getSvgPathData(!0),fill:"none"},g)})});if(s==="draw"){const f=o.points,[g,y]=nN(n.id,f,h);return p.jsx("path",{d:y,stroke:r[i].solid,strokeWidth:h,fill:"none",transform:`scale(${u})`})}}if(n.props.spline==="cubic"){const f=o.getSvgPathData();if(s==="solid")return p.jsx("path",{strokeWidth:h,stroke:r[i].solid,fill:"none",d:f,transform:`scale(${u})`});if(s==="dashed"||s==="dotted")return p.jsx("g",{stroke:r[i].solid,strokeWidth:h,transform:`scale(${u})`,children:o.segments.map((g,y)=>{const{strokeDasharray:v,strokeDashoffset:S}=qo(g.length,h,{style:s,start:y>0?"outset":"none",end:y<o.segments.length-1?"outset":"none",forceSolid:t});return p.jsx("path",{strokeDasharray:v,strokeDashoffset:S,d:g.getSvgPathData(),fill:"none"},y)})});if(s==="draw")return p.jsx("path",{d:Cne(n,o,h),strokeWidth:1,stroke:r[i].solid,fill:r[i].solid,transform:`scale(${u})`})}}class jf extends es{canEdit(){return!0}hideResizeHandles(){return!0}hideSelectionBoundsFg(){return!1}getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",labelColor:"black",growY:0,fontSizeAdjustment:0,url:"",scale:1}}getGeometry(e){const{labelHeight:t,labelWidth:r}=rN(this.editor,e),{scale:o}=e.props,s=t*o,i=r*o,a=Pt*o,c=nf(e);return new To({children:[new Ns({width:a,height:c,isFilled:!0}),new Ns({x:e.props.align==="start"?0:e.props.align==="end"?a-i:(a-i)/2,y:e.props.verticalAlign==="start"?0:e.props.verticalAlign==="end"?c-s:(c-s)/2,width:i,height:s,isFilled:!0,isLabel:!0})]})}getHandles(e){const{scale:t}=e.props;if(this.editor.getInstanceState().isCoarsePointer)return[];const o=this.editor.getZoomLevel();if(o*t<.25)return[];const s=nf(e),i=Pt*t,a=Vee/o*t;return o*t<.5?[{id:"bottom",index:"a3",type:"clone",x:i/2,y:s+a}]:[{id:"top",index:"a1",type:"clone",x:i/2,y:-a},{id:"right",index:"a2",type:"clone",x:i+a,y:s/2},{id:"bottom",index:"a3",type:"clone",x:i/2,y:s+a},{id:"left",index:"a4",type:"clone",x:-a,y:s/2}]}getText(e){return e.props.text}component(e){const{id:t,type:r,props:{labelColor:o,scale:s,color:i,font:a,size:c,align:u,text:h,verticalAlign:f,fontSizeAdjustment:g}}=e,y=Mne(t),v=jo(),S=Pt*s,w=nf(e),b=re("shape rotation",()=>{var M;return((M=this.editor.getShapePageTransform(t))==null?void 0:M.rotation())??0},[this.editor]),_=re("zoom",()=>this.editor.getZoomLevel()<.35/s,[s,this.editor]),T=re("dark mode",()=>this.editor.user.getIsDarkMode(),[this.editor]),E=e.id===this.editor.getOnlySelectedShapeId();return p.jsxs(p.Fragment,{children:[p.jsx("div",{id:t,className:"tl-note__container",style:{width:S,height:w,backgroundColor:v[i].note.fill,borderBottom:_?T?`${2*s}px solid rgb(20, 20, 20)`:`${2*s}px solid rgb(144, 144, 144)`:"none",boxShadow:_?"none":Ane(e.id,b,s)},children:p.jsx(Am,{shapeId:t,type:r,font:a,fontSize:(g||Si[c])*s,lineHeight:Zn.lineHeight,align:u,verticalAlign:f,text:h,isNote:!0,isSelected:E,labelColor:o==="black"?v[i].note.text:v[o].fill,wrap:!0,padding:16*s,onKeyDown:y})}),"url"in e.props&&e.props.url&&p.jsx(Wc,{url:e.props.url})]})}indicator(e){const{scale:t}=e.props;return p.jsx("rect",{rx:t,width:ee(Pt*t),height:ee(nf(e))})}toSvg(e,t){e.props.text&&t.addExportDef(Tm(e.props.font));const r=Ii({isDarkMode:t.isDarkMode}),o=jne(e);return p.jsxs(p.Fragment,{children:[p.jsx("rect",{x:5,y:5,rx:1,width:Pt-10,height:o.h,fill:"rgba(0,0,0,.1)"}),p.jsx("rect",{rx:1,width:Pt,height:o.h,fill:r[e.props.color].note.fill}),p.jsx(Mm,{fontSize:e.props.fontSizeAdjustment||Si[e.props.size],font:e.props.font,align:e.props.align,verticalAlign:e.props.verticalAlign,text:e.props.text,labelColor:r[e.props.color].note.text,bounds:o,stroke:!1})]})}onBeforeCreate(e){return aM(this.editor,e)}onBeforeUpdate(e,t){if(!(e.props.text===t.props.text&&e.props.font===t.props.font&&e.props.size===t.props.size))return aM(this.editor,t)}onEditEnd(e){const{id:t,type:r,props:{text:o}}=e;o.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:o.trimEnd()}}])}getInterpolatedProps(e,t,r){return{...r>.5?t.props:e.props,scale:it(e.props.scale,t.props.scale,r)}}}j(jf,"type","note"),j(jf,"props",Oj),j(jf,"migrations",Dj);function aM(n,e){const{labelHeight:t,fontSizeAdjustment:r}=rN(n,e),o=Math.max(0,t-Pt);if(o!==e.props.growY||r!==e.props.fontSizeAdjustment)return{...e,props:{...e.props,growY:o,fontSizeAdjustment:r}}}function kne(n,e){const{text:t}=e.props;if(!t)return{labelHeight:Si[e.props.size]*Zn.lineHeight+Po*2,labelWidth:100,fontSizeAdjustment:0};const r=Si[e.props.size];let o=0,s=0,i=Pt,a=Pt;const c=1;do{o=Math.min(r,r-s);const u=n.textMeasure.measureText(t,{...Zn,fontFamily:bi[e.props.font],fontSize:o,maxWidth:Pt-Po*2-c,disableOverflowWrapBreaking:!0});if(i=u.h+Po*2,a=u.w+Po*2,o<=14){const h=n.textMeasure.measureText(t,{...Zn,fontFamily:bi[e.props.font],fontSize:o,maxWidth:Pt-Po*2-c});i=h.h+Po*2,a=h.w+Po*2;break}if(u.scrollWidth.toFixed(0)===u.w.toFixed(0))break}while(s++<50);return{labelHeight:i,labelWidth:a,fontSizeAdjustment:o}}const Tne=new Os;function rN(n,e){return Tne.get(e,()=>kne(n,e))}function Mne(n){const e=te(),t=A5();return C.useCallback(r=>{const o=e.getShape(n);if(!o)return;const s=r.key==="Tab",i=(r.metaKey||r.ctrlKey)&&r.key==="Enter";if(s||i){r.preventDefault();const a=e.getShapePageTransform(n),c=a.rotation(),u=!!(t.dir==="rtl"||IF(o.props.text)),h=(Pt+e.options.adjacentShapeMargin+(i&&!r.shiftKey?o.props.growY:0))*o.props.scale,f=new P(s?r.shiftKey!=u?-1:1:0,i?r.shiftKey?-1:1:0).mul(h).add(km.clone().mul(o.props.scale)).rot(c).add(a.point()),g=RF(e,o,f,c);g&&(e.markHistoryStoppingPoint("editing adjacent shape"),yg(e,g,!0))}},[n,e,t.dir])}function nf(n){return(Pt+n.props.growY)*n.props.scale}function Ane(n,e,t){const r=rs(n),o=Math.abs(r())+.5,s=Math.cos(e),i=5*t,a=4*t,c=6*t,u=7*t;return`0px ${i-o}px ${i}px -${i}px rgba(15, 23, 31, .6),
	0px ${(a+o*u)*Math.max(0,s)}px ${c+o*u}px -${a+o*c}px rgba(15, 23, 31, ${(.3+o*.1).toFixed(2)}), 
	0px ${48*t}px ${10*t}px -${10*t}px inset rgba(15, 23, 44, ${((.022+r()*.005)*((1+s)/2)).toFixed(2)})`}function jne(n){return new xe(0,0,Pt,Pt+n.props.growY)}function Rne(n,{initialBounds:e,scaleX:t,scaleY:r,newPoint:o}){const s=Math.max(.01,Math.min(Math.abs(t),Math.abs(r))),i=new P(0,0);t<0&&(i.x=-(e.width*s)),r<0&&(i.y=-(e.height*s));const{x:a,y:c}=P.Add(o,i.rot(n.rotation));return{x:a,y:c,props:{scale:s*n.props.scale}}}const One=new Os;class Rf extends es{getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",textAlign:"start",autoSize:!0,scale:1}}getMinDimensions(e){return One.get(e.props,t=>lM(this.editor,t))}getGeometry(e){const{scale:t}=e.props,{width:r,height:o}=this.getMinDimensions(e);return new Ns({width:r*t,height:o*t,isFilled:!0,isLabel:!0})}getText(e){return e.props.text}canEdit(){return!0}isAspectRatioLocked(){return!0}component(e){const{id:t,props:{font:r,size:o,text:s,color:i,scale:a,textAlign:c}}=e,{width:u,height:h}=this.getMinDimensions(e),f=e.id===this.editor.getOnlySelectedShapeId(),g=jo(),y=Dne(t);return p.jsx(Am,{shapeId:t,classNamePrefix:"tl-text-shape",type:"text",font:r,fontSize:Hc[o],lineHeight:Zn.lineHeight,align:c,verticalAlign:"middle",text:s,labelColor:g[i].solid,isSelected:f,textWidth:u,textHeight:h,style:{transform:`scale(${a})`,transformOrigin:"top left"},wrap:!0,onKeyDown:y})}indicator(e){const t=this.editor.getShapeGeometry(e).bounds,r=te();return e.props.autoSize&&r.getEditingShapeId()===e.id?null:p.jsx("rect",{width:ee(t.width),height:ee(t.height)})}toSvg(e,t){e.props.text&&t.addExportDef(Tm(e.props.font));const r=this.editor.getShapeGeometry(e).bounds,o=r.width/(e.props.scale??1),s=r.height/(e.props.scale??1),i=Ii(t);return p.jsx(Mm,{fontSize:Hc[e.props.size],font:e.props.font,align:e.props.textAlign,verticalAlign:"middle",text:e.props.text,labelColor:i[e.props.color].solid,bounds:new xe(0,0,o,s),padding:0})}onResize(e,t){const{newPoint:r,initialBounds:o,initialShape:s,scaleX:i,handle:a}=t;if(t.mode==="scale_shape"||a!=="right"&&a!=="left")return{id:e.id,type:e.type,...Rne(e,t)};{const c=Math.max(1,Math.abs(o.width*i)),{x:u,y:h}=i<0?P.Sub(r,P.FromAngle(e.rotation).mul(c)):r;return{id:e.id,type:e.type,x:u,y:h,props:{w:c/s.props.scale,autoSize:!1}}}}onEditEnd(e){const{id:t,type:r,props:{text:o}}=e,s=e.props.text.trimEnd();s.length===0?this.editor.deleteShapes([e.id]):s!==e.props.text&&this.editor.updateShapes([{id:t,type:r,props:{text:o.trimEnd()}}])}onBeforeUpdate(e,t){if(!t.props.autoSize)return;const r=e.props.size!==t.props.size||e.props.textAlign!==t.props.textAlign||e.props.font!==t.props.font||e.props.scale!==1&&t.props.scale===1,o=e.props.text!==t.props.text;if(!r&&!o)return;const s=this.getMinDimensions(e),i=lM(this.editor,t.props),a=s.width*e.props.scale,c=s.height*e.props.scale,u=i.width*t.props.scale,h=i.height*t.props.scale;let f;switch(t.props.textAlign){case"middle":{f=new P((u-a)/2,o?0:(h-c)/2);break}case"end":{f=new P(u-a,o?0:(h-c)/2);break}default:{if(o)break;f=new P(0,(h-c)/2);break}}if(f){f.rot(t.rotation);const{x:g,y}=t;return{...t,x:g-f.x,y:y-f.y,props:{...t.props,w:u}}}else return{...t,props:{...t.props,w:u}}}}j(Rf,"type","text"),j(Rf,"props",Lj),j(Rf,"migrations",Fj);function lM(n,e){const{font:t,text:r,autoSize:o,size:s,w:i}=e,a=o?16:Math.max(16,i),c=Hc[s],u=o?null:Math.floor(Math.max(a,i)),h=n.textMeasure.measureText(r,{...Zn,fontFamily:bi[t],fontSize:c,maxWidth:u});return o&&(h.w+=1),{width:Math.max(a,h.w),height:Math.max(c,h.h)}}function Dne(n){const e=te();return C.useCallback(t=>{if(e.getEditingShapeId()===n)switch(t.key){case"Enter":{(t.ctrlKey||t.metaKey)&&e.complete();break}case"Tab":{et(t),t.shiftKey?Kc.unindent(t.currentTarget):Kc.indent(t.currentTarget);break}}},[e,n])}class Of extends lu{canEdit(){return!0}isAspectRatioLocked(){return!0}getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){return p.jsx(Lne,{shape:e})}indicator(e){return p.jsx("rect",{width:ee(e.props.w),height:ee(e.props.h)})}async toSvg(e){const t=await Fne(this.editor,e);return t?p.jsx("image",{href:t,width:e.props.w,height:e.props.h}):null}}j(Of,"type","video"),j(Of,"props",Nj),j(Of,"migrations",$j);const Lne=C.memo(function({shape:e}){const t=te(),r=t.getShapeGeometry(e).bounds.w*t.getZoomLevel()>=110,o=am(e.id),s=QF(),{Spinner:i}=Bt(),{asset:a,url:c}=ZF({shapeId:e.id,assetId:e.props.assetId}),u=C.useRef(null),[h,f]=C.useState(!1),[g,y]=C.useState(!1);C.useEffect(()=>{const S=()=>y(document.fullscreenElement===u.current);return document.addEventListener("fullscreenchange",S),()=>document.removeEventListener("fullscreenchange",S)});const v=C.useCallback(S=>{S.currentTarget&&f(!0)},[]);return C.useEffect(()=>{const S=u.current;S&&o&&document.activeElement!==S&&S.focus()},[o,h]),C.useEffect(()=>{if(s){const S=u.current;if(!S)return;S.pause(),S.currentTime=0}},[u,s]),p.jsxs(p.Fragment,{children:[p.jsx(fa,{id:e.id,style:{color:"var(--color-text-3)",backgroundColor:a?"transparent":"var(--color-low)",border:a?"none":"1px solid var(--color-low-border)"},children:p.jsx("div",{className:"tl-counter-scaled",children:p.jsx("div",{className:"tl-video-container",children:a?i&&!a.props.src?p.jsx(i,{}):c?p.jsxs(p.Fragment,{children:[p.jsx("video",{ref:u,style:o?{pointerEvents:"all"}:h?void 0:{display:"none"},className:Fe("tl-video",`tl-video-shape-${e.id.split(":")[1]}`,{"tl-video-is-fullscreen":g}),width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:o&&r,onLoadedData:v,hidden:!h,children:p.jsx("source",{src:c})}),!h&&i&&p.jsx(i,{})]}):null:p.jsx(XF,{})})})}),"url"in e.props&&e.props.url&&p.jsx(Wc,{url:e.props.url})]})});async function Fne(n,e){const t=await n.resolveAssetUrl(e.props.assetId,{shouldResolveToOriginal:!0});if(!t)return null;const r=await Zr.loadVideo(t);return Zr.getVideoFrameAsDataUrl(r,0)}const oN=[Rf,Cf,If,kf,jf,Af,Ef,Pf,Tf,Ig,Mf,Of];function Nne(n){return n.sideEffects.register({instance_page_state:{afterChange:(e,t)=>{if(e.croppingShapeId!==t.croppingShapeId){const r=n.isIn("select.crop");!e.croppingShapeId&&t.croppingShapeId?r||n.setCurrentTool("select.crop.idle"):e.croppingShapeId&&!t.croppingShapeId&&r&&n.setCurrentTool("select.idle")}if(e.editingShapeId!==t.editingShapeId)if(!e.editingShapeId&&t.editingShapeId){if(!n.isIn("select.editing_shape")){const r=n.getEditingShape();r&&r.type==="text"&&n.isInAny("text.pointing","select.resizing")&&n.getInstanceState().isToolLocked?n.setCurrentTool("select.editing_shape",{isCreatingTextWhileToolLocked:!0}):n.setCurrentTool("select.editing_shape")}}else e.editingShapeId&&!t.editingShapeId&&n.isIn("select.editing_shape")&&n.setCurrentTool("select.idle")}}})}class sN extends Re{constructor(){super(...arguments);j(this,"info",{});j(this,"scribbleId","id");j(this,"markId","");j(this,"excludedShapeIds",new Set)}onEnter(t){this.markId=this.editor.markHistoryStoppingPoint("erase scribble begin"),this.info=t;const{originPagePoint:r}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>{if(this.editor.isShapeOrAncestorLocked(s))return!0;if(this.editor.isShapeOfType(s,"group")||this.editor.isShapeOfType(s,"frame")){const i=this.editor.getPointInShapeSpace(s,r);return this.editor.getShapeGeometry(s).bounds.containsPoint(i)}return!1}).map(s=>s.id));const o=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=o.id,this.update()}pushPointToScribble(){const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)}onExit(){this.editor.setErasingShapes([]),this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}update(){const{editor:t,excludedShapeIds:r}=this,o=t.getErasingShapeIds(),s=t.getZoomLevel(),i=t.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:a,previousPagePoint:c}}=t;this.pushPointToScribble();const u=new Set(o),h=this.editor.options.hitTestMargin/s;for(const f of i){if(t.isShapeOfType(f,"group"))continue;const g=t.getShapeMask(f.id);if(g&&!no(a,g))continue;const y=t.getShapeGeometry(f),v=t.getShapePageTransform(f);if(!y||!v)continue;const S=v.clone().invert(),w=S.applyToPoint(c),b=S.applyToPoint(a),{bounds:_}=y;_.minX-h>Math.max(w.x,b.x)||_.minY-h>Math.max(w.y,b.y)||_.maxX+h<Math.min(w.x,b.x)||_.maxY+h<Math.min(w.y,b.y)||y.hitTestLineSegment(w,b,h)&&u.add(t.getOutermostSelectableShape(f).id)}this.editor.setErasingShapes([...u].filter(f=>!r.has(f)))}complete(){const{editor:t}=this;t.deleteShapes(t.getCurrentPageState().erasingShapeIds),this.parent.transition("idle")}cancel(){const{editor:t}=this;t.bailToMark(this.markId),this.parent.transition("idle",this.info)}}j(sN,"id","erasing");var Kx;let $ne=(Kx=class extends Re{onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},j(Kx,"id","idle"),Kx);var Wx;let zne=(Wx=class extends Re{onEnter(){const e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{currentPagePoint:r}}=this.editor,o=new Set,s=o.size;for(let i=t.length,a=i-1;a>=0;a--){const c=t[a];if(!(this.editor.isShapeOrAncestorLocked(c)||this.editor.isShapeOfType(c,"group"))&&this.editor.isPointInShape(c,r,{hitInside:!1,margin:this.editor.options.hitTestMargin/e})){const u=this.editor.getOutermostSelectableShape(c);if(this.editor.isShapeOfType(u,"frame")&&o.size>s)break;o.add(u.id)}}this.editor.setErasingShapes([...o])}onLongPress(e){this.startErasing(e)}onExit(e,t){t!=="erasing"&&this.editor.setErasingShapes([])}onPointerMove(e){this.editor.inputs.isDragging&&this.startErasing(e)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.complete()}onInterrupt(){this.cancel()}startErasing(e){this.parent.transition("erasing",e)}complete(){const e=this.editor.getErasingShapeIds();e.length&&(this.editor.markHistoryStoppingPoint("erase end"),this.editor.deleteShapes(e)),this.parent.transition("idle")}cancel(){this.parent.transition("idle")}},j(Wx,"id","pointing"),Wx);class Df extends Re{static children(){return[$ne,zne,sN]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}j(Df,"id","eraser"),j(Df,"initial","idle"),j(Df,"isLockable",!1);class iN extends Re{constructor(){super(...arguments);j(this,"initialCamera",new P)}onEnter(){this.initialCamera=P.From(this.editor.getCamera()),this.update()}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.parent.transition("idle")}onComplete(){this.complete()}update(){const{initialCamera:t,editor:r}=this,{currentScreenPoint:o,originScreenPoint:s}=r.inputs,i=P.Sub(o,s).div(r.getZoomLevel());i.len2()!==0&&r.setCamera(t.clone().add(i))}complete(){const{editor:t}=this,{pointerVelocity:r}=t.inputs,o=Math.min(r.len(),2);o>.1&&this.editor.slideCamera({speed:o,direction:r}),this.parent.transition("idle")}}j(iN,"id","dragging");var Vx;let Bne=(Vx=class extends Re{onEnter(){this.editor.setCursor({type:"grab",rotation:0})}onPointerDown(e){this.parent.transition("pointing",e)}onCancel(){this.editor.setCurrentTool("select")}},j(Vx,"id","idle"),Vx);var Gx;let Une=(Gx=class extends Re{onEnter(){this.editor.stopCameraAnimation(),this.editor.setCursor({type:"grabbing",rotation:0})}onLongPress(){this.startDragging()}onPointerMove(){this.editor.inputs.isDragging&&this.startDragging()}startDragging(){this.parent.transition("dragging")}onPointerUp(){this.complete()}onCancel(){this.complete()}onComplete(){this.complete()}onInterrupt(){this.complete()}complete(){this.parent.transition("idle")}},j(Gx,"id","pointing"),Gx);class Lf extends Re{static children(){return[Bne,Une,iN]}onDoubleClick(e){if(e.phase==="settle"){const{currentScreenPoint:t}=this.editor.inputs;this.editor.zoomIn(t,{animation:{duration:220,easing:xn.easeOutQuint}})}}onTripleClick(e){if(e.phase==="settle"){const{currentScreenPoint:t}=this.editor.inputs;this.editor.zoomOut(t,{animation:{duration:320,easing:xn.easeOutQuint}})}}onQuadrupleClick(e){if(e.phase==="settle"){const t=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:r}}=this.editor;t===1?this.editor.zoomToFit({animation:{duration:400,easing:xn.easeOutQuint}}):this.editor.resetZoom(r,{animation:{duration:320,easing:xn.easeOutQuint}})}}}j(Lf,"id","hand"),j(Lf,"initial","idle"),j(Lf,"isLockable",!1);var qx;let Hne=(qx=class extends Re{onPointerDown(e){this.parent.transition("lasering",e)}},j(qx,"id","idle"),qx);class aN extends Re{constructor(){super(...arguments);j(this,"scribbleId","id")}onEnter(){const t=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:this.editor.options.laserDelayMs,shrink:.05,taper:!0});this.scribbleId=t.id,this.pushPointToScribble()}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.pushPointToScribble()}onPointerUp(){this.complete()}pushPointToScribble(){const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)}onCancel(){this.cancel()}onComplete(){this.complete()}complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}}j(aN,"id","lasering");class Ff extends Re{static children(){return[Hne,aN]}onEnter(){this.editor.setCursor({type:"cross",rotation:0})}}j(Ff,"id","laser"),j(Ff,"initial","idle"),j(Ff,"isLockable",!1);class lN extends Re{constructor(){super(...arguments);j(this,"info",{});j(this,"initialSelectedShapeIds",[]);j(this,"excludedShapeIds",new Set);j(this,"isWrapMode",!1);j(this,"initialStartShape",null)}onEnter(t){const{altKey:r,currentPagePoint:o}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),r){this.parent.transition("scribble_brushing",t);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(s=>this.editor.isShapeOfType(s,"group")||this.editor.isShapeOrAncestorLocked(s)).map(s=>s.id)),this.info=t,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(o)[0],this.hitTestShapes()}onExit(){this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})}onTick({elapsed:t}){const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.hitTestShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(t){this.editor.setSelectedShapes(this.initialSelectedShapeIds),this.parent.transition("idle",t)}onKeyDown(t){this.editor.inputs.altKey?this.parent.transition("scribble_brushing",t):this.hitTestShapes()}onKeyUp(){this.hitTestShapes()}complete(){this.hitTestShapes(),this.parent.transition("idle")}hitTestShapes(){const{editor:t,excludedShapeIds:r,isWrapMode:o}=this,{inputs:{originPagePoint:s,currentPagePoint:i,shiftKey:a,ctrlKey:c}}=t,u=new Set(a?this.initialSelectedShapeIds:[]),h=o?!c:c,f=xe.FromPoints([s,i]),{corners:g}=f;let y,v,S,w,b,_;const T=t.getCurrentPageRenderingShapesSorted(),E=t.getCurrentPageId();e:for(let R=0,L=T.length;R<L;R++){if(S=T[R],r.has(S.id)||u.has(S.id)||(w=t.getShapePageBounds(S),!w))continue e;if(f.contains(w)){this.handleHit(S,i,E,u,g);continue e}if(h||t.isShapeOfType(S,"frame"))continue e;if(f.collides(w)){if(b=t.getShapePageTransform(S),!b)continue e;_=b.clone().invert().applyToPoints(g);const K=t.getShapeGeometry(S);t:for(let D=0;D<4;D++)if(y=_[D],v=_[(D+1)%4],K.hitTestLineSegment(y,v,0)){this.handleHit(S,i,E,u,g);break t}}}const M=t.getInstanceState().brush;(!M||!f.equals(M))&&t.updateInstanceState({brush:{...f.toJson()}});const A=t.getSelectedShapeIds();(A.length!==u.size||A.some(R=>!u.has(R)))&&t.setSelectedShapes(Array.from(u))}onInterrupt(){this.editor.updateInstanceState({brush:null})}handleHit(t,r,o,s,i){if(t.parentId===o){s.add(t.id);return}const a=this.editor.getOutermostSelectableShape(t),c=this.editor.getShapeMask(a.id);c&&!x1(c,i)&&!no(r,c)||s.add(a.id)}}j(lN,"id","brushing");const Gc={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};class cN extends Re{constructor(){super(...arguments);j(this,"info",{})}updateCursor(){const t=this.editor.getSelectedShapes(),r=Gc[this.info.handle];this.editor.setCursor({type:r,rotation:t.length===1?this.editor.getSelectionRotation():0})}onEnter(t){this.info=t,this.updateCursor()}onPointerMove(){this.editor.inputs.isDragging&&this.startResizing()}onLongPress(){this.startResizing()}startResizing(){this.editor.getIsReadonly()||this.parent.transition("resizing",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}j(cN,"id","pointing_resize_handle");const bo=8;class I_ extends Re{constructor(){super(...arguments);j(this,"info",{});j(this,"markId","");j(this,"snapshot",{})}onEnter(t){this.info=t,this.markId=this.editor.markHistoryStoppingPoint("cropping"),this.snapshot=this.createSnapshot(),this.updateShapes()}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}updateCursor(){if(!this.editor.getSelectedShapes()[0])return;const r=Gc[this.info.handle];this.editor.setCursor({type:r,rotation:this.editor.getSelectionRotation()})}getDefaultCrop(){return{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}}}updateShapes(){const{shape:t,cursorHandleOffset:r}=this.snapshot;if(!t||!this.editor.getShapeUtil("image"))return;const s=t.props,i=this.editor.inputs.currentPagePoint.clone().sub(r),a=this.editor.inputs.originPagePoint.clone().sub(r),c=i.clone().sub(a).rot(-t.rotation),u=s.crop??this.getDefaultCrop(),h=zt(u),f=new P(t.x,t.y),g=new P(0,0),y=1/(u.bottomRight.x-u.topLeft.x)*s.w,v=1/(u.bottomRight.y-u.topLeft.y)*s.h;let S=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(v<bo)break;S=!0,h.topLeft.y=h.topLeft.y+c.y/v,v*(h.bottomRight.y-h.topLeft.y)<bo?(h.topLeft.y=h.bottomRight.y-bo/v,g.y=(h.topLeft.y-u.topLeft.y)*v):h.topLeft.y<=0?(h.topLeft.y=0,g.y=(h.topLeft.y-u.topLeft.y)*v):g.y=c.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(v<bo)break;S=!0,h.bottomRight.y=Math.min(1,h.bottomRight.y+c.y/v),v*(h.bottomRight.y-h.topLeft.y)<bo&&(h.bottomRight.y=h.topLeft.y+bo/v);break}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(y<bo)break;S=!0,h.topLeft.x=h.topLeft.x+c.x/y,y*(h.bottomRight.x-h.topLeft.x)<bo?(h.topLeft.x=h.bottomRight.x-bo/y,g.x=(h.topLeft.x-u.topLeft.x)*y):h.topLeft.x<=0?(h.topLeft.x=0,g.x=(h.topLeft.x-u.topLeft.x)*y):g.x=c.x;break}case"right":case"top_right":case"bottom_right":{if(y<bo)break;S=!0,h.bottomRight.x=Math.min(1,h.bottomRight.x+c.x/y),y*(h.bottomRight.x-h.topLeft.x)<bo&&(h.bottomRight.x=h.topLeft.x+bo/y);break}}if(!S)return;f.add(g.rot(t.rotation));const w={id:t.id,type:t.type,x:f.x,y:f.y,props:{crop:h,w:(h.bottomRight.x-h.topLeft.x)*y,h:(h.bottomRight.y-h.topLeft.y)*v}};this.editor.updateShapes([w]),this.updateCursor()}complete(){this.updateShapes(),Rt(this.editor,[this.snapshot.shape.id]),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}createSnapshot(){const t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:r}}=this.editor,o=this.editor.getOnlySelectedShape(),s=this.editor.getSelectionRotatedPageBounds(),i=P.RotWith(s.getHandlePoint(this.info.handle),s.point,t),a=P.Sub(r,i);return{shape:o,cursorHandleOffset:a}}}j(I_,"id","cropping");function uN(n,e=!1){const t=n.getZoomLevel(),{inputs:{currentPagePoint:r}}=n;return n.getShapeAtPoint(r,{hitInside:!1,hitLabels:e,margin:n.options.hitTestMargin/t,renderingOnly:!0})??n.getSelectedShapeAtPoint(r)}function dN(n,e,t){if(!e)throw Error("Needs to translate a cropped shape!");const{crop:r}=e.props;if(!r)return;const o=n.inputs.shiftKey?Math.abs(t.x)<Math.abs(t.y)?"x":"y":null;o==="x"?t.x=0:o==="y"&&(t.y=0),t.rot(-e.rotation);const s=1/(r.bottomRight.x-r.topLeft.x)*e.props.w,i=1/(r.bottomRight.y-r.topLeft.y)*e.props.h,a=r.bottomRight.y-r.topLeft.y,c=r.bottomRight.x-r.topLeft.x,u=zt(r);return u.topLeft.x=Math.min(1-c,Math.max(0,u.topLeft.x-t.x/s)),u.topLeft.y=Math.min(1-a,Math.max(0,u.topLeft.y-t.y/i)),u.bottomRight.x=u.topLeft.x+c,u.bottomRight.y=u.topLeft.y+a,{id:e.id,type:e.type,props:{crop:u}}}var Yx;let Kne=(Yx=class extends Re{onEnter(){this.editor.setCursor({type:"default",rotation:0});const e=this.editor.getOnlySelectedShape();e&&this.editor.setCroppingShape(e.id)}onExit(){this.editor.setCursor({type:"default",rotation:0})}onCancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}onPointerDown(e){var t;if(e.accelKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{const r=uN(this.editor);if(r&&!this.editor.isShapeOfType(r,"group")){this.onPointerDown({...e,shape:r,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":{if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}else(t=this.editor.getShapeUtil(e.shape))!=null&&t.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop.idle"});break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{this.editor.setCurrentTool("select.crop.pointing_crop_handle",{...e,onInteractionEnd:"select.crop.idle"});break}default:this.cancel()}break}}}onDoubleClick(e){var s;if(this.editor.inputs.shiftKey||e.phase!=="up")return;const t=this.editor.getCroppingShapeId();if(!t)return;const r=this.editor.getShape(t);if(!r)return;const o=this.editor.getShapeUtil(r);if(o){if(e.target==="selection"){(s=o.onDoubleClickEdge)==null||s.call(o,r);return}this.cancel(),this.editor.root.handleEvent(e)}}onKeyDown(){this.nudgeCroppingImage(!1)}onKeyRepeat(){this.nudgeCroppingImage(!0)}onKeyUp(e){switch(e.code){case"Enter":{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{});break}}}cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}nudgeCroppingImage(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),o=new P(0,0);if(t.has("ArrowLeft")&&(o.x+=1),t.has("ArrowRight")&&(o.x-=1),t.has("ArrowUp")&&(o.y+=1),t.has("ArrowDown")&&(o.y-=1),o.equals(new P(0,0)))return;r&&o.mul(10);const s=this.editor.getShape(this.editor.getCroppingShapeId());if(!s)return;const i=dN(this.editor,s,o);i&&(e||this.editor.markHistoryStoppingPoint("translate crop"),this.editor.updateShapes([i]))}},j(Yx,"id","idle"),Yx);class hN extends Re{onCancel(){this.editor.setCurrentTool("select.crop.idle",{})}onPointerMove(e){this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)}onPointerUp(e){this.editor.setCurrentTool("select.crop.idle",e)}}j(hN,"id","pointing_crop");class E_ extends Re{constructor(){super(...arguments);j(this,"info",{})}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd);const r=this.editor.getSelectedShapes()[0];if(!r)return;const o=Gc[this.info.handle];this.editor.setCursor({type:o,rotation:this.editor.getSelectionRotation()}),this.editor.setCroppingShape(r.id)}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0)}onPointerMove(){this.editor.inputs.isDragging&&this.startCropping()}onLongPress(){this.startCropping()}startCropping(){this.editor.getIsReadonly()||this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})}onPointerUp(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle"))}}j(E_,"id","pointing_crop_handle");class pN extends Re{constructor(){super(...arguments);j(this,"info",{});j(this,"markId","");j(this,"snapshot",{})}onEnter(t){this.info=t,this.snapshot=this.createSnapshot(),this.markId=this.editor.markHistoryStoppingPoint("translating_crop"),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()}onExit(){this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}onKeyDown(t){switch(t.key){case"Alt":case"Shift":{this.updateShapes();return}}}onKeyUp(t){switch(t.key){case"Enter":{this.complete();return}case"Alt":case"Shift":this.updateShapes()}}complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){return{shape:this.editor.getOnlySelectedShape()}}updateShapes(){const t=this.snapshot.shape;if(!t)return;const{originPagePoint:r,currentPagePoint:o}=this.editor.inputs,s=o.clone().sub(r),i=dN(this.editor,t,s);i&&this.editor.updateShapes([i])}}j(pN,"id","translating_crop");class nb extends Re{constructor(){super(...arguments);j(this,"markId","");j(this,"didExit",!1)}static children(){return[Kne,pN,hN,E_,I_]}onEnter(){this.didExit=!1,this.markId=this.editor.markHistoryStoppingPoint("crop")}onExit(){this.didExit||(this.didExit=!0,this.editor.squashToMark(this.markId))}onCancel(){this.didExit||(this.didExit=!0,this.editor.bailToMark(this.markId))}}j(nb,"id","crop"),j(nb,"initial","idle");class fN extends Re{constructor(){super(...arguments);j(this,"shapeId","");j(this,"initialHandle",{});j(this,"initialAdjacentHandle",null);j(this,"initialPagePoint",{});j(this,"markId","");j(this,"initialPageTransform");j(this,"initialPageRotation");j(this,"info",{});j(this,"isPrecise",!1);j(this,"isPreciseId",null);j(this,"pointingId",null);j(this,"exactTimeout",-1)}onEnter(t){const{shape:r,isCreating:o,creatingMarkId:s,handle:i}=t;if(this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.shapeId=r.id,this.markId="",o)if(s)this.markId=s;else{const u=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);u&&(this.markId=u)}else this.markId=this.editor.markHistoryStoppingPoint("dragging handle");if(this.initialHandle=zt(i),this.editor.isShapeOfType(r,"line")&&this.initialHandle.type==="create"){this.editor.updateShape({...r,props:{points:{...r.props.points,[i.index]:{id:i.index,index:i.index,x:i.x,y:i.y}}}});const h=this.editor.getShapeHandles(r).find(f=>f.index===i.index);this.initialHandle=zt(h)}this.initialPageTransform=this.editor.getShapePageTransform(r),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.setCursor({type:o?"cross":"grabbing",rotation:0});const a=this.editor.getShapeHandles(r).sort(Gn),c=a.findIndex(u=>u.id===t.handle.id);this.initialAdjacentHandle=null;for(let u=c+1;u<a.length;u++){const h=a[u];if(h.type==="vertex"&&h.id!=="middle"&&h.id!==t.handle.id){this.initialAdjacentHandle=h;break}}if(!this.initialAdjacentHandle)for(let u=a.length-1;u>=0;u--){const h=a[u];if(h.type==="vertex"&&h.id!=="middle"&&h.id!==t.handle.id){this.initialAdjacentHandle=h;break}}if(this.editor.isShapeOfType(r,"arrow")){const u=jr(this.editor,r)[t.handle.id];this.isPrecise=!1,u?(this.editor.setHintingShapes([u.toId]),this.isPrecise=u.props.isPrecise,this.isPrecise?this.isPreciseId=u.toId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)}resetExactTimeout(){this.exactTimeout!==-1&&this.clearExactTimeout(),this.exactTimeout=this.editor.timers.setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){this.exactTimeout!==-1&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.update(),this.complete()}onCancel(){this.cancel()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0})}complete(){this.editor.snaps.clearIndicators(),Rt(this.editor,[this.shapeId]);const{onInteractionEnd:t}=this.info;if(this.editor.getInstanceState().isToolLocked&&t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();const{onInteractionEnd:t}=this.info;if(t){this.editor.setCurrentTool(t,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){var R;const{editor:t,shapeId:r,initialPagePoint:o}=this,{initialHandle:s,initialPageRotation:i,initialAdjacentHandle:a}=this,c=this.editor.getHintingShapeIds(),u=this.editor.user.getIsSnapMode(),{snaps:h,inputs:{currentPagePoint:f,shiftKey:g,ctrlKey:y,altKey:v,pointerVelocity:S}}=t,w=this.info.shape,b=t.getShape(r);if(!b)return;const _=t.getShapeUtil(b);let T=f.clone().sub(o).rot(-i).add(s);if(g&&a&&s.id!=="middle"){const L=P.Angle(a,T),D=lg(L,24)-L;T=P.RotWith(T,a,D)}t.snaps.clearIndicators();let E={...s,x:T.x,y:T.y};if(s.canSnap&&(u?!y:y)){if(!t.getShapePageTransform(b.id))throw Error("Expected a page transform");const K=h.handles.snapHandle({currentShapeId:r,handle:E});K&&(K.nudge.rot(-t.getShapeParentTransform(b).rotation()),T.add(K.nudge),E={...s,x:T.x,y:T.y})}const M=(R=_.onHandleDrag)==null?void 0:R.call(_,b,{handle:E,isPrecise:this.isPrecise||v,initial:w}),A={id:b.id,type:b.type,...M};if(s.type==="vertex"&&this.editor.isShapeOfType(b,"arrow")){const L=jr(t,b)[s.id];L?c[0]!==L.toId&&(t.setHintingShapes([L.toId]),this.pointingId=L.toId,this.isPrecise=S.len()<.5||v,this.isPreciseId=this.isPrecise?L.toId:null,this.resetExactTimeout()):c.length>0&&(t.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}M&&t.updateShapes([A])}}j(fN,"id","dragging_handle");function gN(n){return n.isLabel?[n]:n instanceof To?n.children.filter(e=>e.isLabel):[]}class mN extends Re{constructor(){super(...arguments);j(this,"hitShapeForPointerUp",null);j(this,"info",{})}onEnter(t){const r=this.editor.getEditingShape();if(!r)throw Error("Entered editing state without an editing shape");this.hitShapeForPointerUp=null,this.info=t,t.isCreatingTextWhileToolLocked&&this.parent.setCurrentToolIdMask("text"),fi(this.editor),this.editor.select(r)}onExit(){var s;const{editingShapeId:t}=this.editor.getCurrentPageState();if(!t)return;this.editor.setEditingShape(null),fi.cancel();const r=this.editor.getShape(t),o=this.editor.getShapeUtil(r);(s=o.onEditEnd)==null||s.call(o,r),this.info.isCreatingTextWhileToolLocked&&(this.parent.setCurrentToolIdMask(void 0),this.editor.setCurrentTool("text",{}))}onPointerMove(t){if(this.hitShapeForPointerUp&&this.editor.inputs.isDragging){if(this.editor.getIsReadonly()||this.hitShapeForPointerUp.isLocked)return;this.editor.select(this.hitShapeForPointerUp),this.parent.transition("translating",t),this.hitShapeForPointerUp=null;return}switch(t.target){case"shape":case"canvas":{fi(this.editor);return}}}onPointerDown(t){switch(this.hitShapeForPointerUp=null,t.target){case"shape":{const{shape:r}=t,o=this.editor.getEditingShape();if(!o)throw Error("Expected an editing shape!");const s=this.editor.getShapeUtil(r).getGeometry(r),i=gN(s),a=i.length===1?i[0]:void 0,c=this.editor.isShapeOfType(o,"text")&&o.props.text.trim()==="";if(a&&!c){const u=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint);if(a.bounds.containsPoint(u,0)&&a.hitTestPoint(u)){if(r.id===o.id)return;this.hitShapeForPointerUp=r,this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(r.id);return}}else{if(r.id===o.id)this.editor.isShapeOfType(r,"frame")&&(this.editor.setEditingShape(null),this.parent.transition("idle",t));else{this.parent.transition("pointing_shape",t);return}return}break}}this.parent.transition("idle",t),this.editor.root.handleEvent(t)}onPointerUp(t){const r=this.hitShapeForPointerUp;if(!r)return;this.hitShapeForPointerUp=null;const o=this.editor.getShapeUtil(r);if(!r.isLocked){if(this.editor.getIsReadonly()&&!o.canEditInReadOnly(r)){this.parent.transition("pointing_shape",t);return}this.editor.select(r.id),this.editor.setEditingShape(r.id),fi(this.editor)}}onComplete(t){this.parent.transition("idle",t)}onCancel(t){this.parent.transition("idle",t)}}j(mN,"id","editing_shape");function cM(n){const e=n.getOnlySelectedShape();return!!(e&&!n.isShapeOrAncestorLocked(e)&&n.getShapeUtil(e).canCrop(e))}function Eg(n,e){const t=n.getSelectedShapeIds(),{currentPagePoint:r}=n.inputs,{shiftKey:o,altKey:s,accelKey:i}=e,a=o||i,c=n.getShapeAtPoint(r,{hitInside:!1,margin:n.options.hitTestMargin/n.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:u=>!u.isLocked});if(c){const u=n.getOutermostSelectableShape(c);if(a&&!s)n.cancelDoubleClick(),t.includes(u.id)?(n.markHistoryStoppingPoint("deselecting shape"),n.deselect(u)):(n.markHistoryStoppingPoint("shift selecting shape"),n.setSelectedShapes([...t,u.id]));else{let h;u===c||u.id===n.getFocusedGroupId()||t.includes(u.id)?h=c:h=u,h&&!t.includes(h.id)&&(n.markHistoryStoppingPoint("selecting shape"),n.select(h.id))}}else{if(a)return;{t.length>0&&(n.markHistoryStoppingPoint("selecting none"),n.selectNone());const u=n.getFocusedGroupId();if(Tr(u)){const h=n.getShape(u);n.isPointInShape(h,r,{margin:0,hitInside:!0})||n.setFocusedGroup(null)}}}}const Wne=["Delete","Backspace","[","]","Enter"," ","Shift","Tab"];var Xx;let Vne=(Xx=class extends Re{onEnter(){this.parent.setCurrentToolIdMask(void 0),fi(this.editor),this.editor.setCursor({type:"default",rotation:0})}onExit(){fi.cancel()}onPointerMove(){fi(this.editor)}onPointerDown(e){const t=e.ctrlKey&&cM(this.editor);switch(e.target){case"canvas":{const r=uN(this.editor);if(r&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}const o=this.editor.getSelectedShapeIds(),s=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:i}}=this.editor;if((o.length>1||s&&!this.editor.getShapeUtil(s).hideSelectionBoundsBg(s))&&uM(this.editor,i)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{const{shape:r}=e;if(this.isOverArrowLabelTest(r)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(r)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":{if(this.editor.getIsReadonly())break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break}case"selection":{switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":{if(t)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_rotate_handle",e)}break}case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":{if(t)this.parent.transition("crop.pointing_crop_handle",e);else{if(e.accelKey){this.parent.transition("brushing",e);break}this.parent.transition("pointing_resize_handle",e)}break}default:{const r=this.editor.getHoveredShape();if(r&&!this.editor.getSelectedShapeIds().includes(r.id)&&!r.isLocked){this.onPointerDown({...e,shape:r,target:"shape"});return}this.parent.transition("pointing_selection",e)}}break}}}onDoubleClick(e){var t,r,o,s;if(!(this.editor.inputs.shiftKey||e.phase!=="up")&&!(e.ctrlKey||e.shiftKey))switch(e.target){case"canvas":{const i=this.editor.getHoveredShape(),a=i&&!this.editor.isShapeOfType(i,"group")?i:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1}),c=this.editor.getFocusedGroupId();if(a){if(this.editor.isShapeOfType(a,"group")){Eg(this.editor,e);return}else{const u=this.editor.getShape(a.parentId);if(u&&this.editor.isShapeOfType(u,"group")&&!(c&&u.id===c)){Eg(this.editor,e);return}}this.onDoubleClick({...e,shape:a,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getIsReadonly())break;const i=this.editor.getOnlySelectedShape();if(i){const a=this.editor.getShapeUtil(i);if(!this.canInteractWithShapeInReadOnly(i))return;if(e.handle==="right"||e.handle==="left"||e.handle==="top"||e.handle==="bottom"){const c=(t=a.onDoubleClickEdge)==null?void 0:t.call(a,i);if(c){this.editor.markHistoryStoppingPoint("double click edge"),this.editor.updateShapes([c]),Rt(this.editor,[i.id]);return}}if(a.canCrop(i)&&!this.editor.isShapeOrAncestorLocked(i)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(i)&&this.startEditingShape(i,e,!0)}break}case"shape":{const{shape:i}=e,a=this.editor.getShapeUtil(i);if(i.type!=="video"&&i.type!=="embed"&&this.editor.getIsReadonly())break;if(a.onDoubleClick){const c=(r=a.onDoubleClick)==null?void 0:r.call(a,i);if(c){this.editor.updateShapes([c]);return}}if(a.canCrop(i)&&!this.editor.isShapeOrAncestorLocked(i)){this.editor.markHistoryStoppingPoint("select and crop"),this.editor.select((o=e.shape)==null?void 0:o.id),this.parent.transition("crop",e);return}this.shouldStartEditingShape(i)?this.startEditingShape(i,e,!0):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getIsReadonly())break;const{shape:i,handle:a}=e,c=this.editor.getShapeUtil(i),u=(s=c.onDoubleClickHandle)==null?void 0:s.call(c,i,a);u?this.editor.updateShapes([u]):this.shouldStartEditingShape(i)&&this.startEditingShape(i,e,!0)}}}onRightClick(e){switch(e.target){case"canvas":{const t=this.editor.getHoveredShape(),r=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:this.editor.options.hitTestMargin/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitLocked:!0,hitFrameInside:!0,renderingOnly:!0});if(r){this.onRightClick({...e,shape:r,target:"shape"});return}const o=this.editor.getSelectedShapeIds(),s=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:i}}=this.editor;if((o.length>1||s&&!this.editor.getShapeUtil(s).hideSelectionBoundsBg(s))&&uM(this.editor,i)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{const{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:r}=e,o=this.editor.getOutermostSelectableShape(r,s=>!t.includes(s.id));!t.includes(o.id)&&!this.editor.findShapeAncestor(o,s=>t.includes(s.id))&&(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([o.id]));break}}}onCancel(){this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.markHistoryStoppingPoint("clearing selection"),this.editor.selectNone())}onKeyDown(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!1);return}}if(sn.editOnType.get()&&!Wne.includes(e.key)&&!e.altKey&&!e.ctrlKey){const t=this.editor.getOnlySelectedShape();if(t&&this.editor.isShapeOfType(t,"note")&&this.shouldStartEditingShape(t)){this.startEditingShape(t,{...e,target:"shape",shape:t},!0);return}}}onKeyRepeat(e){switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":{this.nudgeSelectedShapes(!0);break}}}onKeyUp(e){switch(e.code){case"Enter":{const t=this.editor.getSelectedShapes();if(t.every(o=>this.editor.isShapeOfType(o,"group"))){this.editor.setSelectedShapes(t.flatMap(o=>this.editor.getSortedChildIdsForParent(o.id)));return}const r=this.editor.getOnlySelectedShape();if(r&&this.shouldStartEditingShape(r)){this.startEditingShape(r,{...e,target:"shape",shape:r},!0);return}cM(this.editor)&&this.parent.transition("crop",e);break}}}shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!e||this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||!this.canInteractWithShapeInReadOnly(e)?!1:this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t,r){this.editor.isShapeOrAncestorLocked(e)&&e.type!=="embed"||(this.editor.markHistoryStoppingPoint("editing shape"),yg(this.editor,e,r),this.parent.transition("editing_shape",t))}isOverArrowLabelTest(e){if(!e)return!1;const t=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){const r=this.editor.getShapeGeometry(e).children[1];if(r&&no(t,r.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getIsReadonly()||!this.editor.options.createTextOnCanvasDoubleClick)return;this.editor.markHistoryStoppingPoint("creating text shape");const t=Ct(),{x:r,y:o}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:r,y:o,props:{text:"",autoSize:!0}}]);const s=this.editor.getShape(t);if(!s)return;const i=this.editor.getShapeUtil(s);this.editor.getIsReadonly()&&!i.canEditInReadOnly(s)||(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){const{editor:{inputs:{keys:t}}}=this,r=t.has("ShiftLeft"),o=new P(0,0);if(t.has("ArrowLeft")&&(o.x-=1),t.has("ArrowRight")&&(o.x+=1),t.has("ArrowUp")&&(o.y-=1),t.has("ArrowDown")&&(o.y+=1),o.equals(new P(0,0)))return;e||this.editor.markHistoryStoppingPoint("nudge shapes");const{gridSize:s}=this.editor.getDocumentSettings(),i=this.editor.getInstanceState().isGridMode?r?s*Yne:s:r?Gne:qne,a=this.editor.getSelectedShapeIds();this.editor.nudgeShapes(a,o.mul(i)),Rt(this.editor,a)}canInteractWithShapeInReadOnly(e){return!!(!this.editor.getIsReadonly()||this.editor.getShapeUtil(e).canEditInReadOnly(e))}},j(Xx,"id","idle"),Xx);const Gne=10,qne=1,Yne=5;function uM(n,e){const t=n.getSelectionRotatedPageBounds();if(!t)return!1;const r=n.getSelectionRotation();return r?no(e,t.corners.map(o=>P.RotWith(o,t.point,r))):t.containsPoint(e)}class yN extends Re{constructor(){super(...arguments);j(this,"shapeId","");j(this,"markId","");j(this,"wasAlreadySelected",!1);j(this,"didDrag",!1);j(this,"didCtrlOnEnter",!1);j(this,"info",{});j(this,"_labelDragOffset",new P(0,0))}updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter(t){const{shape:r}=t;this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.shapeId=r.id,this.didDrag=!1,this.didCtrlOnEnter=t.accelKey,this.wasAlreadySelected=this.editor.getOnlySelectedShapeId()===r.id,this.updateCursor();const s=this.editor.getShapeGeometry(r).children[1];if(!s)throw Error(`Expected to find an arrow label geometry for shape: ${r.id}`);const{currentPagePoint:i}=this.editor.inputs,a=this.editor.getPointInShapeSpace(r,i);this._labelDragOffset=P.Sub(s.center,a),this.markId=this.editor.markHistoryStoppingPoint("label-drag start"),this.editor.setSelectedShapes([this.shapeId])}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){const{isDragging:t}=this.editor.inputs;if(!t)return;if(this.didCtrlOnEnter){this.parent.transition("brushing",this.info);return}const r=this.editor.getShape(this.shapeId);if(!r)return;const o=ks(this.editor,r),s=this.editor.getShapeGeometry(r),i=s.children[0],a=this.editor.getPointInShapeSpace(r,this.editor.inputs.currentPagePoint),c=i.nearestPoint(P.Add(a,this._labelDragOffset));let u;if(o.isStraight){const h=P.Dist(o.start.point,o.end.point);u=1-P.Dist(o.end.point,c)/h}else{const{_center:h,measure:f,angleEnd:g,angleStart:y}=s.children[0];u=hw(f,y,g,h.angle(c))}isNaN(u)&&(u=.5),this.didDrag=!0,this.editor.updateShape({id:r.id,type:r.type,props:{labelPosition:u}})}onPointerUp(){const t=this.editor.getShape(this.shapeId);t&&(this.didDrag||!this.wasAlreadySelected?this.complete():this.editor.getIsReadonly()||(this.editor.setEditingShape(t.id),this.editor.setCurrentTool("select.editing_shape")))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}j(yN,"id","pointing_arrow_label");class vN extends Re{onEnter(e){e.shiftKey||e.accelKey||this.editor.getSelectedShapeIds().length>0&&(this.editor.markHistoryStoppingPoint("selecting none"),this.editor.selectNone())}onPointerMove(e){this.editor.inputs.isDragging&&this.parent.transition("brushing",e)}onPointerUp(e){Eg(this.editor,e),this.complete()}onComplete(){this.complete()}onInterrupt(){this.parent.transition("idle")}complete(){this.parent.transition("idle")}}j(vN,"id","pointing_canvas");class SN extends Re{constructor(){super(...arguments);j(this,"didCtrlOnEnter",!1);j(this,"info",{})}onEnter(t){this.info=t,this.didCtrlOnEnter=t.accelKey;const{shape:r}=t;if(this.editor.isShapeOfType(r,"arrow")){const o=jr(this.editor,r)[t.handle.id];o&&this.editor.setHintingShapes([o.toId])}this.editor.setCursor({type:"grabbing",rotation:0})}onExit(){this.editor.setHintingShapes([]),this.editor.setCursor({type:"default",rotation:0})}onPointerUp(){const{shape:t,handle:r}=this.info;if(this.editor.isShapeOfType(t,"note")){const{editor:o}=this,s=dM(o,t,r,!1);if(s){yg(o,s,!0);return}}this.parent.transition("idle",this.info)}onPointerMove(t){const{editor:r}=this;r.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",t):this.startDraggingHandle())}onLongPress(){this.startDraggingHandle()}startDraggingHandle(){const{editor:t}=this;if(t.getIsReadonly())return;const{shape:r,handle:o}=this.info;if(t.isShapeOfType(r,"note")){const s=dM(t,r,o,!0);if(s){const i=t.getPointInParentSpace(s,t.inputs.originPagePoint).sub(P.Rot(km.clone().mul(r.props.scale),s.rotation));t.updateShape({...s,x:i.x,y:i.y}),t.setHoveredShape(s.id).select(s.id).setCurrentTool("select.translating",{...this.info,target:"shape",shape:t.getShape(s),onInteractionEnd:"note",isCreating:!0,onCreate:()=>{yg(t,s,!0)}});return}}this.parent.transition("dragging_handle",this.info)}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}j(SN,"id","pointing_handle");function dM(n,e,t,r){const o=n.getShapePageTransform(e.id),s=o.point(),i=o.rotation(),c=AF(n,s,i,e.props.growY,0,e.props.scale)[t.index];if(c)return RF(n,e,c,i,r)}class xN extends Re{constructor(){super(...arguments);j(this,"info",{})}updateCursor(){this.editor.setCursor({type:Gc[this.info.handle],rotation:this.editor.getSelectionRotation()})}onEnter(t){this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.info=t,this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0})}onPointerMove(){this.editor.inputs.isDragging&&this.startRotating()}onLongPress(){this.startRotating()}startRotating(){this.editor.getIsReadonly()||this.parent.transition("rotating",this.info)}onPointerUp(){this.complete()}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}}j(xN,"id","pointing_rotate_handle");class wN extends Re{constructor(){super(...arguments);j(this,"info",{})}onEnter(t){this.info=t}onPointerUp(t){Eg(this.editor,t),this.parent.transition("idle",t)}onPointerMove(t){this.editor.inputs.isDragging&&this.startTranslating(t)}onLongPress(t){this.startTranslating(t)}startTranslating(t){this.editor.getIsReadonly()||this.parent.transition("translating",t)}onDoubleClick(t){var s,i;const r=this.editor.getHoveredShape(),o=r&&!this.editor.isShapeOfType(r,"group")?r:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(o){this.parent.transition("idle"),(i=(s=this.parent).onDoubleClick)==null||i.call(s,{...t,target:"shape",shape:this.editor.getShape(o)});return}}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}j(wN,"id","pointing_selection");class bN extends Re{constructor(){super(...arguments);j(this,"hitShape",{});j(this,"hitShapeForPointerUp",{});j(this,"isDoubleClick",!1);j(this,"didCtrlOnEnter",!1);j(this,"didSelectOnEnter",!1)}onEnter(t){const r=this.editor.getSelectedShapeIds(),o=this.editor.getSelectionRotatedPageBounds(),s=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:i}}=this.editor,{shiftKey:a,altKey:c,accelKey:u}=t;this.hitShape=t.shape,this.isDoubleClick=!1,this.didCtrlOnEnter=u;const h=this.editor.getOutermostSelectableShape(t.shape),f=this.editor.findShapeAncestor(h,g=>r.includes(g.id));if(this.didCtrlOnEnter||this.editor.getShapeUtil(t.shape).onClick||h.id===s||r.includes(h.id)||f||r.length>1&&(o!=null&&o.containsPoint(i))){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=h;return}this.didSelectOnEnter=!0,a&&!c?(this.editor.cancelDoubleClick(),r.includes(h.id)||(this.editor.markHistoryStoppingPoint("shift selecting shape"),this.editor.setSelectedShapes([...r,h.id]))):(this.editor.markHistoryStoppingPoint("selecting shape"),this.editor.setSelectedShapes([h.id]))}onPointerUp(t){var h;const r=this.editor.getSelectedShapeIds(),o=this.editor.getFocusedGroupId(),s=this.editor.getZoomLevel(),{inputs:{currentPagePoint:i}}=this.editor,a=t.shiftKey||t.accelKey,c=this.editor.getShapeAtPoint(i,{margin:this.editor.options.hitTestMargin/s,hitInside:!0,renderingOnly:!0})??this.hitShape,u=c?this.editor.getOutermostSelectableShape(c):this.hitShapeForPointerUp;if(u){const f=this.editor.getShapeUtil(u);if(f.onClick){const g=(h=f.onClick)==null?void 0:h.call(f,u);if(g){this.editor.markHistoryStoppingPoint("shape on click"),this.editor.updateShapes([g]),this.parent.transition("idle",t);return}}if(u.id===o){r.length>0?(this.editor.markHistoryStoppingPoint("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",t);return}}if(!this.didSelectOnEnter){const f=this.editor.getOutermostSelectableShape(c,g=>!r.includes(g.id));if(r.includes(f.id))if(a)this.editor.markHistoryStoppingPoint("deselecting on pointer up"),this.editor.deselect(u);else if(r.includes(u.id)){if(r.length===1){const g=this.editor.getShapeUtil(u).getGeometry(u),y=gN(g),v=y.length===1?y[0]:void 0;if(v){const S=this.editor.getPointInShapeSpace(u,i);if(v.bounds.containsPoint(S,0)&&v.hitTestPoint(S)){this.editor.run(()=>{this.editor.markHistoryStoppingPoint("editing on pointer up"),this.editor.select(u.id);const w=this.editor.getShapeUtil(u);this.editor.getIsReadonly()&&!w.canEditInReadOnly(u)||(this.editor.setEditingShape(u.id),this.editor.setCurrentTool("select.editing_shape"),this.isDoubleClick&&this.editor.emit("select-all-text",{shapeId:u.id}))});return}}}this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(u.id)}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.select(u);else if(a){const g=this.editor.getShapeAncestors(f);this.editor.markHistoryStoppingPoint("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(y=>!g.find(v=>v.id===y)),f.id])}else this.editor.markHistoryStoppingPoint("selecting on pointer up"),this.editor.setSelectedShapes([f.id])}this.parent.transition("idle",t)}onDoubleClick(){this.isDoubleClick=!0}onPointerMove(t){this.editor.inputs.isDragging&&(this.didCtrlOnEnter?this.parent.transition("brushing",t):this.startTranslating(t))}onLongPress(t){this.startTranslating(t)}startTranslating(t){this.editor.getIsReadonly()||(this.editor.focus(),this.parent.transition("translating",t))}onCancel(){this.cancel()}onComplete(){this.cancel()}onInterrupt(){this.cancel()}cancel(){this.parent.transition("idle")}}j(bN,"id","pointing_shape");class _N extends Re{constructor(){super(...arguments);j(this,"info",{});j(this,"markId","");j(this,"didHoldCommand",!1);j(this,"creationCursorOffset",{x:0,y:0});j(this,"snapshot",{})}onEnter(t){const{isCreating:r=!1,creatingMarkId:o,creationCursorOffset:s={x:0,y:0}}=t;if(this.info=t,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.creationCursorOffset=s,this.snapshot=this._createSnapshot(),this.markId="",r)if(o)this.markId=o;else{const i=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);i&&(this.markId=i)}else this.markId=this.editor.markHistoryStoppingPoint("starting resizing");r&&this.editor.setCursor({type:"cross",rotation:0}),this.handleResizeStart(),this.updateShapes()}onTick({elapsed:t}){const{editor:r}=this;r.edgeScrollManager.updateEdgeScrolling(t)}onPointerMove(){this.updateShapes()}onKeyDown(){this.updateShapes()}onKeyUp(){this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){var t,r;if(Rt(this.editor,this.snapshot.selectedShapeIds),this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){(r=(t=this.info).onCreate)==null||r.call(t,this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:o})=>{var a;const s=this.editor.getShapeUtil(o),i=(a=s.onResizeStart)==null?void 0:a.call(s,o);i&&r.push(i)}),r.length>0&&this.editor.updateShapes(r)}handleResizeEnd(){const{shapeSnapshots:t}=this.snapshot,r=[];t.forEach(({shape:o})=>{var c;const s=this.editor.getShape(o.id),i=this.editor.getShapeUtil(o),a=(c=i.onResizeEnd)==null?void 0:c.call(i,o,s);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateShapes(){const{altKey:t,shiftKey:r}=this.editor.inputs,{frames:o,shapeSnapshots:s,selectionBounds:i,cursorHandleOffset:a,selectedShapeIds:c,selectionRotation:u,canShapesDeform:h}=this.snapshot;let f=r||!h;if(s.size===1){const L=[...s.values()][0];this.editor.isShapeOfType(L.shape,"text")&&(f=!(this.info.handle==="left"||this.info.handle==="right"))}const{ctrlKey:g}=this.editor.inputs,y=this.editor.inputs.currentPagePoint.clone().sub(a).sub(this.creationCursorOffset),v=this.editor.inputs.originPagePoint.clone().sub(a);if(this.editor.getInstanceState().isGridMode&&!g){const{gridSize:L}=this.editor.getDocumentSettings();y.snapToGrid(L)}const S=this.info.handle,w=hM(S,Math.PI);if(this.editor.snaps.clearIndicators(),(this.editor.user.getIsSnapMode()?!g:g)&&u%Dt===0){const{nudge:L}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:P.Sub(y,v),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:hM(S,u),isAspectRatioLocked:f,isResizingFromCenter:t});y.add(L)}const _=P.RotWith(t?i.center:i.getHandlePoint(w),i.point,u),T=P.Sub(y,_).rot(-u),E=P.Sub(v,_).rot(-u),M=P.DivV(T,E);Number.isFinite(M.x)||(M.x=1),Number.isFinite(M.y)||(M.y=1);const A=S==="top"||S==="bottom",R=S==="left"||S==="right";f?R?M.y=Math.abs(M.x):A?M.x=Math.abs(M.y):Math.abs(M.x)>Math.abs(M.y)?M.y=Math.abs(M.x)*(M.y<0?-1:1):M.x=Math.abs(M.y)*(M.x<0?-1:1):(A&&(M.x=1),R&&(M.y=1)),this.info.isCreating||this.updateCursor({dragHandle:S,isFlippedX:M.x<0,isFlippedY:M.y<0,rotation:u});for(const L of s.keys()){const K=s.get(L);this.editor.resizeShape(L,M,{initialShape:K.shape,initialBounds:K.bounds,initialPageTransform:K.pageTransform,dragHandle:S,mode:c.length===1&&L===c[0]?"resize_bounds":"scale_shape",scaleOrigin:_,isAspectRatioLocked:f,scaleAxisRotation:u,skipStartAndEndCallbacks:!0})}if(this.editor.inputs.ctrlKey){this.didHoldCommand=!0;for(const{id:L,children:K}of o){if(!K.length)continue;const D=s.get(L).shape,U=this.editor.getShape(L);if(!(D&&U))continue;const V=U.x-D.x,F=U.y-D.y,$=new P(V,F).rot(-D.rotation);if($.x!==0||$.y!==0)for(const H of K)this.editor.updateShape({id:H.id,type:H.type,x:H.x-$.x,y:H.y-$.y})}}else if(this.didHoldCommand){this.didHoldCommand=!1;for(const{children:L}of o)if(L.length)for(const K of L)this.editor.updateShape({id:K.id,type:K.type,x:K.x,y:K.y})}}updateCursor({dragHandle:t,isFlippedX:r,isFlippedY:o,rotation:s}){const i={...this.editor.getInstanceState().cursor};switch(t){case"top_left":case"bottom_right":{i.type="nwse-resize",r!==o&&(i.type="nesw-resize");break}case"top_right":case"bottom_left":{i.type="nesw-resize",r!==o&&(i.type="nwse-resize");break}}i.rotation=s,this.editor.setCursor(i)}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.setCursor({type:"default",rotation:0}),this.editor.snaps.clearIndicators()}_createSnapshot(){const t=this.editor.getSelectedShapeIds(),r=this.editor.getSelectionRotation(),{inputs:{originPagePoint:o}}=this.editor,s=this.editor.getSelectionRotatedPageBounds(),i=P.RotWith(s.getHandlePoint(this.info.handle),s.point,r),a=P.Sub(o,i),c=new Map,u=[];t.forEach(f=>{const g=this.editor.getShape(f);if(g){if(g.type==="frame"&&u.push({id:f,children:Ze(this.editor.getSortedChildIdsForParent(g).map(y=>this.editor.getShape(y)))}),c.set(g.id,this._createShapeSnapshot(g)),this.editor.isShapeOfType(g,"frame")&&t.length===1)return;this.editor.visitDescendants(g.id,y=>{const v=this.editor.getShape(y);if(v&&(c.set(v.id,this._createShapeSnapshot(v)),this.editor.isShapeOfType(v,"frame")))return!1})}});const h=![...c.values()].some(f=>!Kj(f.pageRotation,r)||f.isAspectRatioLocked);return{shapeSnapshots:c,selectionBounds:s,cursorHandleOffset:a,selectionRotation:r,selectedShapeIds:t,canShapesDeform:h,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:u}}_createShapeSnapshot(t){const r=this.editor.getShapePageTransform(t),o=this.editor.getShapeUtil(t);return{shape:t,bounds:this.editor.getShapeGeometry(t).bounds,pageTransform:r,pageRotation:ye.Decompose(r).rotation,isAspectRatioLocked:o.isAspectRatioLocked(t)}}}j(_N,"id","resizing");const Px=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function hM(n,e){e=e%xt;const t=Math.round(e/(ft/4)),r=Px.indexOf(n);return Px[(r+t)%Px.length]}const pM=Math.PI/180;class PN extends Re{constructor(){super(...arguments);j(this,"snapshot",{});j(this,"info",{});j(this,"markId","")}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.markId=this.editor.markHistoryStoppingPoint("rotate start");const r=JR({editor:this.editor,ids:this.editor.getSelectedShapeIds()});if(!r)return this.parent.transition("idle",this.info);this.snapshot=r;const o=this._getRotationFromPointerPosition({snapToNearestDegree:!1});pf({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.setCursor({type:Gc[this.info.handle],rotation:o+this.snapshot.initialShapesRotation})}onExit(){this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}}onPointerMove(){this.update()}onKeyDown(){this.update()}onKeyUp(){this.update()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}update(){const t=this._getRotationFromPointerPosition({snapToNearestDegree:!1});pf({editor:this.editor,delta:t,snapshot:this.snapshot,stage:"update"}),this.editor.setCursor({type:Gc[this.info.handle],rotation:t+this.snapshot.initialShapesRotation})}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}complete(){pf({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),Rt(this.editor,this.snapshot.shapeSnapshots.map(t=>t.shape.id)),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)}_getRotationFromPointerPosition({snapToNearestDegree:t}){const r=this.editor.getSelectionRotation(),o=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:s,currentPagePoint:i}}=this.editor,{initialCursorAngle:a,initialShapesRotation:c}=this.snapshot;if(!o)return c;const h=o.center.clone().rotWith(o.point,r).angle(i)-a;let f=c+h;if(s)f=lg(f,24);else if(t&&(f=Math.round(f/pM)*pM,this.editor.getInstanceState().isCoarsePointer)){const g=lg(f,4),y=uf(f,g);Math.abs(y)<ZU(5)&&(f=g)}return f-c}}j(PN,"id","rotating");class CN extends Re{constructor(){super(...arguments);j(this,"hits",new Set);j(this,"size",0);j(this,"scribbleId","id");j(this,"initialSelectedShapeIds",new Set);j(this,"newlySelectedShapeIds",new Set)}onEnter(){this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();const t=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=t.id,this.updateScribbleSelection(!0),this.editor.updateInstanceState({brush:null})}onExit(){this.editor.scribbles.stop(this.scribbleId)}onPointerMove(){this.updateScribbleSelection(!0)}onPointerUp(){this.complete()}onKeyDown(){this.updateScribbleSelection(!1)}onKeyUp(){this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")}onCancel(){this.cancel()}onComplete(){this.complete()}pushPointToScribble(){const{x:t,y:r}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,t,r)}updateScribbleSelection(t){const{editor:r}=this,o=this.editor.getCurrentPageRenderingShapesSorted(),{inputs:{shiftKey:s,originPagePoint:i,previousPagePoint:a,currentPagePoint:c}}=this.editor,{newlySelectedShapeIds:u,initialSelectedShapeIds:h}=this;t&&this.pushPointToScribble();const f=o;let g,y,v,S;const w=0;for(let T=0,E=f.length;T<E;T++){if(g=f[T],r.isShapeOfType(g,"group")||u.has(g.id)||r.isShapeOrAncestorLocked(g)||(y=r.getShapeGeometry(g),r.isShapeOfType(g,"frame")&&y.bounds.containsPoint(r.getPointInShapeSpace(g,i))))continue;const M=r.getShapePageTransform(g);if(!y||!M)continue;const A=M.clone().invert();v=A.applyToPoint(a),S=A.applyToPoint(c);const{bounds:R}=y;if(!(R.minX-w>Math.max(v.x,S.x)||R.minY-w>Math.max(v.y,S.y)||R.maxX+w<Math.min(v.x,S.x)||R.maxY+w<Math.min(v.y,S.y))&&y.hitTestLineSegment(v,S,w)){const L=this.editor.getOutermostSelectableShape(g),K=this.editor.getShapeMask(L.id);if(K&&v1(a,c,K)!==null&&!no(c,K))continue;u.add(L.id)}}const b=r.getSelectedShapeIds(),_=new Set(s?[...u,...h]:[...u]);(b.length!==_.size||b.some(T=>!_.has(T)))&&this.editor.setSelectedShapes(Array.from(_))}complete(){this.updateScribbleSelection(!0),this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds]),this.parent.transition("idle")}}j(CN,"id","scribble_brushing");var Xne=Object.create,IN=Object.defineProperty,Zne=Object.getOwnPropertyDescriptor,Qne=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),EN=n=>{throw TypeError(n)},kN=(n,e,t)=>e in n?IN(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,Jne=n=>[,,,Xne(null)],TN=["class","method","getter","setter","accessor","field","value","get","set"],MN=n=>n!==void 0&&typeof n!="function"?EN("Function expected"):n,ere=(n,e,t,r,o)=>({kind:TN[n],name:e,metadata:r,addInitializer:s=>t._?EN("Already initialized"):o.push(MN(s||null))}),tre=(n,e)=>kN(e,Qne("metadata"),n[3]),nre=(n,e,t,r)=>{for(var o=0,s=n[e>>1],i=s&&s.length;o<i;o++)s[o].call(t);return r},rre=(n,e,t,r,o,s)=>{for(var i,a,c,u,h=e&7,f=!!(e&8),g=!!(e&16),y=2,v=TN[h+5],S=n[y]||(n[y]=[]),w=(o=o.prototype,Zne(o,t)),b=r.length-1;b>=0;b--)c=ere(h,t,a={},n[3],S),c.static=f,c.private=g,u=c.access={has:_=>t in _},u.get=_=>_[t],i=(0,r[b])(w[v],c),a._=1,MN(i)&&(w[v]=i);return w&&IN(o,t,w),o},Cx=(n,e,t)=>kN(n,typeof e!="symbol"?e+"":e,t),AN,Rm;const ore=20,sre=100;AN=[Or];class k_{constructor(e){this.editor=e,nre(Rm,5,this),Cx(this,"prevDroppingShapeId",null),Cx(this,"droppingNodeTimer",null),Cx(this,"first",!0),e.disposables.add(this.dispose)}updateDroppingNode(e,t){var r;this.first&&(this.editor.setHintingShapes(e.map(o=>this.editor.findShapeAncestor(o,s=>s.type!=="group")).filter(o=>o)),this.prevDroppingShapeId=((r=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e))==null?void 0:r.id)??null,this.first=!1),this.droppingNodeTimer===null?this.setDragTimer(e,ore,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearTimeout(this.droppingNodeTimer),this.setDragTimer(e,sre,t))}setDragTimer(e,t,r){this.droppingNodeTimer=this.editor.timers.setTimeout(()=>{this.editor.run(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,r)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,r){var c,u,h,f,g;t=Ze(t.map(y=>this.editor.getShape(y.id)));const o=((c=this.editor.getDroppingOverShape(e,t))==null?void 0:c.id)??null;if(o===this.prevDroppingShapeId){this.hintParents(t);return}const{prevDroppingShapeId:s}=this,i=s&&this.editor.getShape(s),a=o&&this.editor.getShape(o);i&&((h=(u=this.editor.getShapeUtil(i)).onDragShapesOut)==null||h.call(u,i,t)),a&&((g=(f=this.editor.getShapeUtil(a)).onDragShapesOver)==null||g.call(f,a,t)),this.hintParents(t),r==null||r(),this.prevDroppingShapeId=o}hintParents(e){const t=new Map;for(const o of e){const s=this.editor.findShapeAncestor(o,i=>i.type!=="group");s&&(t.has(s.id)||t.set(s.id,[]),t.get(s.id).push(o.id))}const r=[];for(const[o,s]of t){const i=this.editor.getShape(o);i&&k5(this.editor,i).length<s.length&&r.push(i.id)}this.editor.setHintingShapes(r)}dropShapes(e){var r,o;const{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){const s=this.editor.getShape(t);if(!s)return;(o=(r=this.editor.getShapeUtil(s)).onDropShapesOver)==null||o.call(r,s,e)}}clear(){this.prevDroppingShapeId=null,this.droppingNodeTimer!==null&&clearTimeout(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose(){this.clear()}}Rm=Jne();rre(Rm,1,"dispose",AN,k_);tre(Rm,k_);var ire=Object.create,jN=Object.defineProperty,are=Object.getOwnPropertyDescriptor,RN=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),ON=n=>{throw TypeError(n)},DN=(n,e,t)=>e in n?jN(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,lre=n=>[,,,ire((n==null?void 0:n[RN("metadata")])??null)],LN=["class","method","getter","setter","accessor","field","value","get","set"],FN=n=>n!==void 0&&typeof n!="function"?ON("Function expected"):n,cre=(n,e,t,r,o)=>({kind:LN[n],name:e,metadata:r,addInitializer:s=>t._?ON("Already initialized"):o.push(FN(s||null))}),ure=(n,e)=>DN(e,RN("metadata"),n[3]),dre=(n,e,t,r)=>{for(var o=0,s=n[e>>1],i=s&&s.length;o<i;o++)s[o].call(t);return r},hre=(n,e,t,r,o,s)=>{for(var i,a,c,u,h=e&7,f=!!(e&8),g=!!(e&16),y=2,v=LN[h+5],S=n[y]||(n[y]=[]),w=(o=o.prototype,are(o,t)),b=r.length-1;b>=0;b--)c=cre(h,t,a={},n[3],S),c.static=f,c.private=g,u=c.access={has:_=>t in _},u.get=_=>_[t],i=(0,r[b])(w[v],c),a._=1,FN(i)&&(w[v]=i);return w&&jN(o,t,w),o},ra=(n,e,t)=>DN(n,typeof e!="symbol"?e+"":e,t),NN,rb,Om;class Dm extends(rb=Re,NN=[Or],rb){constructor(){super(...arguments),dre(Om,5,this),ra(this,"info",{}),ra(this,"selectionSnapshot",{}),ra(this,"snapshot",{}),ra(this,"markId",""),ra(this,"isCloning",!1),ra(this,"isCreating",!1),ra(this,"dragAndDropManager",new k_(this.editor))}onCreate(e){}onEnter(e){var s;const{isCreating:t=!1,creatingMarkId:r,onCreate:o=()=>{}}=e;if(!((s=this.editor.getSelectedShapeIds())!=null&&s.length)){this.parent.transition("idle");return}if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=t,this.markId="",t)if(r)this.markId=r;else{const i=this.editor.getMarkIdMatching(`creating:${this.editor.getOnlySelectedShapeId()}`);i&&(this.markId=i)}else this.markId=this.editor.markHistoryStoppingPoint("translating");if(this.onCreate=o,this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=fM(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.setCursor({type:"default",rotation:0}),this.dragAndDropManager.clear()}onTick({elapsed:e}){const{editor:t}=this;this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),t.edgeScrollManager.updateEdgeScrolling(e)}onPointerMove(){this.updateShapes()}onKeyDown(){if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()}onKeyUp(){if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()}onPointerUp(){this.complete()}onComplete(){this.complete()}onCancel(){this.cancel()}startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate cloning"),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=fM(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId=this.editor.markHistoryStoppingPoint("translate"),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){var e;this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),Rt(this.editor,this.snapshot.movingShapes.map(t=>t.id)),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?(e=this.onCreate)==null||e.call(this,this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){const{movingShapes:e}=this.snapshot,t=[];e.forEach(r=>{var i;const o=this.editor.getShapeUtil(r),s=(i=o.onTranslateStart)==null?void 0:i.call(o,r);s&&t.push(s)}),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){const{movingShapes:e}=this.snapshot;if(this.isCloning&&e.length>0){const r=P.Average(e.map(s=>this.editor.getShapePageTransform(s.id).point())),o=P.Sub(r,this.selectionSnapshot.averagePagePoint);P.IsNaN(o)||this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(s=>s.id),offset:{x:o.x,y:o.y}}})}const t=[];e.forEach(r=>{var a;const o=this.editor.getShape(r.id),s=this.editor.getShapeUtil(r),i=(a=s.onTranslateEnd)==null?void 0:a.call(s,r,o);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){const{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),pre({editor:this.editor,snapshot:e});const{movingShapes:t}=e,r=[];t.forEach(o=>{var c;const s=this.editor.getShape(o.id),i=this.editor.getShapeUtil(o),a=(c=i.onTranslate)==null?void 0:c.call(i,o,s);a&&r.push(a)}),r.length>0&&this.editor.updateShapes(r)}updateParentTransforms(){const{editor:e,snapshot:{shapeSnapshots:t}}=this;t.forEach(r=>{const o=e.getShape(r.shape.id);if(!o)return null;const s=Ir(o.parentId)?null:ye.Inverse(e.getShapePageTransform(o.parentId));r.parentTransform=s})}}Om=lre(rb);hre(Om,1,"updateParentTransforms",NN,Dm);ure(Om,Dm);ra(Dm,"id","translating");function fM(n){var f;const e=[],t=[],r=n.getSelectedShapeIds(),o=Ze(r.map(g=>{const y=n.getShape(g);if(!y)return null;e.push(y);const v=n.getShapePageTransform(g),S=v.point(),w=v.rotation();t.push(S);const b=so.isId(y.parentId)?null:ye.Inverse(n.getShapePageTransform(y.parentId));return{shape:y,pagePoint:S,pageRotation:w,parentTransform:b}})),s=n.getOnlySelectedShape();let i=[];if(s)i=n.snaps.shapeBounds.getSnapPoints(s.id);else{const g=n.getSelectionPageBounds();g&&(i=g.cornersAndCenter.map((y,v)=>({id:"selection:"+v,x:y.x,y:y.y})))}let a,c;const{originPagePoint:u}=n.inputs,h=o.filter(g=>n.isShapeOfType(g.shape,"note")&&n.isPointInShape(g.shape,u));if(h.length!==0)if(h.length===1)c=h[0];else{const g=n.getCurrentPageShapesSorted();c=(f=h.map(y=>({snapshot:y,index:g.findIndex(v=>v.id===y.shape.id)})).sort((y,v)=>v.index-y.index)[0])==null?void 0:f.snapshot}return c&&(a=jF(n,c.pageRotation,c.shape.props.scale,c.shape.props.growY??0)),{averagePagePoint:P.Average(t),movingShapes:e,shapeSnapshots:o,initialPageBounds:n.getSelectionPageBounds(),initialSnapPoints:i,noteAdjacentPositions:a,noteSnapshot:c}}function pre({editor:n,snapshot:e}){const{inputs:t}=n,{noteSnapshot:r,noteAdjacentPositions:o,initialPageBounds:s,initialSnapPoints:i,shapeSnapshots:a,averagePagePoint:c}=e,u=n.getInstanceState().isGridMode,h=n.getDocumentSettings().gridSize,f=P.Sub(t.currentPagePoint,t.originPagePoint),g=n.inputs.shiftKey?Math.abs(f.x)<Math.abs(f.y)?"x":"y":null;g==="x"?f.x=0:g==="y"&&(f.y=0),n.snaps.clearIndicators();const y=n.user.getIsSnapMode()?!t.ctrlKey:t.ctrlKey;let v=!1;if(y&&n.inputs.pointerVelocity.len()<.5){const{nudge:_}=n.snaps.shapeBounds.snapTranslateShapes({dragDelta:f,initialSelectionPageBounds:s,lockedAxis:g,initialSelectionSnapPoints:i});f.add(_)}else if(r&&o){const{scale:_}=r.shape.props,T=r.pagePoint.clone().add(f).add(km.clone().mul(_).rot(r.pageRotation));let E=MF/n.getZoomLevel(),M=new P(0,0);for(const A of o){const R=P.Sub(T,A),L=R.len();L<E&&(v=!0,E=L,M=R)}f.sub(M)}const S=P.Add(c,f),w=n.snaps.getIndicators();u&&!t.ctrlKey&&!v&&w.length===0&&S.snapToGrid(h);const b=P.Sub(S,c);n.updateShapes(Ze(a.map(({shape:_,pagePoint:T,parentTransform:E})=>{const M=P.Add(T,b),A=E?ye.applyToPoint(E,M):M;return{id:_.id,type:_.type,x:A.x,y:A.y}})))}class Nf extends Re{constructor(){super(...arguments);j(this,"reactor")}static children(){return[nb,I_,Vne,vN,bN,Dm,lN,CN,E_,wN,cN,mN,_N,PN,xN,yN,SN,fN]}cleanUpDuplicateProps(){const t=this.editor.getSelectedShapeIds(),r=this.editor.getInstanceState();if(!r.duplicateProps)return;const o=new Set(r.duplicateProps.shapeIds);t.length===o.size&&t.every(s=>o.has(s))||this.editor.updateInstanceState({duplicateProps:null})}onEnter(){this.reactor=Ms("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(t){typeof process<"u",console.error(t)}})}onExit(){var t;(t=this.reactor)==null||t.call(this),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}}j(Nf,"id","select"),j(Nf,"initial","idle"),j(Nf,"isLockable",!1);class $N extends Re{constructor(){super(...arguments);j(this,"info",{})}onEnter(t){this.info=t}onPointerDown(){this.parent.transition("pointing",this.info)}}j($N,"id","idle");class zN extends Re{constructor(){super(...arguments);j(this,"info",{})}onEnter(t){this.info=t}onPointerUp(){this.complete()}onPointerMove(){this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)}onCancel(){this.cancel()}complete(){const{currentScreenPoint:t}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(t,{animation:{duration:220}}):this.editor.zoomIn(t,{animation:{duration:220}}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}}j(zN,"id","pointing");class BN extends Re{constructor(){super(...arguments);j(this,"info",{});j(this,"zoomBrush",new xe)}onEnter(t){this.info=t,this.update()}onExit(){this.editor.updateInstanceState({zoomBrush:null})}onPointerMove(){this.update()}onPointerUp(){this.complete()}onCancel(){this.cancel()}update(){const{inputs:{originPagePoint:t,currentPagePoint:r}}=this.editor;this.zoomBrush.setTo(xe.FromPoints([t,r])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){const{zoomBrush:t}=this,r=8/this.editor.getZoomLevel();if(t.width<r&&t.height<r){const o=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(o,{animation:{duration:220}}):this.editor.zoomIn(o,{animation:{duration:220}})}else{const o=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(t,{targetZoom:o,animation:{duration:220}})}this.parent.transition("idle",this.info)}}j(BN,"id","zoom_brushing");class $f extends Re{constructor(){super(...arguments);j(this,"info",{})}static children(){return[$N,BN,zN]}onEnter(t){this.info=t,this.parent.setCurrentToolIdMask(t.onInteractionEnd),this.updateCursor()}onExit(){this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}}),this.parent.setCurrentToolIdMask(void 0)}onKeyDown(){this.updateCursor()}onKeyUp(t){this.updateCursor(),t.code==="KeyZ"&&this.complete()}onInterrupt(){this.complete()}complete(){this.info.onInteractionEnd&&this.info.onInteractionEnd!=="select"?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.setCursor({type:"zoom-out",rotation:0}):this.editor.setCursor({type:"zoom-in",rotation:0})}}j($f,"id","zoom"),j($f,"initial","idle"),j($f,"isLockable",!1);const fre=[Df,Lf,Ff,$f,Nf];function gre(){const n=te(),e=re("follow",()=>n.getInstanceState().followingUserId,[n]);return e?p.jsx(mre,{userId:e}):null}function mre({userId:n}){const e=Vg(n);return e?p.jsx("div",{className:"tlui-following-indicator",style:{borderColor:e.color}}):null}let ob={fonts:{draw:`${ua()}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`${ua()}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`${ua()}/fonts/IBMPlexSans-Medium.woff2`,monospace:`${ua()}/fonts/IBMPlexMono-Medium.woff2`}};function UN(n){return C.useMemo(()=>n?{fonts:{...ob.fonts,...n==null?void 0:n.fonts}}:ob,[n])}const yre=["align-bottom","align-center-horizontal","align-center-vertical","align-left","align-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","blob","bring-forward","bring-to-front","broken","check-circle","check","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","color","cross-2","cross-circle","dash-dashed","dash-dotted","dash-draw","dash-solid","disconnected","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","fill-fill","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-heart","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","horizontal-align-end","horizontal-align-middle","horizontal-align-start","info-circle","leading","link","lock","menu","minus","mixed","pack","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","send-backward","send-to-back","share-1","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","stretch-horizontal","stretch-vertical","text-align-center","text-align-left","text-align-right","toggle-off","toggle-on","tool-arrow","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-screenshot","tool-text","trash","twitter","undo","ungroup","unlock","vertical-align-end","vertical-align-middle","vertical-align-start","warning-triangle","zoom-in","zoom-out"];let od={...ob,icons:Object.fromEntries(yre.map(n=>[n,`${ua()}/icons/icon/0_merged.svg#${n}`])),translations:Object.fromEntries(Dd.map(n=>[n.locale,`${ua()}/translations/${n.locale}.json`])),embedIcons:Object.fromEntries(l_.map(n=>[n.type,`${ua()}/embed-icons/${n.type}.png`]))};function vre(n){return n?{fonts:Object.assign({...od.fonts},{...n==null?void 0:n.fonts}),icons:Object.assign({...od.icons},{...n==null?void 0:n.icons}),embedIcons:Object.assign({...od.embedIcons},{...n==null?void 0:n.embedIcons}),translations:Object.assign({...od.translations},{...n==null?void 0:n.translations})}:od}var T_="Popover",[HN,Ple]=Ks(T_,[dm]),fh=dm(),[Sre,Aa]=HN(T_),KN=n=>{const{__scopePopover:e,children:t,open:r,defaultOpen:o,onOpenChange:s,modal:i=!1}=n,a=fh(e),c=C.useRef(null),[u,h]=C.useState(!1),[f=!1,g]=Ta({prop:r,defaultProp:o,onChange:s});return p.jsx($1,{...a,children:p.jsx(Sre,{scope:e,contentId:vi(),triggerRef:c,open:f,onOpenChange:g,onOpenToggle:C.useCallback(()=>g(y=>!y),[g]),hasCustomAnchor:u,onCustomAnchorAdd:C.useCallback(()=>h(!0),[]),onCustomAnchorRemove:C.useCallback(()=>h(!1),[]),modal:i,children:t})})};KN.displayName=T_;var WN="PopoverAnchor",xre=C.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,o=Aa(WN,t),s=fh(t),{onCustomAnchorAdd:i,onCustomAnchorRemove:a}=o;return C.useEffect(()=>(i(),()=>a()),[i,a]),p.jsx(z1,{...s,...r,ref:e})});xre.displayName=WN;var VN="PopoverTrigger",GN=C.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,o=Aa(VN,t),s=fh(t),i=Lt(e,o.triggerRef),a=p.jsx(dt.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":QN(o.open),...r,ref:i,onClick:Ae(n.onClick,o.onOpenToggle)});return o.hasCustomAnchor?a:p.jsx(z1,{asChild:!0,...s,children:a})});GN.displayName=VN;var M_="PopoverPortal",[wre,bre]=HN(M_,{forceMount:void 0}),qN=n=>{const{__scopePopover:e,forceMount:t,children:r,container:o}=n,s=Aa(M_,e);return p.jsx(wre,{scope:e,forceMount:t,children:p.jsx(ss,{present:t||s.open,children:p.jsx(ch,{asChild:!0,container:o,children:r})})})};qN.displayName=M_;var qc="PopoverContent",YN=C.forwardRef((n,e)=>{const t=bre(qc,n.__scopePopover),{forceMount:r=t.forceMount,...o}=n,s=Aa(qc,n.__scopePopover);return p.jsx(ss,{present:r||s.open,children:s.modal?p.jsx(_re,{...o,ref:e}):p.jsx(Pre,{...o,ref:e})})});YN.displayName=qc;var _re=C.forwardRef((n,e)=>{const t=Aa(qc,n.__scopePopover),r=C.useRef(null),o=Lt(e,r),s=C.useRef(!1);return C.useEffect(()=>{const i=r.current;if(i)return B1(i)},[]),p.jsx(fm,{as:ml,allowPinchZoom:!0,children:p.jsx(XN,{...n,ref:o,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Ae(n.onCloseAutoFocus,i=>{var a;i.preventDefault(),s.current||(a=t.triggerRef.current)==null||a.focus()}),onPointerDownOutside:Ae(n.onPointerDownOutside,i=>{const a=i.detail.originalEvent,c=a.button===0&&a.ctrlKey===!0,u=a.button===2||c;s.current=u},{checkForDefaultPrevented:!1}),onFocusOutside:Ae(n.onFocusOutside,i=>i.preventDefault(),{checkForDefaultPrevented:!1})})})}),Pre=C.forwardRef((n,e)=>{const t=Aa(qc,n.__scopePopover),r=C.useRef(!1),o=C.useRef(!1);return p.jsx(XN,{...n,ref:e,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{var i,a;(i=n.onCloseAutoFocus)==null||i.call(n,s),s.defaultPrevented||(r.current||(a=t.triggerRef.current)==null||a.focus(),s.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:s=>{var c,u;(c=n.onInteractOutside)==null||c.call(n,s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const i=s.target;((u=t.triggerRef.current)==null?void 0:u.contains(i))&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&o.current&&s.preventDefault()}})}),XN=C.forwardRef((n,e)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:s,disableOutsidePointerEvents:i,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:u,onInteractOutside:h,...f}=n,g=Aa(qc,t),y=fh(t);return L1(),p.jsx(um,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:s,children:p.jsx(lh,{asChild:!0,disableOutsidePointerEvents:i,onInteractOutside:h,onEscapeKeyDown:a,onPointerDownOutside:c,onFocusOutside:u,onDismiss:()=>g.onOpenChange(!1),children:p.jsx(rL,{"data-state":QN(g.open),role:"dialog",id:g.contentId,...y,...f,ref:e,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),ZN="PopoverClose",Cre=C.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,o=Aa(ZN,t);return p.jsx(dt.button,{type:"button",...r,ref:e,onClick:Ae(n.onClick,()=>o.onOpenChange(!1))})});Cre.displayName=ZN;var Ire="PopoverArrow",Ere=C.forwardRef((n,e)=>{const{__scopePopover:t,...r}=n,o=fh(t);return p.jsx(oL,{...o,...r,ref:e})});Ere.displayName=Ire;function QN(n){return n?"open":"closed"}var A_=KN,j_=GN,R_=qN,O_=YN;function D_({id:n,children:e,onOpenChange:t,open:r}){const[o,s]=Ti(n,t);return p.jsx(A_,{onOpenChange:s,open:r||o,children:p.jsx("div",{className:"tlui-popover",children:e})})}function L_({children:n}){return p.jsx(j_,{asChild:!0,dir:"ltr",children:n})}function F_({side:n,children:e,align:t="center",sideOffset:r=8,alignOffset:o=0,disableEscapeKeyDown:s=!1}){const i=fn();return p.jsx(R_,{container:i,children:p.jsx(O_,{className:"tlui-popover__content",side:n,sideOffset:r,align:t,alignOffset:o,dir:"ltr",onEscapeKeyDown:a=>s&&a.preventDefault(),children:e})})}function kre(n){return n.getSelectedShapeIds().map(r=>n.getShape(r)).filter(r=>{if(!r)return!1;if(n.isShapeOfType(r,"arrow")){const o=jr(n,r);if(o.start||o.end)return!1}return!0})}const JN=()=>{const n=te();return re("threeStackableItems",()=>kre(n).length>2,[n])},Mi=()=>{const n=te();return re("isInSelectState",()=>n.isIn("select"),[n])},e4=()=>{const n=te();return re("allow group",()=>{const e=n.getSelectedShapes();if(e.length<2)return!1;for(const t of e)if(n.isShapeOfType(t,"arrow")){const r=jr(n,t);if(r.start&&!e.some(o=>o.id===r.start.toId)||r.end&&!e.some(o=>o.id===r.end.toId))return!1}return!0},[n])},t4=()=>{const n=te();return re("allowUngroup",()=>n.getSelectedShapeIds().some(e=>{var t;return((t=n.getShape(e))==null?void 0:t.type)==="group"}),[n])},Tre=typeof window<"u"&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function n4(n,e){const t=te();return re("selectedShapes",()=>t.getSelectedShapes().length>=n,[t,n,e])}function pr(n,e){const t=te();return re("selectedShapes",()=>{const r=t.getSelectedShapes().filter(o=>!t.isShapeOrAncestorLocked(o)).length;return n===void 0?r:r>=n},[t])}function Mre(){const n=te();return re("showAutoSizeToggle",()=>{const e=n.getSelectedShapes();return e.length===1&&n.isShapeOfType(e[0],"text")&&e[0].props.autoSize===!1},[n])}function r4(){const n=te();return re("hasLinkShapeSelected",()=>{const e=n.getOnlySelectedShape();return!!(e&&e.type!=="embed"&&"url"in e.props&&!e.isLocked)},[n])}function Are(){const n=te();return re("onlyFlippableShape",()=>{const e=n.getOnlySelectedShape();return e&&(n.isShapeOfType(e,"group")||n.isShapeOfType(e,"image")||n.isShapeOfType(e,"arrow")||n.isShapeOfType(e,"line")||n.isShapeOfType(e,"draw"))},[n])}function o4(){const n=te();return re("useCanRedo",()=>n.getCanRedo(),[n])}function s4(){const n=te();return re("useCanUndo",()=>n.getCanUndo(),[n])}function jre(){return p.jsxs(p.Fragment,{children:[p.jsx(Rre,{}),p.jsx(Ore,{}),p.jsx(Dre,{}),p.jsx(Lre,{}),p.jsx(Fre,{}),p.jsx(zre,{}),p.jsx(Bre,{}),p.jsx(Ure,{})]})}function Rre(){const n=pr(2),e=Mi(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(le,{actionId:"align-left",disabled:!t}),p.jsx(le,{actionId:"align-center-horizontal",disabled:!t}),p.jsx(le,{actionId:"align-right",disabled:!t}),p.jsx(le,{actionId:"stretch-horizontal",disabled:!t}),p.jsx(le,{actionId:"align-top",disabled:!t}),p.jsx(le,{actionId:"align-center-vertical",disabled:!t}),p.jsx(le,{actionId:"align-bottom",disabled:!t}),p.jsx(le,{actionId:"stretch-vertical",disabled:!t})]})}function Ore(){const n=pr(3),e=Mi(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(le,{actionId:"distribute-horizontal",disabled:!t}),p.jsx(le,{actionId:"distribute-vertical",disabled:!t})]})}function Dre(){const n=JN(),e=Mi(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(le,{actionId:"stack-horizontal",disabled:!t}),p.jsx(le,{actionId:"stack-vertical",disabled:!t})]})}function Lre(){const n=pr(1),e=Mi(),t=n&&e;return p.jsxs(p.Fragment,{children:[p.jsx(le,{actionId:"send-to-back",disabled:!t}),p.jsx(le,{actionId:"send-backward",disabled:!t}),p.jsx(le,{actionId:"bring-forward",disabled:!t}),p.jsx(le,{actionId:"bring-to-front",disabled:!t})]})}function Fre(){return hr()<en.TABLET_SM?p.jsx(Nre,{}):p.jsx($re,{})}function Nre(){const n=te(),e=re("zoom is 1",()=>n.getZoomLevel()===1,[n]);return p.jsx(le,{actionId:"zoom-to-100",disabled:e})}function $re(){const n=pr(1),e=Mi(),t=n&&e;return p.jsx(le,{actionId:"rotate-ccw",disabled:!t})}function zre(){const n=pr(1),e=Mi(),t=n&&e;return p.jsx(le,{actionId:"rotate-cw",disabled:!t})}function Bre(){const n=r4(),e=Mi(),t=n&&e;return p.jsx(le,{actionId:"edit-link",disabled:!t})}function Ure(){const n=e4(),e=t4();return n?p.jsx(gM,{}):e?p.jsx(Hre,{}):p.jsx(gM,{})}function gM(){const n=pr(2),e=Mi(),t=n&&e;return p.jsx(le,{actionId:"group",disabled:!t})}function Hre(){return p.jsx(le,{actionId:"ungroup"})}const Kre=C.memo(function({children:e}){const t=lt(),r=hr(),o=ao(),s=C.useRef(null);ka(s);const i=te(),a=re("should display quick actions when in readonly",()=>i.isInAny("hand","zoom"),[i]),c=e??p.jsx(jre,{});if(!(o&&!a))return p.jsxs(D_,{id:"actions-menu",children:[p.jsx(L_,{children:p.jsx($e,{type:"icon","data-testid":"actions-menu.button",title:t("actions-menu.title"),children:p.jsx(rt,{icon:"dots-vertical",small:!0})})}),p.jsx(F_,{side:r>=en.TABLET?"bottom":"top",sideOffset:6,children:p.jsx("div",{ref:s,className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:p.jsx(Mo,{type:"icons",sourceId:"actions-menu",children:c})})})]})});function i4(){return Mre()?p.jsx(le,{actionId:"toggle-auto-size"}):null}function a4(){return r4()?p.jsx(le,{actionId:"edit-link"}):null}function Wre(){return pr(1)?p.jsx(le,{actionId:"duplicate"}):null}function l4(){const n=te();return re("should display flatten option",()=>{if(n.getSelectedShapeIds().length===0)return!1;const r=n.getOnlySelectedShape();return!(r&&n.isShapeOfType(r,"image"))},[n])?p.jsx(le,{actionId:"flatten-to-image"}):null}function c4(){return e4()?p.jsx(le,{actionId:"group"}):null}function u4(){return t4()?p.jsx(le,{actionId:"ungroup"}):null}function d4(){const n=te();return re("allow unframe",()=>{const t=n.getSelectedShapes();return t.length===0?!1:t.every(r=>n.isShapeOfType(r,"frame"))},[n])?p.jsx(le,{actionId:"remove-frame"}):null}function h4(){const n=te();return re("allow fit frame to content",()=>{const t=n.getOnlySelectedShape();return t?n.isShapeOfType(t,"frame")&&n.getSortedChildIdsForParent(t).length>0:!1},[n])?p.jsx(le,{actionId:"fit-frame-to-content"}):null}function p4(){const n=te();return re("selected shapes",()=>n.getSelectedShapes().length>0,[n])?p.jsx(le,{actionId:"toggle-lock"}):null}function N_(){const n=te(),e=re("isTransparentBg",()=>!n.getInstanceState().exportBackground,[n]);return p.jsx(as,{actionId:"toggle-transparent",checked:e,toggle:!0})}function Vre(){const n=te(),e=re("any shapes",()=>n.getCurrentPageShapeIds().size>0,[n]);return p.jsx(le,{actionId:"unlock-all",disabled:!e})}function f4(){const n=te(),e=re("zoomed to 100",()=>n.getZoomLevel()===1,[n]);return p.jsx(le,{actionId:"zoom-to-100",noClose:!0,disabled:e})}function g4(){const n=te(),e=re("has shapes",()=>n.getCurrentPageShapeIds().size>0,[n]);return p.jsx(le,{actionId:"zoom-to-fit",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function m4(){const n=te(),e=re("has shapes",()=>n.getSelectedShapeIds().length>0,[n]);return p.jsx(le,{actionId:"zoom-to-selection",disabled:!e,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function y4(){return p.jsxs(Je,{id:"clipboard",children:[p.jsx(qre,{}),p.jsx(Yre,{}),p.jsx(Xre,{}),p.jsx(Wre,{}),p.jsx(Zre,{})]})}function Gre(){var t;const n=te(),e=re("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n]);return p.jsxs(zr,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!e,children:[p.jsxs(Je,{id:"copy-as-group",children:[p.jsx(le,{actionId:"copy-as-svg"}),!!((t=window.navigator.clipboard)!=null&&t.write)&&p.jsx(le,{actionId:"copy-as-png"}),p.jsx(le,{actionId:"copy-as-json"})]}),p.jsx(Je,{id:"copy-as-bg",children:p.jsx(N_,{})})]})}function qre(){const n=pr(1);return p.jsx(le,{actionId:"cut",disabled:!n})}function Yre(){const n=n4(1);return p.jsx(le,{actionId:"copy",disabled:!n})}function Xre(){const n=Tre;return p.jsx(le,{actionId:"paste",disabled:!n})}function v4(){const n=te();return re("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n])?p.jsxs(Je,{id:"conversions",children:[p.jsx(Gre,{}),p.jsxs(zr,{id:"export-as",label:"context-menu.export-as",size:"small",children:[p.jsxs(Je,{id:"export-as-group",children:[p.jsx(le,{actionId:"export-as-svg"}),p.jsx(le,{actionId:"export-as-png"}),p.jsx(le,{actionId:"export-as-json"})]}),p.jsx(Je,{id:"export-as-bg",children:p.jsx(N_,{})})]})]}):null}function S4(){const n=te(),e=re("atLeastOneShapeOnPage",()=>n.getCurrentPageShapeIds().size>0,[n]);return p.jsx(le,{actionId:"select-all",disabled:!e})}function Zre(){const n=pr(1);return p.jsx(le,{actionId:"delete",disabled:!n})}function Qre(){const n=ao();return!n4(1)||n?null:p.jsxs(zr,{id:"edit",label:"context-menu.edit",size:"small",children:[p.jsx(c4,{}),p.jsx(u4,{}),p.jsx(l4,{}),p.jsx(a4,{}),p.jsx(h4,{}),p.jsx(d4,{}),p.jsx(w4,{}),p.jsx(x4,{}),p.jsx(i4,{}),p.jsx(p4,{})]})}function Jre(){const n=pr(2),e=Are();return ao()||!(n||e)?null:p.jsxs(zr,{id:"arrange",label:"context-menu.arrange",size:"small",children:[n&&p.jsxs(Je,{id:"align",children:[p.jsx(le,{actionId:"align-left"}),p.jsx(le,{actionId:"align-center-horizontal"}),p.jsx(le,{actionId:"align-right"}),p.jsx(le,{actionId:"align-top"}),p.jsx(le,{actionId:"align-center-vertical"}),p.jsx(le,{actionId:"align-bottom"})]}),p.jsx(eoe,{}),n&&p.jsxs(Je,{id:"stretch",children:[p.jsx(le,{actionId:"stretch-horizontal"}),p.jsx(le,{actionId:"stretch-vertical"})]}),(n||e)&&p.jsxs(Je,{id:"flip",children:[p.jsx(le,{actionId:"flip-horizontal"}),p.jsx(le,{actionId:"flip-vertical"})]}),p.jsx(toe,{})]})}function eoe(){return pr(3)?p.jsxs(Je,{id:"distribute",children:[p.jsx(le,{actionId:"distribute-horizontal"}),p.jsx(le,{actionId:"distribute-vertical"})]}):null}function toe(){const n=pr(2),e=JN();return n?p.jsxs(Je,{id:"order",children:[p.jsx(le,{actionId:"pack"}),e&&p.jsx(le,{actionId:"stack-horizontal"}),e&&p.jsx(le,{actionId:"stack-vertical"})]}):null}function noe(){const n=ao(),e=pr(1);return n||!e?null:p.jsx(zr,{id:"reorder",label:"context-menu.reorder",size:"small",children:p.jsxs(Je,{id:"reorder",children:[p.jsx(le,{actionId:"bring-to-front"}),p.jsx(le,{actionId:"bring-forward"}),p.jsx(le,{actionId:"send-backward"}),p.jsx(le,{actionId:"send-to-back"})]})})}function roe(){const n=te(),e=re("pages",()=>n.getPages(),[n]),t=re("current page id",()=>n.getCurrentPageId(),[n]),{addToast:r}=ki(),o=Ln(),s=ao();return!pr(1)||s?null:p.jsxs(zr,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[p.jsx(Je,{id:"pages",children:e.map(a=>p.jsx(kn,{id:a.id,disabled:t===a.id,label:a.name.length>30?`${a.name.slice(0,30)}…`:a.name,onSelect:()=>{n.markHistoryStoppingPoint("move_shapes_to_page"),n.moveShapesToPage(n.getSelectedShapeIds(),a.id);const c=n.getPage(a.id);c&&r({title:"Changed Page",description:`Moved to ${c.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{n.markHistoryStoppingPoint("change-page"),n.setCurrentPage(t)}}]}),o("move-to-page",{source:"context-menu"})}},a.id))}),p.jsx(Je,{id:"new-page",children:p.jsx(le,{actionId:"move-to-new-page"})})]})}function x4(){const n=te();return re("oneEmbedSelected",()=>{const t=n.getOnlySelectedShape();return t?!!(n.isShapeOfType(t,"embed")&&t.props.url&&!n.isShapeOrAncestorLocked(t)):!1},[n])?p.jsx(le,{actionId:"convert-to-bookmark"}):null}function w4(){const n=te(),e=c_();return re("oneEmbeddableBookmarkSelected",()=>{const r=n.getOnlySelectedShape();return r?!!(n.isShapeOfType(r,"bookmark")&&r.props.url&&e(r.props.url)&&!n.isShapeOrAncestorLocked(r)):!1},[n])?p.jsx(le,{actionId:"convert-to-embed"}):null}function ooe(){const n=te(),e=re("isSnapMode",()=>n.user.getIsSnapMode(),[n]);return p.jsx(as,{actionId:"toggle-snap-mode",checked:e})}function soe(){const n=te(),e=re("isToolLock",()=>n.getInstanceState().isToolLocked,[n]);return p.jsx(as,{actionId:"toggle-tool-lock",checked:e})}function ioe(){const n=te(),e=re("isGridMode",()=>n.getInstanceState().isGridMode,[n]);return p.jsx(as,{actionId:"toggle-grid",checked:e})}function aoe(){const n=te(),e=re("isWrapMode",()=>n.user.getIsWrapMode(),[n]);return p.jsx(as,{actionId:"toggle-wrap-mode",checked:e})}function loe(){const n=te(),e=re("isFocusMode",()=>n.getInstanceState().isFocusMode,[n]);return p.jsx(as,{actionId:"toggle-focus-mode",checked:e})}function coe(){const n=te(),e=re("edgeScrollSpeed",()=>n.user.getEdgeScrollSpeed(),[n]);return p.jsx(as,{actionId:"toggle-edge-scrolling",checked:e===1})}function uoe(){const n=te(),e=re("animationSpeed",()=>n.user.getAnimationSpeed(),[n]);return p.jsx(as,{actionId:"toggle-reduce-motion",checked:e===0})}function doe(){const n=te(),e=re("isDebugMode",()=>n.getInstanceState().isDebugMode,[n]);return p.jsx(as,{actionId:"toggle-debug-mode",checked:e})}function hoe(){const n=te(),e=re("dynamic resize",()=>n.user.getIsDynamicResizeMode(),[n]);return p.jsx(as,{actionId:"toggle-dynamic-size-mode",checked:e})}function poe(){const n=te(),e=re("paste at cursor",()=>n.user.getIsPasteAtCursorMode(),[n]);return p.jsx(as,{actionId:"toggle-paste-at-cursor",checked:e})}function foe(){const n=te();return re("show cursor chat",()=>n.getCurrentToolId()==="select"&&!n.getInstanceState().isCoarsePointer,[n])?p.jsx(le,{actionId:"open-cursor-chat"}):null}function goe(){const n=te(),e=bm(),t=re("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n]),r=re("isSinglePageMode",()=>n.options.maxPages<=1,[n]);return t?p.jsxs(p.Fragment,{children:[e&&p.jsx(foe,{}),p.jsxs(Je,{id:"modify",children:[p.jsx(Qre,{}),p.jsx(Jre,{}),p.jsx(noe,{}),!r&&p.jsx(roe,{})]}),p.jsx(y4,{}),p.jsx(v4,{}),p.jsx(Je,{id:"select-all",children:p.jsx(S4,{})})]}):null}const moe=C.memo(function({children:e,disabled:t=!1}){const r=te(),{Canvas:o}=Bt(),s=C.useCallback(h=>{if(h){if(r.getInstanceState().isCoarsePointer){const f=r.getSelectedShapes(),{inputs:{currentPagePoint:g}}=r,y=r.getShapesAtPoint(g);if(!r.getSelectedShapes().length||!y.some(v=>f.includes(v))){const v=y.filter(S=>r.isShapeOrAncestorLocked(S));v.length&&r.select(...v.map(S=>S.id))}}}else{const f=r.getOnlySelectedShape();f&&r.isShapeOrAncestorLocked(f)&&r.setSelectedShapes([])}},[r]),i=fn(),[a,c]=Ti("context menu",s),u=e??p.jsx(goe,{});return p.jsxs(sZ,{dir:"ltr",onOpenChange:c,modal:!1,children:[p.jsx(iZ,{onContextMenu:void 0,dir:"ltr",disabled:t,children:o?p.jsx(o,{}):null}),a&&p.jsx(aZ,{container:i,children:p.jsx(lZ,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:et,children:p.jsx(Mo,{type:"context-menu",sourceId:"context-menu",children:u})})})]})}),yoe=2e3,voe=5e3,Soe=On(function(){const e=te(),{isChatting:t,chatMessage:r}=e.getInstanceState(),o=C.useRef(-1),[s,i]=C.useState("");return C.useEffect(()=>{if(!t&&r||t){const c=t?voe:yoe;o.current=e.timers.setTimeout(()=>{e.updateInstanceState({chatMessage:"",isChatting:!1}),i(""),e.focus()},c)}return()=>{clearTimeout(o.current)}},[e,r,t]),t?p.jsx(woe,{value:s,setValue:i,chatMessage:r}):r.trim()?p.jsx(xoe,{chatMessage:r}):null});function b4(n){const e=te();C.useLayoutEffect(()=>{var i;if(!n.current)return;const{x:r,y:o}=e.inputs.currentScreenPoint;(i=n.current)==null||i.style.setProperty("transform",`translate(${r}px, ${o}px)`);function s(a){var h;const{minX:c,minY:u}=e.getViewportScreenBounds();(h=n.current)==null||h.style.setProperty("transform",`translate(${a.clientX-c}px, ${a.clientY-u}px)`)}return window.addEventListener("pointermove",s),()=>{window.removeEventListener("pointermove",s)}},[n,e])}const xoe=({chatMessage:n})=>{const e=te(),t=C.useRef(null);return b4(t),p.jsx("div",{ref:t,className:"tl-cursor-chat tl-cursor-chat__bubble",style:{backgroundColor:e.user.getColor()},children:n})},woe=On(function({chatMessage:e,value:t,setValue:r}){const o=te(),s=lt(),i=C.useRef(null),a=e||s("cursor-chat.type-to-chat");b4(i),C.useLayoutEffect(()=>{const g=i.current;if(!g)return;const y=o.textMeasure.measureText(t||a,{fontFamily:"var(--font-body)",fontSize:12,fontWeight:"500",fontStyle:"normal",maxWidth:null,lineHeight:1,padding:"6px"});g.style.setProperty("width",y.w+"px")},[o,t,a]),C.useLayoutEffect(()=>{const g=o.timers.requestAnimationFrame(()=>{var y;(y=i.current)==null||y.focus()});return()=>{cancelAnimationFrame(g)}},[o]);const c=C.useCallback(()=>{o.updateInstanceState({isChatting:!1}),o.focus()},[o]),u=C.useCallback(g=>{const{value:y}=g.target;r(y.slice(0,64)),o.updateInstanceState({chatMessage:y})},[o,r]),h=C.useCallback(g=>{const y=i.current;if(!y)return;const{value:v}=y;switch(g.key){case"Enter":{if(et(g),g.stopPropagation(),!v){c();return}r("");break}case"Escape":{et(g),g.stopPropagation(),c();break}}},[c,r]),f=C.useCallback(g=>{g.stopPropagation()},[]);return p.jsx("input",{ref:i,className:"tl-cursor-chat",style:{backgroundColor:o.user.getColor()},onBlur:c,onChange:u,onKeyDown:h,onPaste:f,value:t,placeholder:a,spellCheck:!1})});function sb({checked:n}){return p.jsx($s,{icon:n?"check":"none",className:"tlui-button__icon",small:!0})}function boe(){const n=te(),{addToast:e}=ki(),{addDialog:t}=ph(),[r,o]=at.useState(!1);return p.jsxs(p.Fragment,{children:[p.jsxs(Je,{id:"items",children:[p.jsx(kn,{id:"add-toast",onSelect:()=>{e({id:bt(),title:"Something good happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"success"}),e({id:bt(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"info",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:bt(),title:"Something maybe bad happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,severity:"warning",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),e({id:bt(),title:"Something bad happened",severity:"error",keepOpen:!0})},label:"Show toast"}),p.jsx(kn,{id:"show-dialog",label:"Show dialog",onSelect:()=>{t({component:({onClose:s})=>p.jsx(Coe,{displayDontShowAgain:!0,onCancel:()=>s(),onContinue:()=>s()}),onClose:()=>{}})}}),p.jsx(kn,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>Ioe(n,100)}),p.jsx(kn,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{var a;const s=n.getSelectedShapes(),i=s.length===0?n.getRenderingShapes():s;window.alert(`Shapes ${i.length}, DOM nodes:${(a=document.querySelector(".tl-shapes").querySelectorAll("*"))==null?void 0:a.length}`)}}),(()=>{if(r)throw Error("oh no!");return null})(),p.jsx(kn,{id:"throw-error",onSelect:()=>o(!0),label:"Throw error"}),p.jsx(kn,{id:"hard-reset",onSelect:pR,label:"Hard reset"})]}),p.jsxs(Je,{id:"flags",children:[p.jsx(_oe,{}),p.jsx(Poe,{})]})]})}function _oe(){const n=Object.values(sn);return n.length?p.jsx(zr,{id:"debug flags",label:"Debug Flags",children:p.jsx(Je,{id:"debug flags",children:n.map(e=>p.jsx(_4,{flag:e},e.name))})}):null}function Poe(){const n=Object.values(r7);return n.length?p.jsx(zr,{id:"feature flags",label:"Feature Flags",children:p.jsx(Je,{id:"feature flags",children:n.map(e=>p.jsx(_4,{flag:e},e.name))})}):null}function Coe({title:n="title",body:e="hello hello hello",cancel:t="Cancel",confirm:r="Continue",displayDontShowAgain:o=!1,onCancel:s,onContinue:i}){const[a,c]=at.useState(!1);return p.jsxs(p.Fragment,{children:[p.jsxs(vm,{children:[p.jsx(Sm,{children:n}),p.jsx(xm,{})]}),p.jsx($d,{style:{maxWidth:350},children:e}),p.jsxs(a_,{className:"tlui-dialog__footer__actions",children:[o&&p.jsxs($e,{type:"normal",onClick:()=>c(!a),style:{marginRight:"auto"},children:[p.jsx(sb,{checked:a}),p.jsx(an,{children:"Don’t show again"})]}),p.jsx($e,{type:"normal",onClick:s,children:p.jsx(an,{children:t})}),p.jsx($e,{type:"primary",onClick:async()=>i(),children:p.jsx(an,{children:r})})]})]})}const _4=On(function({flag:e,onChange:t}){const r=e.get();return p.jsx(Im,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,o=>`${o[0]} ${o[1].toLowerCase()}`).replace(/^[a-z]/,o=>o.toUpperCase()),checked:r,onSelect:()=>{e.set(!r),t==null||t(!r)}})});let mM=0;function Ioe(n,e){const t=Array(e),r=Math.floor(Math.sqrt(e));for(let o=0;o<e;o++)mM++,t[o]={id:Ct("box"+mM),type:"geo",x:o%r*132,y:Math.floor(o/r)*132};n.run(()=>{n.createShapes(t).setSelectedShapes(t.map(o=>o.id))})}function Eoe({children:n}){const e=n??p.jsx(boe,{});return p.jsxs(vl,{id:"debug",children:[p.jsx(Sl,{children:p.jsx($e,{type:"icon",title:"Debug menu",children:p.jsx(rt,{icon:"dots-horizontal"})})}),p.jsx(xl,{side:"top",align:"end",alignOffset:0,children:p.jsx(Mo,{type:"menu",sourceId:"debug-panel",children:e})})]})}const koe=C.memo(function(){const{DebugMenu:e}=ja(),t=C.useRef(null);return ka(t),p.jsxs("div",{ref:t,className:"tlui-debug-panel",children:[p.jsx(Moe,{}),p.jsx(Aoe,{}),e&&p.jsx(e,{})]})});function Toe(n=!0){const[e,t]=C.useState(0),r=te();C.useEffect(()=>{if(!n)return;const o=()=>t(s=>s+1);return r.on("tick",o),()=>{r.off("tick",o)}},[r,n])}const Moe=On(function(){Toe();const e=te(),t=e.getPath(),r=e.getHoveredShape(),o=e.getOnlySelectedShape(),s=t==="select.idle"||!t.includes("select.")?r:o,i=s&&t.includes("select.")?` / ${s.type||""}${"geo"in s.props?" / "+s.props.geo:""} / [${P.ToInt(e.getPointInShapeSpace(s,e.inputs.currentPagePoint))}]`:"",a=t.startsWith("select.")&&!t.includes(".idle")?` / [${P.ToInt(e.inputs.originPagePoint)}] → [${P.ToInt(e.inputs.currentPagePoint)}] = ${P.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return p.jsx("div",{className:"tlui-debug-panel__current-state",children:`${t}${i}${a}`})});function Aoe(){const n=te(),e=re("show_fps",()=>sn.showFps.get(),[sn]),t=C.useRef(null);return C.useEffect(()=>{if(!e)return;const r=250;let o=0,s=-1,i=performance.now(),a=0,c=0,u=!1;function h(){if(c++,a=performance.now()-i,a>r){const f=Math.round(c*(r/a)*(1e3/r));f>o&&(o=f);const g=o*.75;(f<g&&!u||f>=g&&u)&&(u=!u),t.current.innerHTML=`FPS ${f.toString()}`,t.current.className="tlui-debug-panel__fps"+(u?" tlui-debug-panel__fps__slow":""),a-=r,c=0,i=performance.now()}s=n.timers.requestAnimationFrame(h)}return h(),()=>{cancelAnimationFrame(s)}},[e,n]),e?p.jsx("div",{ref:t}):null}const joe=C.memo(function(){const e=hr(),t=C.useRef(null);ka(t);const{MainMenu:r,QuickActions:o,ActionsMenu:s,PageMenu:i}=ja(),a=te(),c=re("isSinglePageMode",()=>a.options.maxPages<=1,[a]),u=a.options.actionShortcutsLocation==="menu"?!0:a.options.actionShortcutsLocation==="toolbar"?!1:e>=en.TABLET;return!r&&!i&&!u?null:p.jsx("div",{ref:t,className:"tlui-menu-zone",children:p.jsxs("div",{className:"tlui-buttons__horizontal",children:[r&&p.jsx(r,{}),i&&!c&&p.jsx(i,{}),u?p.jsxs(p.Fragment,{children:[o&&p.jsx(o,{}),s&&p.jsx(s,{})]}):null]})})});function Roe(){const n=te(),e=kl(),[t,r]=C.useState(!1),o=C.useRef(!1);return ha("toggle showback to content",()=>{const s=o.current,i=n.getCurrentPageShapeIds();let a=!1;i.size&&(a=i.size===n.getCulledShapes().size),s!==a&&(r(a),o.current=a)},[n]),t?p.jsx(le,{actionId:"back-to-content",onSelect:()=>{e["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function Ooe(){const n=te();return re("is pen mode",()=>n.getInstanceState().isPenMode,[n])?p.jsx(le,{actionId:"exit-pen-mode"}):null}function Doe(){const n=te(),e=kl();return re("is following user",()=>!!n.getInstanceState().followingUserId,[n])?p.jsx(kn,{...e["stop-following"]}):null}function Loe(){return p.jsxs(p.Fragment,{children:[p.jsx(Ooe,{}),p.jsx(Roe,{}),p.jsx(Doe,{})]})}function Foe({children:n}){const e=n??p.jsx(Loe,{});return p.jsx("div",{className:"tlui-helper-buttons",children:p.jsx(Mo,{type:"helper-buttons",sourceId:"helper-buttons",children:e})})}function Noe(){const n=bm();return p.jsxs(p.Fragment,{children:[p.jsxs(Je,{label:"shortcuts-dialog.tools",id:"tools",children:[p.jsx(le,{actionId:"toggle-tool-lock"}),p.jsx(le,{actionId:"insert-media"}),p.jsx(Er,{toolId:"select"}),p.jsx(Er,{toolId:"draw"}),p.jsx(Er,{toolId:"eraser"}),p.jsx(Er,{toolId:"hand"}),p.jsx(Er,{toolId:"rectangle"}),p.jsx(Er,{toolId:"ellipse"}),p.jsx(Er,{toolId:"arrow"}),p.jsx(Er,{toolId:"line"}),p.jsx(Er,{toolId:"text"}),p.jsx(Er,{toolId:"frame"}),p.jsx(Er,{toolId:"note"}),p.jsx(Er,{toolId:"laser"}),p.jsx(kn,{id:"pointer-down",label:"tool.pointer-down",kbd:",",onSelect:()=>{}})]}),p.jsxs(Je,{label:"shortcuts-dialog.preferences",id:"preferences",children:[p.jsx(le,{actionId:"toggle-dark-mode"}),p.jsx(le,{actionId:"toggle-focus-mode"}),p.jsx(le,{actionId:"toggle-grid"})]}),p.jsxs(Je,{label:"shortcuts-dialog.edit",id:"edit",children:[p.jsx(le,{actionId:"undo"}),p.jsx(le,{actionId:"redo"}),p.jsx(le,{actionId:"cut"}),p.jsx(le,{actionId:"copy"}),p.jsx(le,{actionId:"paste"}),p.jsx(le,{actionId:"select-all"}),p.jsx(le,{actionId:"delete"}),p.jsx(le,{actionId:"duplicate"})]}),p.jsxs(Je,{label:"shortcuts-dialog.view",id:"view",children:[p.jsx(le,{actionId:"zoom-in"}),p.jsx(le,{actionId:"zoom-out"}),p.jsx(le,{actionId:"zoom-to-100"}),p.jsx(le,{actionId:"zoom-to-fit"}),p.jsx(le,{actionId:"zoom-to-selection"})]}),p.jsxs(Je,{label:"shortcuts-dialog.transform",id:"transform",children:[p.jsx(le,{actionId:"bring-to-front"}),p.jsx(le,{actionId:"bring-forward"}),p.jsx(le,{actionId:"send-backward"}),p.jsx(le,{actionId:"send-to-back"}),p.jsx(le,{actionId:"group"}),p.jsx(le,{actionId:"ungroup"}),p.jsx(le,{actionId:"flip-horizontal"}),p.jsx(le,{actionId:"flip-vertical"}),p.jsx(le,{actionId:"align-top"}),p.jsx(le,{actionId:"align-center-vertical"}),p.jsx(le,{actionId:"align-bottom"}),p.jsx(le,{actionId:"align-left"}),p.jsx(le,{actionId:"align-center-horizontal"}),p.jsx(le,{actionId:"align-right"})]}),n&&p.jsx(Je,{label:"shortcuts-dialog.collaboration",id:"collaboration",children:p.jsx(le,{actionId:"open-cursor-chat"})})]})}const $oe=C.memo(function({children:e}){const t=lt(),r=hr(),o=e??p.jsx(Noe,{});return p.jsxs(p.Fragment,{children:[p.jsxs(vm,{className:"tlui-shortcuts-dialog__header",children:[p.jsx(Sm,{children:t("shortcuts-dialog.title")}),p.jsx(xm,{})]}),p.jsx($d,{className:Fe("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":r<=en.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":r<=en.TABLET}),children:p.jsx(Mo,{type:"keyboard-shortcuts",sourceId:"kbd",children:o})}),p.jsx("div",{className:"tlui-dialog__scrim"})]})});function P4(){const n=Ia(),e=Ln(),t=re("locale",()=>n==null?void 0:n.user.getLocale(),[n]);return n?p.jsx(zr,{id:"help menu language",label:"menu.language",children:p.jsx(Je,{id:"languages",children:Dd.map(({locale:r,label:o})=>p.jsx(Im,{id:`language-${r}`,title:r,label:o,checked:r===t,readonlyOk:!0,onSelect:()=>{n.user.updateUserPreferences({locale:r}),e("change-language",{source:"menu",locale:r})}},r))})}):null}function zoe(){return p.jsxs(p.Fragment,{children:[p.jsx(P4,{}),p.jsx(C4,{})]})}function C4(){const{KeyboardShortcutsDialog:n}=ja(),{addDialog:e}=ph(),t=C.useCallback(()=>{n&&e({component:n})},[e,n]);return n?p.jsx(kn,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:t}):null}function Boe(){return p.jsxs(p.Fragment,{children:[p.jsx(Hoe,{}),p.jsx(Goe,{}),p.jsx(Uoe,{}),p.jsx(qoe,{}),p.jsx(Yoe,{})]})}function Uoe(){return p.jsxs(zr,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[p.jsxs(Je,{id:"export-all-as-group",children:[p.jsx(le,{actionId:"export-all-as-svg"}),p.jsx(le,{actionId:"export-all-as-png"}),p.jsx(le,{actionId:"export-all-as-json"})]}),p.jsx(Je,{id:"export-all-as-bg",children:p.jsx(N_,{})})]})}function Hoe(){const n=te(),e=re("isSelectToolActive",()=>n.getCurrentToolId()==="select",[n]);return p.jsxs(zr,{id:"edit",label:"menu.edit",disabled:!e,children:[p.jsx(Voe,{}),p.jsx(y4,{}),p.jsx(v4,{}),p.jsx(Koe,{}),p.jsx(Woe,{}),p.jsx(Je,{id:"select-all",children:p.jsx(S4,{})})]})}function Koe(){return p.jsxs(Je,{id:"misc",children:[p.jsx(c4,{}),p.jsx(u4,{}),p.jsx(a4,{}),p.jsx(i4,{}),p.jsx(d4,{}),p.jsx(h4,{}),p.jsx(w4,{}),p.jsx(x4,{}),p.jsx(l4,{})]})}function Woe(){return p.jsxs(Je,{id:"lock",children:[p.jsx(p4,{}),p.jsx(Vre,{})]})}function Voe(){const n=s4(),e=o4();return p.jsxs(Je,{id:"undo-redo",children:[p.jsx(le,{actionId:"undo",disabled:!n}),p.jsx(le,{actionId:"redo",disabled:!e})]})}function Goe(){return p.jsx(zr,{id:"view",label:"menu.view",children:p.jsxs(Je,{id:"view-actions",children:[p.jsx(le,{actionId:"zoom-in"}),p.jsx(le,{actionId:"zoom-out"}),p.jsx(f4,{}),p.jsx(g4,{}),p.jsx(m4,{})]})})}function qoe(){return p.jsxs(Je,{id:"extras",children:[p.jsx(le,{actionId:"insert-embed"}),p.jsx(le,{actionId:"insert-media"})]})}function Yoe(){return p.jsxs(Je,{id:"preferences",children:[p.jsxs(zr,{id:"preferences",label:"menu.preferences",children:[p.jsxs(Je,{id:"preferences-actions",children:[p.jsx(ooe,{}),p.jsx(soe,{}),p.jsx(ioe,{}),p.jsx(aoe,{}),p.jsx(loe,{}),p.jsx(coe,{}),p.jsx(uoe,{}),p.jsx(hoe,{}),p.jsx(poe,{}),p.jsx(doe,{})]}),p.jsx(Je,{id:"color-scheme",children:p.jsx(tee,{})})]}),p.jsx(P4,{}),p.jsx(C4,{})]})}const Xoe=C.memo(function({children:e}){const t=fn(),[r,o]=Ti("main menu"),s=lt(),i=e??p.jsx(Boe,{});return p.jsxs(J1,{dir:"ltr",open:r,onOpenChange:o,modal:!1,children:[p.jsx(e_,{asChild:!0,dir:"ltr",children:p.jsx($e,{type:"icon","data-testid":"main-menu.button",title:s("menu.title"),children:p.jsx(rt,{icon:"menu",small:!0})})}),p.jsx(ym,{container:t,children:p.jsx(t_,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:p.jsx(Mo,{type:"menu",sourceId:"main-menu",children:i})})})]})}),Ix={};function sd(n){if(Ix[n])return Ix[n];const t=document.createElement("canvas").getContext("2d");t.fillStyle=n,t.fillRect(0,0,1,1);const[r,o,s,i]=t.getImageData(0,0,1,1).data,a=new Float32Array([r/255,o/255,s/255,i/255]);return Ix[n]=a,a}const zf=10,I4=4*6*zf+12+4*12;function bc(n,{center:e,radius:t,numArcSegments:r=20,startAngle:o=0,endAngle:s=xt,offset:i=0}){const a=(s-o)/r;let c=i;for(let u=o;u<s;u+=a)n[c++]=e.x,n[c++]=e.y,n[c++]=e.x+Math.cos(u)*t,n[c++]=e.y+Math.sin(u)*t,n[c++]=e.x+Math.cos(u+a)*t,n[c++]=e.y+Math.sin(u+a)*t;return n}function _c(n,e,t,r,o,s){n[e++]=t,n[e++]=r,n[e++]=t,n[e++]=r+s,n[e++]=t+o,n[e++]=r,n[e++]=t+o,n[e++]=r,n[e++]=t,n[e++]=r+s,n[e++]=t+o,n[e++]=r+s}function Zoe(n,e,t){const r=zf;t=Math.min(t,Math.min(e.w,e.h)/2);const o=xe.ExpandBy(e,-t);if(o.w<=0||o.h<=0)return bc(n,{center:e.center,radius:t,numArcSegments:zf*4}),zf*4*6;let s=0;return _c(n,s,o.minX,o.minY,o.w,o.h),s+=12,_c(n,s,o.minX,e.minY,o.w,t),s+=12,_c(n,s,o.maxX,o.minY,t,o.h),s+=12,_c(n,s,o.minX,o.maxY,o.w,t),s+=12,_c(n,s,e.minX,o.minY,t,o.h),s+=12,bc(n,{numArcSegments:r,offset:s,center:o.point,radius:t,startAngle:ft,endAngle:ft*1.5}),s+=r*6,bc(n,{numArcSegments:r,offset:s,center:P.Add(o.point,new P(o.w,0)),radius:t,startAngle:ft*1.5,endAngle:xt}),s+=r*6,bc(n,{numArcSegments:r,offset:s,center:P.Add(o.point,o.size),radius:t,startAngle:0,endAngle:Dt}),s+=r*6,bc(n,{numArcSegments:r,offset:s,center:P.Add(o.point,new P(0,o.h)),radius:t,startAngle:Dt,endAngle:ft}),I4}function Qoe(n){if(!n)throw new Error("Canvas element not found");const e=n.getContext("webgl2",{premultipliedAlpha:!1});if(!e)throw new Error("Failed to get webgl2 context");const t=`#version 300 es
  precision mediump float;
  
  in vec2 shapeVertexPosition;

	uniform vec4 canvasPageBounds;

	// taken (with thanks) from
	// https://webglfundamentals.org/webgl/lessons/webgl-2d-matrices.html
  void main() {
		// convert the position from pixels to 0.0 to 1.0
		vec2 zeroToOne = (shapeVertexPosition - canvasPageBounds.xy) / canvasPageBounds.zw;
	
		// convert from 0->1 to 0->2
		vec2 zeroToTwo = zeroToOne * 2.0;
	
		// convert from 0->2 to -1->+1 (clipspace)
		vec2 clipSpace = zeroToTwo - 1.0;
	
		gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);
  }`,r=e.createShader(e.VERTEX_SHADER);if(!r)throw new Error("Failed to create vertex shader");if(e.shaderSource(r,t),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error("Failed to compile vertex shader");const o=`#version 300 es
  precision mediump float;
  
	uniform vec4 fillColor;
  out vec4 outputColor;

  void main() {
	outputColor = fillColor;
  }`,s=e.createShader(e.FRAGMENT_SHADER);if(!s)throw new Error("Failed to create fragment shader");if(e.shaderSource(s,o),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error("Failed to compile fragment shader");const i=e.createProgram();if(!i)throw new Error("Failed to create program");if(e.attachShader(i,r),e.attachShader(i,s),e.linkProgram(i),!e.getProgramParameter(i,e.LINK_STATUS))throw new Error("Failed to link program");e.useProgram(i);const a=e.getAttribLocation(i,"shapeVertexPosition");if(a<0)throw new Error("Failed to get shapeVertexPosition attribute location");e.enableVertexAttribArray(a);const c=e.getUniformLocation(i,"canvasPageBounds"),u=e.getUniformLocation(i,"fillColor");if(!e.createBuffer())throw new Error("Failed to create buffer");if(!e.createBuffer())throw new Error("Failed to create buffer");return{context:e,selectedShapes:rf(e,1024),unselectedShapes:rf(e,4096),viewport:rf(e,I4),collaborators:rf(e,1024),prepareTriangles(g,y){e.bindBuffer(e.ARRAY_BUFFER,g.buffer),e.bufferData(e.ARRAY_BUFFER,g.vertices,e.STATIC_DRAW,0,y),e.enableVertexAttribArray(a),e.vertexAttribPointer(a,2,e.FLOAT,!1,0,0)},drawTrianglesTransparently(g){e.enable(e.BLEND),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA),e.drawArrays(e.TRIANGLES,0,g/2),e.disable(e.BLEND)},drawTriangles(g){e.drawArrays(e.TRIANGLES,0,g/2)},setFillColor(g){e.uniform4fv(u,g)},setCanvasPageBounds(g){e.uniform4fv(c,g)}}}function rf(n,e){const t=n.createBuffer();if(!t)throw new Error("Failed to create buffer");return{buffer:t,vertices:new Float32Array(e)}}function yM(n,e,t){let r=n.vertices.length;for(;r<e+t.length;)r*=2;if(r!=n.vertices.length){const o=new Float32Array(r);o.set(n.vertices),n.vertices=o}n.vertices.set(t,e)}var Joe=Object.create,E4=Object.defineProperty,ese=Object.getOwnPropertyDescriptor,tse=(n,e)=>(e=Symbol[n])?e:Symbol.for("Symbol."+n),k4=n=>{throw TypeError(n)},T4=(n,e,t)=>e in n?E4(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,nse=n=>[,,,Joe(null)],M4=["class","method","getter","setter","accessor","field","value","get","set"],A4=n=>n!==void 0&&typeof n!="function"?k4("Function expected"):n,rse=(n,e,t,r,o)=>({kind:M4[n],name:e,metadata:r,addInitializer:s=>t._?k4("Already initialized"):o.push(A4(s||null))}),ose=(n,e)=>T4(e,tse("metadata"),n[3]),sse=(n,e,t,r)=>{for(var o=0,s=n[e>>1],i=s&&s.length;o<i;o++)s[o].call(t);return r},Ws=(n,e,t,r,o,s)=>{for(var i,a,c,u,h=e&7,f=!!(e&8),g=!!(e&16),y=2,v=M4[h+5],S=n[y]||(n[y]=[]),w=(o=o.prototype,ese(o,t)),b=r.length-1;b>=0;b--)c=rse(h,t,a={},n[3],S),c.static=f,c.private=g,u=c.access={has:_=>t in _},u.get=_=>_[t],i=(0,r[b])(w[v],c),a._=1,A4(i)&&(w[v]=i);return w&&E4(o,t,w),o},ii=(n,e,t)=>T4(n,typeof e!="symbol"?e+"":e,t),j4,R4,O4,D4,L4,F4,N4,$4,z4,B4,lo;B4=[Or],z4=[ce],$4=[ce],N4=[ce],F4=[ce],L4=[ce],D4=[ce],O4=[ce],R4=[ce],j4=[Or];class Ro{constructor(e,t,r){this.editor=e,this.elem=t,this.container=r,sse(lo,5,this),ii(this,"disposables",[]),ii(this,"gl"),ii(this,"shapeGeometryCache"),ii(this,"colors"),ii(this,"id",bt()),ii(this,"canvasBoundingClientRect",dn("canvasBoundingClientRect",new xe)),ii(this,"originPagePoint",new P),ii(this,"originPageCenter",new P),ii(this,"isInViewport",!1),this.gl=Qoe(t),this.shapeGeometryCache=e.store.createComputedCache("webgl-geometry",o=>{const s=e.getShapeMaskedPageBounds(o.id);if(!s)return null;const i=new Float32Array(12);return _c(i,0,s.x,s.y,s.w,s.h),i}),this.colors=this._getColors(),this.disposables.push(this._listenForCanvasResize(),Ms("minimap render",this.render))}close(){return this.disposables.forEach(e=>e())}_getColors(){const e=getComputedStyle(this.editor.getContainer());return{shapeFill:sd(e.getPropertyValue("--color-text-3").trim()),selectFill:sd(e.getPropertyValue("--color-selected").trim()),viewportFill:sd(e.getPropertyValue("--color-muted-1").trim()),background:sd(e.getPropertyValue("--color-low").trim())}}updateColors(){this.colors=this._getColors()}getDpr(){return this.editor.getInstanceState().devicePixelRatio}getContentPageBounds(){const e=this.editor.getViewportPageBounds(),t=this.editor.getCurrentPageBounds();return t?xe.Expand(t,e):e}getContentScreenBounds(){const e=this.getContentPageBounds(),t=this.editor.pageToScreen(e.point),r=this.editor.pageToScreen(new P(e.maxX,e.maxY));return new xe(t.x,t.y,r.x-t.x,r.y-t.y)}_getCanvasBoundingRect(){const{x:e,y:t,width:r,height:o}=this.elem.getBoundingClientRect();return new xe(e,t,r,o)}getCanvasScreenBounds(){return this.canvasBoundingClientRect.get()}_listenForCanvasResize(){const e=new ResizeObserver(()=>{const t=this._getCanvasBoundingRect();this.canvasBoundingClientRect.set(t)});return e.observe(this.elem),e.observe(this.container),()=>e.disconnect()}getCanvasSize(){const e=this.canvasBoundingClientRect.get(),t=this.getDpr();return new P(e.width*t,e.height*t)}getCanvasClientPosition(){return this.canvasBoundingClientRect.get().point}getCanvasPageBounds(){const e=this.getCanvasScreenBounds(),t=this.getContentPageBounds(),r=e.width/e.height;let o=t.width,s=o/r;s<t.height&&(s=t.height,o=s*r);const i=new xe(0,0,o,s);return i.center=t.center,i}getZoom(){return this.getCanvasPageBounds().width/this.getCanvasScreenBounds().width}getCanvasPageBoundsArray(){const{x:e,y:t,w:r,h:o}=this.getCanvasPageBounds();return new Float32Array([e,t,r,o])}getMinimapPagePoint(e,t){const r=this.getCanvasPageBounds(),o=this.getCanvasScreenBounds();let s=e-o.x,i=t-o.y;return s*=r.width/o.width,i*=r.height/o.height,s+=r.minX,i+=r.minY,new P(s,i,1)}minimapScreenPointToPagePoint(e,t,r=!1,o=!1){const{editor:s}=this,i=s.getViewportPageBounds();let{x:a,y:c}=this.getMinimapPagePoint(e,t);if(o){const u=this.editor.getCurrentPageBounds()??new xe,h=u.minX-i.width/2,f=u.maxX+i.width/2,g=u.minY-i.height/2,y=u.maxY+i.height/2,v=Math.max(0,h+i.width-a),S=Math.max(0,-(f-i.width-a)),w=Math.max(0,g+i.height-c),b=Math.max(0,-(y-i.height-c));a+=(v-S)/2,c+=(w-b)/2,a=Cn(a,h,f),c=Cn(c,g,y)}if(r){const{originPagePoint:u}=this,h=Math.abs(a-u.x),f=Math.abs(c-u.y);h>f?c=u.y:a=u.x}return new P(a,c)}render(){const e=this.gl.context,t=this.getCanvasSize();this.gl.setCanvasPageBounds(this.getCanvasPageBoundsArray()),this.elem.width=t.x,this.elem.height=t.y,e.viewport(0,0,t.x,t.y),e.clearColor(this.colors.background[0],this.colors.background[1],this.colors.background[2],1),e.clear(e.COLOR_BUFFER_BIT);const r=new Set(this.editor.getSelectedShapeIds()),o=this.colors;let s=0,i=0;const a=this.editor.getCurrentPageShapeIdsSorted();for(let c=0,u=a.length;c<u;c++){const h=a[c],f=this.shapeGeometryCache.get(h);if(!f)continue;const g=f.length;r.has(h)?(yM(this.gl.selectedShapes,s,f),s+=g):(yM(this.gl.unselectedShapes,i,f),i+=g)}this.drawShapes(this.gl.unselectedShapes,i,o.shapeFill),this.drawShapes(this.gl.selectedShapes,s,o.selectFill),this.drawViewport(),this.drawCollaborators()}drawShapes(e,t,r){this.gl.prepareTriangles(e,t),this.gl.setFillColor(r),this.gl.drawTriangles(t)}drawViewport(){const e=this.editor.getViewportPageBounds(),t=Zoe(this.gl.viewport.vertices,e,4*this.getZoom());this.gl.prepareTriangles(this.gl.viewport,t),this.gl.setFillColor(this.colors.viewportFill),this.gl.drawTrianglesTransparently(t),kt.isSafari&&(this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t),this.gl.drawTrianglesTransparently(t))}drawCollaborators(){const e=this.editor.getCollaboratorsOnCurrentPage();if(!e.length)return;const t=20,r=t*6,o=r*e.length;this.gl.collaborators.vertices.length<o&&(this.gl.collaborators.vertices=new Float32Array(o));const s=this.gl.collaborators.vertices;let i=0;const a=this.getZoom();for(const{cursor:c}of e)bc(s,{center:P.From(c),radius:3*a,offset:i,numArcSegments:t}),i+=r;this.gl.prepareTriangles(this.gl.collaborators,o),i=0;for(const{color:c}of e)this.gl.setFillColor(sd(c)),this.gl.context.drawArrays(this.gl.context.TRIANGLES,i/2,r/2),i+=r}}lo=nse();Ws(lo,1,"close",B4,Ro);Ws(lo,1,"getDpr",z4,Ro);Ws(lo,1,"getContentPageBounds",$4,Ro);Ws(lo,1,"getContentScreenBounds",N4,Ro);Ws(lo,1,"getCanvasSize",F4,Ro);Ws(lo,1,"getCanvasClientPosition",L4,Ro);Ws(lo,1,"getCanvasPageBounds",D4,Ro);Ws(lo,1,"getZoom",O4,Ro);Ws(lo,1,"getCanvasPageBoundsArray",R4,Ro);Ws(lo,1,"render",j4,Ro);ose(lo,Ro);function ise(){const n=te(),e=fn(),t=C.useRef(null),r=C.useRef(!1),o=C.useRef();C.useEffect(()=>{try{const h=new Ro(n,t.current,e);return o.current=h,o.current.close}catch(h){n.annotateError(h,{origin:"minimap",willCrashApp:!1}),n.timers.setTimeout(()=>{throw h})}},[n,e]);const s=C.useCallback(h=>{if(!n.getCurrentPageShapeIds().size||!o.current)return;const f=o.current.minimapScreenPointToPagePoint(h.clientX,h.clientY,!1,!1),g=o.current.minimapScreenPointToPagePoint(h.clientX,h.clientY,!1,!0);o.current.originPagePoint.setTo(g),o.current.originPageCenter.setTo(n.getViewportPageBounds().center),n.centerOnPoint(f,{animation:{duration:n.options.animationMediumMs}})},[n]),i=C.useCallback(h=>{if(!o.current)return;const f=h.currentTarget;if(Qd(f,h),!n.getCurrentPageShapeIds().size)return;r.current=!0,o.current.isInViewport=!1;const g=o.current.minimapScreenPointToPagePoint(h.clientX,h.clientY,!1,!1),y=n.getViewportPageBounds(),v=o.current.getContentPageBounds();if(new xe(v.x-y.width/2,v.y-y.height/2,v.width+y.width,v.height+y.height).containsPoint(g)&&!y.containsPoint(g)){o.current.isInViewport=y.containsPoint(g);const b=P.Sub(y.center,y.point),_=P.Add(g,b);o.current.originPagePoint.setTo(_),o.current.originPageCenter.setTo(g),n.centerOnPoint(g,{animation:{duration:n.options.animationMediumMs}})}else{const b=o.current.minimapScreenPointToPagePoint(h.clientX,h.clientY,!1,!0);o.current.isInViewport=y.containsPoint(b),o.current.originPagePoint.setTo(b),o.current.originPageCenter.setTo(y.center)}function w(b){f&&Jd(f,b),r.current=!1,document.body.removeEventListener("pointerup",w)}document.body.addEventListener("pointerup",w)},[n]),a=C.useCallback(h=>{if(!o.current)return;const f=o.current.minimapScreenPointToPagePoint(h.clientX,h.clientY,h.shiftKey,!0);if(r.current){if(o.current.isInViewport){const S=o.current.originPagePoint.clone().sub(o.current.originPageCenter);n.centerOnPoint(P.Sub(f,S));return}n.centerOnPoint(f)}const g=o.current.getMinimapPagePoint(h.clientX,h.clientY),y=n.pageToScreen(g),v={type:"pointer",target:"canvas",name:"pointer_move",...Qr(h),point:y,isPen:n.getInstanceState().isPenMode};n.dispatch(v)},[n]),c=C.useCallback(h=>{const f=nR(h);n.dispatch({type:"wheel",name:"wheel",delta:f,point:new P(h.clientX,h.clientY),shiftKey:h.shiftKey,altKey:h.altKey,ctrlKey:h.metaKey||h.ctrlKey,metaKey:h.metaKey,accelKey:qn(h)})},[n]),u=ah();return C.useEffect(()=>{n.timers.setTimeout(()=>{var h,f;(h=o.current)==null||h.updateColors(),(f=o.current)==null||f.render()})},[u,n]),p.jsx("div",{className:"tlui-minimap",children:p.jsx("canvas",{role:"img","aria-label":"minimap",ref:t,className:"tlui-minimap__canvas",onDoubleClick:s,onPointerMove:a,onPointerDown:i,onWheelCapture:c})})}function ase(n,e){const[t,r]=at.useState(e);at.useLayoutEffect(()=>{const s=Ab(n);if(s)try{r(JSON.parse(s))}catch{console.error(`Could not restore value ${n} from local storage.`)}},[n]);const o=at.useCallback(s=>{r(i=>{const a=typeof s=="function"?s(i):s;return jb(n,JSON.stringify(a)),a})},[n]);return[t,o]}const lse=C.memo(function(){const e=kl(),t=lt(),r=hr(),o=C.useRef(null);ka(o);const[s,i]=ase("minimap",!0),a=C.useCallback(()=>{i(h=>!h)},[i]),{ZoomMenu:c,Minimap:u}=ja();return r<en.MOBILE?null:p.jsxs("div",{ref:o,className:"tlui-navigation-panel",children:[p.jsx("div",{className:"tlui-buttons__horizontal",children:c&&r<en.TABLET?p.jsx(c,{}):s?p.jsxs(p.Fragment,{children:[c&&p.jsx(c,{}),u&&p.jsx($e,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:p.jsx(rt,{icon:s?"chevrons-ne":"chevrons-sw"})})]}):p.jsxs(p.Fragment,{children:[p.jsx($e,{type:"icon","data-testid":"minimap.zoom-out",title:`${t(zd(e["zoom-out"].label))} ${zw(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:p.jsx(rt,{icon:"minus"})}),c&&p.jsx(c,{}),p.jsx($e,{type:"icon","data-testid":"minimap.zoom-in",title:`${t(zd(e["zoom-in"].label))} ${zw(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:p.jsx(rt,{icon:"plus"})}),u&&p.jsx($e,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:a,children:p.jsx(rt,{icon:s?"chevrons-ne":"chevrons-sw"})})]})}),u&&r>=en.TABLET&&!s&&p.jsx(u,{})]})}),cse=function({name:e,id:t,isCurrentPage:r,onCancel:o}){const s=te(),i=Ln(),a=C.useRef(null),c=C.useRef(null),u=C.useCallback(()=>{c.current=s.markHistoryStoppingPoint("rename page")},[s]),h=C.useCallback(g=>{s.renamePage(t,g||"New Page"),i("rename-page",{source:"page-menu"})},[s,t,i]),f=C.useCallback(()=>{c.current&&s.bailToMark(c.current),o()},[s,o]);return p.jsx(wm,{className:"tlui-page-menu__item__input",ref:g=>a.current=g,defaultValue:e,onValueChange:h,onCancel:f,onFocus:u,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:r,autoSelect:!0})},ib=(n,e,t,r,o)=>{let s;const i=n.getPages(),a=t>r?i[r-1]:i[r],c=t>r?i[r]:i[r+1];a&&!c?s=Is(a.index):!a&&c?s=N8(i[0].index):s=jd(a.index,c.index),s!==i[t].index&&(n.markHistoryStoppingPoint("moving page"),n.updatePage({id:e,index:s}),o("move-page",{source:"page-menu"}))},vM=On(function({index:e,listSize:t,item:r,onRename:o}){const s=te(),i=lt(),a=s.getPages(),c=Ln(),u=C.useCallback(()=>{s.markHistoryStoppingPoint("creating page");const y=so.createId();s.duplicatePage(r.id,y),c("duplicate-page",{source:"page-menu"})},[s,r,c]),h=C.useCallback(()=>{ib(s,r.id,e,e-1,c)},[s,r,e,c]),f=C.useCallback(()=>{ib(s,r.id,e,e+1,c)},[s,r,e,c]),g=C.useCallback(()=>{s.markHistoryStoppingPoint("deleting page"),s.deletePage(r.id),c("delete-page",{source:"page-menu"})},[s,r,c]);return p.jsxs(vl,{id:`page item submenu ${e}`,children:[p.jsx(Sl,{children:p.jsx($e,{type:"icon",title:i("page-menu.submenu.title"),children:p.jsx(rt,{icon:"dots-vertical",small:!0})})}),p.jsx(xl,{alignOffset:0,side:"right",sideOffset:-4,children:p.jsxs(Mo,{type:"menu",sourceId:"page-menu",children:[p.jsxs(Je,{id:"modify",children:[o&&p.jsx(kn,{id:"rename",label:"page-menu.submenu.rename",onSelect:o}),p.jsx(kn,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:u,disabled:a.length>=s.options.maxPages}),e>0&&p.jsx(kn,{id:"move-up",onSelect:h,label:"page-menu.submenu.move-up"}),e<t-1&&p.jsx(kn,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:f})]}),t>1&&p.jsx(Je,{id:"delete",children:p.jsx(kn,{id:"delete",onSelect:g,label:"page-menu.submenu.delete"})})]})})]})}),use=C.memo(function(){const e=te(),t=Ln(),r=lt(),o=hr(),s=C.useCallback(()=>b(!1),[]),[i,a]=Ti("page-menu",s),c=36,u=C.useRef(null),h=re("pages",()=>e.getPages(),[e]),f=re("currentPage",()=>e.getCurrentPage(),[e]),g=re("currentPageId",()=>e.getCurrentPageId(),[e]),y=ao(),v=re("maxPageCountReached",()=>e.getPages().length>=e.options.maxPages,[e]),S=re("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[w,b]=C.useState(!1),_=C.useCallback(()=>{y||b(F=>!F)},[y]),T=C.useRef({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[E,M]=C.useState(Object.fromEntries(h.map((F,$)=>[F.id,{y:$*c,offsetY:0,isSelected:!1}])));C.useLayoutEffect(()=>{M(Object.fromEntries(h.map((F,$)=>[F.id,{y:$*c,offsetY:0,isSelected:!1}])))},[c,h]),C.useEffect(()=>{i&&e.timers.requestAnimationFrame(()=>{const F=document.querySelector(`[data-testid="page-menu-item-${g}"]`);if(F){const $=u.current;if(!$)return;const H=F.offsetTop,Z=$.scrollTop;H<Z&&$.scrollTo({top:H});const G=H+c,q=$.scrollTop+$.offsetHeight;G>q&&$.scrollTo({top:G-$.offsetHeight})}})},[c,g,i,e]);const A=C.useCallback(F=>{const{clientY:$,currentTarget:H}=F,{dataset:{id:Z,index:G}}=H;if(!Z||!G)return;const q=T.current;Qd(F.currentTarget,F),q.status="pointing",q.pointing={id:Z,index:+G};const ae=E[Z].y;q.startY=$,q.startIndex=Math.max(0,Math.min(Math.round(ae/c),h.length-1))},[c,h.length,E]),R=C.useCallback(F=>{const $=T.current;if($.status==="pointing"){const{clientY:H}=F,Z=H-$.startY;Math.abs(Z)>5&&($.status="dragging")}if($.status==="dragging"){const{clientY:H}=F,Z=H-$.startY,G=E[$.pointing.id],{startIndex:q,pointing:Q}=$,ae=G.y+Z,B=Math.max(0,Math.min(Math.round(ae/c),h.length-1)),oe={...E};if(oe[Q.id]={y:G.y,offsetY:Z,isSelected:!0},B!==$.dragIndex){$.dragIndex=B;for(let pe=0;pe<h.length;pe++){const _e=h[pe];if(_e.id===$.pointing.id)continue;let{y:ue}=oe[_e.id];B===q?ue=pe*c:B<q?B<=pe&&pe<q?ue=(pe+1)*c:ue=pe*c:B>q&&(B>=pe&&pe>q?ue=(pe-1)*c:ue=pe*c),ue!==oe[_e.id].y&&(oe[_e.id]={y:ue,offsetY:0,isSelected:!0})}}M(oe)}},[c,h,E]),L=C.useCallback(F=>{const $=T.current;if($.status==="dragging"){const{id:H,index:Z}=$.pointing;ib(e,H,Z,$.dragIndex,t)}Jd(F.currentTarget,F),$.status="idle"},[e,t]),K=C.useCallback(F=>{const $=T.current;F.key==="Escape"&&($.status==="dragging"&&M(Object.fromEntries(h.map((H,Z)=>[H.id,{y:Z*c,offsetY:0,isSelected:!1}]))),$.status="idle")},[c,h]),D=C.useCallback(()=>{y||(e.run(()=>{e.markHistoryStoppingPoint("creating page");const F=so.createId();e.createPage({name:r("page-menu.new-page-initial-name"),id:F}),e.setCurrentPage(F),b(!0)}),t("new-page",{source:"page-menu"}))},[e,r,y,t]),U=C.useCallback(F=>{e.setCurrentPage(F),t("change-page",{source:"page-menu"})},[e,t]),V=C.useCallback((F,$)=>{e.renamePage(F,$),t("rename-page",{source:"page-menu"})},[e,t]);return p.jsxs(D_,{id:"pages",onOpenChange:a,open:i,children:[p.jsx(L_,{"data-testid":"main.page-menu",children:p.jsxs($e,{type:"menu",title:f.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[p.jsx("div",{className:"tlui-page-menu__name",children:f.name}),p.jsx(rt,{icon:"chevron-down",small:!0})]})}),p.jsx(F_,{side:"bottom",align:"start",sideOffset:6,disableEscapeKeyDown:w,children:p.jsxs("div",{className:"tlui-page-menu__wrapper",children:[p.jsxs("div",{className:"tlui-page-menu__header",children:[p.jsx("div",{className:"tlui-page-menu__header__title",children:r("page-menu.title")}),!y&&p.jsxs("div",{className:"tlui-buttons__horizontal",children:[p.jsx($e,{type:"icon","data-testid":"page-menu.edit",title:r(w?"page-menu.edit-done":"page-menu.edit-start"),onClick:_,children:p.jsx(rt,{icon:w?"check":"edit"})}),p.jsx($e,{type:"icon","data-testid":"page-menu.create",title:r(v?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:v,onClick:D,children:p.jsx(rt,{icon:"plus"})})]})]}),p.jsx("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:c*h.length+4},ref:u,children:h.map((F,$)=>{const H=E[F.id]??{position:$*40,offsetY:0};return w?p.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:F.id===f.id?888:$,transform:`translate(0px, ${H.y+H.offsetY}px)`},children:[p.jsx($e,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:A,onPointerUp:L,onPointerMove:R,onKeyDown:K,"data-id":F.id,"data-index":$,children:p.jsx(rt,{icon:"drag-handle-dots"})}),o<en.TABLET_SM&&S?p.jsxs($e,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{const Z=window.prompt("Rename page",F.name);Z&&Z!==F.name&&V(F.id,Z)},onDoubleClick:_,children:[p.jsx(sb,{checked:F.id===f.id}),p.jsx(an,{children:F.name})]}):p.jsx("div",{className:"tlui-page_menu__item__sortable__title",style:{height:c},children:p.jsx(cse,{id:F.id,name:F.name,isCurrentPage:F.id===f.id,onCancel:()=>{b(!1),e.menus.clearOpenMenus()}})}),!y&&p.jsx("div",{className:"tlui-page_menu__item__submenu","data-isediting":w,children:p.jsx(vM,{index:$,item:F,listSize:h.length})})]},F.id+"_editing"):p.jsxs("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[p.jsxs($e,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>U(F.id),onDoubleClick:_,title:r("page-menu.go-to-page"),children:[p.jsx(sb,{checked:F.id===f.id}),p.jsx(an,{children:F.name})]}),!y&&p.jsx("div",{className:"tlui-page_menu__item__submenu",children:p.jsx(vM,{index:$,item:F,listSize:h.length,onRename:()=>{if(kt.isIos){const Z=window.prompt("Rename page",F.name);Z&&Z!==F.name&&V(F.id,Z)}else b(!0),g!==F.id&&U(F.id)}})})]},F.id)})})]})})]})});function dse(){const n=te(),e=s4(),t=o4(),r=pr(1),o=ao(),s=re("should display quick actions",()=>n.isInAny("select","hand","zoom"),[n]),i=Mi(),a=r&&i;if(!(o&&!s))return p.jsxs(p.Fragment,{children:[p.jsx(le,{actionId:"undo",disabled:!e}),p.jsx(le,{actionId:"redo",disabled:!t}),p.jsx(le,{actionId:"delete",disabled:!a}),p.jsx(le,{actionId:"duplicate",disabled:!a})]})}const hse=C.memo(function({children:e}){const t=e??p.jsx(dse,{});return p.jsx(Mo,{type:"small-icons",sourceId:"quick-actions",children:t})});function pse({userId:n}){const e=Vg(n);return e?p.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:e.color},children:e.userName==="New User"?"":e.userName[0]??""},n):null}const fse=On(function({userId:e}){const t=te(),r=lt(),o=Ln(),s=Vg(e),i=C.useCallback(()=>{t.getInstanceState().followingUserId===e?(t.stopFollowingUser(),o("stop-following",{source:"people-menu"})):(t.startFollowingUser(e),o("start-following",{source:"people-menu"}))},[t,e,o]),a=(s==null?void 0:s.followingUserId)===t.user.getId(),c=t.getInstanceState().followingUserId===e;return s?p.jsxs("div",{className:"tlui-people-menu__item tlui-buttons__horizontal",children:[p.jsxs($e,{type:"menu",className:"tlui-people-menu__item__button",onClick:()=>t.zoomToUser(e),onDoubleClick:i,children:[p.jsx($s,{icon:"color",color:s.color}),p.jsx("div",{className:"tlui-people-menu__name",children:s.userName??"New User"})]}),p.jsx($e,{type:"icon",className:"tlui-people-menu__item__follow",title:r(a?"people-menu.leading":c?"people-menu.following":"people-menu.follow"),onClick:i,disabled:a,"data-active":c||a,children:p.jsx(rt,{icon:a?"leading":c?"following":"follow"})})]}):null});function gse({count:n}){return p.jsx("div",{className:"tlui-people-menu__more",children:"+"+Math.abs(n)})}const mse=On(function(){const e=te(),t=fn(),r=lt(),o=Ln(),s=C.useRef(!1),[i,a]=C.useState(!1),c=C.useCallback(S=>{a(S)},[]),u=e.user.getColor(),h=C.useCallback(S=>{e.user.updateUserPreferences({color:S}),o("set-color",{source:"people-menu"})},[e,o]),{handleButtonClick:f,handleButtonPointerDown:g,handleButtonPointerEnter:y,handleButtonPointerUp:v}=at.useMemo(()=>{const S=()=>{s.current=!1,window.removeEventListener("pointerup",S)};return{handleButtonClick:E=>{const{id:M}=E.currentTarget.dataset;M&&u!==M&&h(M)},handleButtonPointerDown:E=>{const{id:M}=E.currentTarget.dataset;M&&(h(M),s.current=!0,window.addEventListener("pointerup",S))},handleButtonPointerEnter:E=>{if(!s.current)return;const{id:M}=E.currentTarget.dataset;M&&h(M)},handleButtonPointerUp:E=>{const{id:M}=E.currentTarget.dataset;M&&h(M)}}},[u,h]);return p.jsxs(A_,{onOpenChange:c,open:i,children:[p.jsx(j_,{dir:"ltr",asChild:!0,children:p.jsx($e,{type:"icon",className:"tlui-people-menu__user__color",style:{color:e.user.getColor()},title:r("people-menu.change-color"),children:p.jsx(rt,{icon:"color"})})}),p.jsx(R_,{container:t,children:p.jsx(O_,{dir:"ltr",className:"tlui-menu tlui-people-menu__user__color-picker",align:"start",side:"left",sideOffset:8,children:p.jsx("div",{className:"tlui-buttons__grid",children:gw.map(S=>p.jsx($e,{type:"icon","data-id":S,"data-testid":S,"aria-label":S,"data-state":u===S?"hinted":void 0,title:S,className:"tlui-button-grid__button",style:{color:S},onPointerEnter:y,onPointerDown:g,onPointerUp:v,onClick:f,children:p.jsx(rt,{icon:"color"})},S))})})})]})});function yse(){const n=te(),e=Ln(),t=re("userName",()=>n.user.getName(),[]),r=lt(),o=C.useRef(t),s=C.useRef(t),[i,a]=C.useState(!1),c=C.useCallback(()=>{a(g=>!g)},[]),u=C.useCallback(g=>{s.current=g,n.user.updateUserPreferences({name:g})},[n]),h=C.useCallback(()=>{o.current!==s.current&&(e("change-user-name",{source:"people-menu"}),o.current=s.current)},[e]),f=C.useCallback(()=>{a(!1),n.user.updateUserPreferences({name:o.current}),n.menus.clearOpenMenus()},[n]);return p.jsxs("div",{className:"tlui-people-menu__user",children:[p.jsx(mse,{}),i?p.jsx(wm,{className:"tlui-people-menu__user__input",defaultValue:t,onValueChange:u,onComplete:c,onCancel:f,onBlur:h,shouldManuallyMaintainScrollPositionWhenFocused:!0,autoFocus:!0,autoSelect:!0}):p.jsxs(p.Fragment,{children:[p.jsx("div",{className:"tlui-people-menu__user__name",onDoubleClick:()=>{i||a(!0)},children:t}),t==="New User"?p.jsx("div",{className:"tlui-people-menu__user__label",children:r("people-menu.user")}):null]}),p.jsx($e,{type:"icon",className:"tlui-people-menu__user__edit","data-testid":"people-menu.change-name",title:r("people-menu.change-name"),onClick:c,children:p.jsx(rt,{icon:i?"check":"edit"})})]})}function vse({displayUserWhenAlone:n,children:e}){const t=lt(),r=fn(),o=te(),s=sR(),i=re("user",()=>o.user.getColor(),[o]),a=re("user",()=>o.user.getName(),[o]),[c,u]=Ti("people menu");return p.jsxs(A_,{onOpenChange:u,open:c,children:[p.jsx(j_,{dir:"ltr",asChild:!0,children:p.jsxs("button",{className:"tlui-people-menu__avatars-button",title:t("people-menu.title"),children:[s.length>5&&p.jsx(gse,{count:s.length-5}),p.jsxs("div",{className:"tlui-people-menu__avatars",children:[s.slice(-5).map(h=>p.jsx(pse,{userId:h},h)),(n||s.length>0)&&p.jsx("div",{className:"tlui-people-menu__avatar",style:{backgroundColor:i},children:a==="New User"?"":a[0]??""})]})]})}),p.jsx(R_,{container:r,children:p.jsx(O_,{dir:"ltr",className:"tlui-menu",side:"bottom",sideOffset:2,collisionPadding:4,onEscapeKeyDown:et,children:p.jsxs("div",{className:"tlui-people-menu__wrapper",children:[p.jsx("div",{className:"tlui-people-menu__section",children:p.jsx(yse,{})}),s.length>0&&p.jsx("div",{className:"tlui-people-menu__section",children:s.map(h=>p.jsx(fse,{userId:h},h+"_presence"))}),e]})})})]})}function Sse(){return p.jsx("div",{className:"tlui-share-zone",draggable:!1,children:p.jsx(vse,{displayUserWhenAlone:!0})})}const xse=Object.freeze([oo,pl,fl,Fs]);function U4(n=xse){const e=te();return re("getRelevantStyles",()=>{var s;const t=new ww(e.getSharedStyles()),r=!!((s=e.root.getCurrent())!=null&&s.shapeType),o=e.isIn("select")&&e.getSelectedShapeIds().length>0;if(t.size===0&&e.isIn("select")&&e.getSelectedShapeIds().length===0)for(const i of n)t.applyValue(i,e.getStyleForNextShape(i));return r||o||t.size>0?t:null},[e])}const Io={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],textAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],horizontalAlign:[{value:"start",icon:"horizontal-align-start"},{value:"middle",icon:"horizontal-align-middle"},{value:"end",icon:"horizontal-align-end"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-middle"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"star",icon:"geo-star"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"cloud",icon:"geo-cloud"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"},{value:"heart",icon:"geo-heart"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]},ol=C.memo(function(e){const{uiType:t,items:r,title:o,style:s,value:i,onValueChange:a,onHistoryMark:c,theme:u}=e,h=lt(),f=C.useRef(!1),g=C.useRef(null),{handleButtonClick:y,handleButtonPointerDown:v,handleButtonPointerEnter:S,handleButtonPointerUp:w}=C.useMemo(()=>{const b=()=>{f.current=!1,window.removeEventListener("pointerup",b);const A=g.current;A&&["TEXTAREA","INPUT"].includes(A.nodeName)&&A.focus(),g.current=null};return{handleButtonClick:A=>{const{id:R}=A.currentTarget.dataset;i.type==="shared"&&i.value===R||(c==null||c("point picker item"),a(s,R))},handleButtonPointerDown:A=>{const{id:R}=A.currentTarget.dataset;c==null||c("point picker item"),a(s,R),f.current=!0,g.current=document.activeElement,window.addEventListener("pointerup",b)},handleButtonPointerEnter:A=>{if(!f.current)return;const{id:R}=A.currentTarget.dataset;a(s,R)},handleButtonPointerUp:A=>{const{id:R}=A.currentTarget.dataset;i.type==="shared"&&i.value===R||a(s,R)}}},[i,c,a,s]);return p.jsx("div",{"data-testid":`style.${t}`,className:Fe("tlui-buttons__grid"),children:r.map(b=>p.jsx($e,{type:"icon","data-id":b.value,"data-testid":`style.${t}.${b.value}`,"aria-label":b.value,"data-state":i.type==="shared"&&i.value===b.value?"hinted":void 0,title:o+" — "+h(`${t}-style.${b.value}`),className:Fe("tlui-button-grid__button"),style:s===oo?{color:u[b.value].solid}:void 0,onPointerEnter:S,onPointerDown:v,onPointerUp:w,onClick:y,children:p.jsx(rt,{icon:b.icon})},b.value))})});function H4(n,[e,t]){return Math.min(t,Math.max(e,n))}function wse(n){const e=C.useRef({value:n,previous:n});return C.useMemo(()=>(e.current.value!==n&&(e.current.previous=e.current.value,e.current.value=n),e.current.previous),[n])}var K4=["PageUp","PageDown"],W4=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],V4={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},cu="Slider",[ab,bse,_se]=cm(cu),[G4,Cle]=Ks(cu,[_se]),[Pse,Lm]=G4(cu),q4=C.forwardRef((n,e)=>{const{name:t,min:r=0,max:o=100,step:s=1,orientation:i="horizontal",disabled:a=!1,minStepsBetweenThumbs:c=0,defaultValue:u=[r],value:h,onValueChange:f=()=>{},onValueCommit:g=()=>{},inverted:y=!1,...v}=n,S=C.useRef(new Set),w=C.useRef(0),_=i==="horizontal"?Cse:Ise,[T=[],E]=Ta({prop:h,defaultProp:u,onChange:D=>{var V;(V=[...S.current][w.current])==null||V.focus(),f(D)}}),M=C.useRef(T);function A(D){const U=Ase(T,D);K(D,U)}function R(D){K(D,w.current)}function L(){const D=M.current[w.current];T[w.current]!==D&&g(T)}function K(D,U,{commit:V}={commit:!1}){const F=Dse(s),$=Lse(Math.round((D-r)/s)*s+r,F),H=H4($,[r,o]);E((Z=[])=>{const G=Tse(Z,H,U);if(Ose(G,c*s)){w.current=G.indexOf(H);const q=String(G)!==String(Z);return q&&V&&g(G),q?G:Z}else return Z})}return p.jsx(Pse,{scope:n.__scopeSlider,name:t,disabled:a,min:r,max:o,valueIndexToChangeRef:w,thumbs:S.current,values:T,orientation:i,children:p.jsx(ab.Provider,{scope:n.__scopeSlider,children:p.jsx(ab.Slot,{scope:n.__scopeSlider,children:p.jsx(_,{"aria-disabled":a,"data-disabled":a?"":void 0,...v,ref:e,onPointerDown:Ae(v.onPointerDown,()=>{a||(M.current=T)}),min:r,max:o,inverted:y,onSlideStart:a?void 0:A,onSlideMove:a?void 0:R,onSlideEnd:a?void 0:L,onHomeKeyDown:()=>!a&&K(r,0,{commit:!0}),onEndKeyDown:()=>!a&&K(o,T.length-1,{commit:!0}),onStepKeyDown:({event:D,direction:U})=>{if(!a){const $=K4.includes(D.key)||D.shiftKey&&W4.includes(D.key)?10:1,H=w.current,Z=T[H],G=s*$*U;K(Z+G,H,{commit:!0})}}})})})})});q4.displayName=cu;var[Y4,X4]=G4(cu,{startEdge:"left",endEdge:"right",size:"width",direction:1}),Cse=C.forwardRef((n,e)=>{const{min:t,max:r,dir:o,inverted:s,onSlideStart:i,onSlideMove:a,onSlideEnd:c,onStepKeyDown:u,...h}=n,[f,g]=C.useState(null),y=Lt(e,T=>g(T)),v=C.useRef(),S=D1(o),w=S==="ltr",b=w&&!s||!w&&s;function _(T){const E=v.current||f.getBoundingClientRect(),M=[0,E.width],R=$_(M,b?[t,r]:[r,t]);return v.current=E,R(T-E.left)}return p.jsx(Y4,{scope:n.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width",children:p.jsx(Z4,{dir:S,"data-orientation":"horizontal",...h,ref:y,style:{...h.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:T=>{const E=_(T.clientX);i==null||i(E)},onSlideMove:T=>{const E=_(T.clientX);a==null||a(E)},onSlideEnd:()=>{v.current=void 0,c==null||c()},onStepKeyDown:T=>{const M=V4[b?"from-left":"from-right"].includes(T.key);u==null||u({event:T,direction:M?-1:1})}})})}),Ise=C.forwardRef((n,e)=>{const{min:t,max:r,inverted:o,onSlideStart:s,onSlideMove:i,onSlideEnd:a,onStepKeyDown:c,...u}=n,h=C.useRef(null),f=Lt(e,h),g=C.useRef(),y=!o;function v(S){const w=g.current||h.current.getBoundingClientRect(),b=[0,w.height],T=$_(b,y?[r,t]:[t,r]);return g.current=w,T(S-w.top)}return p.jsx(Y4,{scope:n.__scopeSlider,startEdge:y?"bottom":"top",endEdge:y?"top":"bottom",size:"height",direction:y?1:-1,children:p.jsx(Z4,{"data-orientation":"vertical",...u,ref:f,style:{...u.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:S=>{const w=v(S.clientY);s==null||s(w)},onSlideMove:S=>{const w=v(S.clientY);i==null||i(w)},onSlideEnd:()=>{g.current=void 0,a==null||a()},onStepKeyDown:S=>{const b=V4[y?"from-bottom":"from-top"].includes(S.key);c==null||c({event:S,direction:b?-1:1})}})})}),Z4=C.forwardRef((n,e)=>{const{__scopeSlider:t,onSlideStart:r,onSlideMove:o,onSlideEnd:s,onHomeKeyDown:i,onEndKeyDown:a,onStepKeyDown:c,...u}=n,h=Lm(cu,t);return p.jsx(dt.span,{...u,ref:e,onKeyDown:Ae(n.onKeyDown,f=>{f.key==="Home"?(i(f),f.preventDefault()):f.key==="End"?(a(f),f.preventDefault()):K4.concat(W4).includes(f.key)&&(c(f),f.preventDefault())}),onPointerDown:Ae(n.onPointerDown,f=>{const g=f.target;g.setPointerCapture(f.pointerId),f.preventDefault(),h.thumbs.has(g)?g.focus():r(f)}),onPointerMove:Ae(n.onPointerMove,f=>{f.target.hasPointerCapture(f.pointerId)&&o(f)}),onPointerUp:Ae(n.onPointerUp,f=>{const g=f.target;g.hasPointerCapture(f.pointerId)&&(g.releasePointerCapture(f.pointerId),s(f))})})}),Q4="SliderTrack",J4=C.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,o=Lm(Q4,t);return p.jsx(dt.span,{"data-disabled":o.disabled?"":void 0,"data-orientation":o.orientation,...r,ref:e})});J4.displayName=Q4;var lb="SliderRange",e$=C.forwardRef((n,e)=>{const{__scopeSlider:t,...r}=n,o=Lm(lb,t),s=X4(lb,t),i=C.useRef(null),a=Lt(e,i),c=o.values.length,u=o.values.map(g=>n$(g,o.min,o.max)),h=c>1?Math.min(...u):0,f=100-Math.max(...u);return p.jsx(dt.span,{"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,...r,ref:a,style:{...n.style,[s.startEdge]:h+"%",[s.endEdge]:f+"%"}})});e$.displayName=lb;var cb="SliderThumb",t$=C.forwardRef((n,e)=>{const t=bse(n.__scopeSlider),[r,o]=C.useState(null),s=Lt(e,a=>o(a)),i=C.useMemo(()=>r?t().findIndex(a=>a.ref.current===r):-1,[t,r]);return p.jsx(Ese,{...n,ref:s,index:i})}),Ese=C.forwardRef((n,e)=>{const{__scopeSlider:t,index:r,name:o,...s}=n,i=Lm(cb,t),a=X4(cb,t),[c,u]=C.useState(null),h=Lt(e,_=>u(_)),f=c?!!c.closest("form"):!0,g=G3(c),y=i.values[r],v=y===void 0?0:n$(y,i.min,i.max),S=Mse(r,i.values.length),w=g==null?void 0:g[a.size],b=w?jse(w,v,a.direction):0;return C.useEffect(()=>{if(c)return i.thumbs.add(c),()=>{i.thumbs.delete(c)}},[c,i.thumbs]),p.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${v}% + ${b}px)`},children:[p.jsx(ab.ItemSlot,{scope:n.__scopeSlider,children:p.jsx(dt.span,{role:"slider","aria-label":n["aria-label"]||S,"aria-valuemin":i.min,"aria-valuenow":y,"aria-valuemax":i.max,"aria-orientation":i.orientation,"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0,tabIndex:i.disabled?void 0:0,...s,ref:h,style:y===void 0?{display:"none"}:n.style,onFocus:Ae(n.onFocus,()=>{i.valueIndexToChangeRef.current=r})})}),f&&p.jsx(kse,{name:o??(i.name?i.name+(i.values.length>1?"[]":""):void 0),value:y},r)]})});t$.displayName=cb;var kse=n=>{const{value:e,...t}=n,r=C.useRef(null),o=wse(e);return C.useEffect(()=>{const s=r.current,i=window.HTMLInputElement.prototype,c=Object.getOwnPropertyDescriptor(i,"value").set;if(o!==e&&c){const u=new Event("input",{bubbles:!0});c.call(s,e),s.dispatchEvent(u)}},[o,e]),p.jsx("input",{style:{display:"none"},...t,ref:r,defaultValue:e})};function Tse(n=[],e,t){const r=[...n];return r[t]=e,r.sort((o,s)=>o-s)}function n$(n,e,t){const s=100/(t-e)*(n-e);return H4(s,[0,100])}function Mse(n,e){return e>2?`Value ${n+1} of ${e}`:e===2?["Minimum","Maximum"][n]:void 0}function Ase(n,e){if(n.length===1)return 0;const t=n.map(o=>Math.abs(o-e)),r=Math.min(...t);return t.indexOf(r)}function jse(n,e,t){const r=n/2,s=$_([0,50],[0,r]);return(r-s(e)*t)*t}function Rse(n){return n.slice(0,-1).map((e,t)=>n[t+1]-e)}function Ose(n,e){if(e>0){const t=Rse(n);return Math.min(...t)>=e}return!0}function $_(n,e){return t=>{if(n[0]===n[1]||e[0]===e[1])return e[0];const r=(e[1]-e[0])/(n[1]-n[0]);return e[0]+r*(t-n[0])}}function Dse(n){return(String(n).split(".")[1]||"").length}function Lse(n,e){const t=Math.pow(10,e);return Math.round(n*t)/t}var Fse=q4,Nse=J4,$se=e$,zse=t$;const Bse=C.memo(function({onHistoryMark:e,title:t,steps:r,value:o,label:s,onValueChange:i,["data-testid"]:a}){const c=lt(),u=C.useCallback(g=>{i(g[0])},[i]),h=C.useCallback(()=>{e("click slider")},[e]),f=C.useCallback(()=>{o&&i(o)},[o,i]);return p.jsx("div",{className:"tlui-slider__container",children:p.jsxs(Fse,{"data-testid":a,className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:r,step:1,value:o?[o]:void 0,onPointerDown:h,onValueChange:u,onPointerUp:f,title:t+" — "+c(s),children:[p.jsx(Nse,{className:"tlui-slider__track",dir:"ltr",children:o!==null&&p.jsx($se,{className:"tlui-slider__range",dir:"ltr"})}),o!==null&&p.jsx(zse,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function Use({label:n,uiTypeA:e,uiTypeB:t,labelA:r,labelB:o,itemsA:s,itemsB:i,styleA:a,styleB:c,valueA:u,valueB:h,onValueChange:f}){const g=lt(),y=C.useMemo(()=>{var S;return((S=s.find(w=>u.type==="shared"&&u.value===w.value))==null?void 0:S.icon)??"mixed"},[s,u]),v=C.useMemo(()=>{var S;return((S=i.find(w=>h.type==="shared"&&h.value===w.value))==null?void 0:S.icon)??"mixed"},[i,h]);return u===void 0&&h===void 0?null:p.jsxs("div",{className:"tlui-style-panel__double-select-picker",children:[p.jsx("div",{title:g(n),className:"tlui-style-panel__double-select-picker-label",children:g(n)}),p.jsxs("div",{className:"tlui-buttons__horizontal",children:[p.jsxs(vl,{id:`style panel ${e} A`,children:[p.jsx(Sl,{children:p.jsx($e,{type:"icon","data-testid":`style.${e}`,title:g(r)+" — "+(u===null||u.type==="mixed"?g("style-panel.mixed"):g(`${e}-style.${u.value}`)),children:p.jsx(rt,{icon:y,small:!0,invertIcon:!0})})}),p.jsx(xl,{side:"left",align:"center",sideOffset:80,alignOffset:0,children:p.jsx("div",{className:"tlui-buttons__grid",children:s.map((S,w)=>p.jsx(Bd,{"data-testid":`style.${e}.${S.value}`,children:p.jsx($e,{type:"icon",onClick:()=>f(a,S.value),title:`${g(r)} — ${g(`${e}-style.${S.value}`)}`,children:p.jsx(rt,{icon:S.icon,invertIcon:!0})},S.value)},w))})})]}),p.jsxs(vl,{id:`style panel ${t}`,children:[p.jsx(Sl,{children:p.jsx($e,{type:"icon","data-testid":`style.${t}`,title:g(o)+" — "+(h===null||h.type==="mixed"?g("style-panel.mixed"):g(`${t}-style.${h.value}`)),children:p.jsx(rt,{icon:v,small:!0})})}),p.jsx(xl,{side:"left",align:"center",sideOffset:116,alignOffset:0,children:p.jsx("div",{className:"tlui-buttons__grid",children:i.map(S=>p.jsx(Bd,{children:p.jsx($e,{type:"icon",title:`${g(o)} — ${g(`${t}-style.${S.value}`)}`,"data-testid":`style.${t}.${S.value}`,onClick:()=>f(c,S.value),children:p.jsx(rt,{icon:S.icon})})},S.value))})})]})]})]})}const Hse=C.memo(Use);function Kse({id:n,label:e,uiType:t,stylePanelType:r,style:o,items:s,type:i,value:a,onValueChange:c}){const u=lt(),h=te(),f=C.useMemo(()=>{var S;return(S=s.find(w=>a.type==="shared"&&w.value===a.value))==null?void 0:S.icon},[s,a]),g=u(`style-panel.${r}`),y=a.type==="mixed"?u("style-panel.mixed"):g+" — "+u(`${t}-style.${a.value}`),v=e?u(e):"";return p.jsxs(vl,{id:`style panel ${n}`,children:[p.jsx(Sl,{children:p.jsxs($e,{type:i,"data-testid":`style.${t}`,title:y,children:[v&&p.jsx(an,{children:v}),p.jsx(rt,{icon:f??"mixed"})]})}),p.jsx(xl,{side:"left",align:"center",alignOffset:0,children:p.jsx("div",{className:"tlui-buttons__grid",children:s.map(S=>p.jsx(Bd,{children:p.jsx($e,{type:"icon","data-testid":`style.${t}.${S.value}`,title:g+" — "+u(`${t}-style.${S.value}`),onClick:()=>{h.markHistoryStoppingPoint("select style dropdown item"),c(o,S.value)},children:p.jsx(rt,{icon:S.icon})})},S.value))})})]})}const z_=C.memo(Kse);function Wse({styles:n}){const e=ah();if(!n)return null;const t=n.get(Zo),r=n.get(rg),o=n.get(ng),s=n.get(ag),i=n.get(Ls),a=t===void 0,c=r===void 0&&o===void 0,u=s===void 0,h=i===void 0,f=Ii({isDarkMode:e});return p.jsxs(p.Fragment,{children:[p.jsx(Vse,{theme:f,styles:n}),!h&&p.jsx(Gse,{theme:f,styles:n}),!(a&&c&&u)&&p.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[p.jsx(qse,{styles:n}),p.jsx(Xse,{styles:n}),p.jsx(Yse,{styles:n})]})]})}function gh(){const n=te(),e=Ln();return at.useMemo(()=>function(r,o){n.run(()=>{n.isIn("select")&&n.setStyleForSelectedShapes(r,o),n.setStyleForNextShapes(r,o),n.updateInstanceState({isChangingStyle:!0})}),e("set-style",{source:"style-panel",id:r.id,value:o})},[n,e])}function Vse({styles:n,theme:e}){const t=lt(),r=te(),o=C.useCallback(f=>r.markHistoryStoppingPoint(f),[r]),s=gh(),i=n.get(oo),a=n.get(fl),c=n.get(pl),u=n.get(Fs),h=a!==void 0||c!==void 0||u!==void 0;return p.jsxs(p.Fragment,{children:[p.jsxs("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[i===void 0?null:p.jsx(ol,{title:t("style-panel.color"),uiType:"color",style:oo,items:Io.color,value:i,onValueChange:s,theme:e,onHistoryMark:o}),p.jsx(Zse,{})]}),h&&p.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[a===void 0?null:p.jsx(ol,{title:t("style-panel.fill"),uiType:"fill",style:fl,items:Io.fill,value:a,onValueChange:s,theme:e,onHistoryMark:o}),c===void 0?null:p.jsx(ol,{title:t("style-panel.dash"),uiType:"dash",style:pl,items:Io.dash,value:c,onValueChange:s,theme:e,onHistoryMark:o}),u===void 0?null:p.jsx(ol,{title:t("style-panel.size"),uiType:"size",style:Fs,items:Io.size,value:u,onValueChange:(f,g)=>{s(f,g);const y=r.getSelectedShapeIds();y.length>0&&Rt(r,y)},theme:e,onHistoryMark:o})]})]})}function Gse({theme:n,styles:e}){const t=lt(),r=gh(),o=te(),s=C.useCallback(h=>o.markHistoryStoppingPoint(h),[o]),i=e.get(Ls),a=e.get(uw),c=e.get(sg),u=e.get(ig);return i===void 0&&c===void 0?null:p.jsxs("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[i===void 0?null:p.jsx(ol,{title:t("style-panel.font"),uiType:"font",style:Ls,items:Io.font,value:i,onValueChange:r,theme:n,onHistoryMark:s}),a===void 0?null:p.jsxs("div",{className:"tlui-style-panel__row",children:[p.jsx(ol,{title:t("style-panel.align"),uiType:"align",style:uw,items:Io.textAlign,value:a,onValueChange:r,theme:n,onHistoryMark:s}),p.jsx("div",{className:"tlui-style-panel__row__extra-button",children:p.jsx($e,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:p.jsx(rt,{icon:"vertical-align-middle"})})})]}),c===void 0?null:p.jsxs("div",{className:"tlui-style-panel__row",children:[p.jsx(ol,{title:t("style-panel.label-align"),uiType:"align",style:sg,items:Io.horizontalAlign,value:c,onValueChange:r,theme:n,onHistoryMark:s}),p.jsx("div",{className:"tlui-style-panel__row__extra-button",children:u===void 0?p.jsx($e,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:p.jsx(rt,{icon:"vertical-align-middle"})}):p.jsx(z_,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",stylePanelType:"vertical-align",style:ig,items:Io.verticalAlign,value:u,onValueChange:r})})]})]})}function qse({styles:n}){const e=gh(),t=n.get(Zo);return t===void 0?null:p.jsx(z_,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",stylePanelType:"geo",style:Zo,items:Io.geo,value:t,onValueChange:e})}function Yse({styles:n}){const e=gh(),t=n.get(ag);return t===void 0?null:p.jsx(z_,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",stylePanelType:"spline",style:ag,items:Io.spline,value:t,onValueChange:e})}function Xse({styles:n}){const e=gh(),t=n.get(rg),r=n.get(ng);return!t||!r?null:p.jsx(Hse,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:ng,itemsA:Io.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:rg,itemsB:Io.arrowheadEnd,valueB:t,onValueChange:e,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"})}const id=[.1,.25,.5,.75,1];function Zse(){const n=te(),e=C.useCallback(a=>n.markHistoryStoppingPoint(a),[n]),t=re("opacity",()=>n.getSharedOpacity(),[n]),r=Ln(),o=lt(),s=at.useCallback(a=>{const c=id[a];n.run(()=>{n.isIn("select")&&n.setOpacityForSelectedShapes(c),n.setOpacityForNextShapes(c),n.updateInstanceState({isChangingStyle:!0})}),r("set-style",{source:"style-panel",id:"opacity",value:a})},[n,r]);if(t===void 0)return null;const i=t.type==="mixed"?-1:id.indexOf(a8(id,a=>Math.abs(a-t.value)));return p.jsx(Bse,{"data-testid":"style.opacity",value:i>=0?i:id.length-1,label:t.type==="mixed"?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:s,steps:id.length-1,title:o("style-panel.opacity"),onHistoryMark:e})}const Qse=C.memo(function({isMobile:e,children:t}){const r=te(),o=C.useRef(null);ka(o);const s=U4(),i=C.useCallback(()=>{e||r.updateInstanceState({isChangingStyle:!1})},[r,e]),a=t??p.jsx(Wse,{styles:s});return p.jsx("div",{ref:o,className:Fe("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:i,children:a})});function Jse(){const n=te(),e=lt(),t=U4(),r=t==null?void 0:t.get(oo),o=Ii({isDarkMode:n.user.getIsDarkMode()}),s=((r==null?void 0:r.type)==="shared"?o[r.value]:o.black).solid,i=re("disable style panel",()=>n.isInAny("hand","zoom","eraser","laser"),[n]),a=C.useCallback(u=>{u||n.updateInstanceState({isChangingStyle:!1})},[n]),{StylePanel:c}=ja();return c?p.jsxs(D_,{id:"mobile style menu",onOpenChange:a,children:[p.jsx(L_,{children:p.jsx($e,{type:"tool","data-testid":"mobile-styles.button",style:{color:i?"var(--color-muted-1)":s},title:e("style-panel.title"),disabled:i,children:p.jsx(rt,{icon:i?"blob":(r==null?void 0:r.type)==="mixed"?"mixed":"blob"})})}),p.jsx(F_,{side:"top",align:"end",children:c&&p.jsx(c,{isMobile:!0})})]}):null}function eie(){return p.jsxs(p.Fragment,{children:[p.jsx(nie,{}),p.jsx(rie,{}),p.jsx(oie,{}),p.jsx(sie,{}),p.jsx(iie,{}),p.jsx(aie,{}),p.jsx(lie,{}),p.jsx(cie,{}),p.jsx(uie,{}),p.jsx(die,{}),p.jsx(pie,{}),p.jsx(hie,{}),p.jsx(mie,{}),p.jsx(Sie,{}),p.jsx(fie,{}),p.jsx(vie,{}),p.jsx(yie,{}),p.jsx(gie,{}),p.jsx(xie,{}),p.jsx(wie,{}),p.jsx(bie,{}),p.jsx(_ie,{}),p.jsx(Pie,{}),p.jsx(Cie,{}),p.jsx(Iie,{}),p.jsx(Eie,{}),p.jsx(Tie,{}),p.jsx(kie,{})]})}function tie(n){var r;const e=te(),t=(r=n.meta)==null?void 0:r.geo;return re("is tool selected",()=>{const o=e.getCurrentToolId(),s=e.getSharedStyles().getAsKnownValue(Zo);return t?o==="geo"&&s===t:o===n.id},[e,n.id,t])}function Tt({tool:n}){const e=m_(),t=tie(e[n]);return p.jsx(Er,{toolId:n,isSelected:t})}function nie(){return p.jsx(Tt,{tool:"select"})}function rie(){return p.jsx(Tt,{tool:"hand"})}function oie(){return p.jsx(Tt,{tool:"draw"})}function sie(){return p.jsx(Tt,{tool:"eraser"})}function iie(){return p.jsx(Tt,{tool:"arrow"})}function aie(){return p.jsx(Tt,{tool:"text"})}function lie(){return p.jsx(Tt,{tool:"note"})}function cie(){return p.jsx(Er,{toolId:"asset"})}function uie(){return p.jsx(Tt,{tool:"rectangle"})}function die(){return p.jsx(Tt,{tool:"ellipse"})}function hie(){return p.jsx(Tt,{tool:"diamond"})}function pie(){return p.jsx(Tt,{tool:"triangle"})}function fie(){return p.jsx(Tt,{tool:"rhombus"})}function gie(){return p.jsx(Tt,{tool:"heart"})}function mie(){return p.jsx(Tt,{tool:"hexagon"})}function yie(){return p.jsx(Tt,{tool:"cloud"})}function vie(){return p.jsx(Tt,{tool:"star"})}function Sie(){return p.jsx(Tt,{tool:"oval"})}function xie(){return p.jsx(Tt,{tool:"x-box"})}function wie(){return p.jsx(Tt,{tool:"check-box"})}function bie(){return p.jsx(Tt,{tool:"arrow-left"})}function _ie(){return p.jsx(Tt,{tool:"arrow-up"})}function Pie(){return p.jsx(Tt,{tool:"arrow-down"})}function Cie(){return p.jsx(Tt,{tool:"arrow-right"})}function Iie(){return p.jsx(Tt,{tool:"line"})}function Eie(){return p.jsx(Tt,{tool:"highlight"})}function kie(){return p.jsx(Tt,{tool:"frame"})}function Tie(){return p.jsx(Tt,{tool:"laser"})}const Ex=typeof navigator<"u"?navigator.userAgent.toLowerCase().indexOf("firefox")>0:!1;function kx(n,e,t,r){n.addEventListener?n.addEventListener(e,t,r):n.attachEvent&&n.attachEvent("on".concat(e),t)}function ad(n,e,t,r){n.removeEventListener?n.removeEventListener(e,t,r):n.detachEvent&&n.detachEvent("on".concat(e),t)}function r$(n,e){const t=e.slice(0,e.length-1);for(let r=0;r<t.length;r++)t[r]=n[t[r].toLowerCase()];return t}function o$(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function Mie(n,e){const t=n.length>=e.length?n:e,r=n.length>=e.length?e:n;let o=!0;for(let s=0;s<t.length;s++)r.indexOf(t[s])===-1&&(o=!1);return o}const Ud={backspace:8,"⌫":8,tab:9,clear:12,enter:13,"↩":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"⇪":20,",":188,".":190,"/":191,"`":192,"-":Ex?173:189,"=":Ex?61:187,";":Ex?59:186,"'":222,"[":219,"]":221,"\\":220},Bs={"⇧":16,shift:16,"⌥":18,alt:18,option:18,"⌃":17,ctrl:17,control:17,"⌘":91,cmd:91,command:91},ub={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},In={16:!1,18:!1,17:!1,91:!1},Xt={};for(let n=1;n<20;n++)Ud["f".concat(n)]=111+n;let Ot=[],Id=null,s$="all";const ci=new Map,mh=n=>Ud[n.toLowerCase()]||Bs[n.toLowerCase()]||n.toUpperCase().charCodeAt(0),Aie=n=>Object.keys(Ud).find(e=>Ud[e]===n),jie=n=>Object.keys(Bs).find(e=>Bs[e]===n);function i$(n){s$=n||"all"}function Hd(){return s$||"all"}function Rie(){return Ot.slice(0)}function Oie(){return Ot.map(n=>Aie(n)||jie(n)||String.fromCharCode(n))}function Die(){const n=[];return Object.keys(Xt).forEach(e=>{Xt[e].forEach(t=>{let{key:r,scope:o,mods:s,shortcut:i}=t;n.push({scope:o,shortcut:i,mods:s,keys:r.split("+").map(a=>mh(a))})})}),n}function Lie(n){const e=n.target||n.srcElement,{tagName:t}=e;let r=!0;const o=t==="INPUT"&&!["checkbox","radio","range","button","file","reset","submit","color"].includes(e.type);return(e.isContentEditable||(o||t==="TEXTAREA"||t==="SELECT")&&!e.readOnly)&&(r=!1),r}function Fie(n){return typeof n=="string"&&(n=mh(n)),Ot.indexOf(n)!==-1}function Nie(n,e){let t,r;n||(n=Hd());for(const o in Xt)if(Object.prototype.hasOwnProperty.call(Xt,o))for(t=Xt[o],r=0;r<t.length;)t[r].scope===n?t.splice(r,1).forEach(i=>{let{element:a}=i;return B_(a)}):r++;Hd()===n&&i$(e||"all")}function $ie(n){let e=n.keyCode||n.which||n.charCode;const t=Ot.indexOf(e);if(t>=0&&Ot.splice(t,1),n.key&&n.key.toLowerCase()==="meta"&&Ot.splice(0,Ot.length),(e===93||e===224)&&(e=91),e in In){In[e]=!1;for(const r in Bs)Bs[r]===e&&(Dr[r]=!1)}}function a$(n){if(typeof n>"u")Object.keys(Xt).forEach(o=>{Array.isArray(Xt[o])&&Xt[o].forEach(s=>of(s)),delete Xt[o]}),B_(null);else if(Array.isArray(n))n.forEach(o=>{o.key&&of(o)});else if(typeof n=="object")n.key&&of(n);else if(typeof n=="string"){for(var e=arguments.length,t=new Array(e>1?e-1:0),r=1;r<e;r++)t[r-1]=arguments[r];let[o,s]=t;typeof o=="function"&&(s=o,o=""),of({key:n,scope:o,method:s,splitKey:"+"})}}const of=n=>{let{key:e,scope:t,method:r,splitKey:o="+"}=n;o$(e).forEach(i=>{const a=i.split(o),c=a.length,u=a[c-1],h=u==="*"?"*":mh(u);if(!Xt[h])return;t||(t=Hd());const f=c>1?r$(Bs,a):[],g=[];Xt[h]=Xt[h].filter(y=>{const S=(r?y.method===r:!0)&&y.scope===t&&Mie(y.mods,f);return S&&g.push(y.element),!S}),g.forEach(y=>B_(y))})};function SM(n,e,t,r){if(e.element!==r)return;let o;if(e.scope===t||e.scope==="all"){o=e.mods.length>0;for(const s in In)Object.prototype.hasOwnProperty.call(In,s)&&(!In[s]&&e.mods.indexOf(+s)>-1||In[s]&&e.mods.indexOf(+s)===-1)&&(o=!1);(e.mods.length===0&&!In[16]&&!In[18]&&!In[17]&&!In[91]||o||e.shortcut==="*")&&(e.keys=[],e.keys=e.keys.concat(Ot),e.method(n,e)===!1&&(n.preventDefault?n.preventDefault():n.returnValue=!1,n.stopPropagation&&n.stopPropagation(),n.cancelBubble&&(n.cancelBubble=!0)))}}function xM(n,e){const t=Xt["*"];let r=n.keyCode||n.which||n.charCode;if(!Dr.filter.call(this,n))return;if((r===93||r===224)&&(r=91),Ot.indexOf(r)===-1&&r!==229&&Ot.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(a=>{const c=ub[a];n[a]&&Ot.indexOf(c)===-1?Ot.push(c):!n[a]&&Ot.indexOf(c)>-1?Ot.splice(Ot.indexOf(c),1):a==="metaKey"&&n[a]&&Ot.length===3&&(n.ctrlKey||n.shiftKey||n.altKey||(Ot=Ot.slice(Ot.indexOf(c))))}),r in In){In[r]=!0;for(const a in Bs)Bs[a]===r&&(Dr[a]=!0);if(!t)return}for(const a in In)Object.prototype.hasOwnProperty.call(In,a)&&(In[a]=n[ub[a]]);n.getModifierState&&!(n.altKey&&!n.ctrlKey)&&n.getModifierState("AltGraph")&&(Ot.indexOf(17)===-1&&Ot.push(17),Ot.indexOf(18)===-1&&Ot.push(18),In[17]=!0,In[18]=!0);const o=Hd();if(t)for(let a=0;a<t.length;a++)t[a].scope===o&&(n.type==="keydown"&&t[a].keydown||n.type==="keyup"&&t[a].keyup)&&SM(n,t[a],o,e);if(!(r in Xt))return;const s=Xt[r],i=s.length;for(let a=0;a<i;a++)if((n.type==="keydown"&&s[a].keydown||n.type==="keyup"&&s[a].keyup)&&s[a].key){const c=s[a],{splitKey:u}=c,h=c.key.split(u),f=[];for(let g=0;g<h.length;g++)f.push(mh(h[g]));f.sort().join("")===Ot.sort().join("")&&SM(n,c,o,e)}}function Dr(n,e,t){Ot=[];const r=o$(n);let o=[],s="all",i=document,a=0,c=!1,u=!0,h="+",f=!1,g=!1;for(t===void 0&&typeof e=="function"&&(t=e),Object.prototype.toString.call(e)==="[object Object]"&&(e.scope&&(s=e.scope),e.element&&(i=e.element),e.keyup&&(c=e.keyup),e.keydown!==void 0&&(u=e.keydown),e.capture!==void 0&&(f=e.capture),typeof e.splitKey=="string"&&(h=e.splitKey),e.single===!0&&(g=!0)),typeof e=="string"&&(s=e),g&&a$(n,s);a<r.length;a++)n=r[a].split(h),o=[],n.length>1&&(o=r$(Bs,n)),n=n[n.length-1],n=n==="*"?"*":mh(n),n in Xt||(Xt[n]=[]),Xt[n].push({keyup:c,keydown:u,scope:s,mods:o,shortcut:r[a],method:t,key:r[a],splitKey:h,element:i});if(typeof i<"u"&&window){if(!ci.has(i)){const y=function(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;return xM(S,i)},v=function(){let S=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.event;xM(S,i),$ie(S)};ci.set(i,{keydownListener:y,keyupListenr:v,capture:f}),kx(i,"keydown",y,f),kx(i,"keyup",v,f)}if(!Id){const y=()=>{Ot=[]};Id={listener:y,capture:f},kx(window,"focus",y,f)}}}function zie(n){let e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"all";Object.keys(Xt).forEach(t=>{Xt[t].filter(o=>o.scope===e&&o.shortcut===n).forEach(o=>{o&&o.method&&o.method()})})}function B_(n){const e=Object.values(Xt).flat();if(e.findIndex(r=>{let{element:o}=r;return o===n})<0){const{keydownListener:r,keyupListenr:o,capture:s}=ci.get(n)||{};r&&o&&(ad(n,"keyup",o,s),ad(n,"keydown",r,s),ci.delete(n))}if((e.length<=0||ci.size<=0)&&(Object.keys(ci).forEach(o=>{const{keydownListener:s,keyupListenr:i,capture:a}=ci.get(o)||{};s&&i&&(ad(o,"keyup",i,a),ad(o,"keydown",s,a),ci.delete(o))}),ci.clear(),Object.keys(Xt).forEach(o=>delete Xt[o]),Id)){const{listener:o,capture:s}=Id;ad(window,"focus",o,s),Id=null}}const Tx={getPressedKeyString:Oie,setScope:i$,getScope:Hd,deleteScope:Nie,getPressedKeyCodes:Rie,getAllKeyCodes:Die,isPressed:Fie,filter:Lie,trigger:zie,unbind:a$,keyMap:Ud,modifier:Bs,modifierMap:ub};for(const n in Tx)Object.prototype.hasOwnProperty.call(Tx,n)&&(Dr[n]=Tx[n]);if(typeof window<"u"){const n=window.hotkeys;Dr.noConflict=e=>(e&&window.hotkeys===Dr&&(window.hotkeys=n),Dr),window.hotkeys=Dr}const wM=["copy","cut","paste","asset"];function Bie(){const n=te(),e=ao(),t=kl(),r=m_(),o=re("is focused",()=>n.getInstanceState().isFocused,[n]);C.useEffect(()=>{if(!o)return;const s=new Array,i=(c,u)=>{Dr(c,{element:document.body},u),s.push(()=>{Dr.unbind(c,u)})},a=(c,u)=>{Dr(c,{element:document.body,keyup:!0,keydown:!1},u),s.push(()=>{Dr.unbind(c,u)})};for(const c of Object.values(t))c.kbd&&(e&&!c.readonlyOk||wM.includes(c.id)||i(bM(c.kbd),u=>{vd(n)||(et(u),c.onSelect("kbd"))}));for(const c of Object.values(r))!c.kbd||!c.readonlyOk&&n.getIsReadonly()||wM.includes(c.id)||i(bM(c.kbd),u=>{vd(n)||(et(u),c.onSelect("kbd"))});return i(",",c=>{if(vd(n)||n.inputs.keys.has("Comma"))return;et(c),n.focus(),n.inputs.keys.add("Comma");const{x:u,y:h,z:f}=n.inputs.currentPagePoint,g=n.pageToScreen({x:u,y:h}),y={type:"pointer",name:"pointer_down",point:{x:g.x,y:g.y,z:f},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:qn(c),pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(y)}),a(",",c=>{if(vd(n)||!n.inputs.keys.has("Comma"))return;n.inputs.keys.delete("Comma");const{x:u,y:h,z:f}=n.inputs.currentScreenPoint,g={type:"pointer",name:"pointer_up",point:{x:u,y:h,z:f},shiftKey:c.shiftKey,altKey:c.altKey,ctrlKey:c.metaKey||c.ctrlKey,metaKey:c.metaKey,accelKey:qn(c),pointerId:0,button:0,isPen:n.getInstanceState().isPenMode,target:"canvas"};n.dispatch(g)}),()=>{s.forEach(c=>c())}},[t,r,e,n,o])}function bM(n){return Uie(n).map(e=>{let t="";const r=e.split("");return r.length===1?t=r[0]:r[0]==="!"?t=`shift+${r[1]}`:r[0]==="?"?r.length===3&&r[1]==="!"?t=`alt+shift+${r[2]}`:t=`alt+${r[1]}`:r[0]==="$"?r[1]==="!"?t=`cmd+shift+${r[2]},ctrl+shift+${r[2]}`:r[1]==="?"?t=`cmd+⌥+${r[2]},ctrl+alt+${r[2]}`:t=`cmd+${r[1]},ctrl+${r[1]}`:t=e,t}).join(",")}function Uie(n){typeof n!="string"&&(n=""),n=n.replace(/\s/g,"");const e=n.split(",");let t=e.lastIndexOf("");for(;t>=0;)e[t-1]+=",",e.splice(t,1),t=e.lastIndexOf("");return e}function vd(n){return n.menus.hasAnyOpenMenus()||n.getEditingShapeId()!==null||n.getCrashingError()}const Hie=C.createContext(!1);function Kie({children:n}){const e=te(),t=nu(),r=hr(),o=lt(),s=Math.min(8,5+r),[i,a]=C.useState(0),c=C.useRef(null),[u,h]=C.useState(null),f=C.useMemo(()=>{const y=u?`:not([data-value="${u}"])`:"";return`
			#${t}_main > *:nth-child(n + ${s+(u?1:2)})${y} {
				display: none;
			}
			#${t}_more > *:nth-child(-n + ${s}) {
				display: none;
			}
        `},[u,t,s]),g=Jg(()=>{if(!c.current)return;const y=Array.from(c.current.children);a(y.length),y.findIndex(w=>w.getAttribute("data-value")===u)<=s&&h(null);const S=Array.from(c.current.children).findIndex(w=>w.getAttribute("aria-checked")==="true");S!==-1&&S>=s&&h(y[S].getAttribute("data-value"))});return C.useLayoutEffect(()=>{g()}),C.useLayoutEffect(()=>{if(!c.current)return;const y=new MutationObserver(g);return y.observe(c.current,{childList:!0,subtree:!0,attributeFilter:["data-value","aria-checked"]}),()=>{y.disconnect()}},[g]),C.useEffect(()=>{const y=[["1",0],["2",1],["3",2],["4",3],["5",4],["6",5],["7",6],["8",7],["9",8],["0",9]];for(const[v,S]of y)Dr(v,w=>{var T;if(vd(e))return;et(w);const _=Array.from(((T=c.current)==null?void 0:T.children)??[]).filter(E=>!(E instanceof HTMLElement)||E.tagName.toLowerCase()!=="button"?!1:!!(E.offsetWidth||E.offsetHeight))[S];_&&_.click()});return()=>{Dr.unbind("1,2,3,4,5,6,7,8,9,0")}},[e]),p.jsxs(p.Fragment,{children:[p.jsx("style",{children:f}),p.jsxs("div",{className:Fe("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":r<en.TABLET_SM}),role:"radiogroup",children:[p.jsx("div",{id:`${t}_main`,ref:c,className:"tlui-toolbar__tools__list",children:p.jsx(Mo,{type:"toolbar",sourceId:"toolbar",children:n})}),i>s+1&&p.jsx(Hie.Provider,{value:!0,children:p.jsxs(vl,{id:"toolbar overflow",modal:!1,children:[p.jsx(Sl,{children:p.jsx($e,{title:o("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:p.jsx(rt,{icon:"chevron-up"})})}),p.jsx(xl,{side:"top",align:"center",children:p.jsx("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",id:`${t}_more`,children:p.jsx(Mo,{type:"toolbar-overflow",sourceId:"toolbar",children:n})})})]})})]})]})}function Wie({activeToolId:n}){const e=te(),t=hr(),r=lt(),o=re("is tool locked",()=>e.getInstanceState().isToolLocked,[e]),s=re("current tool",()=>e.getCurrentTool(),[e]);return!n||!s.isLockable?null:p.jsx($e,{type:"normal",title:r("action.toggle-tool-lock"),"data-testid":"tool-lock",className:Fe("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":t<en.TABLET_SM}),onClick:()=>e.updateInstanceState({isToolLocked:!o}),children:p.jsx(rt,{icon:o?"lock":"unlock",small:!0})})}const Vie=C.memo(function({children:e}){const t=te(),r=hr(),o=ao(),s=re("current tool id",()=>t.getCurrentToolId(),[t]),i=C.useRef(null);ka(i);const{ActionsMenu:a,QuickActions:c}=ja(),u=t.options.actionShortcutsLocation==="menu"?!1:t.options.actionShortcutsLocation==="toolbar"?!0:r<en.TABLET;return p.jsx("div",{ref:i,className:"tlui-toolbar",children:p.jsxs("div",{className:"tlui-toolbar__inner",children:[p.jsxs("div",{className:"tlui-toolbar__left",children:[!o&&p.jsxs("div",{className:"tlui-toolbar__extras",children:[u&&p.jsxs("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[c&&p.jsx(c,{}),a&&p.jsx(a,{})]}),p.jsx(Wie,{activeToolId:s})]}),p.jsx(Kie,{children:e??p.jsx(eie,{})})]}),r<en.TABLET_SM&&!o&&p.jsx("div",{className:"tlui-toolbar__tools",children:p.jsx(Jse,{})})]})})});function Gie(){const n=lt();return p.jsxs("div",{className:Fe("tlui-offline-indicator"),children:[n("status.offline"),p.jsx($s,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function qie({maxWidth:n=420,ignoreRightWidth:e=0,stylePanelWidth:t=148,marginBetweenZones:r=12,squeezeAmount:o=52,children:s}){const i=C.useRef(null),a=hr(),c=C.useCallback(()=>{const u=i.current;if(!u)return;const h=u.parentElement.parentElement,f=h.querySelector(".tlui-layout__top__left"),g=h.querySelector(".tlui-layout__top__right"),y=h.offsetWidth,v=f.offsetWidth,S=g.offsetWidth,w=u.offsetWidth-e;let b=(y-w)/2;y%2!==0&&(b-=.5);const _=v+r,T=u.offsetLeft,E=Math.min(y-S-v-2*r,n),M=Math.max(b,_)-T;g.offsetWidth>t&&a<=6?u.style.setProperty("max-width",E-o+"px"):u.style.setProperty("max-width",E+"px"),u.style.setProperty("transform",`translate(${M}px, 0px)`)},[a,e,r,n,o,t]);return C.useLayoutEffect(()=>{const u=i.current;if(!u)return;const h=u.parentElement.parentElement,f=h.querySelector(".tlui-layout__top__left"),g=h.querySelector(".tlui-layout__top__right"),y=new ResizeObserver(c);return y.observe(f),y.observe(g),y.observe(h),y.observe(u),c(),()=>{y.disconnect()}},[c]),C.useLayoutEffect(()=>{c()}),p.jsx("div",{ref:i,className:"tlui-top-panel__container",children:s})}function Yie(){const n=pQ()==="offline";return p.jsx(qie,{children:n&&p.jsx(Gie,{})})}function Xie(){return p.jsxs(p.Fragment,{children:[p.jsx(le,{actionId:"zoom-in",noClose:!0}),p.jsx(le,{actionId:"zoom-out",noClose:!0}),p.jsx(f4,{}),p.jsx(g4,{}),p.jsx(m4,{})]})}const Zie=C.memo(function({children:e}){const t=fn(),[r,o]=Ti("zoom menu"),s=e??p.jsx(Xie,{});return p.jsxs(J1,{dir:"ltr",open:r,onOpenChange:o,modal:!1,children:[p.jsx(e_,{asChild:!0,dir:"ltr",children:p.jsx(Qie,{})}),p.jsx(ym,{container:t,children:p.jsx(t_,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:p.jsx(Mo,{type:"menu",sourceId:"zoom-menu",children:s})})})]})}),Qie=C.forwardRef(function(e,t){const r=te(),o=hr(),s=re("zoom",()=>r.getZoomLevel(),[r]),i=lt(),a=C.useCallback(()=>{r.resetZoom(r.getViewportScreenCenter(),{animation:{duration:r.options.animationMediumMs}})},[r]);return p.jsx($e,{ref:t,...e,type:"icon",title:`${i("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:o<en.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,children:o<en.MOBILE?null:p.jsxs("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(s*100),"%"]})})}),l$=C.createContext(null);function Jie({overrides:n={},children:e}){const t=ou(n),r=bm();return p.jsx(l$.Provider,{value:C.useMemo(()=>({ContextMenu:moe,ActionsMenu:Kre,HelpMenu:null,ZoomMenu:Zie,MainMenu:Xoe,Minimap:ise,StylePanel:Qse,PageMenu:use,NavigationPanel:lse,Toolbar:Vie,KeyboardShortcutsDialog:$oe,QuickActions:hse,HelperButtons:Foe,DebugPanel:koe,DebugMenu:Eoe,MenuPanel:joe,SharePanel:r?Sse:null,CursorChatBubble:r?Soe:null,TopPanel:r?Yie:null,...t}),[t,r]),children:e})}function ja(){const n=C.useContext(l$);if(!n)throw new Error("useTldrawUiComponents must be used within a TldrawUiComponentsProvider");return n}const eae=On(function({overrides:e,components:t,assetUrls:r,onUiEvent:o,forceMobile:s,mediaMimeTypes:i,children:a}){const c=Ia();return p.jsx(yF.Provider,{value:i,children:p.jsx(zZ,{assetUrls:vre(r),children:p.jsx(HZ,{overrides:HJ(e),locale:(c==null?void 0:c.user.getLocale())??bs.locale,children:p.jsx(xq,{onEvent:o,children:p.jsx(NQ,{children:p.jsx(gQ,{context:c==null?void 0:c.contextId,children:p.jsx(fQ,{forceMobile:s,children:p.jsx(Jie,{overrides:t,children:c?p.jsx(tae,{overrides:e,children:a}):a})})})})})})})})});function tae({overrides:n,children:e}){const t=KJ(n);return p.jsx(VJ,{overrides:t.actions,children:p.jsx(lee,{overrides:t.tools,children:e})})}function nae(){const n=te(),{addToast:e}=ki();C.useEffect(()=>{function t({name:r,count:o}){e({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${r} (${o}). Please delete some shapes or move to a different page to continue.`,severity:"warning"})}return n.addListener("max-shapes",t),()=>{n.removeListener("max-shapes",t)}},[n,e])}const rae=at.memo(function({renderDebugMenuItems:e,children:t,hideUi:r,components:o,...s}){return p.jsx(eae,{...s,components:o,children:p.jsx(oae,{hideUi:r,renderDebugMenuItems:e,children:t})})}),oae=at.memo(function({children:e,hideUi:t,...r}){return p.jsxs(p.Fragment,{children:[e,t?null:p.jsx(sae,{...r})]})}),sae=at.memo(function(){const e=te(),t=lt(),r=hr(),o=ao(),s=re("focus",()=>e.getInstanceState().isFocusMode,[e]),i=re("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:a,TopPanel:c,MenuPanel:u,StylePanel:h,Toolbar:f,HelpMenu:g,NavigationPanel:y,HelperButtons:v,DebugPanel:S,CursorChatBubble:w}=ja();Bie(),gJ(),nae();const{"toggle-focus-mode":b}=kl();return p.jsxs("div",{className:Fe("tlui-layout",{"tlui-layout__mobile":r<en.TABLET_SM}),"data-breakpoint":r,children:[s?p.jsx("div",{className:"tlui-layout__top",children:p.jsx($e,{type:"icon",className:"tlui-focus-button",title:t("focus-mode.toggle-focus-mode"),onClick:()=>b.onSelect("menu"),children:p.jsx(rt,{icon:"dot"})})}):p.jsxs(p.Fragment,{children:[p.jsxs("div",{className:"tlui-layout__top",children:[p.jsxs("div",{className:"tlui-layout__top__left",children:[u&&p.jsx(u,{}),v&&p.jsx(v,{})]}),p.jsx("div",{className:"tlui-layout__top__center",children:c&&p.jsx(c,{})}),p.jsxs("div",{className:"tlui-layout__top__right",children:[a&&p.jsx(a,{}),h&&r>=en.TABLET_SM&&!o&&p.jsx(h,{})]})]}),p.jsxs("div",{className:"tlui-layout__bottom",children:[p.jsxs("div",{className:"tlui-layout__bottom__main",children:[y&&p.jsx(y,{}),f&&p.jsx(f,{}),g&&p.jsx(g,{})]}),i&&S&&p.jsx(S,{})]})]}),p.jsx(aee,{}),p.jsx(ree,{}),p.jsx(gre,{}),w&&p.jsx(w,{})]})});async function iae(n,e){const{url:t,style:r="normal",weight:o="500",display:s,featureSettings:i,stretch:a,unicodeRange:c,variant:u,format:h}=e,f={style:r,weight:o,display:s,featureSettings:i,stretch:a,unicodeRange:c,variant:u},g=new FontFace(n,`url(${t})`,f);return await g.load(),document.fonts.add(g),g.$$_url=t,g.$$_fontface=`
@font-face {
	font-family: ${g.family};
	font-stretch: ${g.stretch};
	font-weight: ${g.weight};
	font-style: ${g.style};
	src: url("${t}") format("${h}")
}`,g}const sf=(n,e)=>{const[t,r]=C.useState(2);return C.useEffect(()=>{let o=!1;return r(2),iae(n,e).then(()=>{o||r(0)}).catch(s=>{o||(console.error(s),r(1))}),()=>{o=!0}},[n,e]),t};function aae(n){return{draw:{url:n.fonts.draw,format:n.fonts.draw.split(".").pop()},serif:{url:n.fonts.serif,format:n.fonts.serif.split(".").pop()},sansSerif:{url:n.fonts.sansSerif,format:n.fonts.sansSerif.split(".").pop()},monospace:{url:n.fonts.monospace,format:n.fonts.monospace.split(".").pop()}}}function c$(n){const e=C.useMemo(()=>aae(n),[n]),t=[sf("tldraw_draw",e.draw),sf("tldraw_serif",e.serif),sf("tldraw_sans",e.sansSerif),sf("tldraw_mono",e.monospace)];return{error:t.some(r=>r===1),done:!t.some(r=>r===2)}}function lae(n){const{children:e,maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:o,acceptedVideoMimeTypes:s,onMount:i,components:a={},shapeUtils:c=[],bindingUtils:u=[],tools:h=[],embeds:f,...g}=n,y=ou(a),v=C.useMemo(()=>({Scribble:jT,ShapeIndicators:See,CollaboratorScribble:jT,SelectionForeground:mee,SelectionBackground:fee,Handles:cee,...y}),[y]),S=aa(c),w=C.useMemo(()=>[...oN,...S],[S]),b=aa(u),_=C.useMemo(()=>[...CF,...b],[b]),T=aa(h),E=C.useMemo(()=>[...fre,...rte,...T],[T]),M=aa(o??jg),A=aa(s??Ib),R=C.useMemo(()=>[...M,...A],[M,A]),L=UN(g.assetUrls),{done:K,error:D}=c$(L);return D?p.jsx(F3,{children:"Could not load assets. Please refresh the page."}):K?(w.find(V=>V.type==="embed")&&f&&Ig.setEmbedDefinitions(f),p.jsx(sq,{initialState:"select",...g,components:v,shapeUtils:w,bindingUtils:_,tools:E,children:p.jsxs(rae,{...g,components:v,mediaMimeTypes:R,children:[p.jsx(cae,{maxImageDimension:t,maxAssetSize:r,acceptedImageMimeTypes:M,acceptedVideoMimeTypes:A,onMount:i}),e]})})):p.jsx(A1,{children:p.jsx(f1,{})})}function cae({maxImageDimension:n=5e3,maxAssetSize:e=10*1024*1024,acceptedImageMimeTypes:t=jg,acceptedVideoMimeTypes:r=Ib,onMount:o}){const s=te(),i=ki(),a=lt();N3(()=>{const h=[];return h.push(Nne(s)),Lee(s,{maxImageDimension:n,maxAssetSize:e,acceptedImageMimeTypes:t,acceptedVideoMimeTypes:r},{toasts:i,msg:a}),h.push(s.store.props.onMount(s)),h.push(o==null?void 0:o(s)),()=>{h.forEach(f=>f==null?void 0:f())}});const{Canvas:c}=Bt(),{ContextMenu:u}=ja();return u?p.jsx(u,{}):c?p.jsx(c,{}):null}C.memo(function(e){const[t,r]=C.useState(null),[o,s]=C.useState(null),i=aa(e.shapeUtils??[]),a=C.useMemo(()=>[...oN,...i],[i]),c=aa(e.bindingUtils??[]),u=C.useMemo(()=>[...CF,...c],[c]),h=hq({snapshot:e.snapshot,shapeUtils:a}),f=UN(e.assetUrls),{done:g,error:y}=c$(f),{pageId:v,bounds:S,scale:w,pixelRatio:b,background:_,padding:T,darkMode:E,preserveAspectRatio:M,format:A="svg",licenseKey:R}=e;return C.useLayoutEffect(()=>{if(!o||!h||!g)return;let L=!1;const K=document.createElement("div");o.appendChild(K),o.classList.add("tl-container","tl-theme__light");const D=new be({store:h,shapeUtils:a,bindingUtils:u,tools:[],getContainer:()=>K,licenseKey:R});v&&D.setCurrentPage(v);const U=D.getCurrentPageShapeIds();async function V(){const F=await D.getSvgString([...U],{bounds:S,scale:w,background:_,padding:T,darkMode:E,preserveAspectRatio:M});if(F&&!L){if(A==="svg"){if(!L){const $=new Blob([F.svg],{type:"image/svg+xml"}),H=URL.createObjectURL($);r(H)}}else if(A==="png"){const $=await fF(D,F.svg,{type:A,width:F.width,height:F.height,pixelRatio:b});if($&&!L){const H=URL.createObjectURL($);r(H)}}}D.dispose()}return V(),()=>{L=!0}},[A,o,h,a,u,v,S,w,_,T,E,M,g,y,R,b]),y?p.jsx(F3,{children:"Could not load assets."}):g?p.jsx("div",{ref:s,style:{position:"relative",width:"100%",height:"100%"},children:t&&p.jsx("img",{src:t,referrerPolicy:"strict-origin-when-cross-origin",style:{width:"100%",height:"100%"}})}):p.jsx(A1,{children:p.jsx(f1,{})})});C.memo(function({children:e}){const t=lt(),r=hr(),o=C.useRef(null);ka(o);const s=e??p.jsx(zoe,{});return r<en.MOBILE?null:p.jsx("div",{ref:o,className:"tlui-help-menu",children:p.jsxs(vl,{id:"help menu",children:[p.jsx(Sl,{children:p.jsx($e,{type:"help",title:t("help-menu.title"),"data-testid":"help-menu.button",children:p.jsx(rt,{icon:"question-mark",small:!0})})}),p.jsx(xl,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:p.jsx(Mo,{type:"menu",sourceId:"help-menu",children:s})})]})})});const uae=ot({schemaVersion:Qn(1),storeVersion:cf,recordVersions:eg(Qe,ot({version:cf,subTypeVersions:eg(Qe,cf).optional(),subTypeKey:Qe.optional()}))}),dae=ot({schemaVersion:Qn(2),sequences:eg(Qe,cf)});ot({tldrawFileFormatVersion:O9,schema:D9("schemaVersion",{1:uae,2:dae}),records:Tn(ot({id:Qe,typeName:Qe}).allowUnknownProperties())});ba("tldraw","3.6.0","esm");function db(n,e){(e==null||e>n.length)&&(e=n.length);for(var t=0,r=Array(e);t<e;t++)r[t]=n[t];return r}function hae(n){if(Array.isArray(n))return n}function pae(n){if(Array.isArray(n))return db(n)}function fae(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function Fm(n,e,t){return e=hb(e),xae(n,u$()?Reflect.construct(e,t||[],hb(n).constructor):e.apply(n,t))}function yh(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function _M(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,kg(r.key),r)}}function vh(n,e,t){return e&&_M(n.prototype,e),t&&_M(n,t),Object.defineProperty(n,"prototype",{writable:!1}),n}function uu(n,e,t){return(e=kg(e))in n?Object.defineProperty(n,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):n[e]=t,n}function bl(){return(bl=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t,r=arguments[e];for(t in r)!{}.hasOwnProperty.call(r,t)||(n[t]=r[t])}return n}).apply(null,arguments)}function hb(n){return(hb=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(n)}function Nm(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&d$(n,e)}function u$(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(u$=function(){return!!n})()}function gae(n){if(typeof Symbol<"u"&&n[Symbol.iterator]!=null||n["@@iterator"]!=null)return Array.from(n)}function mae(n,e){var t=n==null?null:typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(t!=null){var r,o,s,i,a=[],c=!0,u=!1;try{if(s=(t=t.call(n)).next,e!==0)for(;!(c=(r=s.call(t)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(h){u=!0,o=h}finally{try{if(!c&&t.return!=null&&(i=t.return(),Object(i)!==i))return}finally{if(u)throw o}}return a}}function yae(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vae(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function PM(n,e){var t,r=Object.keys(n);return Object.getOwnPropertySymbols&&(t=Object.getOwnPropertySymbols(n),e&&(t=t.filter(function(o){return Object.getOwnPropertyDescriptor(n,o).enumerable})),r.push.apply(r,t)),r}function he(n){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?PM(Object(t),!0).forEach(function(r){uu(n,r,t[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(t)):PM(Object(t)).forEach(function(r){Object.defineProperty(n,r,Object.getOwnPropertyDescriptor(t,r))})}return n}function Eo(n,e){if(n==null)return{};var t,r=Sae(n,e);if(Object.getOwnPropertySymbols)for(var o=Object.getOwnPropertySymbols(n),s=0;s<o.length;s++)t=o[s],e.includes(t)||{}.propertyIsEnumerable.call(n,t)&&(r[t]=n[t]);return r}function Sae(n,e){if(n==null)return{};var t,r={};for(t in n)if({}.hasOwnProperty.call(n,t)){if(e.includes(t))continue;r[t]=n[t]}return r}function xae(n,e){if(e&&(typeof e=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return fae(n)}function d$(n,e){return(d$=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t})(n,e)}function CM(n,e){return hae(n)||mae(n,e)||h$(n,e)||yae()}function $m(n){return pae(n)||gae(n)||h$(n)||vae()}function wae(n,e){if(typeof n!="object"||!n)return n;var t=n[Symbol.toPrimitive];if(t===void 0)return(e==="string"?String:Number)(n);if(t=t.call(n,e||"default"),typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}function kg(n){return n=wae(n,"string"),typeof n=="symbol"?n:n+""}function jn(n){return(jn=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(n)}function h$(n,e){var t;if(n)return typeof n=="string"?db(n,e):(t=(t={}.toString.call(n).slice(8,-1))==="Object"&&n.constructor?n.constructor.name:t)==="Map"||t==="Set"?Array.from(n):t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?db(n,e):void 0}var p$={react:{componentWrap:"div",slotWrap:"div",componentWrapAttrs:{__use_react_component_wrap:"",style:{all:"unset"}},slotWrapAttrs:{__use_react_slot_wrap:"",style:{all:"unset"}},vueNamedSlotsKey:["node:"]},vue:{componentWrapHOC:function(n){return function(){var e=(0<arguments.length&&arguments[0]!==void 0?arguments[0]:{}).portals;return C.createElement(C.Fragment,null,n,(e===void 0?[]:e).map(function(t){var r=t.Portal;return C.createElement(r,{key:t.key})}))}},componentWrapAttrs:{"data-use-vue-component-wrap":"",style:{all:"unset"}},slotWrapAttrs:{"data-use-vue-slot-wrap":"",style:{all:"unset"}}}};function f$(){var n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{react:{},vue:{}},t=1<arguments.length&&arguments[1]!==void 0?arguments[1]:p$,e=2<arguments.length?arguments[2]:void 0,t=(n.vue||(n.vue={}),n.react||(n.react={}),[t,he(he({},n),{},{react:he(he(he({},t.react),n.react),{},{componentWrapAttrs:he(he({},t.react.componentWrapAttrs),n.react.componentWrapAttrs),slotWrapAttrs:he(he({},t.react.slotWrapAttrs),n.react.slotWrapAttrs)}),vue:he(he(he({},t.vue),n.vue),{},{componentWrapAttrs:he(he({},t.vue.componentWrapAttrs),n.vue.componentWrapAttrs),slotWrapAttrs:he(he({},t.vue.slotWrapAttrs),n.vue.slotWrapAttrs)})})]);return e&&t.unshift({}),Object.assign.apply(this,t)}var g$=["getElementById","getElementsByClassName","getElementsByTagName","getElementsByTagNameNS","querySelector","querySelectorAll"],jc={Document:{},Element:{}};function bae(n){Object.keys(jc).forEach(function(e){g$.forEach(function(t){var r=jc[e][t]||window[e].prototype[t];r&&(jc[e][t]=r,window[e].prototype[t]=function(){for(var o=arguments.length,s=new Array(o),i=0;i<o;i++)s[i]=arguments[i];var a=r.apply(this,s);return a&&(a.constructor!==NodeList||a.constructor===NodeList&&0<a.length)?a:((a=t)==="getElementById"&&(a="querySelector",s=["#"+s[0]]),(jc.Element[a]||Element.prototype[a]).apply(n,s))})})})}function _ae(){Object.keys(jc).forEach(function(n){g$.forEach(function(e){window[n].prototype[e]=jc[n][e]})})}var Pae=["ref"],Cae=["key"],Iae=["hashList"],Mx=parseInt(Ei.version);var Eae=(()=>{function n(e){return yh(this,n),Fm(this,n,[e])}return Nm(n,C.Component),vh(n,[{key:"render",value:function(){var e=this.props.component,t=this.props.passedProps,t=(t.ref,Eo(t,Pae));return C.createElement(e,t,this.props.children)}}])})(),kae=function(n,e,t){var r=(()=>{function o(s){var i;return yh(this,o),(i=Fm(this,o,[s])).state=he(he({},s),e.isSlots?{children:n}:{}),i.setRef=i.setRef.bind(i),i.vueInReactCall=i.vueInReactCall.bind(i),(i.__veauryVueWrapperRef__=t).__veauryVueInReactCall__=i.vueInReactCall,i}return Nm(o,C.Component),vh(o,[{key:"reactPropsLinkToVueInstance",value:function(s){Object.keys(s).forEach(function(i){t[i]||(t[i]=s[i])}),Object.getOwnPropertyNames(s.__proto__).filter(function(i){return["constructor","render"].indexOf(i)<0}).forEach(function(i){t[i]||(t[i]=s[i])})}},{key:"setRef",value:function(s){var i=this;s&&(t.__veauryReactRef__=s,this.reactPropsLinkToVueInstance(s),Promise.resolve().then(function(){return i.reactPropsLinkToVueInstance(s)}),(this.setRef.current=s).__veauryVueWrapperRef__=t)}},{key:"createSlot",value:function(s){return{originVNode:s,inheritAttrs:!1,__fromReactSlot:!0,render:function(){var i,a;return((i=s=(s=((a=this.$slots)==null||(i=a.default)==null?void 0:i.call(a))||s)instanceof Function?s(this):s)==null?void 0:i.length)===1&&(a=s[0])!=null&&a.data&&((i=this.$attrs).key,a=Eo(i,Cae),s[0].props=he(he({},a),s[0].props)),s}}}},{key:"componentWillUnmount",value:function(){t.__veauryReactRef__&&(t.__veauryReactRef__.__veauryVueWrapperRef__=null,t.__veauryReactRef__=null)}},{key:"vueInReactCall",value:function(s){var i=this,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return 2<arguments.length&&arguments[2]&&s&&s[0]?s.map(function(c,u){return Bf(i.createSlot(c instanceof Function?c:[c]),he(he(he({},e),a),{},{isSlots:!0,wrapInstance:t})).render({key:(c==null?void 0:c.key)||void 0})}):Bf(this.createSlot(s),he(he(he({},e),a),{},{isSlots:!0,wrapInstance:t})).render()}},{key:"render",value:function(){var s,i,a,c=this,S=this.state,u=S.hashList,h=Eo(S,Iae),f={},g={};for(s in h)i=s,a=void 0,h.hasOwnProperty(i)&&h[i]!=null&&(h[i].__slot?(h[i].reactSlot?h[i]=h[i].reactSlot:(a=h[i],e.defaultSlotsFormatter&&h[i].__trueChildren?(h[i].__trueChildren.__top__=c.__veauryVueWrapperRef__,h[i]=e.defaultSlotsFormatter(h[i].__trueChildren,c.vueInReactCall,u),h[i]instanceof Array?h[i]=$m(h[i]):-1<["string","number"].indexOf(jn(h[i]))?h[i]=[h[i]]:jn(h[i])==="object"&&(h[i]=he({},h[i]))):h[i]=he({},Bf(c.createSlot(h[i]),he(he({},e),{},{isSlots:!0,wrapInstance:t})).render()),h[i].vueFunction=a),f[i]=h[i]):h[i].__scopedSlot&&(h[i]=h[i](c.createSlot),g[i]=h[i]));var y,v,S={};return S.ref=this.setRef,e.isSlots?this.state.children||this.props.children:(y=h,n.__syncUpdateForPureReactInVue&&Object.keys(n.__syncUpdateForPureReactInVue).map(function(w){var b,_;y[w]&&typeof y[w]=="function"&&(b=c.__veauryVueWrapperRef__,_=y[w],y[w]=function(){for(var T=arguments.length,E=new Array(T),M=0;M<T;M++)E[M]=arguments[M];b.__veaurySyncUpdateProps__(n.__syncUpdateForPureReactInVue[w].apply(this,E)),_.apply(this,E),b.macroTaskUpdate=!0,b.__veauryMountReactComponent__(!0,!0,{})})}),v=he(he(he({},y=e.defaultPropsFormatter?e.defaultPropsFormatter.call(this,y,this.vueInReactCall,u):y),f),g),Object.getPrototypeOf(n)!==Function.prototype&&(jn(n)!=="object"||n.render)||o.catchVueRefs()?(Object.getPrototypeOf(n)===Function.prototype&&delete S.ref,C.createElement(n,bl({},v,S))):C.createElement(Eae,bl({passedProps:v,component:n},S),v.children))}}],[{key:"catchVueRefs",value:function(){if(t.$parent){for(var s in t.$parent.$refs)if(t.$parent.$refs[s]===t)return!0}return!1}}])})();return uu(r,"displayName","applyReact_".concat(n.displayName||n.name||"Component")),r};function U_(n){var e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};return n.__esModule&&n.default&&(n=n.default),e.isSlots&&(n=n()),e=f$(e,void 0,!0),{originReactComponent:n,setup:function(t,r){var o,s,i,a;if(!e.isSlots)return o={},s=X6({}),i=ez(),typeof(a=e.useInjectPropsFromWrapper||n.__veauryInjectPropsFromWrapper__)=="function"&&(typeof(a=a.call(i.proxy,t))!="function"?(Object.assign(s,a),o.__veauryInjectedProps__=s):i.proxy.__veauryInjectedComputed__=a),o},data:function(){return{VEAURY_Portals:[]}},created:function(){this.__veauryPortalKeyPool__=[],this.__veauryMaxPortalCount__=0},computed:{__veauryInjectedProps__:function(){var t;return(t=this.__veauryInjectedComputed__)==null?void 0:t.call(this)}},render:function(){var t=hi(e.react.componentWrap,he({ref:"react"},e.react.componentWrapAttrs||{}),this.VEAURY_Portals.map(function(r){return(0,r.Portal)(hi,r.key)}));return this.__veauryCheckReactSlot__(this.$slots),t},methods:{__veauryCheckReactSlot__:function(t){var r=this;function o(s,i,a){return i[a]&&(s[a]=i[a],1)}jn(t)==="object"&&t!=null&&(t instanceof Array?t.forEach(function(s){r.__veauryCheckReactSlot__(s.children)}):Object.keys(t).forEach(function(c){var i,a,c=t[c];if(typeof c=="function"){try{i=c.apply(r,c.__reactArgs||[{}])}catch{return}(c.__trueChildren=i).forEach(function(u){u.children&&r.__veauryCheckReactSlot__(u.children)}),i.length!==1||o(c,i=i[0],"reactSlot")||o(c,i,"reactFunction")||i.type!==DM||((a=i.children)==null?void 0:a.length)!==1||o(c,a=i.children[0],"reactSlot")||o(c,a,"reactFunction")}}))},__veauryPushVuePortal__:function(t){var r=this.__veauryPortalKeyPool__.shift()||this.__veauryMaxPortalCount__++;this.VEAURY_Portals.push({Portal:t,key:r})},__veauryRemoveVuePortal__:function(t){var r,o=this.VEAURY_Portals.find(function(s,i){if(s.Portal===t)return r=i,!0});this.__veauryPortalKeyPool__.push(o.key),this.VEAURY_Portals.splice(r,1)},__veauryGetScopeSlot__:function(t,r,o){var s=this;function i(a){function c(){for(var u,h=this,f=arguments.length,g=new Array(f),y=0;y<f;y++)g[y]=arguments[y];return t.reactFunction?t.reactFunction.apply(this,g):e.defaultSlotsFormatter?((u=t.apply(this,g)).__top__=s,(u=e.defaultSlotsFormatter(u,s.__veauryVueInReactCall__,r))instanceof Array||-1<jn(u).indexOf("string","number")?u=$m(u):jn(u)==="object"&&(u=he({},u)),u):Bf(a(function(){return t.apply(h,g)}),he(he({},e),{},{isSlots:!0,wrapInstance:s})).render()}return e.pureTransformer&&o?c.vueFunction=o:c.vueFunction=t,c}return i.__scopedSlot=!0,i},__veaurySyncUpdateProps__:function(t){this.__veauryReactInstance__&&this.__veauryReactInstance__.setState(t)},__veauryMountReactComponent__:function(t,r){var o,s,i=this,a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},c={},u=[],h=this.$.vnode.scopeId,f=(h&&(c[h]="",u.push(h)),{}),g={};if(!t||r!=null&&r.slot)for(var y in this.$slots||{})(E=>{var M;i.$slots.hasOwnProperty(E)&&i.$slots[E]!=null&&((M=e.react.vueNamedSlotsKey.find(function(A){return E.indexOf(A)===0}))||E==="default"?(M=E.replace(new RegExp("^".concat(M)),""),f[M]=i.$slots[E],f[M].__slot=!0):g[E]=i.__veauryGetScopeSlot__(i.$slots[E],u,(M=i.$.vnode)==null||(M=M.children)==null?void 0:M[E]))})(y);(!t||r!=null&&r.slot)&&(s=he({},f),o=s.default,delete s.default),this.__veauryLast__=this.__veauryLast__||{},this.__veauryLast__.slot=this.__veauryLast__.slot||{},this.__veauryLast__.attrs=this.__veauryLast__.attrs||{};var v={slot:function(){i.__veauryLast__.slot=he(he(he({},o?{children:o}:{children:null}),s),g)},attrs:function(){i.__veauryLast__.attrs=i.$attrs}};if(r&&Object.keys(r).forEach(function(E){return v[E]()}),t){var S=function(){i.__veauryReactInstance__&&i.__veauryReactInstance__.setState(function(E){return Object.keys(E).forEach(function(M){e.isSlots&&M==="children"||delete E[M]}),he(he(he(he({},i.__veauryCache__),i.__veauryInjectedProps__),!e.isSlots&&i.__veauryLast__.slot),i.__veauryLast__.attrs)}),i.__veauryCache__=null};!this.microTaskUpdate||this.__veauryCache__||this.$nextTick(function(){S(),i.microTaskUpdate=!1}),this.macroTaskUpdate&&(clearTimeout(this.updateTimer),this.updateTimer=setTimeout(function(){clearTimeout(i.updateTimer),S(),i.macroTaskUpdate=!1})),this.__veauryCache__=he(he({},this.__veauryCache__||{}),he(he(he(he({},a),this.$attrs.class?{className:this.$attrs.class}:{}),he({},c)),{},{hashList:u},this.$attrs.style?{style:this.$attrs.style}:{})),this.macroTaskUpdate||this.microTaskUpdate||S()}else{v.slot(),v.attrs();var h=kae(n,e,this),w=C.createElement(h,bl({},this.$attrs,this.__veauryInjectedProps__,{children:o},s,g,this.$attrs.class?{className:this.$attrs.class}:{},c,{hashList:u},this.$attrs.style?{style:this.$attrs.style}:{},{ref:function(M){return i.__veauryReactInstance__=M}})),b=this.$refs.react,_=e.wrapInstance;if(_)(_=e.wrapInstance).__veauryVueWrapperRef__=this;else for(var T=this.$parent;T;){if(T.parentReactWrapperRef){_=T.parentReactWrapperRef;break}if(T.reactWrapperRef){_=T.reactWrapperRef;break}T=T.$parent}_?(this.parentReactWrapperRef=_,this.reactPortal=function(){return Ei.createPortal(w,b)},_.pushReactPortal(this.reactPortal)):17<Mx?(wc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED!==void 0&&(wc.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.usingClientEntryPoint=!0),r=e.react.createRoot||wc.createRoot,18<Mx&&!r&&console.warn("'react-dom 19' no longer supports dynamically determining whether to use 'render' or 'createRoot'. In order to be compatible with 'react-dom 17' and previous versions, you need to manually configure 'createRoot' in the veaury configuration."),this.__veauryReactApp__=r(b),this.__veauryReactApp__.render(w)):wc.render(w,b)}}},mounted:function(){var t=this;this.__VEAURY_IGNORE_STRANGE_UPDATE__=!0,Promise.resolve().then(function(){t.__VEAURY_IGNORE_STRANGE_UPDATE__=!1}),clearTimeout(this.updateTimer),this.__veauryMountReactComponent__()},beforeUnmount:function(){var t;clearTimeout(this.updateTimer),bae(this.$refs.react),this.reactPortal?(t=this.parentReactWrapperRef)!=null&&t.removeReactPortal(this.reactPortal):17<Mx?(t=this.__veauryReactApp__)!=null&&t.unmount():wc.unmountComponentAtNode(this.$refs.react),_ae()},updated:function(){this.__VEAURY_IGNORE_STRANGE_UPDATE__||this.__veauryMountReactComponent__(!0,{slot:!0})},inheritAttrs:!1,watch:{$attrs:{handler:function(){this.__veauryMountReactComponent__(!0,{attrs:!0})},deep:!0},__veauryInjectedProps__:{handler:function(){this.__veauryMountReactComponent__(!0,{attrs:!0})},deep:!0}}}}var Tae=new Set(["onClick","onContextMenu","onDoubleClick","onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onChange","onInput","onInvalid","onReset","onSubmit","onError","onLoad","onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut","onSelect","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onScroll","onWheel","onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting","onLoad","onError","onAnimationStart","onAnimationEnd","onAnimationIteration","onTransitionEnd","onToggle"]);function Mae(n,e){for(var t=(n=e=(n==null?void 0:n._reactInternals)||(n==null?void 0:n._reactInternalFiber)||e)==null?void 0:n.return;t;){var r=t.stateNode;if(r=(r==null?void 0:r.parentVueWrapperRef)||(r==null?void 0:r.__veauryVueWrapperRef__))return r;t=t.return}}function IM(n,e,t){var r={};return t.forEach(function(o){r[o]=!0}),n[(e==="modelValue"?"model":e)+"Modifiers"]=r}function EM(n,e,t){var r=this,o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:"v-model";if(!(e instanceof Array))throw Error("[error:veaury] Parameter type error from '".concat(o,"', a single v-model is an array, such as [val, setter, argumentKey, modifiers] or [val, setter, modifiers]"));if(typeof e[1]!="function")throw Error("[error:veaury] Parameter type error from '".concat(o,"', a single v-model is an array, the second element of the array must be a setter function"));var s=e[1],i=(typeof e[2]=="string"?(t=e[2],e[3]instanceof Array&&IM(n,t,e[3])):e[2]instanceof Array&&IM(n,t,e[2]),n["onUpdate:"+t]);n["onUpdate:"+t]=typeof i=="function"?function(){for(var a=arguments.length,c=new Array(a),u=0;u<a;u++)c[u]=arguments[u];i.apply(r,c),s.apply(r,c)}:s,n[t]=e[0]}function pb(n){var e=this,t={},r=he({},n);return Object.keys(n).forEach(function(o){var s,i=o.match(/^onUpdate-([^-]+)/);if(i)delete r[o],s=t["onUpdate:".concat(i[1])],t["onUpdate:".concat(i[1])]=typeof s=="function"?function(){for(var c=arguments.length,u=new Array(c),h=0;h<c;h++)u[h]=arguments[h];s.apply(e,u),n[o].apply(e,u)}:n[o];else if(i=o.match(/^v-model($|:([^:]+)|-([^:]+))/))i=i[2]||i[3]||"modelValue",EM(t,n[o],i),delete r[o];else if(o==="v-models"){if(jn(n[o])!=="object"||n[o]instanceof Array)throw Error("[error:veaury] The parameter 'v-models' must be an object type, such as {[argumentKey]: singleVModel}");var a=n[o];Object.keys(a).forEach(function(c){EM(t,a[c],c,"v-models")}),delete r[o]}}),he(he({},r),t)}var zm=vh(function n(){yh(this,n),uu(this,"pool",new Set)},[{key:"getRandomId",value:function(n){var e=n+(Math.random()+"").substr(2);return this.pool.has(e)?this.getRandomId(n):(this.pool.add(e),e)}}]);function m$(r,e){var t,r=r.node;if(typeof r=="function"&&(r=r()),(t=e)!=null&&t.current||typeof e=="function"||(t=e)!=null&&t.toString().match(/^function/)||(e=null),-1<["string","number"].indexOf(jn(r)))return r;if(r instanceof Array){if(r.length!==1)return r;r=r[0]}return he(he({},r),{},{ref:e})}var Aae=U_(m$);function fb(n){return hi(Aae,{node:function(){return n.node}})}fb.originReactComponent=C.forwardRef(m$);var jae=["component","node"],Rae=["component","$slots","children","class","style"],Oae=["className","classname"],sl="veaury-options",kM=new zm;function Dae(n,e){var t;return n=typeof n=="string"&&e?(e=e.$)==null||(e=e.appContext)==null||(e=e.app)==null||(t=e.component)==null?void 0:t.call(e,n):n}function TM(n){if(n)return Object.keys(n).forEach(function(e){var t=n[e];t!=null&&(typeof t=="function"?(n[e]=t,n[e].reactFunction=t):(n[e]=function(){return t},n[e].reactSlot=t),t.vueFunction)&&(n[e].vueFunction=t.vueFunction)}),n}function Lae(n){var e;return(e=n.node)==null?void 0:e.call(n)}var gb=C.forwardRef(function(o,e){var t,i=o.component,r=o.node,o=Eo(o,jae);if(i==null&&r==null)return null;if(r!=null){if(r.$$typeof||typeof r=="string"||typeof r=="number")return r;typeof r!="function"&&(t=r,r=function(){return t})}var s,i=i||Lae,a=f$(o[sl]||{},void 0,!0),c=a.useInjectPropsFromWrapper||i.__veauryInjectPropsFromWrapper__;return a.isSlots||typeof c=="function"&&(s=c(o)),C.createElement(Fae,bl({},he(he(he(he({component:i},r?{node:r}:{}),o),s),{},uu({},sl,a)),{ref:e}))}),Fae=(()=>{function n(e){var t;return yh(this,n),(t=Fm(this,n,[e])).state={portals:[]},t.__veauryPortalKeyPool__=[],t.__veauryMaxPortalCount__=0,t.__veauryCurrentVueComponent__=e.component,t.__veauryCreateVueInstance__=t.__veauryCreateVueInstance__.bind(t),t.__veauryVueComponentContainer__=t.createVueComponentContainer(),t}return Nm(n,C.Component),vh(n,[{key:"pushReactPortal",value:function(e){var t=this.state.portals,r=this.__veauryPortalKeyPool__.shift()||this.__veauryMaxPortalCount__++;t.push({Portal:e,key:r}),this.setState({portals:t})}},{key:"removeReactPortal",value:function(e){var t,r=this.state.portals,o=r.find(function(s,i){if(s.Portal===e)return t=i,!0});this.__veauryPortalKeyPool__.push(o.key),r.splice(t,1),this.__veauryVueRef__&&this.setState({portals:r})}},{key:"createVueComponentContainer",value:function(){var e=this,t={},r=this.props[sl];return r.isSlots?(Object.keys(this.props).forEach(function(o){Tae.has(o)&&typeof e.props[o]=="function"&&(t[o]=e.props[o])}),r.vue.slotWrapAttrs&&(t=he(he({},t),r.vue.slotWrapAttrs))):r.vue.componentWrapAttrs&&(t=he(he({},t),r.vue.componentWrapAttrs)),r.vue.componentWrapHOC(C.createElement("div",bl({},r.vue.componentWrapAttrs,{ref:this.__veauryCreateVueInstance__,key:null})),t)}},{key:"shouldComponentUpdate",value:function(e,t,r){var o,s,i,a,c=this;return e===this.props||(o=e.component,s=(s=e["v-slots"])===void 0?null:s,i=e.children,e=Eo(e,["component",sl,"v-slots","children"].map(kg)),this.__veauryCurrentVueComponent__!==o&&this.updateVueComponent(o),o.__fromReactSlot)||this.__veauryVueInstance__&&(i&&(s=s||{},jn(i)!=="object"||i instanceof Array||i.$$typeof?s.default=i:s=i),(a=this.__veauryVueInstance__.$data.$slots)&&Object.keys(a).forEach(function(u){delete a[u]}),s&&(a||(this.__veauryVueInstance__.$data.$slots={}),Object.assign(this.__veauryVueInstance__.$data.$slots,TM(s))),Object.keys(this.__veauryVueInstance__.$data).forEach(function(u){u!=="$slots"&&delete c.__veauryVueInstance__.$data[u]}),this.__veauryVueInstance__)&&Object.assign(this.__veauryVueInstance__.$data,pb(e)),!0}},{key:"componentWillUnmount",value:function(){this.vuePortal?this.parentVueWrapperRef.__veauryRemoveVuePortal__(this.vuePortal):(this.__veauryVueInstance__&&this.__veauryVueInstance__.$.appContext.app.unmount(),kM.pool.delete(this.__veauryVueTargetId__),this.vueCreated=!1)}},{key:"componentDidMount",value:function(){this.__veauryCreateVueInstance__(this.vueContainerElement)}},{key:"__veauryCreateVueInstance__",value:function(e){var t,r,o,s,i,a,c,u,h=this;function f(g){this.__veauryVueInstance__||(this.__veauryVueInstance__=g)}this.vueCreated||(this.vueCreated=!0,(t=this).vueContainerElement=e,(o=this.props).component,r=o[sl],c=o.children,u=(u=o["v-slots"])===void 0?{}:u,o=Eo(o,["component",sl,"children","v-slots"].map(kg)),c&&(jn(c)!=="object"||c instanceof Array||c.$$typeof?u.default=c:u=c),(u=TM(u))&&(o.$slots=u),f=f.bind(this),s=he({},pb(o)),i={data:function(){return r.isSlots?{children:t.__veauryCurrentVueComponent__.originVNode}:s},created:function(){this.reactWrapperRef=t,f(this)},methods:{reactInVueCall:function(g){return 2<arguments.length&&arguments[2]&&g&&g[0]?g.map(function(y,v){return hi(fb,{node:y,key:(y==null||(y=y.data)==null?void 0:y.key)||v})}):hi(fb,{node:g})},getScopedSlots:function(g,y){var v,S=this,w=(this.getScopedSlots.__scopeSlots||(this.getScopedSlots.__scopeSlots={}),he({},y));for(v in w)(b=>{var _,T;!w.hasOwnProperty(b)||(_=w[b])==null||(w[b]=(T=_,function(){for(var E,M,A,R,L=arguments.length,K=new Array(L),D=0;D<L;D++)K[D]=arguments[D];return T.vueFunction?T.vueFunction.apply(S,K):(A=T.reactFunction,A=T.reactSlot||(A==null?void 0:A.apply(S,K)),R=r.defaultSlotsFormatter,(E=S.getScopedSlots.__scopeSlots[b])!=null&&(E=E.component)!=null&&(E=E.ctx)!=null&&E.__veauryReactInstance__?(M=S.getScopedSlots.__scopeSlots[b],Promise.resolve().then(function(){var U;(U=M)!=null&&(U=U.component)!=null&&(U=U.ctx)!=null&&(U=U.__veauryReactInstance__)!=null&&U.setState({children:T.apply(S,K)})})):(M=R&&A?[R(A,S.reactInVueCall)]:g(U_(function(){return T.apply(S,K)},he(he({},r),{},{isSlots:!0,wrapInstance:t}))),S.getScopedSlots.__scopeSlots[b]=M),T.reactFunction?M.reactFunction=T.reactFunction:T.reactSlot&&(M.reactSlot=T.reactSlot),M)}),w[b].reactFunction=_)})(v);return w}},mounted:function(){e.removeAttribute("id"),t.__veauryVueRef__=this.$refs.use_vue_wrapper,this.$refs.use_vue_wrapper.reactWrapperRef=t},beforeUnmount:function(){t.__veauryVueRef__=null,this.$refs.use_vue_wrapper.reactWrapperRef=null},render:function(){var g=this,_=this.$data,w=(_.component,_.$slots),y=_.class,v=_.style,_=Eo(_,Rae),S=this.getScopedSlots(hi,he({},w)),w=_.className,b=_.classname,_=Eo(_,Oae),T={};return Object.keys(S).forEach(function(E){var M=S[E];T[E]=typeof M=="function"?M:function(){return M}}),hi(Dae(t.__veauryCurrentVueComponent__,this),he(he(he(he({},_),y||w||b?{class:y||w||b}:{}),v?{style:v}:{}),{},{ref:"use_vue_wrapper"}),he({},r.isSlots&&this.children?{default:typeof this.children=="function"?this.children:function(){return g.children}}:he({},T)))}},e&&(a=kM.getRandomId("__vue_wrapper_container_"),e.id=a,this.__veauryVueTargetId__=a,(c=r.wrapInstance)?(c=r.wrapInstance).reactWrapperRef=t:c=Mae(this),c&&document.getElementById(a)?(this.parentVueWrapperRef=c,this.vuePortal=function(g,y){return g(Z6,{to:"#"+a,key:a},[g(Object.assign(i,{router:h._router}))])},c.__veauryPushVuePortal__(this.vuePortal)):(u=Q6(i),typeof r.beforeVueAppMount=="function"&&r.beforeVueAppMount(u),this.__veauryVueInstance__=u.mount(e))))}},{key:"updateVueComponent",value:function(e){this.__veauryVueInstance__&&(e.__fromReactSlot?this.__veauryVueInstance__.children=typeof e.originVNode=="function"?e.originVNode:function(){return e.originVNode}:(this.__veauryCurrentVueComponent__=e,this.__veauryVueInstance__.$forceUpdate()))}},{key:"render",value:function(){return C.createElement(this.__veauryVueComponentContainer__,{portals:this.state.portals})}}])})();function Bf(n){var e=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},t=(n||console.warn("Component must be passed in applyVueInReact!"),n.__esModule&&n.default&&(n=n.default),C.forwardRef(function(r,o){return C.createElement(gb,bl({},r,{component:n,ref:o},uu({},sl,e)))}));return t.originVueComponent=n,t}new zm;function MM(n){return n.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})}function Bm(n){var e;return n?typeof n=="string"?(n=n.trim()).split(/\s*;\s*/).reduce(function(t,r){return r&&(r=r.split(/\s*:\s*/)).length===2&&Object.assign(t,uu({},MM(r[0]),r[1])),t},{}):jn(n)==="object"?(e={},Object.keys(n).forEach(function(t){e[MM(t)]=n[t]}),e):{}:{}}function Um(n){return n?n instanceof Array?n:typeof n=="string"?(n=n.trim()).split(/\s+/):jn(n)==="object"?Object.keys(n).filter(function(e){return!!n[e]}):[]:[]}var Nae=["ref"];function $ae(n,e,t,r,o){var s=n.props||{},s=(s.ref,Eo(s,Nae)),i={},a=(Object.keys(n.children||{}).forEach(function(h){var f=n.children[h],g=p$.react.vueNamedSlotsKey.find(function(y){return h.indexOf(y)===0});g||h==="default"?(g=h.replace(new RegExp("^".concat(g)),"").replace(/^default$/,"children"),i[g]=r.call(n.__top__,f(),t,o)):typeof f=="function"&&(i[h]=function(){for(var y=arguments.length,v=new Array(y),S=0;S<y;S++)v[S]=arguments[S];return f.__reactArgs=v,r(f.apply(this,v),t,o)})}),{}),c=Bm(s.style),u=Array.from(new Set(Um(s.class))).join(" ");return 0<Object.keys(c).length&&(a.style=c),u!==""&&(a.className=u),Object.assign(s,he(he({},a),i)),delete s.class,typeof s.ref_for=="boolean"&&delete s.ref_for,s}function AM(n){return n.type===tz}new zm;function y$(n,e){var t;return 0<((t=n.dirs)==null?void 0:t.length)?C.createElement(zae,{vnode:n},e):e}var zae=(()=>{function n(e){var t;return yh(this,n),(t=Fm(this,n,[e])).state={prevVnode:null,savedDirectives:[],ref:null,prevProps:e},t}return Nm(n,C.Component),vh(n,[{key:"findDirectiveName",value:function(e){var t=e.dir,r=-1;return[this.state.savedDirectives.find(function(o,s){if(o.dir===t)return r=s,!0}),r]}},{key:"doDirective",value:function(){var e=this,s=this.state,t=s.savedDirectives;if(!(r=s.ref)){for(var r=(this._reactInternals||this._reactInternalFiber).child;r&&r.tag!==5;)r=r.child;if(!r)return;r=r.stateNode}var o=this.props.vnode,s=o.dirs;s&&(s.forEach(function(i){var a,c,u,h,f,g,y;i&&(y=(a=CM(e.findDirectiveName(i),2))[0],a=a[1],c=(f=i.dir).created,u=f.beforeMount,h=f.mounted,g=f.beforeUpdate,f=f.updated,y?(t[a]=he(he(he({},y),i),{},{oldValue:y.oldValue}),y=[r,t[a],o,e.state.prevVnode],g!=null&&g.apply(null,y),f!=null&&f.apply(null,y),t[a].oldValue=i.value):(t.push(i),g=[r,i,o,null],c!=null&&c.apply(null,g),u!=null&&u.apply(null,g),h!=null&&h.apply(null,g),i.oldValue=i.value))}),this.setState({prevVnode:he({},o),savedDirectives:t,ref:r}))}},{key:"componentDidMount",value:function(){this.doDirective()}},{key:"componentDidUpdate",value:function(e){e.vnode!==this.props.vnode&&this.doDirective()}},{key:"componentWillUnmount",value:function(){var e=this,t=this.props.vnode,i=this.state,r=i.savedDirectives,o=i.ref,s=i.prevVnode,i=t.dirs;i&&(i.forEach(function(a){var c,u,h,f;a&&(c=(f=CM(e.findDirectiveName(a),2))[0])&&(u=(h=a.dir).beforeUnmount,h=h.unmounted,r[f[1]]=he(he({},c),a),f=[o,c,t,s],u!=null&&u.apply(null,f),h!=null)&&h.apply(null,f)}),this.setState({prevVnode:he({},t),savedDirectives:r}))}},{key:"render",value:function(){var e=this.props;return e.vnode,e.children}}])})();function Bae(n,e){var t;return typeof n=="function"&&(t=n.toString(),n.prototype!==void 0)&&n.prototype.constructor===n&&(t.slice(0,5)=="class"||2<=Object.getOwnPropertyNames(n.prototype).length||!/^function\s+\(|^function\s+anonymous\(/.test(t)&&!!/\b\(this\b|\bthis[\.\[]\b/.test(t)&&!e)}function v$(n,e){var t,r,o,s;return typeof((o=n.type)==null?void 0:o.originReactComponent)!="function"||Bae((o=n.type)==null?void 0:o.originReactComponent)?((o=n.ref)!=null&&o.k?(t=(o=n.ref)==null?void 0:o.k,r=(o=n.ref)==null?void 0:o.r):t=(o=n.ref)==null?void 0:o.r,t&&typeof t=="string"&&(s=t,t=function(i){var a;(a=n.ref)!=null&&(a=a.i)!=null&&a.refs&&((a=he({},n.ref.i.refs))[s]=i,n.ref.i.refs=a),r?r.value=i:n.ref.i.setupState&&s in n.ref.i.setupState&&(n.ref.i.setupState[s]=i),i&&(i.__syncUpdateProps=function(){e.__top__&&(n.__extraData=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},e.__top__.__syncUpdateProps({}))})},t=new Proxy(t,{get:function(i,a){return i[a]},set:function(i,a,c){var u;return(u=n.ref)!=null&&(u=u.i)!=null&&u.refs&&s in((u=n.ref)==null||(u=u.i)==null?void 0:u.refs)&&((u=he({},n.ref.i.refs))[a]=c,n.ref.i.refs=u),c}})),t):null}function mb(n,e){return!e||e instanceof Array&&e.length===0||(typeof e=="string"&&(e=[e]),(n=he({},n)).props=he({},n.props),e.forEach(function(t){n.props[t]=""})),n}var Uae=["style","class"];function jM(n,e,t,r,o,s,i){var a,c,u;return e==="all"||e instanceof Array||(e=e?[e]:[]),n.type===DM?o.call(i,n.children,t,s):typeof n.type=="string"&&(e==="all"||-1<e.indexOf(n.type))?(e=v$(n),u=(c=n.props||{}).style,a=c.class,c=he(he({},Eo(c,Uae)),{},{style:Bm(u),className:Array.from(new Set(Um(a))).join(" ")},e?{ref:e}:{}),(u=n.children||c.children)&&((u=-1<["string","number"].indexOf(jn(u))?[u]:$m(u)).__top__=i),y$(n,mb(at.createElement(n.type,c,o.call(i,u,t,s)),n.scopeId))):t([n],null,r)}function Hae(){var n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},e=1<arguments.length?arguments[1]:void 0,t=2<arguments.length?arguments[2]:void 0;return t.__syncUpdateForPureReactInVue&&Object.keys(t.__syncUpdateForPureReactInVue).map(function(r){var o;n[r]&&typeof n[r]=="function"&&e.__top__&&(o=n[r],n[r]=function(){for(var s=arguments.length,i=new Array(s),a=0;a<s;a++)i[a]=arguments[a];e.__extraData=t.__syncUpdateForPureReactInVue[r].apply(this,i),e.__top__.__veaurySyncUpdateProps__({}),e.__top__.macroTaskUpdate=!0,o.apply(this,i),e.__top__&&Promise.resolve().then(function(){e.__extraData=null,e.__top__.__veauryMountReactComponent__(!0)})})}),n}function RM(n,e,t){return!((n=n instanceof Array&&n.length===1?n[0]:n)instanceof Array)&&n.key==null&&1<e.length&&((n=he({},n)).key="_key_".concat(t)),n}function S$(r){var e=r.reactComponents,t=r.domTags,r=r.division,o=r===void 0||r;return function s(i,a,c){var u;return i&&i.forEach?(i.__top__||(i.__top__=this),u=[],i.forEach(function(h,f){if(h&&h.type!==J6){if((v=h.type)==null||!v.originReactComponent)return h.$$typeof||typeof h=="string"||typeof h=="number"?void u.push(h):AM(h)?void(h.children.trim()!==""&&u.push(h.children.trim())):void(h.type&&(mb(v=RM(jM(h,t,a,o,s,c,i.__top__),i,f),h.scopeId),u.push(v)));var g,y,v=h.type.originReactComponent;mb(g=RM(g=(e=e==="all"||e instanceof Array?e:[e])==="all"||-1<e.indexOf(v)?(h.__top__=i.__top__,g=$ae(h,"_key_".concat(f),a,s,c),y=v$(h,i),h.children&&(h.children.__top__=i.__top__),y$(h,at.createElement(v,he(he(he({},Hae(g,h,v)),h.__extraData||{}),y?{ref:y}:{})))):AM(h)?h.text:jM(h,t,a,o,s,c),i,f),h.scopeId),u.push(g)}}),u.length===1?u[0]:u):i}}S$({reactComponents:"all",domTags:"all"});S$({reactComponents:"all",domTags:"all"});var Kae=["ref","children","v-slots"];function Wae(c,e,t,r,o){var c=c.props||{},u=(c.ref,c.children),i=c["v-slots"],s=i===void 0?{}:i,i=Eo(c,Kae),a=(u&&(jn(u)!=="object"||u instanceof Array||u.$$typeof?s.default=u:s=u),null),c=(Object.keys(s||{}).forEach(function(f){var g=s[f];(a=a||{})[f]=function(){if(typeof g=="function"){for(var y=arguments.length,v=new Array(y),S=0;S<y;S++)v[S]=arguments[S];g=g.apply(this,v)}return r(g,t,o)}}),{}),u=Bm(i.style),h=Array.from(new Set(Um(i.className))).join(" ");return 0<Object.keys(u).length&&(c.style=u),h!==""&&(c.class=h),Object.assign(i,he({},c)),delete i.className,{props:i=pb(i),slots:a}}function x$(n){var e=n.ref;if(e)return jn(e)==="object"?function(t){n.ref.current=t}:typeof e=="function"?e:void 0}var Vae=["style","class","children"];function OM(n,e,t,r,o,s){var i,a,c,u;return e==="all"||e instanceof Array||(e=e?[e]:[]),n.type===C.Fragment?o((i=n.props)==null?void 0:i.children,t):typeof n.type=="string"&&(e==="all"||-1<e.indexOf(n.type))?(i=x$(n),u=(e=n.props||{}).style,c=e.class,a=e.children,e=Eo(e,Vae),c=Array.from(new Set(Um(c))).join(" "),u=Bm(u),e=he(he(he(he({},e),Object.keys(u).length===0?{}:{style:u}),c?{className:c}:{}),i?{ref:i}:{}),Object.keys(e).length===0&&(e=null),(u=a)&&((u=-1<["string","number"].indexOf(jn(u))?[u]:u instanceof Array?$m(u):he({},u)).__top__=s),hi(n.type,e,o(u,t))):t([n],null,r)}function w$(r){var e=r.vueComponents,t=r.domTags,r=r.division,o=r===void 0||r;return function s(i,a){if(i==null)return i;i instanceof Array||(i=[i]);var c=[];return i.forEach(function(u,h){if(((f=u.type)==null||!f.originVueComponent)&&u.type!==gb)return u.__v_isVNode||typeof u=="string"||typeof u=="number"?void c.push(u):void(u.type&&(f=OM(u,t,a,o,s,i.__top__),c.push(f)));var f=u.type.originVueComponent;if(u.type===gb){if(!u.props.component)return void c.push(u.props.node);f=u.props.component,u=he({},u);var g=he({},u.props);delete g.component,u.props=g}f=(e=e==="all"||e instanceof Array?e:[e])==="all"||-1<e.indexOf(f)?((u=he({},u)).__top__=i.__top__,h=(g=Wae(u,"_key_".concat(h),a,s)).props,g=g.slots,x$(u),u.children&&(u.children.__top__=i.__top__),hi(f,he({},h),g)):OM(u,t,a,o,s),c.push(f)}),(c=c.flat(1/0)).length===1?c[0]:c}}w$({vueComponents:"all",domTags:"all"});w$({reactComponents:"all",domTags:"all"});new zm;const Gae={class:"tldraw-container"},qae=nz({__name:"tlDraw",setup(n){const e=Qz({baseUrl:`https://jsdelivr.${rz.cdnHost}/npm/@tldraw/assets@2.0.0/`}),t=U_(lae);return(r,o)=>(oz(),sz("div",Gae,[iz(eI(t),{inferDarkMode:!0,assetUrls:eI(e)},null,8,["assetUrls"])]))}}),Ile=az(qae,[["__scopeId","data-v-009542e0"]]);export{Ile as default};
