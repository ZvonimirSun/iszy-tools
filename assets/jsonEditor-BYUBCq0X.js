import{a5 as ht,bi as $,be as _t,a4 as D,$ as gt,bA as W,j as vt,B as v,l as yt,x as Ct,o as x,c as k,w as U,f as G,y as f,a as h,b as c,d as L,n as J,az as p,F as Q,W as C,g as wt,X as q,U as $t,t as Dt,aB as St,aF as It,aA as xt,aG as kt,aH as bt,aI as jt,a3 as Et}from"./vendor-ZyFjMaVl.js";import{e as Lt,_ as Mt,f as Yt,g as Pt,h as Vt}from"./ant-design-vue-ZR17kcgC.js";import{v as K,S as Bt,G as Z}from"./common-JUKG2F3j.js";import"./vanilla-jsoneditor-qva85DqO.js";function O(t,l){t=t||32,l=l||"ABCDEFGHJKMNPQRSTWXYZabcdefghijkmnprstwxyz2345678";const a=l.length;let i="";for(let m=0;m<t;m++)i+=l.charAt(Math.floor(Math.random()*a));return i}const Ft=new Bt;let M={},tt=!1;const et=ht("jsonEditor",{persist:!0,state:()=>({leftId:null,rightId:null,splitterValue:.5,fullStatus:"",$_data:{}}),getters:{dataList:t=>l=>{const a=[];for(const i in t.$_data)a.push({_id:i,name:t.$_data[i].name,updated:$(t.$_data[i].updated).format("YYYY-MM-DD HH:mm")});return l?a.filter(i=>i.name.includes(l)):a},data:t=>l=>t.$_data[l]?{...t.$_data[l],updated:$(t.$_data[l].updated).format("YYYY-MM-DD HH:mm")}:null,leftData:t=>t.leftId&&t.$_data[t.leftId]?{...t.$_data[t.leftId],updated:$(t.$_data[t.leftId].updated).format("YYYY-MM-DD HH:mm")}:null,rightData:t=>t.rightId&&t.$_data[t.rightId]?{...t.$_data[t.rightId],updated:$(t.$_data[t.rightId].updated).format("YYYY-MM-DD HH:mm")}:null,syncCloud:()=>K().isLogged&&K().modules.jsonEditor.syncCloud},actions:{setSplitter(t=.5){this.splitterValue=_t(t,0,1)},setFullStatus(t){t==="left"||t==="right"?this.fullStatus=t:this.fullStatus=""},replaceState(t=[]){const l={};for(const a of t)l[a.key]={name:a.name,content:{}},a.text!=null?l[a.key].content.text=a.text:a.json!=null&&(l[a.key].content.json=a.json),l[a.key].updated=$(a.updatedAt).format();this.$_data=l},async getSyncData(){try{const t=(await D.get(`${D.$apiBase}/tools/jsoneditor`)).data;t.success?this.replaceState(t.data):console.log(t.message)}catch(t){console.log(t.message)}},syncData:gt(({id:t,data:l}={})=>{if(navigator.onLine)Ft.enqueue(D.post(`${D.$apiBase}/tools/jsoneditor/${t}`,l));else if(M[t]=l,!tt){let a=function(){window.removeEventListener("online",a);for(const i in M)et().syncData({id:i,data:M[i]});M={}};tt=!0,window.addEventListener("online",a)}},500),saveData({left:t,right:l,id:a,content:i,name:m}={}){if(this.syncCloud&&(a=a||O(6),i!=null||m!=null)){const u={name:m||(this.$_data[a]||{}).name||`文档-${a}`};typeof i=="string"?u.text=i:typeof i=="object"&&(u.json=W(i)),this.syncData({id:a,data:u})}typeof i<"u"?(a=a||O(6),this.$_data[a]=this.$_data[a]||{},this.$_data[a].name=m||this.$_data[a].name||`文档-${a}`,typeof i=="string"?this.$_data[a].content={text:i}:this.$_data[a].content={json:W(i)},this.$_data[a].updated=$().format(),t&&(this.leftId=a),l&&(this.rightId=a)):a&&this.$_data[a]?(t&&(this.leftId=a),l&&(this.rightId=a),this.$_data[a].name=m||this.$_data[a].name):(t&&(this.leftId=null),l&&(this.rightId=null))},async deleteData({id:t}={}){if(this.syncCloud)try{const l=(await D.delete(`${D.$apiBase}/tools/jsoneditor/${t}`)).data;l.success?(this.leftId===t&&(this.leftId=null),this.rightId===t&&(this.rightId=null),this.$_data[t]&&delete this.$_data[t]):console.log(l.message)}catch(l){console.log(l)}else this.leftId===t&&(this.leftId=null),this.rightId===t&&(this.rightId=null),this.$_data[t]&&delete this.$_data[t]}}}),S=t=>(bt("data-v-1acfb22f"),t=t(),jt(),t),Ht={class:"loadingPanel"},zt=S(()=>h("div",{class:"emptySpace"},null,-1)),Nt=S(()=>h("span",{class:"i-icon-park-outline-right"},null,-1)),Xt=S(()=>h("span",{class:"i-icon-park-outline-left"},null,-1)),At={class:"dragIcon"},Rt={key:0,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"chevron-right",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},Tt=S(()=>h("path",{fill:"currentColor",d:"M96 480c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L242.8 256L73.38 86.63c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l192 192c12.5 12.5 12.5 32.75 0 45.25l-192 192C112.4 476.9 104.2 480 96 480z"},null,-1)),Wt=[Tt],Ut={key:1,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"chevron-left",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},Gt=S(()=>h("path",{fill:"currentColor",d:"M224 480c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25l192-192c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l169.4 169.4c12.5 12.5 12.5 32.75 0 45.25C240.4 476.9 232.2 480 224 480z"},null,-1)),Jt=[Gt],Qt={key:2,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"ellipsis-vertical",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 128 512"},qt=S(()=>h("path",{fill:"currentColor",d:"M64 360C94.93 360 120 385.1 120 416C120 446.9 94.93 472 64 472C33.07 472 8 446.9 8 416C8 385.1 33.07 360 64 360zM64 200C94.93 200 120 225.1 120 256C120 286.9 94.93 312 64 312C33.07 312 8 286.9 8 256C8 225.1 33.07 200 64 200zM64 152C33.07 152 8 126.9 8 96C8 65.07 33.07 40 64 40C94.93 40 120 65.07 120 96C120 126.9 94.93 152 64 152z"},null,-1)),Kt=[qt],Zt={class:"dialog-footer"},Ot=vt({__name:"jsonEditor",setup(t){const l=v(null),a=v(null),i=v(),m=v(!0),u=v(""),n=et(),at={array:[1,2,3],boolean:!0,color:"gold",null:null,number:123,object:{a:"b",c:"d"},string:"Hello World"};yt(()=>{nt()});async function nt(){var o,e,s,d,_;n.syncCloud&&await n.getSyncData(),m.value=!1,n.leftData&&n.leftData.content?n.leftData.content.json?(o=l.value)==null||o.set(n.leftData.content.json):n.leftData.content.text&&((e=l.value)==null||e.set(n.leftData.content.text)):(s=l.value)==null||s.set(at),n.rightData&&n.rightData.content&&(n.rightData.content.json?(d=a.value)==null||d.set(n.rightData.content.json):n.rightData.content.text&&((_=a.value)==null||_.set(n.rightData.content.text))),u.value=n.fullStatus}function B(o){var e,s;n.saveData({[o]:!0}),o==="left"?(e=l.value)==null||e.set({}):o==="right"&&((s=a.value)==null||s.set({}))}function F(o,e){let s=null;o==="left"?s=n.leftId:o==="right"&&(s=n.rightId),s&&n.saveData({id:s,name:e})}function H(o,e){let s=null;o==="left"?s=n.leftId:o==="right"&&(s=n.rightId);const d={[o]:!0,content:e};s&&(d.id=s),n.saveData(d)}const w=v(!1),y=v(""),I=v("");let Y="";const lt=Ct(()=>n.dataList(I.value));function z(o){y.value="",I.value="",Y=o,w.value=!0}function ot(){var o,e,s,d;if(y.value){const _=n.data(y.value);if(_&&_.content){const g=_.content;Y==="left"?(n.saveData({left:!0,id:y.value}),g.json?(o=l.value)==null||o.set(g.json):g.text&&((e=l.value)==null||e.set(g.text))):Y==="right"&&(n.saveData({right:!0,id:y.value}),g.json?(s=a.value)==null||s.set(g.json):g.text&&((d=a.value)==null||d.set(g.text)))}}w.value=!1}function N(o,{name:e,content:s}){var d,_;n.saveData({[o]:!0,name:e,content:s}),o==="left"?(d=l.value)==null||d.set(s):o==="right"&&((_=a.value)==null||_.set(s))}function X(o){const e=o==="left"?n.leftId:n.rightId;e&&n.deleteData({id:e})}function st(){var e,s;const o=(e=l.value)==null?void 0:e.get();o!=null&&((s=a.value)==null||s.set(o))}function it(){var e,s;const o=(e=a.value)==null?void 0:e.get();o!=null&&((s=l.value)==null||s.set(o))}let P=0,b=0,V=!1;function A(o){var s;if(o instanceof MouseEvent&&o.button!==0)return;const e=(s=l.value)==null?void 0:s.container;e&&(V=!1,b=parseFloat(window.getComputedStyle(e).width),isNaN(b)&&(b=0),o instanceof TouchEvent?(P=o.touches[0].clientX,document.addEventListener("touchend",E),document.addEventListener("touchmove",j)):(P=o.clientX,document.addEventListener("mouseup",E),document.addEventListener("mousemove",j)))}function j(o){if(!i.value)return;V=!0;let e=0;o instanceof TouchEvent?e=o.touches[0].clientX:e=o.clientX;const s=b-P+e,d=parseFloat(window.getComputedStyle(i.value).width);s<435?(u.value="right",u.value!==n.fullStatus&&n.setFullStatus("right")):d-100-s<435?(u.value="left",u.value!==n.fullStatus&&n.setFullStatus("left")):(u.value="",n.setSplitter(s/(d-100)),u.value!==n.fullStatus&&n.setFullStatus())}function E(){document.removeEventListener("mousemove",j),document.removeEventListener("touchmove",j),document.removeEventListener("mouseup",E),document.removeEventListener("touchend",E)}function rt(){i.value&&(V||(u.value==="left"?(n.setSplitter(1-435/(parseFloat(window.getComputedStyle(i.value).width)-100)),u.value=""):u.value==="right"&&(n.setSplitter(435/(parseFloat(window.getComputedStyle(i.value).width)-100)),u.value="")))}return(o,e)=>{var R,T;const s=Lt,d=St,_=It,g=Mt,ut=xt,dt=Yt,ft=Pt,ct=Vt,pt=kt;return x(),k(Q,null,[U(h("div",Ht,[c(s,{tip:"同步中..."})],512),[[G,f(m)]]),U(h("div",{ref_key:"editorPanel",ref:i,class:"editorPanel"},[c(Z,{ref_key:"editorPanelContainerLeft",ref:l,"show-menu-bar":"",class:L(["editorPanelContainer editorPanelContainerLeft",{full:f(u)==="left",hide:f(u)==="right"}]),style:J({flex:f(n).splitterValue+" 1 0"}),name:(R=f(n).leftData)==null?void 0:R.name,config:{mode:"text"},onChange:e[0]||(e[0]=r=>H("left",r)),onOpenRecent:e[1]||(e[1]=r=>z("left")),onOpen:e[2]||(e[2]=r=>N("left",r)),onCreate:e[3]||(e[3]=r=>B("left")),onChangeName:e[4]||(e[4]=r=>F("left",r)),onDelete:e[5]||(e[5]=r=>X("left"))},null,8,["class","style","name"]),h("div",{class:L(["controller noShowMobile",{full:f(u)}])},[c(_,{direction:"vertical"},{default:p(()=>[f(u)?wt("",!0):(x(),k(Q,{key:0},[zt,c(d,{type:"primary",block:"",onClick:st},{default:p(()=>[C(" 复制 "),Nt]),_:1}),c(d,{type:"primary",block:"",onClick:it},{default:p(()=>[Xt,C(" 复制 ")]),_:1})],64)),h("div",{class:"drag",onMousedown:A,onTouchstart:A,onClick:rt},[h("div",At,[f(u)==="right"?(x(),k("svg",Rt,Wt)):f(u)==="left"?(x(),k("svg",Ut,Jt)):(x(),k("svg",Qt,Kt))])],32)]),_:1})],2),c(Z,{ref_key:"editorPanelContainerRight",ref:a,"show-menu-bar":"",class:L(["editorPanelContainer editorPanelContainerRight noShowMobile",{full:f(u)==="right",hide:f(u)==="left"}]),style:J({flex:1-f(n).splitterValue+" 1 0"}),name:(T=f(n).rightData)==null?void 0:T.name,config:{mode:"tree"},onChange:e[6]||(e[6]=r=>H("right",r)),onOpenRecent:e[7]||(e[7]=r=>z("right")),onOpen:e[8]||(e[8]=r=>N("right",r)),onCreate:e[9]||(e[9]=r=>B("right")),onChangeName:e[10]||(e[10]=r=>F("right",r)),onDelete:e[11]||(e[11]=r=>X("right"))},null,8,["class","style","name"])],512),[[G,!f(m)]]),c(pt,{modelValue:f(w),"onUpdate:modelValue":e[14]||(e[14]=r=>q(w)?w.value=r:null),title:"打开最近"},{footer:p(()=>[h("span",Zt,[c(d,{onClick:e[13]||(e[13]=r=>w.value=!1)},{default:p(()=>[C("取消")]),_:1}),c(d,{type:"primary",onClick:ot},{default:p(()=>[C(" 确定 ")]),_:1})])]),default:p(()=>[c(g,null,{default:p(()=>[C("搜索")]),_:1}),c(ut,{modelValue:f(I),"onUpdate:modelValue":e[12]||(e[12]=r=>q(I)?I.value=r:null),placeholder:"请输入文档名称"},null,8,["modelValue"]),c(ct,{class:"dataList","item-layout":"horizontal","data-source":f(lt)},{renderItem:p(({item:r})=>[c(ft,{class:L({selected:r._id===f(y)}),onClick:mt=>y.value=r._id},{actions:p(()=>[c(d,{type:"danger",onClick:$t(mt=>f(n).deleteData({id:r._id}),["stop"])},{default:p(()=>[C(" 删除 ")]),_:2},1032,["onClick"])]),default:p(()=>[c(dt,{description:"最后修改: "+r.updated},{title:p(()=>[C(Dt(r.name),1)]),_:2},1032,["description"])]),_:2},1032,["class","onClick"])]),_:1},8,["data-source"])]),_:1},8,["modelValue"])],64)}}}),le=Et(Ot,[["__scopeId","data-v-1acfb22f"]]);export{le as default};
