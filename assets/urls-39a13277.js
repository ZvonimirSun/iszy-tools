import{n as ne,bR as re,p as U,q as ie,r as de,o as x,s as A,f as z,w as _,z as ue,x as p,ao as ce,A as M,y as R,v as j,C as pe,D as fe,F as B,a5 as P,bg as me,aM as ve,df as ge,aN as V,$ as J,g as c,a0 as ye,bc as _e,c$ as N,c1 as be,ai as Q,ay as X,d9 as S,cZ as F,aT as ee,G as Y,dg as ke,W as we,aZ as he,K as xe,aW as C,H as w,t as H,h as E,B as K,M as Z,I as Ce,E as $e,O as Le,P as Ee,d as Be}from"./index.js";import{E as Ie}from"./el-pagination-b34f0fdb.js";import"./el-tag-1d085a2f.js";import"./el-select-96a896ca.js";import"./el-scrollbar-e88d9e52.js";import"./el-popper-66ed4f9c.js";import{E as Ve,a as Se}from"./el-table-column-37fcef15.js";import"./el-checkbox-f642c5ea.js";import"./el-tooltip-4ed993c7.js";import{E as Ae}from"./el-popover-f28e8fcd.js";import{d as q}from"./dayjs.min-67390b44.js";import"./isEqual-ac423b5b.js";import"./hasIn-c0303111.js";import"./index-f0cb3f64.js";import"./strings-98730f23.js";import"./toFinite-0e801d2e.js";import"./isUndefined-aa0326a0.js";import"./raf-1680ca74.js";const ze=ne({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},href:{type:String,default:""},icon:{type:re}}),Te={click:a=>a instanceof MouseEvent},Pe=["href"],Ne=U({name:"ElLink"}),Ue=U({...Ne,props:ze,emits:Te,setup(a,{emit:e}){const t=a,l=ie("link"),u=de(()=>[l.b(),l.m(t.type),l.is("disabled",t.disabled),l.is("underline",t.underline&&!t.disabled)]);function n(s){t.disabled||e("click",s)}return(s,m)=>(x(),A("a",{class:R(p(u)),href:s.disabled||!s.href?void 0:s.href,onClick:n},[s.icon?(x(),z(p(ce),{key:0},{default:_(()=>[(x(),z(ue(s.icon)))]),_:1})):M("v-if",!0),s.$slots.default?(x(),A("span",{key:1,class:R(p(l).e("inner"))},[j(s.$slots,"default")],2)):M("v-if",!0),s.$slots.icon?j(s.$slots,"icon",{key:2}):M("v-if",!0)],10,Pe))}});var Me=pe(Ue,[["__file","/home/runner/work/element-plus/element-plus/packages/components/link/src/link.vue"]]);const Ye=fe(Me);function De(a){let e;const t=B(!1),l=P({...a,originalPosition:"",originalOverflow:"",visible:!1});function u(o){l.text=o}function n(){const o=l.parent,g=h.ns;if(!o.vLoadingAddClassList){let k=o.getAttribute("loading-number");k=Number.parseInt(k)-1,k?o.setAttribute("loading-number",k.toString()):(N(o,g.bm("parent","relative")),o.removeAttribute("loading-number")),N(o,g.bm("parent","hidden"))}s(),$.unmount()}function s(){var o,g;(g=(o=h.$el)==null?void 0:o.parentNode)==null||g.removeChild(h.$el)}function m(){var o;a.beforeClose&&!a.beforeClose()||(t.value=!0,clearTimeout(e),e=window.setTimeout(f,400),l.visible=!1,(o=a.closed)==null||o.call(a))}function f(){if(!t.value)return;const o=l.parent;t.value=!1,o.vLoadingAddClassList=void 0,n()}const v=U({name:"ElLoading",setup(o,{expose:g}){const{ns:k,zIndex:r}=ge("loading");return g({ns:k,zIndex:r}),()=>{const i=l.spinner||l.svg,L=V("svg",{class:"circular",viewBox:l.svgViewBox?l.svgViewBox:"0 0 50 50",...i?{innerHTML:i}:{}},[V("circle",{class:"path",cx:"25",cy:"25",r:"20",fill:"none"})]),y=l.text?V("p",{class:k.b("text")},[l.text]):void 0;return V(_e,{name:k.b("fade"),onAfterLeave:f},{default:_(()=>[J(c("div",{style:{backgroundColor:l.background||""},class:[k.b("mask"),l.customClass,l.fullscreen?"is-fullscreen":""]},[V("div",{class:k.b("spinner")},[L,y])]),[[ye,l.visible]])])})}}}),$=me(v),h=$.mount(document.createElement("div"));return{...ve(l),setText:u,removeElLoadingChild:s,close:m,handleAfterLeave:f,vm:h,get $el(){return h.$el}}}let T;const He=function(a={}){if(!be)return;const e=Oe(a);if(e.fullscreen&&T)return T;const t=De({...e,closed:()=>{var u;(u=e.closed)==null||u.call(e),e.fullscreen&&(T=void 0)}});Re(e,e.parent,t),G(e,e.parent,t),e.parent.vLoadingAddClassList=()=>G(e,e.parent,t);let l=e.parent.getAttribute("loading-number");return l?l=`${Number.parseInt(l)+1}`:l="1",e.parent.setAttribute("loading-number",l),e.parent.appendChild(t.$el),Q(()=>t.visible.value=e.visible),e.fullscreen&&(T=t),t},Oe=a=>{var e,t,l,u;let n;return X(a.target)?n=(e=document.querySelector(a.target))!=null?e:document.body:n=a.target||document.body,{parent:n===document.body||a.body?document.body:n,background:a.background||"",svg:a.svg||"",svgViewBox:a.svgViewBox||"",spinner:a.spinner||!1,text:a.text||"",fullscreen:n===document.body&&((t=a.fullscreen)!=null?t:!0),lock:(l=a.lock)!=null?l:!1,customClass:a.customClass||"",visible:(u=a.visible)!=null?u:!0,target:n}},Re=async(a,e,t)=>{const{nextZIndex:l}=t.vm.zIndex||t.vm._.exposed.zIndex,u={};if(a.fullscreen)t.originalPosition.value=S(document.body,"position"),t.originalOverflow.value=S(document.body,"overflow"),u.zIndex=l();else if(a.parent===document.body){t.originalPosition.value=S(document.body,"position"),await Q();for(const n of["top","left"]){const s=n==="top"?"scrollTop":"scrollLeft";u[n]=`${a.target.getBoundingClientRect()[n]+document.body[s]+document.documentElement[s]-Number.parseInt(S(document.body,`margin-${n}`),10)}px`}for(const n of["height","width"])u[n]=`${a.target.getBoundingClientRect()[n]}px`}else t.originalPosition.value=S(e,"position");for(const[n,s]of Object.entries(u))t.$el.style[n]=s},G=(a,e,t)=>{const l=t.vm.ns||t.vm._.exposed.ns;["absolute","fixed","sticky"].includes(t.originalPosition.value)?N(e,l.bm("parent","relative")):F(e,l.bm("parent","relative")),a.fullscreen&&a.lock?F(e,l.bm("parent","hidden")):N(e,l.bm("parent","hidden"))},D=Symbol("ElLoading"),W=(a,e)=>{var t,l,u,n;const s=e.instance,m=o=>ee(e.value)?e.value[o]:void 0,f=o=>{const g=X(o)&&(s==null?void 0:s[o])||o;return g&&B(g)},v=o=>f(m(o)||a.getAttribute(`element-loading-${ke(o)}`)),$=(t=m("fullscreen"))!=null?t:e.modifiers.fullscreen,h={text:v("text"),svg:v("svg"),svgViewBox:v("svgViewBox"),spinner:v("spinner"),background:v("background"),customClass:v("customClass"),fullscreen:$,target:(l=m("target"))!=null?l:$?void 0:a,body:(u=m("body"))!=null?u:e.modifiers.body,lock:(n=m("lock"))!=null?n:e.modifiers.lock};a[D]={options:h,instance:He(h)}},je=(a,e)=>{for(const t of Object.keys(e))Y(e[t])&&(e[t].value=a[t])},Fe={mounted(a,e){e.value&&W(a,e)},updated(a,e){const t=a[D];e.oldValue!==e.value&&(e.value&&!e.oldValue?W(a,e):e.value&&e.oldValue?ee(e.value)&&je(e.value,t.options):t==null||t.instance.close())},unmounted(a){var e;(e=a[D])==null||e.instance.close()}};const te=a=>(Le("data-v-41af8d31"),a=a(),Ee(),a),Ke={flex:"","flex-col":"","gap-4":"","h-full":""},Ze={class:"new-url-form"},qe=te(()=>H("span",null," 输入链接: ",-1)),Ge=te(()=>H("span",null," 自定义短网址(选): ",-1)),We="https://url.iszy.xyz",Je=U({__name:"urls",setup(a){const e=B([]),t=B(10),l=B(1),u=B(0),n=B(!1),s=P({}),m=P({}),f=P({keyword:"",url:""});we(()=>{v(l.value-1,t.value)}),he(()=>{v(l.value-1,t.value)}),xe(t,()=>{l.value=1});async function v(r,i){const L=setTimeout(()=>{n.value=!0},300);try{const y=(await C.get(`${C.$apiBase}/urls/admin/urls`,{params:{pageIndex:r,pageSize:i}})).data;y.success?(u.value=y.data.count,e.value=y.data.rows.map(b=>(b.createdAt=q(b.createdAt).format("YYYY年MM月DD日 HH:mm"),b.updatedAt=q(b.updatedAt).format("YYYY年MM月DD日 HH:mm"),b))):w.error(y.message)}catch(y){w.error(y.message)}clearTimeout(L),n.value=!1}async function $(){if(f.url)try{const r=(await C.post(`${C.$apiBase}/urls/admin/url`,{url:f.url,keyword:f.keyword})).data;r.success?(w.success("创建成功"),f.url="",f.keyword="",await v(l.value-1,t.value)):w.error(r.message)}catch(r){w.error(r.message)}}async function h(r){try{const i=(await C.put(`${C.$apiBase}/urls/admin/url/${r.keyword}`,{url:m[r.keyword]})).data;i.success?(w.success("更新成功"),r.url=m[r.keyword],s[r.keyword]=!1,await v(l.value-1,t.value)):w.error(i.message)}catch(i){w.error(i.message)}}async function o(r){try{const i=(await C.delete(`${C.$apiBase}/urls/admin/url/${r.keyword}`,{params:{keyword:r.keyword}})).data;i.success?(await v(l.value-1,t.value),w.success("删除成功")):w.error(i.message)}catch(i){w.error(i.message)}}function g(r){s[r.keyword]=!s[r.keyword],s[r.keyword]&&(m[r.keyword]=r.url)}function k(r){return(l.value-1)*t.value+r+1}return(r,i)=>{const L=Ce,y=$e,b=Ve,O=Ye,ae=Ae,le=Se,se=Ie,oe=Fe;return x(),A("div",Ke,[H("div",Ze,[qe,c(L,{modelValue:p(f).url,"onUpdate:modelValue":i[0]||(i[0]=d=>p(f).url=d),placeholder:"https",clearable:"","flex-1":""},null,8,["modelValue"]),Ge,c(L,{modelValue:p(f).keyword,"onUpdate:modelValue":i[1]||(i[1]=d=>p(f).keyword=d),clearable:""},null,8,["modelValue"]),c(y,{type:"primary",onClick:$},{default:_(()=>[E(" 缩短 ")]),_:1})]),J((x(),z(le,{data:p(e),border:!0,stripe:!0,size:"small","flex-1":""},{default:_(()=>[c(b,{type:"index",index:k,fixed:"left"}),c(b,{prop:"keyword",label:"短网址",width:"100",fixed:"left"},{default:_(({row:d})=>[c(O,{href:We+"/"+d.keyword,target:"_blank",style:{"white-space":"nowrap"}},{default:_(()=>[E(K(d.keyword),1)]),_:2},1032,["href"])]),_:1}),c(b,{prop:"url",label:"原网址","min-width":"300"},{default:_(({row:d})=>[p(s)[d.keyword]?(x(),z(L,{key:1,modelValue:p(m)[d.keyword],"onUpdate:modelValue":I=>p(m)[d.keyword]=I},null,8,["modelValue","onUpdate:modelValue"])):(x(),z(O,{key:0,href:d.url,target:"_blank"},{default:_(()=>[E(K(d.url),1)]),_:2},1032,["href"]))]),_:1}),c(b,{prop:"createdAt",label:"日期",width:"180"}),c(b,{prop:"ip",label:"IP",width:"130"}),c(b,{prop:"clicks",label:"点击次数",width:"80"}),c(b,{label:"操作",width:"140",fixed:"right"},{default:_(({row:d})=>[p(s)[d.keyword]?(x(),A(Z,{key:1},[c(y,{size:"small",onClick:I=>g(d)},{default:_(()=>[E(" 取消 ")]),_:2},1032,["onClick"]),c(y,{size:"small",type:"primary",onClick:I=>h(d)},{default:_(()=>[E(" 更新 ")]),_:2},1032,["onClick"])],64)):(x(),A(Z,{key:0},[c(y,{size:"small",onClick:I=>g(d)},{default:_(()=>[E(" 编辑 ")]),_:2},1032,["onClick"]),c(ae,{width:"160",title:"删除后无法恢复！","confirm-button-type":"danger","confirm-button-text":"删除",onConfirm:I=>o(d)},{reference:_(()=>[c(y,{size:"small",type:"danger"},{default:_(()=>[E(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])],64))]),_:1})]),_:1},8,["data"])),[[oe,p(n)]]),c(se,{"current-page":p(l),"onUpdate:currentPage":i[2]||(i[2]=d=>Y(l)?l.value=d:null),"page-size":p(t),"onUpdate:pageSize":i[3]||(i[3]=d=>Y(t)?t.value=d:null),small:"",background:"",layout:"prev, pager, next",total:p(u)},null,8,["current-page","page-size","total"])])}}});const gt=Be(Je,[["__scopeId","data-v-41af8d31"]]);export{gt as default};
