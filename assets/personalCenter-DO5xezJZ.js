import{k as j,at as q,aw as A,R as E,a4 as g,E as U,r as w,q as V,G as C,K as o,x as a,w as s,N as i,H as _,F as r,L as D,Y as G,W as H,bm as K,aA as y,a0 as L}from"./index-CNzdGqTQ.js";import{a as M,E as O}from"./el-form-item-DU97rFfp.js";import{E as W,a as Y}from"./el-breadcrumb-item-BLHp7L8Y.js";import{T as z}from"./Router-CSCExHsN.js";import"./castArray-D9e7mwfO.js";const J={"h-full":"","w-full":"",flex:"","flex-col":"","gap-4":"","pa-4":""},Q={flex:"","flex-col":"","items-start":"","gap-4":"","text-7":""},X={flex:""},Z={flex:""},h={flex:""},ee={flex:"","gap-4":""},le=j({__name:"personalCenter",setup(ae){const c=q(),d=A(),m=E(!1),b=E(),l=g({nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),B=g({rePasswd:[{validator:(u,e,t)=>{e&&e!==l.passwd?t(new Error("两次输入的密码不一致")):t()}}],oldPasswd:[{validator:(u,e,t)=>{!e&&(l.passwd||l.rePasswd)?t(new Error("请输入旧密码")):t()}}]});function F(){l.nickName=d.profile.nickName??"",l.email=d.profile.email??"",l.passwd="",l.rePasswd="",l.oldPasswd="",m.value=!0}function I(){m.value=!1}async function R(u){u&&await u.validate(async e=>{if(e){const t={};if(l.nickName&&(t.nickName=l.nickName),l.email&&(t.email=l.email),l.passwd&&(t.passwd=l.passwd,t.oldPasswd=l.oldPasswd),Object.keys(t).length===0){y.warning("没有需要修改的信息");return}try{await d.updateUser(t)}catch(k){y.error(k.message)}m.value=!1}else y.warning("请检查输入")})}return(u,e)=>{const t=W,k=Y,S=z,v=D,p=H,f=O,T=M,$=K;return w(),U("div",J,[a(c).meta.parentInfo?(w(),V(k,{key:0},{default:s(()=>[o(t,{to:a(c).meta.parentInfo.link},{default:s(()=>[i(_(a(c).meta.parentInfo.name),1)]),_:1},8,["to"]),o(t,null,{default:s(()=>[i(_(a(c).name),1)]),_:1})]),_:1})):C("",!0),o($,{"flex-1":""},{default:s(()=>{var x,N,P;return[o(S,{level:3},{default:s(()=>e[6]||(e[6]=[i(" 账户信息 ")])),_:1}),r("div",Q,[r("div",X,[e[7]||(e[7]=r("div",{"w-32":""}," 昵称: ",-1)),r("div",null,_(a(d).profile.nickName),1)]),r("div",Z,[e[8]||(e[8]=r("div",{"w-32":""}," 邮箱: ",-1)),r("div",null,_(a(d).profile.email),1)]),r("div",h,[e[9]||(e[9]=r("div",{"w-32":""}," 角色 ",-1)),r("div",null,_(((P=(N=(x=a(d).profile)==null?void 0:x.roles)==null?void 0:N[0])==null?void 0:P.alias)??"注册用户"),1)]),r("div",ee,[a(m)?(w(),U(G,{key:1},[o(v,{type:"primary",onClick:e[0]||(e[0]=n=>R(a(b)))},{default:s(()=>e[11]||(e[11]=[i(" 保存 ")])),_:1}),o(v,{onClick:I},{default:s(()=>e[12]||(e[12]=[i(" 取消 ")])),_:1})],64)):(w(),V(v,{key:0,onClick:F},{default:s(()=>e[10]||(e[10]=[i(" 修改信息 ")])),_:1}))]),a(m)?(w(),V(T,{key:0,ref_key:"ruleFormRef",ref:b,model:a(l),rules:a(B),"label-width":"8rem","label-position":"left"},{default:s(()=>[o(f,{label:"昵称",prop:"nickName"},{default:s(()=>[o(p,{modelValue:a(l).nickName,"onUpdate:modelValue":e[1]||(e[1]=n=>a(l).nickName=n)},null,8,["modelValue"])]),_:1}),o(f,{label:"邮箱",prop:"email"},{default:s(()=>[o(p,{modelValue:a(l).email,"onUpdate:modelValue":e[2]||(e[2]=n=>a(l).email=n)},null,8,["modelValue"])]),_:1}),o(f,{label:"旧密码",prop:"oldPasswd"},{default:s(()=>[o(p,{modelValue:a(l).oldPasswd,"onUpdate:modelValue":e[3]||(e[3]=n=>a(l).oldPasswd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(f,{label:"新密码",prop:"passwd"},{default:s(()=>[o(p,{modelValue:a(l).passwd,"onUpdate:modelValue":e[4]||(e[4]=n=>a(l).passwd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(f,{label:"确认密码",prop:"rePasswd"},{default:s(()=>[o(p,{modelValue:a(l).rePasswd,"onUpdate:modelValue":e[5]||(e[5]=n=>a(l).rePasswd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])):C("",!0)])]}),_:1})])}}}),de=L(le,[["__scopeId","data-v-91c4d900"]]);export{de as default};
