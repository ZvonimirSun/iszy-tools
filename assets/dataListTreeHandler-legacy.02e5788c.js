!function(){var t=document.createElement("style");t.innerHTML=".ant-modal{box-sizing:border-box;margin:0;padding:0;color:rgba(0,0,0,.85);font-size:14px;font-variant:tabular-nums;line-height:1.5715;list-style:none;font-feature-settings:'tnum';position:relative;top:100px;width:auto;margin:0 auto;padding-bottom:24px;pointer-events:none}.ant-modal-wrap{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1000;overflow:auto;outline:0;-webkit-overflow-scrolling:touch}.ant-modal-title{margin:0;color:rgba(0,0,0,.85);font-weight:500;font-size:16px;line-height:22px;word-wrap:break-word}.ant-modal-content{position:relative;background-color:#fff;background-clip:padding-box;border:0;border-radius:2px;box-shadow:0 4px 12px rgba(0,0,0,.15);pointer-events:auto}.ant-modal-close{position:absolute;top:0;right:0;z-index:10;padding:0;color:rgba(0,0,0,.45);font-weight:700;line-height:1;text-decoration:none;background:0 0;border:0;outline:0;cursor:pointer;transition:color .3s}.ant-modal-close-x{display:block;width:56px;height:56px;font-size:16px;font-style:normal;line-height:56px;text-align:center;text-transform:none;text-rendering:auto}.ant-modal-close:focus,.ant-modal-close:hover{color:rgba(0,0,0,.75);text-decoration:none}.ant-modal-header{padding:16px 24px;color:rgba(0,0,0,.85);background:#fff;border-bottom:1px solid #f0f0f0;border-radius:2px 2px 0 0}.ant-modal-body{padding:24px;font-size:14px;line-height:1.5715;word-wrap:break-word}.ant-modal-footer{padding:10px 16px;text-align:right;background:0 0;border-top:1px solid #f0f0f0;border-radius:0 0 2px 2px}.ant-modal-footer button+button{margin-bottom:0;margin-left:8px}.ant-modal.zoom-appear,.ant-modal.zoom-enter{transform:none;opacity:0;animation-duration:.3s;user-select:none}.ant-modal-mask{position:fixed;top:0;right:0;bottom:0;left:0;z-index:1000;height:100%;background-color:rgba(0,0,0,.45)}.ant-modal-mask-hidden{display:none}.ant-modal-open{overflow:hidden}.ant-modal-centered{text-align:center}.ant-modal-centered::before{display:inline-block;width:0;height:100%;vertical-align:middle;content:''}.ant-modal-centered .ant-modal{top:0;display:inline-block;text-align:left;vertical-align:middle}@media (max-width:767px){.ant-modal{max-width:calc(100vw - 16px);margin:8px auto}.ant-modal-centered .ant-modal{flex:1}}.ant-modal-confirm .ant-modal-header{display:none}.ant-modal-confirm .ant-modal-body{padding:32px 32px 24px}.ant-modal-confirm-body-wrapper{zoom:1}.ant-modal-confirm-body-wrapper::after,.ant-modal-confirm-body-wrapper::before{display:table;content:''}.ant-modal-confirm-body-wrapper::after{clear:both}.ant-modal-confirm-body .ant-modal-confirm-title{display:block;overflow:hidden;color:rgba(0,0,0,.85);font-weight:500;font-size:16px;line-height:1.4}.ant-modal-confirm-body .ant-modal-confirm-content{margin-top:8px;color:rgba(0,0,0,.85);font-size:14px}.ant-modal-confirm-body>.anticon{float:left;margin-right:16px;font-size:22px}.ant-modal-confirm-body>.anticon+.ant-modal-confirm-title+.ant-modal-confirm-content{margin-left:38px}.ant-modal-confirm .ant-modal-confirm-btns{float:right;margin-top:24px}.ant-modal-confirm .ant-modal-confirm-btns button+button{margin-bottom:0;margin-left:8px}.ant-modal-confirm-error .ant-modal-confirm-body>.anticon{color:#ff4d4f}.ant-modal-confirm-confirm .ant-modal-confirm-body>.anticon,.ant-modal-confirm-warning .ant-modal-confirm-body>.anticon{color:#faad14}.ant-modal-confirm-info .ant-modal-confirm-body>.anticon{color:#1890ff}.ant-modal-confirm-success .ant-modal-confirm-body>.anticon{color:#52c41a}.jsonEditor[data-v-7e0c288d]{height:calc(100vh - 36.3rem)}.jsonEditor .ace-jsoneditor [data-v-7e0c288d],.jsonEditor textarea.jsoneditor-text [data-v-7e0c288d]{font-family:JetBrains Mono,monospace}.ant-btn-group[data-v-7e0c288d]{margin-bottom:.8rem}[data-v-7e0c288d] .jsoneditor-poweredBy{display:none}",document.head.appendChild(t),System.register(["./container-legacy.4d2a30d7.js","./createFile-legacy.f0bb7aa2.js","./vendor-legacy.4818c0b0.js","./index-legacy.6a2862ef.js","./index-legacy.a000b4fb.js","./index-legacy.c3a455d8.js"],(function(t){"use strict";var e,o,a,n,i,r,d,l,s,c,f,m,p,g,h,u,b,y,x,v,w,k,C;return{setters:[function(t){e=t._},function(t){o=t.J,a=t.c},function(t){n=t.H,i=t.O,r=t.a6,d=t.a7,l=t.a8,s=t.a9,c=t.$,f=t.l,m=t.p,p=t.a,g=t.T,h=t.o,u=t.c,b=t.b,y=t.t,x=t.W,v=t.y,w=t.w,k=t.d,C=t.r},function(){},function(){},function(){}],execute:function(){const{Group:j}=n,{Paragraph:_}=g,z=t("default",{name:"dataListTreeHandler",components:{Container:e,Button:n,Group:j,Upload:i,Modal:r,Paragraph:_,UploadOutlined:d,DownloadOutlined:l,ToolOutlined:s},data:()=>({inited:!1,editor:null,code:void 0,loading:!1,errorLayer:[],showError:!1}),mounted(){this.init()},methods:{init(){this.editor=c(new o(this.$refs.jsonEditor,{mode:"code",modes:["code","tree","view"],onChange:()=>{try{this.code=this.editor.get()}catch(t){}}})),this.inited=!0},upload(t){const e=new FileReader;return e.readAsText(t,"UTF-8"),e.onload=t=>{try{this.code=JSON.parse(t.target.result),this.editor.update(this.code)}catch(t){}},!1},download(){a(this.editor.getText(),"data.json")},async handler(){if(this.errorLayer=[],this.code&&Array.isArray(this.code.layerList)&&this.code.layerList.length>0){const t=this.editor.getMode(),e=setTimeout((()=>{this.loading=!0,this.editor.setMode("preview")}),100),o=f.exports.cloneDeep(this.code);for(const a of o.layerList)await this.checkLayer(a);this.code=o,this.editor.update(this.code),clearTimeout(e),this.editor.setMode(t),this.loading=!1,this.errorLayer.length>0&&(this.showError=!0)}},async checkLayer(t){if("dir"===t.type){if(t.children)for(const e of t.children)await this.checkLayer(e)}else await this.addIdentifyConfig(t)&&t.title&&this.errorLayer.push(t.title)},async addIdentifyConfig(t){let e=0;if(t.serviceConfig&&t.serviceConfig.identify&&t.serviceConfig.type&&t.serviceConfig.type.data)switch(t.serviceConfig.identify.data=t.serviceConfig.identify.data||[],t.serviceConfig.type.data){case"supermap_rest":case"supermap_tile":{const o=t.serviceConfig.relevantUrls&&Array.isArray(t.serviceConfig.relevantUrls.data)?t.serviceConfig.relevantUrls.data.find((t=>"dataUrl"===t.itemKey)):"";if(o)for(const a of t.serviceConfig.identify.data)Array.isArray(a.resultMapping)&&a.resultMapping.length>0||await this.handleSupermapService(a,o.itemValue,a.datasetName)&&(e=1);break}case"arcgis_rest":case"arcgis_tile":{const o=t.serviceConfig.url.data;for(const a of t.serviceConfig.identify.data)Array.isArray(a.resultMapping)&&a.resultMapping.length>0||await this.handleArcgisService(a,o,a.layerId)&&(e=1);break}}return e},async handleSupermapService(t,e,o){try{const a=[],n={datasetNames:[o],getFeatureMode:"ID",ids:[1],hasGeometry:!1},i=e+(e.endsWith("/")?"":"/")+"data/featureResults.json?returnContent=true",r=(await this.$axios.post(i,n)).data;for(const t of r.features[0].fieldNames)a.push({label:t,value:t});return t.resultMapping=a,t.title=t.title||{field:a[0].value,isTemplet:!1,remark:""},0}catch(a){return 1}},async handleArcgisService(t,e,o){try{const a=[];o=parseInt(o);const n=(await this.$axios.get(e+(e.endsWith("/")?"":"/")+o,{params:{f:"json"}})).data,i=n.fields;for(const t of i)a.push({label:t.alias||t.name,value:t.name});return t.layerName=t.layerName||n.name,t.resultMapping=a,t.title=t.title||{field:a[0].value,isTemplet:!1,remark:""},0}catch(a){return 1}}},beforeUnmount(){this.editor&&this.editor.destroy()}}),L=w("data-v-7e0c288d");m("data-v-7e0c288d");const M=k(" 上传 "),U=k(" 下载 "),E=k(" 处理 "),T={ref:"jsonEditor",class:"jsonEditor"},A=k("以下图层处理中遇到错误，可能配置有误，需要检查");p();const O=L(((t,e,o,a,n,i)=>{const r=C("UploadOutlined"),d=C("Button"),l=C("Upload"),s=C("DownloadOutlined"),c=C("ToolOutlined"),f=C("Group"),m=C("Paragraph"),p=C("Modal"),g=C("container");return h(),u(g,null,{default:L((()=>[b(f,null,{default:L((()=>[b(l,{showUploadList:!1,beforeUpload:i.upload,disabled:!t.inited||t.loading},{default:L((()=>[b(d,{type:"primary",disabled:!t.inited||t.loading},{default:L((()=>[b(r),M])),_:1},8,["disabled"])])),_:1},8,["beforeUpload","disabled"]),b(d,{type:"primary",onClick:i.download,disabled:!t.inited||t.loading},{default:L((()=>[b(s),U])),_:1},8,["onClick","disabled"]),b(d,{type:"primary",onClick:i.handler,loading:t.loading,disabled:!t.inited},{default:L((()=>[y(b(c,null,null,512),[[x,!t.loading]]),E])),_:1},8,["onClick","loading","disabled"])])),_:1}),b("div",T,null,512),b(p,{title:"错误提示",visible:t.showError,"onUpdate:visible":e[1]||(e[1]=e=>t.showError=e),onOk:e[2]||(e[2]=e=>t.showError=!1)},{default:L((()=>[b(m,null,{default:L((()=>[A])),_:1}),b(m,null,{default:L((()=>[b("pre",null,v(t.errorLayer.join("\n")),1)])),_:1})])),_:1},8,["visible"])])),_:1})}));z.render=O,z.__scopeId="data-v-7e0c288d"}}}))}();
