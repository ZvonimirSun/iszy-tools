import{bV as B,g as ve,ak as re,al as me,aJ as de,h as Q,S as fe,cC as ke,cD as Ie,aW as pe,j as ge,c9 as _e,y as b,cE as ze,az as Le,k as f,D as ie,ao as we,R as ye,o as w,c as ce,a as c,w as I,m as g,p as u,n as a,ax as ue,av as Ce,s as _,ac as N,aF as Ee,l as S,H as U,aE as Se,a6 as xe,cF as Ne,bA as Oe,q as Te,cG as $e,cH as Ae,I as Re,T as Ve,U as Be,r as J,Y as Me,bb as Ye,v as he,V,aS as M,cI as De,x as be,cJ as He,cK as Xe,t as Fe,X as Pe,bW as We,ab as Ke,cL as je,cM as Ze}from"./index-5c34abaf.js";import{t as le}from"./throttle-2ae4ac6b.js";const qe=(d,y)=>{if(!B||!d||!y)return!1;const r=d.getBoundingClientRect();let s;return y instanceof Element?s=y.getBoundingClientRect():s={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},r.top<s.bottom&&r.bottom>s.top&&r.right>s.left&&r.left<s.right},Ge=ve({urlList:{type:re(Array),default:()=>me([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),Je={close:()=>!0,switch:d=>de(d)},Ue=["src"],Qe=Q({name:"ElImageViewer"}),et=Q({...Qe,props:Ge,emits:Je,setup(d,{expose:y,emit:r}){const s=d,O={CONTAIN:{name:"contain",icon:fe(ke)},ORIGINAL:{name:"original",icon:fe(Ie)}},{t:z}=pe(),l=ge("image-viewer"),{nextZIndex:ee}=_e(),T=b(),x=b([]),L=ze(),k=b(!0),v=b(s.initialIndex),m=Le(O.CONTAIN),i=b({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),Y=f(()=>{const{urlList:e}=s;return e.length<=1}),A=f(()=>v.value===0),F=f(()=>v.value===s.urlList.length-1),te=f(()=>s.urlList[v.value]),ae=f(()=>[l.e("btn"),l.e("prev"),l.is("disabled",!s.infinite&&A.value)]),D=f(()=>[l.e("btn"),l.e("next"),l.is("disabled",!s.infinite&&F.value)]),ne=f(()=>{const{scale:e,deg:n,offsetX:o,offsetY:p,enableTransition:C}=i.value;let h=o/e,E=p/e;switch(n%360){case 90:case-270:[h,E]=[E,-h];break;case 180:case-180:[h,E]=[-h,-E];break;case 270:case-90:[h,E]=[-E,h];break}const R={transform:`scale(${e}) rotate(${n}deg) translate(${h}px, ${E}px)`,transition:C?"transform .3s":""};return m.value.name===O.CONTAIN.name&&(R.maxWidth=R.maxHeight="100%"),R}),P=f(()=>de(s.zIndex)?s.zIndex:ee());function $(){oe(),r("close")}function se(){const e=le(o=>{switch(o.code){case V.esc:s.closeOnPressEscape&&$();break;case V.space:Z();break;case V.left:q();break;case V.up:t("zoomIn");break;case V.right:G();break;case V.down:t("zoomOut");break}}),n=le(o=>{const p=o.deltaY||o.deltaX;t(p<0?"zoomIn":"zoomOut",{zoomRate:s.zoomRate,enableTransition:!1})});L.run(()=>{M(document,"keydown",e),M(document,"wheel",n)})}function oe(){L.stop()}function W(){k.value=!1}function K(e){k.value=!1,e.target.alt=z("el.image.error")}function j(e){if(k.value||e.button!==0||!T.value)return;i.value.enableTransition=!1;const{offsetX:n,offsetY:o}=i.value,p=e.pageX,C=e.pageY,h=le(R=>{i.value={...i.value,offsetX:n+R.pageX-p,offsetY:o+R.pageY-C}}),E=M(document,"mousemove",h);M(document,"mouseup",()=>{E()}),e.preventDefault()}function H(){i.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function Z(){if(k.value)return;const e=De(O),n=Object.values(O),o=m.value.name,C=(n.findIndex(h=>h.name===o)+1)%e.length;m.value=O[e[C]],H()}function X(e){const n=s.urlList.length;v.value=(e+n)%n}function q(){A.value&&!s.infinite||X(v.value-1)}function G(){F.value&&!s.infinite||X(v.value+1)}function t(e,n={}){if(k.value)return;const{zoomRate:o,rotateDeg:p,enableTransition:C}={zoomRate:s.zoomRate,rotateDeg:90,enableTransition:!0,...n};switch(e){case"zoomOut":i.value.scale>.2&&(i.value.scale=Number.parseFloat((i.value.scale/o).toFixed(3)));break;case"zoomIn":i.value.scale<7&&(i.value.scale=Number.parseFloat((i.value.scale*o).toFixed(3)));break;case"clockwise":i.value.deg+=p;break;case"anticlockwise":i.value.deg-=p;break}i.value.enableTransition=C}return ie(te,()=>{we(()=>{const e=x.value[0];e?.complete||(k.value=!0)})}),ie(v,e=>{H(),r("switch",e)}),ye(()=>{var e,n;se(),(n=(e=T.value)==null?void 0:e.focus)==null||n.call(e)}),y({setActiveItem:X}),(e,n)=>(w(),ce(Ye,{to:"body",disabled:!e.teleported},[c(Me,{name:"viewer-fade",appear:""},{default:I(()=>[g("div",{ref_key:"wrapper",ref:T,tabindex:-1,class:u(a(l).e("wrapper")),style:ue({zIndex:a(P)})},[g("div",{class:u(a(l).e("mask")),onClick:n[0]||(n[0]=Ce(o=>e.hideOnClickModal&&$(),["self"]))},null,2),_(" CLOSE "),g("span",{class:u([a(l).e("btn"),a(l).e("close")]),onClick:$},[c(a(N),null,{default:I(()=>[c(a(Ee))]),_:1})],2),_(" ARROW "),a(Y)?_("v-if",!0):(w(),S(U,{key:0},[g("span",{class:u(a(ae)),onClick:q},[c(a(N),null,{default:I(()=>[c(a(Se))]),_:1})],2),g("span",{class:u(a(D)),onClick:G},[c(a(N),null,{default:I(()=>[c(a(xe))]),_:1})],2)],64)),_(" ACTIONS "),g("div",{class:u([a(l).e("btn"),a(l).e("actions")])},[g("div",{class:u(a(l).e("actions__inner"))},[c(a(N),{onClick:n[1]||(n[1]=o=>t("zoomOut"))},{default:I(()=>[c(a(Ne))]),_:1}),c(a(N),{onClick:n[2]||(n[2]=o=>t("zoomIn"))},{default:I(()=>[c(a(Oe))]),_:1}),g("i",{class:u(a(l).e("actions__divider"))},null,2),c(a(N),{onClick:Z},{default:I(()=>[(w(),ce(Te(a(m).icon)))]),_:1}),g("i",{class:u(a(l).e("actions__divider"))},null,2),c(a(N),{onClick:n[3]||(n[3]=o=>t("anticlockwise"))},{default:I(()=>[c(a($e))]),_:1}),c(a(N),{onClick:n[4]||(n[4]=o=>t("clockwise"))},{default:I(()=>[c(a(Ae))]),_:1})],2)],2),_(" CANVAS "),g("div",{class:u(a(l).e("canvas"))},[(w(!0),S(U,null,Re(e.urlList,(o,p)=>Ve((w(),S("img",{ref_for:!0,ref:C=>x.value[p]=C,key:o,src:o,style:ue(a(ne)),class:u(a(l).e("img")),onLoad:W,onError:K,onMousedown:j},null,46,Ue)),[[Be,p===v.value]])),128))],2),J(e.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var tt=he(et,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const at=be(tt),nt=ve({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:re([String,Object])},previewSrcList:{type:re(Array),default:()=>me([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2}}),st={load:d=>d instanceof Event,error:d=>d instanceof Event,switch:d=>de(d),close:()=>!0,show:()=>!0},ot=["src","loading"],lt={key:0},rt=Q({name:"ElImage",inheritAttrs:!1}),it=Q({...rt,props:nt,emits:st,setup(d,{emit:y}){const r=d;let s="";const{t:O}=pe(),z=ge("image"),l=He(),ee=Xe(),T=b(),x=b(!1),L=b(!0),k=b(!1),v=b(),m=b(),i=B&&"loading"in HTMLImageElement.prototype;let Y,A;const F=f(()=>[z.e("inner"),D.value&&z.e("preview"),L.value&&z.is("loading")]),te=f(()=>l.style),ae=f(()=>{const{fit:t}=r;return B&&t?{objectFit:t}:{}}),D=f(()=>{const{previewSrcList:t}=r;return Array.isArray(t)&&t.length>0}),ne=f(()=>{const{previewSrcList:t,initialIndex:e}=r;let n=e;return e>t.length-1&&(n=0),n}),P=f(()=>r.loading==="eager"?!1:!i&&r.loading==="lazy"||r.lazy),$=()=>{B&&(L.value=!0,x.value=!1,T.value=r.src)};function se(t){L.value=!1,x.value=!1,y("load",t)}function oe(t){L.value=!1,x.value=!0,y("error",t)}function W(){qe(v.value,m.value)&&($(),H())}const K=Ze(W,200,!0);async function j(){var t;if(!B)return;await we();const{scrollContainer:e}=r;We(e)?m.value=e:Ke(e)&&e!==""?m.value=(t=document.querySelector(e))!=null?t:void 0:v.value&&(m.value=je(v.value)),m.value&&(Y=M(m,"scroll",K),setTimeout(()=>W(),100))}function H(){!B||!m.value||!K||(Y?.(),m.value=void 0)}function Z(t){if(t.ctrlKey){if(t.deltaY<0)return t.preventDefault(),!1;if(t.deltaY>0)return t.preventDefault(),!1}}function X(){D.value&&(A=M("wheel",Z,{passive:!1}),s=document.body.style.overflow,document.body.style.overflow="hidden",k.value=!0,y("show"))}function q(){A?.(),document.body.style.overflow=s,k.value=!1,y("close")}function G(t){y("switch",t)}return ie(()=>r.src,()=>{P.value?(L.value=!0,x.value=!1,H(),j()):$()}),ye(()=>{P.value?j():$()}),(t,e)=>(w(),S("div",{ref_key:"container",ref:v,class:u([a(z).b(),t.$attrs.class]),style:ue(a(te))},[x.value?J(t.$slots,"error",{key:0},()=>[g("div",{class:u(a(z).e("error"))},Fe(a(O)("el.image.error")),3)]):(w(),S(U,{key:1},[T.value!==void 0?(w(),S("img",Pe({key:0},a(ee),{src:T.value,loading:t.loading,style:a(ae),class:a(F),onClick:X,onLoad:se,onError:oe}),null,16,ot)):_("v-if",!0),L.value?(w(),S("div",{key:1,class:u(a(z).e("wrapper"))},[J(t.$slots,"placeholder",{},()=>[g("div",{class:u(a(z).e("placeholder"))},null,2)])],2)):_("v-if",!0)],64)),a(D)?(w(),S(U,{key:2},[k.value?(w(),ce(a(at),{key:0,"z-index":t.zIndex,"initial-index":a(ne),infinite:t.infinite,"zoom-rate":t.zoomRate,"url-list":t.previewSrcList,"hide-on-click-modal":t.hideOnClickModal,teleported:t.previewTeleported,"close-on-press-escape":t.closeOnPressEscape,onClose:q,onSwitch:G},{default:I(()=>[t.$slots.viewer?(w(),S("div",lt,[J(t.$slots,"viewer")])):_("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):_("v-if",!0)],64)):_("v-if",!0)],6))}});var ct=he(it,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const ft=be(ct);export{ft as E};
