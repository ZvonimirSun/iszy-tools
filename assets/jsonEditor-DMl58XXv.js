import{bn as V,P as ht,aw as pt,Q as vt,aW as D,aZ as gt,bo as Q,bp as _t,j as yt,R as S,T as Ct,k as $t,o as y,F as C,aj as U,ap as Z,m as u,G as f,K as p,n as b,q,w as g,X as F,L as w,H as Dt,W as G,Y as St,I as K,Z as wt,N as It,$ as xt,a0 as kt,a1 as Et,a2 as jt}from"./index-B64UzQ7O.js";import{v as Lt}from"./el-loading-Cs9Uyc_d.js";import{E as bt}from"./el-dialog-6jBpT6o3.js";import{E as Mt}from"./el-space-C8juaj_X.js";import{V as O}from"./VanillaJsonEditor-nLNVIU6S.js";import{u as tt}from"./useComponentRef-B9nY-MAs.js";import{d as I}from"./dayjs.min-p-2d_Lf4.js";import{P as Pt}from"./Router-C0aDl8pN.js";import"./index-chG_rj5Z.js";import"./isUndefined-DCTLXrZ8.js";import"./el-popper-BdJY1EqL.js";import"./jse-theme-dark-CFmzvhlh.js";import"./memoize-one.esm-BdPwpGay.js";import"./index-DDFCK9dU.js";import"./range-CCn-ECPT.js";import"./toFinite-CCKxI8X3.js";import"./map-D4qGIjMb.js";import"./_baseIteratee-w-aZALqf.js";import"./_baseEach-D39NVPE_.js";import"./_castFunction-D5jfTCvG.js";import"./createFile-Ce56hxh9.js";import"./formatBytes-aAslYXQD.js";import"./castArray-0GIcrlWO.js";function Yt(t,n,e){return t===t&&(e!==void 0&&(t=t<=e?t:e),n!==void 0&&(t=t>=n?t:n)),t}function Nt(t,n,e){return e===void 0&&(e=n,n=void 0),e!==void 0&&(e=V(e),e=e===e?e:0),n!==void 0&&(n=V(n),n=n===n?n:0),Yt(V(t),n,e)}function et(t,n){t=t||32,n=n||"ABCDEFGHJKMNPQRSTWXYZabcdefghijkmnprstwxyz2345678";const e=n.length;let r="";for(let m=0;m<t;m++)r+=n.charAt(Math.floor(Math.random()*e));return r}const Vt=new _t;let M={},at=!1;const nt=ht("jsonEditor",{persist:!0,state:()=>({leftId:null,rightId:null,splitterValue:.5,fullStatus:"",$_data:{}}),getters:{dataList:t=>n=>{const e=[];for(const r in t.$_data)e.push({_id:r,name:t.$_data[r].name,updated:I(t.$_data[r].updated).format("YYYY-MM-DD HH:mm")});return n?e.filter(r=>r.name.includes(n)):e},data:t=>n=>t.$_data[n]?{...t.$_data[n],updated:I(t.$_data[n].updated).format("YYYY-MM-DD HH:mm")}:null,leftData:t=>t.leftId&&t.$_data[t.leftId]?{...t.$_data[t.leftId],updated:I(t.$_data[t.leftId].updated).format("YYYY-MM-DD HH:mm")}:null,rightData:t=>t.rightId&&t.$_data[t.rightId]?{...t.$_data[t.rightId],updated:I(t.$_data[t.rightId].updated).format("YYYY-MM-DD HH:mm")}:null,syncCloud:()=>pt().logged&&vt().modules.jsonEditor.syncCloud},actions:{setSplitter(t=.5){this.splitterValue=Nt(t,0,1)},setFullStatus(t){t==="left"||t==="right"?this.fullStatus=t:this.fullStatus=""},replaceState(t=[]){const n={};for(const e of t)n[e.key]={name:e.name,content:{}},e.text!=null?n[e.key].content.text=e.text:e.json!=null&&(n[e.key].content.json=e.json),n[e.key].updated=I(e.updatedAt).format();this.$_data=n},async getSyncData(){try{const t=(await D.get(`${D.$apiBase}/tools/jsoneditor`)).data;t.success?this.replaceState(t.data):console.log(t.message)}catch(t){console.log(t.message)}},syncData:gt(({id:t,data:n}={})=>{if(navigator.onLine)Vt.enqueue(D.post(`${D.$apiBase}/tools/jsoneditor/${t}`,n));else if(M[t]=n,!at){let e=function(){window.removeEventListener("online",e);for(const r in M)nt().syncData({id:r,data:M[r]});M={}};at=!0,window.addEventListener("online",e)}},500),saveData({left:t,right:n,id:e,content:r,name:m}={}){if(this.syncCloud&&(e=e||et(6),r!=null||m!=null)){const d={name:m||(this.$_data[e]||{}).name||`文档-${e}`};typeof r=="string"?d.text=r:typeof r=="object"&&(d.json=Q(r)),this.syncData({id:e,data:d})}typeof r<"u"?(e=e||et(6),this.$_data[e]=this.$_data[e]||{},this.$_data[e].name=m||this.$_data[e].name||`文档-${e}`,typeof r=="string"?this.$_data[e].content={text:r}:this.$_data[e].content={json:Q(r)},this.$_data[e].updated=I().format(),t&&(this.leftId=e),n&&(this.rightId=e)):e&&this.$_data[e]?(t&&(this.leftId=e),n&&(this.rightId=e),this.$_data[e].name=m||this.$_data[e].name):(t&&(this.leftId=null),n&&(this.rightId=null))},async deleteData({id:t}={}){if(this.syncCloud)try{const n=(await D.delete(`${D.$apiBase}/tools/jsoneditor/${t}`)).data;n.success?(this.leftId===t&&(this.leftId=null),this.rightId===t&&(this.rightId=null),this.$_data[t]&&delete this.$_data[t]):console.log(n.message)}catch(n){console.log(n)}else this.leftId===t&&(this.leftId=null),this.rightId===t&&(this.rightId=null),this.$_data[t]&&delete this.$_data[t]}}}),x=t=>(kt("data-v-382b1951"),t=t(),Et(),t),Ft={"element-loading-text":"同步中...",class:"loadingPanel"},Bt=x(()=>f("div",{class:"emptySpace"},null,-1)),Ht=x(()=>f("span",{class:"i-icon-park-outline-right"},null,-1)),zt=x(()=>f("span",{class:"i-icon-park-outline-left"},null,-1)),Rt={class:"dragIcon"},Xt={key:0,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"chevron-right",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},Tt=x(()=>f("path",{fill:"currentColor",d:"M96 480c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L242.8 256L73.38 86.63c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l192 192c12.5 12.5 12.5 32.75 0 45.25l-192 192C112.4 476.9 104.2 480 96 480z"},null,-1)),Wt=[Tt],At={key:1,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"chevron-left",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},Jt=x(()=>f("path",{fill:"currentColor",d:"M224 480c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25l192-192c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l169.4 169.4c12.5 12.5 12.5 32.75 0 45.25C240.4 476.9 232.2 480 224 480z"},null,-1)),Qt=[Jt],Ut={key:2,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"ellipsis-vertical",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 128 512"},Zt=x(()=>f("path",{fill:"currentColor",d:"M64 360C94.93 360 120 385.1 120 416C120 446.9 94.93 472 64 472C33.07 472 8 446.9 8 416C8 385.1 33.07 360 64 360zM64 200C94.93 200 120 225.1 120 256C120 286.9 94.93 312 64 312C33.07 312 8 286.9 8 256C8 225.1 33.07 200 64 200zM64 152C33.07 152 8 126.9 8 96C8 65.07 33.07 40 64 40C94.93 40 120 65.07 120 96C120 126.9 94.93 152 64 152z"},null,-1)),qt=[Zt],Gt={class:"data-list"},Kt=["onClick"],Ot={class:"data-list-item-info"},te={class:"data-list-item-info-title"},ee={class:"data-list-item-info-description"},ae={class:"data-list-item-actions"},ne={class:"dialog-footer"},oe=yt({__name:"jsonEditor",setup(t){const n=tt(),e=tt(),r=S(),m=S(!0),d=S(""),o=nt(),ot={array:[1,2,3],boolean:!0,color:"gold",null:null,number:123,object:{a:"b",c:"d"},string:"Hello World"};Ct(()=>{lt()});async function lt(){var l,a,s,c,h;o.syncCloud&&await o.getSyncData(),m.value=!1,o.leftData&&o.leftData.content?o.leftData.content.json?(l=n.value)==null||l.set(o.leftData.content.json):o.leftData.content.text&&((a=n.value)==null||a.set(o.leftData.content.text)):(s=n.value)==null||s.set(ot),o.rightData&&o.rightData.content&&(o.rightData.content.json?(c=e.value)==null||c.set(o.rightData.content.json):o.rightData.content.text&&((h=e.value)==null||h.set(o.rightData.content.text))),d.value=o.fullStatus}function B(l){var a,s;o.saveData({[l]:!0}),l==="left"?(a=n.value)==null||a.set({}):l==="right"&&((s=e.value)==null||s.set({}))}function H(l,a){let s=null;l==="left"?s=o.leftId:l==="right"&&(s=o.rightId),s&&o.saveData({id:s,name:a})}function z(l,a){let s=null;l==="left"?s=o.leftId:l==="right"&&(s=o.rightId);const c={[l]:!0,content:a};s&&(c.id=s),o.saveData(c)}const $=S(!1),_=S(""),k=S("");let P="";const st=$t(()=>o.dataList(k.value));function R(l){_.value="",k.value="",P=l,$.value=!0}function it(){var l,a,s,c;if(_.value){const h=o.data(_.value);if(h&&h.content){const v=h.content;P==="left"?(o.saveData({left:!0,id:_.value}),v.json?(l=n.value)==null||l.set(v.json):v.text&&((a=n.value)==null||a.set(v.text))):P==="right"&&(o.saveData({right:!0,id:_.value}),v.json?(s=e.value)==null||s.set(v.json):v.text&&((c=e.value)==null||c.set(v.text)))}}$.value=!1}function X(l,{name:a,content:s}){var c,h;o.saveData({[l]:!0,name:a,content:s}),l==="left"?(c=n.value)==null||c.set(s):l==="right"&&((h=e.value)==null||h.set(s))}function T(l){const a=l==="left"?o.leftId:o.rightId;a&&o.deleteData({id:a})}function rt(){var a,s;const l=(a=n.value)==null?void 0:a.get();l!=null&&((s=e.value)==null||s.set(l))}function dt(){var a,s;const l=(a=e.value)==null?void 0:a.get();l!=null&&((s=n.value)==null||s.set(l))}let Y=0,E=0,N=!1;function W(l){var s;if(l instanceof MouseEvent&&l.button!==0)return;const a=(s=n.value)==null?void 0:s.container;a&&(N=!1,E=Number.parseFloat(window.getComputedStyle(a).width),Number.isNaN(E)&&(E=0),l instanceof TouchEvent?(Y=l.touches[0].clientX,document.addEventListener("touchend",L),document.addEventListener("touchmove",j)):(Y=l.clientX,document.addEventListener("mouseup",L),document.addEventListener("mousemove",j)))}function j(l){if(!r.value)return;N=!0;let a=0;l instanceof TouchEvent?a=l.touches[0].clientX:a=l.clientX;const s=E-Y+a,c=Number.parseFloat(window.getComputedStyle(r.value).width);s<435?(d.value="right",d.value!==o.fullStatus&&o.setFullStatus("right")):c-100-s<435?(d.value="left",d.value!==o.fullStatus&&o.setFullStatus("left")):(d.value="",o.setSplitter(s/(c-100)),d.value!==o.fullStatus&&o.setFullStatus())}function L(){document.removeEventListener("mousemove",j),document.removeEventListener("touchmove",j),document.removeEventListener("mouseup",L),document.removeEventListener("touchend",L)}function ut(){r.value&&(N||(d.value==="left"?(o.setSplitter(1-435/(Number.parseFloat(window.getComputedStyle(r.value).width)-100)),d.value=""):d.value==="right"&&(o.setSplitter(435/(Number.parseFloat(window.getComputedStyle(r.value).width)-100)),d.value="")))}return(l,a)=>{var A,J;const s=It,c=Mt,h=Pt,v=xt,ft=bt,ct=Lt;return y(),C(F,null,[U(f("div",Ft,null,512),[[Z,u(m)],[ct,!0]]),U(f("div",{ref_key:"editorPanel",ref:r,class:"editorPanel"},[p(O,{ref_key:"editorPanelContainerLeft",ref:n,"show-menu-bar":"",class:b(["editorPanelContainer editorPanelContainerLeft",{full:u(d)==="left",hide:u(d)==="right"}]),style:q({flex:`${u(o).splitterValue} 1 0`}),name:(A=u(o).leftData)==null?void 0:A.name,config:{mode:"text"},onChange:a[0]||(a[0]=i=>z("left",i)),onOpenRecent:a[1]||(a[1]=i=>R("left")),onOpen:a[2]||(a[2]=i=>X("left",i)),onCreate:a[3]||(a[3]=i=>B("left")),onChangeName:a[4]||(a[4]=i=>H("left",i)),onDelete:a[5]||(a[5]=i=>T("left"))},null,8,["class","style","name"]),f("div",{class:b(["controller noShowMobile",{full:u(d)}])},[p(c,{direction:"vertical"},{default:g(()=>[u(d)?Dt("",!0):(y(),C(F,{key:0},[Bt,p(s,{type:"primary",block:"",onClick:rt},{default:g(()=>[w(" 复制 "),Ht]),_:1}),p(s,{type:"primary",block:"",onClick:dt},{default:g(()=>[zt,w(" 复制 ")]),_:1})],64)),f("div",{class:"drag",onMousedown:W,onTouchstart:W,onClick:ut},[f("div",Rt,[u(d)==="right"?(y(),C("svg",Xt,Wt)):u(d)==="left"?(y(),C("svg",At,Qt)):(y(),C("svg",Ut,qt))])],32)]),_:1})],2),p(O,{ref_key:"editorPanelContainerRight",ref:e,"show-menu-bar":"",class:b(["editorPanelContainer noShowMobile editorPanelContainerRight",{full:u(d)==="right",hide:u(d)==="left"}]),style:q({flex:`${1-u(o).splitterValue} 1 0`}),name:(J=u(o).rightData)==null?void 0:J.name,config:{mode:"tree"},onChange:a[6]||(a[6]=i=>z("right",i)),onOpenRecent:a[7]||(a[7]=i=>R("right")),onOpen:a[8]||(a[8]=i=>X("right",i)),onCreate:a[9]||(a[9]=i=>B("right")),onChangeName:a[10]||(a[10]=i=>H("right",i)),onDelete:a[11]||(a[11]=i=>T("right"))},null,8,["class","style","name"])],512),[[Z,!u(m)]]),p(ft,{modelValue:u($),"onUpdate:modelValue":a[14]||(a[14]=i=>G($)?$.value=i:null),title:"打开最近"},{footer:g(()=>[f("span",ne,[p(s,{onClick:a[13]||(a[13]=i=>$.value=!1)},{default:g(()=>[w("取消")]),_:1}),p(s,{type:"primary",onClick:it},{default:g(()=>[w(" 确定 ")]),_:1})])]),default:g(()=>[p(h,null,{default:g(()=>[w("搜索")]),_:1}),p(v,{modelValue:u(k),"onUpdate:modelValue":a[12]||(a[12]=i=>G(k)?k.value=i:null),placeholder:"请输入文档名称"},null,8,["modelValue"]),f("div",Gt,[(y(!0),C(F,null,St(u(st),i=>(y(),C("div",{key:i._id,class:b(["data-list-item",{selected:i._id===u(_)}]),onClick:mt=>_.value=i._id},[f("div",Ot,[f("div",te,K(i.name),1),f("div",ee,K(`最后修改: ${i.updated}`),1)]),f("div",ae,[p(s,{type:"danger",onClick:wt(mt=>u(o).deleteData({id:i._id}),["stop"])},{default:g(()=>[w(" 删除 ")]),_:2},1032,["onClick"])])],10,Kt))),128))])]),_:1},8,["modelValue"])],64)}}}),Ee=jt(oe,[["__scopeId","data-v-382b1951"]]);export{Ee as default};
