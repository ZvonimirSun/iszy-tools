import{j as T,l as j,Z as G,k as z,x as E,$ as A,y as m,o as w,c as L,b as p,aj as V,n as F,aH as P,ak as q,bn as H,bo as I,_ as M,bp as Z,ad as $}from"./vendor-DRS8ysml.js";import{as as h}from"./common-ySY-sjSN.js";const Q=T({__name:"propertyTable",props:{height:{default:null}},setup(U){j(()=>{h.on("updateGeojsonLayer",k),h.on("updateEditor",k)});const u=G(),n=z({row:null,col:null,value:null,changed:!1});let y=!1;const b=E(()=>{var t,e;return(e=(t=u.value)==null?void 0:t.features)!=null&&e.length?u.value.features.map(a=>a.properties||{}):[]}),_=E(()=>{var t,e;if((e=(t=u.value)==null?void 0:t.features)!=null&&e.length){const a=C(b.value);if(!a.length)return null;const l=a.map(s=>({title:s,dataKey:s,key:s,width:150,cellRenderer:({rowData:o,column:i,rowIndex:c,columnIndex:d})=>{let f,g;o[i.dataKey]!=null?(g=typeof o[i.dataKey],~["boolean","number","string"].indexOf(g)?f=o[i.dataKey].toString():f=JSON.stringify(o[i.dataKey])):f="";const R=()=>{n.row=c,n.col=d,n.value=f},J=()=>{if(n.changed){let r;if(n.value!=null?r=n.value.trim():r="",g!=="string")try{r=JSON.parse(r)}catch{}K(c,d,r)}n.row=null,n.col=null,n.value=null,n.changed=!1},N=r=>{n.value=r,n.changed=!0},B=r=>{var v;(v=r==null?void 0:r.focus)==null||v.call(r)};return n.row===c&&n.col===d?p(q,{ref:B,modelValue:n.value,onInput:N,onBlur:J},null):p("div",{class:"table-v2-inline-editing-trigger",onClick:R,title:f},[f])}}));return l.unshift({title:"序号",dataKey:"index",key:"index",width:50,fixed:!0,cellRenderer:({rowIndex:s})=>p("span",{class:"_index"},[s+1])}),l}else return null}),x=A(O,500);function S(t){var a;let e=t.target;if(e.classList.contains("el-table-v2__row")||(e=e.closest(".el-table-v2__row")),e&&e.parentElement){const l=[].indexOf.call(e.parentElement.children,e),s=(a=e.closest(".el-table-v2__root"))==null?void 0:a.querySelectorAll("._index")[l];if(s){const o=parseInt(s.textContent||"1")-1;h.emit("selectFeature",o)}}}function K(t,e,a){var s,o,i,c;const l=(o=(s=u.value)==null?void 0:s.features)==null?void 0:o[t];if(l){l.properties||(l.properties={});const d=(c=(i=_.value)==null?void 0:i[e])==null?void 0:c.dataKey;d&&(l.properties[d]=a)}u.value&&x(M(u.value))}function O(t){y||(y=!0,h.emit("updateEditor",t),y=!1)}function k(){y||h.emit("getGeoJson",function(t){u.value=t})}function C(t){return[...t.reduce((e,a)=>(Object.keys(a).forEach(l=>e.add(l)),e),new Set)]}return(t,e)=>{const a=H,l=I,s=Z;return m(_)?(w(),L("div",{key:0,"w-full":"",style:F({height:t.height?t.height+"px":void 0})},[p(l,null,{default:V(({height:o,width:i})=>[p(a,{columns:m(_),data:m(b),width:i,height:o,fixed:"",onClick:S},null,8,["columns","data","width","height"])]),_:1})],4)):(w(),P(s,{key:1}))}}}),Y=$(Q,[["__scopeId","data-v-bb1c1a0c"]]);export{Y as default};
