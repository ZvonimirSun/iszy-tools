import{c$ as Me,aV as Be,e as we,b as ze,d as J,m as Le,_ as Se,a as ne,bp as Ie,dB as Ve,dC as Fe,aM as _e,u as Ne,cd as Xe,I as w,dD as De,c as f,dE as Ye,Z as He,X as te,J as $e,aI as Z,g as ye,o as b,w as m,C as u,a6 as Ke,x as h,n as Ce,h as v,j as a,ck as je,y as I,v as N,r as L,P as We,aF as x,be as Ze,N as he,bc as qe,bd as Je,D as Ge,z as Oe,dF as Ue,cp as Qe,k as ea,dG as aa,dH as sa,dw as ta,aJ as na,aK as H,aa as Te,l as Re,a_ as oa,cM as la,dI as ra,bK as q,av as ia,ar as Ee,aX as ca,b1 as me,bs as pe,cC as ua,az as da,dJ as fa,dK as va,dL as ma,dM as pa}from"./index-B74qAObi.js";import{E as ga}from"./index-DqSb17bi.js";var wa="Expected a function";function ge(i,V,c){var d=!0,t=!0;if(typeof i!="function")throw new TypeError(wa);return Me(c)&&(d="leading"in c?!!c.leading:d,t="trailing"in c?!!c.trailing:t),Be(i,V,{leading:d,maxWait:V,trailing:t})}const ya=ze({urlList:{type:J(Array),default:()=>Le([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:J(String)}}),ha={close:()=>!0,error:i=>i instanceof Event,switch:i=>we(i),rotate:i=>we(i)},ba=ne({name:"ElImageViewer"}),ka=ne({...ba,props:ya,emits:ha,setup(i,{expose:V,emit:c}){var d;const t=i,p={CONTAIN:{name:"contain",icon:Ie(Fe)},ORIGINAL:{name:"original",icon:Ie(Ve)}};let K,j="";const{t:oe}=_e(),n=Ne("image-viewer"),{nextZIndex:P}=Xe(),C=w(),F=w(),A=De(),S=f(()=>{const{scale:e,minScale:r,maxScale:l}=t;return Ye(e,r,l)}),$=w(!0),E=w(!1),g=w(t.initialIndex),X=He(p.CONTAIN),o=w({scale:S.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),le=w((d=t.zIndex)!=null?d:P()),G=f(()=>{const{urlList:e}=t;return e.length<=1}),D=f(()=>g.value===0),U=f(()=>g.value===t.urlList.length-1),Y=f(()=>t.urlList[g.value]),re=f(()=>[n.e("btn"),n.e("prev"),n.is("disabled",!t.infinite&&D.value)]),Q=f(()=>[n.e("btn"),n.e("next"),n.is("disabled",!t.infinite&&U.value)]),ee=f(()=>{const{scale:e,deg:r,offsetX:l,offsetY:_,enableTransition:T}=o.value;let z=l/e,R=_/e;const W=r*Math.PI/180,be=Math.cos(W),ke=Math.sin(W);z=z*be+R*ke,R=R*be-l/e*ke;const ve={transform:`scale(${e}) rotate(${r}deg) translate(${z}px, ${R}px)`,transition:T?"transform .3s":""};return X.value.name===p.CONTAIN.name&&(ve.maxWidth=ve.maxHeight="100%"),ve}),ae=f(()=>`${g.value+1} / ${t.urlList.length}`);function M(){ce(),K?.(),document.body.style.overflow=j,c("close")}function ie(){const e=ge(l=>{switch(na(l)){case H.esc:t.closeOnPressEscape&&M();break;case H.space:ue();break;case H.left:de();break;case H.up:O("zoomIn");break;case H.right:fe();break;case H.down:O("zoomOut");break}}),r=ge(l=>{const _=l.deltaY||l.deltaX;O(_<0?"zoomIn":"zoomOut",{zoomRate:t.zoomRate,enableTransition:!1})});A.run(()=>{Z(document,"keydown",e),Z(document,"wheel",r)})}function ce(){A.stop()}function s(){$.value=!1}function k(e){E.value=!0,$.value=!1,c("error",e),e.target.alt=oe("el.image.error")}function y(e){if($.value||e.button!==0||!C.value)return;o.value.enableTransition=!1;const{offsetX:r,offsetY:l}=o.value,_=e.pageX,T=e.pageY,z=ge(W=>{o.value={...o.value,offsetX:r+W.pageX-_,offsetY:l+W.pageY-T}}),R=Z(document,"mousemove",z);Z(document,"mouseup",()=>{R()}),e.preventDefault()}function B(){o.value={scale:S.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function ue(){if($.value||E.value)return;const e=ta(p),r=Object.values(p),l=X.value.name,T=(r.findIndex(z=>z.name===l)+1)%e.length;X.value=p[e[T]],B()}function se(e){E.value=!1;const r=t.urlList.length;g.value=(e+r)%r}function de(){D.value&&!t.infinite||se(g.value-1)}function fe(){U.value&&!t.infinite||se(g.value+1)}function O(e,r={}){if($.value||E.value)return;const{minScale:l,maxScale:_}=t,{zoomRate:T,rotateDeg:z,enableTransition:R}={zoomRate:t.zoomRate,rotateDeg:90,enableTransition:!0,...r};switch(e){case"zoomOut":o.value.scale>l&&(o.value.scale=Number.parseFloat((o.value.scale/T).toFixed(3)));break;case"zoomIn":o.value.scale<_&&(o.value.scale=Number.parseFloat((o.value.scale*T).toFixed(3)));break;case"clockwise":o.value.deg+=z,c("rotate",o.value.deg);break;case"anticlockwise":o.value.deg-=z,c("rotate",o.value.deg);break}o.value.enableTransition=R}function xe(e){var r;((r=e.detail)==null?void 0:r.focusReason)==="pointer"&&e.preventDefault()}function Pe(){t.closeOnPressEscape&&M()}function Ae(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return te(()=>S.value,e=>{o.value.scale=e}),te(Y,()=>{Te(()=>{const e=F.value;e?.complete||($.value=!0)})}),te(g,e=>{B(),c("switch",e)}),$e(()=>{ie(),K=Z("wheel",Ae,{passive:!1}),j=document.body.style.overflow,document.body.style.overflow="hidden"}),V({setActiveItem:se}),(e,r)=>(b(),ye(a(ga),{to:"body",disabled:!e.teleported},{default:m(()=>[u(Ke,{name:"viewer-fade",appear:""},{default:m(()=>[h("div",{ref_key:"wrapper",ref:C,tabindex:-1,class:v(a(n).e("wrapper")),style:Ce({zIndex:le.value})},[u(a(je),{loop:"",trapped:"","focus-trap-el":C.value,"focus-start-el":"container",onFocusoutPrevented:xe,onReleaseRequested:Pe},{default:m(()=>[h("div",{class:v(a(n).e("mask")),onClick:We(l=>e.hideOnClickModal&&M(),["self"])},null,10,["onClick"]),I(" CLOSE "),h("span",{class:v([a(n).e("btn"),a(n).e("close")]),onClick:M},[u(a(x),null,{default:m(()=>[u(a(Ze))]),_:1})],2),I(" ARROW "),a(G)?I("v-if",!0):(b(),N(he,{key:0},[h("span",{class:v(a(re)),onClick:de},[u(a(x),null,{default:m(()=>[u(a(qe))]),_:1})],2),h("span",{class:v(a(Q)),onClick:fe},[u(a(x),null,{default:m(()=>[u(a(Je))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(b(),N("div",{key:1,class:v([a(n).e("btn"),a(n).e("progress")])},[L(e.$slots,"progress",{activeIndex:g.value,total:e.urlList.length},()=>[Ge(Oe(a(ae)),1)])],2)):I("v-if",!0),I(" ACTIONS "),h("div",{class:v([a(n).e("btn"),a(n).e("actions")])},[h("div",{class:v(a(n).e("actions__inner"))},[L(e.$slots,"toolbar",{actions:O,prev:de,next:fe,reset:ue,activeIndex:g.value,setActiveItem:se},()=>[u(a(x),{onClick:l=>O("zoomOut")},{default:m(()=>[u(a(Ue))]),_:1},8,["onClick"]),u(a(x),{onClick:l=>O("zoomIn")},{default:m(()=>[u(a(Qe))]),_:1},8,["onClick"]),h("i",{class:v(a(n).e("actions__divider"))},null,2),u(a(x),{onClick:ue},{default:m(()=>[(b(),ye(ea(a(X).icon)))]),_:1}),h("i",{class:v(a(n).e("actions__divider"))},null,2),u(a(x),{onClick:l=>O("anticlockwise")},{default:m(()=>[u(a(aa))]),_:1},8,["onClick"]),u(a(x),{onClick:l=>O("clockwise")},{default:m(()=>[u(a(sa))]),_:1},8,["onClick"])])],2)],2),I(" CANVAS "),h("div",{class:v(a(n).e("canvas"))},[E.value&&e.$slots["viewer-error"]?L(e.$slots,"viewer-error",{key:0,activeIndex:g.value,src:a(Y)}):(b(),N("img",{ref_key:"imgRef",ref:F,key:a(Y),src:a(Y),style:Ce(a(ee)),class:v(a(n).e("img")),crossorigin:e.crossorigin,onLoad:s,onError:k,onMousedown:y},null,46,["src","crossorigin"]))],2),L(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var Ia=Se(ka,[["__file","image-viewer.vue"]]);const Ca=Re(Ia),Ea=ze({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:J([String,Object])},previewSrcList:{type:J(Array),default:()=>Le([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:J(String)}}),za={load:i=>i instanceof Event,error:i=>i instanceof Event,switch:i=>we(i),close:()=>!0,show:()=>!0},La=ne({name:"ElImage",inheritAttrs:!1}),Sa=ne({...La,props:Ea,emits:za,setup(i,{expose:V,emit:c}){const d=i,{t}=_e(),p=Ne("image"),K=oa(),j=f(()=>la(Object.entries(K).filter(([s])=>/^(data-|on[A-Z])/i.test(s)||["id","style"].includes(s)))),oe=ra({excludeListeners:!0,excludeKeys:f(()=>Object.keys(j.value))}),n=w(),P=w(!1),C=w(!0),F=w(!1),A=w(),S=w(),$=q&&"loading"in HTMLImageElement.prototype;let E;const g=f(()=>[p.e("inner"),o.value&&p.e("preview"),C.value&&p.is("loading")]),X=f(()=>{const{fit:s}=d;return q&&s?{objectFit:s}:{}}),o=f(()=>{const{previewSrcList:s}=d;return ia(s)&&s.length>0}),le=f(()=>{const{previewSrcList:s,initialIndex:k}=d;let y=k;return k>s.length-1&&(y=0),y}),G=f(()=>d.loading==="eager"?!1:!$&&d.loading==="lazy"||d.lazy),D=()=>{q&&(C.value=!0,P.value=!1,n.value=d.src)};function U(s){C.value=!1,P.value=!1,c("load",s)}function Y(s){C.value=!1,P.value=!0,c("error",s)}function re(s){s&&(D(),ae())}const Q=pa(re,200,!0);async function ee(){var s;if(!q)return;await Te();const{scrollContainer:k}=d;if(ua(k))S.value=k;else if(da(k)&&k!=="")S.value=(s=document.querySelector(k))!=null?s:void 0;else if(A.value){const B=fa(A.value);S.value=va(B)?void 0:B}const{stop:y}=ma(A,([B])=>{Q(B.isIntersecting)},{root:S});E=y}function ae(){!q||!Q||(E?.(),S.value=void 0,E=void 0)}function M(){o.value&&(F.value=!0,c("show"))}function ie(){F.value=!1,c("close")}function ce(s){c("switch",s)}return te(()=>d.src,()=>{G.value?(C.value=!0,P.value=!1,ae(),ee()):D()}),$e(()=>{G.value?ee():D()}),V({showPreview:M}),(s,k)=>(b(),N("div",Ee({ref_key:"container",ref:A},a(j),{class:[a(p).b(),s.$attrs.class]}),[P.value?L(s.$slots,"error",{key:0},()=>[h("div",{class:v(a(p).e("error"))},Oe(a(t)("el.image.error")),3)]):(b(),N(he,{key:1},[n.value!==void 0?(b(),N("img",Ee({key:0},a(oe),{src:n.value,loading:s.loading,style:a(X),class:a(g),crossorigin:s.crossorigin,onClick:M,onLoad:U,onError:Y}),null,16,["src","loading","crossorigin"])):I("v-if",!0),C.value?(b(),N("div",{key:1,class:v(a(p).e("wrapper"))},[L(s.$slots,"placeholder",{},()=>[h("div",{class:v(a(p).e("placeholder"))},null,2)])],2)):I("v-if",!0)],64)),a(o)?(b(),N(he,{key:2},[F.value?(b(),ye(a(Ca),{key:0,"z-index":s.zIndex,"initial-index":a(le),infinite:s.infinite,"zoom-rate":s.zoomRate,"min-scale":s.minScale,"max-scale":s.maxScale,"show-progress":s.showProgress,"url-list":s.previewSrcList,scale:s.scale,crossorigin:s.crossorigin,"hide-on-click-modal":s.hideOnClickModal,teleported:s.previewTeleported,"close-on-press-escape":s.closeOnPressEscape,onClose:ie,onSwitch:ce},ca({toolbar:m(y=>[L(s.$slots,"toolbar",me(pe(y)))]),default:m(()=>[s.$slots.viewer?(b(),N("div",{key:0},[L(s.$slots,"viewer")])):I("v-if",!0)]),_:2},[s.$slots.progress?{name:"progress",fn:m(y=>[L(s.$slots,"progress",me(pe(y)))])}:void 0,s.$slots["viewer-error"]?{name:"viewer-error",fn:m(y=>[L(s.$slots,"viewer-error",me(pe(y)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):I("v-if",!0)],64)):I("v-if",!0)],16))}});var _a=Se(Sa,[["__file","image.vue"]]);const Oa=Re(_a);export{Oa as E};
