var Gt=Object.defineProperty,Xt=Object.defineProperties;var Ut=Object.getOwnPropertyDescriptors;var $t=Object.getOwnPropertySymbols;var qt=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable;var zt=(o,n,t)=>n in o?Gt(o,n,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[n]=t,st=(o,n)=>{for(var t in n||(n={}))qt.call(n,t)&&zt(o,t,n[t]);if($t)for(var t of $t(n))Yt.call(n,t)&&zt(o,t,n[t]);return o},ht=(o,n)=>Xt(o,Ut(n));import{d as nt,aG as Kt,c as Jt,aU as Qt,O as Zt,$ as te,T as ee,ae as ie,b8 as ne,b7 as re,M as oe,a as M,o as P,g as K,e as J,w as Q,F as Z,U as ae,b as rt,a2 as se,i as xt,p as he,j as ue,h as ut,t as It,f as ce}from"./vendor.06d41b47.js";/* empty css                *//* empty css               */import{_ as le}from"./index.3e8bde9e.js";var fe=!1;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var W=function(){return W=Object.assign||function(n){for(var t,e=1,i=arguments.length;e<i;e++){t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},W.apply(this,arguments)};function de(o,n){var t={};for(var e in o)Object.prototype.hasOwnProperty.call(o,e)&&n.indexOf(e)<0&&(t[e]=o[e]);if(o!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,e=Object.getOwnPropertySymbols(o);i<e.length;i++)n.indexOf(e[i])<0&&Object.prototype.propertyIsEnumerable.call(o,e[i])&&(t[e[i]]=o[e[i]]);return t}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var ct=function(o,n){return ct=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])},ct(o,n)};function lt(o,n){if(typeof n!="function"&&n!==null)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function t(){this.constructor=o}ct(o,n),o.prototype=n===null?Object.create(n):(t.prototype=n.prototype,new t)}var R=function(){return R=Object.assign||function(o){for(var n,t=1,e=arguments.length;t<e;t++)for(var i in n=arguments[t])Object.prototype.hasOwnProperty.call(n,i)&&(o[i]=n[i]);return o},R.apply(this,arguments)};function G(o,n,t,e){return new(t||(t=Promise))(function(i,r){function s(h){try{l(e.next(h))}catch(u){r(u)}}function a(h){try{l(e.throw(h))}catch(u){r(u)}}function l(h){var u;h.done?i(h.value):(u=h.value,u instanceof t?u:new t(function(c){c(u)})).then(s,a)}l((e=e.apply(o,n||[])).next())})}function X(o,n){var t,e,i,r,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(r[Symbol.iterator]=function(){return this}),r;function a(l){return function(h){return function(u){if(t)throw new TypeError("Generator is already executing.");for(;s;)try{if(t=1,e&&(i=2&u[0]?e.return:u[0]?e.throw||((i=e.return)&&i.call(e),0):e.next)&&!(i=i.call(e,u[1])).done)return i;switch(e=0,i&&(u=[2&u[0],i.value]),u[0]){case 0:case 1:i=u;break;case 4:return s.label++,{value:u[1],done:!1};case 5:s.label++,e=u[1],u=[0];continue;case 7:u=s.ops.pop(),s.trys.pop();continue;default:if(i=s.trys,!((i=i.length>0&&i[i.length-1])||u[0]!==6&&u[0]!==2)){s=0;continue}if(u[0]===3&&(!i||u[1]>i[0]&&u[1]<i[3])){s.label=u[1];break}if(u[0]===6&&s.label<i[1]){s.label=i[1],i=u;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(u);break}i[2]&&s.ops.pop(),s.trys.pop();continue}u=n.call(o,s)}catch(c){u=[6,c],e=0}finally{t=i=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([l,h])}}}function U(o,n){for(var t=0,e=n.length,i=o.length;t<e;t++,i++)o[i]=n[t];return o}String.prototype.includes||(String.prototype.includes=function(o,n){return typeof n!="number"&&(n=0),!(n+o.length>this.length)&&this.indexOf(o,n)!==-1}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(o){if(this==null)throw new TypeError('"this" is null or not defined');var n=Object(this),t=n.length>>>0;if(typeof o!="function")throw new TypeError("predicate must be a function");for(var e=arguments[1],i=0;i<t;){var r=n[i];if(o.call(e,r,i,n))return r;i++}}});var T=function(o){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];return n.some(function(e){return Object.prototype.toString.call(o).slice(8,-1).toLowerCase()===e})},_t=function(o,n){for(var t=0,e=n.split(".");t<e.length;t++){var i=o[e[t]];if(!T(i,"object","array"))return i;o=i}return o},Ot=function(o,n){return Object.prototype.hasOwnProperty.call(o,n)},Tt=function(o){return[].filter.call(o,function(n){return n!==`
`}).join("")},j=function(o){if(typeof o!="string"||(o=o.toLocaleLowerCase().trim())==="transparent")return!1;if(/^rgba/.test(o)){var n=/([^\s,]+)\)$/.exec(o);if(((t=n)===null?0:typeof t=="object"?NaN:typeof t=="number"?t:typeof t=="string"?t[t.length-1]==="%"?Number(t.slice(0,-1))/100:Number(t):NaN)===0)return!1}var t;return!0},At=function(o){var n,t=((n=o.padding)===null||n===void 0?void 0:n.replace(/px/g,"").split(" ").map(function(h){return~~h}))||[0],e=0,i=0,r=0,s=0;switch(t.length){case 1:e=i=r=s=t[0];break;case 2:e=i=t[0],r=s=t[1];break;case 3:e=t[0],r=s=t[1],i=t[2];break;default:e=t[0],i=t[1],r=t[2],s=t[3]}var a={paddingTop:e,paddingBottom:i,paddingLeft:r,paddingRight:s};for(var l in a)a[l]=Object.prototype.hasOwnProperty.call(o,l)&&T(o[l],"string","number")?~~String(o[l]).replace(/px/g,""):a[l];return[e,i,r,s]},Wt=function(o){var n=[],t=o.map(function(i){return Number(i)}).reduce(function(i,r){if(r>0){var s=i+r;return n.push(s),s}return n.push(NaN),i},0),e=Math.random()*t;return n.findIndex(function(i){return e<=i})},Lt=function(o,n,t,e){e===void 0&&(e=1/0),e<=0&&(e=1/0);for(var i="",r=[],s=o.measureText("...").width,a=0;a<n.length;a++){i+=n[a];var l=o.measureText(i).width,h=t(r);if(e===r.length+1&&(l+=s),h<0)return r;if(l>h&&(r.push(i.slice(0,-1)),i=n[a]),e===r.length)return r[r.length-1]+="...",r}return i&&r.push(i),r.length||r.push(n),r},B=function(o){return Math.PI/180*o},pe=function(o,n,t,e,i,r){o.beginPath();var s,a,l=B(90/Math.PI/t*r),h=e+l,u=i-l;o.arc(0,0,t,h,u,!1),o.lineTo.apply(o,(s=(e+i)/2,a=r/2/Math.abs(Math.sin((e-i)/2)),[+(Math.cos(s)*a).toFixed(8),+(Math.sin(s)*a).toFixed(8)])),o.closePath()},tt=function(o){for(var n=[],t=1;t<arguments.length;t++)n[t-1]=arguments[t];var e=n[0],i=n[1],r=n[2],s=n[3],a=n[4],l=Math.min(r,s),h=Math.PI;a>l/2&&(a=l/2),o.beginPath(),o.moveTo(e+a,i),o.lineTo(e+a,i),o.lineTo(e+r-a,i),o.arc(e+r-a,i+a,a,-h/2,0),o.lineTo(e+r,i+s-a),o.arc(e+r-a,i+s-a,a,0,h/2),o.lineTo(e+a,i+s),o.arc(e+a,i+s-a,a,h/2,h),o.lineTo(e,i+a),o.arc(e+a,i+a,a,h,-h/2),o.closePath()},ge=function(o,n,t,e,i,r){var s=document.createElement("canvas"),a=s.getContext("2d"),l=o.width,h=o.height;s.width=l,s.height=h;var u=l/e;return tt(a,n*u,t*u,e*u,i*u,r*u),a.clip(),a.drawImage(o,0,0,l,h),s},me=function(o,n){var t=document.createElement("canvas"),e=t.getContext("2d"),i=o.width,r=o.height;t.width=i,t.height=r,e.drawImage(o,0,0,i,r);var s=e.getImageData(0,0,i,r),a=s.data,l=function(h,u){u=u||h/3;for(var c=Math.ceil(h),p=u*u,f=2*p,m=1/(2*Math.PI*p),d=[],g=0,y=-c;y<=c;y++)for(var b=-c;b<=c;b++){var w=m*Math.exp(-(y*y+b*b)/f);d.push(w),g+=w}for(var v=0;v<d.length;v++)d[v]/=g;return d}(n);return a.length,l.length,console.log(s),e.putImageData(s,0,0),t},N=function(){function o(){this.subs=[]}return o.prototype.addSub=function(n){this.subs.includes(n)||this.subs.push(n)},o.prototype.notify=function(){this.subs.forEach(function(n){n.update()})},o}(),ve="__proto__"in{};function Et(o,n,t,e){Object.defineProperty(o,n,{value:t,enumerable:!!e,writable:!0,configurable:!0})}var Dt=Array.prototype,ot=Object.create(Dt);["push","pop","shift","unshift","sort","splice","reverse"].forEach(function(o){ot[o]=function(){for(var n=[],t=0;t<arguments.length;t++)n[t]=arguments[t];var e=Dt[o].apply(this,n),i=this.__luckyOb__;return["push","unshift","splice"].includes(o)&&i.walk(this),i.dep.notify(),e}});var ye=function(){function o(n){this.dep=new N,Et(n,"__luckyOb__",this),Array.isArray(n)&&(ve?n.__proto__=ot:Object.getOwnPropertyNames(ot).forEach(function(t){Et(n,t,ot[t])})),this.walk(n)}return o.prototype.walk=function(n){Object.keys(n).forEach(function(t){Rt(n,t,n[t])})},o}();function Pt(o){if(o&&typeof o=="object")return"__luckyOb__"in o?o.__luckyOb__:new ye(o)}function Rt(o,n,t){var e=new N,i=Object.getOwnPropertyDescriptor(o,n);if(!i||i.configurable!==!1){var r=i&&i.get,s=i&&i.set;r&&!s||arguments.length!==2||(t=o[n]);var a=Pt(t);Object.defineProperty(o,n,{get:function(){var l=r?r.call(o):t;return N.target&&(e.addSub(N.target),a&&a.dep.addSub(N.target)),l},set:function(l){l!==t&&(t=l,r&&!s||(s?s.call(o,l):t=l,a=Pt(l),e.notify()))}})}}var we=0,be=function(){function o(n,t,e,i){i===void 0&&(i={}),this.id=we++,this.$lucky=n,this.expr=t,this.deep=!!i.deep,this.getter=typeof t=="function"?t:function(r){r+=".";for(var s=[],a="",l=0;l<r.length;l++){var h=r[l];if(/\[|\./.test(h))s.push(a),a="";else{if(/\W/.test(h))continue;a+=h}}return function(u){return s.reduce(function(c,p){return c[p]},u)}}(t),this.cb=e,this.value=this.get()}return o.prototype.get=function(){N.target=this;var n=this.getter.call(this.$lucky,this.$lucky);return this.deep&&function(t){var e=function(i){T(i,"array","object")&&Object.keys(i).forEach(function(r){var s=i[r];e(s)})};e(t)}(n),N.target=null,n},o.prototype.update=function(){var n=this.get(),t=this.value;this.value=n,this.cb.call(this.$lucky,n,t)},o}(),ft=function(){function o(n,t){var e=this;this.version="1.7.7",this.htmlFontSize=16,this.rAF=function(){},this.boxWidth=0,this.boxHeight=0,typeof n=="string"?n={el:n}:n.nodeType===1&&(n={el:"",divElement:n}),n=n,this.config=n,this.data=t,n.flag||(n.flag="WEB"),n.el&&(n.divElement=document.querySelector(n.el)),n.divElement&&(n.canvasElement=document.createElement("canvas"),n.divElement.appendChild(n.canvasElement)),n.canvasElement&&(n.ctx=n.canvasElement.getContext("2d"),n.canvasElement.setAttribute("package","lucky-canvas@1.7.7"),n.canvasElement.addEventListener("click",function(i){return e.handleClick(i)})),this.ctx=n.ctx,this.initWindowFunction(),this.config.ctx||console.error("\u65E0\u6CD5\u83B7\u53D6\u5230 CanvasContext2D"),window&&window.addEventListener("resize",function(i,r){r===void 0&&(r=300);var s=null;return function(){for(var a=this,l=[],h=0;h<arguments.length;h++)l[h]=arguments[h];s||(s=setTimeout(function(){i.apply(a,l),clearTimeout(s),s=null},r))}}(function(){return e.resize()},300)),window&&window.MutationObserver&&new window.MutationObserver(function(){e.resize()}).observe(document.documentElement,{attributes:!0})}return o.prototype.resize=function(){var n,t;(t=(n=this.config).beforeResize)===null||t===void 0||t.call(n),this.setHTMLFontSize(),this.setDpr(),this.resetWidthAndHeight(),this.zoomCanvas()},o.prototype.initLucky=function(){if(this.resize(),!this.boxWidth||!this.boxHeight)return console.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u5BBD\u5EA6\u6216\u9AD8\u5EA6")},o.prototype.handleClick=function(n){},o.prototype.setHTMLFontSize=function(){window&&(this.htmlFontSize=+window.getComputedStyle(document.documentElement).fontSize.slice(0,-2))},o.prototype.setDpr=function(){var n=this.config;n.dpr||(window?window.dpr=n.dpr=window.devicePixelRatio||1:n.dpr||console.error(n,"\u672A\u4F20\u5165 dpr \u53EF\u80FD\u4F1A\u5BFC\u81F4\u7ED8\u5236\u5F02\u5E38"))},o.prototype.resetWidthAndHeight=function(){var n=this.config,t=this.data,e=0,i=0;n.divElement&&(e=n.divElement.offsetWidth,i=n.divElement.offsetHeight),this.boxWidth=this.getLength(t.width||n.width)||e,this.boxHeight=this.getLength(t.height||n.height)||i,n.divElement&&(n.divElement.style.overflow="hidden",n.divElement.style.width=this.boxWidth+"px",n.divElement.style.height=this.boxHeight+"px")},o.prototype.zoomCanvas=function(){var n=this.config,t=this.ctx,e=n.canvasElement,i=n.dpr,r=[this.boxWidth*i,this.boxHeight*i],s=r[0],a=r[1];e&&(e.width=s,e.height=a,e.style.width=s+"px",e.style.height=a+"px",e.style["transform-origin"]="left top",e.style.transform="scale("+1/i+")",t.scale(i,i))},o.prototype.initWindowFunction=function(){var n=this.config;if(window)return this.rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)},n.setTimeout=window.setTimeout,n.setInterval=window.setInterval,n.clearTimeout=window.clearTimeout,void(n.clearInterval=window.clearInterval);if(n.rAF)this.rAF=n.rAF;else if(n.setTimeout){var t=n.setTimeout;this.rAF=function(e){return t(e,16.7)}}else this.rAF=function(e){return setTimeout(e,16.7)}},o.prototype.loadImg=function(n,t,e){var i=this;return e===void 0&&(e="$resolve"),new Promise(function(r,s){if(n||s("=> '"+t.src+"' \u4E0D\u80FD\u4E3A\u7A7A\u6216\u4E0D\u5408\u6CD5"),i.config.flag!=="WEB")return t[e]=r,void(t.$reject=s);var a=new Image;a.onload=function(){return r(a)},a.onerror=function(){return s("=> '"+t.src+"' \u56FE\u7247\u52A0\u8F7D\u5931\u8D25")},a.src=n})},o.prototype.drawImage=function(n,t){for(var e,i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var s=this.config,a=s.flag,l=s.dpr;if(["WEB","MP-WX"].includes(a))e=t;else{if(!["UNI-H5","UNI-MP","TARO-H5","TARO-MP"].includes(a))return console.error("\u610F\u6599\u4E4B\u5916\u7684 flag, \u8BE5\u5E73\u53F0\u5C1A\u672A\u517C\u5BB9!");e=t.path}return i.length===8&&(i=i.map(function(h,u){return u<4?h*l:h})),n.drawImage.apply(n,U([e],i))},o.prototype.getLength=function(n){return T(n,"number")?n:T(n,"string")?this.changeUnits(n):0},o.prototype.changeUnits=function(n,t){var e=this;return t===void 0&&(t=1),Number(n.replace(/^([-]*[0-9.]*)([a-z%]*)$/,function(i,r,s){var a={"%":function(h){return h*(t/100)},px:function(h){return 1*h},rem:function(h){return h*e.htmlFontSize},vw:function(h){return h/100*window.innerWidth}}[s];if(a)return a(r);var l=e.config.unitFunc;return l?l(r,s):r}))},o.prototype.getOffscreenCanvas=function(n,t){if(!Ot(this,"_offscreenCanvas")){if(!window||!window.document)return console.error("\u65E0\u6CD5\u521B\u5EFA\u79BB\u5C4FCanvas!");this._offscreenCanvas=document.createElement("canvas")}var e=this.config.dpr,i=this._offscreenCanvas;i.width=(n||300)*e,i.height=(t||150)*e;var r=i.getContext("2d");return r.clearRect(0,0,n,t),r.scale(e,e),r.dpr=e,{_offscreenCanvas:i,_ctx:r}},o.prototype.multiplyByDpr=function(){for(var n=this,t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return t.map(function(i){return i*n.config.dpr})},o.prototype.$clip=function(n){for(var t=this,e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=e.map(function(s){return t.getLength(s)});return ge.apply(void 0,U([n],r))},o.prototype.$opacity=function(n,t){return function(e,i){var r=document.createElement("canvas"),s=r.getContext("2d"),a=e.width,l=e.height;if(r.width=a,r.height=l,typeof s.filter=="string")s.filter="opacity("+i+"%)",s.drawImage(e,0,0,a,l);else{s.drawImage(e,0,0,a,l);for(var h=s.getImageData(0,0,a,l),u=h.data,c=u.length,p=0;p<c;p+=4){var f=u[p+3];f!==0&&(u[p+3]=f*i/100)}s.putImageData(h,0,0)}return r}(n,this.getLength(t))},o.prototype.$blur=function(n,t){return me(n,this.getLength(t))},o.prototype.$set=function(n,t,e){n&&typeof n=="object"&&Rt(n,t,e)},o.prototype.$computed=function(n,t,e){var i=this;Object.defineProperty(n,t,{get:function(){return e.call(i)}})},o.prototype.$watch=function(n,t,e){e===void 0&&(e={}),typeof t=="object"&&(t=(e=t).handler);var i=new be(this,n,t,e);return e.immediate&&t.call(this,i.value),function(){}},o}(),dt=function(o,n,t,e){return o>=e&&(o=e),t*(o/=e)*o+n},q=function(o,n,t,e){return o>=e&&(o=e),-t*(o/=e)*(o-2)+n},ke=function(o){function n(t,e){var i,r=o.call(this,t,{width:e.width,height:e.height})||this;return r.blocks=[],r.prizes=[],r.buttons=[],r.defaultConfig={},r.defaultStyle={},r._defaultConfig={},r._defaultStyle={},r.Radius=0,r.prizeRadius=0,r.prizeDeg=0,r.prizeRadian=0,r.rotateDeg=0,r.maxBtnRadius=0,r.startTime=0,r.endTime=0,r.stopDeg=0,r.endDeg=0,r.FPS=16.6,r.step=0,r.ImageCache={blocks:[],prizes:[],buttons:[]},r.initData(e),r.initWatch(),r.initComputed(),(i=t.beforeCreate)===null||i===void 0||i.call(r),r.init(),r}return lt(n,o),n.prototype.resize=function(){var t,e;o.prototype.resize.call(this),this.Radius=Math.min(this.boxWidth,this.boxHeight)/2,this.ctx.translate(this.Radius,this.Radius),this.draw(),(e=(t=this.config).afterResize)===null||e===void 0||e.call(t)},n.prototype.initLucky=function(){this.Radius=0,this.prizeRadius=0,this.prizeDeg=0,this.prizeRadian=0,this.rotateDeg=0,this.maxBtnRadius=0,this.startTime=0,this.endTime=0,this.stopDeg=0,this.endDeg=0,this.FPS=16.6,this.prizeFlag=-1,this.step=0,o.prototype.initLucky.call(this)},n.prototype.initData=function(t){this.$set(this,"width",t.width||"300px"),this.$set(this,"height",t.height||"300px"),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"buttons",t.buttons||[]),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"startCallback",t.start),this.$set(this,"endCallback",t.end)},n.prototype.initComputed=function(){var t=this;this.$computed(this,"_defaultConfig",function(){return R({gutter:"0px",offsetDegree:0,speed:20,speedFunction:"quad",accelerationTime:2500,decelerationTime:2500,stopRange:0},t.defaultConfig)}),this.$computed(this,"_defaultStyle",function(){return R({fontSize:"18px",fontColor:"#000",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",wordWrap:!0,lengthLimit:"90%"},t.defaultStyle)})},n.prototype.initWatch=function(){var t=this;this.$watch("width",function(e){t.data.width=e,t.resize()}),this.$watch("height",function(e){t.data.height=e,t.resize()}),this.$watch("blocks",function(e){t.initImageCache()},{deep:!0}),this.$watch("prizes",function(e){t.initImageCache()},{deep:!0}),this.$watch("buttons",function(e){t.initImageCache()},{deep:!0}),this.$watch("defaultConfig",function(){return t.draw()},{deep:!0}),this.$watch("defaultStyle",function(){return t.draw()},{deep:!0}),this.$watch("startCallback",function(){return t.init()}),this.$watch("endCallback",function(){return t.init()})},n.prototype.init=function(){var t,e;return G(this,void 0,void 0,function(){var i;return X(this,function(r){switch(r.label){case 0:return this.initLucky(),i=this.config,(t=i.beforeInit)===null||t===void 0||t.call(this),this.draw(),this.draw(),[4,this.initImageCache()];case 1:return r.sent(),(e=i.afterInit)===null||e===void 0||e.call(this),[2]}})})},n.prototype.initImageCache=function(){var t=this;return new Promise(function(e){var i={blocks:t.blocks.map(function(r){return r.imgs}),prizes:t.prizes.map(function(r){return r.imgs}),buttons:t.buttons.map(function(r){return r.imgs})};Object.keys(i).forEach(function(r){var s=i[r],a=[];s&&s.forEach(function(l,h){l&&l.forEach(function(u,c){a.push(t.loadAndCacheImg(r,h,r,c))})}),Promise.all(a).then(function(){t.draw(),e()})})})},n.prototype.handleClick=function(t){var e,i=this.ctx;i.beginPath(),i.arc(0,0,this.maxBtnRadius,0,2*Math.PI,!1),i.isPointInPath(t.offsetX,t.offsetY)&&this.step===0&&((e=this.startCallback)===null||e===void 0||e.call(this,t))},n.prototype.loadAndCacheImg=function(t,e,i,r){return G(this,void 0,void 0,function(){var s=this;return X(this,function(a){return[2,new Promise(function(l,h){var u=s[t][e];if(u&&u.imgs){var c=u.imgs[r];if(c){var p=s.ImageCache;p[i][e]||(p[i][e]=[]),s.loadImg(c.src,c).then(function(f){typeof c.formatter=="function"&&(f=c.formatter.call(s,f)),p[i][e][r]=f,l()}).catch(function(f){console.error(t+"["+e+"].imgs["+r+"] "+f),h()})}}})]})})},n.prototype.computedWidthAndHeight=function(t,e,i,r){if(!e.width&&!e.height)return[t.width,t.height];if(e.width&&!e.height){var s=this.getWidth(e.width,i);return[s,t.height*(s/t.width)]}if(!e.width&&e.height){var a=this.getHeight(e.height,r);return[t.width*(a/t.height),a]}return[this.getWidth(e.width,i),this.getHeight(e.height,r)]},n.prototype.draw=function(){var t,e,i=this,r=this,s=r.config,a=r.ctx,l=r._defaultConfig,h=r._defaultStyle;(t=s.beforeDraw)===null||t===void 0||t.call(this,a),a.clearRect(-this.Radius,-this.Radius,2*this.Radius,2*this.Radius),this.prizeRadius=this.blocks.reduce(function(f,m,d){return j(m.background)&&(a.beginPath(),a.fillStyle=m.background,a.arc(0,0,f,0,2*Math.PI,!1),a.fill()),m.imgs&&m.imgs.forEach(function(g,y){var b=i.ImageCache.blocks;if(b&&b[d]){var w=b[d][y];if(w){var v=i.computedWidthAndHeight(w,g,2*f,2*f),S=v[0],C=v[1],k=[i.getOffsetX(S),i.getHeight(g.top,2*f)-f],$=k[0],z=k[1];a.save(),g.rotate&&a.rotate(B(i.rotateDeg)),i.drawImage(a,w,$,z,S,C),a.restore()}}}),f-i.getLength(m.padding&&m.padding.split(" ")[0])},this.Radius),this.prizeDeg=360/this.prizes.length,this.prizeRadian=B(this.prizeDeg);var u=B(this.rotateDeg-90+this.prizeDeg/2+l.offsetDegree),c=function(f){return i.getOffsetX(a.measureText(f).width)},p=function(f,m,d){var g=f.lineHeight||h.lineHeight||f.fontSize||h.fontSize;return i.getHeight(f.top,m)+(d+1)*i.getLength(g)};a.save(),this.prizes.forEach(function(f,m){var d=u+m*i.prizeRadian,g=i.prizeRadius-i.maxBtnRadius,y=f.background||h.background;j(y)&&(a.fillStyle=y,pe(a,i.maxBtnRadius,i.prizeRadius,d-i.prizeRadian/2,d+i.prizeRadian/2,i.getLength(l.gutter)),a.fill());var b=Math.cos(d)*i.prizeRadius,w=Math.sin(d)*i.prizeRadius;a.translate(b,w),a.rotate(d+B(90)),f.imgs&&f.imgs.forEach(function(v,S){var C=i.ImageCache.prizes;if(C&&C[m]){var k=C[m][S];if(k){var $=i.computedWidthAndHeight(k,v,i.prizeRadian*i.prizeRadius,g),z=$[0],_=$[1],O=[i.getOffsetX(z),i.getHeight(v.top,g)],x=O[0],I=O[1];i.drawImage(a,k,x,I,z,_)}}}),f.fonts&&f.fonts.forEach(function(v){var S=v.fontColor||h.fontColor,C=v.fontWeight||h.fontWeight,k=i.getLength(v.fontSize||h.fontSize),$=v.fontStyle||h.fontStyle,z=Object.prototype.hasOwnProperty.call(v,"wordWrap")?v.wordWrap:h.wordWrap,_=v.lengthLimit||h.lengthLimit,O=v.lineClamp||h.lineClamp;a.fillStyle=S,a.font=C+" "+(k>>0)+"px "+$;var x=String(v.text);(z?Lt(a,Tt(x),function(I){var A=2*((i.prizeRadius-p(v,g,I.length))*Math.tan(i.prizeRadian/2))-i.getLength(l.gutter);return i.getWidth(_,A)},O):x.split(`
`)).filter(function(I){return!!I}).forEach(function(I,A){a.fillText(I,c(I),p(v,g,A))})}),a.rotate(B(360)-d-B(90)),a.translate(-b,-w)}),a.restore(),this.buttons.forEach(function(f,m){var d=i.getHeight(f.radius);i.maxBtnRadius=Math.max(i.maxBtnRadius,d),j(f.background)&&(a.beginPath(),a.fillStyle=f.background,a.arc(0,0,d,0,2*Math.PI,!1),a.fill()),f.pointer&&j(f.background)&&(a.beginPath(),a.fillStyle=f.background,a.moveTo(-d,0),a.lineTo(d,0),a.lineTo(0,2*-d),a.closePath(),a.fill()),f.imgs&&f.imgs.forEach(function(g,y){var b=i.ImageCache.buttons;if(b&&b[m]){var w=b[m][y];if(w){var v=i.computedWidthAndHeight(w,g,2*d,2*d),S=v[0],C=v[1],k=[i.getOffsetX(S),i.getHeight(g.top,d)],$=k[0],z=k[1];i.drawImage(a,w,$,z,S,C)}}}),f.fonts&&f.fonts.forEach(function(g){var y=g.fontColor||h.fontColor,b=g.fontWeight||h.fontWeight,w=i.getLength(g.fontSize||h.fontSize),v=g.fontStyle||h.fontStyle;a.fillStyle=y,a.font=b+" "+(w>>0)+"px "+v,String(g.text).split(`
`).forEach(function(S,C){a.fillText(S,c(S),p(g,d,C))})})}),(e=s.afterDraw)===null||e===void 0||e.call(this,a)},n.prototype.carveOnGunwaleOfAMovingBoat=function(){var t=this,e=t._defaultConfig,i=t.prizeFlag,r=t.prizeDeg,s=t.rotateDeg;this.endTime=Date.now();for(var a=this.stopDeg=s,l=e.speed,h=(Math.random()*r-r/2)*this.getLength(e.stopRange),u=0,c=0,p=0;++u;){var f=360*u-i*r-s-e.offsetDegree+h-r/2,m=q(this.FPS,a,f,e.decelerationTime)-a;if(m>l){this.endDeg=l-c>m-l?f:p;break}p=f,c=m}},n.prototype.play=function(){this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,this.run())},n.prototype.stop=function(t){if(this.step!==0&&this.step!==3){if(!t&&t!==0){var e=this.prizes.map(function(i){return i.range});t=Wt(e)}t<0?(this.step=0,this.prizeFlag=-1):(this.step=2,this.prizeFlag=t%this.prizes.length)}},n.prototype.run=function(t){var e;t===void 0&&(t=0);var i=this,r=i.rAF,s=i.step,a=i.prizeFlag,l=i.stopDeg,h=i.endDeg,u=i._defaultConfig,c=u.accelerationTime,p=u.decelerationTime,f=u.speed;if(s!==0){if(a!==-1){s!==3||this.endDeg||this.carveOnGunwaleOfAMovingBoat();var m=Date.now()-this.startTime,d=Date.now()-this.endTime,g=this.rotateDeg;if(s===1||m<c){this.FPS=m/t;var y=dt(m,0,f,c);y===f&&(this.step=2),g+=y%360}else s===2?(g+=f%360,a!==void 0&&a>=0&&(this.step=3,this.stopDeg=0,this.endDeg=0)):s===3?(g=q(d,l,h,p),d>=p&&(this.step=0)):this.stop(-1);this.rotateDeg=g,this.draw(),r(this.run.bind(this,t+1))}}else(e=this.endCallback)===null||e===void 0||e.call(this,this.prizes.find(function(b,w){return w===a})||{})},n.prototype.getWidth=function(t,e){return e===void 0&&(e=this.prizeRadian*this.prizeRadius),T(t,"number")?t:T(t,"string")?this.changeUnits(t,e):0},n.prototype.getHeight=function(t,e){return e===void 0&&(e=this.prizeRadius),T(t,"number")?t:T(t,"string")?this.changeUnits(t,e):0},n.prototype.getOffsetX=function(t){return-t/2},n.prototype.conversionAxis=function(t,e){var i=this.config;return[t/i.dpr-this.Radius,e/i.dpr-this.Radius]},n}(ft),Ce=function(o){function n(t,e){var i,r=o.call(this,t,{width:e.width,height:e.height})||this;return r.rows=3,r.cols=3,r.blocks=[],r.prizes=[],r.buttons=[],r.defaultConfig={},r.defaultStyle={},r.activeStyle={},r._defaultConfig={},r._defaultStyle={},r._activeStyle={},r.cellWidth=0,r.cellHeight=0,r.startTime=0,r.endTime=0,r.currIndex=0,r.stopIndex=0,r.endIndex=0,r.demo=!1,r.timer=0,r.FPS=16.6,r.step=0,r.prizeFlag=-1,r.cells=[],r.ImageCache={blocks:[],prizes:[],buttons:[]},r.initData(e),r.initWatch(),r.initComputed(),(i=t.beforeCreate)===null||i===void 0||i.call(r),r.init(),r}return lt(n,o),n.prototype.resize=function(){var t,e;o.prototype.resize.call(this),this.draw(),(e=(t=this.config).afterResize)===null||e===void 0||e.call(t)},n.prototype.initLucky=function(){this.cellWidth=0,this.cellHeight=0,this.startTime=0,this.endTime=0,this.currIndex=0,this.stopIndex=0,this.endIndex=0,this.demo=!1,this.timer=0,this.FPS=16.6,this.prizeFlag=-1,this.step=0,o.prototype.initLucky.call(this)},n.prototype.initData=function(t){this.$set(this,"width",t.width||"300px"),this.$set(this,"height",t.height||"300px"),this.$set(this,"rows",Number(t.rows)||3),this.$set(this,"cols",Number(t.cols)||3),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"buttons",t.buttons||[]),this.$set(this,"button",t.button),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"activeStyle",t.activeStyle||{}),this.$set(this,"startCallback",t.start),this.$set(this,"endCallback",t.end)},n.prototype.initComputed=function(){var t=this;this.$computed(this,"_defaultConfig",function(){var e=R({gutter:5,speed:20,accelerationTime:2500,decelerationTime:2500},t.defaultConfig);return e.gutter=t.getLength(e.gutter),e.speed=e.speed/40,e}),this.$computed(this,"_defaultStyle",function(){return R({borderRadius:20,fontColor:"#000",fontSize:"18px",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",shadow:"",wordWrap:!0,lengthLimit:"90%"},t.defaultStyle)}),this.$computed(this,"_activeStyle",function(){return R({background:"#ffce98",shadow:""},t.activeStyle)})},n.prototype.initWatch=function(){var t=this;this.$watch("width",function(e){t.data.width=e,t.resize()}),this.$watch("height",function(e){t.data.height=e,t.resize()}),this.$watch("blocks",function(e){t.initImageCache()},{deep:!0}),this.$watch("prizes",function(e){t.initImageCache()},{deep:!0}),this.$watch("buttons",function(e){t.initImageCache()},{deep:!0}),this.$watch("rows",function(){return t.init()}),this.$watch("cols",function(){return t.init()}),this.$watch("defaultConfig",function(){return t.draw()},{deep:!0}),this.$watch("defaultStyle",function(){return t.draw()},{deep:!0}),this.$watch("activeStyle",function(){return t.draw()},{deep:!0}),this.$watch("startCallback",function(){return t.init()}),this.$watch("endCallback",function(){return t.init()})},n.prototype.init=function(){var t,e;return G(this,void 0,void 0,function(){var i;return X(this,function(r){switch(r.label){case 0:return this.initLucky(),i=this.config,(t=i.beforeInit)===null||t===void 0||t.call(this),this.draw(),[4,this.initImageCache()];case 1:return r.sent(),(e=i.afterInit)===null||e===void 0||e.call(this),[2]}})})},n.prototype.initImageCache=function(){var t=this;return new Promise(function(e){var i=t.buttons.map(function(s){return s.imgs});t.button&&i.push(t.button.imgs);var r={blocks:t.blocks.map(function(s){return s.imgs}),prizes:t.prizes.map(function(s){return s.imgs}),buttons:i};Object.keys(r).forEach(function(s){var a=r[s],l=[];a&&a.forEach(function(h,u){h&&h.forEach(function(c,p){l.push(t.loadAndCacheImg(s,u,s,p))})}),Promise.all(l).then(function(){t.draw(),e()})})})},n.prototype.handleClick=function(t){var e=this,i=this.ctx;U(U([],this.buttons),[this.button]).forEach(function(r){var s;if(r){var a=e.getGeometricProperty([r.x,r.y,r.col||1,r.row||1]),l=a[0],h=a[1],u=a[2],c=a[3];i.beginPath(),i.rect(l,h,u,c),i.isPointInPath(t.offsetX,t.offsetY)&&e.step===0&&(typeof r.callback=="function"&&r.callback.call(e,r),(s=e.startCallback)===null||s===void 0||s.call(e,t,r))}})},n.prototype.loadAndCacheImg=function(t,e,i,r){return G(this,void 0,void 0,function(){var s=this;return X(this,function(a){return[2,new Promise(function(l,h){var u=s[t][e];if(t==="buttons"&&!s.buttons.length&&s.button&&(u=s.button),u&&u.imgs){var c=u.imgs[r];if(c){var p=s.ImageCache;p[i][e]||(p[i][e]=[]);var f=[s.loadImg(c.src,c),c.activeSrc&&s.loadImg(c.activeSrc,c,"$activeResolve")];Promise.all(f).then(function(m){var d=m[0],g=m[1],y=c.formatter;typeof y=="function"&&(d=y.call(s,d),g&&(g=y.call(s,g))),p[i][e][r]={defaultImg:d,activeImg:g},l()}).catch(function(m){console.error(t+"["+e+"].imgs["+r+"] "+m),h()})}}})]})})},n.prototype.computedWidthAndHeight=function(t,e,i){if(!e.width&&!e.height)return[t.width,t.height];if(e.width&&!e.height){var r=this.getWidth(e.width,i.col);return[r,t.height*(r/t.width)]}if(!e.width&&e.height){var s=this.getHeight(e.height,i.row);return[t.width*(s/t.height),s]}return[this.getWidth(e.width,i.col),this.getHeight(e.height,i.row)]},n.prototype.draw=function(){var t,e,i=this,r=this,s=r.config,a=r.ctx,l=r._defaultConfig,h=r._defaultStyle,u=r._activeStyle;(t=s.beforeDraw)===null||t===void 0||t.call(this,a),a.clearRect(0,0,this.boxWidth,this.boxHeight),this.cells=U(U([],this.prizes),this.buttons),this.button&&this.cells.push(this.button),this.cells.forEach(function(c){c.col=c.col||1,c.row=c.row||1}),this.prizeArea=this.blocks.reduce(function(c,p){var f=c.x,m=c.y,d=c.w,g=c.h,y=At(p),b=y[0],w=y[1],v=y[2],S=y[3],C=p.borderRadius?i.getLength(p.borderRadius):0,k=p.background||h.background;return j(k)&&(a.fillStyle=i.handleBackground(f,m,d,g,k),tt(a,f,m,d,g,C),a.fill()),{x:f+v,y:m+b,w:d-v-S,h:g-b-w}},{x:0,y:0,w:this.boxWidth,h:this.boxHeight}),this.cellWidth=(this.prizeArea.w-l.gutter*(this.cols-1))/this.cols,this.cellHeight=(this.prizeArea.h-l.gutter*(this.rows-1))/this.rows,this.cells.forEach(function(c,p){var f=i.getGeometricProperty([c.x,c.y,c.col,c.row]),m=f[0],d=f[1],g=f[2],y=f[3],b=!1;(i.prizeFlag===void 0||i.prizeFlag>-1)&&(b=p===i.currIndex%i.prizes.length>>0);var w=b?u.background:c.background||h.background;if(j(w)){var v=(b?u.shadow:c.shadow||h.shadow).replace(/px/g,"").split(",")[0].split(" ").map(function(k,$){return $<3?Number(k):k});v.length===4&&(a.shadowColor=v[3],a.shadowOffsetX=v[0]*s.dpr,a.shadowOffsetY=v[1]*s.dpr,a.shadowBlur=v[2],v[0]>0?g-=v[0]:(g+=v[0],m-=v[0]),v[1]>0?y-=v[1]:(y+=v[1],d-=v[1])),a.fillStyle=i.handleBackground(m,d,g,y,w);var S=i.getLength(c.borderRadius?c.borderRadius:h.borderRadius);tt(a,m,d,g,y,S),a.fill(),a.shadowColor="rgba(0, 0, 0, 0)",a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0}var C="prizes";p>=i.prizes.length&&(C="buttons",p-=i.prizes.length),c.imgs&&c.imgs.forEach(function(k,$){var z=i.ImageCache[C];if(z[p]){var _=z[p][$];if(_){var O=b&&_.activeImg||_.defaultImg;if(O){var x=i.computedWidthAndHeight(O,k,c),I=x[0],A=x[1],E=[m+i.getOffsetX(I,c.col),d+i.getHeight(k.top,c.row)],F=E[0],Y=E[1];i.drawImage(a,O,F,Y,I,A)}}}}),c.fonts&&c.fonts.forEach(function(k){var $=b&&u.fontStyle?u.fontStyle:k.fontStyle||h.fontStyle,z=b&&u.fontWeight?u.fontWeight:k.fontWeight||h.fontWeight,_=b&&u.fontSize?i.getLength(u.fontSize):i.getLength(k.fontSize||h.fontSize),O=b&&u.lineHeight?u.lineHeight:k.lineHeight||h.lineHeight||k.fontSize||h.fontSize,x=Object.prototype.hasOwnProperty.call(k,"wordWrap")?k.wordWrap:h.wordWrap,I=k.lengthLimit||h.lengthLimit,A=k.lineClamp||h.lineClamp;a.font=z+" "+(_>>0)+"px "+$,a.fillStyle=b&&u.fontColor?u.fontColor:k.fontColor||h.fontColor;var E=[],F=String(k.text);if(x){var Y=i.getWidth(I,c.col);E=Lt(a,Tt(F),function(){return Y},A)}else E=F.split(`
`);E.forEach(function(L,H){a.fillText(L,m+i.getOffsetX(a.measureText(L).width,c.col),d+i.getHeight(k.top,c.row)+(H+1)*i.getLength(O))})})}),(e=s.afterDraw)===null||e===void 0||e.call(this,a)},n.prototype.handleBackground=function(t,e,i,r,s){var a=this.ctx;return s.includes("linear-gradient")&&(s=function(l,h,u,c,p,f){var m=/linear-gradient\((.+)\)/.exec(f)[1].split(",").map(function(w){return w.trim()}),d=m.shift(),g=[0,0,0,0];if(d.includes("deg")){var y=function(w){return Math.tan(w/180*Math.PI)};(d=d.slice(0,-3)%360)>=0&&d<45?g=[h,u+p,h+c,u+p-c*y(d-0)]:d>=45&&d<90?g=[h,u+p,h+c-p*y(d-45),u]:d>=90&&d<135?g=[h+c,u+p,h+c-p*y(d-90),u]:d>=135&&d<180?g=[h+c,u+p,h,u+c*y(d-135)]:d>=180&&d<225?g=[h+c,u,h,u+c*y(d-180)]:d>=225&&d<270?g=[h+c,u,h+p*y(d-225),u+p]:d>=270&&d<315?g=[h,u,h+p*y(d-270),u+p]:d>=315&&d<360&&(g=[h,u,h+c,u+p-c*y(d-315)])}else d.includes("top")?g=[h,u+p,h,u]:d.includes("bottom")?g=[h,u,h,u+p]:d.includes("left")?g=[h+c,u,h,u]:d.includes("right")&&(g=[h,u,h+c,u]);var b=l.createLinearGradient.apply(l,g.map(function(w){return w>>0}));return m.reduce(function(w,v,S){var C=v.split(" ");return C.length===1?w.addColorStop(S,C[0]):C.length===2&&w.addColorStop.apply(w,C),w},b)}(a,t,e,i,r,s)),s},n.prototype.carveOnGunwaleOfAMovingBoat=function(){var t=this,e=t._defaultConfig,i=t.prizeFlag,r=t.currIndex;this.endTime=Date.now();for(var s=this.stopIndex=r,a=e.speed,l=0,h=0,u=0;++l;){var c=this.prizes.length*l+i-s,p=q(this.FPS,s,c,e.decelerationTime)-s;if(p>a){this.endIndex=a-h>p-a?c:u;break}u=c,h=p}},n.prototype.play=function(){this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,this.run())},n.prototype.stop=function(t){if(this.step!==0&&this.step!==3){if(!t&&t!==0){var e=this.prizes.map(function(i){return i.range});t=Wt(e)}t<0?(this.step=0,this.prizeFlag=-1):(this.step=2,this.prizeFlag=t%this.prizes.length)}},n.prototype.run=function(t){var e;t===void 0&&(t=0);var i=this,r=i.rAF,s=i.step,a=i.prizes,l=i.prizeFlag,h=i.stopIndex,u=i.endIndex,c=i._defaultConfig,p=c.accelerationTime,f=c.decelerationTime,m=c.speed;if(s!==0){if(l!==-1){s!==3||this.endIndex||this.carveOnGunwaleOfAMovingBoat();var d=Date.now()-this.startTime,g=Date.now()-this.endTime,y=this.currIndex;if(s===1||d<p){this.FPS=d/t;var b=dt(d,.1,m-.1,p);b===m&&(this.step=2),y+=b%a.length}else s===2?(y+=m%a.length,l!==void 0&&l>=0&&(this.step=3,this.stopIndex=0,this.endIndex=0)):s===3?(y=q(g,h,u,f),g>=f&&(this.step=0)):this.stop(-1);this.currIndex=y,this.draw(),r(this.run.bind(this,t+1))}}else(e=this.endCallback)===null||e===void 0||e.call(this,this.prizes.find(function(w,v){return v===l})||{})},n.prototype.getGeometricProperty=function(t){var e=t[0],i=t[1],r=t[2],s=r===void 0?1:r,a=t[3],l=a===void 0?1:a,h=this.cellWidth,u=this.cellHeight,c=this._defaultConfig.gutter,p=[this.prizeArea.x+(h+c)*e,this.prizeArea.y+(u+c)*i];return s&&l&&p.push(h*s+c*(s-1),u*l+c*(l-1)),p},n.prototype.getWidth=function(t,e){return e===void 0&&(e=1),T(t,"number")?t:T(t,"string")?this.changeUnits(t,this.cellWidth*e+this._defaultConfig.gutter*(e-1)):0},n.prototype.getHeight=function(t,e){return e===void 0&&(e=1),T(t,"number")?t:T(t,"string")?this.changeUnits(t,this.cellHeight*e+this._defaultConfig.gutter*(e-1)):0},n.prototype.getOffsetX=function(t,e){return e===void 0&&(e=1),(this.cellWidth*e+this._defaultConfig.gutter*(e-1)-t)/2},n.prototype.conversionAxis=function(t,e){var i=this.config;return[t/i.dpr,e/i.dpr]},n}(ft),Se=function(o){function n(t,e){var i,r=o.call(this,t,{width:e.width,height:e.height})||this;return r.blocks=[],r.prizes=[],r.slots=[],r.defaultConfig={},r._defaultConfig={},r.defaultStyle={},r._defaultStyle={},r.endCallback=function(){},r.cellWidth=0,r.cellHeight=0,r.cellAndSpacing=0,r.widthAndSpacing=0,r.heightAndSpacing=0,r.FPS=16.6,r.scroll=[],r.stopScroll=[],r.endScroll=[],r.startTime=0,r.endTime=0,r.step=0,r.prizeFlag=-1,r.ImageCache={blocks:[],prizes:[]},r.initData(e),r.initWatch(),r.initComputed(),(i=t.beforeCreate)===null||i===void 0||i.call(r),r.init(),r}return lt(n,o),n.prototype.resize=function(){var t,e;o.prototype.resize.call(this),this.draw(),(e=(t=this.config).afterResize)===null||e===void 0||e.call(t)},n.prototype.initLucky=function(){this.FPS=16.6,this.prizeFlag=-1,this.step=0,o.prototype.initLucky.call(this)},n.prototype.initData=function(t){this.$set(this,"width",t.width||"300px"),this.$set(this,"height",t.height||"300px"),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"slots",t.slots||[]),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"endCallback",t.end)},n.prototype.initComputed=function(){var t=this;this.$computed(this,"_defaultConfig",function(){var e=R({mode:"vertical",rowSpacing:0,colSpacing:5,speed:20,direction:1,accelerationTime:2500,decelerationTime:2500},t.defaultConfig);return e.rowSpacing=t.getLength(e.rowSpacing),e.colSpacing=t.getLength(e.colSpacing),e}),this.$computed(this,"_defaultStyle",function(){return R({borderRadius:0,fontColor:"#000",fontSize:"18px",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",shadow:"",wordWrap:!0,lengthLimit:"90%"},t.defaultStyle)})},n.prototype.initWatch=function(){var t=this;this.$watch("width",function(e){t.data.width=e,t.resize()}),this.$watch("height",function(e){t.data.height=e,t.resize()}),this.$watch("blocks",function(e){t.initImageCache()},{deep:!0}),this.$watch("prizes",function(e){t.initImageCache()},{deep:!0}),this.$watch("slots",function(e){t.drawOffscreenCanvas(),t.draw()},{deep:!0}),this.$watch("defaultConfig",function(){return t.draw()},{deep:!0}),this.$watch("defaultStyle",function(){return t.draw()},{deep:!0}),this.$watch("endCallback",function(){return t.init()})},n.prototype.init=function(){var t,e;return G(this,void 0,void 0,function(){var i;return X(this,function(r){switch(r.label){case 0:return this.initLucky(),i=this.config,(t=i.beforeInit)===null||t===void 0||t.call(this),this.drawOffscreenCanvas(),this.draw(),[4,this.initImageCache()];case 1:return r.sent(),(e=i.afterInit)===null||e===void 0||e.call(this),[2]}})})},n.prototype.initImageCache=function(){var t=this;return new Promise(function(e){var i={blocks:t.blocks.map(function(r){return r.imgs}),prizes:t.prizes.map(function(r){return r.imgs})};Object.keys(i).forEach(function(r){var s=i[r],a=[];s&&s.forEach(function(l,h){l&&l.forEach(function(u,c){a.push(t.loadAndCacheImg(r,h,r,c))})}),Promise.all(a).then(function(){t.drawOffscreenCanvas(),t.draw(),e()})})})},n.prototype.loadAndCacheImg=function(t,e,i,r){return G(this,void 0,void 0,function(){var s=this;return X(this,function(a){return[2,new Promise(function(l,h){var u=s[t][e];if(u&&u.imgs){var c=u.imgs[r];if(c){var p=s.ImageCache;p[i][e]||(p[i][e]=[]),s.loadImg(c.src,c).then(function(f){typeof c.formatter=="function"&&(f=c.formatter.call(s,f)),p[i][e][r]=f,l()}).catch(function(f){console.error(t+"["+e+"].imgs["+r+"] "+f),h()})}}})]})})},n.prototype.computedWidthAndHeight=function(t,e,i,r){if(!e.width&&!e.height)return[t.width,t.height];if(e.width&&!e.height){var s=this.getWidth(e.width,i);return[s,t.height*(s/t.width)]}if(!e.width&&e.height){var a=this.getHeight(e.height,r);return[t.width*(a/t.height),a]}return[this.getWidth(e.width,i),this.getHeight(e.height,r)]},n.prototype.drawOffscreenCanvas=function(){var t=this;this._defaultConfig;var e=this._defaultStyle,i=this.drawBlocks();i.x,i.y;var r=i.w,s=i.h,a=this.prizes.length,l=this.displacementWidthOrHeight(),h=l.cellWidth,u=l.cellHeight,c=l.widthAndSpacing,p=l.heightAndSpacing,f=new Array(a).fill(void 0).map(function(w,v){return v}),m=0,d=0;this.slots.forEach(function(w,v){t.scroll[v]===void 0&&(t.scroll[v]=0),w.order=w.order||f;var S=w.order.length;m=Math.max(m,r+c*S),d=Math.max(d,s+p*S)});var g=this.getOffscreenCanvas(m,d),y=g._offscreenCanvas,b=g._ctx;this._offscreenCanvas=y,this.slots.forEach(function(w,v){var S=h*v,C=u*v,k=0,$=function(L,H){for(var et={},it=[],D=0;D<L.length;D++)et[D]=L[D];for(D=0;D<H.length;D++){var V=et[H[D]];V&&(it[D]=V)}return it}(t.prizes,w.order);if($.length){$.forEach(function(L,H){if(L){var et=w.order[H],it=c*H,D=p*H,V=t.displacement([S,D,p],[it,C,c]),vt=V[0],yt=V[1],Ht=V[2];k+=Ht;var wt=L.background||e.background;if(j(wt)){var jt=t.getLength(Ot(L,"borderRadius")?L.borderRadius:e.borderRadius);tt(b,vt,yt,h,h,jt),b.fillStyle=wt,b.fill()}L.imgs&&L.imgs.forEach(function(bt,Mt){var at=_t(t.ImageCache,"prizes."+et+"."+Mt);if(at){var kt=t.computedWidthAndHeight(at,bt,h,u),Ct=kt[0],Bt=kt[1],St=[vt+t.getOffsetX(Ct,h),yt+t.getHeight(bt.top,u)],Nt=St[0],Vt=St[1];t.drawImage(b,at,Nt,Vt,Ct,Bt)}})}});for(var z=t.displacement([S,0,h,k],[0,C,k,u]),_=z[0],O=z[1],x=z[2],I=z[3],A=k;A<d+k;){var E=t.displacement([_,A],[A,O]),F=E[0],Y=E[1];t.drawImage(b,y,_,O,x,I,F,Y,x,I),A+=k}}})},n.prototype.drawBlocks=function(){var t=this,e=this;e.config;var i=e.ctx;e._defaultConfig;var r=e._defaultStyle;return this.prizeArea=this.blocks.reduce(function(s,a,l){var h=s.x,u=s.y,c=s.w,p=s.h,f=At(a),m=f[0],d=f[1],g=f[2],y=f[3],b=a.borderRadius?t.getLength(a.borderRadius):0,w=a.background||r.background;return j(w)&&(tt(i,h,u,c,p,b),i.fillStyle=w,i.fill()),a.imgs&&a.imgs.forEach(function(v,S){var C=_t(t.ImageCache,"blocks."+l+"."+S);if(C){var k=t.computedWidthAndHeight(C,v,c,p),$=k[0],z=k[1],_=[t.getOffsetX($,c),t.getHeight(v.top,p)],O=_[0],x=_[1];t.drawImage(i,C,h+O,u+x,$,z)}}),{x:h+g,y:u+m,w:c-g-y,h:p-m-d}},{x:0,y:0,w:this.boxWidth,h:this.boxHeight})},n.prototype.draw=function(){var t,e=this,i=this,r=i.config,s=i.ctx;i._defaultConfig,i._defaultStyle,(t=r.beforeDraw)===null||t===void 0||t.call(this,s),s.clearRect(0,0,this.boxWidth,this.boxHeight);var a=this.drawBlocks(),l=a.x,h=a.y,u=a.w,c=a.h;if(this._offscreenCanvas){var p=this,f=p.cellWidth,m=p.cellHeight,d=p.cellAndSpacing,g=p.widthAndSpacing,y=p.heightAndSpacing;this.slots.forEach(function(b,w){var v=d*b.order.length,S=e.displacement(-(c-m)/2,-(u-f)/2),C=e.scroll[w]+S;C<0&&(C=C%v+v),C>v&&(C%=v);var k=e.displacement([f*w,C,f,c],[C,m*w,u,m]),$=k[0],z=k[1],_=k[2],O=k[3],x=e.displacement([l+g*w,h,f,c],[l,h+y*w,u,m]),I=x[0],A=x[1],E=x[2],F=x[3];e.drawImage(s,e._offscreenCanvas,$,z,_,O,I,A,E,F)})}},n.prototype.carveOnGunwaleOfAMovingBoat=function(){var t=this,e=this,i=e._defaultConfig,r=e.prizeFlag,s=e.cellAndSpacing;this.endTime=Date.now(),this.slots.forEach(function(a,l){var h=a.order;if(h.length)for(var u=a.speed||i.speed,c=a.direction||i.direction,p=h.findIndex(function(b){return b===r}),f=s*h.length,m=t.stopScroll[l]=t.scroll[l],d=0;++d;){var g=s*p+f*d*c-m,y=q(t.FPS,m,g,i.decelerationTime)-m;if(Math.abs(y)>u){t.endScroll[l]=g;break}}})},n.prototype.play=function(){this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,this.run())},n.prototype.stop=function(t){this.step!==0&&this.step!==3&&(this.prizeFlag=t,this.step=t<0?0:2)},n.prototype.run=function(t){var e,i=this;t===void 0&&(t=0);var r=this,s=r.rAF,a=r.step,l=r.prizeFlag,h=r._defaultConfig,u=r.cellAndSpacing,c=h.accelerationTime,p=h.decelerationTime;if(this.step!==0){if(l!==-1){this.step!==3||this.endScroll.length||this.carveOnGunwaleOfAMovingBoat();var f=Date.now()-this.startTime,m=Date.now()-this.endTime;this.slots.forEach(function(d,g){var y=d.order;if(y&&y.length){var b=u*y.length,w=Math.abs(d.speed||h.speed),v=d.direction||h.direction,S=0,C=i.scroll[g];if(a===1||f<c){i.FPS=f/t;var k=dt(f,0,w,c);k===w&&(i.step=2),S=(C+k*v)%b}else if(a===2)S=(C+w*v)%b,l!==void 0&&l>=0&&(i.step=3,i.stopScroll=[],i.endScroll=[]);else if(a===3&&m){var $=i.stopScroll[g],z=i.endScroll[g];S=q(m,$,z,p),m>=p&&(i.step=0)}i.scroll[g]=S}}),this.draw(),s(this.run.bind(this,t+1))}}else(e=this.endCallback)===null||e===void 0||e.call(this,this.prizes.find(function(d,g){return g===l})||{})},n.prototype.displacement=function(t,e){return this._defaultConfig.mode==="horizontal"?e:t},n.prototype.displacementWidthOrHeight=function(){var t=this._defaultConfig.mode,e=this.slots.length,i=this._defaultConfig,r=i.colSpacing,s=i.rowSpacing,a=this.prizeArea||this.drawBlocks();a.x,a.y;var l,h,u=a.w,c=a.h,p=0,f=0;return t==="horizontal"?(f=this.cellHeight=(c-s*(e-1))/e,p=this.cellWidth=f):(p=this.cellWidth=(u-r*(e-1))/e,f=this.cellHeight=p),l=this.widthAndSpacing=this.cellWidth+r,h=this.heightAndSpacing=this.cellHeight+s,this.cellAndSpacing=t==="horizontal"?l:h,{cellWidth:p,cellHeight:f,widthAndSpacing:l,heightAndSpacing:h}},n.prototype.getWidth=function(t,e){return T(t,"number")?t:T(t,"string")?this.changeUnits(t,e):0},n.prototype.getHeight=function(t,e){return T(t,"number")?t:T(t,"string")?this.changeUnits(t,e):0},n.prototype.getOffsetX=function(t,e){return(e-t)/2},n}(ft),$e=function(o){return o?Object.entries(o).reduce(function(n,t){var e,i=t[0],r=t[1];return i=i.charAt(0).toUpperCase()+i.slice(1),i="on"+i,W(W({},n),(e={},e[i]=r,e))},{}):null},pt=function(o,n,t){n===void 0&&(n={});var e=n.props,i=n.domProps,r=n.on,s=de(n,["props","domProps","on"]),a=$e(r),l=W(W(W(W({},s),e),i),a);return Kt(o,l,t)},gt="@lucky-canvas/vue",mt="0.1.4",Ft=nt({name:"LuckyWheel",props:{width:{type:[String,Number],default:"300px",require:!0},height:{type:[String,Number],default:"300px",require:!0},blocks:{type:Array,default:function(){return[]}},prizes:{type:Array,default:function(){return[]}},buttons:{type:Array,default:function(){return[]}},defaultStyle:{type:Object,default:function(){return{}}},defaultConfig:{type:Object,default:function(){return{}}}},emits:["start","end","success","error","finally"],watch:{blocks:function(o,n){this.$lucky&&(this.$lucky.blocks=o)},prizes:function(o,n){this.$lucky&&(this.$lucky.prizes=o)},buttons:function(o,n){this.$lucky&&(this.$lucky.buttons=o)}},data:function(){return{$lucky:null}},mounted:function(){if(this.$refs.myLucky){var o=this.$refs.myLucky;o.setAttribute("package",gt+"@"+mt)}try{this.initLucky(),this.$emit("success")}catch(n){this.$emit("error",n)}finally{this.$emit("finally")}},methods:{initLucky:function(){var o=this;this.$lucky=new ke({flag:"WEB",width:String(this.width),height:String(this.height),divElement:this.$refs.myLucky,rAF:window.requestAnimationFrame,setTimeout:window.setTimeout,setInterval:window.setInterval,clearTimeout:window.clearTimeout,clearInterval:window.clearInterval},W(W({},this.$props),{start:function(n){o.$emit("start",n)},end:function(n){o.$emit("end",n)}}))},init:function(){this.$lucky&&this.$lucky.init()},play:function(){var o;(o=this.$lucky)===null||o===void 0||o.play()},stop:function(o){var n;(n=this.$lucky)===null||n===void 0||n.stop(o)}},render:function(){return pt("div",{ref:"myLucky"})}}),ze=nt({name:"LuckyGrid",props:{width:{type:[String,Number],default:"300px",require:!0},height:{type:[String,Number],default:"300px",require:!0},cols:{type:[String,Number],default:3},rows:{type:[String,Number],default:3},blocks:{type:Array,default:function(){return[]}},prizes:{type:Array,default:function(){return[]}},buttons:{type:Array,default:function(){return[]}},button:{type:Object},defaultStyle:{type:Object,default:function(){return{}}},activeStyle:{type:Object,default:function(){return{}}},defaultConfig:{type:Object,default:function(){return{}}}},emits:["start","end","success","error","finally"],watch:{cols:function(o,n){this.$lucky&&(this.$lucky.cols=o)},rows:function(o,n){this.$lucky&&(this.$lucky.rows=o)},blocks:function(o,n){this.$lucky&&(this.$lucky.blocks=o)},prizes:function(o,n){this.$lucky&&(this.$lucky.prizes=o)},buttons:function(o,n){this.$lucky&&(this.$lucky.buttons=o)},button:function(o,n){this.$lucky&&(this.$lucky.button=o)}},data:function(){return{$lucky:null}},mounted:function(){if(this.$refs.myLucky){var o=this.$refs.myLucky;o.setAttribute("package",gt+"@"+mt)}try{this.initLucky(),this.$emit("success")}catch(n){this.$emit("error",n)}finally{this.$emit("finally")}},methods:{initLucky:function(){var o=this;this.$lucky=new Ce({flag:"WEB",width:String(this.width),height:String(this.height),divElement:this.$refs.myLucky,rAF:window.requestAnimationFrame,setTimeout:window.setTimeout,setInterval:window.setInterval,clearTimeout:window.clearTimeout,clearInterval:window.clearInterval},W(W({},this.$props),{start:function(n,t){o.$emit("start",n,t)},end:function(n){o.$emit("end",n)}}))},init:function(){this.$lucky&&this.$lucky.init()},play:function(){var o;(o=this.$lucky)===null||o===void 0||o.play()},stop:function(o){var n;(n=this.$lucky)===null||n===void 0||n.stop(o)}},render:function(){return pt("div",{ref:"myLucky"})}}),xe=nt({name:"SlotMachine",props:{width:{type:[String,Number],default:"300px",require:!0},height:{type:[String,Number],default:"300px",require:!0},blocks:{type:Array,default:function(){return[]}},prizes:{type:Array,default:function(){return[]}},slots:{type:Array,default:function(){return[]}},defaultStyle:{type:Object,default:function(){return{}}},defaultConfig:{type:Object,default:function(){return{}}}},watch:{blocks:function(o,n){this.$lucky&&(this.$lucky.blocks=o)},slots:function(o,n){this.$lucky&&(this.$lucky.slots=o)},prizes:function(o,n){this.$lucky&&(this.$lucky.prizes=o)}},data:function(){return{$lucky:null}},mounted:function(){if(this.$refs.myLucky){var o=this.$refs.myLucky;o.setAttribute("package",gt+"@"+mt)}try{this.initLucky(),this.$emit("success")}catch(n){this.$emit("error",n)}finally{this.$emit("finally")}},methods:{initLucky:function(){var o=this;this.$lucky=new Se({flag:"WEB",width:String(this.width),height:String(this.height),divElement:this.$refs.myLucky,rAF:window.requestAnimationFrame,setTimeout:window.setTimeout,setInterval:window.setInterval,clearTimeout:window.clearTimeout,clearInterval:window.clearInterval},W(W({},this.$props),{start:function(n){o.$emit("start",n)},end:function(n){o.$emit("end",n)}}))},init:function(){this.$lucky&&this.$lucky.init()},play:function(){var o;(o=this.$lucky)===null||o===void 0||o.play()},stop:function(o){var n;(n=this.$lucky)===null||n===void 0||n.stop(o)}},render:function(){return pt("div",{ref:"myLucky"})}}),Ie=function(o){o.component("LuckyWheel",Ft),o.component("LuckyGrid",ze),o.component("SlotMachine",xe)};typeof window!="undefined"&&window.Vue&&fe&&Ie(window.Vue);const{mapGetters:_e,mapActions:Oe}=Jt("cache"),Te=nt({name:"randomList",components:{Tag:Qt,Tooltip:Zt,Input:te,Typography:ee,Divider:ie,Plus:ne,LuckyWheel:Ft},data:()=>({tags:[],inputValue:"",inputVisible:!1,loading:!1,blocks:[{padding:"10px",background:"#869cfa"}],buttons:[{radius:"40%",background:"#617df2"},{radius:"35%",background:"#afc8ff"},{radius:"30%",background:"#869cfa",pointer:!0,fonts:[{text:"\u5F00\u59CB",top:"-10px"}]}]}),computed:ht(st({},_e(["getData"])),{prizes:function(){const o=["#e9e8fe","#b8c5f2"];return this.tags.map((n,t)=>({background:o[t%2],fonts:[{text:n}]}))}}),mounted(){this.tags=(this.getData("randomList")||{}).tags||[]},watch:{},beforeUnmount(){},methods:ht(st({},Oe(["setData"])),{startCallBack(){this.loading=!0,this.$refs.myLucky.play(),setTimeout(()=>{this.$refs.myLucky.stop(re(this.tags.length))},3e3)},endCallBack(o){oe.success({title:()=>`\u62BD\u4E2D\u4E86 \u300E${o.fonts[0].text}\u300F`,onOk:()=>{this.$refs.myLucky.init(),this.loading=!1}})},updateCache(){this.setData({key:"randomList",val:{tags:this.tags}})},handleClose(o){this.tags=this.tags.filter(n=>n!==o),this.updateCache()},showInput(){this.inputVisible=!0,this.$nextTick(()=>{this.$refs.inputRef.focus()})},handleInputConfirm(){const o=this.inputValue;o&&this.tags.indexOf(o)===-1&&(this.tags=[...this.tags,o]),this.inputVisible=!1,this.inputValue="",this.updateCache()}})}),Ae=o=>(he("data-v-5c0bbae1"),o=o(),ue(),o),We=Ae(()=>ce("h4",null,"\u968F\u673A\u5217\u8868",-1)),Le=ut(" \u65B0\u5185\u5BB9 ");function Ee(o,n,t,e,i,r){const s=M("Typography"),a=M("Tag"),l=M("Tooltip"),h=M("Input"),u=M("Plus"),c=M("Divider"),p=M("LuckyWheel");return P(),K(Z,null,[J(s,null,{default:Q(()=>[We]),_:1}),(P(!0),K(Z,null,ae(o.tags,(f,m)=>(P(),K(Z,{key:m},[f.length>20?(P(),rt(l,{key:0,title:f},{default:Q(()=>[J(a,{closable:!o.loading,onClose:d=>o.handleClose(f)},{default:Q(()=>[ut(It(`${f.slice(0,20)}...`),1)]),_:2},1032,["closable","onClose"])]),_:2},1032,["title"])):(P(),rt(a,{key:1,closable:!o.loading,onClose:d=>o.handleClose(f)},{default:Q(()=>[ut(It(f),1)]),_:2},1032,["closable","onClose"]))],64))),128)),o.loading?xt("",!0):(P(),K(Z,{key:0},[o.inputVisible?(P(),rt(h,{key:0,ref:"inputRef",type:"text",size:"small",style:{width:"78px"},value:o.inputValue,"onUpdate:value":n[0]||(n[0]=f=>o.inputValue=f),onBlur:o.handleInputConfirm,onKeyup:se(o.handleInputConfirm,["enter"])},null,8,["value","onBlur","onKeyup"])):(P(),rt(a,{key:1,onClick:o.showInput,style:{background:"#fff","border-style":"dashed"}},{default:Q(()=>[J(u,{theme:"outline"}),Le]),_:1},8,["onClick"]))],64)),o.tags.length?(P(),K(Z,{key:1},[J(c),J(p,{ref:"myLucky",width:"200px",height:"200px",blocks:o.blocks,prizes:o.prizes,buttons:o.buttons,onStart:o.startCallBack,onEnd:o.endCallBack},null,8,["blocks","prizes","buttons","onStart","onEnd"])],64)):xt("",!0)],64)}var je=le(Te,[["render",Ee],["__scopeId","data-v-5c0bbae1"]]);export{je as default};
