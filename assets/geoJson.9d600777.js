import{c as t,g as e,a,t as o,l as i,G as n}from"./leaflet-src.esm.0ed8e194.js";import{_ as s}from"./container.12771c7e.js";import{d as r,al as l,a3 as d,am as p,V as m,W as c,a8 as u,an as h,x as b,p as v,j as y,r as g,c as f,w,o as x,k as T,J as k,I as C,N as J,M as Z,a as z,b as _,O as L,P as U,a2 as I}from"./vendor.6b1bd83d.js";import{J as N}from"./jsoneditor.min.2443a2de.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              *//* empty css              */import"./index.0cf6f247.js";var j=".container[data-v-7e938926] {\n  height: 100%;\n  width: 100%;\n  display: flex;\n}\n.container .mapContainer[data-v-7e938926] {\n  height: 100%;\n  width: 60%;\n}\n.container .leaflet-popup-content .propertyPopup[data-v-7e938926] {\n  display: block !important;\n  width: 25rem;\n  height: 20rem;\n  overflow-y: auto;\n}\n.container[data-v-7e938926] .ant-tabs {\n  width: 40%;\n  height: 100%;\n}\n.container[data-v-7e938926] .ant-tabs .ant-tabs-bar {\n  margin: 0;\n}\n.container[data-v-7e938926] .ant-tabs .ant-tabs-content {\n  height: calc(100% - 4rem);\n}\n.container[data-v-7e938926] .ant-tabs .ant-tabs-content .ant-tabs-tabpane {\n  height: 100%;\n  overflow: auto;\n}\n.container[data-v-7e938926] .ant-tabs .ant-tabs-content .ant-tabs-tabpane.ant-tabs-tabpane-inactive {\n  display: none;\n}\n.container[data-v-7e938926] .ant-tabs .ant-tabs-content .ant-table th {\n  background-color: #e6e6e6;\n}\n.container[data-v-7e938926] .ant-tabs .ant-tabs-content .ant-table td {\n  white-space: nowrap;\n}\n.container[data-v-7e938926] .ant-tabs .ant-tabs-content .ant-table td .editable-cell-input-wrapper, .container[data-v-7e938926] .ant-tabs .ant-tabs-content .ant-table td .editable-cell-text-wrapper {\n  width: max-content;\n}\n.container[data-v-7e938926] .ant-tabs .ant-tabs-content .ant-table-striped .table-striped {\n  background-color: #fafafa;\n}\n.container[data-v-7e938926] .ant-tabs .geoJsonContainer {\n  height: 100%;\n}";const{TabPane:D}=l,{Item:F}=m,E=r({name:"geoJson",components:{Container:s,Tabs:l,TabPane:D,Table:d,Empty:p,Form:m,Item:F,Input:c},data:()=>({map:void 0,editor:void 0,geoJson:{type:"FeatureCollection",features:[]},geoJsonLayer:void 0,selectedFeature:void 0,editorUpdated:!1,editorUpdateTimeout:void 0,editableData:{},tdtToken:"bed806b1ccb34b268ab1c0700123d444",gaodeToken:"868d6830a7409520ae283cde3a3f84d1"}),computed:{tableColumns(){if(this.propertyList&&this.propertyList.length>0){const t=Object.keys(this.propertyList[0]).map((t=>({title:t,dataIndex:t,key:t,slots:{customRender:"property"}})));return t.push({title:"操作",dataIndex:"operation",width:40,fixed:"right",slots:{customRender:"operation"}}),t}return null},propertyList(){return this.features?this.features.map((t=>t.properties)):null},features(){if(this.geoJsonLayer)try{return this.geoJsonLayer.toGeoJSON().features}catch(t){return null}return null}},mounted(){this.editor=u(new N(this.$refs.geoJsonContainer,{mode:"code",onChangeText:()=>{this.editorUpdated=!0,this.editorUpdateTimeout&&(clearTimeout(this.editorUpdateTimeout),this.editorUpdateTimeout=void 0),this.editorUpdateTimeout=setTimeout((()=>{this.updateGeoJsonLayer(),this.editorUpdated=!1,this.editorUpdateTimeout=void 0}),5e3)},onBlur:()=>{this.editorUpdateTimeout&&(clearTimeout(this.editorUpdateTimeout),this.editorUpdateTimeout=void 0),this.editorUpdated&&(this.updateGeoJsonLayer(),this.editorUpdated=!1)}},this.geoJson)),this.initMap()},methods:{initMap(){this.map=u(t(this.$refs.mapContainer,{attributionControl:!0,zoomControl:!1})),this.map.setView([35,105],4),this.geoJsonLayer=e(void 0,{onEachFeature:this.onEachFeature}).addTo(this.map),a.layers({"高德矢量":o("https://webrd0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",{subdomains:"1234",minZoom:3,maxNativeZoom:18,maxZoom:20,attribution:'&copy; <a href="https://lbs.amap.com/pages/terms/" target="_blank">高德地图</a> 贡献者'}).addTo(this.map),"高德影像":i([o("https://webst0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=6&x={x}&y={y}&z={z}",{subdomains:"1234",minZoom:3,maxNativeZoom:18,maxZoom:20}),o("https://webst0{s}.is.autonavi.com/appmaptile?lang=zh_cn&size=1&scale=1&style=8&x={x}&y={y}&z={z}",{subdomains:"1234",minZoom:3,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://lbs.amap.com/pages/terms/" target="_blank">高德地图</a> 贡献者'}),"天地图矢量":i([o("https://t{s}.tianditu.gov.cn/vec_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=vec&style=default&tilematrixset=w&format=tiles&tilematrix={z}&tilerow={y}&tilecol={x}&tk="+this.tdtToken,{subdomains:"01234567",minZoom:3,maxNativeZoom:18,maxZoom:20}),o("https://t{s}.tianditu.gov.cn/cva_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=cva&style=default&tilematrixset=w&format=tiles&tilematrix={z}&tilerow={y}&tilecol={x}&tk="+this.tdtToken,{subdomains:"01234567",minZoom:3,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">天地图</a> 贡献者'}),"天地图影像":i([o("https://t{s}.tianditu.gov.cn/img_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=img&style=default&tilematrixset=w&format=tiles&tilematrix={z}&tilerow={y}&tilecol={x}&tk="+this.tdtToken,{subdomains:"01234567",minZoom:3,maxNativeZoom:18,maxZoom:20}),o("https://t{s}.tianditu.gov.cn/cia_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=cia&style=default&tilematrixset=w&format=tiles&tilematrix={z}&tilerow={y}&tilecol={x}&tk="+this.tdtToken,{subdomains:"01234567",minZoom:3,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">天地图</a> 贡献者'}),"天地图地形":i([o("https://t{s}.tianditu.gov.cn/ter_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=ter&style=default&tilematrixset=w&format=tiles&tilematrix={z}&tilerow={y}&tilecol={x}&tk="+this.tdtToken,{subdomains:"01234567",minZoom:3,maxNativeZoom:14,maxZoom:20}),o("https://t{s}.tianditu.gov.cn/cta_w/wmts?service=wmts&request=GetTile&version=1.0.0&layer=cta&style=default&tilematrixset=w&format=tiles&tilematrix={z}&tilerow={y}&tilecol={x}&tk="+this.tdtToken,{subdomains:"01234567",minZoom:3,maxNativeZoom:14,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">天地图</a> 贡献者'}),OpenStreetMap:o("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> 贡献者'})},{"图形":h(this.geoJsonLayer)},{hideSingleBase:!0,position:"topright"}).addTo(this.map),a.scale({imperial:!1,position:"bottomleft"}).addTo(this.map),a.zoom({zoomInTitle:"放大",zoomOutTitle:"缩小",position:"bottomright"}).addTo(this.map),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition((t=>{this.$axios.get("https://amapapi.iszy.xyz/v3/assistant/coordinate/convert",{params:{key:this.gaodeToken,locations:`${t.coords.longitude},${t.coords.latitude}`,coordsys:"gps",output:"json"}}).then((t=>{if(t.data&&"1"===t.data.status){const e=t.data.locations.split(",");this.map.setView([e[1],e[0]],18)}}))}))},updateGeoJsonLayer(){this.geoJsonLayer&&this.geoJsonLayer instanceof n&&this.geoJsonLayer.clearLayers();try{this.geoJson=this.editor.get();try{this.geoJsonLayer.addData(this.geoJson);const t=this.geoJsonLayer.getBounds(),e=t.getCenter(),a=this.map.getBoundsZoom(t);this.map.setView(e,a)}catch(t){}}catch(t){this.geoJson=void 0}},locationGeo(t){try{const a=e(t).getBounds(),o=a.getCenter(),i=this.map.getBoundsZoom(a);this.map.setView(o,i)}catch(a){}},onEachFeature(t,e){t.properties&&e.bindPopup(this.$refs.propertyPopup).on("popupopen",(()=>{this.selectedFeature=t,e.setStyle({color:"#ff7800",weight:5,opacity:.65})})).on("popupclose",(()=>{this.selectedFeature=void 0,this.geoJsonLayer.resetStyle()}))},saveToEditor(t,e,a){if(t instanceof InputEvent&&e&&a)try{e.properties[a]=JSON.parse(t.currentTarget.value)}catch(o){e.properties[a]=t.currentTarget.value}this.geoJson=this.geoJsonLayer.toGeoJSON(),this.editor.update(this.geoJson)},saveToEditableData(t,e,a){if(t instanceof InputEvent&&e&&a)try{e[a]=JSON.parse(t.currentTarget.value)}catch(o){e[a]=t.currentTarget.value}},edit(t){this.editableData[t]=b(this.propertyList[t])},save(t){Object.assign(this.propertyList[t],this.editableData[t]),delete this.editableData[t]},cancel(t){delete this.editableData[t]},rowEvents(t,e){return{onClick:()=>{this.locationGeo(this.features[e])}}}},beforeUnmount(){this.map&&(this.map.remove(),this.map=void 0),this.editor&&(this.editor.destroy(),this.editor=void 0)}});v("data-v-7e938926");const G={class:"container"},O={class:"mapContainer",ref:"mapContainer"},S={class:"propertyPopup",ref:"propertyPopup"},P={class:"geoJsonContainer",ref:"geoJsonContainer"},M={key:0,class:"editable-cell-input-wrapper"},q={key:1,class:"editable-cell-text-wrapper"},B={key:0},$=["onClick"],V=["onClick"],R={key:1},K=["onClick"];function W(t,e,a,o,i,n){const s=g("Input"),r=g("Item"),l=g("Form"),d=g("TabPane"),p=g("Table"),m=g("Empty"),c=g("Tabs"),u=g("container");return x(),f(u,null,{default:w((()=>{var e;return[T("div",G,[T("div",O,null,512),k(T("div",S,[(null==(e=t.selectedFeature)?void 0:e.properties)?(x(),f(l,{key:0,"label-col":{span:6},"wrapper-col":{span:18},colon:!1},{default:w((()=>[(x(!0),C(Z,null,J(t.selectedFeature.properties,((e,a,o)=>(x(),f(r,{label:a,key:"prop"+o},{default:w((()=>["string"==typeof t.selectedFeature.properties[a]?(x(),f(s,{key:0,value:t.selectedFeature.properties[a],"onUpdate:value":e=>t.selectedFeature.properties[a]=e,onChange:t.saveToEditor},null,8,["value","onUpdate:value","onChange"])):"number"==typeof t.selectedFeature.properties[a]?(x(),f(s,{key:1,value:t.selectedFeature.properties[a],"onUpdate:value":e=>t.selectedFeature.properties[a]=e,valueModifiers:{number:!0},onChange:t.saveToEditor},null,8,["value","onUpdate:value","onChange"])):(x(),f(s,{key:2,value:JSON.stringify(e),onChange:e=>t.saveToEditor(e,t.selectedFeature,a)},null,8,["value","onChange"]))])),_:2},1032,["label"])))),128))])),_:1})):z("",!0)],512),[[I,!1]]),_(c,{type:"card"},{default:w((()=>[_(d,{key:"geoJson",tab:"GeoJSON"},{default:w((()=>[T("div",P,null,512)])),_:1}),_(d,{key:"table",tab:"Table"},{default:w((()=>[t.tableColumns?(x(),f(p,{key:0,class:"ant-table-striped",columns:t.tableColumns,"data-source":t.propertyList,rowKey:(t,e)=>e,pagination:!1,bordered:"",size:"small",scroll:{x:!0},rowClassName:(t,e)=>e%2==1?"table-striped":null,customRow:t.rowEvents},{property:w((({text:e,column:a,index:o})=>[t.editableData[o]?(x(),C("div",M,["string"==typeof t.editableData[o][a.dataIndex]?(x(),f(s,{key:0,value:t.editableData[o][a.dataIndex],"onUpdate:value":e=>t.editableData[o][a.dataIndex]=e,onChange:t.saveToEditor},null,8,["value","onUpdate:value","onChange"])):"number"==typeof t.editableData[o][a.dataIndex]?(x(),f(s,{key:1,value:t.editableData[o][a.dataIndex],"onUpdate:value":e=>t.editableData[o][a.dataIndex]=e,valueModifiers:{number:!0},onChange:t.saveToEditor},null,8,["value","onUpdate:value","onChange"])):(x(),f(s,{key:2,value:JSON.stringify(t.editableData[o][a.dataIndex]),onChange:e=>t.saveToEditableData(e,t.editableData[o],a.dataIndex)},null,8,["value","onChange"]))])):(x(),C("div",q,L("object"==typeof e?JSON.stringify(e):e),1))])),operation:w((({index:e})=>[t.editableData[e]?(x(),C("span",B,[T("a",{onClick:U((a=>t.save(e)),["stop"])}," 保存属性 ",8,$),T("a",{onClick:U((a=>t.cancel(e)),["stop"])}," 取消编辑 ",8,V)])):(x(),C("span",R,[T("a",{onClick:U((a=>t.edit(e)),["stop"])}," 编辑属性 ",8,K)]))])),_:1},8,["columns","data-source","rowKey","rowClassName","customRow"])):(x(),f(m,{key:1}))])),_:1})])),_:1})])]})),_:1})}y(),E.render=W,E.__scopeId="data-v-7e938926";export{E as default};
