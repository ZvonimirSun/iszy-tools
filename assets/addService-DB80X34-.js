import{aj as it,ai as ge,D as _e,G as Se,o as at,h as lt,t as Z,F as wt,j as Ct,r as xe,C as Wt,s as M,w as H,z as Zt,a4 as we,I as Ce,as as Ht,E as be,y as Te,g as Ie}from"./index-j7kdK-H8.js";import{a as Le,E as Ae}from"./el-form-item-pniwTBoV.js";import"./el-tag-1f9i8jI2.js";import{E as Pe,a as Ee}from"./el-select-3gX-hgiS.js";import"./el-scrollbar-vz8xv5bG.js";import"./el-popper-lAmhRZoK.js";import{E as Oe}from"./el-divider-Jh71uHg1.js";import{L as R,l as p}from"./leaflet-src-LLGmj3oI.js";import{v as Re}from"./index-6ZCt6h3G.js";import"./castArray-RcvnJ037.js";import"./index-ZlnE4rZf.js";import"./isEqual-Z5C-wM-O.js";import"./hasIn-6amFm_if.js";import"./strings-5sVLVEXm.js";import"./toInteger-c76KcG_L.js";import"./toFinite-Hj8N6nO0.js";import"./isUndefined-IZwZ21d-.js";var rt={startsWith:function(i,t){return i.indexOf(t)==0},contains:function(i,t){return i.indexOf(t)!=-1},trim:function(i){return i.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(i){for(var t=i.split("-"),e=t[0],r=1,n=t.length;r<n;r++){var s=t[r];e+=s.charAt(0).toUpperCase()+s.substring(1)}return e},format:function(i,t,e){t||(t=window);var r=function(n,s){for(var o,a=s.split(/\.+/),l=0;l<a.length;l++)l==0&&(o=t),o=o[a[l]];return typeof o=="function"&&(o=e?o.apply(null,e):o()),typeof o>"u"?"undefined":o};return i.replace(rt.tokenRegEx,r)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(i){return rt.numberRegEx.test(i)},numericIf:function(i){return rt.isNumeric(i)?parseFloat(i):i}},Tt={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(i,t){var e=0;return t>0&&(e=parseFloat(i.toPrecision(t))),e},format:function(i,t,e,r){t=typeof t<"u"?t:0,e=typeof e<"u"?e:Tt.thousandsSeparator,r=typeof r<"u"?r:Tt.decimalSeparator,t!=null&&(i=parseFloat(i.toFixed(t)));var n=i.toString().split(".");n.length===1&&t==null&&(t=0);var s=n[0];if(e)for(var o=/(-?[0-9]+)([0-9]{3})/;o.test(s);)s=s.replace(o,"$1"+e+"$2");var a;if(t==0)a=s;else{var l=n.length>1?n[1]:"0";t!=null&&(l=l+new Array(t-l.length+1).join("0")),a=s+r+l}return a}};Number.prototype.limitSigDigs||(Number.prototype.limitSigDigs=function(i){return Tt.limitSigDigs(this,i)});class ot{constructor(){this.CLASS_NAME="SuperMap.Geometry",this.id=S.createUniqueID(this.CLASS_NAME+"_"),this.parent=null,this.bounds=null,this.SRID=null}destroy(){this.id=null,this.bounds=null,this.SRID=null}clone(){return new ot}setBounds(t){t&&(this.bounds=t.clone())}clearBounds(){this.bounds=null,this.parent&&this.parent.clearBounds()}extendBounds(t){var e=this.getBounds();e?this.bounds.extend(t):this.setBounds(t)}getBounds(){return this.bounds==null&&this.calculateBounds(),this.bounds}calculateBounds(){}getVertices(t){}getArea(){return 0}}const te=function(){var i="",t="",e="pc",r,n=navigator.userAgent.toLowerCase();return n.indexOf("msie")>-1||n.indexOf("trident")>-1&&n.indexOf("rv")>-1?(i="msie",r=n.match(/msie ([\d.]+)/)||n.match(/rv:([\d.]+)/)):n.indexOf("chrome")>-1?(i="chrome",r=n.match(/chrome\/([\d.]+)/)):n.indexOf("firefox")>-1?(i="firefox",r=n.match(/firefox\/([\d.]+)/)):n.indexOf("opera")>-1?(i="opera",r=n.match(/version\/([\d.]+)/)):n.indexOf("safari")>-1&&(i="safari",r=n.match(/version\/([\d.]+)/)),t=r?r[1]:"",n.indexOf("ipad")>-1||n.indexOf("ipod")>-1||n.indexOf("iphone")>-1?e="apple":n.indexOf("android")>-1&&(r=n.match(/version\/([\d.]+)/),t=r?r[1]:"",e="android"),{name:i,version:t,device:e}}(),Ne=function(){var i=!0,t=te;return document.createElement("canvas").getContext?(t.name==="firefox"&&parseFloat(t.version)<5&&(i=!1),t.name==="safari"&&parseFloat(t.version)<4&&(i=!1),t.name==="opera"&&parseFloat(t.version)<10&&(i=!1),t.name==="msie"&&parseFloat(t.version)<9&&(i=!1)):i=!1,i}();(function(){var i=navigator.userAgent.toLowerCase();return i.indexOf("webkit")===-1&&i.indexOf("gecko")!==-1})();const Vt=96,S={assign(i){for(var t=0;t<Object.getOwnPropertyNames(arguments).length;t++){var e=Object.getOwnPropertyNames(arguments)[t];if(!(e=="caller"||e=="callee"||e=="length"||e=="arguments")){var r=arguments[e];if(r)for(var n=0;n<Object.getOwnPropertyNames(r).length;n++){var s=Object.getOwnPropertyNames(r)[n];e=="caller"||e=="callee"||e=="length"||e=="arguments"||(i[s]=r[s])}}}return i},extend:function(i,t){if(i=i||{},t){for(var e in t){var r=t[e];r!==void 0&&(i[e]=r)}var n=typeof window.Event=="function"&&t instanceof window.Event;!n&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(i.toString=t.toString)}return i},copy:function(i,t){i=i||{};var e;if(t)for(var r in i)e=t[r],typeof e<"u"&&(i[r]=e)},reset:function(i){i=i||{};for(var t in i)if(i.hasOwnProperty(t)){if(typeof i[t]=="object"&&i[t]instanceof Array){for(var e in i[t])i[t][e].destroy&&i[t][e].destroy();i[t].length=0}else typeof i[t]=="object"&&i[t]instanceof Object&&i[t].destroy&&i[t].destroy();i[t]=null}},getElement:function(){for(var i=[],t=0,e=arguments.length;t<e;t++){var r=arguments[t];if(typeof r=="string"&&(r=document.getElementById(r)),arguments.length===1)return r;i.push(r)}return i},isElement:function(i){return!!(i&&i.nodeType===1)},isArray:function(i){return Object.prototype.toString.call(i)==="[object Array]"},removeItem:function(i,t){for(var e=i.length-1;e>=0;e--)i[e]===t&&i.splice(e,1);return i},indexOf:function(i,t){if(i==null)return-1;if(typeof i.indexOf=="function")return i.indexOf(t);for(var e=0,r=i.length;e<r;e++)if(i[e]===t)return e;return-1},modifyDOMElement:function(i,t,e,r,n,s,o,a){t&&(i.id=t),e&&(i.style.left=e.x+"px",i.style.top=e.y+"px"),r&&(i.style.width=r.w+"px",i.style.height=r.h+"px"),n&&(i.style.position=n),s&&(i.style.border=s),o&&(i.style.overflow=o),parseFloat(a)>=0&&parseFloat(a)<1?(i.style.filter="alpha(opacity="+a*100+")",i.style.opacity=a):parseFloat(a)===1&&(i.style.filter="",i.style.opacity="")},applyDefaults:function(i,t){i=i||{};var e=typeof window.Event=="function"&&t instanceof window.Event;for(var r in t)(i[r]===void 0||!e&&t.hasOwnProperty&&t.hasOwnProperty(r)&&!i.hasOwnProperty(r))&&(i[r]=t[r]);return!e&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!i.hasOwnProperty("toString")&&(i.toString=t.toString),i},getParameterString:function(i){var t=[];for(var e in i){var r=i[e];if(r!=null&&typeof r!="function"){var n;Array.isArray(r)||r.toString()==="[object Object]"?n=encodeURIComponent(JSON.stringify(r)):n=encodeURIComponent(r),t.push(encodeURIComponent(e)+"="+n)}}return t.join("&")},urlAppend:function(i,t){var e=i;if(t){t.indexOf("?")===0&&(t=t.substring(1));var r=(i+" ").split(/[?&]/);e+=r.pop()===" "?t:r.length?"&"+t:"?"+t}return e},urlPathAppend:function(i,t){let e=i;if(!t)return e;t.indexOf("/")===0&&(t=t.substring(1));const r=i.split("?");return r[0].indexOf("/",r[0].length-1)<0&&(r[0]+="/"),e=`${r[0]}${t}${r.length>1?`?${r[1]}`:""}`,e},DEFAULT_PRECISION:14,toFloat:function(i,t){return t==null&&(t=S.DEFAULT_PRECISION),typeof i!="number"&&(i=parseFloat(i)),t===0?i:parseFloat(i.toPrecision(t))},rad:function(i){return i*Math.PI/180},getParameters:function(i){i=i??window.location.href;var t="";if(rt.contains(i,"?")){var e=i.indexOf("?")+1,r=rt.contains(i,"#")?i.indexOf("#"):i.length;t=i.substring(e,r)}for(var n={},s=t.split(/[&;]/),o=0,a=s.length;o<a;++o){var l=s[o].split("=");if(l[0]){var c=l[0];try{c=decodeURIComponent(c)}catch{c=unescape(c)}var h=(l[1]||"").replace(/\+/g," ");try{h=decodeURIComponent(h)}catch{h=unescape(h)}h=h.split(","),h.length==1&&(h=h[0]),n[c]=h}}return n},lastSeqID:0,createUniqueID:function(i){return i==null&&(i="id_"),S.lastSeqID+=1,i+S.lastSeqID},normalizeScale:function(i){var t=i>1?1/i:i;return t},getResolutionFromScale:function(i,t){var e;if(i){t==null&&(t="degrees");var r=S.normalizeScale(i);e=1/(r*b[t]*Vt)}return e},getScaleFromResolution:function(i,t){t==null&&(t="degrees");var e=i*b[t]*Vt;return e},getBrowser:function(){return te},isSupportCanvas:Ne,supportCanvas:function(){return S.isSupportCanvas},isInTheSameDomain:function(i){if(!i)return!0;var t=i.indexOf("//"),e=document.location.toString(),r=e.indexOf("//");if(t===-1)return!0;var n,s=n=i.substring(0,t),o=e.substring(r+2);r=o.indexOf("/");var a=o.indexOf(":"),l=o.substring(0,r),c=document.location.protocol;if(a!==-1||(l+=":"+(c.toLowerCase()==="http:"?80:443)),c.toLowerCase()!==s.toLowerCase())return!1;s=i.substring(t+2);var h=s.indexOf(":");t=s.indexOf("/");var y=s.substring(0,t),g;h!==-1?g=s.substring(0,h):(g=s.substring(0,t),y+=":"+(n.toLowerCase()==="http:"?80:443));var v=document.domain;return g===v&&y===l},calculateDpi:function(i,t,e,r,n){if(!(!i||!t||!e)){var s=1e4,o=i.getWidth(),a=i.getHeight(),l=t.w,c=t.h;n=n||6378137,r=r||"degrees";var h;if(r.toLowerCase()==="degree"||r.toLowerCase()==="degrees"||r.toLowerCase()==="dd"){let y=o/l,g=a/c,v=y>g?y:g;h=.0254*s/v/e/(Math.PI*2*n/360)/s}else{let y=o/l;h=.0254*s/y/e/s}return h}},toJSON:function(i){var t=i;if(t==null)return null;switch(t.constructor){case String:return t='"'+t.replace(/(["\\])/g,"\\$1")+'"',t=t.replace(/\n/g,"\\n"),t=t.replace(/\r/g,"\\r"),t=t.replace("<","&lt;"),t=t.replace(">","&gt;"),t=t.replace(/%/g,"%25"),t=t.replace(/&/g,"%26"),t;case Array:for(var e="",r=0,n=t.length;r<n;r++)e+=S.toJSON(t[r]),r!==t.length-1&&(e+=",");return"["+e+"]";case Number:return isFinite(t)?String(t):null;case Boolean:return String(t);case Date:var s=`{'__type':"System.DateTime",'Year':`+t.getFullYear()+",'Month':"+(t.getMonth()+1)+",'Day':"+t.getDate()+",'Hour':"+t.getHours()+",'Minute':"+t.getMinutes()+",'Second':"+t.getSeconds()+",'Millisecond':"+t.getMilliseconds()+",'TimezoneOffset':"+t.getTimezoneOffset()+"}";return s;default:if(t.toJSON!=null&&typeof t.toJSON=="function")return t.toJSON();if(typeof t=="object"){if(t.length){let a=[];for(let l=0,c=t.length;l<c;l++)a.push(S.toJSON(t[l]));return"["+a.join(",")+"]"}let o=[];for(let a in t)typeof t[a]!="function"&&a!=="CLASS_NAME"&&a!=="parent"&&o.push("'"+a+"':"+S.toJSON(t[a]));return o.length>0?"{"+o.join(",")+"}":"{}"}return t.toString()}},getResolutionFromScaleDpi:function(i,t,e,r){var n=null,s=1e4;return r=r||6378137,e=e||"",i>0&&t>0?(i=S.normalizeScale(i),e.toLowerCase()==="degree"||e.toLowerCase()==="degrees"||e.toLowerCase()==="dd"?(n=.0254*s/t/i/(Math.PI*2*r/360)/s,n):(n=.0254*s/t/i/s,n)):-1},getScaleFromResolutionDpi:function(i,t,e,r){var n=null,s=1e4;return r=r||6378137,e=e||"",i>0&&t>0?e.toLowerCase()==="degree"||e.toLowerCase()==="degrees"||e.toLowerCase()==="dd"?(n=.0254*s/t/i/(Math.PI*2*r/360)/s,n):(n=.0254*s/t/i/s,n):-1},transformResult:function(i){return i.responseText&&typeof i.responseText=="string"&&(i=JSON.parse(i.responseText)),i},copyAttributes:function(i,t){if(i=i||{},t)for(var e in t){var r=t[e];r!==void 0&&e!=="CLASS_NAME"&&typeof r!="function"&&(i[e]=r)}return i},copyAttributesWithClip:function(i,t,e){if(i=i||{},t)for(var r in t){var n=!1;if(e&&e.length){for(var s=0,o=e.length;s<o;s++)if(r===e[s]){n=!0;break}}if(n!==!0){var a=t[r];a!==void 0&&r!=="CLASS_NAME"&&typeof a!="function"&&(i[r]=a)}}return i},cloneObject:function(i){if(i===null||typeof i!="object")return i;if(i instanceof Date){let e=new Date;return e.setTime(i.getTime()),e}if(i instanceof Array)return i.slice(0);if(i instanceof Object){let e={};for(var t in i)i.hasOwnProperty(t)&&(e[t]=S.cloneObject(i[t]));return e}throw new Error("Unable to copy obj! Its type isn't supported.")},lineIntersection:function(i,t,e,r){var n=null,s,o,a=(r.x-e.x)*(i.y-e.y)-(r.y-e.y)*(i.x-e.x),l=(t.x-i.x)*(i.y-e.y)-(t.y-i.y)*(i.x-e.x),c=(r.y-e.y)*(t.x-i.x)-(r.x-e.x)*(t.y-i.y);if(c!=0)s=a/c,o=l/c,s>=0&&o<=1&&s<=1&&o>=0?n=new ot.Point(i.x+s*(t.x-i.x),i.y+s*(t.y-i.y)):n="No Intersection";else if(a==0&&l==0){var h=Math.max(i.y,t.y),y=Math.min(i.y,t.y),g=Math.max(i.x,t.x),v=Math.min(i.x,t.x);(e.y>=y&&e.y<=h||r.y>=y&&r.y<=h)&&e.x>=v&&e.x<=g||r.x>=v&&r.x<=g?n="Coincident":n="Parallel"}else n="Parallel";return n},getTextBounds:function(i,t,e){document.body.appendChild(e),e.style.width="auto",e.style.height="auto",i.fontSize&&(e.style.fontSize=i.fontSize),i.fontFamily&&(e.style.fontFamily=i.fontFamily),i.fontWeight&&(e.style.fontWeight=i.fontWeight),e.style.position="relative",e.style.visibility="hidden",e.style.display="inline-block",e.innerHTML=t;var r=e.clientWidth,n=e.clientHeight;return document.body.removeChild(e),{textWidth:r,textHeight:n}},convertPath:function(i,t){return t?i.replace(/\{([\w-\.]+)\}/g,(e,r)=>{var n;return t.hasOwnProperty(r)?n=Me(t[r]):n=e,encodeURIComponent(n)}):i}},b={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};b.in=b.inches;b.degrees=b.dd;b.nmi=1852*b.m;const x=.0254000508001016;S.extend(b,{Inch:b.inches,Meter:1/x,Foot:.3048006096012192/x,IFoot:.3048/x,ClarkeFoot:.3047972651151/x,SearsFoot:.30479947153867626/x,GoldCoastFoot:.3047997101815088/x,IInch:.0254/x,MicroInch:254e-7/x,Mil:254e-10/x,Centimeter:.01/x,Kilometer:1e3/x,Yard:.9144018288036576/x,SearsYard:.914398414616029/x,IndianYard:.9143985307444408/x,IndianYd37:.91439523/x,IndianYd62:.9143988/x,IndianYd75:.9143985/x,IndianFoot:.30479951/x,IndianFt37:.30479841/x,IndianFt62:.3047996/x,IndianFt75:.3047995/x,Mile:1609.3472186944373/x,IYard:.9144/x,IMile:1609.344/x,NautM:1852/x,"Lat-66":110943.31648893273/x,"Lat-83":110946.25736872235/x,Decimeter:.1/x,Millimeter:.001/x,Dekameter:10/x,Decameter:10/x,Hectometer:100/x,GermanMeter:1.0000135965/x,CaGrid:.999738/x,ClarkeChain:20.1166194976/x,GunterChain:20.11684023368047/x,BenoitChain:20.116782494375872/x,SearsChain:20.11676512155/x,ClarkeLink:.201166194976/x,GunterLink:.2011684023368047/x,BenoitLink:.20116782494375873/x,SearsLink:.2011676512155/x,Rod:5.02921005842012/x,IntnlChain:20.1168/x,IntnlLink:.201168/x,Perch:5.02921005842012/x,Pole:5.02921005842012/x,Furlong:201.1684023368046/x,Rood:3.778266898/x,CapeFoot:.3047972615/x,Brealey:375/x,ModAmFt:.304812252984506/x,Fathom:1.8288/x,"NautM-UK":1853.184/x,"50kilometers":5e4/x,"150kilometers":15e4/x});S.extend(b,{mm:b.Meter/1e3,cm:b.Meter/100,dm:b.Meter*100,km:b.Meter*1e3,kmi:b.nmi,fath:b.Fathom,ch:b.IntnlChain,link:b.IntnlLink,"us-in":b.inches,"us-ft":b.Foot,"us-yd":b.Yard,"us-ch":b.GunterChain,"us-mi":b.Mile,"ind-yd":b.IndianYd37,"ind-ft":b.IndianFt37,"ind-ch":20.11669506/x});b.degree=b.dd;b.meter=b.m;b.foot=b.ft;b.inch=b.inches;b.mile=b.mi;b.kilometer=b.km;b.yard=b.yd;function Me(i){return i==null||i==null?"":i instanceof Date?i.toJSON():Fe(i)?JSON.stringify(i):i.toString()}function Fe(i){if(typeof i!="string"&&typeof i!="object")return!1;try{const t=i.toString();return t==="[object Object]"||t==="[object Array]"}catch{return!1}}(function(i,t){(function(e,r){r()})(it,function(){function e(f){var m=this.constructor;return this.then(function(u){return m.resolve(f()).then(function(){return u})},function(u){return m.resolve(f()).then(function(){return m.reject(u)})})}function r(f){var m=this;return new m(function(u,d){if(!(f&&typeof f.length<"u"))return d(new TypeError(typeof f+" "+f+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var _=Array.prototype.slice.call(f);if(_.length===0)return u([]);var A=_.length;function I(P,E){if(E&&(typeof E=="object"||typeof E=="function")){var k=E.then;if(typeof k=="function"){k.call(E,function(G){I(P,G)},function(G){_[P]={status:"rejected",reason:G},--A===0&&u(_)});return}}_[P]={status:"fulfilled",value:E},--A===0&&u(_)}for(var C=0;C<_.length;C++)I(C,_[C])})}var n=setTimeout;function s(f){return!!(f&&typeof f.length<"u")}function o(){}function a(f,m){return function(){f.apply(m,arguments)}}function l(f){if(!(this instanceof l))throw new TypeError("Promises must be constructed via new");if(typeof f!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],w(f,this)}function c(f,m){for(;f._state===3;)f=f._value;if(f._state===0){f._deferreds.push(m);return}f._handled=!0,l._immediateFn(function(){var u=f._state===1?m.onFulfilled:m.onRejected;if(u===null){(f._state===1?h:y)(m.promise,f._value);return}var d;try{d=u(f._value)}catch(_){y(m.promise,_);return}h(m.promise,d)})}function h(f,m){try{if(m===f)throw new TypeError("A promise cannot be resolved with itself.");if(m&&(typeof m=="object"||typeof m=="function")){var u=m.then;if(m instanceof l){f._state=3,f._value=m,g(f);return}else if(typeof u=="function"){w(a(u,m),f);return}}f._state=1,f._value=m,g(f)}catch(d){y(f,d)}}function y(f,m){f._state=2,f._value=m,g(f)}function g(f){f._state===2&&f._deferreds.length===0&&l._immediateFn(function(){f._handled||l._unhandledRejectionFn(f._value)});for(var m=0,u=f._deferreds.length;m<u;m++)c(f,f._deferreds[m]);f._deferreds=null}function v(f,m,u){this.onFulfilled=typeof f=="function"?f:null,this.onRejected=typeof m=="function"?m:null,this.promise=u}function w(f,m){var u=!1;try{f(function(d){u||(u=!0,h(m,d))},function(d){u||(u=!0,y(m,d))})}catch(d){if(u)return;u=!0,y(m,d)}}l.prototype.catch=function(f){return this.then(null,f)},l.prototype.then=function(f,m){var u=new this.constructor(o);return c(this,new v(f,m,u)),u},l.prototype.finally=e,l.all=function(f){return new l(function(m,u){if(!s(f))return u(new TypeError("Promise.all accepts an array"));var d=Array.prototype.slice.call(f);if(d.length===0)return m([]);var _=d.length;function A(C,P){try{if(P&&(typeof P=="object"||typeof P=="function")){var E=P.then;if(typeof E=="function"){E.call(P,function(k){A(C,k)},u);return}}d[C]=P,--_===0&&m(d)}catch(k){u(k)}}for(var I=0;I<d.length;I++)A(I,d[I])})},l.allSettled=r,l.resolve=function(f){return f&&typeof f=="object"&&f.constructor===l?f:new l(function(m){m(f)})},l.reject=function(f){return new l(function(m,u){u(f)})},l.race=function(f){return new l(function(m,u){if(!s(f))return u(new TypeError("Promise.race accepts an array"));for(var d=0,_=f.length;d<_;d++)l.resolve(f[d]).then(m,u)})},l._immediateFn=typeof setImmediate=="function"&&function(f){setImmediate(f)}||function(f){n(f,0)},l._unhandledRejectionFn=function(m){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",m)};var T=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof it<"u")return it;throw new Error("unable to locate global object")}();typeof T.Promise!="function"?T.Promise=l:(T.Promise.prototype.finally||(T.Promise.prototype.finally=e),T.Promise.allSettled||(T.Promise.allSettled=r))})})();var Ge={exports:{}};(function(i){(function(t){if(!t.__disableNativeFetch&&t.fetch)return;function e(u){if(typeof u!="string"&&(u=String(u)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(u))throw new TypeError("Invalid character in header field name");return u.toLowerCase()}function r(u){return typeof u!="string"&&(u=String(u)),u}function n(u){this.map={},u instanceof n?u.forEach(function(d,_){this.append(_,d)},this):u&&Object.getOwnPropertyNames(u).forEach(function(d){this.append(d,u[d])},this)}n.prototype.append=function(u,d){u=e(u),d=r(d);var _=this.map[u];_||(_=[],this.map[u]=_),_.push(d)},n.prototype.delete=function(u){delete this.map[e(u)]},n.prototype.get=function(u){var d=this.map[e(u)];return d?d[0]:null},n.prototype.getAll=function(u){return this.map[e(u)]||[]},n.prototype.has=function(u){return this.map.hasOwnProperty(e(u))},n.prototype.set=function(u,d){this.map[e(u)]=[r(d)]},n.prototype.forEach=function(u,d){Object.getOwnPropertyNames(this.map).forEach(function(_){this.map[_].forEach(function(A){u.call(d,A,_,this)},this)},this)};function s(u){if(u.bodyUsed)return Promise.reject(new TypeError("Already read"));u.bodyUsed=!0}function o(u){return new Promise(function(d,_){u.onload=function(){d(u.result)},u.onerror=function(){_(u.error)}})}function a(u){var d=new FileReader;return d.readAsArrayBuffer(u),o(d)}function l(u,d){var _=new FileReader,A=d.headers.map["content-type"]?d.headers.map["content-type"].toString():"",I=/charset\=[0-9a-zA-Z\-\_]*;?/,C=u.type.match(I)||A.match(I),P=[u];return C&&P.push(C[0].replace(/^charset\=/,"").replace(/;$/,"")),_.readAsText.apply(_,P),o(_)}var c={blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};function h(){return this.bodyUsed=!1,this._initBody=function(u,d){if(this._bodyInit=u,typeof u=="string")this._bodyText=u;else if(c.blob&&Blob.prototype.isPrototypeOf(u))this._bodyBlob=u,this._options=d;else if(c.formData&&FormData.prototype.isPrototypeOf(u))this._bodyFormData=u;else if(!u)this._bodyText="";else if(!(c.arrayBuffer&&ArrayBuffer.prototype.isPrototypeOf(u)))throw new Error("unsupported BodyInit type")},c.blob?(this.blob=function(){var u=s(this);if(u)return u;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(a)},this.text=function(){var u=s(this);if(u)return u;if(this._bodyBlob)return l(this._bodyBlob,this._options);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var u=s(this);return u||Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(w)}),this.json=function(){return this.text().then(JSON.parse)},this}var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function g(u){var d=u.toUpperCase();return y.indexOf(d)>-1?d:u}function v(u,d){d=d||{};var _=d.body;if(v.prototype.isPrototypeOf(u)){if(u.bodyUsed)throw new TypeError("Already read");this.url=u.url,this.credentials=u.credentials,d.headers||(this.headers=new n(u.headers)),this.method=u.method,this.mode=u.mode,_||(_=u._bodyInit,u.bodyUsed=!0)}else this.url=u;if(this.credentials=d.credentials||this.credentials||"omit",(d.headers||!this.headers)&&(this.headers=new n(d.headers)),this.method=g(d.method||this.method||"GET"),this.mode=d.mode||this.mode||null,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&_)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(_,d)}v.prototype.clone=function(){return new v(this)};function w(u){var d=new FormData;return u.trim().split("&").forEach(function(_){if(_){var A=_.split("="),I=A.shift().replace(/\+/g," "),C=A.join("=").replace(/\+/g," ");d.append(decodeURIComponent(I),decodeURIComponent(C))}}),d}function T(u){var d=new n,_=u.getAllResponseHeaders().trim().split(`
`);return _.forEach(function(A){var I=A.trim().split(":"),C=I.shift().trim(),P=I.join(":").trim();d.append(C,P)}),d}h.call(v.prototype);function f(u,d){d||(d={}),this._initBody(u,d),this.type="default",this.status=d.status,this.ok=this.status>=200&&this.status<300,this.statusText=d.statusText,this.headers=d.headers instanceof n?d.headers:new n(d.headers),this.url=d.url||""}h.call(f.prototype),f.prototype.clone=function(){return new f(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},f.error=function(){var u=new f(null,{status:0,statusText:""});return u.type="error",u};var m=[301,302,303,307,308];f.redirect=function(u,d){if(m.indexOf(d)===-1)throw new RangeError("Invalid status code");return new f(null,{status:d,headers:{location:u}})},t.Headers=n,t.Request=v,t.Response=f,t.fetch=function(u,d){return new Promise(function(_,A){var I;v.prototype.isPrototypeOf(u)&&!d?I=u:I=new v(u,d);var C=new XMLHttpRequest;function P(){if("responseURL"in C)return C.responseURL;if(/^X-Request-URL:/m.test(C.getAllResponseHeaders()))return C.getResponseHeader("X-Request-URL")}var E=!1;function k(){if(C.readyState===4){var G=C.status===1223?204:C.status;if(G<100||G>599){if(E)return;E=!0,A(new TypeError("Network request failed"));return}var xt={status:G,statusText:C.statusText,headers:T(C),url:P()},ve="response"in C?C.response:C.responseText;E||(E=!0,_(new f(ve,xt)))}}C.onreadystatechange=k,C.onload=k,C.onerror=function(){E||(E=!0,A(new TypeError("Network request failed")))},C.open(I.method,I.url,!0);try{I.credentials==="include"&&("withCredentials"in C?C.withCredentials=!0:console&&console.warn&&console.warn("withCredentials is not supported, you can ignore this warning"))}catch(G){console&&console.warn&&console.warn("set withCredentials error:"+G)}"responseType"in C&&c.blob&&(C.responseType="blob"),I.headers.forEach(function(G,xt){C.setRequestHeader(xt,G)}),C.send(typeof I._bodyInit>"u"?null:I._bodyInit)})},t.fetch.polyfill=!0,i.exports&&(i.exports=t.fetch)})(typeof self<"u"?self:it)})(Ge);var It={exports:{}};(function(i,t){(function(e,r){r(t,i)})(it,function(e,r){var n={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function s(){return"jsonp_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function o(c){try{delete window[c]}catch{window[c]=void 0}}function a(c){var h=document.getElementById(c);h&&document.getElementsByTagName("head")[0].removeChild(h)}function l(c){var h=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],y=c,g=h.timeout||n.timeout,v=h.jsonpCallback||n.jsonpCallback,w=void 0;return new Promise(function(T,f){var m=h.jsonpCallbackFunction||s(),u=v+"_"+m;window[m]=function(_){T({ok:!0,json:function(){return Promise.resolve(_)}}),w&&clearTimeout(w),a(u),o(m)},y+=y.indexOf("?")===-1?"?":"&";var d=document.createElement("script");d.setAttribute("src",""+y+v+"="+m),h.charset&&d.setAttribute("charset",h.charset),d.id=u,document.getElementsByTagName("head")[0].appendChild(d),w=setTimeout(function(){f(new Error("JSONP request to "+c+" timed out")),o(m),a(u),window[m]=function(){o(m)}},g),d.onerror=function(){f(new Error("JSONP request to "+c+" failed")),o(m),a(u),w&&clearTimeout(w)}})}r.exports=l})})(It,It.exports);var De=It.exports;const ee=ge(De);let Kt=window.fetch;var ut={limitLength:1500,queryKeys:[],queryValues:[],supermap_callbacks:{},addQueryStrings:function(i){var t=this;for(var e in i){t.queryKeys.push(e),typeof i[e]!="string"&&(i[e]=S.toJSON(i[e]));var r=encodeURIComponent(i[e]);t.queryValues.push(r)}},issue:function(i){for(var t=this,e=t.getUid(),r=i.url,n=[],s=r,o=0,a=t.queryKeys?t.queryKeys.length:0,l=0;l<a;l++)if(s.length+t.queryKeys[l].length+2>=t.limitLength){if(o==0)return!1;n.push(s),s=r,o=0,l--}else if(s.length+t.queryKeys[l].length+2+t.queryValues[l].length>t.limitLength)for(var c=t.queryValues[l];c.length>0;){var h=t.limitLength-s.length-t.queryKeys[l].length-2;s.indexOf("?")>-1?s+="&":s+="?";var y=c.substring(0,h);y.substring(h-1,h)==="%"?(h-=1,y=c.substring(0,h)):y.substring(h-2,h-1)==="%"&&(h-=2,y=c.substring(0,h)),s+=t.queryKeys[l]+"="+y,c=c.substring(h),y.length>0&&(n.push(s),s=r,o=0)}else o++,s.indexOf("?")>-1?s+="&":s+="?",s+=t.queryKeys[l]+"="+t.queryValues[l];return n.push(s),t.send(n,"SuperMapJSONPCallbacks_"+e,i&&i.proxy)},getUid:function(){var i=new Date().getTime(),t=Math.floor(Math.random()*1e17);return i*1e3+t},send:function(i,t,e){var r=i.length;if(r>0)return new Promise(n=>{for(var s=new Date().getTime(),o=0;o<r;o++){var a=i[o];a.indexOf("?")>-1?a+="&":a+="?",a+="sectionCount="+r,a+="&sectionIndex="+o,a+="&jsonpUserID="+s,e&&(a=decodeURIComponent(a),a=e+encodeURIComponent(a)),ee(a,{jsonpCallbackFunction:t,timeout:3e4}).then(l=>{n(l.json())})}})},GET:function(i){var t=this;return t.queryKeys.length=0,t.queryValues.length=0,t.addQueryStrings(i.params),t.issue(i)},POST:function(i){var t=this;return t.queryKeys.length=0,t.queryValues.length=0,t.addQueryStrings({requestEntity:i.data}),t.issue(i)},PUT:function(i){var t=this;return t.queryKeys.length=0,t.queryValues.length=0,t.addQueryStrings({requestEntity:i.data}),t.issue(i)},DELETE:function(i){var t=this;return t.queryKeys.length=0,t.queryValues.length=0,t.addQueryStrings({requestEntity:i.data}),t.issue(i)}},ke=function(){return window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest},Qt=function(){return 45e3},j={commit:function(i,t,e,r){switch(i=i&&i.toUpperCase(),i){case"GET":return this.get(t,e,r);case"POST":return this.post(t,e,r);case"PUT":return this.put(t,e,r);case"DELETE":return this.delete(t,e,r);default:return this.get(t,e,r)}},supportDirectRequest:function(i,t){return S.isInTheSameDomain(i)?!0:t.crossOrigin!=null?t.crossOrigin:ke()||t.proxy},get:function(i,t,e){e=e||{};var r="GET";if(i=S.urlAppend(i,this._getParameterString(t||{})),i=this._processUrl(i,e),!this.supportDirectRequest(i,e)){i=i.replace(".json",".jsonp");var n={url:i,data:t};return ut.GET(n)}return this.urlIsLong(i)?this._postSimulatie(r,i.substring(0,i.indexOf("?")),t,e):this._fetch(i,t,e,r)},delete:function(i,t,e){e=e||{};var r="DELETE";if(i=S.urlAppend(i,this._getParameterString(t||{})),i=this._processUrl(i,e),!this.supportDirectRequest(i,e)){i=i.replace(".json",".jsonp");var n={url:i+="&_method=DELETE",data:t};return ut.DELETE(n)}return this.urlIsLong(i)?this._postSimulatie(r,i.substring(0,i.indexOf("?")),t,e):this._fetch(i,t,e,r)},post:function(i,t,e){if(e=e||{},i=this._processUrl(i,e),!this.supportDirectRequest(i,e)){i=i.replace(".json",".jsonp");var r={url:S.urlAppend(i,"_method=POST"),data:t};return ut.POST(r)}return this._fetch(i,t,e,"POST")},put:function(i,t,e){if(e=e||{},i=this._processUrl(i,e),!this.supportDirectRequest(i,e)){i=i.replace(".json",".jsonp");var r={url:i+="&_method=PUT",data:t};return ut.PUT(r)}return this._fetch(i,t,e,"PUT")},urlIsLong:function(i){for(var t=0,e=null,r=0,n=i.length;r<n;r++)e=i.charCodeAt(r),e<127?t++:128<=e&&e<=2047?t+=2:2048<=e&&e<=65535&&(t+=3);return!(t<2e3)},_postSimulatie:function(i,t,e,r){var n=t.indexOf("?")>-1?"&":"?";return t+=n+"_method="+i,typeof e!="string"&&(e=JSON.stringify(e)),this.post(t,e,r)},_processUrl:function(i,t){if(this._isMVTRequest(i))return i;if(i.indexOf(".json")===-1&&!t.withoutFormatSuffix)if(i.indexOf("?")<0)i+=".json";else{var e=i.split("?");e.length===2&&(i=e[0]+".json?"+e[1])}return t&&t.proxy&&(typeof t.proxy=="function"?i=t.proxy(i):(i=decodeURIComponent(i),i=t.proxy+encodeURIComponent(i))),i},_fetch:function(i,t,e,r){return e=e||{},e.headers=e.headers||{},!e.headers["Content-Type"]&&!FormData.prototype.isPrototypeOf(t)&&(e.headers["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8"),e.timeout?this._timeout(e.timeout,Kt(i,{method:r,headers:e.headers,body:r==="PUT"||r==="POST"?t:void 0,credentials:this._getWithCredentials(e),mode:"cors",timeout:Qt()}).then(function(n){return n})):Kt(i,{method:r,body:r==="PUT"||r==="POST"?t:void 0,headers:e.headers,credentials:this._getWithCredentials(e),mode:"cors",timeout:Qt()}).then(function(n){return n})},_getWithCredentials:function(i){return i.withCredentials===!0?"include":i.withCredentials===!1?"omit":"same-origin"},_fetchJsonp:function(i,t){return t=t||{},ee(i,{method:"GET",timeout:t.timeout}).then(function(e){return e})},_timeout:function(i,t){return new Promise(function(e,r){setTimeout(function(){r(new Error("timeout"))},i),t.then(e,r)})},_getParameterString:function(i){var t=[];for(var e in i){var r=i[e];if(r!=null&&typeof r!="function"){var n;Array.isArray(r)||r.toString()==="[object Object]"?n=encodeURIComponent(JSON.stringify(r)):n=encodeURIComponent(r),t.push(encodeURIComponent(e)+"="+n)}}return t.join("&")},_isMVTRequest:function(i){return i.indexOf(".mvt")>-1||i.indexOf(".pbf")>-1}};class Lt{constructor(t,e){this.value=t||"",this.name=e||"token",this.CLASS_NAME="SuperMap.Credential"}getUrlParameters(){return this.name+"="+this.value}getValue(){return this.value}destroy(){this.value=null,this.name=null}}Lt.CREDENTIAL=null;class Y{static generateToken(t,e){var r=this.servers[t];if(r)return j.post(r.tokenServiceUrl,JSON.stringify(e.toJSON())).then(function(n){return n.text()})}static registerServers(t){this.servers=this.servers||{},S.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var r=t[e];this.servers[r.server]=r}}static registerToken(t,e){if(this.tokens=this.tokens||{},!(!t||!e)){var r=this._getTokenStorageKey(t);this.tokens[r]=e}}static registerKey(t,e){if(this.keys=this.keys||{},!(!t||t.length<1||!e)){t=S.isArray(t)?t:[t];for(var r=0;r<t.length;r++){var n=this._getUrlRestString(t[0])||t[0];this.keys[n]=e}}}static getServerInfo(t){return this.servers=this.servers||{},this.servers[t]}static getToken(t){if(t){this.tokens=this.tokens||{};var e=this._getTokenStorageKey(t);return this.tokens[e]}}static getKey(t){this.keys=this.keys||{};var e=this._getUrlRestString(t)||t;return this.keys[e]}static loginiServer(t,e,r,n){t=S.urlPathAppend(t,"services/security/login");var s={username:e&&e.toString(),password:r&&r.toString(),rememberme:n};s=JSON.stringify(s);var o={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}};return j.post(t,s,o).then(function(a){return a.json()})}static logoutiServer(t){t=S.urlPathAppend(t,"services/security/logout");var e={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withoutFormatSuffix:!0};return j.get(t,"",e).then(function(){return!0}).catch(function(){return!1})}static loginOnline(t,e){var r=Y.SSO+"/login?service="+t;this._open(r,e)}static loginiPortal(t,e,r){t=S.urlPathAppend(t,"web/login");var n={username:e&&e.toString(),password:r&&r.toString()};n=JSON.stringify(n);var s={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!1};return j.post(t,n,s).then(function(o){return o.json()})}static logoutiPortal(t){t=S.urlPathAppend(t,"services/security/logout");var e={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!0,withoutFormatSuffix:!0};return j.get(t,"",e).then(function(){return!0}).catch(function(){return!1})}static loginManager(t,e){var r=S.urlPathAppend(t,"/security/tokens"),n=e||{},s={username:n.userName&&n.userName.toString(),password:n.password&&n.password.toString()};s=JSON.stringify(s);var o={headers:{Accept:"*/*","Content-Type":"application/json; charset=UTF-8"}},a=this;return j.post(r,s,o).then(function(l){return l.text()}).then(function(l){return a.imanagerToken=l,l})}static destroyAllCredentials(){this.keys=null,this.tokens=null,this.servers=null}static destroyToken(t){if(t){var e=this._getTokenStorageKey(t);this.tokens=this.tokens||{},this.tokens[e]&&delete this.tokens[e]}}static destroyKey(t){if(t){this.keys=this.keys||{};var e=this._getUrlRestString(t)||t;this.keys[e]&&delete this.keys[e]}}static appendCredential(t){var e=t,r=this.getToken(t),n=r?new Lt(r,"token"):null;return n||(r=this.getKey(t),n=r?new Lt(r,"key"):null),n&&(e=S.urlAppend(e,n.getUrlParameters())),e}static _open(t,e){e=e??!0;var r=window.screen.availWidth/2-this.INNER_WINDOW_WIDTH/2,n=window.screen.availHeight/2-this.INNER_WINDOW_HEIGHT/2,s="height="+this.INNER_WINDOW_HEIGHT+", width="+this.INNER_WINDOW_WIDTH+",top="+n+", left="+r+",toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no";e?window.open(t,"login"):window.open(t,"login",s)}static _getTokenStorageKey(t){var e=/(.*?):\/\/([^\/]+)/i,r=t.match(e);return r?r[0]:t}static _getUrlRestString(t){if(!t)return t;var e=/(http|https):\/\/(.*\/rest)/i,r=t.match(e);return r?r[0]:t}}Y.INNER_WINDOW_WIDTH=600;Y.INNER_WINDOW_HEIGHT=600;Y.SSO="https://sso.supermap.com";Y.ONLINE="https://www.supermapol.com";var F={LINE:"LINE",LINEM:"LINEM",POINT:"POINT",REGION:"REGION",POINTEPS:"POINTEPS",LINEEPS:"LINEEPS",REGIONEPS:"REGIONEPS",ELLIPSE:"ELLIPSE",CIRCLE:"CIRCLE",TEXT:"TEXT",RECTANGLE:"RECTANGLE",UNKNOWN:"UNKNOWN",GEOCOMPOUND:"GEOCOMPOUND"},Q={METER:"METER",KILOMETER:"KILOMETER",MILE:"MILE",YARD:"YARD",DEGREE:"DEGREE",MILLIMETER:"MILLIMETER",CENTIMETER:"CENTIMETER",INCH:"INCH",DECIMETER:"DECIMETER",FOOT:"FOOT",SECOND:"SECOND",MINUTE:"MINUTE",RADIAN:"RADIAN"};class Rt{constructor(t,e){this.w=t?parseFloat(t):0,this.h=t?parseFloat(e):0,this.CLASS_NAME="SuperMap.Size"}toString(){return"w="+this.w+",h="+this.h}clone(){return new Rt(this.w,this.h)}equals(t){var e=!1;return t!=null&&(e=this.w===t.w&&this.h===t.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(t.w)&&isNaN(t.h)),e}destroy(){this.w=null,this.h=null}}class nt{constructor(t,e,r){this.x=t?parseFloat(t):0,this.y=e?parseFloat(e):0,this.mode=r,this.CLASS_NAME="SuperMap.Pixel"}toString(){return"x="+this.x+",y="+this.y}clone(){return new nt(this.x,this.y,this.mode)}equals(t){var e=!1;return t!=null&&(e=this.x==t.x&&this.y==t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),e}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}add(t,e){if(t==null||e==null)throw new TypeError("Pixel.add cannot receive null values");return new nt(this.x+t,this.y+e)}offset(t){var e=this.clone();return t&&(e=this.add(t.x,t.y)),e}destroy(){this.x=null,this.y=null,this.mode=null}}nt.Mode={LeftTop:"lefttop",RightTop:"righttop",RightBottom:"rightbottom",LeftBottom:"leftbottom"};class et{constructor(t,e){S.isArray(t)&&(e=t[1],t=t[0]),this.lon=t?S.toFloat(t):0,this.lat=e?S.toFloat(e):0,this.CLASS_NAME="SuperMap.LonLat"}toString(){return"lon="+this.lon+",lat="+this.lat}toShortString(){return this.lon+","+this.lat}clone(){return new et(this.lon,this.lat)}add(t,e){if(t==null||e==null)throw new TypeError("LonLat.add cannot receive null values");return new et(this.lon+S.toFloat(t),this.lat+S.toFloat(e))}equals(t){var e=!1;return t!=null&&(e=this.lon===t.lon&&this.lat===t.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(t.lon)&&isNaN(t.lat)),e}wrapDateLine(t){var e=this.clone();if(t){for(;e.lon<t.left;)e.lon+=t.getWidth();for(;e.lon>t.right;)e.lon-=t.getWidth()}return e}destroy(){this.lon=null,this.lat=null}static fromString(t){var e=t.split(",");return new et(e[0],e[1])}static fromArray(t){var e=S.isArray(t),r=e&&t[0],n=e&&t[1];return new et(r,n)}}class D{constructor(t,e,r,n){S.isArray(t)&&(n=t[3],r=t[2],e=t[1],t=t[0]),this.left=t!=null?S.toFloat(t):this.left,this.bottom=e!=null?S.toFloat(e):this.bottom,this.right=r!=null?S.toFloat(r):this.right,this.top=n!=null?S.toFloat(n):this.top,this.centerLonLat=null,this.CLASS_NAME="SuperMap.Bounds"}clone(){return new D(this.left,this.bottom,this.right,this.top)}equals(t){var e=!1;return t!=null&&(e=this.left===t.left&&this.right===t.right&&this.top===t.top&&this.bottom===t.bottom),e}toString(){return[this.left,this.bottom,this.right,this.top].join(",")}toArray(t){return t===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]}toBBOX(t,e){t==null&&(t=6);var r=Math.pow(10,t),n=Math.round(this.left*r)/r,s=Math.round(this.bottom*r)/r,o=Math.round(this.right*r)/r,a=Math.round(this.top*r)/r;return e===!0?s+","+n+","+a+","+o:n+","+s+","+o+","+a}getWidth(){return this.right-this.left}getHeight(){return this.top-this.bottom}getSize(){return new Rt(this.getWidth(),this.getHeight())}getCenterPixel(){return new nt((this.left+this.right)/2,(this.bottom+this.top)/2)}getCenterLonLat(){return this.centerLonLat||(this.centerLonLat=new et((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat}scale(t,e){t=t||1,e==null&&(e=this.getCenterLonLat());var r,n;e.CLASS_NAME==="SuperMap.LonLat"?(r=e.lon,n=e.lat):(r=e.x,n=e.y);var s=(this.left-r)*t+r,o=(this.bottom-n)*t+n,a=(this.right-r)*t+r,l=(this.top-n)*t+n;return new D(s,o,a,l)}add(t,e){if(t==null||e==null)throw new TypeError("Bounds.add cannot receive null values");return new D(this.left+t,this.bottom+e,this.right+t,this.top+e)}extend(t){var e=null;if(t){switch(t.CLASS_NAME){case"SuperMap.LonLat":e=new D(t.lon,t.lat,t.lon,t.lat);break;case"SuperMap.Geometry.Point":e=new D(t.x,t.y,t.x,t.y);break;case"SuperMap.Bounds":e=t;break}e&&(this.centerLonLat=null,(this.left==null||e.left<this.left)&&(this.left=e.left),(this.bottom==null||e.bottom<this.bottom)&&(this.bottom=e.bottom),(this.right==null||e.right>this.right)&&(this.right=e.right),(this.top==null||e.top>this.top)&&(this.top=e.top))}}containsLonLat(t,e){typeof e=="boolean"&&(e={inclusive:e}),e=e||{};var r=this.contains(t.lon,t.lat,e.inclusive),n=e.worldBounds;if(n&&!r){var s=n.getWidth(),o=(n.left+n.right)/2,a=Math.round((t.lon-o)/s);r=this.containsLonLat({lon:t.lon-a*s,lat:t.lat},{inclusive:e.inclusive})}return r}containsPixel(t,e){return this.contains(t.x,t.y,e)}contains(t,e,r){if(r==null&&(r=!0),t==null||e==null)return!1;var n=!1;return r?n=t>=this.left&&t<=this.right&&e>=this.bottom&&e<=this.top:n=t>this.left&&t<this.right&&e>this.bottom&&e<this.top,n}intersectsBounds(t,e){if(typeof e=="boolean"&&(e={inclusive:e}),e=e||{},e.worldBounds){var r=this.wrapDateLine(e.worldBounds);t=t.wrapDateLine(e.worldBounds)}else r=this;e.inclusive==null&&(e.inclusive=!0);var n=!1,s=r.left===t.right||r.right===t.left||r.top===t.bottom||r.bottom===t.top;if(e.inclusive||!s){var o=t.bottom>=r.bottom&&t.bottom<=r.top||r.bottom>=t.bottom&&r.bottom<=t.top,a=t.top>=r.bottom&&t.top<=r.top||r.top>t.bottom&&r.top<t.top,l=t.left>=r.left&&t.left<=r.right||r.left>=t.left&&r.left<=t.right,c=t.right>=r.left&&t.right<=r.right||r.right>=t.left&&r.right<=t.right;n=(o||a)&&(l||c)}if(e.worldBounds&&!n){var h=e.worldBounds,y=h.getWidth(),g=!h.containsBounds(r),v=!h.containsBounds(t);g&&!v?(t=t.add(-y,0),n=r.intersectsBounds(t,{inclusive:e.inclusive})):v&&!g&&(r=r.add(-y,0),n=t.intersectsBounds(r,{inclusive:e.inclusive}))}return n}containsBounds(t,e,r){e==null&&(e=!1),r==null&&(r=!0);var n=this.contains(t.left,t.bottom,r),s=this.contains(t.right,t.bottom,r),o=this.contains(t.left,t.top,r),a=this.contains(t.right,t.top,r);return e?n||s||o||a:n&&s&&o&&a}determineQuadrant(t){var e="",r=this.getCenterLonLat();return e+=t.lat<r.lat?"b":"t",e+=t.lon<r.lon?"l":"r",e}wrapDateLine(t,e){e=e||{};var r=e.leftTolerance||0,n=e.rightTolerance||0,s=this.clone();if(t){for(var o=t.getWidth();s.left<t.left&&s.right-n<=t.left;)s=s.add(o,0);for(;s.left+r>=t.right&&s.right>t.right;)s=s.add(-o,0);var a=s.left+r;a<t.right&&a>t.left&&s.right-n>t.right&&(s=s.add(-o,0))}return s}toServerJSONObject(){var t={rightTop:{x:this.right,y:this.top},leftBottom:{x:this.left,y:this.bottom},left:this.left,right:this.right,top:this.top,bottom:this.bottom};return t}destroy(){this.left=null,this.right=null,this.top=null,this.bottom=null,this.centerLonLat=null}static fromString(t,e){var r=t.split(",");return D.fromArray(r,e)}static fromArray(t,e){return e===!0?new D(t[1],t[0],t[3],t[2]):new D(t[0],t[1],t[2],t[3])}static fromSize(t){return new D(0,t.h,t.w,0)}static oppositeQuadrant(t){var e="";return e+=t.charAt(0)==="t"?"b":"t",e+=t.charAt(1)==="l"?"r":"l",e}}class L extends ot{constructor(t,e,r,n){super(t,e,r,n),this.x=parseFloat(t),this.y=parseFloat(e),this.tag=n||n==0?parseFloat(n):null,this.type=r||"Point",this.CLASS_NAME="SuperMap.Geometry.Point",this.geometryType="Point"}clone(t){return t==null&&(t=new L(this.x,this.y)),S.applyDefaults(t,this),t}calculateBounds(){this.bounds=new D(this.x,this.y,this.x,this.y)}equals(t){var e=!1;return t!=null&&(e=this.x===t.x&&this.y===t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),e}move(t,e){this.x=this.x+t,this.y=this.y+e,this.clearBounds()}toShortString(){return this.x+", "+this.y}destroy(){this.x=null,this.y=null,this.tag=null,super.destroy()}getVertices(){return[this]}}class W extends ot{constructor(t){super(),this.components=[],this.componentTypes=null,t!=null&&this.addComponents(t),this.CLASS_NAME="SuperMap.Geometry.Collection",this.geometryType="Collection"}destroy(){this.components.length=0,this.components=null,super.destroy()}clone(){for(var t=new W,e=0,r=this.components.length;e<r;e++)t.addComponent(this.components[e].clone());return S.applyDefaults(t,this),t}getComponentsString(){for(var t=[],e=0,r=this.components.length;e<r;e++)t.push(this.components[e].toShortString());return t.join(",")}calculateBounds(){this.bounds=null;var t=new D,e=this.components;if(e)for(var r=0,n=e.length;r<n;r++)t.extend(e[r].getBounds());t.left!=null&&t.bottom!=null&&t.right!=null&&t.top!=null&&this.setBounds(t)}addComponents(t){S.isArray(t)||(t=[t]);for(var e=0,r=t.length;e<r;e++)this.addComponent(t[e])}addComponent(t,e){var r=!1;if(t&&(this.componentTypes==null||S.indexOf(this.componentTypes,t.CLASS_NAME)>-1)){if(e!=null&&e<this.components.length){var n=this.components.slice(0,e),s=this.components.slice(e,this.components.length);n.push(t),this.components=n.concat(s)}else this.components.push(t);t.parent=this,this.clearBounds(),r=!0}return r}removeComponents(t){var e=!1;S.isArray(t)||(t=[t]);for(var r=t.length-1;r>=0;--r)e=this.removeComponent(t[r])||e;return e}removeComponent(t){return S.removeItem(this.components,t),this.clearBounds(),!0}getArea(){for(var t=0,e=0,r=this.components.length;e<r;e++)t+=this.components[e].getArea();return t}equals(t){var e=!0;if(!t||!t.CLASS_NAME||this.CLASS_NAME!==t.CLASS_NAME)e=!1;else if(!S.isArray(t.components)||t.components.length!==this.components.length)e=!1;else for(var r=0,n=this.components.length;r<n;++r)if(!this.components[r].equals(t.components[r])){e=!1;break}return e}getVertices(t){for(var e=[],r=0,n=this.components.length;r<n;++r)Array.prototype.push.apply(e,this.components[r].getVertices(t));return e}}class ct extends W{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point"],this.CLASS_NAME="SuperMap.Geometry.MultiPoint",this.geometryType="MultiPoint"}addPoint(t,e){this.addComponent(t,e)}removePoint(t){this.removeComponent(t)}}class Ue extends ct{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point","SuperMap.PointWithMeasure"],this.CLASS_NAME="SuperMap.Geometry.Curve",this.geometryType="Curve"}}class N extends Ue{constructor(t){super(t),this.CLASS_NAME="SuperMap.Geometry.LineString",this.geometryType="LineString"}removeComponent(t){var e=this.components&&this.components.length>2;return e&&super.removeComponent.apply(this,arguments),e}getSortedSegments(){for(var t=this.components.length-1,e=new Array(t),r,n,s=0;s<t;++s)r=this.components[s],n=this.components[s+1],r.x<n.x?e[s]={x1:r.x,y1:r.y,x2:n.x,y2:n.y}:e[s]={x1:n.x,y1:n.y,x2:r.x,y2:r.y};function o(a,l){return a.x1-l.x1}return e.sort(o)}getVertices(t){var e;return t===!0?e=[this.components[0],this.components[this.components.length-1]]:t===!1?e=this.components.slice(1,this.components.length-1):e=this.components.slice(),e}static calculateCircle(t){if(t.length<3)return t;var e={},r=t[0],n=t[1],s=t[2],o=0,a=0,l=!0,c=0,h=0,y=0,g=72,v=[],w=(s.y-r.y)/(s.x-r.x),T=s.y-w*s.x;if(s.x!=r.x&&s.y!=r.y&&n.y==w*n.x+T||s.x==r.x&&n.x==r.x||s.y==r.y&&n.y==r.y||s.x==r.x&&s.y==r.y||s.x==n.x&&s.y==n.y||r.x==n.x&&r.y==n.y)v.push(r),v.push(n),v.push(s);else{var f=(n.x*n.x+n.y*n.y-(r.x*r.x+r.y*r.y))*(2*(s.y-r.y))-(s.x*s.x+s.y*s.y-(r.x*r.x+r.y*r.y))*(2*(n.y-r.y)),m=2*(n.x-r.x)*(s.x*s.x+s.y*s.y-(r.x*r.x+r.y*r.y))-2*(s.x-r.x)*(n.x*n.x+n.y*n.y-(r.x*r.x+r.y*r.y)),u=4*((n.x-r.x)*(s.y-r.y)-(s.x-r.x)*(n.y-r.y));e.x=f/u,e.y=m/u,o=Math.sqrt((r.x-e.x)*(r.x-e.x)+(r.y-e.y)*(r.y-e.y));var d=(r.x-s.x)*(r.x-s.x)+(r.y-s.y)*(r.y-s.y),_=(2*o*o-d)/(2*o*o);_=_>=1?1:_,_=_<=-1?-1:_,y=Math.acos(_)*180/Math.PI,s.x==r.x?y=e.x>r.x&&n.x>r.x||e.x<r.x&&n.x<r.x?360-y:y:y=e.y>w*e.x+T&&n.y>w*n.x+T||e.y<w*e.x+T&&n.y<w*n.x+T?360-y:y,a=y/72,s.y!=r.y?s.x==r.x?s.y>r.y?n.x<r.x&&(l=!1):n.x>r.x&&(l=!1):s.x<r.x?n.y<w*n.x+T&&(l=!1):n.y>w*n.x+T&&(l=!1):s.x>r.x?n.y>r.y&&(l=!1):n.y<r.y&&(l=!1);var A=(r.y-e.y)/(r.x-e.x),I=A>=0?Math.atan(A)*180/Math.PI:Math.abs(Math.atan(A)*180/Math.PI)+90,C=Math.abs(e.y);r.y==C&&C==s.y&&r.x<s.x&&(I=I+180);var P=r.y-e.y;v.push(r);for(var E=1;E<g;E++){c=a*E,h=I,l?P>=0?A>=0?h=h+c:h=180-(h-90)+c:A>0?h=h-180+c:h=90-h+c:P>=0?A>=0?h=h-c:h=180-(h-90)-c:A>=0?h=h-180-c:h=90-h-c,h=h*Math.PI/180;var k=e.x+o*Math.cos(h),G=e.y+o*Math.sin(h);v.push(new L(k,G))}v.push(s)}return v}static createLineEPS(t){var e=[],r=t.length;if(r<2)return t;for(var n=0;n<r;){var s=t[n].type;if(s=="LTypeArc"){var o=N.createLineArc(e,n,r,t);e=o[0],n=o[1]}else e.push(t[n]),n++}return e}static createLineArc(t,e,r,n){if(e==0){let a=N.addPointEPS(n,e,r,"LTypeArc");Array.prototype.push.apply(t,a[0]),e=a[1]+1}else if(e==r-1){var s=[n[e-1],n[e]],o=N.calculateCircle(s);Array.prototype.push.apply(t,o),e++}else{let a=N.addPointEPS(n,e,r,"LTypeArc");t.pop(),Array.prototype.push.apply(t,a[0]),e=a[1]+1}return[t,e]}static addPointEPS(t,e,r,n){var s=[],o=e+1;e==0?Array.prototype.push.apply(s,[t[e],t[e+1]]):e==r-1?Array.prototype.push.apply(s,[t[e-1],t[e]]):Array.prototype.push.apply(s,[t[e-1],t[e],t[e+1]]);var a;return n=="LTypeCurve"?a=N.calculatePointsFBZN(s):n=="LTypeArc"&&(a=N.calculateCircle(s)),[a,o]}}class q extends N{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point"],this.CLASS_NAME="SuperMap.Geometry.LinearRing",this.geometryType="LinearRing"}addComponent(t,e){var r=!1,n=this.components.pop();(e!=null||!t.equals(n))&&(r=super.addComponent.apply(this,arguments));var s=this.components[0];return super.addComponent.apply(this,[s]),r}removeComponent(t){var e=this.components&&this.components.length>3;if(e){this.components.pop(),super.removeComponent.apply(this,arguments);var r=this.components[0];super.addComponent.apply(this,[r])}return e}getArea(){var t=0;if(this.components&&this.components.length>2){for(var e=0,r=0,n=this.components.length;r<n-1;r++){var s=this.components[r],o=this.components[r+1];e+=(s.x+o.x)*(o.y-s.y)}t=-e/2}return t}getVertices(t){return t===!0?[]:this.components.slice(0,this.components.length-1)}}class ft extends W{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.LineString"],this.CLASS_NAME="SuperMap.Geometry.MultiLineString",this.geometryType="MultiLineString"}}class B extends W{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.LinearRing"],this.CLASS_NAME="SuperMap.Geometry.Polygon",this.geometryType="Polygon"}getArea(){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getArea());for(var e=1,r=this.components.length;e<r;e++)t-=Math.abs(this.components[e].getArea())}return t}}class tt extends W{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Polygon"],this.CLASS_NAME="SuperMap.Geometry.MultiPolygon",this.geometryType="MultiPolygon"}}class K{constructor(t,e,r){this.red=!t&&t!=0?255:t,this.green=e||0,this.blue=r||0,this.CLASS_NAME="SuperMap.ServerColor"}destroy(){var t=this;t.red=null,t.green=null,t.blue=null}static fromJson(t){if(t){var e=new K,r=255;t.red!==null&&(r=Number(t.red)),e.red=r;var n=0;t.green!==null&&(n=Number(t.green)),e.green=n;var s=0;return t.blue!==null&&(s=Number(t.blue)),e.blue=s,e}}}class Nt{constructor(t){this.fillBackColor=new K(255,255,255),this.fillBackOpaque=!1,this.fillForeColor=new K(255,0,0),this.fillGradientMode=null,this.fillGradientAngle=0,this.fillGradientOffsetRatioX=0,this.fillGradientOffsetRatioY=0,this.fillOpaqueRate=100,this.fillSymbolID=0,this.lineColor=new K(0,0,0),this.lineSymbolID=0,this.lineWidth=1,this.markerAngle=0,this.markerSize=1,this.markerSymbolID=-1,t&&S.extend(this,t),this.CLASS_NAME="SuperMap.ServerStyle"}destroy(){var t=this;t.fillBackColor&&(t.fillBackColor.destroy(),t.fillBackColor=null),t.fillBackOpaque=null,t.fillForeColor&&(t.fillForeColor.destroy(),t.fillForeColor=null),t.fillGradientMode=null,t.fillGradientAngle=null,t.fillGradientOffsetRatioX=null,t.fillGradientOffsetRatioY=null,t.fillOpaqueRate=null,t.fillSymbolID=null,t.lineColor&&(t.lineColor.destroy(),t.lineColor=null),t.lineSymbolID=null,t.lineWidth=null,t.markerAngle=null,t.markerSize=null,t.markerSymbolID=null}toServerJSONObject(){var t={};return t=S.copyAttributes(t,this),t}static fromJson(t){if(t)return new Nt({fillBackColor:K.fromJson(t.fillBackColor),fillBackOpaque:t.fillBackOpaque,fillForeColor:K.fromJson(t.fillForeColor),fillGradientMode:t.fillGradientMode,fillGradientAngle:t.fillGradientAngle,fillGradientOffsetRatioX:t.fillGradientOffsetRatioX,fillGradientOffsetRatioY:t.fillGradientOffsetRatioY,fillOpaqueRate:t.fillOpaqueRate,fillSymbolID:t.fillSymbolID,lineColor:K.fromJson(t.lineColor),lineSymbolID:t.lineSymbolID,lineWidth:t.lineWidth,markerAngle:t.markerAngle,markerSize:t.markerSize,markerSymbolID:t.markerSymbolID})}}class Mt extends L{constructor(t){super(t),this.measure=null,t&&S.extend(this,t),this.CLASS_NAME="SuperMap.PointWithMeasure"}equals(t){var e=!1;if(t!=null){var r=this.x===t.x&&this.y===t.y&&this.measure===t.measure,n=isNaN(this.x)&&isNaN(this.y)&&isNaN(this.measure),s=isNaN(t.x)&&isNaN(t.y)&&isNaN(t.measure);e=r||n&&s}return e}toJson(){var t="{";return this.measure!=null&&this.measure!=null&&(t+='"measure":'+this.measure+","),t+='"x":'+this.x+",",t+='"y":'+this.y,t+="}",t}destroy(){var t=this;t.measure=null,t.x=null,t.y=null}static fromJson(t){if(t)return new Mt({x:t.x,y:t.y,measure:t.measure})}}class Ft extends W{constructor(t,e){super(t,e),this.id=null,this.center=null,this.style=null,this.length=null,this.maxM=null,this.minM=null,this.parts=null,this.points=null,this.type=null,this.componentTypes=["SuperMap.Geometry.LinearRing","SuperMap.Geometry.LineString"],e&&S.extend(this,e),this.CLASS_NAME="SuperMap.Route",this.geometryType="LINEM"}toJson(){var t="{";if(this.id!=null&&this.id!=null&&(t+='"id":'+this.id+","),this.center!=null&&this.center!=null&&(t+='"center":'+this.center+","),this.style!=null&&this.style!=null&&(t+='"style":'+this.style+","),this.length!=null&&this.length!=null&&(t+='"length":'+this.length+","),this.maxM!=null&&this.maxM!=null&&(t+='"maxM":'+this.maxM+","),this.minM!=null&&this.minM!=null&&(t+='"minM":'+this.minM+","),this.type!=null&&this.type!=null&&(t+='"type":"'+this.type+'",'),this.parts!=null&&this.parts!=null){t+='"parts":['+this.parts[0];for(var e=1;e<this.parts.length;e++)t+=","+this.parts[e];t+="],"}if(this.components!=null&&this.components.length>0){t+='"points":[';for(var r=0,n=this.components.length;r<n;r++)for(var s=0,o=this.components[r].components.length;s<o;s++)t+=this.components[r].components[s].toJson()+",";t=t.replace(/,$/g,""),t+="]"}return t=t.replace(/,$/g,""),t+="}",t}destroy(){var t=this;t.id=null,t.center=null,t.style=null,t.length=null,t.maxM=null,t.minM=null,t.type=null,t.parts=null,t.components.length=0,t.components=null,t.componentTypes=null}static fromJson(t){if(t){var e=t.parts||[],r=t.points||[],n=e.length,s=[];if(n>0)for(var o=0,a=0,l=[];o<n;o++){for(var c=0;c<e[o];c++)l.push(Mt.fromJson(r[a+c]));a+=e[o],l[0].equals(l[e[o]-1])?s.push(new q(l)):s.push(new N(l)),l=[]}else return null;return new Ft(s,{id:t.id,center:t.center,style:t.style,length:t.length,maxM:t.maxM,minM:t.minM,type:t.type,parts:t.parts})}}}class z{constructor(t){this.id=0,this.style=null,this.parts=null,this.points=null,this.type=null,this.prjCoordSys=null,t&&S.extend(this,t),this.CLASS_NAME="SuperMap.ServerGeometry"}destroy(){var t=this;t.id=null,t.style=null,t.parts=null,t.partTopo=null,t.points=null,t.type=null,t.prjCoordSys=null}toGeometry(){var t=this,e=t.type;switch(e.toUpperCase()){case F.POINT:return t.toGeoPoint();case F.LINE:return t.toGeoLine();case F.LINEM:return t.toGeoLinem();case F.REGION:return t.toGeoRegion();case F.POINTEPS:return t.toGeoPoint();case F.LINEEPS:return t.toGeoLineEPS();case F.REGIONEPS:return t.toGeoRegionEPS();case F.GEOCOMPOUND:return t.transformGeoCompound()}}toGeoPoint(){var t=this,e=t.parts||[],r=t.points||[],n=e.length;if(n>0){if(n===1)return new L(r[0].x,r[0].y);var s=[];for(let o=0;o<n;o++)s.push(new L(r[o].x,r[o].y));return new ct(s)}else return null}toGeoLine(){var t=this,e=t.parts||[],r=t.points||[],n=e.length;if(n>0)if(n===1){let s=[];for(let o=0;o<e[0];o++)s.push(new L(r[o].x,r[o].y));return s[0].equals(s[e[0]-1])?new q(s):new N(s)}else{let s=[];for(let o=0;o<n;o++){let a=[];for(let l=0;l<e[o];l++)a.push(new L(r[l].x,r[l].y));s.push(new N(a)),r.splice(0,e[o])}return new ft(s)}else return null}toGeoLineEPS(){var t=this,e=t.parts||[],r=t.points||[],n,s,o,a,l,c=e.length;if(c>0)if(c===1){for(n=0,o=[];n<e[0];n++)o.push(new L(r[n].x,r[n].y,r[n].type));return o[0].equals(o[e[0]-1])?(l=N.createLineEPS(o),new q(l)):(l=N.createLineEPS(o),new N(l))}else{for(n=0,a=[];n<c;n++){for(s=0,o=[];s<e[n];s++)o.push(new L(r[s].x,r[s].y));l=N.createLineEPS(o),a.push(new N(l)),r.splice(0,e[n])}return new ft(a)}else return null}toGeoLinem(){var t=this;return Ft.fromJson(t)}toGeoRegion(){var t=this,e=t.parts||[],r=t.partTopo||[],n=t.points||[],s=e.length;if(s<=0)return null;var o=[],a=[];if(s==1){for(let f=0;f<n.length;f++)a.push(new L(n[f].x,n[f].y));return o.push(new B([new q(a)])),new tt(o)}var l=[],c=[],h=[],y=[],g=[];for(let f=0,m=0;f<s;f++){for(let u=0;u<e[f];u++)a.push(new L(n[m+u].x,n[m+u].y));m+=e[f];var v=new B([new q(a)]);a=[],h.push(v),r.length===0&&y.push(v.getBounds()),g.push(1),c.push(v.getArea())}if(r.length===0){z.bubbleSort(c,h,r,y);var w=[];for(let f=1;f<h.length;f++)for(let m=f-1;m>=0;m--)if(w[f]=-1,y[m].containsBounds(y[f])){g[f]=g[m]*-1,g[f]<0&&(w[f]=m);break}for(let f=0;f<h.length;f++)g[f]>0?o.push(h[f]):(o[w[f]].components=o[w[f]].components.concat(h[f].components),o.push(""))}else{o=new Array;for(let f=0;f<h.length;f++)if(r[f]&&r[f]==-1?l=l.concat(h[f].components):(l.length>0&&o.length>0&&(o[o.length-1].components=o[o.length-1].components.concat(l),l=[]),o.push(h[f])),f==s-1){var T=o.length;if(T)o[T-1].components=o[T-1].components.concat(l);else for(let m=0,u=l.length;m<u;m++)o.push(new B(l))}}return new tt(o)}toGeoRegionEPS(){var t=this,e=t.parts||[],r=t.partTopo||[],n=t.points||[],s=e.length;if(s<=0)return null;var o=[],a=[],l;if(s==1){for(var c=0;c<n.length;c++)a.push(new L(n[c].x,n[c].y));return l=N.createLineEPS(a),o.push(new B([new q(l)])),new tt(o)}var h=[],y=[],g=[],v=[],w=[];for(let u=0,d=0;u<s;u++){for(let _=0;_<e[u];_++)a.push(new L(n[d+_].x,n[d+_].y));d+=e[u],l=N.createLineEPS(a);var T=new B([new q(l)]);a=[],g.push(T),r.length===0&&v.push(T.getBounds()),w.push(1),y.push(T.getArea())}if(r.length===0){z.bubbleSort(y,g,r,v);var f=[];for(let u=1;u<g.length;u++)for(let d=u-1;d>=0;d--)if(f[u]=-1,v[d].containsBounds(v[u])){w[u]=w[d]*-1,w[u]<0&&(f[u]=d);break}for(let u=0;u<g.length;u++)w[u]>0?o.push(g[u]):(o[f[u]].components=o[f[u]].components.concat(g[u].components),o.push(""))}else{o=new Array;for(let u=0;u<g.length;u++)if(r[u]&&r[u]==-1?h=h.concat(g[u].components):(h.length>0&&o.length>0&&(o[o.length-1].components=o[o.length-1].components.concat(h),h=[]),o.push(g[u])),u==s-1){var m=o.length;if(m)o[m-1].components=o[m-1].components.concat(h);else for(let d=0,_=h.length;d<_;d++)o.push(new B(h))}}return new tt(o)}transformGeoCompound(){const t=this,e=t.geoParts||[],r=e.length;if(r<=0)return null;const n=[];for(let s=0;s<r;s++){const o=e[s];n.push(new z(o).toGeometry())}return new W(n)}static fromJson(t){if(t)return new z({id:t.id,style:Nt.fromJson(t.style),parts:t.parts,partTopo:t.partTopo,points:t.points,center:t.center,length:t.length,maxM:t.maxM,minM:t.minM,type:t.type})}static fromGeometry(t){if(t){var e=0,r=[],n=[],s=null,o=t.components,a=t.CLASS_NAME,l={epsgCode:t.SRID};if(isNaN(t.id)||(e=t.id),a!="SuperMap.Geometry.LinearRing"&&a!="SuperMap.Geometry.LineString"&&(t instanceof ct||t instanceof ft)){let c=o.length;for(let h=0;h<c;h++){const y=o[h].getVertices();let g=y.length;r.push(g);for(let v=0;v<g;v++)n.push(new L(y[v].x,y[v].y))}s=a=="SuperMap.Geometry.MultiPoint"?F.POINT:F.LINE}else if(t instanceof tt){let c=o.length;for(let h=0;h<c;h++){let y=o[h],g=y.components,v=g.length;for(let w=0;w<v;w++){const T=g[w].getVertices(),f=T.length+1;r.push(f);for(let m=0;m<f-1;m++)n.push(new L(T[m].x,T[m].y));n.push(new L(T[0].x,T[0].y))}}s=F.REGION}else if(t instanceof B){let c=o.length;for(let h=0;h<c;h++){const y=o[h].getVertices();let g=y.length+1;r.push(g);for(let v=0;v<g-1;v++)n.push(new L(y[v].x,y[v].y));n.push(new L(y[0].x,y[0].y))}s=F.REGION}else{const c=t.getVertices();let h=c.length;for(let y=0;y<h;y++)n.push(new L(c[y].x,c[y].y));t instanceof q&&(n.push(new L(c[0].x,c[0].y)),h++),r.push(h),s=t instanceof L?F.POINT:F.LINE}return new z({id:e,style:null,parts:r,points:n,type:s,prjCoordSys:l})}}static IsClockWise(t){var e=t.length;if(e<3)return 0;var r=t[0].y*(t[e-1].x-t[1].x);t.push(t[0]);for(var n=1;n<e;n++)r+=t[n].y*(t[n-1].x-t[n+1].x);return r*.5}static bubbleSort(t,e,r,n){for(var s=0;s<t.length;s++)for(var o=0;o<t.length;o++)if(t[s]>t[o]){var a=t[o];t[o]=t[s],t[s]=a;var l=e[o];if(e[o]=e[s],e[s]=l,r&&r.length>0){var c=r[o];r[o]=r[s],r[s]=c}if(n&&n.length>0){var h=n[o];n[o]=n[s],n[s]=h}}}}class qe{constructor(t,e,r){this.CLASS_NAME="SuperMap.Feature",this.layer=t,this.id=S.createUniqueID(this.CLASS_NAME+"_"),this.lonlat=e,this.data=r??{}}destroy(){this.id=null,this.lonlat=null,this.data=null}}const U={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};class st extends qe{constructor(t,e,r){super(null,null,e),this.fid=null,this.geometry=t||null,this.attributes={},e&&(this.attributes=S.extend(this.attributes,e)),this.bounds=null,this.state=null,this.style=r||null,this.url=null,this.lonlat=null,this.CLASS_NAME="SuperMap.Feature.Vector",st.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"default",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}}}destroy(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,super.destroy()}clone(){return new st(this.geometry?this.geometry.clone():null,this.attributes,this.style)}toState(t){if(t===U.UPDATE)switch(this.state){case U.UNKNOWN:case U.DELETE:this.state=t;break}else if(t===U.INSERT)switch(this.state){case U.UNKNOWN:break;default:this.state=t;break}else if(t===U.DELETE)switch(this.state){case U.INSERT:break;case U.DELETE:break;case U.UNKNOWN:case U.UPDATE:this.state=t;break}else t===U.UNKNOWN&&(this.state=t)}}class Be{constructor(t){this.data=null,this.keepData=!1,S.extend(this,t),this.options=t,this.CLASS_NAME="SuperMap.Format"}destroy(){}read(t){}write(t){}}class ze extends Be{constructor(t){super(t),this.indent="    ",this.space=" ",this.newline=`
`,this.level=0,this.pretty=!1,this.nativeJSON=function(){return!!(window.JSON&&typeof JSON.parse=="function"&&typeof JSON.stringify=="function")}(),this.CLASS_NAME="SuperMap.Format.JSON",this.serialize={object:function(e){if(e==null)return"null";if(e.constructor===Date)return this.serialize.date.apply(this,[e]);if(e.constructor===Array)return this.serialize.array.apply(this,[e]);var r=["{"];this.level+=1;var n,s,o,a=!1;for(n in e)e.hasOwnProperty(n)&&(s=this.write.apply(this,[n,this.pretty]),o=this.write.apply(this,[e[n],this.pretty]),s!=null&&o!=null&&(a&&r.push(","),r.push(this.writeNewline(),this.writeIndent(),s,":",this.writeSpace(),o),a=!0));return this.level-=1,r.push(this.writeNewline(),this.writeIndent(),"}"),r.join("")},array:function(e){var r,n=["["];this.level+=1;for(var s=0,o=e.length;s<o;++s)r=this.write.apply(this,[e[s],this.pretty]),r!=null&&(s>0&&n.push(","),n.push(this.writeNewline(),this.writeIndent(),r));return this.level-=1,n.push(this.writeNewline(),this.writeIndent(),"]"),n.join("")},string:function(e){var r={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(n,s){var o=r[s];return o||(o=s.charCodeAt(),"\\u00"+Math.floor(o/16).toString(16)+(o%16).toString(16))})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},boolean:function(e){return String(e)},date:function(e){function r(n){return n<10?"0"+n:n}return'"'+e.getFullYear()+"-"+r(e.getMonth()+1)+"-"+r(e.getDate())+"T"+r(e.getHours())+":"+r(e.getMinutes())+":"+r(e.getSeconds())+'"'}}}read(t,e){var r;if(this.nativeJSON)try{r=JSON.parse(t,e)}catch{return{data:t}}return this.keepData&&(this.data=r),r}write(t,e){this.pretty=!!e;var r=null,n=typeof t;if(this.serialize[n])try{r=!this.pretty&&this.nativeJSON?JSON.stringify(t):this.serialize[n].apply(this,[t])}catch{}return r}writeIndent(){var t=[];if(this.pretty)for(var e=0;e<this.level;++e)t.push(this.indent);return t.join("")}writeNewline(){return this.pretty?this.newline:""}writeSpace(){return this.pretty?this.space:""}}class ie extends ze{constructor(t){super(t),this.ignoreExtraDims=!0,this.CLASS_NAME="SuperMap.Format.GeoJSON",this.parseCoords={point:function(e){if(this.ignoreExtraDims===!1&&e.length!=2)throw"Only 2D points are supported: "+e;return new L(e[0],e[1])},multipoint:function(e){for(var r=[],n=null,s=0,o=e.length;s<o;++s){try{n=this.parseCoords.point.apply(this,[e[s]])}catch(a){throw a}r.push(n)}return new ct(r)},linestring:function(e){for(var r=[],n=null,s=0,o=e.length;s<o;++s){try{n=this.parseCoords.point.apply(this,[e[s]])}catch(a){throw a}r.push(n)}return new N(r)},multilinestring:function(e){for(var r=[],n=null,s=0,o=e.length;s<o;++s){try{n=this.parseCoords.linestring.apply(this,[e[s]])}catch(a){throw a}r.push(n)}return new ft(r)},polygon:function(e){for(var r=[],n,s,o=0,a=e.length;o<a;++o){try{s=this.parseCoords.linestring.apply(this,[e[o]])}catch(l){throw l}n=new q(s.components),r.push(n)}return new B(r)},multipolygon:function(e){for(var r=[],n=null,s=0,o=e.length;s<o;++s){try{n=this.parseCoords.polygon.apply(this,[e[s]])}catch(a){throw a}r.push(n)}return new tt(r)},box:function(e){if(e.length!=2)throw"GeoJSON box coordinates must have 2 elements";return new B([new q([new L(e[0][0],e[0][1]),new L(e[1][0],e[0][1]),new L(e[1][0],e[1][1]),new L(e[0][0],e[1][1]),new L(e[0][0],e[0][1])])])}},this.extract={feature:function(e){var r=this.extract.geometry.apply(this,[e.geometry]),n={type:"Feature",properties:this.createAttributes(e),geometry:r};return e.geometry&&e.geometry.type==="TEXT"&&(n.properties.texts=e.geometry.texts,n.properties.textStyle=e.geometry.textStyle),e.fid&&(n.id=e.fid),e.ID&&(n.id=e.ID),n},geometry:function(e){if(e==null)return null;!e.parts&&e.points&&(e.parts=[e.points.length]);var r=e.hasOwnProperty("geometryType")?e:new z(e).toGeometry()||e,n=r.geometryType||r.type,s;n==="LinearRing"&&(n="LineString"),n==="LINEM"&&(n="MultiLineString"),s=this.extract[n.toLowerCase()].apply(this,[r]),n=n==="TEXT"?"Point":n;var o;return n==="Collection"?o={type:"GeometryCollection",geometries:s}:o={type:n,coordinates:s},o},point:function(e){var r=[e.x,e.y];for(var n in e)n!=="x"&&n!=="y"&&e[n]!==null&&!isNaN(e[n])&&r.push(e[n]);return r},text:function(e){return[e.points[0].x,e.points[0].y]},multipoint:function(e){for(var r=[],n=0,s=e.components.length;n<s;++n)r.push(this.extract.point.apply(this,[e.components[n]]));return r},linestring:function(e){for(var r=[],n=0,s=e.components.length;n<s;++n)r.push(this.extract.point.apply(this,[e.components[n]]));return r},multilinestring:function(e){for(var r=[],n=0,s=e.components.length;n<s;++n)r.push(this.extract.linestring.apply(this,[e.components[n]]));return r},polygon:function(e){for(var r=[],n=0,s=e.components.length;n<s;++n)r.push(this.extract.linestring.apply(this,[e.components[n]]));return r},multipolygon:function(e){for(var r=[],n=0,s=e.components.length;n<s;++n)r.push(this.extract.polygon.apply(this,[e.components[n]]));return r},collection:function(e){for(var r=e.components.length,n=new Array(r),s=0;s<r;++s)n[s]=this.extract.geometry.apply(this,[e.components[s]]);return n}}}read(t,e,r){e=e||"FeatureCollection";var n=null,s=null;if(typeof t=="string"?s=super.read(t,r):s=t,s){if(typeof s.type=="string"){if(this.isValidType(s,e))switch(e){case"Geometry":try{n=this.parseGeometry(s)}catch{}break;case"Feature":try{n=this.parseFeature(s),n.type="Feature"}catch{}break;case"FeatureCollection":switch(n=[],s.type){case"Feature":try{n.push(this.parseFeature(s))}catch{n=null}break;case"FeatureCollection":for(var o=0,a=s.features.length;o<a;++o)try{n.push(this.parseFeature(s.features[o]))}catch{n=null}break;default:try{var l=this.parseGeometry(s);n.push(new st(l))}catch{n=null}}break}}}return n}write(t,e){return super.write(this.toGeoJSON(t),e)}fromGeoJSON(t,e,r){let n=this.read(t,e,r);return S.isArray(n)?n.map(s=>this._toiSevrerFeature(s)):this._toiSevrerFeature(n)}toGeoJSON(t){var e={type:null};if(S.isArray(t)){e.type="FeatureCollection";var r=t.length;e.features=new Array(r);for(var n=0;n<r;++n){var s=t[n];if(o(s)){let a={};a.geometry=s,e.features[n]=this.extract.feature.apply(this,[a])}else e.features[n]=this.extract.feature.apply(this,[s])}}else if(o(t)){let a={};a.geometry=t,e=this.extract.feature.apply(this,[a])}else e=this.extract.feature.apply(this,[t]);function o(a){return a.hasOwnProperty("parts")&&a.hasOwnProperty("points")||a.hasOwnProperty("geoParts")}return e}isValidType(t,e){var r=!1;switch(e){case"Geometry":S.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],t.type)==-1||(r=!0);break;case"FeatureCollection":r=!0;break;default:t.type==e&&(r=!0)}return r}parseFeature(t){var e,r,n,s;n=t.properties?t.properties:{},s=t.geometry&&t.geometry.bbox||t.bbox;try{r=this.parseGeometry(t.geometry)}catch(o){throw o}return e=new st(r,n),s&&(e.bounds=D.fromArray(s)),t.id&&(e.geometry.id=t.id,e.fid=t.id),e}parseGeometry(t){if(t==null)return null;var e;if(t.type=="GeometryCollection"){if(!S.isArray(t.geometries))throw"GeometryCollection must have geometries array: "+t;for(var r=t.geometries.length,n=new Array(r),s=0;s<r;++s)n[s]=this.parseGeometry.apply(this,[t.geometries[s]]);e=new W(n)}else{if(!S.isArray(t.coordinates))throw"Geometry must have coordinates array: "+t;if(!this.parseCoords[t.type.toLowerCase()])throw"Unsupported geometry type: "+t.type;try{e=this.parseCoords[t.type.toLowerCase()].apply(this,[t.coordinates])}catch(o){throw o}}return e}createCRSObject(t){var e=t.layer.projection.toString(),r={};if(e.match(/epsg:/i)){var n=parseInt(e.substring(e.indexOf(":")+1));n==4326?r={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:r={type:"name",properties:{name:"EPSG:"+n}}}return r}_toiSevrerFeature(t){const e=t.attributes,r=[],n=[];for(var s in e)r.push(s),n.push(e[s]);const o={fieldNames:r,fieldValues:n,geometry:z.fromGeometry(t.geometry)};return o.geometry.id=t.fid,o}createAttributes(t){if(!t)return null;var e={};s(t,e);var r=["fieldNames","fieldValues","geometry","stringID","ID"];for(var n in t)r.indexOf(n)>-1||(e[n]=t[n]);function s(o,a){if(o.hasOwnProperty("fieldNames")&&o.hasOwnProperty("fieldValues")){var l=o.fieldNames,c=o.fieldValues;for(var h in l)a[l[h]]=c[h]}}return e}}var Je=function(i){var t=6378137,e;if(i===Q.METER)e=1;else if(i===Q.DEGREE)e=Math.PI*2*t/360;else if(i===Q.KILOMETER)e=.001;else if(i===Q.INCH)e=1/.025399999918;else if(i===Q.FOOT)e=.3048;else return e;return e};const We={};R.Util.supermap_callbacks=We;const Ze=function(i){return i&&new ie().toGeoJSON(i)},re=function(i){if(!i)return i;let t;const e=new ie;if(["FeatureCollection","Feature","Geometry"].indexOf(i.type)!==-1)t=e.read(i,i.type);else if(typeof i.toGeoJSON=="function"){const n=i.toGeoJSON();t=n?e.read(n,n.type):i}let r=t||i;return R.Util.isArray(t)&&(t.length===1?r=t[0]:t.length>1&&(r=[],t.map(function(n){return r.push(n.geometry),n}))),r&&r.geometry?r.geometry:r},Gt=Je,ne=function(i,t,e){const r=39.37007874015748,n=Gt(e);let s=i*t*r*n;return s=1/s,s},He=function(i,t,e){const r=39.37007874015748,n=Gt(e);let s=i*t*r*n;return s=1/s,s},Ve=function(i,t,e,r){let n=null;const s=1e4;return r=r||6378137,e=e||"",i>0&&t>0?(i=R.Util.NormalizeScale(i),e.toLowerCase()==="degree"||e.toLowerCase()==="degrees"||e.toLowerCase()==="dd"?(n=.0254*s/t/i/(Math.PI*2*r/360)/s,n):(n=.0254*s/t/i/s,n)):-1},Ke=function(i){return i>1?1/i:i};R.Util.toGeoJSON=Ze;R.Util.toSuperMapGeometry=re;R.Util.resolutionToScale=ne;R.Util.scaleToResolution=He;R.Util.getMeterPerMapUnit=Gt;R.Util.GetResolutionFromScaleDpi=Ve;R.Util.NormalizeScale=Ke;const Qe=R.TileLayer.extend({options:{layersID:null,redirect:!1,transparent:!0,cacheEnabled:!0,clipRegionEnabled:!1,clipRegion:null,prjCoordSys:null,overlapDisplayed:!1,overlapDisplayedOptions:null,tileversion:null,crs:null,format:"png",tileProxy:null,attribution:"Map Data <span>© <a href='http://support.supermap.com.cn/product/iServer.aspx' title='SuperMap iServer' target='_blank'>SuperMap iServer</a></span>",subdomains:null},initialize:function(i,t){this._url=i,R.TileLayer.prototype.initialize.apply(this,arguments),R.setOptions(this,t),R.stamp(this),this.tileSetsIndex=-1,this.tempIndex=-1},onAdd:function(i){this._crs=this.options.crs||i.options.crs,R.TileLayer.prototype.onAdd.call(this,i)},getTileUrl:function(i){const t=this.getScaleFromCoords(i);let r=this._getLayerUrl()+"&scale="+t+"&x="+i.x+"&y="+i.y;return this.options.tileProxy&&(r=this.options.tileProxy+encodeURIComponent(r)),this.options.cacheEnabled||(r+="&_t="+new Date().getTime()),this.options.subdomains&&(r=R.Util.template(r,{s:this._getSubdomain(i)})),r},getScale:function(i){const t=this,e=i||t._map.getZoom();return t.scales[e]},getScaleFromCoords:function(i){const t=this;if(t.scales&&t.scales[i.z])return t.scales[i.z];t.scales=t.scales||{};const e=t.getDefaultScale(i);return t.scales[i.z]=e,e},getDefaultScale:function(i){const t=this,e=t._crs;if(e.scales)return e.scales[i.z];{const r=t._tileCoordsToBounds(i),n=e.project(r.getNorthEast()),s=e.project(r.getSouthWest()),o=t.options.tileSize,a=Math.max(Math.abs(n.x-s.x)/o,Math.abs(n.y-s.y)/o);let l=Q.METER;if(e.code){const c=e.code.split(":");if(c&&c.length>1){const h=parseInt(c[1]);l=h&&h>=4e3&&h<=5e3?Q.DEGREE:Q.METER}}return ne(a,96,l)}},setTileSetsInfo:function(i){this.tileSets=i,R.Util.isArray(this.tileSets)&&(this.tileSets=this.tileSets[0]),this.tileSets&&(this.fire("tilesetsinfoloaded",{tileVersions:this.tileSets.tileVersions}),this.changeTilesVersion())},lastTilesVersion:function(){this.tempIndex=this.tileSetsIndex-1,this.changeTilesVersion()},nextTilesVersion:function(){this.tempIndex=this.tileSetsIndex+1,this.changeTilesVersion()},changeTilesVersion:function(){const i=this;if(i.tileSets==null||i.tempIndex===i.tileSetsIndex||this.tempIndex<0)return;const t=i.tileSets.tileVersions;if(t&&i.tempIndex<t.length&&i.tempIndex>=0){const e=t[i.tempIndex].name;i.mergeTileVersionParam(e)&&(i.tileSetsIndex=i.tempIndex,i.fire("tileversionschanged",{tileVersion:t[i.tempIndex]}))}},updateCurrentTileSetsIndex:function(i){this.tempIndex=i},mergeTileVersionParam:function(i){return i?(this.requestParams.tileversion=i,this._paramsChanged=!0,this.redraw(),this._paramsChanged=!1,!0):!1},_getLayerUrl:function(){return this._paramsChanged&&(this._layerUrl=this._createLayerUrl()),this._layerUrl||this._createLayerUrl()},_createLayerUrl:function(){let i=S.urlPathAppend(this._url,`tileImage.${this.options.format}`);return this.requestParams=this.requestParams||this._getAllRequestParams(),i=S.urlAppend(i,p.Util.getParamString(this.requestParams)),i=Y.appendCredential(i),this._layerUrl=i,i},_getAllRequestParams:function(){const i=this,t=i.options||{},e={};let r=this.options.tileSize;r instanceof R.Point||(r=R.point(r,r)),e.width=r.x,e.height=r.y,e.redirect=t.redirect===!0,e.transparent=t.transparent===!0,e.cacheEnabled=t.cacheEnabled!==!1,t.prjCoordSys&&(e.prjCoordSys=JSON.stringify(t.prjCoordSys)),t.layersID&&(e.layersID=t.layersID.toString()),t.clipRegionEnabled&&t.clipRegion&&(t.clipRegion=z.fromGeometry(re(t.clipRegion)),e.clipRegionEnabled=t.clipRegionEnabled,e.clipRegion=JSON.stringify(t.clipRegion));const n=i._crs;if(n.options&&n.options.origin)e.origin=JSON.stringify({x:n.options.origin[0],y:n.options.origin[1]});else if(n.projection&&n.projection.bounds){const s=n.projection.bounds,o=R.point(s.min.x,s.max.y);e.origin=JSON.stringify({x:o.x,y:o.y})}return t.overlapDisplayed===!1?(e.overlapDisplayed=!1,t.overlapDisplayedOptions&&(e.overlapDisplayedOptions=i.overlapDisplayedOptions.toString())):e.overlapDisplayed=!0,e.cacheEnabled===!0&&t.tileversion&&(e.tileversion=t.tileversion.toString()),t.rasterfunction&&(e.rasterfunction=JSON.stringify(t.rasterfunction)),e}}),Xe=function(i,t){return new Qe(i,t)};var mt=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,V=document.documentElement.style.pointerEvents==="",X={cors:mt,pointerEvents:V},$e={attributionWidthOffset:55},Xt=0;function yt(i){var t="";i.f=i.f||"json";for(var e in i)if(Object.prototype.hasOwnProperty.call(i,e)){var r=i[e],n=Object.prototype.toString.call(r),s;t.length&&(t+="&"),n==="[object Array]"?s=Object.prototype.toString.call(r[0])==="[object Object]"?JSON.stringify(r):r.join(","):n==="[object Object]"?s=JSON.stringify(r):n==="[object Date]"?s=r.valueOf():s=r,t+=encodeURIComponent(e)+"="+encodeURIComponent(s)}return t.replaceAll("'","%27")}function Dt(i,t){var e=new window.XMLHttpRequest;return e.onerror=function(r){e.onreadystatechange=p.Util.falseFn,i.call(t,{error:{code:500,message:"XMLHttpRequest error"}},null)},e.onreadystatechange=function(){var r,n;if(e.readyState===4){try{r=JSON.parse(e.responseText)}catch{r=null,n={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!n&&r.error&&(n=r.error,r=null),e.onerror=p.Util.falseFn,i.call(t,n,r)}},e.ontimeout=function(){this.onerror()},e}function Ye(i,t,e,r){var n=Dt(e,r);return n.open("POST",i),typeof r<"u"&&r!==null&&typeof r.options<"u"&&(n.timeout=r.options.timeout),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.send(yt(t)),n}function se(i,t,e,r){var n=Dt(e,r);return n.open("GET",i+"?"+yt(t),!0),typeof r<"u"&&r!==null&&typeof r.options<"u"&&(n.timeout=r.options.timeout,r.options.withCredentials&&(n.withCredentials=!0)),n.send(null),n}function oe(i,t,e,r){var n=yt(t),s=Dt(e,r),o=(i+"?"+n).length;if(o<=2e3&&X.cors?s.open("GET",i+"?"+n):o>2e3&&X.cors&&(s.open("POST",i),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),typeof r<"u"&&r!==null&&typeof r.options<"u"&&(s.timeout=r.options.timeout,r.options.withCredentials&&(s.withCredentials=!0)),o<=2e3&&X.cors)s.send(null);else if(o>2e3&&X.cors)s.send(n);else{if(o<=2e3&&!X.cors)return kt(i,t,e,r);$("a request to "+i+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy https://developers.arcgis.com/esri-leaflet/api-reference/request/");return}return s}function kt(i,t,e,r){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var n="c"+Xt;t.callback="window._EsriLeafletCallbacks."+n,window._EsriLeafletCallbacks[n]=function(o){if(window._EsriLeafletCallbacks[n]!==!0){var a,l=Object.prototype.toString.call(o);l==="[object Object]"||l==="[object Array]"||(a={error:{code:500,message:"Expected array or object as JSONP response"}},o=null),!a&&o.error&&(a=o,o=null),e.call(r,a,o),window._EsriLeafletCallbacks[n]=!0}};var s=p.DomUtil.create("script",null,document.body);return s.type="text/javascript",s.src=i+"?"+yt(t),s.id=n,s.onerror=function(o){if(o&&window._EsriLeafletCallbacks[n]!==!0){var a={error:{code:500,message:"An unknown error occurred"}};e.call(r,a),window._EsriLeafletCallbacks[n]=!0}},p.DomUtil.addClass(s,"esri-leaflet-jsonp"),Xt++,{id:n,url:s.src,abort:function(){window._EsriLeafletCallbacks._callback[n]({code:0,message:"Request aborted."})}}}var Ut=X.cors?se:kt;Ut.CORS=se;Ut.JSONP=kt;function $(){console&&console.warn&&console.warn.apply(console,arguments)}var pt={request:oe,get:Ut,post:Ye};/* @preserve
* @terraformer/arcgis - v2.1.1 - MIT
* Copyright (c) 2012-2022 Environmental Systems Research Institute, Inc.
* Tue Aug 02 2022 14:23:48 GMT-0700 (Pacific Daylight Time)
*/var je=function(t,e,r,n){var s=(n[0]-r[0])*(t[1]-r[1])-(n[1]-r[1])*(t[0]-r[0]),o=(e[0]-t[0])*(t[1]-r[1])-(e[1]-t[1])*(t[0]-r[0]),a=(n[1]-r[1])*(e[0]-t[0])-(n[0]-r[0])*(e[1]-t[1]);if(a!==0){var l=s/a,c=o/a;if(l>=0&&l<=1&&c>=0&&c<=1)return!0}return!1},ti=function(t,e){for(var r=!1,n=-1,s=t.length,o=s-1;++n<s;o=n)(t[n][1]<=e[1]&&e[1]<t[o][1]||t[o][1]<=e[1]&&e[1]<t[n][1])&&e[0]<(t[o][0]-t[n][0])*(e[1]-t[n][1])/(t[o][1]-t[n][1])+t[n][0]&&(r=!r);return r},ei=function(t,e){for(var r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0},ae=function(t,e){for(var r=0;r<t.length-1;r++)for(var n=0;n<e.length-1;n++)if(je(t[r],t[r+1],e[n],e[n+1]))return!0;return!1},At=function(t){return ei(t[0],t[t.length-1])||t.push(t[0]),t},Pt=function(t){var e=0,r=0,n=t.length,s=t[r],o;for(r;r<n-1;r++)o=t[r+1],e+=(o[0]-s[0])*(o[1]+s[1]),s=o;return e>=0},le=function(t){var e={};for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},ii=function(t,e){var r=ae(t,e),n=ti(t,e[0]);return!!(!r&&n)},ri=function(t){for(var e=[],r=[],n,s,o,a=0;a<t.length;a++){var l=At(t[a].slice(0));if(!(l.length<4))if(Pt(l)){var c=[l.slice().reverse()];e.push(c)}else r.push(l.slice().reverse())}for(var h=[];r.length;){o=r.pop();var y=!1;for(n=e.length-1;n>=0;n--)if(s=e[n][0],ii(s,o)){e[n].push(o),y=!0;break}y||h.push(o)}for(;h.length;){o=h.pop();var g=!1;for(n=e.length-1;n>=0;n--)if(s=e[n][0],ae(s,o)){e[n].push(o),g=!0;break}g||e.push([o.reverse()])}return e.length===1?{type:"Polygon",coordinates:e[0]}:{type:"MultiPolygon",coordinates:e}},ni=function(t,e){for(var r=e?[e,"OBJECTID","FID"]:["OBJECTID","FID"],n=0;n<r.length;n++){var s=r[n];if(s in t&&(typeof t[s]=="string"||typeof t[s]=="number"))return t[s]}throw Error("No valid id attribute found")},si=function i(t,e){var r={};if(t.features){r.type="FeatureCollection",r.features=[];for(var n=0;n<t.features.length;n++)r.features.push(i(t.features[n],e))}if(typeof t.x=="number"&&typeof t.y=="number"&&(r.type="Point",r.coordinates=[t.x,t.y],typeof t.z=="number"&&r.coordinates.push(t.z)),t.points&&(r.type="MultiPoint",r.coordinates=t.points.slice(0)),t.paths&&(t.paths.length===1?(r.type="LineString",r.coordinates=t.paths[0].slice(0)):(r.type="MultiLineString",r.coordinates=t.paths.slice(0))),t.rings&&(r=ri(t.rings.slice(0))),typeof t.xmin=="number"&&typeof t.ymin=="number"&&typeof t.xmax=="number"&&typeof t.ymax=="number"&&(r.type="Polygon",r.coordinates=[[[t.xmax,t.ymax],[t.xmin,t.ymax],[t.xmin,t.ymin],[t.xmax,t.ymin],[t.xmax,t.ymax]]]),(t.geometry||t.attributes)&&(r.type="Feature",r.geometry=t.geometry?i(t.geometry):null,r.properties=t.attributes?le(t.attributes):null,t.attributes))try{r.id=ni(t.attributes,e)}catch{}return JSON.stringify(r.geometry)===JSON.stringify({})&&(r.geometry=null),t.spatialReference&&t.spatialReference.wkid&&t.spatialReference.wkid!==4326&&console.warn("Object converted in non-standard crs - "+JSON.stringify(t.spatialReference)),r},ue=function(t){var e=[],r=t.slice(0),n=At(r.shift().slice(0));if(n.length>=4){Pt(n)||n.reverse(),e.push(n);for(var s=0;s<r.length;s++){var o=At(r[s].slice(0));o.length>=4&&(Pt(o)&&o.reverse(),e.push(o))}}return e},oi=function(t){for(var e=[],r=0;r<t.length;r++)for(var n=ue(t[r]),s=n.length-1;s>=0;s--){var o=n[s].slice(0);e.push(o)}return e},ai=function i(t,e){e=e||"OBJECTID";var r={wkid:4326},n={},s;switch(t.type){case"Point":n.x=t.coordinates[0],n.y=t.coordinates[1],t.coordinates[2]!=null&&(n.z=t.coordinates[2]),n.spatialReference=r;break;case"MultiPoint":n.points=t.coordinates.slice(0),t.coordinates[0][2]!=null&&(n.hasZ=!0),n.spatialReference=r;break;case"LineString":n.paths=[t.coordinates.slice(0)],t.coordinates[0][2]!=null&&(n.hasZ=!0),n.spatialReference=r;break;case"MultiLineString":n.paths=t.coordinates.slice(0),t.coordinates[0][0][2]!=null&&(n.hasZ=!0),n.spatialReference=r;break;case"Polygon":n.rings=ue(t.coordinates.slice(0)),t.coordinates[0][0][2]!=null&&(n.hasZ=!0),n.spatialReference=r;break;case"MultiPolygon":n.rings=oi(t.coordinates.slice(0)),t.coordinates[0][0][0][2]!=null&&(n.hasZ=!0),n.spatialReference=r;break;case"Feature":t.geometry&&(n.geometry=i(t.geometry,e)),n.attributes=t.properties?le(t.properties):{},t.id&&(n.attributes[e]=t.id);break;case"FeatureCollection":for(n=[],s=0;s<t.features.length;s++)n.push(i(t.features[s],e));break;case"GeometryCollection":for(n=[],s=0;s<t.geometries.length;s++)n.push(i(t.geometries[s],e));break}return n},li='Powered by <a href="https://www.esri.com">Esri</a>';function dt(i,t){return ai(i,t)}function ui(i,t){return si(i,t)}function $t(i){if(i.xmin!=="NaN"&&i.ymin!=="NaN"&&i.xmax!=="NaN"&&i.ymax!=="NaN"){var t=p.latLng(i.ymin,i.xmin),e=p.latLng(i.ymax,i.xmax);return p.latLngBounds(t,e)}else return null}function he(i){return i=p.latLngBounds(i),{xmin:i.getSouthWest().lng,ymin:i.getSouthWest().lat,xmax:i.getNorthEast().lng,ymax:i.getNorthEast().lat,spatialReference:{wkid:4326}}}var fe=/^(OBJECTID|FID|OID|ID)$/i;function hi(i){var t;if(i.objectIdFieldName)t=i.objectIdFieldName;else if(i.fields){for(var e=0;e<=i.fields.length-1;e++)if(i.fields[e].type==="esriFieldTypeOID"){t=i.fields[e].name;break}if(!t){for(e=0;e<=i.fields.length-1;e++)if(i.fields[e].name.match(fe)){t=i.fields[e].name;break}}}return t}function fi(i){for(var t in i.attributes)if(t.match(fe))return t}function vt(i,t){var e,r=i.features||i.results,n=r&&r.length;t?e=t:e=hi(i);var s={type:"FeatureCollection",features:[]};if(n)for(var o=r.length-1;o>=0;o--){var a=ui(r[o],e||fi(r[o]));s.features.push(a)}return s}function qt(i){return i=p.Util.trim(i),i[i.length-1]!=="/"&&(i+="/"),i}function gt(i){if(i.url.indexOf("?")!==-1){i.requestParams=i.requestParams||{};var t=i.url.substring(i.url.indexOf("?")+1);i.url=i.url.split("?")[0],i.requestParams=JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return i.url=qt(i.url.split("?")[0]),i}function ci(i){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(i)}function Yt(i){var t;switch(i){case"Point":t="esriGeometryPoint";break;case"MultiPoint":t="esriGeometryMultipoint";break;case"LineString":t="esriGeometryPolyline";break;case"MultiLineString":t="esriGeometryPolyline";break;case"Polygon":t="esriGeometryPolygon";break;case"MultiPolygon":t="esriGeometryPolygon";break}return t}function Et(i){return i.getSize().x-$e.attributionWidthOffset+"px"}function _t(i){if(i.attributionControl){if(i.attributionControl._esriAttributionLayerCount||(i.attributionControl._esriAttributionLayerCount=0),i.attributionControl._esriAttributionLayerCount===0){if(!i.attributionControl._esriAttributionAddedOnce){var t=document.createElement("style");t.type="text/css",t.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(t);var e=document.createElement("style");e.type="text/css",e.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+Et(i)+";}",document.getElementsByTagName("head")[0].appendChild(e),i.on("resize",function(r){i.attributionControl&&(i.attributionControl._container.style.maxWidth=Et(r.target))}),i.attributionControl._esriAttributionAddedOnce=!0}p.DomUtil.addClass(i.attributionControl._container,"esri-truncated-attribution:hover"),p.DomUtil.addClass(i.attributionControl._container,"esri-truncated-attribution")}i.attributionControl._esriAttributionLayerCount=i.attributionControl._esriAttributionLayerCount+1}}function St(i){i.attributionControl&&(i.attributionControl._esriAttributionLayerCount&&i.attributionControl._esriAttributionLayerCount===1&&(p.DomUtil.removeClass(i.attributionControl._container,"esri-truncated-attribution:hover"),p.DomUtil.removeClass(i.attributionControl._container,"esri-truncated-attribution")),i.attributionControl._esriAttributionLayerCount=i.attributionControl._esriAttributionLayerCount-1)}function ce(i){var t={geometry:null,geometryType:null};if(i instanceof p.LatLngBounds)return t.geometry=he(i),t.geometryType="esriGeometryEnvelope",t;if(i.getLatLng&&(i=i.getLatLng()),i instanceof p.LatLng&&(i={type:"Point",coordinates:[i.lng,i.lat]}),i instanceof p.GeoJSON&&(i=i.getLayers()[0].feature.geometry,t.geometry=dt(i),t.geometryType=Yt(i.type)),i.toGeoJSON&&(i=i.toGeoJSON()),i.type==="Feature"&&(i=i.geometry),i.type==="Point"||i.type==="LineString"||i.type==="Polygon"||i.type==="MultiPolygon")return t.geometry=dt(i),t.geometryType=Yt(i.type),t;$("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object")}function pi(i,t){X.cors&&oe(i,{},p.Util.bind(function(e,r){if(!e){t._esriAttributions=[];for(var n=0;n<r.contributors.length;n++)for(var s=r.contributors[n],o=0;o<s.coverageAreas.length;o++){var a=s.coverageAreas[o],l=p.latLng(a.bbox[0],a.bbox[1]),c=p.latLng(a.bbox[2],a.bbox[3]);t._esriAttributions.push({attribution:s.attribution,score:a.score,bounds:p.latLngBounds(l,c),minZoom:a.zoomMin,maxZoom:a.zoomMax})}t._esriAttributions.sort(function(y,g){return g.score-y.score});var h={target:t};Ot(h)}},this))}function Ot(i){var t=i.target,e=t._esriAttributions;if(!(!t||!t.attributionControl)){var r=t.attributionControl._container.querySelector(".esri-dynamic-attribution");if(r&&e){for(var n="",s=t.getBounds(),o=p.latLngBounds(s.getSouthWest().wrap(),s.getNorthEast().wrap()),a=t.getZoom(),l=0;l<e.length;l++){var c=e[l],h=c.attribution;!n.match(h)&&c.bounds.intersects(o)&&a>=c.minZoom&&a<=c.maxZoom&&(n+=", "+h)}n=li+" | "+n.substr(2),r.innerHTML=n,r.style.maxWidth=Et(t),t.fire("attributionupdated",{attribution:n})}}}var Bt=p.Class.extend({options:{proxy:!1,useCors:mt},generateSetter:function(i,t){return p.Util.bind(function(e){return this.params[i]=e,this},t)},initialize:function(i){if(i.request&&i.options?(this._service=i,p.Util.setOptions(this,i.options)):(p.Util.setOptions(this,i),this.options.url=qt(i.url)),this.params=p.Util.extend({},this.params||{}),this.setters)for(var t in this.setters){var e=this.setters[t];this[t]=this.generateSetter(e,this)}},token:function(i){return this._service?this._service.authenticate(i):this.params.token=i,this},apikey:function(i){return this.token(i)},format:function(i){return this.params.returnUnformattedValues=!i,this},request:function(i,t){return this.options.requestParams&&p.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,i,t):this._request("request",this.path,this.params,i,t)},_request:function(i,t,e,r,n){var s=this.options.proxy?this.options.proxy+"?"+this.options.url+t:this.options.url+t;return(i==="get"||i==="request")&&!this.options.useCors?pt.get.JSONP(s,e,r,n):pt[i](s,e,r,n)}}),di=Bt.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*"},within:function(i){return this._setGeometryParams(i),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(i){return this._setGeometryParams(i),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(i){return this._setGeometryParams(i),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(i){return this._setGeometryParams(i),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(i){return this._setGeometryParams(i),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(i){return this._setGeometryParams(i),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(i){return this._setGeometryParams(i),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(i){return this._setGeometryParams(i),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(i,t){return i=p.latLng(i),this.params.geometry=[i.lng,i.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=t,this.params.inSR=4326,this},where:function(i){return this.params.where=i,this},between:function(i,t){return this.params.time=[i.valueOf(),t.valueOf()],this},simplify:function(i,t){var e=Math.abs(i.getBounds().getWest()-i.getBounds().getEast());return this.params.maxAllowableOffset=e/i.getSize().y*t,this},orderBy:function(i,t){return t=t||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[i,t].join(" "),this},run:function(i,t){return this._cleanParams(),this.options.isModern||ci(this.options.url)&&this.options.isModern===void 0?(this.params.f="geojson",this.request(function(e,r){this._trapSQLerrors(e),i.call(t,e,r,r)},this)):this.request(function(e,r){this._trapSQLerrors(e),i.call(t,e,r&&vt(r),r)},this)},count:function(i,t){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(e,r){i.call(this,e,r&&r.count,r)},t)},ids:function(i,t){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(e,r){i.call(this,e,r&&r.objectIds,r)},t)},bounds:function(i,t){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request(function(e,r){r&&r.extent&&$t(r.extent)?i.call(t,e,$t(r.extent),r):(e={message:"Invalid Bounds"},i.call(t,e,null,r))},t)},distinct:function(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize:function(i){var t=p.point(i);return this.params.pixelSize=[t.x,t.y],this},layer:function(i){return this.path=i+"/query",this},_trapSQLerrors:function(i){i&&i.code==="400"&&$("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams:function(i){this.params.inSR=4326;var t=ce(i);this.params.geometry=t.geometry,this.params.geometryType=t.geometryType}});function zt(i){return new di(i)}var mi=Bt.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(i,t){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[i,t].join(":"),this},simplify:function(i,t){var e=Math.abs(i.getBounds().getWest()-i.getBounds().getEast());return this.params.maxAllowableOffset=e/i.getSize().y*t,this},run:function(i,t){return this.request(function(e,r){i.call(t,e,r&&vt(r),r)},t)}});function yi(i){return new mi(i)}var pe=Bt.extend({path:"identify",between:function(i,t){return this.params.time=[i.valueOf(),t.valueOf()],this}}),vi=pe.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on:function(i){var t=he(i.getBounds()),e=i.getSize();return this.params.imageDisplay=[e.x,e.y,96],this.params.mapExtent=[t.xmin,t.ymin,t.xmax,t.ymax],this},at:function(i){return i.length===2&&(i=p.latLng(i)),this._setGeometryParams(i),this},layerDef:function(i,t){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[i,t].join(":"),this},simplify:function(i,t){var e=Math.abs(i.getBounds().getWest()-i.getBounds().getEast());return this.params.maxAllowableOffset=e/i.getSize().y*t,this},run:function(i,t){return this.request(function(e,r){if(e)i.call(t,e,void 0,r);else{var n=vt(r);r.results=r.results.reverse();for(var s=0;s<n.features.length;s++){var o=n.features[s];o.layerId=r.results[s].layerId}i.call(t,void 0,n,r)}})},_setGeometryParams:function(i){var t=ce(i);this.params.geometry=t.geometry,this.params.geometryType=t.geometryType}});function gi(i){return new vi(i)}var _i=pe.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at:function(i){return i=p.latLng(i),this.params.geometry=JSON.stringify({x:i.lng,y:i.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule:function(){return this.params.mosaicRule},getRenderingRule:function(){return this.params.renderingRule},getPixelSize:function(){return this.params.pixelSize},run:function(i,t){return this.request(function(e,r){i.call(t,e,r&&this._responseToGeoJSON(r),r)},this)},_responseToGeoJSON:function(i){var t=i.location,e=i.catalogItems,r=i.catalogItemVisibilities,n={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[t.x,t.y]},crs:{type:"EPSG",properties:{code:t.spatialReference.wkid}},properties:{OBJECTID:i.objectId,name:i.name,value:i.value},id:i.objectId}};if(i.properties&&i.properties.Values&&(n.pixel.properties.values=i.properties.Values),e&&e.features&&(n.catalogItems=vt(e),r&&r.length===n.catalogItems.features.length))for(var s=r.length-1;s>=0;s--)n.catalogItems.features[s].properties.catalogItemVisibility=r[s];return n}});function Si(i){return new _i(i)}var Jt=p.Evented.extend({options:{proxy:!1,useCors:mt,timeout:0},initialize:function(i){i=i||{},this._requestQueue=[],this._authenticating=!1,p.Util.setOptions(this,i),this.options.url=qt(this.options.url)},get:function(i,t,e,r){return this._request("get",i,t,e,r)},post:function(i,t,e,r){return this._request("post",i,t,e,r)},request:function(i,t,e,r){return this._request("request",i,t,e,r)},metadata:function(i,t){return this._request("get","",{},i,t)},authenticate:function(i){return this._authenticating=!1,this.options.token=i,this._runQueue(),this},getTimeout:function(){return this.options.timeout},setTimeout:function(i){this.options.timeout=i},_request:function(i,t,e,r,n){this.fire("requeststart",{url:this.options.url+t,params:e,method:i},!0);var s=this._createServiceCallback(i,t,e,r,n);if(this.options.token&&(e.token=this.options.token),this.options.requestParams&&p.Util.extend(e,this.options.requestParams),this._authenticating)this._requestQueue.push([i,t,e,r,n]);else{var o=this.options.proxy?this.options.proxy+"?"+this.options.url+t:this.options.url+t;return(i==="get"||i==="request")&&!this.options.useCors?pt.get.JSONP(o,e,s,n):pt[i](o,e,s,n)}},_createServiceCallback:function(i,t,e,r,n){return p.Util.bind(function(s,o){s&&(s.code===499||s.code===498)&&(this._authenticating=!0,this._requestQueue.push([i,t,e,r,n]),this.fire("authenticationrequired",{authenticate:p.Util.bind(this.authenticate,this)},!0),s.authenticate=p.Util.bind(this.authenticate,this)),r.call(n,s,o),s?this.fire("requesterror",{url:this.options.url+t,params:e,message:s.message,code:s.code,method:i},!0):this.fire("requestsuccess",{url:this.options.url+t,params:e,response:o,method:i},!0),this.fire("requestend",{url:this.options.url+t,params:e,method:i},!0)},this)},_runQueue:function(){for(var i=this._requestQueue.length-1;i>=0;i--){var t=this._requestQueue[i],e=t.shift();this[e].apply(this,t)}this._requestQueue=[]}}),xi=Jt.extend({identify:function(){return gi(this)},find:function(){return yi(this)},query:function(){return zt(this)}});function de(i){return new xi(i)}var wi=Jt.extend({query:function(){return zt(this)},identify:function(){return Si(this)}});function Ci(i){return new wi(i)}var bi=Jt.extend({options:{idAttribute:"OBJECTID"},query:function(){return zt(this)},addFeature:function(i,t,e){this.addFeatures(i,t,e)},addFeatures:function(i,t,e){for(var r=i.features?i.features:[i],n=r.length-1;n>=0;n--)delete r[n].id;return i=dt(i),i=r.length>1?i:[i],this.post("addFeatures",{features:i},function(s,o){var a=o&&o.addResults?o.addResults.length>1?o.addResults:o.addResults[0]:void 0;t&&t.call(e,s||o.addResults[0].error,a)},e)},updateFeature:function(i,t,e){this.updateFeatures(i,t,e)},updateFeatures:function(i,t,e){var r=i.features?i.features:[i];return i=dt(i,this.options.idAttribute),i=r.length>1?i:[i],this.post("updateFeatures",{features:i},function(n,s){var o=s&&s.updateResults?s.updateResults.length>1?s.updateResults:s.updateResults[0]:void 0;t&&t.call(e,n||s.updateResults[0].error,o)},e)},deleteFeature:function(i,t,e){this.deleteFeatures(i,t,e)},deleteFeatures:function(i,t,e){return this.post("deleteFeatures",{objectIds:i},function(r,n){var s=n&&n.deleteResults?n.deleteResults.length>1?n.deleteResults:n.deleteResults[0]:void 0;t&&t.call(e,r||n.deleteResults[0].error,s)},e)}});function Ti(i){return new bi(i)}var O=window.location.protocol!=="https:"?"http:":"https:",jt=p.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:O+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:O+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:V?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:V?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:V?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:V?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:V?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:V?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:V?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:O+"//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:O+"//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:O+"//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:O+"//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize:function(i,t){var e;if(typeof i=="object"&&i.urlTemplate&&i.options)e=i;else if(typeof i=="string"&&jt.TILES[i])e=jt.TILES[i];else throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');var r=p.Util.extend(e.options,t);p.Util.setOptions(this,r),this.options.ignoreDeprecationWarning||console.warn("WARNING: L.esri.BasemapLayer uses data services that are in mature support and are not being updated. Please use L.esri.Vector.vectorBasemapLayer instead. More info: https://esriurl.com/esri-leaflet-basemap"),this.options.token&&e.urlTemplate.indexOf("token=")===-1&&(e.urlTemplate+="?token="+this.options.token),this.options.proxy&&(e.urlTemplate=this.options.proxy+"?"+e.urlTemplate),p.TileLayer.prototype.initialize.call(this,e.urlTemplate,r)},onAdd:function(i){_t(i),this.options.pane==="esri-labels"&&this._initPane(),this.options.attributionUrl&&pi((this.options.proxy?this.options.proxy+"?":"")+this.options.attributionUrl,i),i.on("moveend",Ot),p.TileLayer.prototype.onAdd.call(this,i)},onRemove:function(i){St(i),i.off("moveend",Ot),p.TileLayer.prototype.onRemove.call(this,i)},_initPane:function(){if(!this._map.getPane(this.options.pane)){var i=this._map.createPane(this.options.pane);i.style.pointerEvents="none",i.style.zIndex=500}},getAttribution:function(){if(this.options.attribution)var i='<span class="esri-dynamic-attribution">'+this.options.attribution+"</span>";return i}}),me=p.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize:function(i){i=p.Util.setOptions(this,i),i=gt(i),this.tileUrl=(i.proxy?i.proxy+"?":"")+i.url+"tile/{z}/{y}/{x}"+(i.requestParams&&Object.keys(i.requestParams).length>0?p.Util.getParamString(i.requestParams):""),i.url.indexOf("{s}")!==-1&&i.subdomains&&(i.url=i.url.replace("{s}",i.subdomains[0])),this.service=de(i),this.service.addEventParent(this);var t=new RegExp(/tiles.arcgis(online)?\.com/g);t.test(i.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),i.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+="?token="+this.options.token),p.TileLayer.prototype.initialize.call(this,this.tileUrl,i)},getTileUrl:function(i){var t=this._getZoomForUrl();return p.Util.template(this.tileUrl,p.Util.extend({s:this._getSubdomain(i),x:i.x,y:i.y,z:this._lodMap&&this._lodMap[t]!==void 0?this._lodMap[t]:t},this.options))},createTile:function(i,t){var e=document.createElement("img");return p.DomEvent.on(e,"load",p.Util.bind(this._tileOnLoad,this,t,e)),p.DomEvent.on(e,"error",p.Util.bind(this._tileOnError,this,t,e)),this.options.crossOrigin&&(e.crossOrigin=""),e.alt="",!this._lodMap||this._lodMap&&this._lodMap[this._getZoomForUrl()]!==void 0?e.src=this.getTileUrl(i):this.once("lodmap",function(){e.src=this.getTileUrl(i)},this),e},onAdd:function(i){_t(i),this._lodMap||this.metadata(function(t,e){if(!t&&e.spatialReference){var r=e.spatialReference.latestWkid||e.spatialReference.wkid;if(!this.options.attribution&&i.attributionControl&&e.copyrightText&&(this.options.attribution=e.copyrightText,i.attributionControl.addAttribution(this.getAttribution())),i.options.crs===p.CRS.EPSG3857&&(r===102100||r===3857)){this._lodMap={};for(var n=e.tileInfo.lods,s=me.MercatorZoomLevels,o=0;o<n.length;o++){var a=n[o];for(var l in s){var c=s[l];if(this._withinPercentage(a.resolution,c,this.options.zoomOffsetAllowance)){this._lodMap[l]=a.level;break}}}this.fire("lodmap")}else i.options.crs&&i.options.crs.code&&i.options.crs.code.indexOf(r)>-1||$("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet https://developers.arcgis.com/esri-leaflet/samples/non-mercator-projection/")}},this),p.TileLayer.prototype.onAdd.call(this,i)},onRemove:function(i){St(i),p.TileLayer.prototype.onRemove.call(this,i)},metadata:function(i,t){return this.service.metadata(i,t),this},identify:function(){return this.service.identify()},find:function(){return this.service.find()},query:function(){return this.service.query()},authenticate:function(i){var t="?token="+i;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,t):this.tileUrl+t,this.options.token=i,this.service.authenticate(i),this},_withinPercentage:function(i,t,e){var r=Math.abs(i/t-1);return r<e}});function Ii(i,t){return new me(i,t)}var Li=p.ImageOverlay.extend({onAdd:function(i){this._topLeft=i.getPixelBounds().min,p.ImageOverlay.prototype.onAdd.call(this,i)},_reset:function(){this._map.options.crs===p.CRS.EPSG3857?p.ImageOverlay.prototype._reset.call(this):p.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),ye=p.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:mt,attribution:null,interactive:!1,alt:""},onAdd:function(i){_t(i),this.options.zIndex&&(this.options.position=null),this._update=p.Util.throttle(this._update,this.options.updateInterval,this),i.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?i.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata(function(t,e){!t&&!this.options.attribution&&i.attributionControl&&e.copyrightText&&(this.options.attribution=e.copyrightText,i.attributionControl.addAttribution(this.getAttribution()))},this)},onRemove:function(i){St(i),this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup:function(i,t){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=p.popup(t),this._popupFunction=i,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup:function(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront:function(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex:function(i){return this.options.zIndex=i,this._currentImage&&this._currentImage.setZIndex(i),this},_setAutoZIndex:function(i){if(this._currentImage){for(var t=this._currentImage.getPane().children,e=-i(-1/0,1/0),r=0,n=t.length,s;r<n;r++)s=t[r].style.zIndex,t[r]!==this._currentImage._image&&s&&(e=i(e,+s));isFinite(e)&&(this.options.zIndex=e+i(-1,1),this.setZIndex(this.options.zIndex))}},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(i){return this.options.opacity=i,this._currentImage&&this._currentImage.setOpacity(i),this},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(i,t){return this.options.from=i,this.options.to=t,this._update(),this},metadata:function(i,t){return this.service.metadata(i,t),this},authenticate:function(i){return this.service.authenticate(i),this},redraw:function(){this._update()},_renderImage:function(i,t,e){if(this._map){if(e&&(i="data:"+e+";base64,"+i),!i)return;var r=new Li(i,t,{opacity:0,crossOrigin:this.options.withCredentials?"use-credentials":this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map),n=function(){this._map.removeLayer(r),this.fire("error"),r.off("load",s,this)},s=function(o){if(r.off("error",n,this),this._map){var a=o.target,l=this._currentImage;a._bounds.equals(t)&&a._bounds.equals(this._map.getBounds())?(this._currentImage=a,this.options.position==="front"?this.bringToFront():this.options.position==="back"&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),l&&this._map&&this._map.removeLayer(l),l&&l._map&&l._map.removeLayer(l)):this._map.removeLayer(a)}this.fire("load",{bounds:t})};r.once("error",n,this),r.once("load",s,this)}},_update:function(){if(this._map){var i=this._map.getZoom(),t=this._map.getBounds();if(!this._animatingZoom&&!(this._map._panTransition&&this._map._panTransition._inProgress)){if(i>this.options.maxZoom||i<this.options.minZoom){this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);return}var e=this._buildExportParams();p.Util.extend(e,this.options.requestParams),e?(this._requestExport(e,t),this.fire("loading",{bounds:t})):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)}}},_renderPopup:function(i,t,e,r){if(i=p.latLng(i),this._shouldRenderPopup&&this._lastClick.equals(i)){var n=this._popupFunction(t,e,r);n&&this._popup.setLatLng(i).setContent(n).openOn(this._map)}},_resetPopupState:function(i){this._shouldRenderPopup=!1,this._lastClick=i.latlng},_calculateBbox:function(){var i=this._map.getPixelBounds(),t=this._map.unproject(i.getBottomLeft()),e=this._map.unproject(i.getTopRight()),r=this._map.options.crs.project(e),n=this._map.options.crs.project(t),s=p.bounds(r,n);return[s.getBottomLeft().x,s.getBottomLeft().y,s.getTopRight().x,s.getTopRight().y].join(",")},_calculateImageSize:function(){var i=this._map.getPixelBounds(),t=this._map.getSize(),e=this._map.unproject(i.getBottomLeft()),r=this._map.unproject(i.getTopRight()),n=this._map.latLngToLayerPoint(r).y,s=this._map.latLngToLayerPoint(e).y;return(n>0||s<t.y)&&(t.y=s-n),t.x+","+t.y}});ye.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query:function(){return this.service.query()},identify:function(){return this.service.identify()},initialize:function(i){i=gt(i),this.service=Ci(i),this.service.addEventParent(this),p.Util.setOptions(this,i)},setPixelType:function(i){return this.options.pixelType=i,this._update(),this},getPixelType:function(){return this.options.pixelType},setBandIds:function(i){return p.Util.isArray(i)?this.options.bandIds=i.join(","):this.options.bandIds=i.toString(),this._update(),this},getBandIds:function(){return this.options.bandIds},setNoData:function(i,t){return p.Util.isArray(i)?this.options.noData=i.join(","):this.options.noData=i.toString(),t&&(this.options.noDataInterpretation=t),this._update(),this},getNoData:function(){return this.options.noData},getNoDataInterpretation:function(){return this.options.noDataInterpretation},setRenderingRule:function(i){this.options.renderingRule=i,this._update()},getRenderingRule:function(){return this.options.renderingRule},setMosaicRule:function(i){this.options.mosaicRule=i,this._update()},getMosaicRule:function(){return this.options.mosaicRule},_getPopupData:function(i){var t=p.Util.bind(function(r,n,s){r||setTimeout(p.Util.bind(function(){this._renderPopup(i.latlng,r,n,s)},this),300)},this),e=this.identify().at(i.latlng);this.options.mosaicRule&&e.setMosaicRule(this.options.mosaicRule),e.run(t),this._shouldRenderPopup=!0,this._lastClick=i.latlng},_buildExportParams:function(){var i=parseInt(this._map.options.crs.code.split(":")[1],10),t={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:i,imageSR:i};return this.options.from&&this.options.to&&(t.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.options.pixelType&&(t.pixelType=this.options.pixelType),this.options.interpolation&&(t.interpolation=this.options.interpolation),this.options.compressionQuality&&(t.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(t.bandIds=this.options.bandIds),(this.options.noData===0||this.options.noData)&&(t.noData=this.options.noData),this.options.noDataInterpretation&&(t.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(t.token=this.service.options.token),this.options.renderingRule&&(t.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(t.mosaicRule=JSON.stringify(this.options.mosaicRule)),t},_requestExport:function(i,t){if(this.options.f==="json")this.service.request("exportImage",i,function(r,n){r||(this.options.token&&(n.href+="?token="+this.options.token),this.options.proxy&&(n.href=this.options.proxy+"?"+n.href),this._renderImage(n.href,t))},this);else{i.f="image";var e=this.options.url+"exportImage"+p.Util.getParamString(i);this.options.proxy&&(e=this.options.proxy+"?"+e),this._renderImage(e,t)}}});var Ai=ye.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png32",transparent:!0,f:"json"},initialize:function(i){i=gt(i),this.service=de(i),this.service.addEventParent(this),p.Util.setOptions(this,i)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(i){return this.options.dynamicLayers=i,this._update(),this},getLayers:function(){return this.options.layers},setLayers:function(i){return this.options.layers=i,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(i){return this.options.layerDefs=i,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(i){return this.options.timeOptions=i,this._update(),this},query:function(){return this.service.query()},identify:function(){return this.service.identify()},find:function(){return this.service.find()},_getPopupData:function(i){var t=p.Util.bind(function(n,s,o){n||setTimeout(p.Util.bind(function(){this._renderPopup(i.latlng,n,s,o)},this),300)},this),e;if(this.options.popup?e=this.options.popup.on(this._map).at(i.latlng):e=this.identify().on(this._map).at(i.latlng),e.params.maxAllowableOffset||e.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?e.layers("visible:"+this.options.layers.join(",")):e.layers("visible")),this.options.layerDefs&&typeof this.options.layerDefs!="string"&&!e.params.layerDefs)for(var r in this.options.layerDefs)Object.prototype.hasOwnProperty.call(this.options.layerDefs,r)&&e.layerDef(r,this.options.layerDefs[r]);e.run(t),this._shouldRenderPopup=!0,this._lastClick=i.latlng},_buildExportParams:function(){var i=parseInt(this._map.options.crs.code.split(":")[1],10),t={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:i,imageSR:i};if(this.options.dynamicLayers&&(t.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(this.options.layers.length===0)return;t.layers="show:"+this.options.layers.join(",")}return this.options.layerDefs&&(t.layerDefs=typeof this.options.layerDefs=="string"?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(t.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(t.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.service.options.token&&(t.token=this.service.options.token),this.options.proxy&&(t.proxy=this.options.proxy),this.options.disableCache&&(t._ts=Date.now()),t},_requestExport:function(i,t){if(this.options.f==="json")this.service.request("export",i,function(r,n){r||(this.options.token&&n.href&&(n.href+="?token="+this.options.token),this.options.proxy&&n.href&&(n.href=this.options.proxy+"?"+n.href),n.href?this._renderImage(n.href,t):this._renderImage(n.imageData,t,n.contentType))},this);else{i.f="image";var e=this.options.url+"export"+p.Util.getParamString(i);this.options.proxy&&(e=this.options.proxy+"?"+e),this._renderImage(e,t)}}});function Pi(i,t){return new Ai(i,t)}var ht=p.Layer.extend({options:{cellSize:512,updateWhenIdle:p.Browser.mobile,updateInterval:150,noWrap:!1,keepBuffer:1.5},initialize:function(i){p.Util.setOptions(this,i)},onAdd:function(i){this._cells={},this._activeCells={},this._resetView(),this._update()},onRemove:function(i){this._removeAllCells(),this._cellZoom=void 0},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllCells(),this._update()),this},getEvents:function(){var i={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=p.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),i.move=this._onMove),i},createCell:function(){return document.createElement("div")},removeCell:function(){},reuseCell:function(){},cellLeave:function(){},cellEnter:function(){},getCellSize:function(){var i=this.options.cellSize;return i instanceof p.Point?i:new p.Point(i,i)},_pruneCells:function(){if(this._map){var i,t;for(i in this._cells)t=this._cells[i],t.retain=t.current;for(i in this._cells)if(t=this._cells[i],t.current&&!t.active){var e=t.coords;this._retainParent(e.x,e.y,e.z,e.z-5)||this._retainChildren(e.x,e.y,e.z,e.z+2)}for(i in this._cells)this._cells[i].retain||this._removeCell(i)}},_removeAllCells:function(){for(var i in this._cells)this._removeCell(i)},_invalidateAll:function(){this._removeAllCells(),this._cellZoom=void 0},_retainParent:function(i,t,e,r){var n=Math.floor(i/2),s=Math.floor(t/2),o=e-1,a=new p.Point(+n,+s);a.z=+o;var l=this._cellCoordsToKey(a),c=this._cells[l];return c&&c.active?(c.retain=!0,!0):(c&&c.loaded&&(c.retain=!0),o>r?this._retainParent(n,s,o,r):!1)},_retainChildren:function(i,t,e,r){for(var n=2*i;n<2*i+2;n++)for(var s=2*t;s<2*t+2;s++){var o=new p.Point(n,s);o.z=e+1;var a=this._cellCoordsToKey(o),l=this._cells[a];if(l&&l.active){l.retain=!0;continue}else l&&l.loaded&&(l.retain=!0);e+1<r&&this._retainChildren(n,s,e+1,r)}},_resetView:function(i){var t=i&&(i.pinch||i.flyTo);t||this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_setView:function(i,t,e,r){var n=Math.round(t);r||(this._cellZoom=n,this._abortLoading&&this._abortLoading(),this._resetGrid(),n!==void 0&&this._update(i),e||this._pruneCells(),this._noPrune=!!e)},_resetGrid:function(){var i=this._map,t=i.options.crs,e=this._cellSize=this.getCellSize(),r=this._cellZoom,n=this._map.getPixelWorldBounds(this._cellZoom);n&&(this._globalCellRange=this._pxBoundsToCellRange(n)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(i.project([0,t.wrapLng[0]],r).x/e.x),Math.ceil(i.project([0,t.wrapLng[1]],r).x/e.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(i.project([t.wrapLat[0],0],r).y/e.x),Math.ceil(i.project([t.wrapLat[1],0],r).y/e.y)]},_onMoveEnd:function(i){var t=i&&(i.pinch||i.flyTo);t||!this._map||this._map._animatingZoom||this._update()},_getCelldPixelBounds:function(i){var t=this._map,e=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),r=t.getZoomScale(e,this._cellZoom),n=t.project(i,this._cellZoom).floor(),s=t.getSize().divideBy(r*2);return new p.Bounds(n.subtract(s),n.add(s))},_update:function(i){var t=this._map;if(t){var e=Math.round(t.getZoom());i===void 0&&(i=t.getCenter());var r=this._getCelldPixelBounds(i),n=this._pxBoundsToCellRange(r),s=n.getCenter(),o=[],a=this.options.keepBuffer,l=new p.Bounds(n.getBottomLeft().subtract([a,-a]),n.getTopRight().add([a,-a]));if(!(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.max.x)&&isFinite(n.max.y)))throw new Error("Attempted to load an infinite number of cells");for(var c in this._cells){var h=this._cells[c].coords;(h.z!==this._cellZoom||!l.contains(new p.Point(h.x,h.y)))&&(this._cells[c].current=!1)}if(Math.abs(e-this._cellZoom)>1){this._setView(i,e);return}for(var y=n.min.y;y<=n.max.y;y++)for(var g=n.min.x;g<=n.max.x;g++){var v=new p.Point(g,y);if(v.z=this._cellZoom,!!this._isValidCell(v)){var w=this._cells[this._cellCoordsToKey(v)];w?w.current=!0:o.push(v)}}if(o.sort(function(m,u){return m.distanceTo(s)-u.distanceTo(s)}),o.length!==0)for(this._loading||(this._loading=!0),g=0;g<o.length;g++){var T=this._cellCoordsToKey(o[g]),f=this._keyToCellCoords(T);this._activeCells[f]?this._reuseCell(o[g]):this._createCell(o[g])}}},_isValidCell:function(i){var t=this._map.options.crs;if(!t.infinite){var e=this._globalCellRange;if(!t.wrapLng&&(i.x<e.min.x||i.x>e.max.x)||!t.wrapLat&&(i.y<e.min.y||i.y>e.max.y))return!1}if(!this.options.bounds)return!0;var r=this._cellCoordsToBounds(i);return p.toLatLngBounds(this.options.bounds).overlaps(r)},_keyToBounds:function(i){return this._cellCoordsToBounds(this._keyToCellCoords(i))},_cellCoordsToNwSe:function(i){var t=this._map,e=this.getCellSize(),r=i.scaleBy(e),n=r.add(e),s=t.unproject(r,i.z),o=t.unproject(n,i.z);return[s,o]},_cellCoordsToBounds:function(i){var t=this._cellCoordsToNwSe(i),e=new p.LatLngBounds(t[0],t[1]);return this.options.noWrap||(e=this._map.wrapLatLngBounds(e)),e},_cellCoordsToKey:function(i){return i.x+":"+i.y+":"+i.z},_keyToCellCoords:function(i){var t=i.split(":"),e=new p.Point(+t[0],+t[1]);return e.z=+t[2],e},_removeCell:function(i){var t=this._cells[i];if(t){var e=this._keyToCellCoords(i),r=this._wrapCoords(e),n=this._cellCoordsToBounds(this._wrapCoords(e));t.current=!1,delete this._cells[i],this._activeCells[i]=t,this.cellLeave(n,r,i),this.fire("cellleave",{key:i,coords:r,bounds:n})}},_reuseCell:function(i){var t=this._cellCoordsToKey(i);this._cells[t]=this._activeCells[t],this._cells[t].current=!0;var e=this._wrapCoords(i),r=this._cellCoordsToBounds(this._wrapCoords(i));this.cellEnter(r,e,t),this.fire("cellenter",{key:t,coords:e,bounds:r})},_createCell:function(i){var t=this._cellCoordsToKey(i),e=this._wrapCoords(i),r=this._cellCoordsToBounds(this._wrapCoords(i));this.createCell(r,e,t),this.fire("cellcreate",{key:t,coords:e,bounds:r}),this._cells[t]={coords:i,current:!0},p.Util.requestAnimFrame(this._pruneCells,this)},_cellReady:function(i,t,e){var r=this._cellCoordsToKey(i);e=this._cells[r],e&&(e.loaded=+new Date,e.active=!0)},_getCellPos:function(i){return i.scaleBy(this.getCellSize())},_wrapCoords:function(i){var t=new p.Point(this._wrapX?p.Util.wrapNum(i.x,this._wrapX):i.x,this._wrapY?p.Util.wrapNum(i.y,this._wrapY):i.y);return t.z=i.z,t},_pxBoundsToCellRange:function(i){var t=this.getCellSize();return new p.Bounds(i.min.unscaleBy(t).floor(),i.max.unscaleBy(t).ceil().subtract([1,1]))}});function J(i){this.values=[].concat(i||[])}J.prototype.query=function(i){var t=this.getIndex(i);return this.values[t]};J.prototype.getIndex=function(t){this.dirty&&this.sort();for(var e=0,r=this.values.length-1,n,s;e<=r;)if(n=(e+r)/2|0,s=this.values[Math.round(n)],+s.value<+t)e=n+1;else if(+s.value>+t)r=n-1;else return n;return Math.abs(~r)};J.prototype.between=function(t,e){var r=this.getIndex(t),n=this.getIndex(e);if(r===0&&n===0)return[];for(;this.values[r-1]&&this.values[r-1].value===t;)r--;for(;this.values[n+1]&&this.values[n+1].value===e;)n++;return this.values[n]&&this.values[n].value===e&&this.values[n+1]&&n++,this.values.slice(r,n)};J.prototype.insert=function(t){return this.values.splice(this.getIndex(t.value),0,t),this};J.prototype.bulkAdd=function(t,e){return this.values=this.values.concat([].concat(t||[])),e?this.sort():this.dirty=!0,this};J.prototype.sort=function(){return this.values.sort(function(t,e){return+e.value-+t.value}).reverse(),this.dirty=!1,this};var bt=ht.extend({options:{attribution:null,where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6,fetchAllFeatures:!1},initialize:function(i){if(ht.prototype.initialize.call(this,i),i=gt(i),i=p.Util.setOptions(this,i),this.service=Ti(i),this.service.addEventParent(this),this.options.fields[0]!=="*"){for(var t=!1,e=0;e<this.options.fields.length;e++)this.options.fields[e].match(/^(OBJECTID|FID|OID|ID)$/i)&&(t=!0);t===!1&&$("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new J,this._endTimeIndex=new J):this.options.timeField&&(this._timeIndex=new J),this._cache={},this._currentSnapshot=[],this._activeRequests=0},onAdd:function(i){return _t(i),this.service.metadata(function(t,e){if(!t){var r=e.supportedQueryFormats,n=!1;(this.service.options.isModern===!1||this.options.fetchAllFeatures)&&(n=!0),!n&&r&&r.indexOf("geoJSON")!==-1&&(this.service.options.isModern=!0),e.objectIdField&&(this.service.options.idAttribute=e.objectIdField),!this.options.attribution&&i.attributionControl&&e.copyrightText&&(this.options.attribution=e.copyrightText,i.attributionControl.addAttribution(this.getAttribution()))}},this),i.on("zoomend",this._handleZoomChange,this),ht.prototype.onAdd.call(this,i)},onRemove:function(i){return St(i),i.off("zoomend",this._handleZoomChange,this),ht.prototype.onRemove.call(this,i)},getAttribution:function(){return this.options.attribution},createCell:function(i,t){this._visibleZoom()&&this._requestFeatures(i,t)},_requestFeatures:function(i,t,e,r){this._activeRequests++,r=r||0;var n=this.options.where;return this._activeRequests===1&&this.fire("loading",{bounds:i},!0),this._buildQuery(i,r).run(function(s,o,a){a&&a.exceededTransferLimit&&this.fire("drawlimitexceeded"),this.options.where===n&&(!s&&o&&o.features.length&&p.Util.requestAnimFrame(p.Util.bind(function(){this._addFeatures(o.features,t),this._postProcessFeatures(i)},this)),!s&&o&&!o.features.length&&this._postProcessFeatures(i),s&&this._postProcessFeatures(i),e&&e.call(this,s,o),a&&(a.exceededTransferLimit||a.properties&&a.properties.exceededTransferLimit)&&this.options.fetchAllFeatures&&this._requestFeatures(i,t,e,r+o.features.length))},this)},_postProcessFeatures:function(i){this._activeRequests--,this._activeRequests<=0&&this.fire("load",{bounds:i})},_cacheKey:function(i){return i.z+":"+i.x+":"+i.y},_addFeatures:function(i,t){if(t){var e=this._cacheKey(t);this._cache[e]=this._cache[e]||[]}for(var r=i.length-1;r>=0;r--){var n=i[r].id;this._currentSnapshot.indexOf(n)===-1&&this._currentSnapshot.push(n),typeof e<"u"&&this._cache[e].indexOf(n)===-1&&this._cache[e].push(n)}this.options.timeField&&this._buildTimeIndexes(i),this.createLayers(i)},_buildQuery:function(i,t){var e=this.service.query().intersects(i).where(this.options.where).fields(this.options.fields).precision(this.options.precision);return this.options.fetchAllFeatures&&!isNaN(parseInt(t))&&(e=e.offset(t)),e.params.resultType="tile",this.options.requestParams&&p.Util.extend(e.params,this.options.requestParams),this.options.simplifyFactor&&e.simplify(this._map,this.options.simplifyFactor),this.options.timeFilterMode==="server"&&this.options.from&&this.options.to&&e.between(this.options.from,this.options.to),e},setWhere:function(i,t,e){this.options.where=i&&i.length?i:"1=1";for(var r=[],n=[],s=0,o=null,a=p.Util.bind(function(g,v){if(g&&(o=g),v)for(var w=v.features.length-1;w>=0;w--)n.push(v.features[w].id);s--,s<=0&&this._visibleZoom()&&i===this.options.where&&(this._currentSnapshot=n,p.Util.requestAnimFrame(p.Util.bind(function(){this.removeLayers(r),this.addLayers(n),t&&t.call(e,o)},this)))},this),l=this._currentSnapshot.length-1;l>=0;l--)r.push(this._currentSnapshot[l]);this._cache={};for(var c in this._cells){s++;var h=this._keyToCellCoords(c),y=this._cellCoordsToBounds(h);this._requestFeatures(y,h,a)}return this},getWhere:function(){return this.options.where},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(i,t,e,r){var n=this.options.from,s=this.options.to,o=0,a=null,l=p.Util.bind(function(g){g&&(a=g),this._filterExistingFeatures(n,s,i,t),o--,e&&o<=0&&e.call(r,a)},this);if(this.options.from=i,this.options.to=t,this._filterExistingFeatures(n,s,i,t),this.options.timeFilterMode==="server")for(var c in this._cells){o++;var h=this._keyToCellCoords(c),y=this._cellCoordsToBounds(h);this._requestFeatures(y,h,l)}return this},refresh:function(){this.setWhere(this.options.where)},_filterExistingFeatures:function(i,t,e,r){var n=i&&t?this._getFeaturesInTimeRange(i,t):this._currentSnapshot,s=this._getFeaturesInTimeRange(e,r);if(s.indexOf)for(var o=0;o<s.length;o++){var a=n.indexOf(s[o]);a>=0&&n.splice(a,1)}p.Util.requestAnimFrame(p.Util.bind(function(){this.removeLayers(n),this.addLayers(s)},this))},_getFeaturesInTimeRange:function(i,t){var e=[],r;if(this.options.timeField.start&&this.options.timeField.end){var n=this._startTimeIndex.between(i,t),s=this._endTimeIndex.between(i,t);r=n.concat(s)}else if(this._timeIndex)r=this._timeIndex.between(i,t);else return $("You must set timeField in the layer constructor in order to manipulate the start and end time filter."),[];for(var o=r.length-1;o>=0;o--)e.push(r[o].id);return e},_buildTimeIndexes:function(i){var t,e;if(this.options.timeField.start&&this.options.timeField.end){var r=[],n=[];for(t=i.length-1;t>=0;t--)e=i[t],r.push({id:e.id,value:new Date(e.properties[this.options.timeField.start])}),n.push({id:e.id,value:new Date(e.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(r),this._endTimeIndex.bulkAdd(n)}else{var s=[];for(t=i.length-1;t>=0;t--)e=i[t],s.push({id:e.id,value:new Date(e.properties[this.options.timeField])});this._timeIndex.bulkAdd(s)}},_featureWithinTimeRange:function(i){if(!this.options.from||!this.options.to)return!0;var t=+this.options.from.valueOf(),e=+this.options.to.valueOf();if(typeof this.options.timeField=="string"){var r=+i.properties[this.options.timeField];return r>=t&&r<=e}if(this.options.timeField.start&&this.options.timeField.end){var n=+i.properties[this.options.timeField.start],s=+i.properties[this.options.timeField.end];return n>=t&&n<=e||s>=t&&s<=e||n<=t&&s>=e}},_visibleZoom:function(){if(!this._map)return!1;var i=this._map.getZoom();return!(i>this.options.maxZoom||i<this.options.minZoom)},_handleZoomChange:function(){if(!this._visibleZoom())this.removeLayers(this._currentSnapshot),this._currentSnapshot=[];else for(var i in this._cells){var t=this._cells[i].coords,e=this._cacheKey(t);this._cache[e]&&this.addLayers(this._cache[e])}},authenticate:function(i){return this.service.authenticate(i),this},metadata:function(i,t){return this.service.metadata(i,t),this},query:function(){return this.service.query()},_getMetadata:function(i){if(this._metadata){var t;i(t,this._metadata)}else this.metadata(p.Util.bind(function(e,r){this._metadata=r,i(e,this._metadata)},this))},addFeature:function(i,t,e){this.addFeatures(i,t,e)},addFeatures:function(i,t,e){this._getMetadata(p.Util.bind(function(r,n){if(r){t&&t.call(this,r,null);return}var s=i.features?i.features:[i];this.service.addFeatures(i,p.Util.bind(function(o,a){if(!o){for(var l=s.length-1;l>=0;l--)s[l].properties[n.objectIdField]=s.length>1?a[l].objectId:a.objectId,s[l].id=s.length>1?a[l].objectId:a.objectId;this._addFeatures(s)}t&&t.call(e,o,a)},this))},this))},updateFeature:function(i,t,e){this.updateFeatures(i,t,e)},updateFeatures:function(i,t,e){var r=i.features?i.features:[i];this.service.updateFeatures(i,function(n,s){if(!n){for(var o=r.length-1;o>=0;o--)this.removeLayers([r[o].id],!0);this._addFeatures(r)}t&&t.call(e,n,s)},this)},deleteFeature:function(i,t,e){this.deleteFeatures(i,t,e)},deleteFeatures:function(i,t,e){return this.service.deleteFeatures(i,function(r,n){var s=n.length?n:[n];if(!r&&s.length>0)for(var o=s.length-1;o>=0;o--)this.removeLayers([s[o].objectId],!0);t&&t.call(e,r,n)},this)}});bt.extend({options:{cacheLayers:!0},initialize:function(i){i.apikey&&(i.token=i.apikey),bt.prototype.initialize.call(this,i),this._originalStyle=this.options.style,this._layers={}},onRemove:function(i){for(var t in this._layers)i.removeLayer(this._layers[t]),this.fire("removefeature",{feature:this._layers[t].feature,permanent:!1},!0);return bt.prototype.onRemove.call(this,i)},createNewLayer:function(i){var t=p.GeoJSON.geometryToLayer(i,this.options);return t&&(t.defaultOptions=t.options),t},_updateLayer:function(i,t){var e=[],r=this.options.coordsToLatLng||p.GeoJSON.coordsToLatLng;switch(t.properties&&(i.feature.properties=t.properties),t.geometry.type){case"Point":e=p.GeoJSON.coordsToLatLng(t.geometry.coordinates),i.setLatLng(e);break;case"LineString":e=p.GeoJSON.coordsToLatLngs(t.geometry.coordinates,0,r),i.setLatLngs(e);break;case"MultiLineString":e=p.GeoJSON.coordsToLatLngs(t.geometry.coordinates,1,r),i.setLatLngs(e);break;case"Polygon":e=p.GeoJSON.coordsToLatLngs(t.geometry.coordinates,1,r),i.setLatLngs(e);break;case"MultiPolygon":e=p.GeoJSON.coordsToLatLngs(t.geometry.coordinates,2,r),i.setLatLngs(e);break}this.redraw(i.feature.id)},createLayers:function(i){for(var t=i.length-1;t>=0;t--){var e=i[t],r=this._layers[e.id],n;this._visibleZoom()&&r&&!this._map.hasLayer(r)&&(!this.options.timeField||this._featureWithinTimeRange(e))&&(this._map.addLayer(r),this.fire("addfeature",{feature:r.feature},!0)),r&&(r.setLatLngs||r.setLatLng)&&this._updateLayer(r,e),r||(n=this.createNewLayer(e),n?(n.feature=e,n.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(n.feature,n),this._layers[n.feature.id]=n,this.setFeatureStyle(n.feature.id,this.options.style),this.fire("createfeature",{feature:n.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(e))&&this._map.addLayer(n)):$("invalid GeoJSON encountered"))}},addLayers:function(i){for(var t=i.length-1;t>=0;t--){var e=this._layers[i[t]];e&&(!this.options.timeField||this._featureWithinTimeRange(e.feature))&&(this._map.addLayer(e),this.fire("addfeature",{feature:e.feature},!0))}},removeLayers:function(i,t){for(var e=i.length-1;e>=0;e--){var r=i[e],n=this._layers[r];n&&(this.fire("removefeature",{feature:n.feature,permanent:t},!0),this._map.removeLayer(n)),n&&t&&delete this._layers[r]}},cellEnter:function(i,t){this._visibleZoom()&&!this._zooming&&this._map&&p.Util.requestAnimFrame(p.Util.bind(function(){var e=this._cacheKey(t),r=this._cellCoordsToKey(t),n=this._cache[e];this._activeCells[r]&&n&&this.addLayers(n)},this))},cellLeave:function(i,t){this._zooming||p.Util.requestAnimFrame(p.Util.bind(function(){if(this._map){var e=this._cacheKey(t),r=this._cellCoordsToKey(t),n=this._cache[e],s=this._map.getBounds();if(!this._activeCells[r]&&n){for(var o=!0,a=0;a<n.length;a++){var l=this._layers[n[a]];l&&l.getBounds&&s.intersects(l.getBounds())&&(o=!1)}o&&this.removeLayers(n,!this.options.cacheLayers),!this.options.cacheLayers&&o&&(delete this._cache[e],delete this._cells[r],delete this._activeCells[r])}}},this))},resetStyle:function(){return this.options.style=this._originalStyle,this.eachFeature(function(i){this.resetFeatureStyle(i.feature.id)},this),this},setStyle:function(i){return this.options.style=i,this.eachFeature(function(t){this.setFeatureStyle(t.feature.id,i)},this),this},resetFeatureStyle:function(i){var t=this._layers[i],e=this._originalStyle||p.Path.prototype.options;return t&&(p.Util.extend(t.options,t.defaultOptions),this.setFeatureStyle(i,e)),this},setFeatureStyle:function(i,t){var e=this._layers[i];return typeof t=="function"&&(t=t(e.feature)),e.setStyle&&e.setStyle(t),this},eachActiveFeature:function(i,t){if(this._map){var e=this._map.getBounds();for(var r in this._layers)this._currentSnapshot.indexOf(this._layers[r].feature.id)!==-1&&(typeof this._layers[r].getLatLng=="function"&&e.contains(this._layers[r].getLatLng())?i.call(t,this._layers[r]):typeof this._layers[r].getBounds=="function"&&e.intersects(this._layers[r].getBounds())&&i.call(t,this._layers[r]))}return this},eachFeature:function(i,t){for(var e in this._layers)i.call(t,this._layers[e]);return this},getFeature:function(i){return this._layers[i]},bringToBack:function(){this.eachFeature(function(i){i.bringToBack&&i.bringToBack()})},bringToFront:function(){this.eachFeature(function(i){i.bringToFront&&i.bringToFront()})},redraw:function(i){return i&&this._redraw(i),this},_redraw:function(i){var t=this._layers[i],e=t.feature;if(t&&t.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){var r=this.options.pointToLayer(e,p.latLng(e.geometry.coordinates[1],e.geometry.coordinates[0])),n=r.options.icon;t.setIcon(n)}if(t&&t.setStyle&&this.options.pointToLayer){var s=this.options.pointToLayer(e,p.latLng(e.geometry.coordinates[1],e.geometry.coordinates[0])),o=s.options;this.setFeatureStyle(e.id,o)}t&&t.setStyle&&this.options.style&&this.resetFeatureStyle(e.id)},openPopup(i){return this._popup&&this._popup._prepareOpen(i||this._latlng)&&this._popup.openOn(this._map),this},openTooltip(i){return this._tooltip&&this._tooltip._prepareOpen(i)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this)),this}});const Ei={class:"layer-wrapper"},Oi=["title"],Ri=["title"],Ni=_e({__name:"addService",setup(i){const t=Se({count:0,name:"服务 1",url:"",type:"supermap_rest",layers:[]});function e(){const n=t.url,s=t.type,o=t.name;t.count++,t.name="服务 "+t.count;let a;try{switch(s){case"supermap_rest":case"supermap_tile":{a=Xe(n,{prjCoordSys:{epsgCode:3857},crs:p.CRS.EPSG3857});break}case"arcgis_rest":{a=Pi({url:n,f:"image"});break}case"arcgis_tile":{a=Ii({url:n});break}case"tms":{a=p.tileLayer(n);break}default:break}}catch{Ce.error("添加服务失败");return}a&&(Ht.emit("addLayer",a,o),t.layers.push({name:o,url:n,layer:a,id:Re()}))}function r(n){var s;(s=t.layers[n])!=null&&s.layer&&(Ht.emit("removeLayer",t.layers[n].layer),t.layers.splice(n,1))}return(n,s)=>{const o=be,a=Oe,l=Te,c=Le,h=Pe,y=Ee,g=Ae;return at(),lt(wt,null,[Z(t).layers.length?(at(),lt(wt,{key:0},[Ct("div",Ei,[(at(!0),lt(wt,null,xe(Z(t).layers,(v,w)=>(at(),lt("div",{key:v.id,class:"layer-item"},[Ct("div",{class:"layer-item-title",title:v.name},Wt(v.name),9,Oi),Ct("div",{class:"layer-item-url",title:v.url},Wt(v.url),9,Ri),M(o,{onClick:T=>r(w)},{default:H(()=>[Zt(" 移除 ")]),_:2},1032,["onClick"])]))),128))]),M(a)],64)):we("",!0),M(g,{colon:!1,class:"addService"},{default:H(()=>[M(c,{label:"服务名称"},{default:H(()=>[M(l,{modelValue:Z(t).name,"onUpdate:modelValue":s[0]||(s[0]=v=>Z(t).name=v)},null,8,["modelValue"])]),_:1}),M(c,{label:"服务地址"},{default:H(()=>[M(l,{modelValue:Z(t).url,"onUpdate:modelValue":s[1]||(s[1]=v=>Z(t).url=v)},null,8,["modelValue"])]),_:1}),M(c,{label:"服务类型"},{default:H(()=>[M(y,{modelValue:Z(t).type,"onUpdate:modelValue":s[2]||(s[2]=v=>Z(t).type=v)},{default:H(()=>[M(h,{value:"supermap_rest",label:"超图动态"}),M(h,{value:"supermap_tile",label:"超图切片"}),M(h,{value:"arcgis_rest",label:"ArcGIS 动态"}),M(h,{value:"arcgis_tile",label:"ArcGIS 切片"}),M(h,{value:"tms",label:"TMS"})]),_:1},8,["modelValue"])]),_:1}),M(c,{class:"formBtnItem"},{default:H(()=>[M(o,{type:"primary",onClick:e},{default:H(()=>[Zt(" 添加 ")]),_:1})]),_:1})]),_:1})],64)}}}),$i=Ie(Ni,[["__scopeId","data-v-a1dfd94d"]]);export{$i as default};
