import{bB as M,P as ft,b0 as mt,bC as ct,bA as P,bD as X,bz as C,aw as vt,Q as pt,k as gt,R as D,T as ht,n as _t,E as h,r as _,ai as A,K as c,an as T,x as u,F as f,t as W,v as k,w as v,G as yt,Y,L as Ct,N as $,W as Dt,X as J,Z as $t,H as Q,$ as wt,a0 as St}from"./index-DdH6q6SV.js";import{v as It}from"./el-loading-DD6CZNUk.js";import{E as xt}from"./el-dialog-Bh62SDAe.js";import{E as kt}from"./el-space-DYJG-lXk.js";import{V as U}from"./VanillaJsonEditor-DBYWY35f.js";import{u as G}from"./useComponentRef-BCZFAua8.js";import{P as Et}from"./Router-C4hKjnIW.js";import"./index--kSuBU8m.js";import"./el-popper-B_12Myl_.js";import"./index-ukcMG_GO.js";import"./jse-theme-dark-DmdhKcwA.js";import"./memoize-one.esm-BdPwpGay.js";import"./index-Cqq15VW-.js";import"./index-Vcq4gwWv.js";import"./last-D-rYfuUG.js";import"./map-wP416lLP.js";import"./_baseIteratee-CGDUxasU.js";import"./_baseEach-2eNG-2sy.js";import"./range-ChziTiCN.js";import"./toFinite-B8RrQge2.js";import"./_castFunction-DTD_kWns.js";import"./createFile-DuGnwZKp.js";import"./formatBytes-aAslYXQD.js";import"./clone-_BdSUHpY.js";import"./castArray-DfJK8VnQ.js";function bt(e,n,a){return e===e&&(a!==void 0&&(e=e<=a?e:a),n!==void 0&&(e=e>=n?e:n)),e}function Lt(e,n,a){return a===void 0&&(a=n,n=void 0),a!==void 0&&(a=M(a),a=a===a?a:0),n!==void 0&&(n=M(n),n=n===n?n:0),bt(M(e),n,a)}function K(e,n){e=e||32,n=n||"ABCDEFGHJKMNPQRSTWXYZabcdefghijkmnprstwxyz2345678";const a=n.length;let i="";for(let m=0;m<e;m++)i+=n.charAt(Math.floor(Math.random()*a));return i}const jt=new ct;let E={},Z=!1;const q=ft("jsonEditor",{persist:!0,state:()=>({leftId:null,rightId:null,splitterValue:.5,fullStatus:"",$_data:{}}),getters:{dataList:e=>n=>{const a=[];for(const i in e.$_data)a.push({_id:i,name:e.$_data[i].name,updated:C(e.$_data[i].updated).format("YYYY-MM-DD HH:mm")});return n?a.filter(i=>i.name.includes(n)):a},data:e=>n=>e.$_data[n]?{...e.$_data[n],updated:C(e.$_data[n].updated).format("YYYY-MM-DD HH:mm")}:null,leftData:e=>e.leftId&&e.$_data[e.leftId]?{...e.$_data[e.leftId],updated:C(e.$_data[e.leftId].updated).format("YYYY-MM-DD HH:mm")}:null,rightData:e=>e.rightId&&e.$_data[e.rightId]?{...e.$_data[e.rightId],updated:C(e.$_data[e.rightId].updated).format("YYYY-MM-DD HH:mm")}:null,syncCloud:()=>vt().logged&&pt().modules.jsonEditor.syncCloud},actions:{setSplitter(e=.5){this.splitterValue=Lt(e,0,1)},setFullStatus(e){e==="left"||e==="right"?this.fullStatus=e:this.fullStatus=""},replaceState(e=[]){const n={};for(const a of e)n[a.key]={name:a.name,content:{}},a.text!=null?n[a.key].content.text=a.text:a.json!=null&&(n[a.key].content.json=a.json),n[a.key].updated=C(a.updatedAt).format();this.$_data=n},async getSyncData(){try{const e=await P.get("/tools/jsoneditor");e.success?this.replaceState(e.data):console.log(e.message)}catch(e){console.log(e.message)}},syncData:mt(({id:e,data:n}={})=>{if(navigator.onLine)jt.enqueue(()=>P.post(`/tools/jsoneditor/${e}`,n));else if(E[e]=n,!Z){let a=function(){window.removeEventListener("online",a);for(const i in E)q().syncData({id:i,data:E[i]});E={}};Z=!0,window.addEventListener("online",a)}},500),saveData({left:e,right:n,id:a,content:i,name:m}={}){if(this.syncCloud&&(a=a||K(6),i!=null||m!=null)){const r={name:m||(this.$_data[a]||{}).name||`文档-${a}`};typeof i=="string"?r.text=i:typeof i=="object"&&(r.json=X(i)),this.syncData({id:a,data:r})}typeof i<"u"?(a=a||K(6),this.$_data[a]=this.$_data[a]||{},this.$_data[a].name=m||this.$_data[a].name||`文档-${a}`,typeof i=="string"?this.$_data[a].content={text:i}:this.$_data[a].content={json:X(i)},this.$_data[a].updated=C().format(),e&&(this.leftId=a),n&&(this.rightId=a)):a&&this.$_data[a]?(e&&(this.leftId=a),n&&(this.rightId=a),this.$_data[a].name=m||this.$_data[a].name):(e&&(this.leftId=null),n&&(this.rightId=null))},async deleteData({id:e}={}){if(this.syncCloud)try{const n=await P.delete(`/tools/jsoneditor/${e}`);n.success?(this.leftId===e&&(this.leftId=null),this.rightId===e&&(this.rightId=null),this.$_data[e]&&delete this.$_data[e]):console.log(n.message)}catch(n){console.log(n)}else this.leftId===e&&(this.leftId=null),this.rightId===e&&(this.rightId=null),this.$_data[e]&&delete this.$_data[e]}}}),Mt={"element-loading-text":"同步中...",class:"loadingPanel"},Pt={class:"dragIcon"},Yt={key:0,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"chevron-right",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},Nt={key:1,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"chevron-left",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},Vt={key:2,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"ellipsis-vertical",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 128 512"},Ft={class:"data-list"},Ht=["onClick"],zt={class:"data-list-item-info"},Bt={class:"data-list-item-info-title"},Rt={class:"data-list-item-info-description"},Xt={class:"data-list-item-actions"},At={class:"dialog-footer"},Tt=gt({__name:"jsonEditor",setup(e){const n=G(),a=G(),i=D(),m=D(!0),r=D(""),l=q(),O={array:[1,2,3],boolean:!0,color:"gold",null:null,number:123,object:{a:"b",c:"d"},string:"Hello World"};ht(()=>{tt()});async function tt(){l.syncCloud&&await l.getSyncData(),m.value=!1,l.leftData&&l.leftData.content?l.leftData.content.json?n.value?.set(l.leftData.content.json):l.leftData.content.text&&n.value?.set(l.leftData.content.text):n.value?.set(O),l.rightData&&l.rightData.content&&(l.rightData.content.json?a.value?.set(l.rightData.content.json):l.rightData.content.text&&a.value?.set(l.rightData.content.text)),r.value=l.fullStatus}function N(o){l.saveData({[o]:!0}),o==="left"?n.value?.set({}):o==="right"&&a.value?.set({})}function V(o,t){let d=null;o==="left"?d=l.leftId:o==="right"&&(d=l.rightId),d&&l.saveData({id:d,name:t})}function F(o,t){let d=null;o==="left"?d=l.leftId:o==="right"&&(d=l.rightId);const g={[o]:!0,content:t};d&&(g.id=d),l.saveData(g)}const y=D(!1),p=D(""),w=D("");let b="";const et=_t(()=>l.dataList(w.value));function H(o){p.value="",w.value="",b=o,y.value=!0}function at(){if(p.value){const o=l.data(p.value);if(o&&o.content){const t=o.content;b==="left"?(l.saveData({left:!0,id:p.value}),t.json?n.value?.set(t.json):t.text&&n.value?.set(t.text)):b==="right"&&(l.saveData({right:!0,id:p.value}),t.json?a.value?.set(t.json):t.text&&a.value?.set(t.text))}}y.value=!1}function z(o,{name:t,content:d}){l.saveData({[o]:!0,name:t,content:d}),o==="left"?n.value?.set(d):o==="right"&&a.value?.set(d)}function B(o){const t=o==="left"?l.leftId:l.rightId;t&&l.deleteData({id:t})}function nt(){const o=n.value?.get();o!=null&&a.value?.set(o)}function lt(){const o=a.value?.get();o!=null&&n.value?.set(o)}let L=0,S=0,j=!1;function R(o){if(o instanceof MouseEvent&&o.button!==0)return;const t=n.value?.container;t&&(j=!1,S=Number.parseFloat(window.getComputedStyle(t).width),Number.isNaN(S)&&(S=0),o instanceof TouchEvent?(L=o.touches[0].clientX,document.addEventListener("touchend",x),document.addEventListener("touchmove",I)):(L=o.clientX,document.addEventListener("mouseup",x),document.addEventListener("mousemove",I)))}function I(o){if(!i.value)return;j=!0;let t=0;o instanceof TouchEvent?t=o.touches[0].clientX:t=o.clientX;const d=S-L+t,g=Number.parseFloat(window.getComputedStyle(i.value).width);d<435?(r.value="right",r.value!==l.fullStatus&&l.setFullStatus("right")):g-100-d<435?(r.value="left",r.value!==l.fullStatus&&l.setFullStatus("left")):(r.value="",l.setSplitter(d/(g-100)),r.value!==l.fullStatus&&l.setFullStatus())}function x(){document.removeEventListener("mousemove",I),document.removeEventListener("touchmove",I),document.removeEventListener("mouseup",x),document.removeEventListener("touchend",x)}function ot(){i.value&&(j||(r.value==="left"?(l.setSplitter(1-435/(Number.parseFloat(window.getComputedStyle(i.value).width)-100)),r.value=""):r.value==="right"&&(l.setSplitter(435/(Number.parseFloat(window.getComputedStyle(i.value).width)-100)),r.value="")))}return(o,t)=>{const d=Ct,g=kt,st=Et,it=Dt,rt=xt,dt=It;return _(),h(Y,null,[A(f("div",Mt,null,512),[[T,u(m)],[dt,!0]]),A(f("div",{ref_key:"editorPanel",ref:i,class:"editorPanel"},[c(U,{ref_key:"editorPanelContainerLeft",ref:n,"show-menu-bar":"",class:k(["editorPanelContainer editorPanelContainerLeft",{full:u(r)==="left",hide:u(r)==="right"}]),style:W({flex:`${u(l).splitterValue} 1 0`}),name:u(l).leftData?.name,config:{mode:"text"},onChange:t[0]||(t[0]=s=>F("left",s)),onOpenRecent:t[1]||(t[1]=s=>H("left")),onOpen:t[2]||(t[2]=s=>z("left",s)),onCreate:t[3]||(t[3]=s=>N("left")),onChangeName:t[4]||(t[4]=s=>V("left",s)),onDelete:t[5]||(t[5]=s=>B("left"))},null,8,["class","style","name"]),f("div",{class:k(["controller noShowMobile",{full:u(r)}])},[c(g,{direction:"vertical"},{default:v(()=>[u(r)?yt("",!0):(_(),h(Y,{key:0},[t[17]||(t[17]=f("div",{class:"emptySpace"},null,-1)),c(d,{type:"primary",block:"",onClick:nt},{default:v(()=>t[15]||(t[15]=[$(" 复制 ",-1),f("span",{class:"i-icon-park-outline-right"},null,-1)])),_:1,__:[15]}),c(d,{type:"primary",block:"",onClick:lt},{default:v(()=>t[16]||(t[16]=[f("span",{class:"i-icon-park-outline-left"},null,-1),$(" 复制 ",-1)])),_:1,__:[16]})],64)),f("div",{class:"drag",onMousedown:R,onTouchstart:R,onClick:ot},[f("div",Pt,[u(r)==="right"?(_(),h("svg",Yt,t[18]||(t[18]=[f("path",{fill:"currentColor",d:"M96 480c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L242.8 256L73.38 86.63c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l192 192c12.5 12.5 12.5 32.75 0 45.25l-192 192C112.4 476.9 104.2 480 96 480z"},null,-1)]))):u(r)==="left"?(_(),h("svg",Nt,t[19]||(t[19]=[f("path",{fill:"currentColor",d:"M224 480c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25l192-192c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l169.4 169.4c12.5 12.5 12.5 32.75 0 45.25C240.4 476.9 232.2 480 224 480z"},null,-1)]))):(_(),h("svg",Vt,t[20]||(t[20]=[f("path",{fill:"currentColor",d:"M64 360C94.93 360 120 385.1 120 416C120 446.9 94.93 472 64 472C33.07 472 8 446.9 8 416C8 385.1 33.07 360 64 360zM64 200C94.93 200 120 225.1 120 256C120 286.9 94.93 312 64 312C33.07 312 8 286.9 8 256C8 225.1 33.07 200 64 200zM64 152C33.07 152 8 126.9 8 96C8 65.07 33.07 40 64 40C94.93 40 120 65.07 120 96C120 126.9 94.93 152 64 152z"},null,-1)])))])],32)]),_:1})],2),c(U,{ref_key:"editorPanelContainerRight",ref:a,"show-menu-bar":"",class:k(["editorPanelContainer noShowMobile editorPanelContainerRight",{full:u(r)==="right",hide:u(r)==="left"}]),style:W({flex:`${1-u(l).splitterValue} 1 0`}),name:u(l).rightData?.name,config:{mode:"tree"},onChange:t[6]||(t[6]=s=>F("right",s)),onOpenRecent:t[7]||(t[7]=s=>H("right")),onOpen:t[8]||(t[8]=s=>z("right",s)),onCreate:t[9]||(t[9]=s=>N("right")),onChangeName:t[10]||(t[10]=s=>V("right",s)),onDelete:t[11]||(t[11]=s=>B("right"))},null,8,["class","style","name"])],512),[[T,!u(m)]]),c(rt,{modelValue:u(y),"onUpdate:modelValue":t[14]||(t[14]=s=>J(y)?y.value=s:null),title:"打开最近"},{footer:v(()=>[f("span",At,[c(d,{onClick:t[13]||(t[13]=s=>y.value=!1)},{default:v(()=>t[23]||(t[23]=[$("取消",-1)])),_:1,__:[23]}),c(d,{type:"primary",onClick:at},{default:v(()=>t[24]||(t[24]=[$(" 确定 ",-1)])),_:1,__:[24]})])]),default:v(()=>[c(st,null,{default:v(()=>t[21]||(t[21]=[$("搜索",-1)])),_:1,__:[21]}),c(it,{modelValue:u(w),"onUpdate:modelValue":t[12]||(t[12]=s=>J(w)?w.value=s:null),placeholder:"请输入文档名称"},null,8,["modelValue"]),f("div",Ft,[(_(!0),h(Y,null,$t(u(et),s=>(_(),h("div",{key:s._id,class:k(["data-list-item",{selected:s._id===u(p)}]),onClick:ut=>p.value=s._id},[f("div",zt,[f("div",Bt,Q(s.name),1),f("div",Rt,Q(`最后修改: ${s.updated}`),1)]),f("div",Xt,[c(d,{type:"danger",onClick:wt(ut=>u(l).deleteData({id:s._id}),["stop"])},{default:v(()=>t[22]||(t[22]=[$(" 删除 ",-1)])),_:2,__:[22]},1032,["onClick"])])],10,Ht))),128))])]),_:1},8,["modelValue"])],64)}}}),ge=St(Tt,[["__scopeId","data-v-382b1951"]]);export{ge as default};
