import{h as X,aR as J,_ as O,k as I,ca as Q,n as B,aE as P,u as Z,E as k,r as m,q as x,G as $,s as T,w as i,y as ee,x as o,aN as te,v as A,z as ae,R as b,a4 as Y,T as le,aa as re,a7 as ne,bn as z,bm as L,aA as p,F as U,ai as se,K as n,W as oe,N as y,L as ie,H as D,Y as V,X as N,a0 as ue}from"./index-CG8Xhv7v.js";import{v as de}from"./el-loading-BdI-5mZK.js";import{E as pe}from"./el-pagination-eqfno_Ie.js";/* empty css               */import"./el-select-B7MGzNXm.js";import"./el-popper-DZR2K7yN.js";import{E as me,a as ce}from"./el-table-column-B4MBozaw.js";import"./el-checkbox-COhdTtip.js";import"./el-tooltip-l0sNRNKZ.js";import{E as fe}from"./el-popover-BdIs4eoa.js";import"./Router-Cn2HKYA9.js";import"./index-BhMAMU7-.js";import"./strings-lrnfZ0hZ.js";import"./castArray-BczT6YY5.js";import"./_baseIteratee-DsCp5G5U.js";import"./index-d_zk_s1o.js";import"./index-Al8x0y5d.js";import"./isUndefined-DCTLXrZ8.js";import"./map-CPnAUF2S.js";import"./_baseEach-Bn8yrTkb.js";import"./raf-CaN5SdV9.js";const ye=X({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:[Boolean,String],values:[!0,!1,"always","never","hover"],default:"hover"},disabled:Boolean,href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:J}}),ke={click:h=>h instanceof MouseEvent},ve=I({name:"ElLink"}),ge=I({...ve,props:ye,emits:ke,setup(h,{emit:E}){const r=h;Q({scope:"el-link",from:"The underline option (boolean)",replacement:"'always' | 'hover' | 'never'",version:"3.0.0",ref:"https://element-plus.org/en-US/component/link.html#underline"},B(()=>P(r.underline)));const s=Z("link"),C=B(()=>[s.b(),s.m(r.type),s.is("disabled",r.disabled),s.is("underline",v.value==="always"),s.is("hover-underline",v.value==="hover"&&!r.disabled)]),v=B(()=>P(r.underline)?r.underline?"hover":"never":r.underline);function f(l){r.disabled||E("click",l)}return(l,c)=>(m(),k("a",{class:A(o(C)),href:l.disabled||!l.href?void 0:l.href,target:l.disabled||!l.href?void 0:l.target,onClick:f},[l.icon?(m(),x(o(te),{key:0},{default:i(()=>[(m(),x(ee(l.icon)))]),_:1})):$("v-if",!0),l.$slots.default?(m(),k("span",{key:1,class:A(o(s).e("inner"))},[T(l.$slots,"default")],2)):$("v-if",!0),l.$slots.icon?T(l.$slots,"icon",{key:2}):$("v-if",!0)],10,["href","target"]))}});var _e=O(ge,[["__file","link.vue"]]);const we=ae(_e),be={"h-full":"",flex:"","flex-col":"","gap-4":""},he={class:"new-url-form"},Ee="https://url.iszy.xyz",Ce=I({__name:"urls",setup(h){const E=b([]),r=b(10),s=b(1),C=b(0),v=b(!1),f=Y({}),l=Y({}),c=Y({keyword:"",url:""});le(()=>{g(s.value-1,r.value)}),re(()=>{g(s.value-1,r.value)}),ne(r,()=>{s.value=1});async function g(a,e){const _=setTimeout(()=>{v.value=!0},300);try{const d=await z.get("/urls/admin/urls",{params:{pageIndex:a,pageSize:e}});d.success?(C.value=d.data.count,E.value=d.data.rows.map(u=>(u.createdAt=L(u.createdAt).format("YYYY年MM月DD日 HH:mm"),u.updatedAt=L(u.updatedAt).format("YYYY年MM月DD日 HH:mm"),u))):p.error(d.message)}catch(d){p.error(d.message)}clearTimeout(_),v.value=!1}async function H(){if(c.url)try{const a=await z.post("/urls/admin/url",{url:c.url,keyword:c.keyword});a.success?(p.success("创建成功"),c.url="",c.keyword="",await g(s.value-1,r.value)):p.error(a.message)}catch(a){p.error(a.message)}}async function R(a){try{const e=await z.put(`/urls/admin/url/${a.keyword}`,{url:l[a.keyword]});e.success?(p.success("更新成功"),a.url=l[a.keyword],f[a.keyword]=!1,await g(s.value-1,r.value)):p.error(e.message)}catch(e){p.error(e.message)}}async function F(a){try{const e=await z.delete(`/urls/admin/url/${a.keyword}`,{params:{keyword:a.keyword}});e.success?(await g(s.value-1,r.value),p.success("删除成功")):p.error(e.message)}catch(e){p.error(e.message)}}function M(a){f[a.keyword]=!f[a.keyword],f[a.keyword]&&(l[a.keyword]=a.url)}function K(a){return(s.value-1)*r.value+a+1}return(a,e)=>{const _=oe,d=ie,u=me,S=we,j=fe,q=ce,G=pe,W=de;return m(),k("div",be,[U("div",he,[e[5]||(e[5]=U("span",null," 输入链接: ",-1)),n(_,{modelValue:o(c).url,"onUpdate:modelValue":e[0]||(e[0]=t=>o(c).url=t),placeholder:"https",clearable:"","flex-1":""},null,8,["modelValue"]),e[6]||(e[6]=U("span",null," 自定义短网址(选): ",-1)),n(_,{modelValue:o(c).keyword,"onUpdate:modelValue":e[1]||(e[1]=t=>o(c).keyword=t),clearable:""},null,8,["modelValue"]),n(d,{type:"primary",onClick:H},{default:i(()=>e[4]||(e[4]=[y(" 缩短 ")])),_:1,__:[4]})]),se((m(),x(q,{data:o(E),border:!0,stripe:!0,size:"small","flex-1":""},{default:i(()=>[n(u,{type:"index",index:K,fixed:"left"}),n(u,{prop:"keyword",label:"短网址",width:"100",fixed:"left"},{default:i(({row:t})=>[n(S,{href:`${Ee}/${t.keyword}`,target:"_blank",style:{"white-space":"nowrap"}},{default:i(()=>[y(D(t.keyword),1)]),_:2},1032,["href"])]),_:1}),n(u,{prop:"url",label:"原网址","min-width":"300"},{default:i(({row:t})=>[o(f)[t.keyword]?(m(),x(_,{key:1,modelValue:o(l)[t.keyword],"onUpdate:modelValue":w=>o(l)[t.keyword]=w},null,8,["modelValue","onUpdate:modelValue"])):(m(),k(V,{key:0},[t.title?(m(),k(V,{key:0},[n(S,{href:t.url,target:"_blank"},{default:i(()=>[y(D(t.title),1)]),_:2},1032,["href"]),e[7]||(e[7]=U("br",null,null,-1))],64)):$("",!0),n(S,{href:t.url,target:"_blank"},{default:i(()=>[y(D(t.url),1)]),_:2},1032,["href"])],64))]),_:1}),n(u,{prop:"createdAt",label:"日期",width:"180"}),n(u,{prop:"ip",label:"IP",width:"130"}),n(u,{prop:"clicks",label:"点击次数",width:"80"}),n(u,{label:"操作",width:"140",fixed:"right"},{default:i(({row:t})=>[o(f)[t.keyword]?(m(),k(V,{key:1},[n(d,{size:"small",onClick:w=>M(t)},{default:i(()=>e[10]||(e[10]=[y(" 取消 ")])),_:2,__:[10]},1032,["onClick"]),n(d,{size:"small",type:"primary",onClick:w=>R(t)},{default:i(()=>e[11]||(e[11]=[y(" 更新 ")])),_:2,__:[11]},1032,["onClick"])],64)):(m(),k(V,{key:0},[n(d,{size:"small",onClick:w=>M(t)},{default:i(()=>e[8]||(e[8]=[y(" 编辑 ")])),_:2,__:[8]},1032,["onClick"]),n(j,{width:"160",title:"删除后无法恢复！","confirm-button-type":"danger","confirm-button-text":"删除",onConfirm:w=>F(t)},{reference:i(()=>[n(d,{size:"small",type:"danger"},{default:i(()=>e[9]||(e[9]=[y(" 删除 ")])),_:1,__:[9]})]),_:2},1032,["onConfirm"])],64))]),_:1})]),_:1},8,["data"])),[[W,o(v)]]),n(G,{"current-page":o(s),"onUpdate:currentPage":e[2]||(e[2]=t=>N(s)?s.value=t:null),"page-size":o(r),"onUpdate:pageSize":e[3]||(e[3]=t=>N(r)?r.value=t:null),small:"",background:"",layout:"prev, pager, next",total:o(C)},null,8,["current-page","page-size","total"])])}}}),qe=ue(Ce,[["__scopeId","data-v-8b60c8af"]]);export{qe as default};
