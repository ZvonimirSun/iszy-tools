import{h as G,aR as X,_ as J,k as D,u as O,n as Q,E as y,r as m,q as B,G as x,s as L,w as i,y as Z,x as n,aN as ee,v as N,z as te,R as b,a4 as M,T as ae,aa as le,a7 as se,aW as C,ax as U,aA as p,F as z,ai as re,K as s,W as oe,N as c,L as ne,H as S,Y as V,X as P,a0 as ie}from"./index-eMN9lPih.js";import{v as de}from"./el-loading-CrJo_T7M.js";import{E as ue}from"./el-pagination-CYDBhvnp.js";/* empty css               */import"./el-select-CwaSEIVJ.js";import"./el-popper-CGZvDMsY.js";import{E as pe,a as me}from"./el-table-column-D6LCOqjB.js";import"./el-checkbox-g3J3YW9L.js";import"./el-tooltip-l0sNRNKZ.js";import{E as fe}from"./el-popover-DgCSOrw1.js";import{d as T}from"./dayjs.min-CgExnJ5j.js";import"./Router-BAUhBh-Z.js";import"./index-Blznacp8.js";import"./strings-R8svcLMW.js";import"./castArray-CRfAPi9R.js";import"./_baseIteratee-8aZWBd14.js";import"./index-BmdM04ue.js";import"./index-CZGLwI9R.js";import"./isUndefined-DCTLXrZ8.js";import"./map-OuS4_hYW.js";import"./_baseEach-0j_OKXKz.js";import"./raf-BKiG_hjg.js";const ce=G({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:Boolean,href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:X}}),ye={click:E=>E instanceof MouseEvent},ke=D({name:"ElLink"}),ge=D({...ke,props:ce,emits:ye,setup(E,{emit:$}){const r=E,o=O("link"),h=Q(()=>[o.b(),o.m(r.type),o.is("disabled",r.disabled),o.is("underline",r.underline&&!r.disabled)]);function g(l){r.disabled||$("click",l)}return(l,k)=>(m(),y("a",{class:N(n(h)),href:l.disabled||!l.href?void 0:l.href,target:l.disabled||!l.href?void 0:l.target,onClick:g},[l.icon?(m(),B(n(ee),{key:0},{default:i(()=>[(m(),B(Z(l.icon)))]),_:1})):x("v-if",!0),l.$slots.default?(m(),y("span",{key:1,class:N(n(o).e("inner"))},[L(l.$slots,"default")],2)):x("v-if",!0),l.$slots.icon?L(l.$slots,"icon",{key:2}):x("v-if",!0)],10,["href","target"]))}});var ve=J(ge,[["__file","link.vue"]]);const we=te(ve),_e={"h-full":"",flex:"","flex-col":"","gap-4":""},be={class:"new-url-form"},Ee="https://url.iszy.xyz",$e=D({__name:"urls",setup(E){const $=b([]),r=b(10),o=b(1),h=b(0),g=b(!1),l=M({}),k=M({}),f=M({keyword:"",url:""});ae(()=>{v(o.value-1,r.value)}),le(()=>{v(o.value-1,r.value)}),se(r,()=>{o.value=1});async function v(a,e){const w=setTimeout(()=>{g.value=!0},300);try{const u=(await C.get(`${U.apiBaseUrl}/urls/admin/urls`,{params:{pageIndex:a,pageSize:e}})).data;u.success?(h.value=u.data.count,$.value=u.data.rows.map(d=>(d.createdAt=T(d.createdAt).format("YYYY年MM月DD日 HH:mm"),d.updatedAt=T(d.updatedAt).format("YYYY年MM月DD日 HH:mm"),d))):p.error(u.message)}catch(u){p.error(u.message)}clearTimeout(w),g.value=!1}async function A(){if(f.url)try{const a=(await C.post(`${U.apiBaseUrl}/urls/admin/url`,{url:f.url,keyword:f.keyword})).data;a.success?(p.success("创建成功"),f.url="",f.keyword="",await v(o.value-1,r.value)):p.error(a.message)}catch(a){p.error(a.message)}}async function H(a){try{const e=(await C.put(`${U.apiBaseUrl}/urls/admin/url/${a.keyword}`,{url:k[a.keyword]})).data;e.success?(p.success("更新成功"),a.url=k[a.keyword],l[a.keyword]=!1,await v(o.value-1,r.value)):p.error(e.message)}catch(e){p.error(e.message)}}async function R(a){try{const e=(await C.delete(`${U.apiBaseUrl}/urls/admin/url/${a.keyword}`,{params:{keyword:a.keyword}})).data;e.success?(await v(o.value-1,r.value),p.success("删除成功")):p.error(e.message)}catch(e){p.error(e.message)}}function I(a){l[a.keyword]=!l[a.keyword],l[a.keyword]&&(k[a.keyword]=a.url)}function F(a){return(o.value-1)*r.value+a+1}return(a,e)=>{const w=oe,u=ne,d=pe,Y=we,K=fe,W=me,j=ue,q=de;return m(),y("div",_e,[z("div",be,[e[5]||(e[5]=z("span",null," 输入链接: ",-1)),s(w,{modelValue:n(f).url,"onUpdate:modelValue":e[0]||(e[0]=t=>n(f).url=t),placeholder:"https",clearable:"","flex-1":""},null,8,["modelValue"]),e[6]||(e[6]=z("span",null," 自定义短网址(选): ",-1)),s(w,{modelValue:n(f).keyword,"onUpdate:modelValue":e[1]||(e[1]=t=>n(f).keyword=t),clearable:""},null,8,["modelValue"]),s(u,{type:"primary",onClick:A},{default:i(()=>e[4]||(e[4]=[c(" 缩短 ")])),_:1})]),re((m(),B(W,{data:n($),border:!0,stripe:!0,size:"small","flex-1":""},{default:i(()=>[s(d,{type:"index",index:F,fixed:"left"}),s(d,{prop:"keyword",label:"短网址",width:"100",fixed:"left"},{default:i(({row:t})=>[s(Y,{href:`${Ee}/${t.keyword}`,target:"_blank",style:{"white-space":"nowrap"}},{default:i(()=>[c(S(t.keyword),1)]),_:2},1032,["href"])]),_:1}),s(d,{prop:"url",label:"原网址","min-width":"300"},{default:i(({row:t})=>[n(l)[t.keyword]?(m(),B(w,{key:1,modelValue:n(k)[t.keyword],"onUpdate:modelValue":_=>n(k)[t.keyword]=_},null,8,["modelValue","onUpdate:modelValue"])):(m(),y(V,{key:0},[t.title?(m(),y(V,{key:0},[s(Y,{href:t.url,target:"_blank"},{default:i(()=>[c(S(t.title),1)]),_:2},1032,["href"]),e[7]||(e[7]=z("br",null,null,-1))],64)):x("",!0),s(Y,{href:t.url,target:"_blank"},{default:i(()=>[c(S(t.url),1)]),_:2},1032,["href"])],64))]),_:1}),s(d,{prop:"createdAt",label:"日期",width:"180"}),s(d,{prop:"ip",label:"IP",width:"130"}),s(d,{prop:"clicks",label:"点击次数",width:"80"}),s(d,{label:"操作",width:"140",fixed:"right"},{default:i(({row:t})=>[n(l)[t.keyword]?(m(),y(V,{key:1},[s(u,{size:"small",onClick:_=>I(t)},{default:i(()=>e[10]||(e[10]=[c(" 取消 ")])),_:2},1032,["onClick"]),s(u,{size:"small",type:"primary",onClick:_=>H(t)},{default:i(()=>e[11]||(e[11]=[c(" 更新 ")])),_:2},1032,["onClick"])],64)):(m(),y(V,{key:0},[s(u,{size:"small",onClick:_=>I(t)},{default:i(()=>e[8]||(e[8]=[c(" 编辑 ")])),_:2},1032,["onClick"]),s(K,{width:"160",title:"删除后无法恢复！","confirm-button-type":"danger","confirm-button-text":"删除",onConfirm:_=>R(t)},{reference:i(()=>[s(u,{size:"small",type:"danger"},{default:i(()=>e[9]||(e[9]=[c(" 删除 ")])),_:1})]),_:2},1032,["onConfirm"])],64))]),_:1})]),_:1},8,["data"])),[[q,n(g)]]),s(j,{"current-page":n(o),"onUpdate:currentPage":e[2]||(e[2]=t=>P(o)?o.value=t:null),"page-size":n(r),"onUpdate:pageSize":e[3]||(e[3]=t=>P(r)?r.value=t:null),small:"",background:"",layout:"prev, pager, next",total:n(h)},null,8,["current-page","page-size","total"])])}}}),je=ie($e,[["__scopeId","data-v-8ef67c26"]]);export{je as default};
