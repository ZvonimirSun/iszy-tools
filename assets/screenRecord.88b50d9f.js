import{S as e,B as a,Z as t,V as s,Y as i,p as r,j as l,T as o,r as d,c as n,w as c,o as u,I as p,b as h,k as b,J as v,a2 as m,M as f,a as S,e as g}from"./vendor.6b1bd83d.js";/* empty css              *//* empty css              *//* empty css              *//* empty css              */import{_ as w}from"./container.12771c7e.js";import"./index.0cf6f247.js";var y=".previewVideo[data-v-2eca2e34] {\n  background: #dedede;\n  margin: 0 auto;\n  display: block;\n  width: 100%;\n  max-width: 120rem;\n  position: relative;\n}\n.previewVideo video[data-v-2eca2e34] {\n  width: 100%;\n}\n.previewVideo .rec[data-v-2eca2e34] {\n  display: block;\n  position: absolute;\n  top: 0;\n  left: 0;\n  font-size: 1.4rem;\n  line-height: 2.2rem;\n  height: 2.2rem;\n  width: 4.4rem;\n  background: red;\n  color: #fff;\n  text-align: center;\n}\n.operations[data-v-2eca2e34] {\n  width: 100%;\n  margin-top: 0.8rem;\n  justify-content: center;\n  flex-wrap: wrap;\n}";const{Title:k}=o,{Item:C}=s,R="unstart",_="recording",M="paused",U="stopped",D={name:"screenRecord",components:{Container:w,Title:k,Space:e,Button:a,Divider:t,Form:s,FormItem:C,Select:i},data:()=>({recorder:null,screenShareVideoElement:null,localScreenShareStream:null,disabled:{open:!1,start:!0,pause:!0,resume:!0,stop:!0,download:!0},status:"unstart",chunks:[],blobUrl:"",recordAudio:"never",recordAudioOptions:[{label:"否",value:"never"},{label:"是",value:"always"}],recordMicro:"never",recordMicroOptions:[{label:"否",value:"never"},{label:"是",value:"always"}],aspectRatio:"default",aspectRatioList:[{label:"默认",value:"default"},{label:"16:9",value:1.77},{label:"4:3",value:1.33},{label:"21:9",value:2.35},{label:"14:10",value:1.4},{label:"19:10",value:1.9}],frameRate:"default",frameRateList:[{label:"默认",value:"default"},{label:"60",value:60},{label:"30",value:30},{label:"25",value:25},{label:"15",value:15},{label:"5",value:5}],resolutions:"default",resolutionsList:[{label:"默认",value:"default"},{label:"屏幕尺寸",value:"fit-screen"},{label:"4K",value:"4k"},{label:"1080p",value:"1080p"},{label:"720p",value:"720p"}],cursor:"default",cursorList:[{label:"默认",value:"default"},{label:"总是显示",value:"always"},{label:"移动时显示",value:"motion"},{label:"从不显示",value:"never"}]}),computed:{supportedConstraints:()=>navigator&&navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints?navigator.mediaDevices.getSupportedConstraints():{},isScreenShareSupported:()=>Boolean(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia),isWebRTCSupported:()=>Boolean(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),isSupported(){return this.isScreenShareSupported&&this.isWebRTCSupported},showREC(){return"recording"===this.status},displayMediaOptions(){const e={};return"default"!==this.aspectRatio&&(e.aspectRatio=this.aspectRatio),"default"!==this.frameRate&&(e.frameRate=this.frameRate),"default"!==this.cursor&&(e.cursor=this.cursor),"default"!==this.resolutions&&("fit-screen"===this.resolutions&&(e.width=screen.width,e.height=screen.height),"4K"===this.resolutions&&(e.width=3840,e.height=2160),"1080p"===this.resolutions&&(e.width=1920,e.height=1080),"720p"===this.resolutions&&(e.width=1280,e.height=720)),{video:e,audio:"always"===this.recordAudio}}},mounted(){this.screenShareVideoElement=this.$refs.screenShare},methods:{async openScreenShare(){try{if(this.localScreenShareStream=await navigator.mediaDevices.getDisplayMedia(this.displayMediaOptions),"always"===this.recordMicro){const e=await navigator.mediaDevices.getUserMedia({audio:!0});this.localScreenShareStream.addTrack(e.getAudioTracks()[0])}const e=this.localScreenShareStream.getVideoTracks()[0];e&&(e.onended=this.onScreenShareEnded,e.onmute=this.onScreenShareEnded),this.recorder=new MediaRecorder(this.localScreenShareStream),this.recorder.onstop=this.onRecordStopped,this.recorder.ondataavailable=this.onDataAvailable,this.screenShareVideoElement.srcObject=this.localScreenShareStream,this.screenShareVideoElement.muted=!0,this.disabled.open=!0,this.disabled.start=!1}catch(e){this.$msg.error(e.message)}},start(){this.recorder.start(),this.status="recording",this.disabled.start=!0,this.disabled.pause=!1,this.disabled.stop=!1},pause(){this.recorder.pause(),this.status="paused",this.disabled.pause=!0,this.disabled.resume=!1},resume(){this.recorder.resume(),this.status="recording",this.disabled.pause=!1,this.disabled.resume=!0},stop(){this.recorder&&"inactive"!==this.recorder.state&&this.recorder.stop(),this.status="stopped",this.disabled.start=!1,this.disabled.pause=!0,this.disabled.resume=!0,this.disabled.stop=!0},download(){if(this.blobUrl){const e=document.createElement("a");e.href=this.blobUrl,e.download="screen-record.mp4",e.click()}},onScreenShareEnded(){if(this.stop(),this.localScreenShareStream){this.localScreenShareStream.getTracks().forEach((e=>{e.stop()}));this.$msg.info("屏幕分享结束"),this.localScreenShareStream=null,this.screenShareVideoElement.srcObject=null,this.disabled.open=!1,this.disabled.start=!0}},onRecordStopped(){const e=new Blob(this.chunks,{type:"video/mp4"});this.blobUrl=URL.createObjectURL(e),this.disabled.download=!1,this.chunks=[]},onDataAvailable(e){this.chunks.push(e.data)},selectAudio(){this.recordAudio&&this.recordMicro&&(this.recordMicro="never")},selectMicro(){this.recordAudio&&this.recordMicro&&(this.recordAudio="never")}},beforeUnmount(){this.stop()}};r("data-v-2eca2e34");const A=g("实时预览"),E={class:"previewVideo"},j={autoplay:"",ref:"screenShare"},V={class:"rec"},x=g("开启屏幕共享"),T=g("开始录制"),L=g("暂停"),O=g("继续"),B=g("停止"),I=g("下载"),F=g("结果"),W={class:"previewVideo"},$=["src"],z=g("设置"),K=g("你的浏览器不支持WebRTC，请安装最新版本Chrome后重试。");function J(e,a,t,s,i,r){const l=d("Title"),o=d("Button"),g=d("Space"),w=d("Divider"),y=d("Select"),k=d("FormItem"),C=d("Form"),R=d("container");return u(),n(R,null,{default:c((()=>[r.isSupported?(u(),p(f,{key:0},[h(l,{level:3},{default:c((()=>[A])),_:1}),b("div",E,[b("video",j,null,512),v(b("span",V,"REC",512),[[m,r.showREC]])]),h(g,{size:8,class:"operations"},{default:c((()=>[h(o,{onClick:r.openScreenShare,type:"primary",disabled:e.disabled.open},{default:c((()=>[x])),_:1},8,["onClick","disabled"]),h(o,{onClick:r.start,type:"primary",disabled:e.disabled.start},{default:c((()=>[T])),_:1},8,["onClick","disabled"]),h(o,{onClick:r.pause,type:"primary",disabled:e.disabled.pause},{default:c((()=>[L])),_:1},8,["onClick","disabled"]),h(o,{onClick:r.resume,type:"primary",disabled:e.disabled.resume},{default:c((()=>[O])),_:1},8,["onClick","disabled"]),h(o,{onClick:r.stop,type:"primary",disabled:e.disabled.stop},{default:c((()=>[B])),_:1},8,["onClick","disabled"]),h(o,{onClick:r.download,type:"primary",disabled:e.disabled.download},{default:c((()=>[I])),_:1},8,["onClick","disabled"])])),_:1}),e.blobUrl?(u(),p(f,{key:0},[h(w),h(l,{level:3},{default:c((()=>[F])),_:1}),b("div",W,[b("video",{controls:"",src:e.blobUrl},null,8,$)])],64)):S("",!0),h(w),h(l,{level:3},{default:c((()=>[z])),_:1}),h(C,{labelCol:{sm:{span:5},md:{span:4},lg:{span:3},xxl:{span:2}}},{default:c((()=>[h(k,{label:"系统音频"},{default:c((()=>[h(y,{value:e.recordAudio,"onUpdate:value":a[0]||(a[0]=a=>e.recordAudio=a),disabled:e.disabled.open,options:e.recordAudioOptions,onChange:r.selectAudio},null,8,["value","disabled","options","onChange"])])),_:1}),h(k,{label:"麦克风"},{default:c((()=>[h(y,{value:e.recordMicro,"onUpdate:value":a[1]||(a[1]=a=>e.recordMicro=a),disabled:e.disabled.open,options:e.recordMicroOptions,onChange:r.selectMicro},null,8,["value","disabled","options","onChange"])])),_:1}),r.supportedConstraints.aspectRatio?(u(),n(k,{key:0,label:"选择长宽比"},{default:c((()=>[h(y,{value:e.aspectRatio,"onUpdate:value":a[2]||(a[2]=a=>e.aspectRatio=a),disabled:e.disabled.open,options:e.aspectRatioList},null,8,["value","disabled","options"])])),_:1})):S("",!0),r.supportedConstraints.frameRate?(u(),n(k,{key:1,label:"选择帧率"},{default:c((()=>[h(y,{value:e.frameRate,"onUpdate:value":a[3]||(a[3]=a=>e.frameRate=a),disabled:e.disabled.open,options:e.frameRateList},null,8,["value","disabled","options"])])),_:1})):S("",!0),r.supportedConstraints.width&&r.supportedConstraints.height?(u(),n(k,{key:2,label:"选择分辨率"},{default:c((()=>[h(y,{value:e.resolutions,"onUpdate:value":a[4]||(a[4]=a=>e.resolutions=a),disabled:e.disabled.open,options:e.resolutionsList},null,8,["value","disabled","options"])])),_:1})):S("",!0),h(k,{label:"是否显示光标"},{default:c((()=>[h(y,{value:e.cursor,"onUpdate:value":a[5]||(a[5]=a=>e.cursor=a),disabled:e.disabled.open,options:e.cursorList},null,8,["value","disabled","options"])])),_:1})])),_:1})],64)):(u(),n(l,{key:1,level:3},{default:c((()=>[K])),_:1}))])),_:1})}l(),D.render=J,D.__scopeId="data-v-2eca2e34";export{D as default};
