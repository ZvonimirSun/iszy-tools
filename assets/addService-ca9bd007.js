import{as as Y,C as se,_ as oe,h as ae,A as le,o as it,l as nt,H as pt,m as dt,I as ue,a as M,s as he,w as D,t as bt,b as V,E as fe,B as ce}from"./index-bf1b9cab.js";import{E as pe,a as de}from"./el-form-item-479c9552.js";import"./el-tag-9e3a002b.js";import{E as ye,a as me}from"./el-select-1fdd5e16.js";import"./el-scrollbar-76a3c665.js";import"./el-popper-51ee63d5.js";import{E as ge}from"./el-divider-0dbce81a.js";import{L as b,l as g}from"./leaflet-src-a05a2b8a.js";import{v as ve}from"./v4-fcc3550a.js";import"./strings-0eb7a223.js";import"./isEqual-650fac00.js";var j={startsWith:function(r,t){return r.indexOf(t)==0},contains:function(r,t){return r.indexOf(t)!=-1},trim:function(r){return r.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(r){for(var t=r.split("-"),e=t[0],i=1,n=t.length;i<n;i++){var s=t[i];e+=s.charAt(0).toUpperCase()+s.substring(1)}return e},format:function(r,t,e){t||(t=window);var i=function(n,s){for(var o,l=s.split(/\.+/),u=0;u<l.length;u++)u==0&&(o=t),o=o[l[u]];return typeof o=="function"&&(o=e?o.apply(null,e):o()),typeof o>"u"?"undefined":o};return r.replace(j.tokenRegEx,i)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(r){return j.numberRegEx.test(r)},numericIf:function(r){return j.isNumeric(r)?parseFloat(r):r}},yt={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(r,t){var e=0;return t>0&&(e=parseFloat(r.toPrecision(t))),e},format:function(r,t,e,i){t=typeof t<"u"?t:0,e=typeof e<"u"?e:yt.thousandsSeparator,i=typeof i<"u"?i:yt.decimalSeparator,t!=null&&(r=parseFloat(r.toFixed(t)));var n=r.toString().split(".");n.length===1&&t==null&&(t=0);var s=n[0];if(e)for(var o=/(-?[0-9]+)([0-9]{3})/;o.test(s);)s=s.replace(o,"$1"+e+"$2");var l;if(t==0)l=s;else{var u=n.length>1?n[1]:"0";t!=null&&(u=u+new Array(t-u.length+1).join("0")),l=s+i+u}return l}};Number.prototype.limitSigDigs||(Number.prototype.limitSigDigs=function(r){return yt.limitSigDigs(this,r)});class rt{constructor(){this.CLASS_NAME="SuperMap.Geometry",this.id=v.createUniqueID(this.CLASS_NAME+"_"),this.parent=null,this.bounds=null,this.SRID=null}destroy(){this.id=null,this.bounds=null,this.SRID=null}clone(){return new rt}setBounds(t){t&&(this.bounds=t.clone())}clearBounds(){this.bounds=null,this.parent&&this.parent.clearBounds()}extendBounds(t){var e=this.getBounds();e?this.bounds.extend(t):this.setBounds(t)}getBounds(){return this.bounds==null&&this.calculateBounds(),this.bounds}calculateBounds(){}getVertices(t){}getArea(){return 0}}const Ut=function(){var r="",t="",e="pc",i,n=navigator.userAgent.toLowerCase();return n.indexOf("msie")>-1||n.indexOf("trident")>-1&&n.indexOf("rv")>-1?(r="msie",i=n.match(/msie ([\d.]+)/)||n.match(/rv:([\d.]+)/)):n.indexOf("chrome")>-1?(r="chrome",i=n.match(/chrome\/([\d.]+)/)):n.indexOf("firefox")>-1?(r="firefox",i=n.match(/firefox\/([\d.]+)/)):n.indexOf("opera")>-1?(r="opera",i=n.match(/version\/([\d.]+)/)):n.indexOf("safari")>-1&&(r="safari",i=n.match(/version\/([\d.]+)/)),t=i?i[1]:"",n.indexOf("ipad")>-1||n.indexOf("ipod")>-1||n.indexOf("iphone")>-1?e="apple":n.indexOf("android")>-1&&(i=n.match(/version\/([\d.]+)/),t=i?i[1]:"",e="android"),{name:r,version:t,device:e}}(),Se=function(){var r=!0,t=Ut;return document.createElement("canvas").getContext?(t.name==="firefox"&&parseFloat(t.version)<5&&(r=!1),t.name==="safari"&&parseFloat(t.version)<4&&(r=!1),t.name==="opera"&&parseFloat(t.version)<10&&(r=!1),t.name==="msie"&&parseFloat(t.version)<9&&(r=!1)):r=!1,r}();(function(){var r=navigator.userAgent.toLowerCase();return r.indexOf("webkit")===-1&&r.indexOf("gecko")!==-1})();const Lt=96,v={extend:function(r,t){if(r=r||{},t){for(var e in t){var i=t[e];i!==void 0&&(r[e]=i)}var n=typeof window.Event=="function"&&t instanceof window.Event;!n&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(r.toString=t.toString)}return r},copy:function(r,t){r=r||{};var e;if(t)for(var i in r)e=t[i],typeof e<"u"&&(r[i]=e)},reset:function(r){r=r||{};for(var t in r)if(r.hasOwnProperty(t)){if(typeof r[t]=="object"&&r[t]instanceof Array){for(var e in r[t])r[t][e].destroy&&r[t][e].destroy();r[t].length=0}else typeof r[t]=="object"&&r[t]instanceof Object&&r[t].destroy&&r[t].destroy();r[t]=null}},getElement:function(){for(var r=[],t=0,e=arguments.length;t<e;t++){var i=arguments[t];if(typeof i=="string"&&(i=document.getElementById(i)),arguments.length===1)return i;r.push(i)}return r},isElement:function(r){return!!(r&&r.nodeType===1)},isArray:function(r){return Object.prototype.toString.call(r)==="[object Array]"},removeItem:function(r,t){for(var e=r.length-1;e>=0;e--)r[e]===t&&r.splice(e,1);return r},indexOf:function(r,t){if(r==null)return-1;if(typeof r.indexOf=="function")return r.indexOf(t);for(var e=0,i=r.length;e<i;e++)if(r[e]===t)return e;return-1},modifyDOMElement:function(r,t,e,i,n,s,o,l){t&&(r.id=t),e&&(r.style.left=e.x+"px",r.style.top=e.y+"px"),i&&(r.style.width=i.w+"px",r.style.height=i.h+"px"),n&&(r.style.position=n),s&&(r.style.border=s),o&&(r.style.overflow=o),parseFloat(l)>=0&&parseFloat(l)<1?(r.style.filter="alpha(opacity="+l*100+")",r.style.opacity=l):parseFloat(l)===1&&(r.style.filter="",r.style.opacity="")},applyDefaults:function(r,t){r=r||{};var e=typeof window.Event=="function"&&t instanceof window.Event;for(var i in t)(r[i]===void 0||!e&&t.hasOwnProperty&&t.hasOwnProperty(i)&&!r.hasOwnProperty(i))&&(r[i]=t[i]);return!e&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!r.hasOwnProperty("toString")&&(r.toString=t.toString),r},getParameterString:function(r){var t=[];for(var e in r){var i=r[e];if(i!=null&&typeof i!="function"){var n;Array.isArray(i)||i.toString()==="[object Object]"?n=encodeURIComponent(JSON.stringify(i)):n=encodeURIComponent(i),t.push(encodeURIComponent(e)+"="+n)}}return t.join("&")},urlAppend:function(r,t){var e=r;if(t){t.indexOf("?")===0&&(t=t.substring(1));var i=(r+" ").split(/[?&]/);e+=i.pop()===" "?t:i.length?"&"+t:"?"+t}return e},urlPathAppend:function(r,t){let e=r;if(!t)return e;t.indexOf("/")===0&&(t=t.substring(1));const i=r.split("?");return i[0].indexOf("/",i[0].length-1)<0&&(i[0]+="/"),e=`${i[0]}${t}${i.length>1?`?${i[1]}`:""}`,e},DEFAULT_PRECISION:14,toFloat:function(r,t){return t==null&&(t=v.DEFAULT_PRECISION),typeof r!="number"&&(r=parseFloat(r)),t===0?r:parseFloat(r.toPrecision(t))},rad:function(r){return r*Math.PI/180},getParameters:function(r){r=r??window.location.href;var t="";if(j.contains(r,"?")){var e=r.indexOf("?")+1,i=j.contains(r,"#")?r.indexOf("#"):r.length;t=r.substring(e,i)}for(var n={},s=t.split(/[&;]/),o=0,l=s.length;o<l;++o){var u=s[o].split("=");if(u[0]){var c=u[0];try{c=decodeURIComponent(c)}catch{c=unescape(c)}var f=(u[1]||"").replace(/\+/g," ");try{f=decodeURIComponent(f)}catch{f=unescape(f)}f=f.split(","),f.length==1&&(f=f[0]),n[c]=f}}return n},lastSeqID:0,createUniqueID:function(r){return r==null&&(r="id_"),v.lastSeqID+=1,r+v.lastSeqID},normalizeScale:function(r){var t=r>1?1/r:r;return t},getResolutionFromScale:function(r,t){var e;if(r){t==null&&(t="degrees");var i=v.normalizeScale(r);e=1/(i*C[t]*Lt)}return e},getScaleFromResolution:function(r,t){t==null&&(t="degrees");var e=r*C[t]*Lt;return e},getBrowser:function(){return Ut},isSupportCanvas:Se,supportCanvas:function(){return v.isSupportCanvas},isInTheSameDomain:function(r){if(!r)return!0;var t=r.indexOf("//"),e=document.location.toString(),i=e.indexOf("//");if(t===-1)return!0;var n,s=n=r.substring(0,t),o=e.substring(i+2);i=o.indexOf("/");var l=o.indexOf(":"),u=o.substring(0,i),c=document.location.protocol;if(l!==-1||(u+=":"+(c.toLowerCase()==="http:"?80:443)),c.toLowerCase()!==s.toLowerCase())return!1;s=r.substring(t+2);var f=s.indexOf(":");t=s.indexOf("/");var y=s.substring(0,t),S;f!==-1?S=s.substring(0,f):(S=s.substring(0,t),y+=":"+(n.toLowerCase()==="http:"?80:443));var m=document.domain;return S===m&&y===u},calculateDpi:function(r,t,e,i,n){if(!(!r||!t||!e)){var s=1e4,o=r.getWidth(),l=r.getHeight(),u=t.w,c=t.h;n=n||6378137,i=i||"degrees";var f;if(i.toLowerCase()==="degree"||i.toLowerCase()==="degrees"||i.toLowerCase()==="dd"){let y=o/u,S=l/c,m=y>S?y:S;f=.0254*s/m/e/(Math.PI*2*n/360)/s}else{let y=o/u;f=.0254*s/y/e/s}return f}},toJSON:function(r){var t=r;if(t==null)return null;switch(t.constructor){case String:return t='"'+t.replace(/(["\\])/g,"\\$1")+'"',t=t.replace(/\n/g,"\\n"),t=t.replace(/\r/g,"\\r"),t=t.replace("<","&lt;"),t=t.replace(">","&gt;"),t=t.replace(/%/g,"%25"),t=t.replace(/&/g,"%26"),t;case Array:for(var e="",i=0,n=t.length;i<n;i++)e+=v.toJSON(t[i]),i!==t.length-1&&(e+=",");return"["+e+"]";case Number:return isFinite(t)?String(t):null;case Boolean:return String(t);case Date:var s=`{'__type':"System.DateTime",'Year':`+t.getFullYear()+",'Month':"+(t.getMonth()+1)+",'Day':"+t.getDate()+",'Hour':"+t.getHours()+",'Minute':"+t.getMinutes()+",'Second':"+t.getSeconds()+",'Millisecond':"+t.getMilliseconds()+",'TimezoneOffset':"+t.getTimezoneOffset()+"}";return s;default:if(t.toJSON!=null&&typeof t.toJSON=="function")return t.toJSON();if(typeof t=="object"){if(t.length){let l=[];for(let u=0,c=t.length;u<c;u++)l.push(v.toJSON(t[u]));return"["+l.join(",")+"]"}let o=[];for(let l in t)typeof t[l]!="function"&&l!=="CLASS_NAME"&&l!=="parent"&&o.push("'"+l+"':"+v.toJSON(t[l]));return o.length>0?"{"+o.join(",")+"}":"{}"}return t.toString()}},getResolutionFromScaleDpi:function(r,t,e,i){var n=null,s=1e4;return i=i||6378137,e=e||"",r>0&&t>0?(r=v.normalizeScale(r),e.toLowerCase()==="degree"||e.toLowerCase()==="degrees"||e.toLowerCase()==="dd"?(n=.0254*s/t/r/(Math.PI*2*i/360)/s,n):(n=.0254*s/t/r/s,n)):-1},getScaleFromResolutionDpi:function(r,t,e,i){var n=null,s=1e4;return i=i||6378137,e=e||"",r>0&&t>0?e.toLowerCase()==="degree"||e.toLowerCase()==="degrees"||e.toLowerCase()==="dd"?(n=.0254*s/t/r/(Math.PI*2*i/360)/s,n):(n=.0254*s/t/r/s,n):-1},transformResult:function(r){return r.responseText&&typeof r.responseText=="string"&&(r=JSON.parse(r.responseText)),r},copyAttributes:function(r,t){if(r=r||{},t)for(var e in t){var i=t[e];i!==void 0&&e!=="CLASS_NAME"&&typeof i!="function"&&(r[e]=i)}return r},copyAttributesWithClip:function(r,t,e){if(r=r||{},t)for(var i in t){var n=!1;if(e&&e.length){for(var s=0,o=e.length;s<o;s++)if(i===e[s]){n=!0;break}}if(n!==!0){var l=t[i];l!==void 0&&i!=="CLASS_NAME"&&typeof l!="function"&&(r[i]=l)}}return r},cloneObject:function(r){if(r===null||typeof r!="object")return r;if(r instanceof Date){let e=new Date;return e.setTime(r.getTime()),e}if(r instanceof Array)return r.slice(0);if(r instanceof Object){let e={};for(var t in r)r.hasOwnProperty(t)&&(e[t]=v.cloneObject(r[t]));return e}throw new Error("Unable to copy obj! Its type isn't supported.")},lineIntersection:function(r,t,e,i){var n=null,s,o,l=(i.x-e.x)*(r.y-e.y)-(i.y-e.y)*(r.x-e.x),u=(t.x-r.x)*(r.y-e.y)-(t.y-r.y)*(r.x-e.x),c=(i.y-e.y)*(t.x-r.x)-(i.x-e.x)*(t.y-r.y);if(c!=0)s=l/c,o=u/c,s>=0&&o<=1&&s<=1&&o>=0?n=new rt.Point(r.x+s*(t.x-r.x),r.y+s*(t.y-r.y)):n="No Intersection";else if(l==0&&u==0){var f=Math.max(r.y,t.y),y=Math.min(r.y,t.y),S=Math.max(r.x,t.x),m=Math.min(r.x,t.x);(e.y>=y&&e.y<=f||i.y>=y&&i.y<=f)&&e.x>=m&&e.x<=S||i.x>=m&&i.x<=S?n="Coincident":n="Parallel"}else n="Parallel";return n},getTextBounds:function(r,t,e){document.body.appendChild(e),e.style.width="auto",e.style.height="auto",r.fontSize&&(e.style.fontSize=r.fontSize),r.fontFamily&&(e.style.fontFamily=r.fontFamily),r.fontWeight&&(e.style.fontWeight=r.fontWeight),e.style.position="relative",e.style.visibility="hidden",e.style.display="inline-block",e.innerHTML=t;var i=e.clientWidth,n=e.clientHeight;return document.body.removeChild(e),{textWidth:i,textHeight:n}},convertPath:function(r,t){return t?r.replace(/\{([\w-\.]+)\}/g,(e,i)=>{var n;return t.hasOwnProperty(i)?n=we(t[i]):n=e,encodeURIComponent(n)}):r}},C={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};C.in=C.inches;C.degrees=C.dd;C.nmi=1852*C.m;const _=.0254000508001016;v.extend(C,{Inch:C.inches,Meter:1/_,Foot:.3048006096012192/_,IFoot:.3048/_,ClarkeFoot:.3047972651151/_,SearsFoot:.30479947153867626/_,GoldCoastFoot:.3047997101815088/_,IInch:.0254/_,MicroInch:254e-7/_,Mil:254e-10/_,Centimeter:.01/_,Kilometer:1e3/_,Yard:.9144018288036576/_,SearsYard:.914398414616029/_,IndianYard:.9143985307444408/_,IndianYd37:.91439523/_,IndianYd62:.9143988/_,IndianYd75:.9143985/_,IndianFoot:.30479951/_,IndianFt37:.30479841/_,IndianFt62:.3047996/_,IndianFt75:.3047995/_,Mile:1609.3472186944373/_,IYard:.9144/_,IMile:1609.344/_,NautM:1852/_,"Lat-66":110943.31648893273/_,"Lat-83":110946.25736872235/_,Decimeter:.1/_,Millimeter:.001/_,Dekameter:10/_,Decameter:10/_,Hectometer:100/_,GermanMeter:1.0000135965/_,CaGrid:.999738/_,ClarkeChain:20.1166194976/_,GunterChain:20.11684023368047/_,BenoitChain:20.116782494375872/_,SearsChain:20.11676512155/_,ClarkeLink:.201166194976/_,GunterLink:.2011684023368047/_,BenoitLink:.20116782494375873/_,SearsLink:.2011676512155/_,Rod:5.02921005842012/_,IntnlChain:20.1168/_,IntnlLink:.201168/_,Perch:5.02921005842012/_,Pole:5.02921005842012/_,Furlong:201.1684023368046/_,Rood:3.778266898/_,CapeFoot:.3047972615/_,Brealey:375/_,ModAmFt:.304812252984506/_,Fathom:1.8288/_,"NautM-UK":1853.184/_,"50kilometers":5e4/_,"150kilometers":15e4/_});v.extend(C,{mm:C.Meter/1e3,cm:C.Meter/100,dm:C.Meter*100,km:C.Meter*1e3,kmi:C.nmi,fath:C.Fathom,ch:C.IntnlChain,link:C.IntnlLink,"us-in":C.inches,"us-ft":C.Foot,"us-yd":C.Yard,"us-ch":C.GunterChain,"us-mi":C.Mile,"ind-yd":C.IndianYd37,"ind-ft":C.IndianFt37,"ind-ch":20.11669506/_});C.degree=C.dd;C.meter=C.m;C.foot=C.ft;C.inch=C.inches;C.mile=C.mi;C.kilometer=C.km;C.yard=C.yd;function we(r){return r==null||r==null?"":r instanceof Date?r.toJSON():_e(r)?JSON.stringify(r):r.toString()}function _e(r){if(typeof r!="string"&&typeof r!="object")return!1;try{const t=r.toString();return t==="[object Object]"||t==="[object Array]"}catch{return!1}}(function(r,t){(function(e,i){i()})(Y,function(){function e(h){var d=this.constructor;return this.then(function(a){return d.resolve(h()).then(function(){return a})},function(a){return d.resolve(h()).then(function(){return d.reject(a)})})}function i(h){var d=this;return new d(function(a,p){if(!(h&&typeof h.length<"u"))return p(new TypeError(typeof h+" "+h+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var w=Array.prototype.slice.call(h);if(w.length===0)return a([]);var I=w.length;function A(O,N){if(N&&(typeof N=="object"||typeof N=="function")){var q=N.then;if(typeof q=="function"){q.call(N,function(k){A(O,k)},function(k){w[O]={status:"rejected",reason:k},--I===0&&a(w)});return}}w[O]={status:"fulfilled",value:N},--I===0&&a(w)}for(var x=0;x<w.length;x++)A(x,w[x])})}var n=setTimeout;function s(h){return!!(h&&typeof h.length<"u")}function o(){}function l(h,d){return function(){h.apply(d,arguments)}}function u(h){if(!(this instanceof u))throw new TypeError("Promises must be constructed via new");if(typeof h!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],P(h,this)}function c(h,d){for(;h._state===3;)h=h._value;if(h._state===0){h._deferreds.push(d);return}h._handled=!0,u._immediateFn(function(){var a=h._state===1?d.onFulfilled:d.onRejected;if(a===null){(h._state===1?f:y)(d.promise,h._value);return}var p;try{p=a(h._value)}catch(w){y(d.promise,w);return}f(d.promise,p)})}function f(h,d){try{if(d===h)throw new TypeError("A promise cannot be resolved with itself.");if(d&&(typeof d=="object"||typeof d=="function")){var a=d.then;if(d instanceof u){h._state=3,h._value=d,S(h);return}else if(typeof a=="function"){P(l(a,d),h);return}}h._state=1,h._value=d,S(h)}catch(p){y(h,p)}}function y(h,d){h._state=2,h._value=d,S(h)}function S(h){h._state===2&&h._deferreds.length===0&&u._immediateFn(function(){h._handled||u._unhandledRejectionFn(h._value)});for(var d=0,a=h._deferreds.length;d<a;d++)c(h,h._deferreds[d]);h._deferreds=null}function m(h,d,a){this.onFulfilled=typeof h=="function"?h:null,this.onRejected=typeof d=="function"?d:null,this.promise=a}function P(h,d){var a=!1;try{h(function(p){a||(a=!0,f(d,p))},function(p){a||(a=!0,y(d,p))})}catch(p){if(a)return;a=!0,y(d,p)}}u.prototype.catch=function(h){return this.then(null,h)},u.prototype.then=function(h,d){var a=new this.constructor(o);return c(this,new m(h,d,a)),a},u.prototype.finally=e,u.all=function(h){return new u(function(d,a){if(!s(h))return a(new TypeError("Promise.all accepts an array"));var p=Array.prototype.slice.call(h);if(p.length===0)return d([]);var w=p.length;function I(x,O){try{if(O&&(typeof O=="object"||typeof O=="function")){var N=O.then;if(typeof N=="function"){N.call(O,function(q){I(x,q)},a);return}}p[x]=O,--w===0&&d(p)}catch(q){a(q)}}for(var A=0;A<p.length;A++)I(A,p[A])})},u.allSettled=i,u.resolve=function(h){return h&&typeof h=="object"&&h.constructor===u?h:new u(function(d){d(h)})},u.reject=function(h){return new u(function(d,a){a(h)})},u.race=function(h){return new u(function(d,a){if(!s(h))return a(new TypeError("Promise.race accepts an array"));for(var p=0,w=h.length;p<w;p++)u.resolve(h[p]).then(d,a)})},u._immediateFn=typeof setImmediate=="function"&&function(h){setImmediate(h)}||function(h){n(h,0)},u._unhandledRejectionFn=function(d){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",d)};var E=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof Y<"u")return Y;throw new Error("unable to locate global object")}();typeof E.Promise!="function"?E.Promise=u:(E.Promise.prototype.finally||(E.Promise.prototype.finally=e),E.Promise.allSettled||(E.Promise.allSettled=i))})})();var xe={exports:{}};(function(r){(function(t){if(!t.__disableNativeFetch&&t.fetch)return;function e(a){if(typeof a!="string"&&(a=String(a)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(a))throw new TypeError("Invalid character in header field name");return a.toLowerCase()}function i(a){return typeof a!="string"&&(a=String(a)),a}function n(a){this.map={},a instanceof n?a.forEach(function(p,w){this.append(w,p)},this):a&&Object.getOwnPropertyNames(a).forEach(function(p){this.append(p,a[p])},this)}n.prototype.append=function(a,p){a=e(a),p=i(p);var w=this.map[a];w||(w=[],this.map[a]=w),w.push(p)},n.prototype.delete=function(a){delete this.map[e(a)]},n.prototype.get=function(a){var p=this.map[e(a)];return p?p[0]:null},n.prototype.getAll=function(a){return this.map[e(a)]||[]},n.prototype.has=function(a){return this.map.hasOwnProperty(e(a))},n.prototype.set=function(a,p){this.map[e(a)]=[i(p)]},n.prototype.forEach=function(a,p){Object.getOwnPropertyNames(this.map).forEach(function(w){this.map[w].forEach(function(I){a.call(p,I,w,this)},this)},this)};function s(a){if(a.bodyUsed)return Promise.reject(new TypeError("Already read"));a.bodyUsed=!0}function o(a){return new Promise(function(p,w){a.onload=function(){p(a.result)},a.onerror=function(){w(a.error)}})}function l(a){var p=new FileReader;return p.readAsArrayBuffer(a),o(p)}function u(a,p){var w=new FileReader,I=p.headers.map["content-type"]?p.headers.map["content-type"].toString():"",A=/charset\=[0-9a-zA-Z\-\_]*;?/,x=a.type.match(A)||I.match(A),O=[a];return x&&O.push(x[0].replace(/^charset\=/,"").replace(/;$/,"")),w.readAsText.apply(w,O),o(w)}var c={blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};function f(){return this.bodyUsed=!1,this._initBody=function(a,p){if(this._bodyInit=a,typeof a=="string")this._bodyText=a;else if(c.blob&&Blob.prototype.isPrototypeOf(a))this._bodyBlob=a,this._options=p;else if(c.formData&&FormData.prototype.isPrototypeOf(a))this._bodyFormData=a;else if(!a)this._bodyText="";else if(!(c.arrayBuffer&&ArrayBuffer.prototype.isPrototypeOf(a)))throw new Error("unsupported BodyInit type")},c.blob?(this.blob=function(){var a=s(this);if(a)return a;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(l)},this.text=function(){var a=s(this);if(a)return a;if(this._bodyBlob)return u(this._bodyBlob,this._options);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var a=s(this);return a||Promise.resolve(this._bodyText)},c.formData&&(this.formData=function(){return this.text().then(P)}),this.json=function(){return this.text().then(JSON.parse)},this}var y=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function S(a){var p=a.toUpperCase();return y.indexOf(p)>-1?p:a}function m(a,p){p=p||{};var w=p.body;if(m.prototype.isPrototypeOf(a)){if(a.bodyUsed)throw new TypeError("Already read");this.url=a.url,this.credentials=a.credentials,p.headers||(this.headers=new n(a.headers)),this.method=a.method,this.mode=a.mode,w||(w=a._bodyInit,a.bodyUsed=!0)}else this.url=a;if(this.credentials=p.credentials||this.credentials||"omit",(p.headers||!this.headers)&&(this.headers=new n(p.headers)),this.method=S(p.method||this.method||"GET"),this.mode=p.mode||this.mode||null,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&w)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(w,p)}m.prototype.clone=function(){return new m(this)};function P(a){var p=new FormData;return a.trim().split("&").forEach(function(w){if(w){var I=w.split("="),A=I.shift().replace(/\+/g," "),x=I.join("=").replace(/\+/g," ");p.append(decodeURIComponent(A),decodeURIComponent(x))}}),p}function E(a){var p=new n,w=a.getAllResponseHeaders().trim().split(`
`);return w.forEach(function(I){var A=I.trim().split(":"),x=A.shift().trim(),O=A.join(":").trim();p.append(x,O)}),p}f.call(m.prototype);function h(a,p){p||(p={}),this._initBody(a,p),this.type="default",this.status=p.status,this.ok=this.status>=200&&this.status<300,this.statusText=p.statusText,this.headers=p.headers instanceof n?p.headers:new n(p.headers),this.url=p.url||""}f.call(h.prototype),h.prototype.clone=function(){return new h(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},h.error=function(){var a=new h(null,{status:0,statusText:""});return a.type="error",a};var d=[301,302,303,307,308];h.redirect=function(a,p){if(d.indexOf(p)===-1)throw new RangeError("Invalid status code");return new h(null,{status:p,headers:{location:a}})},t.Headers=n,t.Request=m,t.Response=h,t.fetch=function(a,p){return new Promise(function(w,I){var A;m.prototype.isPrototypeOf(a)&&!p?A=a:A=new m(a,p);var x=new XMLHttpRequest;function O(){if("responseURL"in x)return x.responseURL;if(/^X-Request-URL:/m.test(x.getAllResponseHeaders()))return x.getResponseHeader("X-Request-URL")}var N=!1;function q(){if(x.readyState===4){var k=x.status===1223?204:x.status;if(k<100||k>599){if(N)return;N=!0,I(new TypeError("Network request failed"));return}var ct={status:k,statusText:x.statusText,headers:E(x),url:O()},ne="response"in x?x.response:x.responseText;N||(N=!0,w(new h(ne,ct)))}}x.onreadystatechange=q,x.onload=q,x.onerror=function(){N||(N=!0,I(new TypeError("Network request failed")))},x.open(A.method,A.url,!0);try{A.credentials==="include"&&("withCredentials"in x?x.withCredentials=!0:console&&console.warn&&console.warn("withCredentials is not supported, you can ignore this warning"))}catch(k){console&&console.warn&&console.warn("set withCredentials error:"+k)}"responseType"in x&&c.blob&&(x.responseType="blob"),A.headers.forEach(function(k,ct){x.setRequestHeader(ct,k)}),x.send(typeof A._bodyInit>"u"?null:A._bodyInit)})},t.fetch.polyfill=!0,r.exports&&(r.exports=t.fetch)})(typeof self<"u"?self:Y)})(xe);var mt={exports:{}};(function(r,t){(function(e,i){i(t,r)})(Y,function(e,i){var n={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function s(){return"jsonp_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function o(c){try{delete window[c]}catch{window[c]=void 0}}function l(c){var f=document.getElementById(c);f&&document.getElementsByTagName("head")[0].removeChild(f)}function u(c){var f=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],y=c,S=f.timeout||n.timeout,m=f.jsonpCallback||n.jsonpCallback,P=void 0;return new Promise(function(E,h){var d=f.jsonpCallbackFunction||s(),a=m+"_"+d;window[d]=function(w){E({ok:!0,json:function(){return Promise.resolve(w)}}),P&&clearTimeout(P),l(a),o(d)},y+=y.indexOf("?")===-1?"?":"&";var p=document.createElement("script");p.setAttribute("src",""+y+m+"="+d),f.charset&&p.setAttribute("charset",f.charset),p.id=a,document.getElementsByTagName("head")[0].appendChild(p),P=setTimeout(function(){h(new Error("JSONP request to "+c+" timed out")),o(d),l(a),window[d]=function(){o(d)}},S),p.onerror=function(){h(new Error("JSONP request to "+c+" failed")),o(d),l(a),P&&clearTimeout(P)}})}i.exports=u})})(mt,mt.exports);var Ce=mt.exports;const Bt=se(Ce);let Mt=window.fetch;var st={limitLength:1500,queryKeys:[],queryValues:[],supermap_callbacks:{},addQueryStrings:function(r){var t=this;for(var e in r){t.queryKeys.push(e),typeof r[e]!="string"&&(r[e]=v.toJSON(r[e]));var i=encodeURIComponent(r[e]);t.queryValues.push(i)}},issue:function(r){for(var t=this,e=t.getUid(),i=r.url,n=[],s=new Promise(function(m){t.supermap_callbacks[e]=function(P){delete t.supermap_callbacks[e],m(P)}}),o=i,l=0,u=t.queryKeys?t.queryKeys.length:0,c=0;c<u;c++)if(o.length+t.queryKeys[c].length+2>=t.limitLength){if(l==0)return!1;n.push(o),o=i,l=0,c--}else if(o.length+t.queryKeys[c].length+2+t.queryValues[c].length>t.limitLength)for(var f=t.queryValues[c];f.length>0;){var y=t.limitLength-o.length-t.queryKeys[c].length-2;o.indexOf("?")>-1?o+="&":o+="?";var S=f.substring(0,y);S.substring(y-1,y)==="%"?(y-=1,S=f.substring(0,y)):S.substring(y-2,y-1)==="%"&&(y-=2,S=f.substring(0,y)),o+=t.queryKeys[c]+"="+S,f=f.substring(y),S.length>0&&(n.push(o),o=i,l=0)}else l++,o.indexOf("?")>-1?o+="&":o+="?",o+=t.queryKeys[c]+"="+t.queryValues[c];return n.push(o),t.send(n,"RequestJSONPPromise.supermap_callbacks["+e+"]",r&&r.proxy),s},getUid:function(){var r=new Date().getTime(),t=Math.floor(Math.random()*1e17);return r*1e3+t},send:function(r,t,e){var i=r.length;if(i>0)for(var n=new Date().getTime(),s=0;s<i;s++){var o=r[s];o.indexOf("?")>-1?o+="&":o+="?",o+="sectionCount="+i,o+="&sectionIndex="+s,o+="&jsonpUserID="+n,e&&(o=decodeURIComponent(o),o=e+encodeURIComponent(o)),Bt(o,{jsonpCallbackFunction:t,timeout:3e4})}},GET:function(r){var t=this;return t.queryKeys.length=0,t.queryValues.length=0,t.addQueryStrings(r.params),t.issue(r)},POST:function(r){var t=this;return t.queryKeys.length=0,t.queryValues.length=0,t.addQueryStrings({requestEntity:r.data}),t.issue(r)},PUT:function(r){var t=this;return t.queryKeys.length=0,t.queryValues.length=0,t.addQueryStrings({requestEntity:r.data}),t.issue(r)},DELETE:function(r){var t=this;return t.queryKeys.length=0,t.queryValues.length=0,t.addQueryStrings({requestEntity:r.data}),t.issue(r)}},Pe=function(){return window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest},Rt=function(){return 45e3},Z={commit:function(r,t,e,i){switch(r=r&&r.toUpperCase(),r){case"GET":return this.get(t,e,i);case"POST":return this.post(t,e,i);case"PUT":return this.put(t,e,i);case"DELETE":return this.delete(t,e,i);default:return this.get(t,e,i)}},supportDirectRequest:function(r,t){return v.isInTheSameDomain(r)?!0:t.crossOrigin!=null?t.crossOrigin:Pe()||t.proxy},get:function(r,t,e){e=e||{};var i="GET";if(r=v.urlAppend(r,this._getParameterString(t||{})),r=this._processUrl(r,e),!this.supportDirectRequest(r,e)){r=r.replace(".json",".jsonp");var n={url:r,data:t};return st.GET(n)}return this.urlIsLong(r)?this._postSimulatie(i,r.substring(0,r.indexOf("?")),v.getParameters(r),e):this._fetch(r,t,e,i)},delete:function(r,t,e){e=e||{};var i="DELETE";if(r=v.urlAppend(r,this._getParameterString(t||{})),r=this._processUrl(r,e),!this.supportDirectRequest(r,e)){r=r.replace(".json",".jsonp");var n={url:r+="&_method=DELETE",data:t};return st.DELETE(n)}return this.urlIsLong(r)?this._postSimulatie(i,r.substring(0,r.indexOf("?")),v.getParameters(r),e):this._fetch(r,t,e,i)},post:function(r,t,e){if(e=e||{},!this.supportDirectRequest(r,e)){r=r.replace(".json",".jsonp");var i={url:r+="&_method=POST",data:t};return st.POST(i)}return this._fetch(this._processUrl(r,e),t,e,"POST")},put:function(r,t,e){if(e=e||{},r=this._processUrl(r,e),!this.supportDirectRequest(r,e)){r=r.replace(".json",".jsonp");var i={url:r+="&_method=PUT",data:t};return st.PUT(i)}return this._fetch(r,t,e,"PUT")},urlIsLong:function(r){for(var t=0,e=null,i=0,n=r.length;i<n;i++)e=r.charCodeAt(i),e<127?t++:128<=e&&e<=2047?t+=2:2048<=e&&e<=65535&&(t+=3);return!(t<2e3)},_postSimulatie:function(r,t,e,i){var n=t.indexOf("?")>-1?"&":"?";return t+=n+"_method="+r,typeof e!="string"&&(e=JSON.stringify(e)),this.post(t,e,i)},_processUrl:function(r,t){if(this._isMVTRequest(r))return r;if(r.indexOf(".json")===-1&&!t.withoutFormatSuffix)if(r.indexOf("?")<0)r+=".json";else{var e=r.split("?");e.length===2&&(r=e[0]+".json?"+e[1])}return t&&t.proxy&&(typeof t.proxy=="function"?r=t.proxy(r):(r=decodeURIComponent(r),r=t.proxy+encodeURIComponent(r))),r},_fetch:function(r,t,e,i){return e=e||{},e.headers=e.headers||{},!e.headers["Content-Type"]&&!FormData.prototype.isPrototypeOf(t)&&(e.headers["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8"),e.timeout?this._timeout(e.timeout,Mt(r,{method:i,headers:e.headers,body:i==="PUT"||i==="POST"?t:void 0,credentials:this._getWithCredentials(e),mode:"cors",timeout:Rt()}).then(function(n){return n})):Mt(r,{method:i,body:i==="PUT"||i==="POST"?t:void 0,headers:e.headers,credentials:this._getWithCredentials(e),mode:"cors",timeout:Rt()}).then(function(n){return n})},_getWithCredentials:function(r){return r.withCredentials===!0?"include":r.withCredentials===!1?"omit":"same-origin"},_fetchJsonp:function(r,t){return t=t||{},Bt(r,{method:"GET",timeout:t.timeout}).then(function(e){return e})},_timeout:function(r,t){return new Promise(function(e,i){setTimeout(function(){i(new Error("timeout"))},r),t.then(e,i)})},_getParameterString:function(r){var t=[];for(var e in r){var i=r[e];if(i!=null&&typeof i!="function"){var n;Array.isArray(i)||i.toString()==="[object Object]"?n=encodeURIComponent(JSON.stringify(i)):n=encodeURIComponent(i),t.push(encodeURIComponent(e)+"="+n)}}return t.join("&")},_isMVTRequest:function(r){return r.indexOf(".mvt")>-1||r.indexOf(".pbf")>-1}};class gt{constructor(t,e){this.value=t||"",this.name=e||"token",this.CLASS_NAME="SuperMap.Credential"}getUrlParameters(){return this.name+"="+this.value}getValue(){return this.value}destroy(){this.value=null,this.name=null}}gt.CREDENTIAL=null;class K{static generateToken(t,e){var i=this.servers[t];if(i)return Z.post(i.tokenServiceUrl,JSON.stringify(e.toJSON())).then(function(n){return n.text()})}static registerServers(t){this.servers=this.servers||{},v.isArray(t)||(t=[t]);for(var e=0;e<t.length;e++){var i=t[e];this.servers[i.server]=i}}static registerToken(t,e){if(this.tokens=this.tokens||{},!(!t||!e)){var i=this._getTokenStorageKey(t);this.tokens[i]=e}}static registerKey(t,e){if(this.keys=this.keys||{},!(!t||t.length<1||!e)){t=v.isArray(t)?t:[t];for(var i=0;i<t.length;i++){var n=this._getUrlRestString(t[0])||t[0];this.keys[n]=e}}}static getServerInfo(t){return this.servers=this.servers||{},this.servers[t]}static getToken(t){if(t){this.tokens=this.tokens||{};var e=this._getTokenStorageKey(t);return this.tokens[e]}}static getKey(t){this.keys=this.keys||{};var e=this._getUrlRestString(t)||t;return this.keys[e]}static loginiServer(t,e,i,n){t=v.urlPathAppend(t,"services/security/login");var s={username:e&&e.toString(),password:i&&i.toString(),rememberme:n};s=JSON.stringify(s);var o={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}};return Z.post(t,s,o).then(function(l){return l.json()})}static logoutiServer(t){t=v.urlPathAppend(t,"services/security/logout");var e={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withoutFormatSuffix:!0};return Z.get(t,"",e).then(function(){return!0}).catch(function(){return!1})}static loginOnline(t,e){var i=K.SSO+"/login?service="+t;this._open(i,e)}static loginiPortal(t,e,i){t=v.urlPathAppend(t,"web/login");var n={username:e&&e.toString(),password:i&&i.toString()};n=JSON.stringify(n);var s={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!0};return Z.post(t,n,s).then(function(o){return o.json()})}static logoutiPortal(t){t=v.urlPathAppend(t,"services/security/logout");var e={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!0,withoutFormatSuffix:!0};return Z.get(t,"",e).then(function(){return!0}).catch(function(){return!1})}static loginManager(t,e,i){if(!v.isInTheSameDomain(t)){var n=i?i.isNewTab:!0;this._open(t,n);return}var s=v.urlPathAppend(t,"icloud/security/tokens"),o=e||{},l={username:o.userName&&o.userName.toString(),password:o.password&&o.password.toString()};l=JSON.stringify(l);var u={headers:{Accept:"*/*","Content-Type":"application/json"}},c=this;return Z.post(s,l,u).then(function(f){f.text().then(function(y){return c.imanagerToken=y,y})})}static destroyAllCredentials(){this.keys=null,this.tokens=null,this.servers=null}static destroyToken(t){if(t){var e=this._getTokenStorageKey(t);this.tokens=this.tokens||{},this.tokens[e]&&delete this.tokens[e]}}static destroyKey(t){if(t){this.keys=this.keys||{};var e=this._getUrlRestString(t)||t;this.keys[e]&&delete this.keys[e]}}static appendCredential(t){var e=t,i=this.getToken(t),n=i?new gt(i,"token"):null;return n||(i=this.getKey(t),n=i?new gt(i,"key"):null),n&&(e=v.urlAppend(e,n.getUrlParameters())),e}static _open(t,e){e=e??!0;var i=window.screen.availWidth/2-this.INNER_WINDOW_WIDTH/2,n=window.screen.availHeight/2-this.INNER_WINDOW_HEIGHT/2,s="height="+this.INNER_WINDOW_HEIGHT+", width="+this.INNER_WINDOW_WIDTH+",top="+n+", left="+i+",toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no";e?window.open(t,"login"):window.open(t,"login",s)}static _getTokenStorageKey(t){var e=/(.*?):\/\/([^\/]+)/i,i=t.match(e);return i?i[0]:t}static _getUrlRestString(t){if(!t)return t;var e=/(http|https):\/\/(.*\/rest)/i,i=t.match(e);return i?i[0]:t}}K.INNER_WINDOW_WIDTH=600;K.INNER_WINDOW_HEIGHT=600;K.SSO="https://sso.supermap.com";K.ONLINE="https://www.supermapol.com";var R={LINE:"LINE",LINEM:"LINEM",POINT:"POINT",REGION:"REGION",POINTEPS:"POINTEPS",LINEEPS:"LINEEPS",REGIONEPS:"REGIONEPS",ELLIPSE:"ELLIPSE",CIRCLE:"CIRCLE",TEXT:"TEXT",RECTANGLE:"RECTANGLE",UNKNOWN:"UNKNOWN",GEOCOMPOUND:"GEOCOMPOUND"},H={METER:"METER",KILOMETER:"KILOMETER",MILE:"MILE",YARD:"YARD",DEGREE:"DEGREE",MILLIMETER:"MILLIMETER",CENTIMETER:"CENTIMETER",INCH:"INCH",DECIMETER:"DECIMETER",FOOT:"FOOT",SECOND:"SECOND",MINUTE:"MINUTE",RADIAN:"RADIAN"};class wt{constructor(t,e){this.w=t?parseFloat(t):0,this.h=t?parseFloat(e):0,this.CLASS_NAME="SuperMap.Size"}toString(){return"w="+this.w+",h="+this.h}clone(){return new wt(this.w,this.h)}equals(t){var e=!1;return t!=null&&(e=this.w===t.w&&this.h===t.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(t.w)&&isNaN(t.h)),e}destroy(){this.w=null,this.h=null}}class tt{constructor(t,e,i){this.x=t?parseFloat(t):0,this.y=e?parseFloat(e):0,this.mode=i,this.CLASS_NAME="SuperMap.Pixel"}toString(){return"x="+this.x+",y="+this.y}clone(){return new tt(this.x,this.y,this.mode)}equals(t){var e=!1;return t!=null&&(e=this.x==t.x&&this.y==t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),e}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}add(t,e){if(t==null||e==null)throw new TypeError("Pixel.add cannot receive null values");return new tt(this.x+t,this.y+e)}offset(t){var e=this.clone();return t&&(e=this.add(t.x,t.y)),e}destroy(){this.x=null,this.y=null,this.mode=null}}tt.Mode={LeftTop:"lefttop",RightTop:"righttop",RightBottom:"rightbottom",LeftBottom:"leftbottom"};class X{constructor(t,e){v.isArray(t)&&(e=t[1],t=t[0]),this.lon=t?v.toFloat(t):0,this.lat=e?v.toFloat(e):0,this.CLASS_NAME="SuperMap.LonLat"}toString(){return"lon="+this.lon+",lat="+this.lat}toShortString(){return this.lon+","+this.lat}clone(){return new X(this.lon,this.lat)}add(t,e){if(t==null||e==null)throw new TypeError("LonLat.add cannot receive null values");return new X(this.lon+v.toFloat(t),this.lat+v.toFloat(e))}equals(t){var e=!1;return t!=null&&(e=this.lon===t.lon&&this.lat===t.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(t.lon)&&isNaN(t.lat)),e}wrapDateLine(t){var e=this.clone();if(t){for(;e.lon<t.left;)e.lon+=t.getWidth();for(;e.lon>t.right;)e.lon-=t.getWidth()}return e}destroy(){this.lon=null,this.lat=null}static fromString(t){var e=t.split(",");return new X(e[0],e[1])}static fromArray(t){var e=v.isArray(t),i=e&&t[0],n=e&&t[1];return new X(i,n)}}class F{constructor(t,e,i,n){v.isArray(t)&&(n=t[3],i=t[2],e=t[1],t=t[0]),this.left=t!=null?v.toFloat(t):this.left,this.bottom=e!=null?v.toFloat(e):this.bottom,this.right=i!=null?v.toFloat(i):this.right,this.top=n!=null?v.toFloat(n):this.top,this.centerLonLat=null,this.CLASS_NAME="SuperMap.Bounds"}clone(){return new F(this.left,this.bottom,this.right,this.top)}equals(t){var e=!1;return t!=null&&(e=this.left===t.left&&this.right===t.right&&this.top===t.top&&this.bottom===t.bottom),e}toString(){return[this.left,this.bottom,this.right,this.top].join(",")}toArray(t){return t===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]}toBBOX(t,e){t==null&&(t=6);var i=Math.pow(10,t),n=Math.round(this.left*i)/i,s=Math.round(this.bottom*i)/i,o=Math.round(this.right*i)/i,l=Math.round(this.top*i)/i;return e===!0?s+","+n+","+l+","+o:n+","+s+","+o+","+l}getWidth(){return this.right-this.left}getHeight(){return this.top-this.bottom}getSize(){return new wt(this.getWidth(),this.getHeight())}getCenterPixel(){return new tt((this.left+this.right)/2,(this.bottom+this.top)/2)}getCenterLonLat(){return this.centerLonLat||(this.centerLonLat=new X((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat}scale(t,e){t=t||1,e==null&&(e=this.getCenterLonLat());var i,n;e.CLASS_NAME==="SuperMap.LonLat"?(i=e.lon,n=e.lat):(i=e.x,n=e.y);var s=(this.left-i)*t+i,o=(this.bottom-n)*t+n,l=(this.right-i)*t+i,u=(this.top-n)*t+n;return new F(s,o,l,u)}add(t,e){if(t==null||e==null)throw new TypeError("Bounds.add cannot receive null values");return new F(this.left+t,this.bottom+e,this.right+t,this.top+e)}extend(t){var e=null;if(t){switch(t.CLASS_NAME){case"SuperMap.LonLat":e=new F(t.lon,t.lat,t.lon,t.lat);break;case"SuperMap.Geometry.Point":e=new F(t.x,t.y,t.x,t.y);break;case"SuperMap.Bounds":e=t;break}e&&(this.centerLonLat=null,(this.left==null||e.left<this.left)&&(this.left=e.left),(this.bottom==null||e.bottom<this.bottom)&&(this.bottom=e.bottom),(this.right==null||e.right>this.right)&&(this.right=e.right),(this.top==null||e.top>this.top)&&(this.top=e.top))}}containsLonLat(t,e){typeof e=="boolean"&&(e={inclusive:e}),e=e||{};var i=this.contains(t.lon,t.lat,e.inclusive),n=e.worldBounds;if(n&&!i){var s=n.getWidth(),o=(n.left+n.right)/2,l=Math.round((t.lon-o)/s);i=this.containsLonLat({lon:t.lon-l*s,lat:t.lat},{inclusive:e.inclusive})}return i}containsPixel(t,e){return this.contains(t.x,t.y,e)}contains(t,e,i){if(i==null&&(i=!0),t==null||e==null)return!1;var n=!1;return i?n=t>=this.left&&t<=this.right&&e>=this.bottom&&e<=this.top:n=t>this.left&&t<this.right&&e>this.bottom&&e<this.top,n}intersectsBounds(t,e){if(typeof e=="boolean"&&(e={inclusive:e}),e=e||{},e.worldBounds){var i=this.wrapDateLine(e.worldBounds);t=t.wrapDateLine(e.worldBounds)}else i=this;e.inclusive==null&&(e.inclusive=!0);var n=!1,s=i.left===t.right||i.right===t.left||i.top===t.bottom||i.bottom===t.top;if(e.inclusive||!s){var o=t.bottom>=i.bottom&&t.bottom<=i.top||i.bottom>=t.bottom&&i.bottom<=t.top,l=t.top>=i.bottom&&t.top<=i.top||i.top>t.bottom&&i.top<t.top,u=t.left>=i.left&&t.left<=i.right||i.left>=t.left&&i.left<=t.right,c=t.right>=i.left&&t.right<=i.right||i.right>=t.left&&i.right<=t.right;n=(o||l)&&(u||c)}if(e.worldBounds&&!n){var f=e.worldBounds,y=f.getWidth(),S=!f.containsBounds(i),m=!f.containsBounds(t);S&&!m?(t=t.add(-y,0),n=i.intersectsBounds(t,{inclusive:e.inclusive})):m&&!S&&(i=i.add(-y,0),n=t.intersectsBounds(i,{inclusive:e.inclusive}))}return n}containsBounds(t,e,i){e==null&&(e=!1),i==null&&(i=!0);var n=this.contains(t.left,t.bottom,i),s=this.contains(t.right,t.bottom,i),o=this.contains(t.left,t.top,i),l=this.contains(t.right,t.top,i);return e?n||s||o||l:n&&s&&o&&l}determineQuadrant(t){var e="",i=this.getCenterLonLat();return e+=t.lat<i.lat?"b":"t",e+=t.lon<i.lon?"l":"r",e}wrapDateLine(t,e){e=e||{};var i=e.leftTolerance||0,n=e.rightTolerance||0,s=this.clone();if(t){for(var o=t.getWidth();s.left<t.left&&s.right-n<=t.left;)s=s.add(o,0);for(;s.left+i>=t.right&&s.right>t.right;)s=s.add(-o,0);var l=s.left+i;l<t.right&&l>t.left&&s.right-n>t.right&&(s=s.add(-o,0))}return s}toServerJSONObject(){var t={rightTop:{x:this.right,y:this.top},leftBottom:{x:this.left,y:this.bottom},left:this.left,right:this.right,top:this.top,bottom:this.bottom};return t}destroy(){this.left=null,this.right=null,this.top=null,this.bottom=null,this.centerLonLat=null}static fromString(t,e){var i=t.split(",");return F.fromArray(i,e)}static fromArray(t,e){return e===!0?new F(t[1],t[0],t[3],t[2]):new F(t[0],t[1],t[2],t[3])}static fromSize(t){return new F(0,t.h,t.w,0)}static oppositeQuadrant(t){var e="";return e+=t.charAt(0)==="t"?"b":"t",e+=t.charAt(1)==="l"?"r":"l",e}}class T extends rt{constructor(t,e,i,n){super(t,e,i,n),this.x=parseFloat(t),this.y=parseFloat(e),this.tag=n||n==0?parseFloat(n):null,this.type=i||"Point",this.CLASS_NAME="SuperMap.Geometry.Point",this.geometryType="Point"}clone(t){return t==null&&(t=new T(this.x,this.y)),v.applyDefaults(t,this),t}calculateBounds(){this.bounds=new F(this.x,this.y,this.x,this.y)}equals(t){var e=!1;return t!=null&&(e=this.x===t.x&&this.y===t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),e}move(t,e){this.x=this.x+t,this.y=this.y+e,this.clearBounds()}toShortString(){return this.x+", "+this.y}destroy(){this.x=null,this.y=null,this.tag=null,super.destroy()}getVertices(){return[this]}}class z extends rt{constructor(t){super(),this.components=[],this.componentTypes=null,t!=null&&this.addComponents(t),this.CLASS_NAME="SuperMap.Geometry.Collection",this.geometryType="Collection"}destroy(){this.components.length=0,this.components=null,super.destroy()}clone(){for(var t=new z,e=0,i=this.components.length;e<i;e++)t.addComponent(this.components[e].clone());return v.applyDefaults(t,this),t}getComponentsString(){for(var t=[],e=0,i=this.components.length;e<i;e++)t.push(this.components[e].toShortString());return t.join(",")}calculateBounds(){this.bounds=null;var t=new F,e=this.components;if(e)for(var i=0,n=e.length;i<n;i++)t.extend(e[i].getBounds());t.left!=null&&t.bottom!=null&&t.right!=null&&t.top!=null&&this.setBounds(t)}addComponents(t){v.isArray(t)||(t=[t]);for(var e=0,i=t.length;e<i;e++)this.addComponent(t[e])}addComponent(t,e){var i=!1;if(t&&(this.componentTypes==null||v.indexOf(this.componentTypes,t.CLASS_NAME)>-1)){if(e!=null&&e<this.components.length){var n=this.components.slice(0,e),s=this.components.slice(e,this.components.length);n.push(t),this.components=n.concat(s)}else this.components.push(t);t.parent=this,this.clearBounds(),i=!0}return i}removeComponents(t){var e=!1;v.isArray(t)||(t=[t]);for(var i=t.length-1;i>=0;--i)e=this.removeComponent(t[i])||e;return e}removeComponent(t){return v.removeItem(this.components,t),this.clearBounds(),!0}getArea(){for(var t=0,e=0,i=this.components.length;e<i;e++)t+=this.components[e].getArea();return t}equals(t){var e=!0;if(!t||!t.CLASS_NAME||this.CLASS_NAME!==t.CLASS_NAME)e=!1;else if(!v.isArray(t.components)||t.components.length!==this.components.length)e=!1;else for(var i=0,n=this.components.length;i<n;++i)if(!this.components[i].equals(t.components[i])){e=!1;break}return e}getVertices(t){for(var e=[],i=0,n=this.components.length;i<n;++i)Array.prototype.push.apply(e,this.components[i].getVertices(t));return e}}class at extends z{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point"],this.CLASS_NAME="SuperMap.Geometry.MultiPoint",this.geometryType="MultiPoint"}addPoint(t,e){this.addComponent(t,e)}removePoint(t){this.removeComponent(t)}}class Ee extends at{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point","SuperMap.PointWithMeasure"],this.CLASS_NAME="SuperMap.Geometry.Curve",this.geometryType="Curve"}}class L extends Ee{constructor(t){super(t),this.CLASS_NAME="SuperMap.Geometry.LineString",this.geometryType="LineString"}removeComponent(t){var e=this.components&&this.components.length>2;return e&&super.removeComponent.apply(this,arguments),e}getSortedSegments(){for(var t=this.components.length-1,e=new Array(t),i,n,s=0;s<t;++s)i=this.components[s],n=this.components[s+1],i.x<n.x?e[s]={x1:i.x,y1:i.y,x2:n.x,y2:n.y}:e[s]={x1:n.x,y1:n.y,x2:i.x,y2:i.y};function o(l,u){return l.x1-u.x1}return e.sort(o)}getVertices(t){var e;return t===!0?e=[this.components[0],this.components[this.components.length-1]]:t===!1?e=this.components.slice(1,this.components.length-1):e=this.components.slice(),e}static calculateCircle(t){if(t.length<3)return t;var e={},i=t[0],n=t[1],s=t[2],o=0,l=0,u=!0,c=0,f=0,y=0,S=72,m=[],P=(s.y-i.y)/(s.x-i.x),E=s.y-P*s.x;if(s.x!=i.x&&s.y!=i.y&&n.y==P*n.x+E||s.x==i.x&&n.x==i.x||s.y==i.y&&n.y==i.y||s.x==i.x&&s.y==i.y||s.x==n.x&&s.y==n.y||i.x==n.x&&i.y==n.y)m.push(i),m.push(n),m.push(s);else{var h=(n.x*n.x+n.y*n.y-(i.x*i.x+i.y*i.y))*(2*(s.y-i.y))-(s.x*s.x+s.y*s.y-(i.x*i.x+i.y*i.y))*(2*(n.y-i.y)),d=2*(n.x-i.x)*(s.x*s.x+s.y*s.y-(i.x*i.x+i.y*i.y))-2*(s.x-i.x)*(n.x*n.x+n.y*n.y-(i.x*i.x+i.y*i.y)),a=4*((n.x-i.x)*(s.y-i.y)-(s.x-i.x)*(n.y-i.y));e.x=h/a,e.y=d/a,o=Math.sqrt((i.x-e.x)*(i.x-e.x)+(i.y-e.y)*(i.y-e.y));var p=(i.x-s.x)*(i.x-s.x)+(i.y-s.y)*(i.y-s.y),w=(2*o*o-p)/(2*o*o);w=w>=1?1:w,w=w<=-1?-1:w,y=Math.acos(w)*180/Math.PI,s.x==i.x?y=e.x>i.x&&n.x>i.x||e.x<i.x&&n.x<i.x?360-y:y:y=e.y>P*e.x+E&&n.y>P*n.x+E||e.y<P*e.x+E&&n.y<P*n.x+E?360-y:y,l=y/72,s.y!=i.y?s.x==i.x?s.y>i.y?n.x<i.x&&(u=!1):n.x>i.x&&(u=!1):s.x<i.x?n.y<P*n.x+E&&(u=!1):n.y>P*n.x+E&&(u=!1):s.x>i.x?n.y>i.y&&(u=!1):n.y<i.y&&(u=!1);var I=(i.y-e.y)/(i.x-e.x),A=I>=0?Math.atan(I)*180/Math.PI:Math.abs(Math.atan(I)*180/Math.PI)+90,x=Math.abs(e.y);i.y==x&&x==s.y&&i.x<s.x&&(A=A+180);var O=i.y-e.y;m.push(i);for(var N=1;N<S;N++){c=l*N,f=A,u?O>=0?I>=0?f=f+c:f=180-(f-90)+c:I>0?f=f-180+c:f=90-f+c:O>=0?I>=0?f=f-c:f=180-(f-90)-c:I>=0?f=f-180-c:f=90-f-c,f=f*Math.PI/180;var q=e.x+o*Math.cos(f),k=e.y+o*Math.sin(f);m.push(new T(q,k))}m.push(s)}return m}static createLineEPS(t){var e=[],i=t.length;if(i<2)return t;for(var n=0;n<i;){var s=t[n].type;if(s=="LTypeArc"){var o=L.createLineArc(e,n,i,t);e=o[0],n=o[1]}else e.push(t[n]),n++}return e}static createLineArc(t,e,i,n){if(e==0){let l=L.addPointEPS(n,e,i,"LTypeArc");Array.prototype.push.apply(t,l[0]),e=l[1]+1}else if(e==i-1){var s=[n[e-1],n[e]],o=L.calculateCircle(s);Array.prototype.push.apply(t,o),e++}else{let l=L.addPointEPS(n,e,i,"LTypeArc");t.pop(),Array.prototype.push.apply(t,l[0]),e=l[1]+1}return[t,e]}static addPointEPS(t,e,i,n){var s=[],o=e+1;e==0?Array.prototype.push.apply(s,[t[e],t[e+1]]):e==i-1?Array.prototype.push.apply(s,[t[e-1],t[e]]):Array.prototype.push.apply(s,[t[e-1],t[e],t[e+1]]);var l;return n=="LTypeCurve"?l=L.calculatePointsFBZN(s):n=="LTypeArc"&&(l=L.calculateCircle(s)),[l,o]}}class U extends L{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Point"],this.CLASS_NAME="SuperMap.Geometry.LinearRing",this.geometryType="LinearRing"}addComponent(t,e){var i=!1,n=this.components.pop();(e!=null||!t.equals(n))&&(i=super.addComponent.apply(this,arguments));var s=this.components[0];return super.addComponent.apply(this,[s]),i}removeComponent(t){var e=this.components&&this.components.length>3;if(e){this.components.pop(),super.removeComponent.apply(this,arguments);var i=this.components[0];super.addComponent.apply(this,[i])}return e}getArea(){var t=0;if(this.components&&this.components.length>2){for(var e=0,i=0,n=this.components.length;i<n-1;i++){var s=this.components[i],o=this.components[i+1];e+=(s.x+o.x)*(o.y-s.y)}t=-e/2}return t}getVertices(t){return t===!0?[]:this.components.slice(0,this.components.length-1)}}class ot extends z{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.LineString"],this.CLASS_NAME="SuperMap.Geometry.MultiLineString",this.geometryType="MultiLineString"}}class B extends z{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.LinearRing"],this.CLASS_NAME="SuperMap.Geometry.Polygon",this.geometryType="Polygon"}getArea(){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getArea());for(var e=1,i=this.components.length;e<i;e++)t-=Math.abs(this.components[e].getArea())}return t}}class $ extends z{constructor(t){super(t),this.componentTypes=["SuperMap.Geometry.Polygon"],this.CLASS_NAME="SuperMap.Geometry.MultiPolygon",this.geometryType="MultiPolygon"}}class W{constructor(t,e,i){this.red=!t&&t!=0?255:t,this.green=e||0,this.blue=i||0,this.CLASS_NAME="SuperMap.ServerColor"}destroy(){var t=this;t.red=null,t.green=null,t.blue=null}static fromJson(t){if(t){var e=new W,i=255;t.red!==null&&(i=Number(t.red)),e.red=i;var n=0;t.green!==null&&(n=Number(t.green)),e.green=n;var s=0;return t.blue!==null&&(s=Number(t.blue)),e.blue=s,e}}}class _t{constructor(t){this.fillBackColor=new W(255,255,255),this.fillBackOpaque=!1,this.fillForeColor=new W(255,0,0),this.fillGradientMode=null,this.fillGradientAngle=0,this.fillGradientOffsetRatioX=0,this.fillGradientOffsetRatioY=0,this.fillOpaqueRate=100,this.fillSymbolID=0,this.lineColor=new W(0,0,0),this.lineSymbolID=0,this.lineWidth=1,this.markerAngle=0,this.markerSize=1,this.markerSymbolID=-1,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ServerStyle"}destroy(){var t=this;t.fillBackColor&&(t.fillBackColor.destroy(),t.fillBackColor=null),t.fillBackOpaque=null,t.fillForeColor&&(t.fillForeColor.destroy(),t.fillForeColor=null),t.fillGradientMode=null,t.fillGradientAngle=null,t.fillGradientOffsetRatioX=null,t.fillGradientOffsetRatioY=null,t.fillOpaqueRate=null,t.fillSymbolID=null,t.lineColor&&(t.lineColor.destroy(),t.lineColor=null),t.lineSymbolID=null,t.lineWidth=null,t.markerAngle=null,t.markerSize=null,t.markerSymbolID=null}toServerJSONObject(){var t={};return t=v.copyAttributes(t,this),t}static fromJson(t){if(t)return new _t({fillBackColor:W.fromJson(t.fillBackColor),fillBackOpaque:t.fillBackOpaque,fillForeColor:W.fromJson(t.fillForeColor),fillGradientMode:t.fillGradientMode,fillGradientAngle:t.fillGradientAngle,fillGradientOffsetRatioX:t.fillGradientOffsetRatioX,fillGradientOffsetRatioY:t.fillGradientOffsetRatioY,fillOpaqueRate:t.fillOpaqueRate,fillSymbolID:t.fillSymbolID,lineColor:W.fromJson(t.lineColor),lineSymbolID:t.lineSymbolID,lineWidth:t.lineWidth,markerAngle:t.markerAngle,markerSize:t.markerSize,markerSymbolID:t.markerSymbolID})}}class xt extends T{constructor(t){super(t),this.measure=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.PointWithMeasure"}equals(t){var e=!1;if(t!=null){var i=this.x===t.x&&this.y===t.y&&this.measure===t.measure,n=isNaN(this.x)&&isNaN(this.y)&&isNaN(this.measure),s=isNaN(t.x)&&isNaN(t.y)&&isNaN(t.measure);e=i||n&&s}return e}toJson(){var t="{";return this.measure!=null&&this.measure!=null&&(t+='"measure":'+this.measure+","),t+='"x":'+this.x+",",t+='"y":'+this.y,t+="}",t}destroy(){var t=this;t.measure=null,t.x=null,t.y=null}static fromJson(t){if(t)return new xt({x:t.x,y:t.y,measure:t.measure})}}class Ct extends z{constructor(t,e){super(t,e),this.id=null,this.center=null,this.style=null,this.length=null,this.maxM=null,this.minM=null,this.parts=null,this.points=null,this.type=null,this.componentTypes=["SuperMap.Geometry.LinearRing","SuperMap.Geometry.LineString"],e&&v.extend(this,e),this.CLASS_NAME="SuperMap.Route",this.geometryType="LINEM"}toJson(){var t="{";if(this.id!=null&&this.id!=null&&(t+='"id":'+this.id+","),this.center!=null&&this.center!=null&&(t+='"center":'+this.center+","),this.style!=null&&this.style!=null&&(t+='"style":'+this.style+","),this.length!=null&&this.length!=null&&(t+='"length":'+this.length+","),this.maxM!=null&&this.maxM!=null&&(t+='"maxM":'+this.maxM+","),this.minM!=null&&this.minM!=null&&(t+='"minM":'+this.minM+","),this.type!=null&&this.type!=null&&(t+='"type":"'+this.type+'",'),this.parts!=null&&this.parts!=null){t+='"parts":['+this.parts[0];for(var e=1;e<this.parts.length;e++)t+=","+this.parts[e];t+="],"}if(this.components!=null&&this.components.length>0){t+='"points":[';for(var i=0,n=this.components.length;i<n;i++)for(var s=0,o=this.components[i].components.length;s<o;s++)t+=this.components[i].components[s].toJson()+",";t=t.replace(/,$/g,""),t+="]"}return t=t.replace(/,$/g,""),t+="}",t}destroy(){var t=this;t.id=null,t.center=null,t.style=null,t.length=null,t.maxM=null,t.minM=null,t.type=null,t.parts=null,t.components.length=0,t.components=null,t.componentTypes=null}static fromJson(t){if(t){var e=t.parts||[],i=t.points||[],n=e.length,s=[];if(n>0)for(var o=0,l=0,u=[];o<n;o++){for(var c=0;c<e[o];c++)u.push(xt.fromJson(i[l+c]));l+=e[o],u[0].equals(u[e[o]-1])?s.push(new U(u)):s.push(new L(u)),u=[]}else return null;return new Ct(s,{id:t.id,center:t.center,style:t.style,length:t.length,maxM:t.maxM,minM:t.minM,type:t.type,parts:t.parts})}}}class J{constructor(t){this.id=0,this.style=null,this.parts=null,this.points=null,this.type=null,this.prjCoordSys=null,t&&v.extend(this,t),this.CLASS_NAME="SuperMap.ServerGeometry"}destroy(){var t=this;t.id=null,t.style=null,t.parts=null,t.partTopo=null,t.points=null,t.type=null,t.prjCoordSys=null}toGeometry(){var t=this,e=t.type;switch(e.toUpperCase()){case R.POINT:return t.toGeoPoint();case R.LINE:return t.toGeoLine();case R.LINEM:return t.toGeoLinem();case R.REGION:return t.toGeoRegion();case R.POINTEPS:return t.toGeoPoint();case R.LINEEPS:return t.toGeoLineEPS();case R.REGIONEPS:return t.toGeoRegionEPS();case R.GEOCOMPOUND:return t.transformGeoCompound()}}toGeoPoint(){var t=this,e=t.parts||[],i=t.points||[],n=e.length;if(n>0){if(n===1)return new T(i[0].x,i[0].y);var s=[];for(let o=0;o<n;o++)s.push(new T(i[o].x,i[o].y));return new at(s)}else return null}toGeoLine(){var t=this,e=t.parts||[],i=t.points||[],n=e.length;if(n>0)if(n===1){let s=[];for(let o=0;o<e[0];o++)s.push(new T(i[o].x,i[o].y));return s[0].equals(s[e[0]-1])?new U(s):new L(s)}else{let s=[];for(let o=0;o<n;o++){let l=[];for(let u=0;u<e[o];u++)l.push(new T(i[u].x,i[u].y));s.push(new L(l)),i.splice(0,e[o])}return new ot(s)}else return null}toGeoLineEPS(){var t=this,e=t.parts||[],i=t.points||[],n,s,o,l,u,c=e.length;if(c>0)if(c===1){for(n=0,o=[];n<e[0];n++)o.push(new T(i[n].x,i[n].y,i[n].type));return o[0].equals(o[e[0]-1])?(u=L.createLineEPS(o),new U(u)):(u=L.createLineEPS(o),new L(u))}else{for(n=0,l=[];n<c;n++){for(s=0,o=[];s<e[n];s++)o.push(new T(i[s].x,i[s].y));u=L.createLineEPS(o),l.push(new L(u)),i.splice(0,e[n])}return new ot(l)}else return null}toGeoLinem(){var t=this;return Ct.fromJson(t)}toGeoRegion(){var t=this,e=t.parts||[],i=t.partTopo||[],n=t.points||[],s=e.length;if(s<=0)return null;var o=[],l=[];if(s==1){for(let h=0;h<n.length;h++)l.push(new T(n[h].x,n[h].y));return o.push(new B([new U(l)])),new $(o)}var u=[],c=[],f=[],y=[],S=[];for(let h=0,d=0;h<s;h++){for(let a=0;a<e[h];a++)l.push(new T(n[d+a].x,n[d+a].y));d+=e[h];var m=new B([new U(l)]);l=[],f.push(m),i.length===0&&y.push(m.getBounds()),S.push(1),c.push(m.getArea())}if(i.length===0){J.bubbleSort(c,f,i,y);var P=[];for(let h=1;h<f.length;h++)for(let d=h-1;d>=0;d--)if(P[h]=-1,y[d].containsBounds(y[h])){S[h]=S[d]*-1,S[h]<0&&(P[h]=d);break}for(let h=0;h<f.length;h++)S[h]>0?o.push(f[h]):(o[P[h]].components=o[P[h]].components.concat(f[h].components),o.push(""))}else{o=new Array;for(let h=0;h<f.length;h++)if(i[h]&&i[h]==-1?u=u.concat(f[h].components):(u.length>0&&o.length>0&&(o[o.length-1].components=o[o.length-1].components.concat(u),u=[]),o.push(f[h])),h==s-1){var E=o.length;if(E)o[E-1].components=o[E-1].components.concat(u);else for(let d=0,a=u.length;d<a;d++)o.push(new B(u))}}return new $(o)}toGeoRegionEPS(){var t=this,e=t.parts||[],i=t.partTopo||[],n=t.points||[],s=e.length;if(s<=0)return null;var o=[],l=[],u;if(s==1){for(var c=0;c<n.length;c++)l.push(new T(n[c].x,n[c].y));return u=L.createLineEPS(l),o.push(new B([new U(u)])),new $(o)}var f=[],y=[],S=[],m=[],P=[];for(let a=0,p=0;a<s;a++){for(let w=0;w<e[a];w++)l.push(new T(n[p+w].x,n[p+w].y));p+=e[a],u=L.createLineEPS(l);var E=new B([new U(u)]);l=[],S.push(E),i.length===0&&m.push(E.getBounds()),P.push(1),y.push(E.getArea())}if(i.length===0){J.bubbleSort(y,S,i,m);var h=[];for(let a=1;a<S.length;a++)for(let p=a-1;p>=0;p--)if(h[a]=-1,m[p].containsBounds(m[a])){P[a]=P[p]*-1,P[a]<0&&(h[a]=p);break}for(let a=0;a<S.length;a++)P[a]>0?o.push(S[a]):(o[h[a]].components=o[h[a]].components.concat(S[a].components),o.push(""))}else{o=new Array;for(let a=0;a<S.length;a++)if(i[a]&&i[a]==-1?f=f.concat(S[a].components):(f.length>0&&o.length>0&&(o[o.length-1].components=o[o.length-1].components.concat(f),f=[]),o.push(S[a])),a==s-1){var d=o.length;if(d)o[d-1].components=o[d-1].components.concat(f);else for(let p=0,w=f.length;p<w;p++)o.push(new B(f))}}return new $(o)}transformGeoCompound(){const t=this,e=t.geoParts||[],i=e.length;if(i<=0)return null;const n=[];for(let s=0;s<i;s++){const o=e[s];n.push(new J(o).toGeometry())}return new z(n)}static fromJson(t){if(t)return new J({id:t.id,style:_t.fromJson(t.style),parts:t.parts,partTopo:t.partTopo,points:t.points,center:t.center,length:t.length,maxM:t.maxM,minM:t.minM,type:t.type})}static fromGeometry(t){if(t){var e=0,i=[],n=[],s=null,o=t.components,l=t.CLASS_NAME,u={epsgCode:t.SRID};if(isNaN(t.id)||(e=t.id),l!="SuperMap.Geometry.LinearRing"&&l!="SuperMap.Geometry.LineString"&&(t instanceof at||t instanceof ot)){let c=o.length;for(let f=0;f<c;f++){const y=o[f].getVertices();let S=y.length;i.push(S);for(let m=0;m<S;m++)n.push(new T(y[m].x,y[m].y))}s=l=="SuperMap.Geometry.MultiPoint"?R.POINT:R.LINE}else if(t instanceof $){let c=o.length;for(let f=0;f<c;f++){let y=o[f],S=y.components,m=S.length;for(let P=0;P<m;P++){const E=S[P].getVertices(),h=E.length+1;i.push(h);for(let d=0;d<h-1;d++)n.push(new T(E[d].x,E[d].y));n.push(new T(E[0].x,E[0].y))}}s=R.REGION}else if(t instanceof B){let c=o.length;for(let f=0;f<c;f++){const y=o[f].getVertices();let S=y.length+1;i.push(S);for(let m=0;m<S-1;m++)n.push(new T(y[m].x,y[m].y));n.push(new T(y[0].x,y[0].y))}s=R.REGION}else{const c=t.getVertices();let f=c.length;for(let y=0;y<f;y++)n.push(new T(c[y].x,c[y].y));t instanceof U&&(n.push(new T(c[0].x,c[0].y)),f++),i.push(f),s=t instanceof T?R.POINT:R.LINE}return new J({id:e,style:null,parts:i,points:n,type:s,prjCoordSys:u})}}static IsClockWise(t){var e=t.length;if(e<3)return 0;var i=t[0].y*(t[e-1].x-t[1].x);t.push(t[0]);for(var n=1;n<e;n++)i+=t[n].y*(t[n-1].x-t[n+1].x);return i*.5}static bubbleSort(t,e,i,n){for(var s=0;s<t.length;s++)for(var o=0;o<t.length;o++)if(t[s]>t[o]){var l=t[o];t[o]=t[s],t[s]=l;var u=e[o];if(e[o]=e[s],e[s]=u,i&&i.length>0){var c=i[o];i[o]=i[s],i[s]=c}if(n&&n.length>0){var f=n[o];n[o]=n[s],n[s]=f}}}}class Ae{constructor(t,e,i){this.CLASS_NAME="SuperMap.Feature",this.layer=t,this.id=v.createUniqueID(this.CLASS_NAME+"_"),this.lonlat=e,this.data=i??{}}destroy(){this.id=null,this.lonlat=null,this.data=null}}const G={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};class et extends Ae{constructor(t,e,i){super(null,null,e),this.fid=null,this.geometry=t||null,this.attributes={},e&&(this.attributes=v.extend(this.attributes,e)),this.bounds=null,this.state=null,this.style=i||null,this.url=null,this.lonlat=null,this.CLASS_NAME="SuperMap.Feature.Vector",et.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"default",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}}}destroy(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,super.destroy()}clone(){return new et(this.geometry?this.geometry.clone():null,this.attributes,this.style)}toState(t){if(t===G.UPDATE)switch(this.state){case G.UNKNOWN:case G.DELETE:this.state=t;break}else if(t===G.INSERT)switch(this.state){case G.UNKNOWN:break;default:this.state=t;break}else if(t===G.DELETE)switch(this.state){case G.INSERT:break;case G.DELETE:break;case G.UNKNOWN:case G.UPDATE:this.state=t;break}else t===G.UNKNOWN&&(this.state=t)}}class Te{constructor(t){this.data=null,this.keepData=!1,v.extend(this,t),this.options=t,this.CLASS_NAME="SuperMap.Format"}destroy(){}read(t){}write(t){}}class Ie extends Te{constructor(t){super(t),this.indent="    ",this.space=" ",this.newline=`
`,this.level=0,this.pretty=!1,this.nativeJSON=function(){return!!(window.JSON&&typeof JSON.parse=="function"&&typeof JSON.stringify=="function")}(),this.CLASS_NAME="SuperMap.Format.JSON",this.serialize={object:function(e){if(e==null)return"null";if(e.constructor===Date)return this.serialize.date.apply(this,[e]);if(e.constructor===Array)return this.serialize.array.apply(this,[e]);var i=["{"];this.level+=1;var n,s,o,l=!1;for(n in e)e.hasOwnProperty(n)&&(s=this.write.apply(this,[n,this.pretty]),o=this.write.apply(this,[e[n],this.pretty]),s!=null&&o!=null&&(l&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),s,":",this.writeSpace(),o),l=!0));return this.level-=1,i.push(this.writeNewline(),this.writeIndent(),"}"),i.join("")},array:function(e){var i,n=["["];this.level+=1;for(var s=0,o=e.length;s<o;++s)i=this.write.apply(this,[e[s],this.pretty]),i!=null&&(s>0&&n.push(","),n.push(this.writeNewline(),this.writeIndent(),i));return this.level-=1,n.push(this.writeNewline(),this.writeIndent(),"]"),n.join("")},string:function(e){var i={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(n,s){var o=i[s];return o||(o=s.charCodeAt(),"\\u00"+Math.floor(o/16).toString(16)+(o%16).toString(16))})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},boolean:function(e){return String(e)},date:function(e){function i(n){return n<10?"0"+n:n}return'"'+e.getFullYear()+"-"+i(e.getMonth()+1)+"-"+i(e.getDate())+"T"+i(e.getHours())+":"+i(e.getMinutes())+":"+i(e.getSeconds())+'"'}}}read(t,e){var i;if(this.nativeJSON)try{i=JSON.parse(t,e)}catch{return{data:t}}return this.keepData&&(this.data=i),i}write(t,e){this.pretty=!!e;var i=null,n=typeof t;if(this.serialize[n])try{i=!this.pretty&&this.nativeJSON?JSON.stringify(t):this.serialize[n].apply(this,[t])}catch{}return i}writeIndent(){var t=[];if(this.pretty)for(var e=0;e<this.level;++e)t.push(this.indent);return t.join("")}writeNewline(){return this.pretty?this.newline:""}writeSpace(){return this.pretty?this.space:""}}class Jt extends Ie{constructor(t){super(t),this.ignoreExtraDims=!0,this.CLASS_NAME="SuperMap.Format.GeoJSON",this.parseCoords={point:function(e){if(this.ignoreExtraDims===!1&&e.length!=2)throw"Only 2D points are supported: "+e;return new T(e[0],e[1])},multipoint:function(e){for(var i=[],n=null,s=0,o=e.length;s<o;++s){try{n=this.parseCoords.point.apply(this,[e[s]])}catch(l){throw l}i.push(n)}return new at(i)},linestring:function(e){for(var i=[],n=null,s=0,o=e.length;s<o;++s){try{n=this.parseCoords.point.apply(this,[e[s]])}catch(l){throw l}i.push(n)}return new L(i)},multilinestring:function(e){for(var i=[],n=null,s=0,o=e.length;s<o;++s){try{n=this.parseCoords.linestring.apply(this,[e[s]])}catch(l){throw l}i.push(n)}return new ot(i)},polygon:function(e){for(var i=[],n,s,o=0,l=e.length;o<l;++o){try{s=this.parseCoords.linestring.apply(this,[e[o]])}catch(u){throw u}n=new U(s.components),i.push(n)}return new B(i)},multipolygon:function(e){for(var i=[],n=null,s=0,o=e.length;s<o;++s){try{n=this.parseCoords.polygon.apply(this,[e[s]])}catch(l){throw l}i.push(n)}return new $(i)},box:function(e){if(e.length!=2)throw"GeoJSON box coordinates must have 2 elements";return new B([new U([new T(e[0][0],e[0][1]),new T(e[1][0],e[0][1]),new T(e[1][0],e[1][1]),new T(e[0][0],e[1][1]),new T(e[0][0],e[0][1])])])}},this.extract={feature:function(e){var i=this.extract.geometry.apply(this,[e.geometry]),n={type:"Feature",properties:this.createAttributes(e),geometry:i};return e.geometry&&e.geometry.type==="TEXT"&&(n.properties.texts=e.geometry.texts,n.properties.textStyle=e.geometry.textStyle),e.fid&&(n.id=e.fid),e.ID&&(n.id=e.ID),n},geometry:function(e){if(e==null)return null;!e.parts&&e.points&&(e.parts=[e.points.length]);var i=e.hasOwnProperty("geometryType")?e:new J(e).toGeometry()||e,n=i.geometryType||i.type,s;n==="LinearRing"&&(n="LineString"),n==="LINEM"&&(n="MultiLineString"),s=this.extract[n.toLowerCase()].apply(this,[i]),n=n==="TEXT"?"Point":n;var o;return n==="Collection"?o={type:"GeometryCollection",geometries:s}:o={type:n,coordinates:s},o},point:function(e){var i=[e.x,e.y];for(var n in e)n!=="x"&&n!=="y"&&e[n]!==null&&!isNaN(e[n])&&i.push(e[n]);return i},text:function(e){return[e.points[0].x,e.points[0].y]},multipoint:function(e){for(var i=[],n=0,s=e.components.length;n<s;++n)i.push(this.extract.point.apply(this,[e.components[n]]));return i},linestring:function(e){for(var i=[],n=0,s=e.components.length;n<s;++n)i.push(this.extract.point.apply(this,[e.components[n]]));return i},multilinestring:function(e){for(var i=[],n=0,s=e.components.length;n<s;++n)i.push(this.extract.linestring.apply(this,[e.components[n]]));return i},polygon:function(e){for(var i=[],n=0,s=e.components.length;n<s;++n)i.push(this.extract.linestring.apply(this,[e.components[n]]));return i},multipolygon:function(e){for(var i=[],n=0,s=e.components.length;n<s;++n)i.push(this.extract.polygon.apply(this,[e.components[n]]));return i},collection:function(e){for(var i=e.components.length,n=new Array(i),s=0;s<i;++s)n[s]=this.extract.geometry.apply(this,[e.components[s]]);return n}}}read(t,e,i){e=e||"FeatureCollection";var n=null,s=null;if(typeof t=="string"?s=super.read(t,i):s=t,s){if(typeof s.type=="string"){if(this.isValidType(s,e))switch(e){case"Geometry":try{n=this.parseGeometry(s)}catch{}break;case"Feature":try{n=this.parseFeature(s),n.type="Feature"}catch{}break;case"FeatureCollection":switch(n=[],s.type){case"Feature":try{n.push(this.parseFeature(s))}catch{n=null}break;case"FeatureCollection":for(var o=0,l=s.features.length;o<l;++o)try{n.push(this.parseFeature(s.features[o]))}catch{n=null}break;default:try{var u=this.parseGeometry(s);n.push(new et(u))}catch{n=null}}break}}}return n}write(t,e){return super.write(this.toGeoJSON(t),e)}fromGeoJSON(t,e,i){let n=this.read(t,e,i);return v.isArray(n)?n.map(s=>this._toiSevrerFeature(s)):this._toiSevrerFeature(n)}toGeoJSON(t){var e={type:null};if(v.isArray(t)){e.type="FeatureCollection";var i=t.length;e.features=new Array(i);for(var n=0;n<i;++n){var s=t[n];if(o(s)){let l={};l.geometry=s,e.features[n]=this.extract.feature.apply(this,[l])}else e.features[n]=this.extract.feature.apply(this,[s])}}else if(o(t)){let l={};l.geometry=t,e=this.extract.feature.apply(this,[l])}else e=this.extract.feature.apply(this,[t]);function o(l){return l.hasOwnProperty("parts")&&l.hasOwnProperty("points")||l.hasOwnProperty("geoParts")}return e}isValidType(t,e){var i=!1;switch(e){case"Geometry":v.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],t.type)==-1||(i=!0);break;case"FeatureCollection":i=!0;break;default:t.type==e&&(i=!0)}return i}parseFeature(t){var e,i,n,s;n=t.properties?t.properties:{},s=t.geometry&&t.geometry.bbox||t.bbox;try{i=this.parseGeometry(t.geometry)}catch(o){throw o}return e=new et(i,n),s&&(e.bounds=F.fromArray(s)),t.id&&(e.geometry.id=t.id,e.fid=t.id),e}parseGeometry(t){if(t==null)return null;var e;if(t.type=="GeometryCollection"){if(!v.isArray(t.geometries))throw"GeometryCollection must have geometries array: "+t;for(var i=t.geometries.length,n=new Array(i),s=0;s<i;++s)n[s]=this.parseGeometry.apply(this,[t.geometries[s]]);e=new z(n)}else{if(!v.isArray(t.coordinates))throw"Geometry must have coordinates array: "+t;if(!this.parseCoords[t.type.toLowerCase()])throw"Unsupported geometry type: "+t.type;try{e=this.parseCoords[t.type.toLowerCase()].apply(this,[t.coordinates])}catch(o){throw o}}return e}createCRSObject(t){var e=t.layer.projection.toString(),i={};if(e.match(/epsg:/i)){var n=parseInt(e.substring(e.indexOf(":")+1));n==4326?i={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:i={type:"name",properties:{name:"EPSG:"+n}}}return i}_toiSevrerFeature(t){const e=t.attributes,i=[],n=[];for(var s in e)i.push(s),n.push(e[s]);const o={fieldNames:i,fieldValues:n,geometry:J.fromGeometry(t.geometry)};return o.geometry.id=t.fid,o}createAttributes(t){if(!t)return null;var e={};s(t,e);var i=["fieldNames","fieldValues","geometry","stringID","ID"];for(var n in t)i.indexOf(n)>-1||(e[n]=t[n]);function s(o,l){if(o.hasOwnProperty("fieldNames")&&o.hasOwnProperty("fieldValues")){var u=o.fieldNames,c=o.fieldValues;for(var f in u)l[u[f]]=c[f]}}return e}}var Oe=function(r){var t=6378137,e;if(r===H.METER)e=1;else if(r===H.DEGREE)e=Math.PI*2*t/360;else if(r===H.KILOMETER)e=.001;else if(r===H.INCH)e=1/.025399999918;else if(r===H.FOOT)e=.3048;else return e;return e};const Ne={};b.Util.supermap_callbacks=Ne;const be=function(r){return r&&new Jt().toGeoJSON(r)},zt=function(r){if(!r)return r;let t;const e=new Jt;if(["FeatureCollection","Feature","Geometry"].indexOf(r.type)!==-1)t=e.read(r,r.type);else if(typeof r.toGeoJSON=="function"){const n=r.toGeoJSON();t=n?e.read(n,n.type):r}let i=t||r;return b.Util.isArray(t)&&(t.length===1?i=t[0]:t.length>1&&(i=[],t.map(function(n){return i.push(n.geometry),n}))),i&&i.geometry?i.geometry:i},Pt=Oe,Wt=function(r,t,e){const i=39.37007874015748,n=Pt(e);let s=r*t*i*n;return s=1/s,s},Le=function(r,t,e){const i=39.37007874015748,n=Pt(e);let s=r*t*i*n;return s=1/s,s},Me=function(r,t,e,i){let n=null;const s=1e4;return i=i||6378137,e=e||"",r>0&&t>0?(r=b.Util.NormalizeScale(r),e.toLowerCase()==="degree"||e.toLowerCase()==="degrees"||e.toLowerCase()==="dd"?(n=.0254*s/t/r/(Math.PI*2*i/360)/s,n):(n=.0254*s/t/r/s,n)):-1},Re=function(r){return r>1?1/r:r};b.Util.toGeoJSON=be;b.Util.toSuperMapGeometry=zt;b.Util.resolutionToScale=Wt;b.Util.scaleToResolution=Le;b.Util.getMeterPerMapUnit=Pt;b.Util.GetResolutionFromScaleDpi=Me;b.Util.NormalizeScale=Re;const ke=b.TileLayer.extend({options:{layersID:null,redirect:!1,transparent:!0,cacheEnabled:!0,clipRegionEnabled:!1,clipRegion:null,prjCoordSys:null,overlapDisplayed:!1,overlapDisplayedOptions:null,tileversion:null,crs:null,format:"png",tileProxy:null,attribution:"Map Data <span>© <a href='http://support.supermap.com.cn/product/iServer.aspx' title='SuperMap iServer' target='_blank'>SuperMap iServer</a></span>",subdomains:null},initialize:function(r,t){this._url=r,b.TileLayer.prototype.initialize.apply(this,arguments),b.setOptions(this,t),b.stamp(this),this.tileSetsIndex=-1,this.tempIndex=-1},onAdd:function(r){this._crs=this.options.crs||r.options.crs,b.TileLayer.prototype.onAdd.call(this,r)},getTileUrl:function(r){const t=this.getScaleFromCoords(r);let i=this._getLayerUrl()+"&scale="+t+"&x="+r.x+"&y="+r.y;return this.options.tileProxy&&(i=this.options.tileProxy+encodeURIComponent(i)),this.options.cacheEnabled||(i+="&_t="+new Date().getTime()),this.options.subdomains&&(i=b.Util.template(i,{s:this._getSubdomain(r)})),i},getScale:function(r){const t=this,e=r||t._map.getZoom();return t.scales[e]},getScaleFromCoords:function(r){const t=this;if(t.scales&&t.scales[r.z])return t.scales[r.z];t.scales=t.scales||{};const e=t.getDefaultScale(r);return t.scales[r.z]=e,e},getDefaultScale:function(r){const t=this,e=t._crs;if(e.scales)return e.scales[r.z];{const i=t._tileCoordsToBounds(r),n=e.project(i.getNorthEast()),s=e.project(i.getSouthWest()),o=t.options.tileSize,l=Math.max(Math.abs(n.x-s.x)/o,Math.abs(n.y-s.y)/o);let u=H.METER;if(e.code){const c=e.code.split(":");if(c&&c.length>1){const f=parseInt(c[1]);u=f&&f>=4e3&&f<=5e3?H.DEGREE:H.METER}}return Wt(l,96,u)}},setTileSetsInfo:function(r){this.tileSets=r,b.Util.isArray(this.tileSets)&&(this.tileSets=this.tileSets[0]),this.tileSets&&(this.fire("tilesetsinfoloaded",{tileVersions:this.tileSets.tileVersions}),this.changeTilesVersion())},lastTilesVersion:function(){this.tempIndex=this.tileSetsIndex-1,this.changeTilesVersion()},nextTilesVersion:function(){this.tempIndex=this.tileSetsIndex+1,this.changeTilesVersion()},changeTilesVersion:function(){const r=this;if(r.tileSets==null||r.tempIndex===r.tileSetsIndex||this.tempIndex<0)return;const t=r.tileSets.tileVersions;if(t&&r.tempIndex<t.length&&r.tempIndex>=0){const e=t[r.tempIndex].name;r.mergeTileVersionParam(e)&&(r.tileSetsIndex=r.tempIndex,r.fire("tileversionschanged",{tileVersion:t[r.tempIndex]}))}},updateCurrentTileSetsIndex:function(r){this.tempIndex=r},mergeTileVersionParam:function(r){return r?(this.requestParams.tileversion=r,this._paramsChanged=!0,this.redraw(),this._paramsChanged=!1,!0):!1},_getLayerUrl:function(){return this._paramsChanged&&(this._layerUrl=this._createLayerUrl()),this._layerUrl||this._createLayerUrl()},_createLayerUrl:function(){let r=v.urlPathAppend(this._url,`tileImage.${this.options.format}`);return this.requestParams=this.requestParams||this._getAllRequestParams(),r=v.urlAppend(r,g.Util.getParamString(this.requestParams)),r=K.appendCredential(r),this._layerUrl=r,r},_getAllRequestParams:function(){const r=this,t=r.options||{},e={};let i=this.options.tileSize;i instanceof b.Point||(i=b.point(i,i)),e.width=i.x,e.height=i.y,e.redirect=t.redirect===!0,e.transparent=t.transparent===!0,e.cacheEnabled=t.cacheEnabled!==!1,t.prjCoordSys&&(e.prjCoordSys=JSON.stringify(t.prjCoordSys)),t.layersID&&(e.layersID=t.layersID.toString()),t.clipRegionEnabled&&t.clipRegion&&(t.clipRegion=J.fromGeometry(zt(t.clipRegion)),e.clipRegionEnabled=t.clipRegionEnabled,e.clipRegion=JSON.stringify(t.clipRegion));const n=r._crs;if(n.options&&n.options.origin)e.origin=JSON.stringify({x:n.options.origin[0],y:n.options.origin[1]});else if(n.projection&&n.projection.bounds){const s=n.projection.bounds,o=b.point(s.min.x,s.max.y);e.origin=JSON.stringify({x:o.x,y:o.y})}return t.overlapDisplayed===!1?(e.overlapDisplayed=!1,t.overlapDisplayedOptions&&(e.overlapDisplayedOptions=r.overlapDisplayedOptions.toString())):e.overlapDisplayed=!0,e.cacheEnabled===!0&&t.tileversion&&(e.tileversion=t.tileversion.toString()),t.rasterfunction&&(e.rasterfunction=JSON.stringify(t.rasterfunction)),e}}),De=function(r,t){return new ke(r,t)};var ut=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,Fe=document.documentElement.style.pointerEvents==="",Q={cors:ut,pointerEvents:Fe},kt=0;function ht(r){var t="";r.f=r.f||"json";for(var e in r)if(Object.prototype.hasOwnProperty.call(r,e)){var i=r[e],n=Object.prototype.toString.call(i),s;t.length&&(t+="&"),n==="[object Array]"?s=Object.prototype.toString.call(i[0])==="[object Object]"?JSON.stringify(i):i.join(","):n==="[object Object]"?s=JSON.stringify(i):n==="[object Date]"?s=i.valueOf():s=i,t+=encodeURIComponent(e)+"="+encodeURIComponent(s)}return t}function Et(r,t){var e=new window.XMLHttpRequest;return e.onerror=function(i){e.onreadystatechange=g.Util.falseFn,r.call(t,{error:{code:500,message:"XMLHttpRequest error"}},null)},e.onreadystatechange=function(){var i,n;if(e.readyState===4){try{i=JSON.parse(e.responseText)}catch{i=null,n={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!n&&i.error&&(n=i.error,i=null),e.onerror=g.Util.falseFn,r.call(t,n,i)}},e.ontimeout=function(){this.onerror()},e}function qe(r,t,e,i){var n=Et(e,i);return n.open("POST",r),typeof i<"u"&&i!==null&&typeof i.options<"u"&&(n.timeout=i.options.timeout),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.send(ht(t)),n}function Ht(r,t,e,i){var n=Et(e,i);return n.open("GET",r+"?"+ht(t),!0),typeof i<"u"&&i!==null&&typeof i.options<"u"&&(n.timeout=i.options.timeout,i.options.withCredentials&&(n.withCredentials=!0)),n.send(null),n}function Ge(r,t,e,i){var n=ht(t),s=Et(e,i),o=(r+"?"+n).length;if(o<=2e3&&Q.cors?s.open("GET",r+"?"+n):o>2e3&&Q.cors&&(s.open("POST",r),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),typeof i<"u"&&i!==null&&typeof i.options<"u"&&(s.timeout=i.options.timeout,i.options.withCredentials&&(s.withCredentials=!0)),o<=2e3&&Q.cors)s.send(null);else if(o>2e3&&Q.cors)s.send(n);else{if(o<=2e3&&!Q.cors)return At(r,t,e,i);ft("a request to "+r+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy https://developers.arcgis.com/esri-leaflet/api-reference/request/");return}return s}function At(r,t,e,i){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var n="c"+kt;t.callback="window._EsriLeafletCallbacks."+n,window._EsriLeafletCallbacks[n]=function(o){if(window._EsriLeafletCallbacks[n]!==!0){var l,u=Object.prototype.toString.call(o);u==="[object Object]"||u==="[object Array]"||(l={error:{code:500,message:"Expected array or object as JSONP response"}},o=null),!l&&o.error&&(l=o,o=null),e.call(i,l,o),window._EsriLeafletCallbacks[n]=!0}};var s=g.DomUtil.create("script",null,document.body);return s.type="text/javascript",s.src=r+"?"+ht(t),s.id=n,s.onerror=function(o){if(o&&window._EsriLeafletCallbacks[n]!==!0){var l={error:{code:500,message:"An unknown error occurred"}};e.call(i,l),window._EsriLeafletCallbacks[n]=!0}},g.DomUtil.addClass(s,"esri-leaflet-jsonp"),kt++,{id:n,url:s.src,abort:function(){window._EsriLeafletCallbacks._callback[n]({code:0,message:"Request aborted."})}}}var Tt=Q.cors?Ht:At;Tt.CORS=Ht;Tt.JSONP=At;function ft(){console&&console.warn&&console.warn.apply(console,arguments)}var lt={request:Ge,get:Tt,post:qe},Ue={attributionWidthOffset:55};/* @preserve
* @terraformer/arcgis - v2.1.1 - MIT
* Copyright (c) 2012-2022 Environmental Systems Research Institute, Inc.
* Tue Aug 02 2022 14:23:48 GMT-0700 (Pacific Daylight Time)
*/var Be=function(t,e,i,n){var s=(n[0]-i[0])*(t[1]-i[1])-(n[1]-i[1])*(t[0]-i[0]),o=(e[0]-t[0])*(t[1]-i[1])-(e[1]-t[1])*(t[0]-i[0]),l=(n[1]-i[1])*(e[0]-t[0])-(n[0]-i[0])*(e[1]-t[1]);if(l!==0){var u=s/l,c=o/l;if(u>=0&&u<=1&&c>=0&&c<=1)return!0}return!1},Je=function(t,e){for(var i=!1,n=-1,s=t.length,o=s-1;++n<s;o=n)(t[n][1]<=e[1]&&e[1]<t[o][1]||t[o][1]<=e[1]&&e[1]<t[n][1])&&e[0]<(t[o][0]-t[n][0])*(e[1]-t[n][1])/(t[o][1]-t[n][1])+t[n][0]&&(i=!i);return i},ze=function(t,e){for(var i=0;i<t.length;i++)if(t[i]!==e[i])return!1;return!0},Vt=function(t,e){for(var i=0;i<t.length-1;i++)for(var n=0;n<e.length-1;n++)if(Be(t[i],t[i+1],e[n],e[n+1]))return!0;return!1},vt=function(t){return ze(t[0],t[t.length-1])||t.push(t[0]),t},St=function(t){var e=0,i=0,n=t.length,s=t[i],o;for(i;i<n-1;i++)o=t[i+1],e+=(o[0]-s[0])*(o[1]+s[1]),s=o;return e>=0},Kt=function(t){var e={};for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e},We=function(t,e){var i=Vt(t,e),n=Je(t,e[0]);return!!(!i&&n)},He=function(t){for(var e=[],i=[],n,s,o,l=0;l<t.length;l++){var u=vt(t[l].slice(0));if(!(u.length<4))if(St(u)){var c=[u.slice().reverse()];e.push(c)}else i.push(u.slice().reverse())}for(var f=[];i.length;){o=i.pop();var y=!1;for(n=e.length-1;n>=0;n--)if(s=e[n][0],We(s,o)){e[n].push(o),y=!0;break}y||f.push(o)}for(;f.length;){o=f.pop();var S=!1;for(n=e.length-1;n>=0;n--)if(s=e[n][0],Vt(s,o)){e[n].push(o),S=!0;break}S||e.push([o.reverse()])}return e.length===1?{type:"Polygon",coordinates:e[0]}:{type:"MultiPolygon",coordinates:e}},Ve=function(t,e){for(var i=e?[e,"OBJECTID","FID"]:["OBJECTID","FID"],n=0;n<i.length;n++){var s=i[n];if(s in t&&(typeof t[s]=="string"||typeof t[s]=="number"))return t[s]}throw Error("No valid id attribute found")},Ke=function r(t,e){var i={};if(t.features){i.type="FeatureCollection",i.features=[];for(var n=0;n<t.features.length;n++)i.features.push(r(t.features[n],e))}if(typeof t.x=="number"&&typeof t.y=="number"&&(i.type="Point",i.coordinates=[t.x,t.y],typeof t.z=="number"&&i.coordinates.push(t.z)),t.points&&(i.type="MultiPoint",i.coordinates=t.points.slice(0)),t.paths&&(t.paths.length===1?(i.type="LineString",i.coordinates=t.paths[0].slice(0)):(i.type="MultiLineString",i.coordinates=t.paths.slice(0))),t.rings&&(i=He(t.rings.slice(0))),typeof t.xmin=="number"&&typeof t.ymin=="number"&&typeof t.xmax=="number"&&typeof t.ymax=="number"&&(i.type="Polygon",i.coordinates=[[[t.xmax,t.ymax],[t.xmin,t.ymax],[t.xmin,t.ymin],[t.xmax,t.ymin],[t.xmax,t.ymax]]]),(t.geometry||t.attributes)&&(i.type="Feature",i.geometry=t.geometry?r(t.geometry):null,i.properties=t.attributes?Kt(t.attributes):null,t.attributes))try{i.id=Ve(t.attributes,e)}catch{}return JSON.stringify(i.geometry)===JSON.stringify({})&&(i.geometry=null),t.spatialReference&&t.spatialReference.wkid&&t.spatialReference.wkid!==4326&&console.warn("Object converted in non-standard crs - "+JSON.stringify(t.spatialReference)),i},Zt=function(t){var e=[],i=t.slice(0),n=vt(i.shift().slice(0));if(n.length>=4){St(n)||n.reverse(),e.push(n);for(var s=0;s<i.length;s++){var o=vt(i[s].slice(0));o.length>=4&&(St(o)&&o.reverse(),e.push(o))}}return e},Ze=function(t){for(var e=[],i=0;i<t.length;i++)for(var n=Zt(t[i]),s=n.length-1;s>=0;s--){var o=n[s].slice(0);e.push(o)}return e},$e=function r(t,e){e=e||"OBJECTID";var i={wkid:4326},n={},s;switch(t.type){case"Point":n.x=t.coordinates[0],n.y=t.coordinates[1],t.coordinates[2]!=null&&(n.z=t.coordinates[2]),n.spatialReference=i;break;case"MultiPoint":n.points=t.coordinates.slice(0),t.coordinates[0][2]!=null&&(n.hasZ=!0),n.spatialReference=i;break;case"LineString":n.paths=[t.coordinates.slice(0)],t.coordinates[0][2]!=null&&(n.hasZ=!0),n.spatialReference=i;break;case"MultiLineString":n.paths=t.coordinates.slice(0),t.coordinates[0][0][2]!=null&&(n.hasZ=!0),n.spatialReference=i;break;case"Polygon":n.rings=Zt(t.coordinates.slice(0)),t.coordinates[0][0][2]!=null&&(n.hasZ=!0),n.spatialReference=i;break;case"MultiPolygon":n.rings=Ze(t.coordinates.slice(0)),t.coordinates[0][0][0][2]!=null&&(n.hasZ=!0),n.spatialReference=i;break;case"Feature":t.geometry&&(n.geometry=r(t.geometry,e)),n.attributes=t.properties?Kt(t.properties):{},t.id&&(n.attributes[e]=t.id);break;case"FeatureCollection":for(n=[],s=0;s<t.features.length;s++)n.push(r(t.features[s],e));break;case"GeometryCollection":for(n=[],s=0;s<t.geometries.length;s++)n.push(r(t.geometries[s],e));break}return n},$t='<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>',Qe='Powered by <a href="https://www.esri.com">Esri</a>';function Dt(r,t){return $e(r,t)}function Xe(r,t){return Ke(r,t)}function Ft(r){if(r.xmin!=="NaN"&&r.ymin!=="NaN"&&r.xmax!=="NaN"&&r.ymax!=="NaN"){var t=g.latLng(r.ymin,r.xmin),e=g.latLng(r.ymax,r.xmax);return g.latLngBounds(t,e)}else return null}function Qt(r){return r=g.latLngBounds(r),{xmin:r.getSouthWest().lng,ymin:r.getSouthWest().lat,xmax:r.getNorthEast().lng,ymax:r.getNorthEast().lat,spatialReference:{wkid:4326}}}var Xt=/^(OBJECTID|FID|OID|ID)$/i;function Ye(r){var t;if(r.objectIdFieldName)t=r.objectIdFieldName;else if(r.fields){for(var e=0;e<=r.fields.length-1;e++)if(r.fields[e].type==="esriFieldTypeOID"){t=r.fields[e].name;break}if(!t){for(e=0;e<=r.fields.length-1;e++)if(r.fields[e].name.match(Xt)){t=r.fields[e].name;break}}}return t}function je(r){for(var t in r.attributes)if(t.match(Xt))return t}function It(r,t){var e,i=r.features||r.results,n=i&&i.length;t?e=t:e=Ye(r);var s={type:"FeatureCollection",features:[]};if(n)for(var o=i.length-1;o>=0;o--){var l=Xe(i[o],e||je(i[o]));s.features.push(l)}return s}function Ot(r){return r=g.Util.trim(r),r[r.length-1]!=="/"&&(r+="/"),r}function Yt(r){if(r.url.indexOf("?")!==-1){r.requestParams=r.requestParams||{};var t=r.url.substring(r.url.indexOf("?")+1);r.url=r.url.split("?")[0],r.requestParams=JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return r.url=Ot(r.url.split("?")[0]),r}function tr(r){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(r)}function qt(r){var t;switch(r){case"Point":t="esriGeometryPoint";break;case"MultiPoint":t="esriGeometryMultipoint";break;case"LineString":t="esriGeometryPolyline";break;case"MultiLineString":t="esriGeometryPolyline";break;case"Polygon":t="esriGeometryPolygon";break;case"MultiPolygon":t="esriGeometryPolygon";break}return t}function Gt(r){return r.getSize().x-Ue.attributionWidthOffset+"px"}function jt(r){if(r.attributionControl){if(r.attributionControl._esriAttributionLayerCount||(r.attributionControl._esriAttributionLayerCount=0),r.attributionControl._esriAttributionLayerCount===0){if(!r.attributionControl._esriAttributionAddedOnce){var t=document.createElement("style");t.type="text/css",t.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(t);var e=document.createElement("style");e.type="text/css",e.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+Gt(r)+";}",document.getElementsByTagName("head")[0].appendChild(e),r.on("resize",function(i){r.attributionControl&&(r.attributionControl._container.style.maxWidth=Gt(i.target))}),r.attributionControl._esriAttributionAddedOnce=!0}r.attributionControl.setPrefix($t+" | "+Qe),g.DomUtil.addClass(r.attributionControl._container,"esri-truncated-attribution:hover"),g.DomUtil.addClass(r.attributionControl._container,"esri-truncated-attribution")}r.attributionControl._esriAttributionLayerCount=r.attributionControl._esriAttributionLayerCount+1}}function te(r){r.attributionControl&&(r.attributionControl._esriAttributionLayerCount&&r.attributionControl._esriAttributionLayerCount===1&&(r.attributionControl.setPrefix($t),g.DomUtil.removeClass(r.attributionControl._container,"esri-truncated-attribution:hover"),g.DomUtil.removeClass(r.attributionControl._container,"esri-truncated-attribution")),r.attributionControl._esriAttributionLayerCount=r.attributionControl._esriAttributionLayerCount-1)}function ee(r){var t={geometry:null,geometryType:null};if(r instanceof g.LatLngBounds)return t.geometry=Qt(r),t.geometryType="esriGeometryEnvelope",t;if(r.getLatLng&&(r=r.getLatLng()),r instanceof g.LatLng&&(r={type:"Point",coordinates:[r.lng,r.lat]}),r instanceof g.GeoJSON&&(r=r.getLayers()[0].feature.geometry,t.geometry=Dt(r),t.geometryType=qt(r.type)),r.toGeoJSON&&(r=r.toGeoJSON()),r.type==="Feature"&&(r=r.geometry),r.type==="Point"||r.type==="LineString"||r.type==="Polygon"||r.type==="MultiPolygon")return t.geometry=Dt(r),t.geometryType=qt(r.type),t;ft("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object")}var er=g.ImageOverlay.extend({onAdd:function(r){this._topLeft=r.getPixelBounds().min,g.ImageOverlay.prototype.onAdd.call(this,r)},_reset:function(){this._map.options.crs===g.CRS.EPSG3857?g.ImageOverlay.prototype._reset.call(this):g.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),rr=g.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:ut,attribution:null,interactive:!1,alt:""},onAdd:function(r){jt(r),this.options.zIndex&&(this.options.position=null),this._update=g.Util.throttle(this._update,this.options.updateInterval,this),r.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?r.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata(function(t,e){!t&&!this.options.attribution&&r.attributionControl&&e.copyrightText&&(this.options.attribution=e.copyrightText,r.attributionControl.addAttribution(this.getAttribution()))},this)},onRemove:function(r){te(r),this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup:function(r,t){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=g.popup(t),this._popupFunction=r,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup:function(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront:function(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex:function(r){return this.options.zIndex=r,this._currentImage&&this._currentImage.setZIndex(r),this},_setAutoZIndex:function(r){if(this._currentImage){for(var t=this._currentImage.getPane().children,e=-r(-1/0,1/0),i=0,n=t.length,s;i<n;i++)s=t[i].style.zIndex,t[i]!==this._currentImage._image&&s&&(e=r(e,+s));isFinite(e)&&(this.options.zIndex=e+r(-1,1),this.setZIndex(this.options.zIndex))}},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(r){return this.options.opacity=r,this._currentImage&&this._currentImage.setOpacity(r),this},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(r,t){return this.options.from=r,this.options.to=t,this._update(),this},metadata:function(r,t){return this.service.metadata(r,t),this},authenticate:function(r){return this.service.authenticate(r),this},redraw:function(){this._update()},_renderImage:function(r,t,e){if(this._map){if(e&&(r="data:"+e+";base64,"+r),!r)return;var i=new er(r,t,{opacity:0,crossOrigin:this.options.withCredentials?"use-credentials":this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map),n=function(){this._map.removeLayer(i),this.fire("error"),i.off("load",s,this)},s=function(o){if(i.off("error",n,this),this._map){var l=o.target,u=this._currentImage;l._bounds.equals(t)&&l._bounds.equals(this._map.getBounds())?(this._currentImage=l,this.options.position==="front"?this.bringToFront():this.options.position==="back"&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),u&&this._map&&this._map.removeLayer(u),u&&u._map&&u._map.removeLayer(u)):this._map.removeLayer(l)}this.fire("load",{bounds:t})};i.once("error",n,this),i.once("load",s,this)}},_update:function(){if(this._map){var r=this._map.getZoom(),t=this._map.getBounds();if(!this._animatingZoom&&!(this._map._panTransition&&this._map._panTransition._inProgress)){if(r>this.options.maxZoom||r<this.options.minZoom){this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);return}var e=this._buildExportParams();g.Util.extend(e,this.options.requestParams),e?(this._requestExport(e,t),this.fire("loading",{bounds:t})):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)}}},_renderPopup:function(r,t,e,i){if(r=g.latLng(r),this._shouldRenderPopup&&this._lastClick.equals(r)){var n=this._popupFunction(t,e,i);n&&this._popup.setLatLng(r).setContent(n).openOn(this._map)}},_resetPopupState:function(r){this._shouldRenderPopup=!1,this._lastClick=r.latlng},_calculateBbox:function(){var r=this._map.getPixelBounds(),t=this._map.unproject(r.getBottomLeft()),e=this._map.unproject(r.getTopRight()),i=this._map.options.crs.project(e),n=this._map.options.crs.project(t),s=g.bounds(i,n);return[s.getBottomLeft().x,s.getBottomLeft().y,s.getTopRight().x,s.getTopRight().y].join(",")},_calculateImageSize:function(){var r=this._map.getPixelBounds(),t=this._map.getSize(),e=this._map.unproject(r.getBottomLeft()),i=this._map.unproject(r.getTopRight()),n=this._map.latLngToLayerPoint(i).y,s=this._map.latLngToLayerPoint(e).y;return(n>0||s<t.y)&&(t.y=s-n),t.x+","+t.y}}),ir=g.Evented.extend({options:{proxy:!1,useCors:ut,timeout:0},initialize:function(r){r=r||{},this._requestQueue=[],this._authenticating=!1,g.Util.setOptions(this,r),this.options.url=Ot(this.options.url)},get:function(r,t,e,i){return this._request("get",r,t,e,i)},post:function(r,t,e,i){return this._request("post",r,t,e,i)},request:function(r,t,e,i){return this._request("request",r,t,e,i)},metadata:function(r,t){return this._request("get","",{},r,t)},authenticate:function(r){return this._authenticating=!1,this.options.token=r,this._runQueue(),this},getTimeout:function(){return this.options.timeout},setTimeout:function(r){this.options.timeout=r},_request:function(r,t,e,i,n){this.fire("requeststart",{url:this.options.url+t,params:e,method:r},!0);var s=this._createServiceCallback(r,t,e,i,n);if(this.options.token&&(e.token=this.options.token),this.options.requestParams&&g.Util.extend(e,this.options.requestParams),this._authenticating)this._requestQueue.push([r,t,e,i,n]);else{var o=this.options.proxy?this.options.proxy+"?"+this.options.url+t:this.options.url+t;return(r==="get"||r==="request")&&!this.options.useCors?lt.get.JSONP(o,e,s,n):lt[r](o,e,s,n)}},_createServiceCallback:function(r,t,e,i,n){return g.Util.bind(function(s,o){s&&(s.code===499||s.code===498)&&(this._authenticating=!0,this._requestQueue.push([r,t,e,i,n]),this.fire("authenticationrequired",{authenticate:g.Util.bind(this.authenticate,this)},!0),s.authenticate=g.Util.bind(this.authenticate,this)),i.call(n,s,o),s?this.fire("requesterror",{url:this.options.url+t,params:e,message:s.message,code:s.code,method:r},!0):this.fire("requestsuccess",{url:this.options.url+t,params:e,response:o,method:r},!0),this.fire("requestend",{url:this.options.url+t,params:e,method:r},!0)},this)},_runQueue:function(){for(var r=this._requestQueue.length-1;r>=0;r--){var t=this._requestQueue[r],e=t.shift();this[e].apply(this,t)}this._requestQueue=[]}}),Nt=g.Class.extend({options:{proxy:!1,useCors:ut},generateSetter:function(r,t){return g.Util.bind(function(e){return this.params[r]=e,this},t)},initialize:function(r){if(r.request&&r.options?(this._service=r,g.Util.setOptions(this,r.options)):(g.Util.setOptions(this,r),this.options.url=Ot(r.url)),this.params=g.Util.extend({},this.params||{}),this.setters)for(var t in this.setters){var e=this.setters[t];this[t]=this.generateSetter(e,this)}},token:function(r){return this._service?this._service.authenticate(r):this.params.token=r,this},apikey:function(r){return this.token(r)},format:function(r){return this.params.returnUnformattedValues=!r,this},request:function(r,t){return this.options.requestParams&&g.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,r,t):this._request("request",this.path,this.params,r,t)},_request:function(r,t,e,i,n){var s=this.options.proxy?this.options.proxy+"?"+this.options.url+t:this.options.url+t;return(r==="get"||r==="request")&&!this.options.useCors?lt.get.JSONP(s,e,i,n):lt[r](s,e,i,n)}}),nr=Nt.extend({path:"identify",between:function(r,t){return this.params.time=[r.valueOf(),t.valueOf()],this}}),sr=nr.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on:function(r){var t=Qt(r.getBounds()),e=r.getSize();return this.params.imageDisplay=[e.x,e.y,96],this.params.mapExtent=[t.xmin,t.ymin,t.xmax,t.ymax],this},at:function(r){return r.length===2&&(r=g.latLng(r)),this._setGeometryParams(r),this},layerDef:function(r,t){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[r,t].join(":"),this},simplify:function(r,t){var e=Math.abs(r.getBounds().getWest()-r.getBounds().getEast());return this.params.maxAllowableOffset=e/r.getSize().y*t,this},run:function(r,t){return this.request(function(e,i){if(e)r.call(t,e,void 0,i);else{var n=It(i);i.results=i.results.reverse();for(var s=0;s<n.features.length;s++){var o=n.features[s];o.layerId=i.results[s].layerId}r.call(t,void 0,n,i)}})},_setGeometryParams:function(r){var t=ee(r);this.params.geometry=t.geometry,this.params.geometryType=t.geometryType}});function or(r){return new sr(r)}var ar=Nt.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*"},within:function(r){return this._setGeometryParams(r),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(r){return this._setGeometryParams(r),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(r){return this._setGeometryParams(r),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(r){return this._setGeometryParams(r),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(r){return this._setGeometryParams(r),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(r){return this._setGeometryParams(r),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(r){return this._setGeometryParams(r),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(r){return this._setGeometryParams(r),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(r,t){return r=g.latLng(r),this.params.geometry=[r.lng,r.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=t,this.params.inSR=4326,this},where:function(r){return this.params.where=r,this},between:function(r,t){return this.params.time=[r.valueOf(),t.valueOf()],this},simplify:function(r,t){var e=Math.abs(r.getBounds().getWest()-r.getBounds().getEast());return this.params.maxAllowableOffset=e/r.getSize().y*t,this},orderBy:function(r,t){return t=t||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[r,t].join(" "),this},run:function(r,t){return this._cleanParams(),this.options.isModern||tr(this.options.url)&&this.options.isModern===void 0?(this.params.f="geojson",this.request(function(e,i){this._trapSQLerrors(e),r.call(t,e,i,i)},this)):this.request(function(e,i){this._trapSQLerrors(e),r.call(t,e,i&&It(i),i)},this)},count:function(r,t){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(e,i){r.call(this,e,i&&i.count,i)},t)},ids:function(r,t){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(e,i){r.call(this,e,i&&i.objectIds,i)},t)},bounds:function(r,t){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request(function(e,i){i&&i.extent&&Ft(i.extent)?r.call(t,e,Ft(i.extent),i):(e={message:"Invalid Bounds"},r.call(t,e,null,i))},t)},distinct:function(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize:function(r){var t=g.point(r);return this.params.pixelSize=[t.x,t.y],this},layer:function(r){return this.path=r+"/query",this},_trapSQLerrors:function(r){r&&r.code==="400"&&ft("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams:function(r){this.params.inSR=4326;var t=ee(r);this.params.geometry=t.geometry,this.params.geometryType=t.geometryType}});function lr(r){return new ar(r)}var ur=Nt.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(r,t){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[r,t].join(":"),this},simplify:function(r,t){var e=Math.abs(r.getBounds().getWest()-r.getBounds().getEast());return this.params.maxAllowableOffset=e/r.getSize().y*t,this},run:function(r,t){return this.request(function(e,i){r.call(t,e,i&&It(i),i)},t)}});function hr(r){return new ur(r)}var fr=ir.extend({identify:function(){return or(this)},find:function(){return hr(this)},query:function(){return lr(this)}});function re(r){return new fr(r)}var cr=rr.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png32",transparent:!0,f:"json"},initialize:function(r){r=Yt(r),this.service=re(r),this.service.addEventParent(this),g.Util.setOptions(this,r)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(r){return this.options.dynamicLayers=r,this._update(),this},getLayers:function(){return this.options.layers},setLayers:function(r){return this.options.layers=r,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(r){return this.options.layerDefs=r,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(r){return this.options.timeOptions=r,this._update(),this},query:function(){return this.service.query()},identify:function(){return this.service.identify()},find:function(){return this.service.find()},_getPopupData:function(r){var t=g.Util.bind(function(n,s,o){n||setTimeout(g.Util.bind(function(){this._renderPopup(r.latlng,n,s,o)},this),300)},this),e;if(this.options.popup?e=this.options.popup.on(this._map).at(r.latlng):e=this.identify().on(this._map).at(r.latlng),e.params.maxAllowableOffset||e.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?e.layers("visible:"+this.options.layers.join(",")):e.layers("visible")),this.options.layerDefs&&typeof this.options.layerDefs!="string"&&!e.params.layerDefs)for(var i in this.options.layerDefs)Object.prototype.hasOwnProperty.call(this.options.layerDefs,i)&&e.layerDef(i,this.options.layerDefs[i]);e.run(t),this._shouldRenderPopup=!0,this._lastClick=r.latlng},_buildExportParams:function(){var r=parseInt(this._map.options.crs.code.split(":")[1],10),t={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:r,imageSR:r};if(this.options.dynamicLayers&&(t.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(this.options.layers.length===0)return;t.layers="show:"+this.options.layers.join(",")}return this.options.layerDefs&&(t.layerDefs=typeof this.options.layerDefs=="string"?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(t.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(t.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.service.options.token&&(t.token=this.service.options.token),this.options.proxy&&(t.proxy=this.options.proxy),this.options.disableCache&&(t._ts=Date.now()),t},_requestExport:function(r,t){if(this.options.f==="json")this.service.request("export",r,function(i,n){i||(this.options.token&&n.href&&(n.href+="?token="+this.options.token),this.options.proxy&&n.href&&(n.href=this.options.proxy+"?"+n.href),n.href?this._renderImage(n.href,t):this._renderImage(n.imageData,t,n.contentType))},this);else{r.f="image";var e=this.options.url+"export"+g.Util.getParamString(r);this.options.proxy&&(e=this.options.proxy+"?"+e),this._renderImage(e,t)}}});function pr(r,t){return new cr(r,t)}var ie=g.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize:function(r){r=g.Util.setOptions(this,r),r=Yt(r),this.tileUrl=(r.proxy?r.proxy+"?":"")+r.url+"tile/{z}/{y}/{x}"+(r.requestParams&&Object.keys(r.requestParams).length>0?g.Util.getParamString(r.requestParams):""),r.url.indexOf("{s}")!==-1&&r.subdomains&&(r.url=r.url.replace("{s}",r.subdomains[0])),this.service=re(r),this.service.addEventParent(this);var t=new RegExp(/tiles.arcgis(online)?\.com/g);t.test(r.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),r.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+="?token="+this.options.token),g.TileLayer.prototype.initialize.call(this,this.tileUrl,r)},getTileUrl:function(r){var t=this._getZoomForUrl();return g.Util.template(this.tileUrl,g.Util.extend({s:this._getSubdomain(r),x:r.x,y:r.y,z:this._lodMap&&this._lodMap[t]?this._lodMap[t]:t},this.options))},createTile:function(r,t){var e=document.createElement("img");return g.DomEvent.on(e,"load",g.Util.bind(this._tileOnLoad,this,t,e)),g.DomEvent.on(e,"error",g.Util.bind(this._tileOnError,this,t,e)),this.options.crossOrigin&&(e.crossOrigin=""),e.alt="",!this._lodMap||this._lodMap&&this._lodMap[this._getZoomForUrl()]?e.src=this.getTileUrl(r):this.once("lodmap",function(){e.src=this.getTileUrl(r)},this),e},onAdd:function(r){jt(r),this._lodMap||this.metadata(function(t,e){if(!t&&e.spatialReference){var i=e.spatialReference.latestWkid||e.spatialReference.wkid;if(!this.options.attribution&&r.attributionControl&&e.copyrightText&&(this.options.attribution=e.copyrightText,r.attributionControl.addAttribution(this.getAttribution())),r.options.crs===g.CRS.EPSG3857&&(i===102100||i===3857)){this._lodMap={};for(var n=e.tileInfo.lods,s=ie.MercatorZoomLevels,o=0;o<n.length;o++){var l=n[o];for(var u in s){var c=s[u];if(this._withinPercentage(l.resolution,c,this.options.zoomOffsetAllowance)){this._lodMap[u]=l.level;break}}}this.fire("lodmap")}else r.options.crs&&r.options.crs.code&&r.options.crs.code.indexOf(i)>-1||ft("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet https://developers.arcgis.com/esri-leaflet/samples/non-mercator-projection/")}},this),g.TileLayer.prototype.onAdd.call(this,r)},onRemove:function(r){te(r),g.TileLayer.prototype.onRemove.call(this,r)},metadata:function(r,t){return this.service.metadata(r,t),this},identify:function(){return this.service.identify()},find:function(){return this.service.find()},query:function(){return this.service.query()},authenticate:function(r){var t="?token="+r;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,t):this.tileUrl+t,this.options.token=r,this.service.authenticate(r),this},_withinPercentage:function(r,t,e){var i=Math.abs(r/t-1);return i<e}});function dr(r,t){return new ie(r,t)}const yr=ae({name:"AddService",props:{map:{type:g.Map,default:void 0},layerControl:{type:g.Control.Layers,default:void 0}},data:()=>({count:0,name:"服务 1",url:"",type:"supermap_rest",layers:[]}),methods:{addService(){if(!this.map||!this.layerControl)return;const r=this.url,t=this.type,e=this.name;this.count++,this.name="服务 "+this.count;let i;try{switch(t){case"supermap_rest":case"supermap_tile":{i=De(r,{prjCoordSys:{epsgCode:3857},crs:g.CRS.EPSG3857}),i.addTo(this.map);break}case"arcgis_rest":{i=pr({url:r,f:"image"}),i.addTo(this.map);break}case"arcgis_tile":{i=dr({url:r}),i.addTo(this.map);break}case"tms":{i=g.tileLayer(r),i.addTo(this.map);break}default:break}}catch{le.error("添加服务失败")}i&&this.layerControl&&(this.layerControl.addOverlay(i,e),this.layers.push({name:e,url:r,layer:i,id:ve()}))},removeLayer(r){this.layers[r]?.layer&&this.layerControl&&(this.map.removeLayer(this.layers[r]?.layer),this.layerControl.removeLayer(this.layers[r]?.layer),this.layers.splice(r,1))}}}),mr={class:"layer-wrapper"},gr=["title"],vr=["title"];function Sr(r,t,e,i,n,s){const o=fe,l=ge,u=ce,c=de,f=ye,y=me,S=pe;return it(),nt(pt,null,[r.layers.length?(it(),nt(pt,{key:0},[dt("div",mr,[(it(!0),nt(pt,null,ue(r.layers,(m,P)=>(it(),nt("div",{key:m.id,class:"layer-item"},[dt("div",{class:"layer-item-title",title:m.name},bt(m.name),9,gr),dt("div",{class:"layer-item-url",title:m.url},bt(m.url),9,vr),M(o,{onClick:E=>r.removeLayer(P)},{default:D(()=>[V(" 移除 ")]),_:2},1032,["onClick"])]))),128))]),M(l)],64)):he("",!0),M(S,{colon:!1,class:"addService"},{default:D(()=>[M(c,{label:"服务名称"},{default:D(()=>[M(u,{modelValue:r.name,"onUpdate:modelValue":t[0]||(t[0]=m=>r.name=m)},null,8,["modelValue"])]),_:1}),M(c,{label:"服务地址"},{default:D(()=>[M(u,{modelValue:r.url,"onUpdate:modelValue":t[1]||(t[1]=m=>r.url=m)},null,8,["modelValue"])]),_:1}),M(c,{label:"服务类型"},{default:D(()=>[M(y,{modelValue:r.type,"onUpdate:modelValue":t[2]||(t[2]=m=>r.type=m)},{default:D(()=>[M(f,{value:"supermap_rest"},{default:D(()=>[V(" 超图动态 ")]),_:1}),M(f,{value:"supermap_tile"},{default:D(()=>[V(" 超图切片 ")]),_:1}),M(f,{value:"arcgis_rest"},{default:D(()=>[V(" ArcGIS 动态 ")]),_:1}),M(f,{value:"arcgis_tile"},{default:D(()=>[V(" ArcGIS 切片 ")]),_:1}),M(f,{value:"tms"},{default:D(()=>[V(" TMS ")]),_:1})]),_:1},8,["modelValue"])]),_:1}),M(c,{class:"formBtnItem"},{default:D(()=>[M(o,{type:"primary",onClick:r.addService},{default:D(()=>[V(" 添加 ")]),_:1},8,["onClick"])]),_:1})]),_:1})],64)}const br=oe(yr,[["render",Sr],["__scopeId","data-v-771ab4c3"]]);export{br as default};
