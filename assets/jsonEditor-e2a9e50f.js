import{a5 as _e,bf as w,bu as me,a4 as D,$ as he,ap as W,j as ge,B as v,l as ve,x as ye,o as I,c as k,w as J,f as U,y as f,a as m,b as c,d as b,n as Q,ae as p,F as q,W as C,g as Ce,X as G,t as $e,ag as we,ak as De,af as Se,al as xe,am as Ie,an as ke,a3 as je}from"./vendor-c7d095d4.js";import{e as Ee,_ as Le,f as be,g as Me,h as Ye}from"./ant-design-vue-8684357f.js";import{u as K,S as Pe,_ as Z}from"./common-bad41c28.js";function O(e,l){e=e||32,l=l||"ABCDEFGHJKMNPQRSTWXYZabcdefghijkmnprstwxyz2345678";const a=l.length;let r="";for(let _=0;_<e;_++)r+=l.charAt(Math.floor(Math.random()*a));return r}const Ve=new Pe;let M={},ee=!1;const te=_e("jsonEditor",{persist:!0,state:()=>({leftId:null,rightId:null,splitterValue:.5,fullStatus:"",$_data:{}}),getters:{dataList:e=>l=>{const a=[];for(const r in e.$_data)a.push({_id:r,name:e.$_data[r].name,updated:w(e.$_data[r].updated).format("YYYY-MM-DD HH:mm")});return l?a.filter(r=>r.name.includes(l)):a},data:e=>l=>e.$_data[l]?{...e.$_data[l],updated:w(e.$_data[l].updated).format("YYYY-MM-DD HH:mm")}:null,leftData:e=>e.leftId&&e.$_data[e.leftId]?{...e.$_data[e.leftId],updated:w(e.$_data[e.leftId].updated).format("YYYY-MM-DD HH:mm")}:null,rightData:e=>e.rightId&&e.$_data[e.rightId]?{...e.$_data[e.rightId],updated:w(e.$_data[e.rightId].updated).format("YYYY-MM-DD HH:mm")}:null,syncCloud:()=>K().isLogged&&K().modules.jsonEditor.syncCloud},actions:{setSplitter(e=.5){this.splitterValue=me(e,0,1)},setFullStatus(e){e==="left"||e==="right"?this.fullStatus=e:this.fullStatus=""},replaceState(e=[]){const l={};for(const a of e)l[a.key]={name:a.name,content:{}},a.text!=null?l[a.key].content.text=a.text:a.json!=null&&(l[a.key].content.json=a.json),l[a.key].updated=w(a.updatedAt).format();this.$_data=l},async getSyncData(){try{const e=(await D.get(`${D.$apiBase}/tools/jsoneditor`)).data;e.success?this.replaceState(e.data):console.log(e.message)}catch(e){console.log(e.message)}},syncData:he(({id:e,data:l}={})=>{if(navigator.onLine)Ve.enqueue(D.post(`${D.$apiBase}/tools/jsoneditor/${e}`,l));else if(M[e]=l,!ee){let a=function(){window.removeEventListener("online",a);for(const r in M)te().syncData({id:r,data:M[r]});M={}};ee=!0,window.addEventListener("online",a)}},500),saveData({left:e,right:l,id:a,content:r,name:_}={}){if(this.syncCloud&&(a=a||O(6),r!=null||_!=null)){const u={name:_||(this.$_data[a]||{}).name||`文档-${a}`};typeof r=="string"?u.text=r:typeof r=="object"&&(u.json=W(r)),this.syncData({id:a,data:u})}typeof r<"u"?(a=a||O(6),this.$_data[a]=this.$_data[a]||{},this.$_data[a].name=_||this.$_data[a].name||`文档-${a}`,typeof r=="string"?this.$_data[a].content={text:r}:this.$_data[a].content={json:W(r)},this.$_data[a].updated=w().format(),e&&(this.leftId=a),l&&(this.rightId=a)):a&&this.$_data[a]?(e&&(this.leftId=a),l&&(this.rightId=a),this.$_data[a].name=_||this.$_data[a].name):(e&&(this.leftId=null),l&&(this.rightId=null))},async deleteData({id:e}={}){if(this.syncCloud)try{const l=(await D.delete(`${D.$apiBase}/tools/jsoneditor/${e}`)).data;l.success?(this.leftId===e&&(this.leftId=null),this.rightId===e&&(this.rightId=null),this.$_data[e]&&delete this.$_data[e]):console.log(l.message)}catch(l){console.log(l)}else this.leftId===e&&(this.leftId=null),this.rightId===e&&(this.rightId=null),this.$_data[e]&&delete this.$_data[e]}}}),S=e=>(Ie("data-v-4913cf8e"),e=e(),ke(),e),Be={class:"loadingPanel"},Fe=S(()=>m("div",{class:"emptySpace"},null,-1)),He=S(()=>m("span",{class:"i-icon-park-outline-right"},null,-1)),Ne=S(()=>m("span",{class:"i-icon-park-outline-left"},null,-1)),ze={class:"dragIcon"},Xe={key:0,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"chevron-right",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},Re=S(()=>m("path",{fill:"currentColor",d:"M96 480c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L242.8 256L73.38 86.63c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l192 192c12.5 12.5 12.5 32.75 0 45.25l-192 192C112.4 476.9 104.2 480 96 480z"},null,-1)),Ae=[Re],Te={key:1,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"chevron-left",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},We=S(()=>m("path",{fill:"currentColor",d:"M224 480c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25l192-192c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l169.4 169.4c12.5 12.5 12.5 32.75 0 45.25C240.4 476.9 232.2 480 224 480z"},null,-1)),Je=[We],Ue={key:2,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"ellipsis-vertical",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 128 512"},Qe=S(()=>m("path",{fill:"currentColor",d:"M64 360C94.93 360 120 385.1 120 416C120 446.9 94.93 472 64 472C33.07 472 8 446.9 8 416C8 385.1 33.07 360 64 360zM64 200C94.93 200 120 225.1 120 256C120 286.9 94.93 312 64 312C33.07 312 8 286.9 8 256C8 225.1 33.07 200 64 200zM64 152C33.07 152 8 126.9 8 96C8 65.07 33.07 40 64 40C94.93 40 120 65.07 120 96C120 126.9 94.93 152 64 152z"},null,-1)),qe=[Qe],Ge={class:"dialog-footer"},Ke=ge({__name:"jsonEditor",setup(e){const l=v(null),a=v(null),r=v(),_=v(!0),u=v(""),n=te(),ae={array:[1,2,3],boolean:!0,color:"gold",null:null,number:123,object:{a:"b",c:"d"},string:"Hello World"};ve(()=>{ne()});async function ne(){var o,t,s,d,h;n.syncCloud&&await n.getSyncData(),_.value=!1,n.leftData&&n.leftData.content?n.leftData.content.json?(o=l.value)==null||o.set(n.leftData.content.json):n.leftData.content.text&&((t=l.value)==null||t.set(n.leftData.content.text)):(s=l.value)==null||s.set(ae),n.rightData&&n.rightData.content&&(n.rightData.content.json?(d=a.value)==null||d.set(n.rightData.content.json):n.rightData.content.text&&((h=a.value)==null||h.set(n.rightData.content.text))),u.value=n.fullStatus}function B(o){var t,s;n.saveData({[o]:!0}),o==="left"?(t=l.value)==null||t.set({}):o==="right"&&((s=a.value)==null||s.set({}))}function F(o,t){let s=null;o==="left"?s=n.leftId:o==="right"&&(s=n.rightId),s&&n.saveData({id:s,name:t})}function H(o,t){let s=null;o==="left"?s=n.leftId:o==="right"&&(s=n.rightId);const d={[o]:!0,content:t};s&&(d.id=s),n.saveData(d)}const $=v(!1),y=v(""),x=v("");let Y="";const le=ye(()=>n.dataList(x.value));function N(o){y.value="",x.value="",Y=o,$.value=!0}function oe(){var o,t,s,d;if(y.value){const h=n.data(y.value);if(h&&h.content){const g=h.content;Y==="left"?(n.saveData({left:!0,id:y.value}),g.json?(o=l.value)==null||o.set(g.json):g.text&&((t=l.value)==null||t.set(g.text))):Y==="right"&&(n.saveData({right:!0,id:y.value}),g.json?(s=a.value)==null||s.set(g.json):g.text&&((d=a.value)==null||d.set(g.text)))}}$.value=!1}function z(o,{name:t,content:s}){var d,h;n.saveData({[o]:!0,name:t,content:s}),o==="left"?(d=l.value)==null||d.set(s):o==="right"&&((h=a.value)==null||h.set(s))}function X(o){const t=o==="left"?n.leftId:n.rightId;t&&n.deleteData({id:t})}function se(){var t,s;const o=(t=l.value)==null?void 0:t.get();o!=null&&((s=a.value)==null||s.set(o))}function ie(){var t,s;const o=(t=a.value)==null?void 0:t.get();o!=null&&((s=l.value)==null||s.set(o))}let P=0,j=0,V=!1;function R(o){var s;if(o instanceof MouseEvent&&o.button!==0)return;const t=(s=l.value)==null?void 0:s.container;t&&(V=!1,j=parseFloat(window.getComputedStyle(t).width),isNaN(j)&&(j=0),o instanceof TouchEvent?(P=o.touches[0].clientX,document.addEventListener("touchend",L),document.addEventListener("touchmove",E)):(P=o.clientX,document.addEventListener("mouseup",L),document.addEventListener("mousemove",E)))}function E(o){V=!0;let t=0;o instanceof TouchEvent?t=o.touches[0].clientX:t=o.clientX;const s=j-P+t,d=parseFloat(window.getComputedStyle(r.value).width);s<435?(u.value="right",u.value!==n.fullStatus&&n.setFullStatus("right")):d-100-s<435?(u.value="left",u.value!==n.fullStatus&&n.setFullStatus("left")):(u.value="",n.setSplitter(s/(d-100)),u.value!==n.fullStatus&&n.setFullStatus())}function L(){document.removeEventListener("mousemove",E),document.removeEventListener("touchmove",E),document.removeEventListener("mouseup",L),document.removeEventListener("touchend",L)}function re(){V||(u.value==="left"?(n.setSplitter(1-435/(parseFloat(window.getComputedStyle(r.value).width)-100)),u.value=""):u.value==="right"&&(n.setSplitter(435/(parseFloat(window.getComputedStyle(r.value).width)-100)),u.value=""))}return(o,t)=>{var A,T;const s=Ee,d=we,h=De,g=Le,ue=Se,de=be,fe=Me,ce=Ye,pe=xe;return I(),k(q,null,[J(m("div",Be,[c(s,{tip:"同步中..."})],512),[[U,f(_)]]),J(m("div",{ref_key:"editorPanel",ref:r,class:"editorPanel"},[c(Z,{ref_key:"editorPanelContainerLeft",ref:l,"show-menu-bar":"",class:b(["editorPanelContainer editorPanelContainerLeft",{full:f(u)==="left",hide:f(u)==="right"}]),style:Q({flex:f(n).splitterValue+" 1 0"}),name:(A=f(n).leftData)==null?void 0:A.name,config:{mode:"text"},onChange:t[0]||(t[0]=i=>H("left",i)),onOpenRecent:t[1]||(t[1]=i=>N("left")),onOpen:t[2]||(t[2]=i=>z("left",i)),onCreate:t[3]||(t[3]=i=>B("left")),onChangeName:t[4]||(t[4]=i=>F("left",i)),onDelete:t[5]||(t[5]=i=>X("left"))},null,8,["class","style","name"]),m("div",{class:b(["controller noShowMobile",{full:f(u)}])},[c(h,{direction:"vertical"},{default:p(()=>[f(u)?Ce("",!0):(I(),k(q,{key:0},[Fe,c(d,{type:"primary",block:"",onClick:se},{default:p(()=>[C(" 复制 "),He]),_:1}),c(d,{type:"primary",block:"",onClick:ie},{default:p(()=>[Ne,C(" 复制 ")]),_:1})],64)),m("div",{class:"drag",onMousedown:R,onTouchstart:R,onClick:re},[m("div",ze,[f(u)==="right"?(I(),k("svg",Xe,Ae)):f(u)==="left"?(I(),k("svg",Te,Je)):(I(),k("svg",Ue,qe))])],32)]),_:1})],2),c(Z,{ref_key:"editorPanelContainerRight",ref:a,"show-menu-bar":"",class:b(["editorPanelContainer editorPanelContainerRight noShowMobile",{full:f(u)==="right",hide:f(u)==="left"}]),style:Q({flex:1-f(n).splitterValue+" 1 0"}),name:(T=f(n).rightData)==null?void 0:T.name,config:{mode:"tree"},onChange:t[6]||(t[6]=i=>H("right",i)),onOpenRecent:t[7]||(t[7]=i=>N("right")),onOpen:t[8]||(t[8]=i=>z("right",i)),onCreate:t[9]||(t[9]=i=>B("right")),onChangeName:t[10]||(t[10]=i=>F("right",i)),onDelete:t[11]||(t[11]=i=>X("right"))},null,8,["class","style","name"])],512),[[U,!f(_)]]),c(pe,{modelValue:f($),"onUpdate:modelValue":t[14]||(t[14]=i=>G($)?$.value=i:null),title:"打开最近"},{footer:p(()=>[m("span",Ge,[c(d,{onClick:t[13]||(t[13]=i=>$.value=!1)},{default:p(()=>[C("取消")]),_:1}),c(d,{type:"primary",onClick:oe},{default:p(()=>[C(" 确定 ")]),_:1})])]),default:p(()=>[c(g,null,{default:p(()=>[C("搜索")]),_:1}),c(ue,{modelValue:f(x),"onUpdate:modelValue":t[12]||(t[12]=i=>G(x)?x.value=i:null),placeholder:"请输入文档名称"},null,8,["modelValue"]),c(ce,{class:"dataList","item-layout":"horizontal","data-source":f(le)},{renderItem:p(({item:i})=>[c(fe,{class:b({selected:i._id===f(y)}),onClick:Ze=>y.value=i._id},{actions:p(()=>[c(d,{type:"danger"},{default:p(()=>[C(" 删除 ")]),_:1})]),default:p(()=>[c(de,{description:"最后修改: "+i.updated},{title:p(()=>[C($e(i.name),1)]),_:2},1032,["description"])]),_:2},1032,["class","onClick"])]),_:1},8,["data-source"])]),_:1},8,["modelValue"])],64)}}});const at=je(Ke,[["__scopeId","data-v-4913cf8e"]]);export{at as default};
