import{F as j,aV as D,aq as G,m as q,u as o,G as te,a2 as oe,a3 as N,at as le,aU as ae,bI as se,au as ne,t as F,aE as M,J as _,K as C,X as e,a1 as t,ar as s,ap as u,ai as x,a0 as P,T as $,a$ as U,as as re,az as de,aA as ie,aB as ue,aC as pe}from"./index-IFmvZR23.js";import{E as fe}from"./el-checkbox-vy6_aONp.js";import{E as me,a as ce}from"./el-radio-group-TVGYL-bS.js";/* empty css                 */import{E as _e}from"./el-divider-ONhr9-5p.js";import{E as we}from"./el-space-zbKE7TOm.js";import{E as ge}from"./el-popover-lqSNBTBF.js";import{n as he,b as ve}from"./Router-fh6J4qL9.js";import{a as Ve,E as ke}from"./el-form-item-ZmXsUc-A.js";import"./hasIn-G5_2sI6H.js";import"./castArray-UoUr7tx-.js";const ye=j({inheritAttrs:!1,__name:"HaveAccess",props:{auth:{type:[Boolean,Object],default:!1},link:{default:""}},setup(p){const d=p,g=D(),E=he(),m=G(),h=q(()=>d.auth?typeof d.auth=="boolean"?g.logged:g.checkAccess(d.auth):d.link?g.checkAccess(E.getAuth(d.link)):!0);function i(){d.link&&m.push(d.link)}return(c,b)=>o(h)?te(c.$slots,"default",oe({key:0},c.$attrs,{goto:i})):N("",!0)}}),Ce=le("main",{persist:!0,state:()=>({_cache:{},clearOfflineCacheTag:!1}),getters:{getData:p=>d=>{if(d)return(p._cache||{})[d]}},actions:{setData({key:p,val:d}={}){p&&(this._cache=this._cache||{},this._cache[p]=d)},clear(){this._cache={}},clearOfflineCache(){console.log("clearOfflineCache"),this.clearOfflineCacheTag=!0}}}),T=p=>(ie("data-v-3dae9340"),p=p(),ue(),p),Ee={key:0,flex:"","flex-col":"","items-start":"","gap-4":"","text-7":""},be={flex:""},Se=T(()=>u("div",{"w-32":""}," 昵称: ",-1)),xe={flex:""},Pe=T(()=>u("div",{"w-32":""}," 邮箱: ",-1)),Ue={flex:""},Ne=T(()=>u("div",{"w-32":""}," 角色 ",-1)),Te={flex:"","gap-4":""},Ie={flex:"","flex-wrap":"","items-start":"","gap-4":"","text-7":"",class:"settings-container"},Oe={class:"settings-wrapper"},Ae={key:0,class:"settings-wrapper"},Re=j({__name:"settings",setup(p){const d=G(),g=ae(),E=se(),m=D(),h=ne(),i=q(()=>h.general),c=F(!1),b=F(),a=M({nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),H=M({rePasswd:[{validator:(v,l,r)=>{l&&l!==a.passwd?r(new Error("两次输入的密码不一致")):r()}}],oldPasswd:[{validator:(v,l,r)=>{!l&&(a.passwd||a.rePasswd)?r(new Error("请输入旧密码")):r()}}]}),I=()=>Ce().clearOfflineCache();function J(){d.push({path:"/login",query:{redirect:g.fullPath}})}function z(){d.push("/register")}function K(){d.push("/logout")}function X(){a.nickName=m.profile.nickName??"",a.email=m.profile.email??"",a.passwd="",a.rePasswd="",a.oldPasswd="",c.value=!0}function L(){c.value=!1}async function Q(v){v&&await v.validate(async l=>{if(l){const r={};if(a.nickName&&(r.nickName=a.nickName),a.email&&(r.email=a.email),a.passwd&&(r.passwd=a.passwd,r.oldPasswd=a.oldPasswd),Object.keys(r).length===0){U.warning("没有需要修改的信息");return}try{await m.updateUser(r)}catch(f){U.error(f.message)}c.value=!1}else return U.warning("请检查输入"),!1})}return(v,l)=>{var A,R,B;const r=ve,f=re,W=ye,V=de,k=Ve,Y=ke,O=ge,y=we,Z=_e,S=me,ee=ce,w=fe;return _(),C($,null,[e(r,{level:3},{default:t(()=>[s(" 账户信息 ")]),_:1}),o(m).logged?(_(),C("div",Ee,[u("div",be,[Se,u("div",null,x(o(m).profile.nickName),1)]),u("div",xe,[Pe,u("div",null,x(o(m).profile.email),1)]),u("div",Ue,[Ne,u("div",null,x(((B=(R=(A=o(m).profile)==null?void 0:A.roles)==null?void 0:R[0])==null?void 0:B.alias)??"普通用户"),1)]),u("div",Te,[e(f,{type:"primary",onClick:K},{default:t(()=>[s(" 登出 ")]),_:1}),e(W,{link:"/userManager"},{default:t(({goto:n})=>[e(f,{type:"primary",onClick:n},{default:t(()=>[s(" 用户权限中心 ")]),_:2},1032,["onClick"])]),_:1}),o(c)?(_(),C($,{key:1},[e(f,{type:"primary",onClick:l[0]||(l[0]=n=>Q(o(b)))},{default:t(()=>[s(" 保存 ")]),_:1}),e(f,{onClick:L},{default:t(()=>[s(" 取消 ")]),_:1})],64)):(_(),P(f,{key:0,onClick:X},{default:t(()=>[s(" 修改信息 ")]),_:1}))]),o(c)?(_(),P(Y,{key:0,ref_key:"ruleFormRef",ref:b,model:o(a),rules:o(H),"label-width":"8rem","label-position":"left"},{default:t(()=>[e(k,{label:"昵称",prop:"nickName"},{default:t(()=>[e(V,{modelValue:o(a).nickName,"onUpdate:modelValue":l[1]||(l[1]=n=>o(a).nickName=n)},null,8,["modelValue"])]),_:1}),e(k,{label:"邮箱",prop:"email"},{default:t(()=>[e(V,{modelValue:o(a).email,"onUpdate:modelValue":l[2]||(l[2]=n=>o(a).email=n)},null,8,["modelValue"])]),_:1}),e(k,{label:"旧密码",prop:"oldPasswd"},{default:t(()=>[e(V,{modelValue:o(a).oldPasswd,"onUpdate:modelValue":l[3]||(l[3]=n=>o(a).oldPasswd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(k,{label:"新密码",prop:"passwd"},{default:t(()=>[e(V,{modelValue:o(a).passwd,"onUpdate:modelValue":l[4]||(l[4]=n=>o(a).passwd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(k,{label:"确认密码",prop:"rePasswd"},{default:t(()=>[e(V,{modelValue:o(a).rePasswd,"onUpdate:modelValue":l[5]||(l[5]=n=>o(a).rePasswd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])):N("",!0),e(O,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:I},{reference:t(()=>[e(f,{type:"danger",plain:""},{default:t(()=>[s(" 清空本地缓存 ")]),_:1})]),_:1})])):(_(),P(y,{key:1},{default:t(()=>[e(f,{type:"primary",onClick:J},{default:t(()=>[s(" 登录 ")]),_:1}),e(f,{onClick:z},{default:t(()=>[s(" 注册 ")]),_:1}),e(O,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:I},{reference:t(()=>[e(f,{type:"danger",plain:""},{default:t(()=>[s(" 清空本地缓存 ")]),_:1})]),_:1})]),_:1})),e(Z),u("div",Ie,[u("div",Oe,[e(r,{level:4},{default:t(()=>[s(" 全局设置 ")]),_:1}),e(r,{level:5},{default:t(()=>[s(" 外观 ")]),_:1}),e(y,null,{default:t(()=>[e(ee,{"model-value":o(i).theme.mode,onChange:o(E).setTheme},{default:t(()=>[e(S,{label:"auto"},{default:t(()=>[s(" 跟随系统 ")]),_:1}),e(S,{label:"light"},{default:t(()=>[s(" 浅色 ")]),_:1}),e(S,{label:"dark"},{default:t(()=>[s(" 深色 ")]),_:1})]),_:1},8,["model-value","onChange"])]),_:1}),e(r,{level:5},{default:t(()=>[s(" 访问统计 ")]),_:1}),e(y,null,{default:t(()=>[e(w,{modelValue:o(i).showMost,"onUpdate:modelValue":l[6]||(l[6]=n=>o(i).showMost=n)},{default:t(()=>[s(" 最常访问 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(i).showRecent,"onUpdate:modelValue":l[7]||(l[7]=n=>o(i).showRecent=n)},{default:t(()=>[s(" 最近访问 ")]),_:1},8,["modelValue"])]),_:1}),e(r,{level:5},{default:t(()=>[s(" 其他设置 ")]),_:1}),e(y,null,{default:t(()=>[e(w,{modelValue:o(i).showSearch,"onUpdate:modelValue":l[8]||(l[8]=n=>o(i).showSearch=n)},{default:t(()=>[s(" 显示搜索 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(i).showType,"onUpdate:modelValue":l[9]||(l[9]=n=>o(i).showType=n)},{default:t(()=>[s(" 显示分类 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(i).openInNewTab,"onUpdate:modelValue":l[10]||(l[10]=n=>o(i).openInNewTab=n)},{default:t(()=>[s(" 新标签页打开工具 ")]),_:1},8,["modelValue"])]),_:1})]),o(m).logged?(_(),C("div",Ae,[e(r,{level:4},{default:t(()=>[s(" 应用设置 ")]),_:1}),e(r,{level:5},{default:t(()=>[s(" JSON 编辑器 ")]),_:1}),e(y,null,{default:t(()=>[e(w,{modelValue:o(h).modules.jsonEditor.syncCloud,"onUpdate:modelValue":l[11]||(l[11]=n=>o(h).modules.jsonEditor.syncCloud=n)},{default:t(()=>[s(" 从云端获取 ")]),_:1},8,["modelValue"])]),_:1})])):N("",!0)])],64)}}}),Ke=pe(Re,[["__scopeId","data-v-3dae9340"]]);export{Ke as default};
