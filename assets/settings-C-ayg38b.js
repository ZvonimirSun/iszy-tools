import{k as P,Q as Z,aw as T,E as k,r as m,q as O,G as $,x as n,w as l,N as d,K as o,F as r,a0 as D,J as ee,n as re,s as ie,aB as de,R as I,a4 as X,H as E,Y as z,Z as K,L as te,X as Q,W as ue,aA as y,v as W,$ as pe,ax as Y,P as fe,at as _e,bl as me}from"./index-ONTFdKuI.js";import{E as oe}from"./el-divider-BhWrNDq4.js";import{E as H}from"./el-space-DZ4Ni3GI.js";import{E as le}from"./el-checkbox-CmjBpVom.js";import{T as B,u as ce}from"./Router-DbxdFt4C.js";import{E as ge}from"./el-popover-BVP-VVZb.js";import"./el-popper-LdF2PtPW.js";import{E as ve}from"./el-dialog-CBx6H0fh.js";import{a as we,E as ye}from"./el-form-item-nkQkpu6f.js";import{L as ke}from"./linuxdo-C7o2R0pC.js";import{E as xe,a as Ve}from"./el-radio-group-fLgbPFhi.js";/* empty css                 */import"./index-C74Q6LDw.js";import"./index-CTYqJpm5.js";import"./castArray-DIUUteRj.js";import"./clone-Dq_BPzwZ.js";const be=P({__name:"jsonEditor",setup(x){const s=Z(),c=T(),i=s.modules.jsonEditor;return(C,t)=>{const V=B,_=le,b=H;return m(),k("div",null,[n(c).logged?(m(),O(V,{key:0,level:5},{default:l(()=>t[1]||(t[1]=[d(" JSON 编辑器 ")])),_:1,__:[1]})):$("",!0),n(c).logged?(m(),O(b,{key:1},{default:l(()=>[o(_,{modelValue:n(i).syncCloud,"onUpdate:modelValue":t[0]||(t[0]=f=>n(i).syncCloud=f)},{default:l(()=>t[2]||(t[2]=[d(" 从云端获取 ")])),_:1,__:[2]},8,["modelValue"])]),_:1})):$("",!0)])}}}),Ce={"w-full":"","overflow-auto":""},Ne={"gap-4":"",class:"settings-wrapper"},Ee=P({__name:"toolSettings",setup(x){return(s,c)=>{const i=B;return m(),k("div",Ce,[o(i,{level:4},{default:l(()=>c[0]||(c[0]=[d(" 应用设置 ")])),_:1,__:[0]}),r("div",Ne,[o(be)])])}}}),Se=D(Ee,[["__scopeId","data-v-730637d2"]]),$e=P({inheritAttrs:!1,__name:"HaveAccess",props:{auth:{type:[Boolean,Object],default:!1},link:{default:""}},setup(x){const s=x,c=T(),i=ce(),C=ee(),t=re(()=>s.auth?typeof s.auth=="boolean"?c.logged:c.checkAccess(s.auth):s.link?c.checkAccess(i.getAuth(s.link)):!0);function V(){s.link&&C.push(s.link)}return(_,b)=>n(t)?ie(_.$slots,"default",de({key:0},_.$attrs,{goto:V})):$("",!0)}}),Pe={flex:"","flex-col":"","items-start":"","gap-4":"","text-7":""},Ue={flex:"","items-center":"","gap-4":""},he={flex:"","items-center":"","gap-4":""},Ie={flex:"","items-center":"","gap-4":""},Te={flex:"","items-center":"","gap-4":""},De={flex:"","items-center":"","gap-4":""},Be={flex:"","items-center":"","gap-4":""},Re=["title","onClick"],Le=["src"],Oe=["onClick"],Ae={flex:"","items-center":""},Fe={class:"dialog-footer"},Me={flex:"~ col","m-0":"","gap-4":"","p-0":""},Ge={"w-full":"","flex-inline":"","items-center":"","gap-2":""},je=["title"],ze={key:0},He={"w-full":"","p-l-6":""},qe={underline:""},Je={underline:""},Xe={underline:""},Ke={flex:"","items-center":""},Qe={class:"dialog-footer"},We=P({__name:"personalInfo",setup(x){const s=T(),c=[{type:"github",title:"Github",icon:"i-icon-park-outline:github"},{type:"linuxdo",title:"LINUX DO",img:ke}],i=I(!1),C=I(),t=X({userName:"",nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),V=X({userName:[{trigger:"change",validator:(u,e,p)=>{e&&!e.trim()?p(new Error("用户名无效")):p()}}],nickName:[{trigger:"change",validator:(u,e,p)=>{e&&!e.trim()?p(new Error("昵称无效")):p()}}],rePasswd:[{trigger:"change",validator:(u,e,p)=>{e&&e!==t.passwd?p(new Error("两次输入的密码不一致")):p()}}]}),_=I(""),b=I(!1),f=I([]);async function v(){try{f.value=await s.getDevices(),b.value=!0}catch(u){b.value=!1,y.error(u.message)}}function w(){b.value=!1}async function U(u){if(u.current){await s.logout(),y.success("登出成功");return}await s.logoutDevice(u),y.success("登出成功"),u.all||(f.value=await s.getDevices())}function A(){t.userName=s.profile.userName??"",t.nickName=s.profile.nickName??"",t.email=s.profile.email??"",t.passwd="",t.rePasswd="",t.oldPasswd="",i.value=!0}function R(){i.value=!1}async function F(u){u&&await u.validate(async e=>{if(e){const p={};if(t.userName&&(p.userName=t.userName),t.nickName&&(p.nickName=t.nickName),t.email&&(p.email=t.email),t.passwd&&(p.passwd=t.passwd,t.oldPasswd&&(p.oldPasswd=t.oldPasswd)),Object.keys(p).length===0){y.warning("没有需要修改的信息");return}try{await s.updateUser(p)}catch(g){y.error(g.message)}i.value=!1}else y.warning("请检查输入")})}async function se(u,e){if(s.profile[u])return;const p=new URL(`${Y.apiBaseUrl}/auth/${u}/bind`);p.searchParams.append("access_token",s.access_token),ae(u,p.toString(),e)}async function ne(u){if(s.profile[u])try{await s.thirdPartyUnbind(u),y.success("解绑成功")}catch(e){y.error(e.message)}}async function M(u){var p,g;const e=u.source;if(u.origin===Y.apiBaseUrl)if(((p=u.data)==null?void 0:p.type)==="bind_success"){window.removeEventListener("message",M),e.close();try{await s.thirdPartyBind(_.value,u.data.data),y.success("绑定成功")}catch(N){y.error(N.message)}finally{_.value=""}}else((g=u.data)==null?void 0:g.type)==="bind_fail"&&(window.removeEventListener("message",M),e.close(),_.value="",y.error("绑定失败"))}function ae(u,e,p="绑定第三方登录",g=500,N=600){if(_.value){y.warning("绑定进行中，请勿重复点击");return}_.value=u,window.addEventListener("message",M);const S=(window.screen.height-g)/2,G=(window.screen.width-N)/2,h=window.open(e,p,`popup,width=${g},height=${N},top=${S},left=${G}`);if(!h){_.value="",y.error("请允许浏览器弹出窗口！");return}const L=window.setInterval(()=>{h.closed&&(window.clearInterval(L),_.value="")},500)}return(u,e)=>{var L,q,J;const p=B,g=te,N=ue,S=ye,G=we,h=ve;return m(),k("div",null,[o(p,{level:4},{default:l(()=>e[11]||(e[11]=[d(" 账户信息 ")])),_:1,__:[11]}),r("div",Pe,[r("div",Ue,[e[12]||(e[12]=r("div",{"w-32":"","text-right":""}," 用户名: ",-1)),r("div",null,E(n(s).profile.userName),1)]),r("div",he,[e[13]||(e[13]=r("div",{"w-32":"","text-right":""}," 昵称: ",-1)),r("div",null,E(n(s).profile.nickName),1)]),r("div",Ie,[e[14]||(e[14]=r("div",{"w-32":"","text-right":""}," 邮箱: ",-1)),r("div",null,E(n(s).profile.email),1)]),r("div",Te,[e[15]||(e[15]=r("div",{"w-32":"","text-right":""}," 角色: ",-1)),r("div",null,E(((J=(q=(L=n(s).profile)==null?void 0:L.roles)==null?void 0:q[0])==null?void 0:J.alias)??"注册用户"),1)]),r("div",De,[e[17]||(e[17]=r("div",{"w-32":"","text-right":""}," 绑定: ",-1)),r("div",Be,[(m(),k(z,null,K(c,a=>r("div",{key:a.type,class:W(["third-party",{active:n(s).profile[a.type]}]),title:a.title,onClick:j=>se(a.type,`${a.title} 绑定`)},[a.icon?(m(),k("i",{key:0,class:W(a.icon)},null,2)):a.img?(m(),k("img",{key:1,src:a.img,class:"third-party-img",alt:""},null,8,Le)):$("",!0),n(s).profile[a.type]?(m(),k("div",{key:2,class:"unbind-btn",title:"解绑",onClick:pe(j=>ne(a.type),["stop"])},e[16]||(e[16]=[r("i",{class:"i-icon-park-solid:close-one"},null,-1)]),8,Oe)):$("",!0)],10,Re)),64))])]),r("div",Ae,[o(g,{onClick:A},{default:l(()=>e[18]||(e[18]=[d(" 修改信息 ")])),_:1,__:[18]}),o(g,{onClick:v},{default:l(()=>e[19]||(e[19]=[d(" 登录设备管理 ")])),_:1,__:[19]})])]),o(h,{modelValue:n(i),"onUpdate:modelValue":e[7]||(e[7]=a=>Q(i)?i.value=a:null),title:"修改信息","before-close":R},{footer:l(()=>[r("span",Fe,[o(g,{onClick:R},{default:l(()=>e[20]||(e[20]=[d("取消")])),_:1,__:[20]}),o(g,{type:"primary",onClick:e[6]||(e[6]=a=>F(n(C)))},{default:l(()=>e[21]||(e[21]=[d(" 保存 ")])),_:1,__:[21]})])]),default:l(()=>[o(G,{ref_key:"ruleFormRef",ref:C,model:n(t),rules:n(V),"label-width":"8rem","label-position":"left"},{default:l(()=>[o(S,{label:"用户名",prop:"userName"},{default:l(()=>[o(N,{modelValue:n(t).userName,"onUpdate:modelValue":e[0]||(e[0]=a=>n(t).userName=a)},null,8,["modelValue"])]),_:1}),o(S,{label:"昵称",prop:"nickName"},{default:l(()=>[o(N,{modelValue:n(t).nickName,"onUpdate:modelValue":e[1]||(e[1]=a=>n(t).nickName=a)},null,8,["modelValue"])]),_:1}),o(S,{label:"邮箱",prop:"email"},{default:l(()=>[o(N,{modelValue:n(t).email,"onUpdate:modelValue":e[2]||(e[2]=a=>n(t).email=a)},null,8,["modelValue"])]),_:1}),o(S,{label:"旧密码",prop:"oldPasswd"},{default:l(()=>[o(N,{modelValue:n(t).oldPasswd,"onUpdate:modelValue":e[3]||(e[3]=a=>n(t).oldPasswd=a),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(S,{label:"新密码",prop:"passwd"},{default:l(()=>[o(N,{modelValue:n(t).passwd,"onUpdate:modelValue":e[4]||(e[4]=a=>n(t).passwd=a),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(S,{label:"确认密码",prop:"rePasswd"},{default:l(()=>[o(N,{modelValue:n(t).rePasswd,"onUpdate:modelValue":e[5]||(e[5]=a=>n(t).rePasswd=a),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),o(h,{modelValue:n(b),"onUpdate:modelValue":e[10]||(e[10]=a=>Q(b)?b.value=a:null),title:"管理登录设备","before-close":w,width:400},{footer:l(()=>[r("span",Qe,[o(g,{type:"primary",onClick:w},{default:l(()=>e[28]||(e[28]=[d(" 关闭 ")])),_:1,__:[28]})])]),default:l(()=>[r("ul",Me,[(m(!0),k(z,null,K(n(f),(a,j)=>(m(),k("li",{key:j,"w-full":"",flex:"~ col"},[r("div",Ge,[r("span",{"flex-1":"","overflow-hidden":"","font-bold":"",text:"ellipsis nowrap",title:a.name||a.id},E(a.name||a.id),9,je),a.current?(m(),k("span",ze,"(当前设备)")):$("",!0),o(g,{size:"small",onClick:it=>U({deviceId:a.id,current:a.current})},{default:l(()=>e[22]||(e[22]=[d(" 登出 ")])),_:2,__:[22]},1032,["onClick"])]),r("div",He,[r("table",null,[r("tbody",null,[r("tr",null,[e[23]||(e[23]=r("td",{"text-right":""}," IP: ",-1)),r("td",qe,E(a.ip),1)]),r("tr",null,[e[24]||(e[24]=r("td",{"text-right":""}," 首次登录时间: ",-1)),r("td",Je,E(a.createTime),1)]),r("tr",null,[e[25]||(e[25]=r("td",{"text-right":""}," 最后登录时间: ",-1)),r("td",Xe,E(a.lastLoginTime),1)])])])])]))),128)),r("li",Ke,[o(g,{size:"small",onClick:e[8]||(e[8]=a=>U({other:!0}))},{default:l(()=>e[26]||(e[26]=[d(" 登出其他 ")])),_:1,__:[26]}),o(g,{size:"small",onClick:e[9]||(e[9]=a=>U({all:!0}))},{default:l(()=>e[27]||(e[27]=[d(" 登出所有 ")])),_:1,__:[27]})])])]),_:1},8,["modelValue"])])}}}),Ye=D(We,[["__scopeId","data-v-193804cc"]]),Ze=fe("main",{persist:!0,state:()=>({_cache:{},clearOfflineCacheTag:!1}),getters:{getData:x=>s=>{if(s)return(x._cache||{})[s]}},actions:{setData({key:x,val:s}={}){x&&(this._cache=this._cache||{},this._cache[x]=s)},clear(){this._cache={}},clearOfflineCache(){console.log("clearOfflineCache"),this.clearOfflineCacheTag=!0}}}),et={flex:"","items-center":"","gap-4":""},tt=P({__name:"authInfo",setup(x){const s=ee(),c=_e(),i=T(),C=()=>Ze().clearOfflineCache();function t(){s.push({path:"/login",query:{redirect:c.fullPath}})}function V(){s.push("/register")}function _(){s.push("/logout")}return(b,f)=>{const v=te,w=$e,U=ge,A=oe,R=H;return n(i).logged?(m(),k(z,{key:0},[r("div",et,[o(v,{type:"primary",onClick:_},{default:l(()=>f[0]||(f[0]=[d(" 登出 ")])),_:1,__:[0]}),o(w,{link:"/userManager"},{default:l(({goto:F})=>[o(v,{onClick:F},{default:l(()=>f[1]||(f[1]=[d(" 用户权限中心 ")])),_:2,__:[1]},1032,["onClick"])]),_:1}),o(U,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:C},{reference:l(()=>[o(v,{type:"danger",plain:""},{default:l(()=>f[2]||(f[2]=[d(" 清空本地缓存 ")])),_:1,__:[2]})]),_:1})]),o(A),o(Ye)],64)):(m(),O(R,{key:1,"mt-4":""},{default:l(()=>[o(v,{type:"primary",onClick:t},{default:l(()=>f[3]||(f[3]=[d(" 登录 ")])),_:1,__:[3]}),o(v,{onClick:V},{default:l(()=>f[4]||(f[4]=[d(" 注册 ")])),_:1,__:[4]}),o(U,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:C},{reference:l(()=>[o(v,{type:"danger",plain:""},{default:l(()=>f[5]||(f[5]=[d(" 清空本地缓存 ")])),_:1,__:[5]})]),_:1})]),_:1}))}}}),ot=D(tt,[["__scopeId","data-v-304747f8"]]),lt={class:"settings-wrapper"},st=P({__name:"globalSettings",setup(x){const s=Z(),c=me(),i=s.general;return(C,t)=>{const V=B,_=Ve,b=xe,f=H,v=le;return m(),k("div",lt,[o(V,{level:4},{default:l(()=>t[5]||(t[5]=[d(" 全局设置 ")])),_:1,__:[5]}),o(V,{level:5},{default:l(()=>t[6]||(t[6]=[d(" 外观 ")])),_:1,__:[6]}),o(f,null,{default:l(()=>[o(b,{"model-value":n(i).theme.mode,onChange:n(c).setTheme},{default:l(()=>[o(_,{value:"auto",label:"跟随系统"}),o(_,{value:"light",label:"浅色"}),o(_,{value:"dark",label:"深色"})]),_:1},8,["model-value","onChange"])]),_:1}),o(V,{level:5},{default:l(()=>t[7]||(t[7]=[d(" 访问统计 ")])),_:1,__:[7]}),o(f,null,{default:l(()=>[o(v,{modelValue:n(i).showMost,"onUpdate:modelValue":t[0]||(t[0]=w=>n(i).showMost=w)},{default:l(()=>t[8]||(t[8]=[d(" 最常访问 ")])),_:1,__:[8]},8,["modelValue"]),o(v,{modelValue:n(i).showRecent,"onUpdate:modelValue":t[1]||(t[1]=w=>n(i).showRecent=w)},{default:l(()=>t[9]||(t[9]=[d(" 最近访问 ")])),_:1,__:[9]},8,["modelValue"])]),_:1}),o(V,{level:5},{default:l(()=>t[10]||(t[10]=[d(" 其他设置 ")])),_:1,__:[10]}),o(f,null,{default:l(()=>[o(v,{modelValue:n(i).showSearch,"onUpdate:modelValue":t[2]||(t[2]=w=>n(i).showSearch=w)},{default:l(()=>t[11]||(t[11]=[d(" 显示搜索 ")])),_:1,__:[11]},8,["modelValue"]),o(v,{modelValue:n(i).showType,"onUpdate:modelValue":t[3]||(t[3]=w=>n(i).showType=w)},{default:l(()=>t[12]||(t[12]=[d(" 显示分类 ")])),_:1,__:[12]},8,["modelValue"]),o(v,{modelValue:n(i).openInNewTab,"onUpdate:modelValue":t[4]||(t[4]=w=>n(i).openInNewTab=w)},{default:l(()=>t[13]||(t[13]=[d(" 新标签页打开工具 ")])),_:1,__:[13]},8,["modelValue"])]),_:1})])}}}),nt=D(st,[["__scopeId","data-v-f2fa67ef"]]),at={flex:"","flex-wrap":"","items-start":"","gap-4":""},rt=P({__name:"settings",setup(x){const s=T();return(c,i)=>{const C=B,t=oe;return m(),k("div",null,[n(s).logged?(m(),O(C,{key:0,level:3},{default:l(()=>[d(E(n(s).profile.nickName)+" 欢迎你~ ",1)]),_:1})):$("",!0),o(ot),o(t),r("div",at,[o(nt),o(Se,{"flex-1":""})])])}}}),Nt=D(rt,[["__scopeId","data-v-0add9d51"]]);export{Nt as default};
