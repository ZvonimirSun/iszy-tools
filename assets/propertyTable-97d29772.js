import{h as R,R as G,V as _,a0 as V,X as x,k,Y as z,n as m,o as w,l as j,a as y,w as A,a1 as L,c as P,B as F,a2 as M,_ as X}from"./index.js";import{E as Y}from"./el-empty-ca2d65a7.js";import{E as q,a as H}from"./el-table-v2-8f80da48.js";import"./el-scrollbar-e88d9e52.js";import"./castArray-88ad293b.js";const Q=R({__name:"propertyTable",props:{height:{default:null}},setup(U){G(()=>{_.on("updateGeojsonLayer",E),_.on("updateEditor",E)});const i=V(null),t=x({row:null,col:null,value:null,changed:!1});let d=!1;const b=k(()=>{var e,a;return(a=(e=i.value)==null?void 0:e.features)!=null&&a.length?i.value.features.map(l=>l.properties||{}):[]}),g=k(()=>{var e,a;if((a=(e=i.value)==null?void 0:e.features)!=null&&a.length){const l=T(b.value);return l.length?l.map(u=>({title:u,dataKey:u,key:u,width:150,cellRenderer:({rowData:r,column:s,rowIndex:c,columnIndex:p})=>{let f,h;r[s.dataKey]!=null?(h=typeof r[s.dataKey],~["boolean","number","string"].indexOf(h)?f=r[s.dataKey].toString():f=JSON.stringify(r[s.dataKey])):f="";const B=()=>{t.row=c,t.col=p,t.value=f},J=()=>{if(t.changed){let n;if(t.value!=null?n=t.value.trim():n="",h!=="string")try{n=JSON.parse(n)}catch{}K(c,p,n)}t.row=null,t.col=null,t.value=null,t.changed=!1},N=n=>{t.value=n,t.changed=!0},C=n=>{var v;(v=n==null?void 0:n.focus)==null||v.call(n)};return t.row===c&&t.col===p?y(F,{ref:C,modelValue:t.value,onInput:N,onBlur:J},null):y("div",{class:"table-v2-inline-editing-trigger",onClick:B,title:f},[f])}})):null}else return null}),S=z(O,500);function K(e,a,l){var u,r,s,c;const o=(r=(u=i.value)==null?void 0:u.features)==null?void 0:r[e];if(o){o.properties||(o.properties={});const p=(c=(s=g.value)==null?void 0:s[a])==null?void 0:c.dataKey;p&&(o.properties[p]=l)}i.value&&S(M(i.value))}function O(e){d||(d=!0,_.emit("updateEditor",e),d=!1)}function E(){d||_.emit("getGeoJson",function(e){i.value=e})}function T(e){return[...e.reduce((a,l)=>(Object.keys(l).forEach(o=>a.add(o)),a),new Set)]}return(e,a)=>{const l=q,o=H,u=Y;return m(g)?(w(),j("div",{key:0,"w-full":"",style:L({height:e.height?e.height+"px":void 0})},[y(o,null,{default:A(({height:r,width:s})=>[y(l,{columns:m(g),data:m(b),width:s,height:r,fixed:""},null,8,["columns","data","width","height"])]),_:1})],4)):(w(),P(u,{key:1}))}}});const ee=X(Q,[["__scopeId","data-v-3f556491"]]);export{ee as default};
