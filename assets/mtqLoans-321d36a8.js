import{X as Z,C as ee,h as te,y as F,k as g,Q as J,D as ne,o as B,l as q,m as C,a as t,w as i,n as p,z as b,G as T,H as O,b as G,c as ae,s as le,t as oe,B as ue,E as me,I as re,J as ie,_ as se}from"./index.js";import{E as de,a as pe}from"./el-table-column-96d37f2e.js";import"./el-checkbox-a510239a.js";import"./el-tooltip-4ed993c7.js";import"./el-popper-c257b8a5.js";import"./el-scrollbar-e88d9e52.js";import"./el-tag-819ca3b5.js";import{a as fe,E as ce}from"./el-form-item-7c2ee4a4.js";import{E as ve}from"./el-space-8178ace4.js";import{E as ye}from"./el-divider-e7db1f3a.js";import{E as _e}from"./el-date-picker-600660ff.js";import{E as be,a as he}from"./el-select-45679b06.js";import{E as ge}from"./el-input-number-d89f774b.js";import{d as A}from"./dayjs.min-73ebc938.js";import"./vite-8235fac6.js";import"./index-6f5f7be4.js";import"./raf-79db5f22.js";import"./isEqual-16073b58.js";import"./hasIn-b438300e.js";import"./isUndefined-aa0326a0.js";import"./castArray-88ad293b.js";import"./index-d81d9065.js";import"./strings-5f72d036.js";import"./toFinite-86dbd612.js";var Q={exports:{}};(function(E,R){(function(M,v){E.exports=v()})(Z,function(){return function(M,v,h){v.prototype.isBetween=function(V,y,m,_){var a=h(V),w=h(y),U=(_=_||"()")[0]==="(",x=_[1]===")";return(U?this.isAfter(a,m):!this.isBefore(a,m))&&(x?this.isBefore(w,m):!this.isAfter(w,m))||(U?this.isBefore(a,m):!this.isAfter(a,m))&&(x?this.isAfter(w,m):!this.isBefore(w,m))}}})})(Q);var Ae=Q.exports;const Re=ee(Ae),Me=E=>(re("data-v-272b2568"),E=E(),ie(),E),Ve={flex:"","flex-col":"","h-full":"","overflow-auto":""},xe=Me(()=>C("span",{class:"tips"},"计算仅供参考，请以银行数据为准!",-1)),De={flex:"","flex-1":"","overflow-auto":"",class:"panel-wrapper"},Ne={class:"panel"},Fe={class:"panel","flex-1":"",flex:"","flex-col":""},k="YYYY/MM/DD",Ee=te({__name:"mtqLoans",setup(E){A.extend(Re);const R=F(15e4),M=F(2),v=F(24),h=F(4.5),V=F("equalLoan"),y=F(new Date),m=F([]),_=g(()=>{const n={};if(!isNaN(R.value)&&R.value>0&&(n.loanAmount=R.value),Number.isInteger(v.value)&&v.value>0&&(n.loanMonth=v.value),!isNaN(h.value)&&h.value>0&&(n.lendingRates=h.value),y.value)if(n.firstRepaymentDate=A(y.value),m.value.length===0)n.prepayment=m.value;else{let e=!0;for(const u in m.value)if(u==="0"){if(!(m.value[u].repaymentDate&&A(m.value[u].repaymentDate).diff(A(y.value).subtract(1,"M"),"days")>=0)){e=!1;break}}else if(!(m.value[u].repaymentDate&&A(m.value[u].repaymentDate).diff(m.value[parseInt(u)-1].repaymentDate,"days")>=0)){e=!1;break}e&&(n.prepayment=m.value)}return n}),a=g(()=>_.value.loanAmount!=null&&_.value.loanMonth!=null&&_.value.lendingRates!=null&&_.value.firstRepaymentDate&&_.value.prepayment?_.value:null),w=g(()=>{if(a.value){const n=[];if(n.push({key:0,times:0,remainingPrincipal:_.value.loanAmount}),V.value==="equalLoan"){const e={loanAmount:a.value.loanAmount,loanMonth:a.value.loanMonth,lendingRates:a.value.lendingRates};for(let u=1;u<=a.value.loanMonth;u++){const l=Number((-z(e.lendingRates/100/12,e.loanMonth,e.loanAmount)).toFixed(2)),s=Number((e.loanAmount*e.lendingRates/100/12).toFixed(2)),r=Number((l-s).toFixed(2));e.loanAmount-=r,e.loanMonth--,n.push({key:u,times:u,repaymentDate:a.value.firstRepaymentDate.clone().add(u-1,"M").format(k),monthlyAmount:l,interestRepayment:s,principalRepayment:r,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}}else{const e={loanAmount:a.value.loanAmount,loanMonth:a.value.loanMonth};for(let u=1;u<=a.value.loanMonth;u++){const l=Number((e.loanAmount/e.loanMonth).toFixed(2)),s=Number((e.loanAmount*a.value.lendingRates/100/12).toFixed(2)),r=Number((l+s).toFixed(2));e.loanAmount-=l,e.loanMonth--,n.push({key:u,times:u,repaymentDate:a.value.firstRepaymentDate.clone().add(u-1,"M").format(k),monthlyAmount:r,interestRepayment:s,principalRepayment:l,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}}return n}else return[]}),U=g(()=>{if(a.value){const n=[];if(n.push({key:0,times:0,remainingPrincipal:a.value.loanAmount}),V.value==="equalLoan"){const e={loanAmount:a.value.loanAmount,loanMonth:a.value.loanMonth,lendingRates:a.value.lendingRates};let u=0,l=0;const s=J(a.value.prepayment);for(let r=1;r<=a.value.loanMonth-u;r++){if(r>0)for(;s.length>0&&A(s[0].repaymentDate).isBetween(a.value.firstRepaymentDate.clone().add(r-2,"M").subtract(1,"days"),a.value.firstRepaymentDate.clone().add(r-1,"M"),"[)");){const d=s.shift();e.loanAmount-=Number(d.repaymentAmount),e.lendingRates=Number(d.lendingRates||0),e.loanMonth-=Number(d.adjustLoanMonth||0),u+=Number(d.adjustLoanMonth||0),n.push({repaymentDate:A(d.repaymentDate).format(k),principalRepayment:d.repaymentAmount,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}const f=Number((-z(e.lendingRates/100/12,e.loanMonth,e.loanAmount)).toFixed(2));let c=Number((e.loanAmount*e.lendingRates/100/12).toFixed(2));l+=e.loanAmount*e.lendingRates/100/12-c;const D=Number((f-c).toFixed(2));e.loanAmount-=D,e.loanMonth--,e.loanMonth===0&&(c=Number((c+l).toFixed(2))),n.push({key:r,times:r,repaymentDate:a.value.firstRepaymentDate.clone().add(r-1,"M").format(k),monthlyAmount:f,interestRepayment:c,principalRepayment:D,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}}else{const e={loanAmount:a.value.loanAmount,loanMonth:a.value.loanMonth,lendingRates:a.value.lendingRates};let u=0,l=0;const s=J(a.value.prepayment);for(let r=1;r<=a.value.loanMonth-u;r++){if(s.length>0&&r>1&&A(s[0].repaymentDate).isBetween(a.value.firstRepaymentDate.clone().add(r-2,"M").subtract(1,"days"),a.value.firstRepaymentDate.clone().add(r-1,"M"),"[)")){const d=s.shift();e.loanAmount-=Number(d.repaymentAmount),e.lendingRates=Number(d.lendingRates||0),e.loanMonth-=Number(d.adjustLoanMonth||0),u+=Number(d.adjustLoanMonth||0),n.push({repaymentDate:A(d.repaymentDate).format(k),principalRepayment:d.repaymentAmount,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}const f=Number((e.loanAmount/e.loanMonth).toFixed(2));let c=Number((e.loanAmount*e.lendingRates/100/12).toFixed(2));l+=e.loanAmount*e.lendingRates/100/12-c;const D=Number((f+c).toFixed(2));e.loanAmount-=f,e.loanMonth--,e.loanMonth===0&&(c=Number((c+l).toFixed(2))),n.push({key:r,times:r,repaymentDate:a.value.firstRepaymentDate.clone().add(r-1,"M").format(k),monthlyAmount:D,interestRepayment:c,principalRepayment:f,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}}return n}else return[]}),x=g(()=>{let n=0;if(a.value)for(const e of w.value)n+=e.interestRepayment||0;return Number(n.toFixed(2))}),j=g(()=>{let n=0;if(a.value)for(const e of U.value)n+=e.interestRepayment||0;return Number(n.toFixed(2))}),P=g(()=>{let n=0;if(a.value)for(const e of m.value)n+=Number(e.repaymentAmount||0);return n.toFixed(2)}),S=g(()=>{let n=0;if(a.value)for(const e of m.value)n+=Number(e.adjustLoanMonth||0);return n.toFixed(2)}),Y=g(()=>(x.value-j.value).toFixed(2));ne(M,n=>{n!==0?v.value=n*12:v.value=120});function X(){let n,e;m.value.length===0?(n=y.value?y.value:new Date,e=h.value||0):(n=m.value[m.value.length-1].repaymentDate||new Date,e=m.value[m.value.length-1].lendingRates||0),m.value.push({repaymentDate:n,repaymentAmount:0,adjustLoanMonth:0,lendingRates:e})}function $(){m.value.pop()}function z(n,e,u,l,s){if(l=typeof l<"u"?l:0,s=typeof s<"u"?s:0,n!==0){const r=Math.pow(1+n,e);return-(n*(l+r*u))/((-1+r)*(1+n*s))}else if(e!==0)return-(l+u)/e;return 0}return(n,e)=>{const u=ge,l=fe,s=be,r=he,f=ue,c=_e,D=ye,d=me,K=ve,H=ce,L=de,W=pe;return B(),q("div",Ve,[xe,C("div",De,[C("div",Ne,[t(H,{"label-width":120,"label-align":"left"},{default:i(()=>[t(l,{label:"贷款金额"},{default:i(()=>[t(u,{modelValue:p(R),"onUpdate:modelValue":e[0]||(e[0]=o=>b(R)?R.value=o:null),"addon-after":"元","controls-position":"right"},null,8,["modelValue"])]),_:1}),t(l,{label:"贷款期限"},{default:i(()=>[t(r,{modelValue:p(M),"onUpdate:modelValue":e[1]||(e[1]=o=>b(M)?M.value=o:null),type:"number"},{default:i(()=>[t(s,{value:0,label:"自定义贷款期限"}),(B(),q(T,null,O(30,(o,I)=>t(s,{key:"repaymentPeriod"+I,value:o,label:o+"年("+o*12+"月)"},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1}),t(l,{label:"贷款月数"},{default:i(()=>[t(f,{modelValue:p(v),"onUpdate:modelValue":e[2]||(e[2]=o=>b(v)?v.value=o:null),"addon-after":"月",disabled:p(M)!==0},null,8,["modelValue","disabled"])]),_:1}),t(l,{label:"贷款利率"},{default:i(()=>[t(f,{modelValue:p(h),"onUpdate:modelValue":e[3]||(e[3]=o=>b(h)?h.value=o:null),"addon-after":"%"},null,8,["modelValue"])]),_:1}),t(l,{label:"还款方式"},{default:i(()=>[t(r,{modelValue:p(V),"onUpdate:modelValue":e[4]||(e[4]=o=>b(V)?V.value=o:null)},{default:i(()=>[t(s,{value:"equalLoan",label:"等额本息"}),t(s,{value:"equalPrincipal",label:"等额本金"})]),_:1},8,["modelValue"])]),_:1}),t(l,{label:"首次还款"},{default:i(()=>[t(c,{modelValue:p(y),"onUpdate:modelValue":e[5]||(e[5]=o=>b(y)?y.value=o:null),type:"date"},null,8,["modelValue"])]),_:1}),t(D),t(l,null,{default:i(()=>[t(K,null,{default:i(()=>[t(d,{type:"primary",disabled:!p(y),onClick:X},{default:i(()=>[G(" 添加提前还款 ")]),_:1},8,["disabled"]),p(m).length>0?(B(),ae(d,{key:0,onClick:$},{default:i(()=>[G(" 移除 ")]),_:1})):le("",!0)]),_:1})]),_:1}),(B(!0),q(T,null,O(p(m),(o,I)=>(B(),q(T,{key:I},[t(D,{orientation:"left"},{default:i(()=>[G(" 第"+oe(I+1)+"次提前还款 ",1)]),_:2},1024),t(l,{label:"还款日期"},{default:i(()=>[t(c,{modelValue:o.repaymentDate,"onUpdate:modelValue":N=>o.repaymentDate=N,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(l,{label:"提前还款金额"},{default:i(()=>[t(u,{modelValue:o.repaymentAmount,"onUpdate:modelValue":N=>o.repaymentAmount=N},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(l,{label:"调整期数"},{default:i(()=>[t(u,{modelValue:o.adjustLoanMonth,"onUpdate:modelValue":N=>o.adjustLoanMonth=N},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),t(l,{label:"调整利率"},{default:i(()=>[t(f,{modelValue:o.lendingRates,"onUpdate:modelValue":N=>o.lendingRates=N,"addon-after":"%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)],64))),128))]),_:1})]),C("div",Fe,[t(H,{"label-width":120,"label-align":"left"},{default:i(()=>[t(l,{label:"累计提前还款"},{default:i(()=>[t(f,{modelValue:p(P),"onUpdate:modelValue":e[6]||(e[6]=o=>b(P)?P.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1}),t(l,{label:"累计调整期数"},{default:i(()=>[t(f,{modelValue:p(S),"onUpdate:modelValue":e[7]||(e[7]=o=>b(S)?S.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1}),t(l,{label:"原累计利息"},{default:i(()=>[t(f,{modelValue:p(x),"onUpdate:modelValue":e[8]||(e[8]=o=>b(x)?x.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1}),t(l,{label:"累计缴息"},{default:i(()=>[t(f,{modelValue:p(j),"onUpdate:modelValue":e[9]||(e[9]=o=>b(j)?j.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1}),t(l,{label:"累计节省利息"},{default:i(()=>[t(f,{modelValue:p(Y),"onUpdate:modelValue":e[10]||(e[10]=o=>b(Y)?Y.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),t(W,{"flex-1":"",data:p(U)},{default:i(()=>[t(L,{prop:"times",label:"期次"}),t(L,{prop:"repaymentDate",label:"还款日期"}),t(L,{prop:"monthlyAmount",label:"每月还款"}),t(L,{prop:"interestRepayment",label:"偿还利息"}),t(L,{prop:"principalRepayment",label:"偿还本金"}),t(L,{prop:"remainingPrincipal",label:"剩余本金"})]),_:1},8,["data"])])])])}}});const et=se(Ee,[["__scopeId","data-v-272b2568"]]);export{et as default};
