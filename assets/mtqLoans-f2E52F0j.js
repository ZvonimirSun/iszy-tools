import{ae as W,L as X,j as $,aB as R,k as z,x as _,q as J,o as k,c as j,a as P,b as n,aD as i,y as s,F as I,e as S,W as q,aH as K,g as Q,t as Z,X as L,b0 as Y,b8 as ee,aF as te,bb as ne,bc as ae,aE as le,bP as oe,b5 as ue,aI as me,aM as re,aG as ie,b6 as se,b7 as de,aO as pe,aP as fe,ad as ye}from"./vendor-Emzjfwe5.js";var G={exports:{}};(function(v,t){(function(b,a){v.exports=a()})(W,function(){return function(b,a,h){a.prototype.isBetween=function(A,N,c,D){var M=h(A),g=h(N),U=(D=D||"()")[0]==="(",B=D[1]===")";return(U?this.isAfter(M,c):!this.isBefore(M,c))&&(B?this.isBefore(g,c):!this.isAfter(g,c))||(U?this.isBefore(M,c):!this.isAfter(M,c))&&(B?this.isAfter(g,c):!this.isBefore(g,c))}}})})(G);var ce=G.exports;const be=X(ce);function T(v,t,b,a,h){if(a=typeof a<"u"?a:0,h=typeof h<"u"?h:0,v!==0){const A=Math.pow(1+v,t);return-(v*(a+A*b))/((-1+A)*(1+v*h))}else if(t!==0)return-(a+b)/t;return 0}const ve=v=>(pe("data-v-ec3dddaa"),v=v(),fe(),v),he={flex:"","flex-col":"","h-full":"","overflow-auto":""},Re=ve(()=>P("span",{class:"tips"},"计算仅供参考，请以银行数据为准!",-1)),_e={flex:"","flex-1":"","overflow-auto":"",class:"panel-wrapper"},Me={class:"panel"},ge={class:"panel","flex-1":"",flex:"","flex-col":""},w="YYYY/MM/DD",Ae=$({__name:"mtqLoans",setup(v){R.extend(be);const t=z({loanAmount:15e4,repaymentPeriod:2,loanMonth:24,lendingRates:4.5,repayment:"equalLoan",firstRepaymentDate:new Date,prepayment:[]}),b=_(()=>{const l={};if(!isNaN(t.loanAmount)&&t.loanAmount>0&&(l.loanAmount=t.loanAmount),Number.isInteger(t.loanMonth)&&t.loanMonth>0&&(l.loanMonth=t.loanMonth),!isNaN(t.lendingRates)&&t.lendingRates>0&&(l.lendingRates=t.lendingRates),t.firstRepaymentDate)if(l.firstRepaymentDate=R(t.firstRepaymentDate),t.prepayment.length===0)l.prepayment=t.prepayment;else{let e=!0;for(const m in t.prepayment)if(m==="0"){if(!(t.prepayment[m].repaymentDate&&R(t.prepayment[m].repaymentDate).diff(R(t.firstRepaymentDate).subtract(1,"M"),"days")>=0)){e=!1;break}}else if(!(t.prepayment[m].repaymentDate&&R(t.prepayment[m].repaymentDate).diff(t.prepayment[parseInt(m)-1].repaymentDate,"days")>=0)){e=!1;break}e&&(l.prepayment=t.prepayment)}return l}),a=_(()=>b.value.loanAmount!=null&&b.value.loanMonth!=null&&b.value.lendingRates!=null&&b.value.firstRepaymentDate&&b.value.prepayment?b.value:null),h=_(()=>{if(a.value){const l=[];if(l.push({key:0,times:0,remainingPrincipal:b.value.loanAmount}),t.repayment==="equalLoan"){const e={loanAmount:a.value.loanAmount,loanMonth:a.value.loanMonth,lendingRates:a.value.lendingRates};for(let m=1;m<=a.value.loanMonth;m++){const u=Number((-T(e.lendingRates/100/12,e.loanMonth,e.loanAmount)).toFixed(2)),d=Number((e.loanAmount*e.lendingRates/100/12).toFixed(2)),r=Number((u-d).toFixed(2));e.loanAmount-=r,e.loanMonth--,l.push({key:m,times:m,repaymentDate:a.value.firstRepaymentDate.clone().add(m-1,"M").format(w),monthlyAmount:u,interestRepayment:d,principalRepayment:r,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}}else{const e={loanAmount:a.value.loanAmount,loanMonth:a.value.loanMonth};for(let m=1;m<=a.value.loanMonth;m++){const u=Number((e.loanAmount/e.loanMonth).toFixed(2)),d=Number((e.loanAmount*a.value.lendingRates/100/12).toFixed(2)),r=Number((u+d).toFixed(2));e.loanAmount-=u,e.loanMonth--,l.push({key:m,times:m,repaymentDate:a.value.firstRepaymentDate.clone().add(m-1,"M").format(w),monthlyAmount:r,interestRepayment:d,principalRepayment:u,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}}return l}else return[]}),A=_(()=>{if(a.value){const l=[];if(l.push({key:0,times:0,remainingPrincipal:a.value.loanAmount}),t.repayment==="equalLoan"){const e={loanAmount:a.value.loanAmount,loanMonth:a.value.loanMonth,lendingRates:a.value.lendingRates};let m=0,u=0;const d=Y(a.value.prepayment);for(let r=1;r<=a.value.loanMonth-m;r++){if(r>0)for(;d.length>0&&R(d[0].repaymentDate).isBetween(a.value.firstRepaymentDate.clone().add(r-2,"M").subtract(1,"days"),a.value.firstRepaymentDate.clone().add(r-1,"M"),"[)");){const p=d.shift();e.loanAmount-=Number(p.repaymentAmount),e.lendingRates=Number(p.lendingRates||0),e.loanMonth-=Number(p.adjustLoanMonth||0),m+=Number(p.adjustLoanMonth||0),l.push({repaymentDate:R(p.repaymentDate).format(w),principalRepayment:p.repaymentAmount,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}const f=Number((-T(e.lendingRates/100/12,e.loanMonth,e.loanAmount)).toFixed(2));let y=Number((e.loanAmount*e.lendingRates/100/12).toFixed(2));u+=e.loanAmount*e.lendingRates/100/12-y;const V=Number((f-y).toFixed(2));e.loanAmount-=V,e.loanMonth--,e.loanMonth===0&&(y=Number((y+u).toFixed(2))),l.push({key:r,times:r,repaymentDate:a.value.firstRepaymentDate.clone().add(r-1,"M").format(w),monthlyAmount:f,interestRepayment:y,principalRepayment:V,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}}else{const e={loanAmount:a.value.loanAmount,loanMonth:a.value.loanMonth,lendingRates:a.value.lendingRates};let m=0,u=0;const d=Y(a.value.prepayment);for(let r=1;r<=a.value.loanMonth-m;r++){if(d.length>0&&r>1&&R(d[0].repaymentDate).isBetween(a.value.firstRepaymentDate.clone().add(r-2,"M").subtract(1,"days"),a.value.firstRepaymentDate.clone().add(r-1,"M"),"[)")){const p=d.shift();e.loanAmount-=Number(p.repaymentAmount),e.lendingRates=Number(p.lendingRates||0),e.loanMonth-=Number(p.adjustLoanMonth||0),m+=Number(p.adjustLoanMonth||0),l.push({repaymentDate:R(p.repaymentDate).format(w),principalRepayment:p.repaymentAmount,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}const f=Number((e.loanAmount/e.loanMonth).toFixed(2));let y=Number((e.loanAmount*e.lendingRates/100/12).toFixed(2));u+=e.loanAmount*e.lendingRates/100/12-y;const V=Number((f+y).toFixed(2));e.loanAmount-=f,e.loanMonth--,e.loanMonth===0&&(y=Number((y+u).toFixed(2))),l.push({key:r,times:r,repaymentDate:a.value.firstRepaymentDate.clone().add(r-1,"M").format(w),monthlyAmount:V,interestRepayment:y,principalRepayment:f,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}}return l}else return[]}),N=_(()=>{let l=0;if(a.value)for(const e of h.value)l+=e.interestRepayment||0;return Number(l.toFixed(2))}),c=_(()=>{let l=0;if(a.value)for(const e of A.value)l+=e.interestRepayment||0;return Number(l.toFixed(2))}),D=_(()=>{let l=0;if(a.value)for(const e of t.prepayment)l+=Number(e.repaymentAmount||0);return l.toFixed(2)}),M=_(()=>{let l=0;if(a.value)for(const e of t.prepayment)l+=Number(e.adjustLoanMonth||0);return l.toFixed(2)}),g=_(()=>(N.value-c.value).toFixed(2));J(()=>t.repaymentPeriod,l=>{l!==0?t.loanMonth=l*12:t.loanMonth=120});function U(){let l,e;t.prepayment.length===0?(l=t.firstRepaymentDate?t.firstRepaymentDate:new Date,e=t.lendingRates||0):(l=t.prepayment[t.prepayment.length-1].repaymentDate||new Date,e=t.prepayment[t.prepayment.length-1].lendingRates||0),t.prepayment.push({repaymentDate:l,repaymentAmount:0,adjustLoanMonth:0,lendingRates:e})}function B(){t.prepayment.pop()}return(l,e)=>{const m=ee,u=te,d=ne,r=ae,f=le,y=oe,V=ue,p=me,O=re,C=ie,F=se,H=de;return k(),j("div",he,[Re,P("div",_e,[P("div",Me,[n(C,{"label-width":120,"label-align":"left"},{default:i(()=>[n(u,{label:"贷款金额"},{default:i(()=>[n(m,{modelValue:s(t).loanAmount,"onUpdate:modelValue":e[0]||(e[0]=o=>s(t).loanAmount=o),"addon-after":"元","controls-position":"right"},null,8,["modelValue"])]),_:1}),n(u,{label:"贷款期限"},{default:i(()=>[n(r,{modelValue:s(t).repaymentPeriod,"onUpdate:modelValue":e[1]||(e[1]=o=>s(t).repaymentPeriod=o),type:"number"},{default:i(()=>[n(d,{value:0,label:"自定义贷款期限"}),(k(),j(I,null,S(30,(o,E)=>n(d,{key:"repaymentPeriod"+E,value:o,label:o+"年("+o*12+"月)"},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1}),n(u,{label:"贷款月数"},{default:i(()=>[n(f,{modelValue:s(t).loanMonth,"onUpdate:modelValue":e[2]||(e[2]=o=>s(t).loanMonth=o),modelModifiers:{number:!0},"addon-after":"月",disabled:s(t).repaymentPeriod!==0},null,8,["modelValue","disabled"])]),_:1}),n(u,{label:"贷款利率"},{default:i(()=>[n(f,{modelValue:s(t).lendingRates,"onUpdate:modelValue":e[3]||(e[3]=o=>s(t).lendingRates=o),"addon-after":"%"},null,8,["modelValue"])]),_:1}),n(u,{label:"还款方式"},{default:i(()=>[n(r,{modelValue:s(t).repayment,"onUpdate:modelValue":e[4]||(e[4]=o=>s(t).repayment=o)},{default:i(()=>[n(d,{value:"equalLoan",label:"等额本息"}),n(d,{value:"equalPrincipal",label:"等额本金"})]),_:1},8,["modelValue"])]),_:1}),n(u,{label:"首次还款"},{default:i(()=>[n(y,{modelValue:s(t).firstRepaymentDate,"onUpdate:modelValue":e[5]||(e[5]=o=>s(t).firstRepaymentDate=o),type:"date"},null,8,["modelValue"])]),_:1}),n(V),n(u,null,{default:i(()=>[n(O,null,{default:i(()=>[n(p,{type:"primary",disabled:!s(t).firstRepaymentDate,onClick:U},{default:i(()=>[q(" 添加提前还款 ")]),_:1},8,["disabled"]),s(t).prepayment.length>0?(k(),K(p,{key:0,onClick:B},{default:i(()=>[q(" 移除 ")]),_:1})):Q("",!0)]),_:1})]),_:1}),(k(!0),j(I,null,S(s(t).prepayment,(o,E)=>(k(),j(I,{key:E},[n(V,{orientation:"left"},{default:i(()=>[q(" 第"+Z(E+1)+"次提前还款 ",1)]),_:2},1024),n(u,{label:"还款日期"},{default:i(()=>[n(y,{modelValue:o.repaymentDate,"onUpdate:modelValue":x=>o.repaymentDate=x,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(u,{label:"提前还款金额"},{default:i(()=>[n(m,{modelValue:o.repaymentAmount,"onUpdate:modelValue":x=>o.repaymentAmount=x},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(u,{label:"调整期数"},{default:i(()=>[n(m,{modelValue:o.adjustLoanMonth,"onUpdate:modelValue":x=>o.adjustLoanMonth=x},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),n(u,{label:"调整利率"},{default:i(()=>[n(f,{modelValue:o.lendingRates,"onUpdate:modelValue":x=>o.lendingRates=x,"addon-after":"%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)],64))),128))]),_:1})]),P("div",ge,[n(C,{"label-width":120,"label-align":"left"},{default:i(()=>[n(u,{label:"累计提前还款"},{default:i(()=>[n(f,{modelValue:s(D),"onUpdate:modelValue":e[6]||(e[6]=o=>L(D)?D.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1}),n(u,{label:"累计调整期数"},{default:i(()=>[n(f,{modelValue:s(M),"onUpdate:modelValue":e[7]||(e[7]=o=>L(M)?M.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1}),n(u,{label:"原累计利息"},{default:i(()=>[n(f,{modelValue:s(N),"onUpdate:modelValue":e[8]||(e[8]=o=>L(N)?N.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1}),n(u,{label:"累计缴息"},{default:i(()=>[n(f,{modelValue:s(c),"onUpdate:modelValue":e[9]||(e[9]=o=>L(c)?c.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1}),n(u,{label:"累计节省利息"},{default:i(()=>[n(f,{modelValue:s(g),"onUpdate:modelValue":e[10]||(e[10]=o=>L(g)?g.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),n(H,{"flex-1":"",data:s(A)},{default:i(()=>[n(F,{prop:"times",label:"期次"}),n(F,{prop:"repaymentDate",label:"还款日期"}),n(F,{prop:"monthlyAmount",label:"每月还款"}),n(F,{prop:"interestRepayment",label:"偿还利息"}),n(F,{prop:"principalRepayment",label:"偿还本金"}),n(F,{prop:"remainingPrincipal",label:"剩余本金"})]),_:1},8,["data"])])])])}}}),Ve=ye(Ae,[["__scopeId","data-v-ec3dddaa"]]);export{Ve as default};
