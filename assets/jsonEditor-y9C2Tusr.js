import{G as dt,aV as ft,bo as mt,bn as M,bp as R,bm as w,am as ct,H as pt,a as vt,I as D,J as gt,c as ht,v as h,a7 as X,C as c,ad as A,j as d,x as f,n as J,h as k,w as p,y as yt,o as y,N as P,E as Ct,D as _,L as wt,M as T,O as Dt,z as W,P as _t,Q as $t}from"./index-B74qAObi.js";import{v as St}from"./el-loading-CPms9xa3.js";import{E as It}from"./el-dialog-CIvnMNEg.js";import{E as xt}from"./el-space-DA_WJkom.js";import{V as Q}from"./VanillaJsonEditor-D9KvirXv.js";import{u as U}from"./useComponentRef-CMBclj3A.js";import{c as kt}from"./clamp-DsBQzVOk.js";import{P as bt}from"./Router-810EeTv3.js";import"./index-DqSb17bi.js";import"./el-popper-F5yJsTgW.js";import"./index-B8bjuJjA.js";import"./jse-theme-dark-DbMYXHmd.js";import"./memoize-one.esm-BdPwpGay.js";import"./index-D5mNNbb_.js";import"./index-Vcq4gwWv.js";import"./last-D-rYfuUG.js";import"./map-OqdvScDC.js";import"./_baseIteratee-qAk3cWQf.js";import"./_baseEach-DLHjitx9.js";import"./range-CFj7m4Lg.js";import"./toFinite-CchT_An5.js";import"./_castFunction-DRDhKCLF.js";import"./createFile-B6X2ZddO.js";import"./formatBytes-aAslYXQD.js";import"./clone-DaVDKMpV.js";import"./castArray-HXGYNaq5.js";function G(e,l){e=e||32,l=l||"ABCDEFGHJKMNPQRSTWXYZabcdefghijkmnprstwxyz2345678";const a=l.length;let i="";for(let m=0;m<e;m++)i+=l.charAt(Math.floor(Math.random()*a));return i}const Et=new mt;let b={},q=!1;const K=dt("jsonEditor",{persist:!0,state:()=>({leftId:null,rightId:null,splitterValue:.5,fullStatus:"",$_data:{}}),getters:{dataList:e=>l=>{const a=[];for(const i in e.$_data)a.push({_id:i,name:e.$_data[i].name,updated:w(e.$_data[i].updated).format("YYYY-MM-DD HH:mm")});return l?a.filter(i=>i.name.includes(l)):a},data:e=>l=>e.$_data[l]?{...e.$_data[l],updated:w(e.$_data[l].updated).format("YYYY-MM-DD HH:mm")}:null,leftData:e=>e.leftId&&e.$_data[e.leftId]?{...e.$_data[e.leftId],updated:w(e.$_data[e.leftId].updated).format("YYYY-MM-DD HH:mm")}:null,rightData:e=>e.rightId&&e.$_data[e.rightId]?{...e.$_data[e.rightId],updated:w(e.$_data[e.rightId].updated).format("YYYY-MM-DD HH:mm")}:null,syncCloud:()=>ct().logged&&pt().modules.jsonEditor.syncCloud},actions:{setSplitter(e=.5){this.splitterValue=kt(e,0,1)},setFullStatus(e){e==="left"||e==="right"?this.fullStatus=e:this.fullStatus=""},replaceState(e=[]){const l={};for(const a of e)l[a.key]={name:a.name,content:{}},a.text!=null?l[a.key].content.text=a.text:a.json!=null&&(l[a.key].content.json=a.json),l[a.key].updated=w(a.updatedAt).format();this.$_data=l},async getSyncData(){try{const e=await M.get("/tools/jsoneditor");e.success?this.replaceState(e.data):console.log(e.message)}catch(e){console.log(e.message)}},syncData:ft(({id:e,data:l}={})=>{if(navigator.onLine)Et.enqueue(()=>M.post(`/tools/jsoneditor/${e}`,l));else if(b[e]=l,!q){let a=function(){window.removeEventListener("online",a);for(const i in b)K().syncData({id:i,data:b[i]});b={}};q=!0,window.addEventListener("online",a)}},500),saveData({left:e,right:l,id:a,content:i,name:m}={}){if(this.syncCloud&&(a=a||G(6),i!=null||m!=null)){const r={name:m||(this.$_data[a]||{}).name||`文档-${a}`};typeof i=="string"?r.text=i:typeof i=="object"&&(r.json=R(i)),this.syncData({id:a,data:r})}typeof i<"u"?(a=a||G(6),this.$_data[a]=this.$_data[a]||{},this.$_data[a].name=m||this.$_data[a].name||`文档-${a}`,typeof i=="string"?this.$_data[a].content={text:i}:this.$_data[a].content={json:R(i)},this.$_data[a].updated=w().format(),e&&(this.leftId=a),l&&(this.rightId=a)):a&&this.$_data[a]?(e&&(this.leftId=a),l&&(this.rightId=a),this.$_data[a].name=m||this.$_data[a].name):(e&&(this.leftId=null),l&&(this.rightId=null))},async deleteData({id:e}={}){if(this.syncCloud)try{const l=await M.delete(`/tools/jsoneditor/${e}`);l.success?(this.leftId===e&&(this.leftId=null),this.rightId===e&&(this.rightId=null),this.$_data[e]&&delete this.$_data[e]):console.log(l.message)}catch(l){console.log(l)}else this.leftId===e&&(this.leftId=null),this.rightId===e&&(this.rightId=null),this.$_data[e]&&delete this.$_data[e]}}}),jt={"element-loading-text":"同步中...",class:"loadingPanel"},Lt={class:"dragIcon"},Mt={key:0,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"chevron-right",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},Pt={key:1,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"chevron-left",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 320 512"},Vt={key:2,"aria-hidden":"true",focusable:"false","data-prefix":"fas","data-icon":"ellipsis-vertical",role:"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 128 512"},Yt={class:"data-list"},Nt=["onClick"],Ft={class:"data-list-item-info"},Ht={class:"data-list-item-info-title"},zt={class:"data-list-item-info-description"},Bt={class:"data-list-item-actions"},Rt={class:"dialog-footer"},Xt=vt({__name:"jsonEditor",setup(e){const l=U(),a=U(),i=D(),m=D(!0),r=D(""),n=K(),Z={array:[1,2,3],boolean:!0,color:"gold",null:null,number:123,object:{a:"b",c:"d"},string:"Hello World"};gt(()=>{O()});async function O(){n.syncCloud&&await n.getSyncData(),m.value=!1,n.leftData&&n.leftData.content?n.leftData.content.json?l.value?.set(n.leftData.content.json):n.leftData.content.text&&l.value?.set(n.leftData.content.text):l.value?.set(Z),n.rightData&&n.rightData.content&&(n.rightData.content.json?a.value?.set(n.rightData.content.json):n.rightData.content.text&&a.value?.set(n.rightData.content.text)),r.value=n.fullStatus}function V(o){n.saveData({[o]:!0}),o==="left"?l.value?.set({}):o==="right"&&a.value?.set({})}function Y(o,t){let u=null;o==="left"?u=n.leftId:o==="right"&&(u=n.rightId),u&&n.saveData({id:u,name:t})}function N(o,t){let u=null;o==="left"?u=n.leftId:o==="right"&&(u=n.rightId);const g={[o]:!0,content:t};u&&(g.id=u),n.saveData(g)}const C=D(!1),v=D(""),$=D("");let E="";const tt=ht(()=>n.dataList($.value));function F(o){v.value="",$.value="",E=o,C.value=!0}function et(){if(v.value){const o=n.data(v.value);if(o&&o.content){const t=o.content;E==="left"?(n.saveData({left:!0,id:v.value}),t.json?l.value?.set(t.json):t.text&&l.value?.set(t.text)):E==="right"&&(n.saveData({right:!0,id:v.value}),t.json?a.value?.set(t.json):t.text&&a.value?.set(t.text))}}C.value=!1}function H(o,{name:t,content:u}){n.saveData({[o]:!0,name:t,content:u}),o==="left"?l.value?.set(u):o==="right"&&a.value?.set(u)}function z(o){const t=o==="left"?n.leftId:n.rightId;t&&n.deleteData({id:t})}function at(){const o=l.value?.get();o!=null&&a.value?.set(o)}function nt(){const o=a.value?.get();o!=null&&l.value?.set(o)}let j=0,S=0,L=!1;function B(o){if(o instanceof MouseEvent&&o.button!==0)return;const t=l.value?.container;t&&(L=!1,S=Number.parseFloat(window.getComputedStyle(t).width),Number.isNaN(S)&&(S=0),o instanceof TouchEvent?(j=o.touches[0].clientX,document.addEventListener("touchend",x),document.addEventListener("touchmove",I)):(j=o.clientX,document.addEventListener("mouseup",x),document.addEventListener("mousemove",I)))}function I(o){if(!i.value)return;L=!0;let t=0;o instanceof TouchEvent?t=o.touches[0].clientX:t=o.clientX;const u=S-j+t,g=Number.parseFloat(window.getComputedStyle(i.value).width);u<435?(r.value="right",r.value!==n.fullStatus&&n.setFullStatus("right")):g-100-u<435?(r.value="left",r.value!==n.fullStatus&&n.setFullStatus("left")):(r.value="",n.setSplitter(u/(g-100)),r.value!==n.fullStatus&&n.setFullStatus())}function x(){document.removeEventListener("mousemove",I),document.removeEventListener("touchmove",I),document.removeEventListener("mouseup",x),document.removeEventListener("touchend",x)}function lt(){i.value&&(L||(r.value==="left"?(n.setSplitter(1-435/(Number.parseFloat(window.getComputedStyle(i.value).width)-100)),r.value=""):r.value==="right"&&(n.setSplitter(435/(Number.parseFloat(window.getComputedStyle(i.value).width)-100)),r.value="")))}return(o,t)=>{const u=Ct,g=xt,ot=bt,st=wt,it=It,rt=St;return y(),h(P,null,[X(f("div",jt,null,512),[[A,d(m)],[rt,!0]]),X(f("div",{ref_key:"editorPanel",ref:i,class:"editorPanel"},[c(Q,{ref_key:"editorPanelContainerLeft",ref:l,"show-menu-bar":"",class:k(["editorPanelContainer editorPanelContainerLeft",{full:d(r)==="left",hide:d(r)==="right"}]),style:J({flex:`${d(n).splitterValue} 1 0`}),name:d(n).leftData?.name,config:{mode:"text"},onChange:t[0]||(t[0]=s=>N("left",s)),onOpenRecent:t[1]||(t[1]=s=>F("left")),onOpen:t[2]||(t[2]=s=>H("left",s)),onCreate:t[3]||(t[3]=s=>V("left")),onChangeName:t[4]||(t[4]=s=>Y("left",s)),onDelete:t[5]||(t[5]=s=>z("left"))},null,8,["class","style","name"]),f("div",{class:k(["controller noShowMobile",{full:d(r)}])},[c(g,{direction:"vertical"},{default:p(()=>[d(r)?yt("",!0):(y(),h(P,{key:0},[t[17]||(t[17]=f("div",{class:"emptySpace"},null,-1)),c(u,{type:"primary",block:"",onClick:at},{default:p(()=>[...t[15]||(t[15]=[_(" 复制 ",-1),f("span",{class:"i-icon-park-outline-right"},null,-1)])]),_:1}),c(u,{type:"primary",block:"",onClick:nt},{default:p(()=>[...t[16]||(t[16]=[f("span",{class:"i-icon-park-outline-left"},null,-1),_(" 复制 ",-1)])]),_:1})],64)),f("div",{class:"drag",onMousedown:B,onTouchstart:B,onClick:lt},[f("div",Lt,[d(r)==="right"?(y(),h("svg",Mt,[...t[18]||(t[18]=[f("path",{fill:"currentColor",d:"M96 480c-8.188 0-16.38-3.125-22.62-9.375c-12.5-12.5-12.5-32.75 0-45.25L242.8 256L73.38 86.63c-12.5-12.5-12.5-32.75 0-45.25s32.75-12.5 45.25 0l192 192c12.5 12.5 12.5 32.75 0 45.25l-192 192C112.4 476.9 104.2 480 96 480z"},null,-1)])])):d(r)==="left"?(y(),h("svg",Pt,[...t[19]||(t[19]=[f("path",{fill:"currentColor",d:"M224 480c-8.188 0-16.38-3.125-22.62-9.375l-192-192c-12.5-12.5-12.5-32.75 0-45.25l192-192c12.5-12.5 32.75-12.5 45.25 0s12.5 32.75 0 45.25L77.25 256l169.4 169.4c12.5 12.5 12.5 32.75 0 45.25C240.4 476.9 232.2 480 224 480z"},null,-1)])])):(y(),h("svg",Vt,[...t[20]||(t[20]=[f("path",{fill:"currentColor",d:"M64 360C94.93 360 120 385.1 120 416C120 446.9 94.93 472 64 472C33.07 472 8 446.9 8 416C8 385.1 33.07 360 64 360zM64 200C94.93 200 120 225.1 120 256C120 286.9 94.93 312 64 312C33.07 312 8 286.9 8 256C8 225.1 33.07 200 64 200zM64 152C33.07 152 8 126.9 8 96C8 65.07 33.07 40 64 40C94.93 40 120 65.07 120 96C120 126.9 94.93 152 64 152z"},null,-1)])]))])],32)]),_:1})],2),c(Q,{ref_key:"editorPanelContainerRight",ref:a,"show-menu-bar":"",class:k(["editorPanelContainer noShowMobile editorPanelContainerRight",{full:d(r)==="right",hide:d(r)==="left"}]),style:J({flex:`${1-d(n).splitterValue} 1 0`}),name:d(n).rightData?.name,config:{mode:"tree"},onChange:t[6]||(t[6]=s=>N("right",s)),onOpenRecent:t[7]||(t[7]=s=>F("right")),onOpen:t[8]||(t[8]=s=>H("right",s)),onCreate:t[9]||(t[9]=s=>V("right")),onChangeName:t[10]||(t[10]=s=>Y("right",s)),onDelete:t[11]||(t[11]=s=>z("right"))},null,8,["class","style","name"])],512),[[A,!d(m)]]),c(it,{modelValue:d(C),"onUpdate:modelValue":t[14]||(t[14]=s=>T(C)?C.value=s:null),title:"打开最近"},{footer:p(()=>[f("span",Rt,[c(u,{onClick:t[13]||(t[13]=s=>C.value=!1)},{default:p(()=>[...t[23]||(t[23]=[_("取消",-1)])]),_:1}),c(u,{type:"primary",onClick:et},{default:p(()=>[...t[24]||(t[24]=[_(" 确定 ",-1)])]),_:1})])]),default:p(()=>[c(ot,null,{default:p(()=>[...t[21]||(t[21]=[_("搜索",-1)])]),_:1}),c(st,{modelValue:d($),"onUpdate:modelValue":t[12]||(t[12]=s=>T($)?$.value=s:null),placeholder:"请输入文档名称"},null,8,["modelValue"]),f("div",Yt,[(y(!0),h(P,null,Dt(d(tt),s=>(y(),h("div",{key:s._id,class:k(["data-list-item",{selected:s._id===d(v)}]),onClick:ut=>v.value=s._id},[f("div",Ft,[f("div",Ht,W(s.name),1),f("div",zt,W(`最后修改: ${s.updated}`),1)]),f("div",Bt,[c(u,{type:"danger",onClick:_t(ut=>d(n).deleteData({id:s._id}),["stop"])},{default:p(()=>[...t[22]||(t[22]=[_(" 删除 ",-1)])]),_:1},8,["onClick"])])],10,Nt))),128))])]),_:1},8,["modelValue"])],64)}}}),ve=$t(Xt,[["__scopeId","data-v-65c33ba6"]]);export{ve as default};
