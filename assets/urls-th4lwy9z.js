import{j as q,B as v,k as C,l as R,M as W,q as X,a4 as p,bi as Y,a9 as d,o as f,c as b,a as V,b as l,y as o,az as r,W as m,w as G,ay as A,t as U,F as x,g as J,X as S,aA as K,aB as O,b5 as Q,bM as Z,bs as ee,b6 as ae,b9 as te,bN as le,aH as se,aI as oe,a3 as re}from"./vendor-ZyFjMaVl.js";import"./common-JUKG2F3j.js";import"./ant-design-vue-ZR17kcgC.js";import"./vanilla-jsoneditor-qva85DqO.js";const B=h=>(se("data-v-84fbe46d"),h=h(),oe(),h),ne={flex:"","flex-col":"","gap-4":"","h-full":""},de={class:"new-url-form"},ue=B(()=>V("span",null," 输入链接: ",-1)),ie=B(()=>V("span",null," 自定义短网址(选): ",-1)),ce=B(()=>V("br",null,null,-1)),pe="https://url.iszy.xyz",me=q({__name:"urls",setup(h){const E=v([]),u=v(10),i=v(1),I=v(0),$=v(!1),_=C({}),y=C({}),c=C({keyword:"",url:""});R(()=>{k(i.value-1,u.value)}),W(()=>{k(i.value-1,u.value)}),X(u,()=>{i.value=1});async function k(a,t){const g=setTimeout(()=>{$.value=!0},300);try{const n=(await p.get(`${p.$apiBase}/urls/admin/urls`,{params:{pageIndex:a,pageSize:t}})).data;n.success?(I.value=n.data.count,E.value=n.data.rows.map(s=>(s.createdAt=Y(s.createdAt).format("YYYY年MM月DD日 HH:mm"),s.updatedAt=Y(s.updatedAt).format("YYYY年MM月DD日 HH:mm"),s))):d.error(n.message)}catch(n){d.error(n.message)}clearTimeout(g),$.value=!1}async function D(){if(c.url)try{const a=(await p.post(`${p.$apiBase}/urls/admin/url`,{url:c.url,keyword:c.keyword})).data;a.success?(d.success("创建成功"),c.url="",c.keyword="",await k(i.value-1,u.value)):d.error(a.message)}catch(a){d.error(a.message)}}async function H(a){try{const t=(await p.put(`${p.$apiBase}/urls/admin/url/${a.keyword}`,{url:y[a.keyword]})).data;t.success?(d.success("更新成功"),a.url=y[a.keyword],_[a.keyword]=!1,await k(i.value-1,u.value)):d.error(t.message)}catch(t){d.error(t.message)}}async function N(a){try{const t=(await p.delete(`${p.$apiBase}/urls/admin/url/${a.keyword}`,{params:{keyword:a.keyword}})).data;t.success?(await k(i.value-1,u.value),d.success("删除成功")):d.error(t.message)}catch(t){d.error(t.message)}}function M(a){_[a.keyword]=!_[a.keyword],_[a.keyword]&&(y[a.keyword]=a.url)}function T(a){return(i.value-1)*u.value+a+1}return(a,t)=>{const g=K,n=O,s=Q,z=Z,L=ee,P=ae,j=te,F=le;return f(),b("div",ne,[V("div",de,[ue,l(g,{modelValue:o(c).url,"onUpdate:modelValue":t[0]||(t[0]=e=>o(c).url=e),placeholder:"https",clearable:"","flex-1":""},null,8,["modelValue"]),ie,l(g,{modelValue:o(c).keyword,"onUpdate:modelValue":t[1]||(t[1]=e=>o(c).keyword=e),clearable:""},null,8,["modelValue"]),l(n,{type:"primary",onClick:D},{default:r(()=>[m(" 缩短 ")]),_:1})]),G((f(),A(P,{data:o(E),border:!0,stripe:!0,size:"small","flex-1":""},{default:r(()=>[l(s,{type:"index",index:T,fixed:"left"}),l(s,{prop:"keyword",label:"短网址",width:"100",fixed:"left"},{default:r(({row:e})=>[l(z,{href:pe+"/"+e.keyword,target:"_blank",style:{"white-space":"nowrap"}},{default:r(()=>[m(U(e.keyword),1)]),_:2},1032,["href"])]),_:1}),l(s,{prop:"url",label:"原网址","min-width":"300"},{default:r(({row:e})=>[o(_)[e.keyword]?(f(),A(g,{key:1,modelValue:o(y)[e.keyword],"onUpdate:modelValue":w=>o(y)[e.keyword]=w},null,8,["modelValue","onUpdate:modelValue"])):(f(),b(x,{key:0},[e.title?(f(),b(x,{key:0},[l(z,{href:e.url,target:"_blank"},{default:r(()=>[m(U(e.title),1)]),_:2},1032,["href"]),ce],64)):J("",!0),l(z,{href:e.url,target:"_blank"},{default:r(()=>[m(U(e.url),1)]),_:2},1032,["href"])],64))]),_:1}),l(s,{prop:"createdAt",label:"日期",width:"180"}),l(s,{prop:"ip",label:"IP",width:"130"}),l(s,{prop:"clicks",label:"点击次数",width:"80"}),l(s,{label:"操作",width:"140",fixed:"right"},{default:r(({row:e})=>[o(_)[e.keyword]?(f(),b(x,{key:1},[l(n,{size:"small",onClick:w=>M(e)},{default:r(()=>[m(" 取消 ")]),_:2},1032,["onClick"]),l(n,{size:"small",type:"primary",onClick:w=>H(e)},{default:r(()=>[m(" 更新 ")]),_:2},1032,["onClick"])],64)):(f(),b(x,{key:0},[l(n,{size:"small",onClick:w=>M(e)},{default:r(()=>[m(" 编辑 ")]),_:2},1032,["onClick"]),l(L,{width:"160",title:"删除后无法恢复！","confirm-button-type":"danger","confirm-button-text":"删除",onConfirm:w=>N(e)},{reference:r(()=>[l(n,{size:"small",type:"danger"},{default:r(()=>[m(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])],64))]),_:1})]),_:1},8,["data"])),[[F,o($)]]),l(j,{"current-page":o(i),"onUpdate:currentPage":t[2]||(t[2]=e=>S(i)?i.value=e:null),"page-size":o(u),"onUpdate:pageSize":t[3]||(t[3]=e=>S(u)?u.value=e:null),small:"",background:"",layout:"prev, pager, next",total:o(I)},null,8,["current-page","page-size","total"])])}}}),ge=re(me,[["__scopeId","data-v-84fbe46d"]]);export{ge as default};
