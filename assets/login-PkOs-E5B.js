import{k as F,a4 as K,R as b,J as D,at as R,aw as S,a7 as T,T as G,ab as M,ax as N,aA as c,E as m,r as g,F as _,K as n,w as l,W as O,by as I,x as u,L as Q,N as C,aB as A,Y as H,Z as J,v as W,a0 as X}from"./index-fGxIgJKl.js";import{E as Y}from"./el-space-DjZbl1wQ.js";import{E as Z}from"./el-divider-CpRrFwiN.js";import{E as j,a as ee}from"./el-form-item-Da8cdjrY.js";import{L as te}from"./linuxdo-C7o2R0pC.js";import"./castArray-D9hNaF__.js";import"./clone-BBISs6QV.js";const oe={class:"login-container"},ae={class:"main"},re=["title","onClick"],ne=["src"],se=F({__name:"login",setup(le){const s=K({userName:"",password:""}),v=b(),w=b({}),o=b(!1),y=D(),V=R(),h=S();let a=null;const B=[{type:"github",title:"Github",icon:"i-icon-park-outline:github"},{type:"linuxdo",title:"LINUX DO",img:te}];T(V,t=>{const e=t.query;e&&(typeof e.redirect=="string"&&(v.value=e.redirect),w.value=q(e))},{immediate:!0}),G(()=>{h.logged&&y.push({path:v.value||"/",query:w.value})}),M(()=>{a!=null&&(clearInterval(a),a=null),window.removeEventListener("message",E)});async function k(){if(!o.value){if(!navigator.onLine){c.warning("已离线！");return}if(s.userName!=null&&s.password!=null){o.value=!0;try{await h.login({userName:s.userName,password:s.password}),x()}catch(t){t instanceof Error&&c.error(t.message)}o.value=!1}}}function $(){y.push("/register")}function U(t){const e=`${N.apiBaseUrl}/auth/${t}`;z(e,"GitHub登录")}function x(){c.success("登录成功！"),y.push({path:v.value||"/",query:w.value})}function q(t){const{redirect:e,...i}=t;return i}async function E(t){const e=t.source;if(t.origin!==N.apiBaseUrl){console.log(`origin ${t.origin} is not valid`);return}t.data?.type!=="oauth_complete"&&t.data?.type!=="oauth_fail"||(window.removeEventListener("message",E),a!=null&&(clearInterval(a),a=null),e.close(),t.data.type==="oauth_complete"?(await h.thirdPartyLogin(t.data.data),x()):c.error("登录失败！"),o.value=!1)}function z(t,e="第三方登录",i=500,d=600){if(o.value){c.warning("登录进行中，请勿重复点击");return}o.value=!0,window.addEventListener("message",E);const p=(window.screen.height-i)/2,L=(window.screen.width-d)/2,f=window.open(t,e,`popup,width=${i},height=${d},top=${p},left=${L}`);if(!f){o.value=!1,c.error("请允许浏览器弹出窗口！");return}a=window.setInterval(()=>{f.closed&&(a!=null&&(clearInterval(a),a=null),o.value=!1)},500)}return(t,e)=>{const i=O,d=j,p=Q,L=ee,f=Z,P=Y;return g(),m("div",oe,[_("div",ae,[n(L,A({layout:"horizontal",model:u(s)},{wrapperCol:{span:24}}),{default:l(()=>[n(d,{required:""},{default:l(()=>[n(i,{modelValue:u(s).userName,"onUpdate:modelValue":e[0]||(e[0]=r=>u(s).userName=r),placeholder:"账户",size:"large",onKeypress:I(k,["enter"])},{prefix:l(()=>[...e[2]||(e[2]=[_("span",{class:"i-icon-park-outline-user"},null,-1)])]),_:1},8,["modelValue"])]),_:1}),n(d,{required:""},{default:l(()=>[n(i,{modelValue:u(s).password,"onUpdate:modelValue":e[1]||(e[1]=r=>u(s).password=r),type:"password",placeholder:"密码",size:"large","show-password":"",onKeypress:I(k,["enter"])},{prefix:l(()=>[...e[3]||(e[3]=[_("span",{class:"i-icon-park-outline-lock"},null,-1)])]),_:1},8,["modelValue"])]),_:1}),n(d,null,{default:l(()=>[n(p,{type:"primary",block:"",size:"large",loading:u(o),onClick:k},{default:l(()=>[...e[4]||(e[4]=[C(" 登录 ",-1)])]),_:1},8,["loading"]),n(p,{block:"",size:"large",disabled:u(o),onClick:$},{default:l(()=>[...e[5]||(e[5]=[C(" 注册 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},16,["model"]),n(f),n(P,null,{default:l(()=>[(g(),m(H,null,J(B,r=>_("div",{key:r.type,class:"third-party",title:r.title,onClick:ie=>U(r.type)},[r.icon?(g(),m("i",{key:0,class:W(r.icon)},null,2)):(g(),m("img",{key:1,class:"third-party-img",src:r.img,alt:""},null,8,ne))],8,re)),64))]),_:1})])])}}}),_e=X(se,[["__scopeId","data-v-80f74cd1"]]);export{_e as default};
