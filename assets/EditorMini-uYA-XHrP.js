import{E as b,H as Et,t as u,V as ke,D as k,e as I,h as R,j as ne,S as D,F as Le,k as Ie,C as v,l as m,P as it,g as Ee,m as he,n as ot,o as x,p as V,q as st,R as Dt,r as At,a7 as De,w as Ae,aa as Rt,ab as Tt,ac as rt,ad as ye,ae as Ot,af as Pt,ag as Wt,ah as Bt,z as Ft,A as $t,B as qt,G as Nt,I as Ut,J as lt,K as Ht,M as zt,v as _,O as jt,Q as _t,T as Vt,U as Kt,W as Qt,X as Gt,Y as Jt,Z as Xt,N as Ce,x as Yt,ai as Zt,a1 as Fe}from"./index-fMNezIWR.js";import{F as en,t as tn,bJ as de,o as nn,aG as on,w as sn,J as rn,K as ln,aC as an}from"./index-P7-E4CKY.js";const cn="#e5c07b",$e="#e06c75",hn="#56b6c2",fn="#ffffff",te="#abb2bf",ve="#7d8799",un="#61afef",dn="#98c379",qe="#d19a66",pn="#c678dd",mn="#21252b",Ne="#2c313a",Ue="#282c34",pe="#353a42",gn="#3E4451",He="#528bff",ze=b.theme({"&":{color:te,backgroundColor:Ue},".cm-content":{caretColor:He},".cm-cursor, .cm-dropCursor":{borderLeftColor:He},"&.cm-focused > .cm-scroller > .cm-selectionLayer .cm-selectionBackground, .cm-selectionBackground, .cm-content ::selection":{backgroundColor:gn},".cm-panels":{backgroundColor:mn,color:te},".cm-panels.cm-panels-top":{borderBottom:"2px solid black"},".cm-panels.cm-panels-bottom":{borderTop:"2px solid black"},".cm-searchMatch":{backgroundColor:"#72a1ff59",outline:"1px solid #457dff"},".cm-searchMatch.cm-searchMatch-selected":{backgroundColor:"#6199ff2f"},".cm-activeLine":{backgroundColor:"#6699ff0b"},".cm-selectionMatch":{backgroundColor:"#aafe661a"},"&.cm-focused .cm-matchingBracket, &.cm-focused .cm-nonmatchingBracket":{backgroundColor:"#bad0f847"},".cm-gutters":{backgroundColor:Ue,color:ve,border:"none"},".cm-activeLineGutter":{backgroundColor:Ne},".cm-foldPlaceholder":{backgroundColor:"transparent",border:"none",color:"#ddd"},".cm-tooltip":{border:"none",backgroundColor:pe},".cm-tooltip .cm-tooltip-arrow:before":{borderTopColor:"transparent",borderBottomColor:"transparent"},".cm-tooltip .cm-tooltip-arrow:after":{borderTopColor:pe,borderBottomColor:pe},".cm-tooltip-autocomplete":{"& > ul > li[aria-selected]":{backgroundColor:Ne,color:te}}},{dark:!0}),je=Et.define([{tag:u.keyword,color:pn},{tag:[u.name,u.deleted,u.character,u.propertyName,u.macroName],color:$e},{tag:[u.function(u.variableName),u.labelName],color:un},{tag:[u.color,u.constant(u.name),u.standard(u.name)],color:qe},{tag:[u.definition(u.name),u.separator],color:te},{tag:[u.typeName,u.className,u.number,u.changed,u.annotation,u.modifier,u.self,u.namespace],color:cn},{tag:[u.operator,u.operatorKeyword,u.url,u.escape,u.regexp,u.link,u.special(u.string)],color:hn},{tag:[u.meta,u.comment],color:ve},{tag:u.strong,fontWeight:"bold"},{tag:u.emphasis,fontStyle:"italic"},{tag:u.strikethrough,textDecoration:"line-through"},{tag:u.link,color:ve,textDecoration:"underline"},{tag:u.heading,fontWeight:"bold",color:$e},{tag:[u.atom,u.bool,u.special(u.variableName)],color:qe},{tag:[u.processingInstruction,u.string,u.inserted],color:dn},{tag:u.invalid,color:fn}]),_e=typeof String.prototype.normalize=="function"?n=>n.normalize("NFKD"):n=>n;class H{constructor(e,t,i=0,o=e.length,s,r){this.test=r,this.value={from:0,to:0},this.done=!1,this.matches=[],this.buffer="",this.bufferPos=0,this.iter=e.iterRange(i,o),this.bufferStart=i,this.normalize=s?l=>s(_e(l)):_e,this.query=this.normalize(t)}peek(){if(this.bufferPos==this.buffer.length){if(this.bufferStart+=this.buffer.length,this.iter.next(),this.iter.done)return-1;this.bufferPos=0,this.buffer=this.iter.value}return I(this.buffer,this.bufferPos)}next(){for(;this.matches.length;)this.matches.pop();return this.nextOverlapping()}nextOverlapping(){for(;;){let e=this.peek();if(e<0)return this.done=!0,this;let t=Ee(e),i=this.bufferStart+this.bufferPos;this.bufferPos+=R(e);let o=this.normalize(t);for(let s=0,r=i;;s++){let l=o.charCodeAt(s),a=this.match(l,r);if(s==o.length-1){if(a)return this.value=a,this;break}r==i&&s<t.length&&t.charCodeAt(s)==l&&r++}}}match(e,t){let i=null;for(let o=0;o<this.matches.length;o+=2){let s=this.matches[o],r=!1;this.query.charCodeAt(s)==e&&(s==this.query.length-1?i={from:this.matches[o+1],to:t+1}:(this.matches[o]++,r=!0)),r||(this.matches.splice(o,2),o-=2)}return this.query.charCodeAt(0)==e&&(this.query.length==1?i={from:t,to:t+1}:this.matches.push(1,t)),i&&this.test&&!this.test(i.from,i.to,this.buffer,this.bufferStart)&&(i=null),i}}typeof Symbol<"u"&&(H.prototype[Symbol.iterator]=function(){return this});const at={from:-1,to:-1,match:/.*/.exec("")},Re="gm"+(/x/.unicode==null?"":"u");class ct{constructor(e,t,i,o=0,s=e.length){if(this.text=e,this.to=s,this.curLine="",this.done=!1,this.value=at,/\\[sWDnr]|\n|\r|\[\^/.test(t))return new ht(e,t,i,o,s);this.re=new RegExp(t,Re+(i!=null&&i.ignoreCase?"i":"")),this.test=i==null?void 0:i.test,this.iter=e.iter();let r=e.lineAt(o);this.curLineStart=r.from,this.matchPos=ie(e,o),this.getLine(this.curLineStart)}getLine(e){this.iter.next(e),this.iter.lineBreak?this.curLine="":(this.curLine=this.iter.value,this.curLineStart+this.curLine.length>this.to&&(this.curLine=this.curLine.slice(0,this.to-this.curLineStart)),this.iter.next())}nextLine(){this.curLineStart=this.curLineStart+this.curLine.length+1,this.curLineStart>this.to?this.curLine="":this.getLine(0)}next(){for(let e=this.matchPos-this.curLineStart;;){this.re.lastIndex=e;let t=this.matchPos<=this.to&&this.re.exec(this.curLine);if(t){let i=this.curLineStart+t.index,o=i+t[0].length;if(this.matchPos=ie(this.text,o+(i==o?1:0)),i==this.curLineStart+this.curLine.length&&this.nextLine(),(i<o||i>this.value.to)&&(!this.test||this.test(i,o,t)))return this.value={from:i,to:o,match:t},this;e=this.matchPos-this.curLineStart}else if(this.curLineStart+this.curLine.length<this.to)this.nextLine(),e=0;else return this.done=!0,this}}}const me=new WeakMap;class N{constructor(e,t){this.from=e,this.text=t}get to(){return this.from+this.text.length}static get(e,t,i){let o=me.get(e);if(!o||o.from>=i||o.to<=t){let l=new N(t,e.sliceString(t,i));return me.set(e,l),l}if(o.from==t&&o.to==i)return o;let{text:s,from:r}=o;return r>t&&(s=e.sliceString(t,r)+s,r=t),o.to<i&&(s+=e.sliceString(o.to,i)),me.set(e,new N(r,s)),new N(t,s.slice(t-r,i-r))}}class ht{constructor(e,t,i,o,s){this.text=e,this.to=s,this.done=!1,this.value=at,this.matchPos=ie(e,o),this.re=new RegExp(t,Re+(i!=null&&i.ignoreCase?"i":"")),this.test=i==null?void 0:i.test,this.flat=N.get(e,o,this.chunkEnd(o+5e3))}chunkEnd(e){return e>=this.to?this.to:this.text.lineAt(e).to}next(){for(;;){let e=this.re.lastIndex=this.matchPos-this.flat.from,t=this.re.exec(this.flat.text);if(t&&!t[0]&&t.index==e&&(this.re.lastIndex=e+1,t=this.re.exec(this.flat.text)),t){let i=this.flat.from+t.index,o=i+t[0].length;if((this.flat.to>=this.to||t.index+t[0].length<=this.flat.text.length-10)&&(!this.test||this.test(i,o,t)))return this.value={from:i,to:o,match:t},this.matchPos=ie(this.text,o+(i==o?1:0)),this}if(this.flat.to==this.to)return this.done=!0,this;this.flat=N.get(this.text,this.flat.from,this.chunkEnd(this.flat.from+this.flat.text.length*2))}}}typeof Symbol<"u"&&(ct.prototype[Symbol.iterator]=ht.prototype[Symbol.iterator]=function(){return this});function bn(n){try{return new RegExp(n,Re),!0}catch{return!1}}function ie(n,e){if(e>=n.length)return e;let t=n.lineAt(e),i;for(;e<t.to&&(i=t.text.charCodeAt(e-t.from))>=56320&&i<57344;)e++;return e}function Se(n){let e=String(n.state.doc.lineAt(n.state.selection.main.head).number),t=x("input",{class:"cm-textfield",name:"line",value:e}),i=x("form",{class:"cm-gotoLine",onkeydown:s=>{s.keyCode==27?(s.preventDefault(),n.dispatch({effects:oe.of(!1)}),n.focus()):s.keyCode==13&&(s.preventDefault(),o())},onsubmit:s=>{s.preventDefault(),o()}},x("label",n.state.phrase("Go to line"),": ",t)," ",x("button",{class:"cm-button",type:"submit"},n.state.phrase("go")));function o(){let s=/^([+-])?(\d+)?(:\d+)?(%)?$/.exec(t.value);if(!s)return;let{state:r}=n,l=r.doc.lineAt(r.selection.main.head),[,a,c,h,f]=s,d=h?+h.slice(1):0,p=c?+c:l.number;if(c&&f){let P=p/100;a&&(P=P*(a=="-"?-1:1)+l.number/r.doc.lines),p=Math.round(r.doc.lines*P)}else c&&a&&(p=p*(a=="-"?-1:1)+l.number);let C=r.doc.line(Math.max(1,Math.min(r.doc.lines,p))),E=m.cursor(C.from+Math.max(0,Math.min(d,C.length)));n.dispatch({effects:[oe.of(!1),b.scrollIntoView(E.from,{y:"center"})],selection:E}),n.focus()}return{dom:i}}const oe=D.define(),Ve=he.define({create(){return!0},update(n,e){for(let t of e.effects)t.is(oe)&&(n=t.value);return n},provide:n=>ot.from(n,e=>e?Se:null)}),xn=n=>{let e=ne(n,Se);if(!e){let t=[oe.of(!0)];n.state.field(Ve,!1)==null&&t.push(D.appendConfig.of([Ve,yn])),n.dispatch({effects:t}),e=ne(n,Se)}return e&&e.dom.querySelector("input").select(),!0},yn=b.baseTheme({".cm-panel.cm-gotoLine":{padding:"2px 6px 4px","& label":{fontSize:"80%"}}}),Cn={highlightWordAroundCursor:!1,minSelectionLength:1,maxMatches:100,wholeWords:!1},ft=Le.define({combine(n){return Ie(n,Cn,{highlightWordAroundCursor:(e,t)=>e||t,minSelectionLength:Math.min,maxMatches:Math.min})}});function vn(n){let e=[Ln,kn];return n&&e.push(ft.of(n)),e}const Sn=k.mark({class:"cm-selectionMatch"}),wn=k.mark({class:"cm-selectionMatch cm-selectionMatch-main"});function Ke(n,e,t,i){return(t==0||n(e.sliceDoc(t-1,t))!=v.Word)&&(i==e.doc.length||n(e.sliceDoc(i,i+1))!=v.Word)}function Mn(n,e,t,i){return n(e.sliceDoc(t,t+1))==v.Word&&n(e.sliceDoc(i-1,i))==v.Word}const kn=ke.fromClass(class{constructor(n){this.decorations=this.getDeco(n)}update(n){(n.selectionSet||n.docChanged||n.viewportChanged)&&(this.decorations=this.getDeco(n.view))}getDeco(n){let e=n.state.facet(ft),{state:t}=n,i=t.selection;if(i.ranges.length>1)return k.none;let o=i.main,s,r=null;if(o.empty){if(!e.highlightWordAroundCursor)return k.none;let a=t.wordAt(o.head);if(!a)return k.none;r=t.charCategorizer(o.head),s=t.sliceDoc(a.from,a.to)}else{let a=o.to-o.from;if(a<e.minSelectionLength||a>200)return k.none;if(e.wholeWords){if(s=t.sliceDoc(o.from,o.to),r=t.charCategorizer(o.head),!(Ke(r,t,o.from,o.to)&&Mn(r,t,o.from,o.to)))return k.none}else if(s=t.sliceDoc(o.from,o.to).trim(),!s)return k.none}let l=[];for(let a of n.visibleRanges){let c=new H(t.doc,s,a.from,a.to);for(;!c.next().done;){let{from:h,to:f}=c.value;if((!r||Ke(r,t,h,f))&&(o.empty&&h<=o.from&&f>=o.to?l.push(wn.range(h,f)):(h>=o.to||f<=o.from)&&l.push(Sn.range(h,f)),l.length>e.maxMatches))return k.none}}return k.set(l)}},{decorations:n=>n.decorations}),Ln=b.baseTheme({".cm-selectionMatch":{backgroundColor:"#99ff7780"},".cm-searchMatch .cm-selectionMatch":{backgroundColor:"transparent"}}),In=({state:n,dispatch:e})=>{let{selection:t}=n,i=m.create(t.ranges.map(o=>n.wordAt(o.head)||m.cursor(o.head)),t.mainIndex);return i.eq(t)?!1:(e(n.update({selection:i})),!0)};function En(n,e){let{main:t,ranges:i}=n.selection,o=n.wordAt(t.head),s=o&&o.from==t.from&&o.to==t.to;for(let r=!1,l=new H(n.doc,e,i[i.length-1].to);;)if(l.next(),l.done){if(r)return null;l=new H(n.doc,e,0,Math.max(0,i[i.length-1].from-1)),r=!0}else{if(r&&i.some(a=>a.from==l.value.from))continue;if(s){let a=n.wordAt(l.value.from);if(!a||a.from!=l.value.from||a.to!=l.value.to)continue}return l.value}}const Dn=({state:n,dispatch:e})=>{let{ranges:t}=n.selection;if(t.some(s=>s.from===s.to))return In({state:n,dispatch:e});let i=n.sliceDoc(t[0].from,t[0].to);if(n.selection.ranges.some(s=>n.sliceDoc(s.from,s.to)!=i))return!1;let o=En(n,i);return o?(e(n.update({selection:n.selection.addRange(m.range(o.from,o.to),!1),effects:b.scrollIntoView(o.to)})),!0):!1},z=Le.define({combine(n){return Ie(n,{top:!1,caseSensitive:!1,literal:!1,regexp:!1,wholeWord:!1,createPanel:e=>new Un(e),scrollToMatch:e=>b.scrollIntoView(e)})}});class ut{constructor(e){this.search=e.search,this.caseSensitive=!!e.caseSensitive,this.literal=!!e.literal,this.regexp=!!e.regexp,this.replace=e.replace||"",this.valid=!!this.search&&(!this.regexp||bn(this.search)),this.unquoted=this.unquote(this.search),this.wholeWord=!!e.wholeWord}unquote(e){return this.literal?e:e.replace(/\\([nrt\\])/g,(t,i)=>i=="n"?`
`:i=="r"?"\r":i=="t"?"	":"\\")}eq(e){return this.search==e.search&&this.replace==e.replace&&this.caseSensitive==e.caseSensitive&&this.regexp==e.regexp&&this.wholeWord==e.wholeWord}create(){return this.regexp?new On(this):new Rn(this)}getCursor(e,t=0,i){let o=e.doc?e:V.create({doc:e});return i==null&&(i=o.doc.length),this.regexp?$(this,o,t,i):F(this,o,t,i)}}class dt{constructor(e){this.spec=e}}function F(n,e,t,i){return new H(e.doc,n.unquoted,t,i,n.caseSensitive?void 0:o=>o.toLowerCase(),n.wholeWord?An(e.doc,e.charCategorizer(e.selection.main.head)):void 0)}function An(n,e){return(t,i,o,s)=>((s>t||s+o.length<i)&&(s=Math.max(0,t-2),o=n.sliceString(s,Math.min(n.length,i+2))),(e(se(o,t-s))!=v.Word||e(re(o,t-s))!=v.Word)&&(e(re(o,i-s))!=v.Word||e(se(o,i-s))!=v.Word))}class Rn extends dt{constructor(e){super(e)}nextMatch(e,t,i){let o=F(this.spec,e,i,e.doc.length).nextOverlapping();return o.done&&(o=F(this.spec,e,0,t).nextOverlapping()),o.done?null:o.value}prevMatchInRange(e,t,i){for(let o=i;;){let s=Math.max(t,o-1e4-this.spec.unquoted.length),r=F(this.spec,e,s,o),l=null;for(;!r.nextOverlapping().done;)l=r.value;if(l)return l;if(s==t)return null;o-=1e4}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace)}matchAll(e,t){let i=F(this.spec,e,0,e.doc.length),o=[];for(;!i.next().done;){if(o.length>=t)return null;o.push(i.value)}return o}highlight(e,t,i,o){let s=F(this.spec,e,Math.max(0,t-this.spec.unquoted.length),Math.min(i+this.spec.unquoted.length,e.doc.length));for(;!s.next().done;)o(s.value.from,s.value.to)}}function $(n,e,t,i){return new ct(e.doc,n.search,{ignoreCase:!n.caseSensitive,test:n.wholeWord?Tn(e.charCategorizer(e.selection.main.head)):void 0},t,i)}function se(n,e){return n.slice(st(n,e,!1),e)}function re(n,e){return n.slice(e,st(n,e))}function Tn(n){return(e,t,i)=>!i[0].length||(n(se(i.input,i.index))!=v.Word||n(re(i.input,i.index))!=v.Word)&&(n(re(i.input,i.index+i[0].length))!=v.Word||n(se(i.input,i.index+i[0].length))!=v.Word)}class On extends dt{nextMatch(e,t,i){let o=$(this.spec,e,i,e.doc.length).next();return o.done&&(o=$(this.spec,e,0,t).next()),o.done?null:o.value}prevMatchInRange(e,t,i){for(let o=1;;o++){let s=Math.max(t,i-o*1e4),r=$(this.spec,e,s,i),l=null;for(;!r.next().done;)l=r.value;if(l&&(s==t||l.from>s+10))return l;if(s==t)return null}}prevMatch(e,t,i){return this.prevMatchInRange(e,0,t)||this.prevMatchInRange(e,i,e.doc.length)}getReplacement(e){return this.spec.unquote(this.spec.replace).replace(/\$([$&\d+])/g,(t,i)=>i=="$"?"$":i=="&"?e.match[0]:i!="0"&&+i<e.match.length?e.match[i]:t)}matchAll(e,t){let i=$(this.spec,e,0,e.doc.length),o=[];for(;!i.next().done;){if(o.length>=t)return null;o.push(i.value)}return o}highlight(e,t,i,o){let s=$(this.spec,e,Math.max(0,t-250),Math.min(i+250,e.doc.length));for(;!s.next().done;)o(s.value.from,s.value.to)}}const K=D.define(),Te=D.define(),T=he.define({create(n){return new ge(we(n).create(),null)},update(n,e){for(let t of e.effects)t.is(K)?n=new ge(t.value.create(),n.panel):t.is(Te)&&(n=new ge(n.query,t.value?Oe:null));return n},provide:n=>ot.from(n,e=>e.panel)});class ge{constructor(e,t){this.query=e,this.panel=t}}const Pn=k.mark({class:"cm-searchMatch"}),Wn=k.mark({class:"cm-searchMatch cm-searchMatch-selected"}),Bn=ke.fromClass(class{constructor(n){this.view=n,this.decorations=this.highlight(n.state.field(T))}update(n){let e=n.state.field(T);(e!=n.startState.field(T)||n.docChanged||n.selectionSet||n.viewportChanged)&&(this.decorations=this.highlight(e))}highlight({query:n,panel:e}){if(!e||!n.spec.valid)return k.none;let{view:t}=this,i=new Dt;for(let o=0,s=t.visibleRanges,r=s.length;o<r;o++){let{from:l,to:a}=s[o];for(;o<r-1&&a>s[o+1].from-2*250;)a=s[++o].to;n.highlight(t.state,l,a,(c,h)=>{let f=t.state.selection.ranges.some(d=>d.from==c&&d.to==h);i.add(c,h,f?Wn:Pn)})}return i.finish()}},{decorations:n=>n.decorations});function J(n){return e=>{let t=e.state.field(T,!1);return t&&t.query.spec.valid?n(e,t):gt(e)}}const le=J((n,{query:e})=>{let{to:t}=n.state.selection.main,i=e.nextMatch(n.state,t,t);if(!i)return!1;let o=m.single(i.from,i.to),s=n.state.facet(z);return n.dispatch({selection:o,effects:[Pe(n,i),s.scrollToMatch(o.main,n)],userEvent:"select.search"}),mt(n),!0}),ae=J((n,{query:e})=>{let{state:t}=n,{from:i}=t.selection.main,o=e.prevMatch(t,i,i);if(!o)return!1;let s=m.single(o.from,o.to),r=n.state.facet(z);return n.dispatch({selection:s,effects:[Pe(n,o),r.scrollToMatch(s.main,n)],userEvent:"select.search"}),mt(n),!0}),Fn=J((n,{query:e})=>{let t=e.matchAll(n.state,1e3);return!t||!t.length?!1:(n.dispatch({selection:m.create(t.map(i=>m.range(i.from,i.to))),userEvent:"select.search.matches"}),!0)}),$n=({state:n,dispatch:e})=>{let t=n.selection;if(t.ranges.length>1||t.main.empty)return!1;let{from:i,to:o}=t.main,s=[],r=0;for(let l=new H(n.doc,n.sliceDoc(i,o));!l.next().done;){if(s.length>1e3)return!1;l.value.from==i&&(r=s.length),s.push(m.range(l.value.from,l.value.to))}return e(n.update({selection:m.create(s,r),userEvent:"select.search.matches"})),!0},Qe=J((n,{query:e})=>{let{state:t}=n,{from:i,to:o}=t.selection.main;if(t.readOnly)return!1;let s=e.nextMatch(t,i,i);if(!s)return!1;let r=[],l,a,c=[];if(s.from==i&&s.to==o&&(a=t.toText(e.getReplacement(s)),r.push({from:s.from,to:s.to,insert:a}),s=e.nextMatch(t,s.from,s.to),c.push(b.announce.of(t.phrase("replaced match on line $",t.doc.lineAt(i).number)+"."))),s){let h=r.length==0||r[0].from>=s.to?0:s.to-s.from-a.length;l=m.single(s.from-h,s.to-h),c.push(Pe(n,s)),c.push(t.facet(z).scrollToMatch(l.main,n))}return n.dispatch({changes:r,selection:l,effects:c,userEvent:"input.replace"}),!0}),qn=J((n,{query:e})=>{if(n.state.readOnly)return!1;let t=e.matchAll(n.state,1e9).map(o=>{let{from:s,to:r}=o;return{from:s,to:r,insert:e.getReplacement(o)}});if(!t.length)return!1;let i=n.state.phrase("replaced $ matches",t.length)+".";return n.dispatch({changes:t,effects:b.announce.of(i),userEvent:"input.replace.all"}),!0});function Oe(n){return n.state.facet(z).createPanel(n)}function we(n,e){var t,i,o,s,r;let l=n.selection.main,a=l.empty||l.to>l.from+100?"":n.sliceDoc(l.from,l.to);if(e&&!a)return e;let c=n.facet(z);return new ut({search:((t=e==null?void 0:e.literal)!==null&&t!==void 0?t:c.literal)?a:a.replace(/\n/g,"\\n"),caseSensitive:(i=e==null?void 0:e.caseSensitive)!==null&&i!==void 0?i:c.caseSensitive,literal:(o=e==null?void 0:e.literal)!==null&&o!==void 0?o:c.literal,regexp:(s=e==null?void 0:e.regexp)!==null&&s!==void 0?s:c.regexp,wholeWord:(r=e==null?void 0:e.wholeWord)!==null&&r!==void 0?r:c.wholeWord})}function pt(n){let e=ne(n,Oe);return e&&e.dom.querySelector("[main-field]")}function mt(n){let e=pt(n);e&&e==n.root.activeElement&&e.select()}const gt=n=>{let e=n.state.field(T,!1);if(e&&e.panel){let t=pt(n);if(t&&t!=n.root.activeElement){let i=we(n.state,e.query.spec);i.valid&&n.dispatch({effects:K.of(i)}),t.focus(),t.select()}}else n.dispatch({effects:[Te.of(!0),e?K.of(we(n.state,e.query.spec)):D.appendConfig.of(zn)]});return!0},bt=n=>{let e=n.state.field(T,!1);if(!e||!e.panel)return!1;let t=ne(n,Oe);return t&&t.dom.contains(n.root.activeElement)&&n.focus(),n.dispatch({effects:Te.of(!1)}),!0},Nn=[{key:"Mod-f",run:gt,scope:"editor search-panel"},{key:"F3",run:le,shift:ae,scope:"editor search-panel",preventDefault:!0},{key:"Mod-g",run:le,shift:ae,scope:"editor search-panel",preventDefault:!0},{key:"Escape",run:bt,scope:"editor search-panel"},{key:"Mod-Shift-l",run:$n},{key:"Mod-Alt-g",run:xn},{key:"Mod-d",run:Dn,preventDefault:!0}];class Un{constructor(e){this.view=e;let t=this.query=e.state.field(T).query.spec;this.commit=this.commit.bind(this),this.searchField=x("input",{value:t.search,placeholder:M(e,"Find"),"aria-label":M(e,"Find"),class:"cm-textfield",name:"search",form:"","main-field":"true",onchange:this.commit,onkeyup:this.commit}),this.replaceField=x("input",{value:t.replace,placeholder:M(e,"Replace"),"aria-label":M(e,"Replace"),class:"cm-textfield",name:"replace",form:"",onchange:this.commit,onkeyup:this.commit}),this.caseField=x("input",{type:"checkbox",name:"case",form:"",checked:t.caseSensitive,onchange:this.commit}),this.reField=x("input",{type:"checkbox",name:"re",form:"",checked:t.regexp,onchange:this.commit}),this.wordField=x("input",{type:"checkbox",name:"word",form:"",checked:t.wholeWord,onchange:this.commit});function i(o,s,r){return x("button",{class:"cm-button",name:o,onclick:s,type:"button"},r)}this.dom=x("div",{onkeydown:o=>this.keydown(o),class:"cm-search"},[this.searchField,i("next",()=>le(e),[M(e,"next")]),i("prev",()=>ae(e),[M(e,"previous")]),i("select",()=>Fn(e),[M(e,"all")]),x("label",null,[this.caseField,M(e,"match case")]),x("label",null,[this.reField,M(e,"regexp")]),x("label",null,[this.wordField,M(e,"by word")]),...e.state.readOnly?[]:[x("br"),this.replaceField,i("replace",()=>Qe(e),[M(e,"replace")]),i("replaceAll",()=>qn(e),[M(e,"replace all")])],x("button",{name:"close",onclick:()=>bt(e),"aria-label":M(e,"close"),type:"button"},["×"])])}commit(){let e=new ut({search:this.searchField.value,caseSensitive:this.caseField.checked,regexp:this.reField.checked,wholeWord:this.wordField.checked,replace:this.replaceField.value});e.eq(this.query)||(this.query=e,this.view.dispatch({effects:K.of(e)}))}keydown(e){At(this.view,e,"search-panel")?e.preventDefault():e.keyCode==13&&e.target==this.searchField?(e.preventDefault(),(e.shiftKey?ae:le)(this.view)):e.keyCode==13&&e.target==this.replaceField&&(e.preventDefault(),Qe(this.view))}update(e){for(let t of e.transactions)for(let i of t.effects)i.is(K)&&!i.value.eq(this.query)&&this.setQuery(i.value)}setQuery(e){this.query=e,this.searchField.value=e.search,this.replaceField.value=e.replace,this.caseField.checked=e.caseSensitive,this.reField.checked=e.regexp,this.wordField.checked=e.wholeWord}mount(){this.searchField.select()}get pos(){return 80}get top(){return this.view.state.facet(z).top}}function M(n,e){return n.state.phrase(e)}const Y=30,Z=/[\s\.,:;?!]/;function Pe(n,{from:e,to:t}){let i=n.state.doc.lineAt(e),o=n.state.doc.lineAt(t).to,s=Math.max(i.from,e-Y),r=Math.min(o,t+Y),l=n.state.sliceDoc(s,r);if(s!=i.from){for(let a=0;a<Y;a++)if(!Z.test(l[a+1])&&Z.test(l[a])){l=l.slice(a);break}}if(r!=o){for(let a=l.length-1;a>l.length-Y;a--)if(!Z.test(l[a-1])&&Z.test(l[a])){l=l.slice(0,a);break}}return b.announce.of(`${n.state.phrase("current match")}. ${l} ${n.state.phrase("on line")} ${i.number}.`)}const Hn=b.baseTheme({".cm-panel.cm-search":{padding:"2px 6px 4px",position:"relative","& [name=close]":{position:"absolute",top:"0",right:"4px",backgroundColor:"inherit",border:"none",font:"inherit",padding:0,margin:0},"& input, & button, & label":{margin:".2em .6em .2em 0"},"& input[type=checkbox]":{marginRight:".2em"},"& label":{fontSize:"80%",whiteSpace:"pre"}},"&light .cm-searchMatch":{backgroundColor:"#ffff0054"},"&dark .cm-searchMatch":{backgroundColor:"#00ffff8a"},"&light .cm-searchMatch-selected":{backgroundColor:"#ff6a0054"},"&dark .cm-searchMatch-selected":{backgroundColor:"#ff00ff8a"}}),zn=[T,it.low(Bn),Hn];class xt{constructor(e,t,i){this.state=e,this.pos=t,this.explicit=i,this.abortListeners=[]}tokenBefore(e){let t=De(this.state).resolveInner(this.pos,-1);for(;t&&e.indexOf(t.name)<0;)t=t.parent;return t?{from:t.from,to:this.pos,text:this.state.sliceDoc(t.from,this.pos),type:t.type}:null}matchBefore(e){let t=this.state.doc.lineAt(this.pos),i=Math.max(t.from,this.pos-250),o=t.text.slice(i-t.from,this.pos-t.from),s=o.search(yt(e,!1));return s<0?null:{from:i+s,to:this.pos,text:o.slice(s)}}get aborted(){return this.abortListeners==null}addEventListener(e,t){e=="abort"&&this.abortListeners&&this.abortListeners.push(t)}}function Ge(n){let e=Object.keys(n).join(""),t=/\w/.test(e);return t&&(e=e.replace(/\w/g,"")),`[${t?"\\w":""}${e.replace(/[^\w\s]/g,"\\$&")}]`}function jn(n){let e=Object.create(null),t=Object.create(null);for(let{label:o}of n){e[o[0]]=!0;for(let s=1;s<o.length;s++)t[o[s]]=!0}let i=Ge(e)+Ge(t)+"*$";return[new RegExp("^"+i),new RegExp(i)]}function _n(n){let e=n.map(o=>typeof o=="string"?{label:o}:o),[t,i]=e.every(o=>/^\w+$/.test(o.label))?[/\w*$/,/\w+$/]:jn(e);return o=>{let s=o.matchBefore(i);return s||o.explicit?{from:s?s.from:o.pos,options:e,validFor:t}:null}}class Je{constructor(e,t,i,o){this.completion=e,this.source=t,this.match=i,this.score=o}}function O(n){return n.selection.main.from}function yt(n,e){var t;let{source:i}=n,o=e&&i[0]!="^",s=i[i.length-1]!="$";return!o&&!s?n:new RegExp(`${o?"^":""}(?:${i})${s?"$":""}`,(t=n.flags)!==null&&t!==void 0?t:n.ignoreCase?"i":"")}const Vn=Bt.define();function Kn(n,e,t,i){let{main:o}=n.selection,s=t-o.from,r=i-o.from;return Object.assign(Object.assign({},n.changeByRange(l=>l!=o&&t!=i&&n.sliceDoc(l.from+s,l.from+r)!=n.sliceDoc(t,i)?{range:l}:{changes:{from:l.from+s,to:i==o.from?l.to:l.from+r,insert:e},range:m.cursor(l.from+s+e.length)})),{scrollIntoView:!0,userEvent:"input.complete"})}const Xe=new WeakMap;function Qn(n){if(!Array.isArray(n))return n;let e=Xe.get(n);return e||Xe.set(n,e=_n(n)),e}const We=D.define(),Q=D.define();class Gn{constructor(e){this.pattern=e,this.chars=[],this.folded=[],this.any=[],this.precise=[],this.byWord=[],this.score=0,this.matched=[];for(let t=0;t<e.length;){let i=I(e,t),o=R(i);this.chars.push(i);let s=e.slice(t,t+o),r=s.toUpperCase();this.folded.push(I(r==s?s.toLowerCase():r,0)),t+=o}this.astral=e.length!=this.chars.length}ret(e,t){return this.score=e,this.matched=t,!0}match(e){if(this.pattern.length==0)return this.ret(-100,[]);if(e.length<this.pattern.length)return!1;let{chars:t,folded:i,any:o,precise:s,byWord:r}=this;if(t.length==1){let g=I(e,0),B=R(g),A=B==e.length?0:-100;if(g!=t[0])if(g==i[0])A+=-200;else return!1;return this.ret(A,[0,B])}let l=e.indexOf(this.pattern);if(l==0)return this.ret(e.length==this.pattern.length?0:-100,[0,this.pattern.length]);let a=t.length,c=0;if(l<0){for(let g=0,B=Math.min(e.length,200);g<B&&c<a;){let A=I(e,g);(A==t[c]||A==i[c])&&(o[c++]=g),g+=R(A)}if(c<a)return!1}let h=0,f=0,d=!1,p=0,C=-1,E=-1,P=/[a-z]/.test(e),j=!0;for(let g=0,B=Math.min(e.length,200),A=0;g<B&&f<a;){let S=I(e,g);l<0&&(h<a&&S==t[h]&&(s[h++]=g),p<a&&(S==t[p]||S==i[p]?(p==0&&(C=g),E=g+1,p++):p=0));let X,ue=S<255?S>=48&&S<=57||S>=97&&S<=122?2:S>=65&&S<=90?1:0:(X=Ee(S))!=X.toLowerCase()?1:X!=X.toUpperCase()?2:0;(!g||ue==1&&P||A==0&&ue!=0)&&(t[f]==S||i[f]==S&&(d=!0)?r[f++]=g:r.length&&(j=!1)),A=ue,g+=R(S)}return f==a&&r[0]==0&&j?this.result(-100+(d?-200:0),r,e):p==a&&C==0?this.ret(-200-e.length+(E==e.length?0:-100),[0,E]):l>-1?this.ret(-700-e.length,[l,l+this.pattern.length]):p==a?this.ret(-900-e.length,[C,E]):f==a?this.result(-100+(d?-200:0)+-700+(j?0:-1100),r,e):t.length==2?!1:this.result((o[0]?-700:0)+-200+-1100,o,e)}result(e,t,i){let o=[],s=0;for(let r of t){let l=r+(this.astral?R(I(i,r)):1);s&&o[s-1]==r?o[s-1]=l:(o[s++]=r,o[s++]=l)}return this.ret(e-i.length,o)}}const y=Le.define({combine(n){return Ie(n,{activateOnTyping:!0,selectOnOpen:!0,override:null,closeOnBlur:!0,maxRenderedOptions:100,defaultKeymap:!0,tooltipClass:()=>"",optionClass:()=>"",aboveCursor:!1,icons:!0,addToOptions:[],positionInfo:Jn,compareCompletions:(e,t)=>e.label.localeCompare(t.label),interactionDelay:75,updateSyncTime:100},{defaultKeymap:(e,t)=>e&&t,closeOnBlur:(e,t)=>e&&t,icons:(e,t)=>e&&t,tooltipClass:(e,t)=>i=>Ye(e(i),t(i)),optionClass:(e,t)=>i=>Ye(e(i),t(i)),addToOptions:(e,t)=>e.concat(t)})}});function Ye(n,e){return n?e?n+" "+e:n:e}function Jn(n,e,t,i,o,s){let r=n.textDirection==Rt.RTL,l=r,a=!1,c="top",h,f,d=e.left-o.left,p=o.right-e.right,C=i.right-i.left,E=i.bottom-i.top;if(l&&d<Math.min(C,p)?l=!1:!l&&p<Math.min(C,d)&&(l=!0),C<=(l?d:p))h=Math.max(o.top,Math.min(t.top,o.bottom-E))-e.top,f=Math.min(400,l?d:p);else{a=!0,f=Math.min(400,(r?e.right:o.right-e.left)-30);let g=o.bottom-e.bottom;g>=E||g>e.top?h=t.bottom-e.top:(c="bottom",h=e.bottom-t.top)}let P=(e.bottom-e.top)/s.offsetHeight,j=(e.right-e.left)/s.offsetWidth;return{style:`${c}: ${h/P}px; max-width: ${f/j}px`,class:"cm-completionInfo-"+(a?r?"left-narrow":"right-narrow":l?"left":"right")}}function Xn(n){let e=n.addToOptions.slice();return n.icons&&e.push({render(t){let i=document.createElement("div");return i.classList.add("cm-completionIcon"),t.type&&i.classList.add(...t.type.split(/\s+/g).map(o=>"cm-completionIcon-"+o)),i.setAttribute("aria-hidden","true"),i},position:20}),e.push({render(t,i,o,s){let r=document.createElement("span");r.className="cm-completionLabel";let l=t.displayLabel||t.label,a=0;for(let c=0;c<s.length;){let h=s[c++],f=s[c++];h>a&&r.appendChild(document.createTextNode(l.slice(a,h)));let d=r.appendChild(document.createElement("span"));d.appendChild(document.createTextNode(l.slice(h,f))),d.className="cm-completionMatchedText",a=f}return a<l.length&&r.appendChild(document.createTextNode(l.slice(a))),r},position:50},{render(t){if(!t.detail)return null;let i=document.createElement("span");return i.className="cm-completionDetail",i.textContent=t.detail,i},position:80}),e.sort((t,i)=>t.position-i.position).map(t=>t.render)}function be(n,e,t){if(n<=t)return{from:0,to:n};if(e<0&&(e=0),e<=n>>1){let o=Math.floor(e/t);return{from:o*t,to:(o+1)*t}}let i=Math.floor((n-e)/t);return{from:n-(i+1)*t,to:n-i*t}}class Yn{constructor(e,t,i){this.view=e,this.stateField=t,this.applyCompletion=i,this.info=null,this.infoDestroy=null,this.placeInfoReq={read:()=>this.measureInfo(),write:a=>this.placeInfo(a),key:this},this.space=null,this.currentClass="";let o=e.state.field(t),{options:s,selected:r}=o.open,l=e.state.facet(y);this.optionContent=Xn(l),this.optionClass=l.optionClass,this.tooltipClass=l.tooltipClass,this.range=be(s.length,r,l.maxRenderedOptions),this.dom=document.createElement("div"),this.dom.className="cm-tooltip-autocomplete",this.updateTooltipClass(e.state),this.dom.addEventListener("mousedown",a=>{let{options:c}=e.state.field(t).open;for(let h=a.target,f;h&&h!=this.dom;h=h.parentNode)if(h.nodeName=="LI"&&(f=/-(\d+)$/.exec(h.id))&&+f[1]<c.length){this.applyCompletion(e,c[+f[1]]),a.preventDefault();return}}),this.dom.addEventListener("focusout",a=>{let c=e.state.field(this.stateField,!1);c&&c.tooltip&&e.state.facet(y).closeOnBlur&&a.relatedTarget!=e.contentDOM&&e.dispatch({effects:Q.of(null)})}),this.showOptions(s,o.id)}mount(){this.updateSel()}showOptions(e,t){this.list&&this.list.remove(),this.list=this.dom.appendChild(this.createListBox(e,t,this.range)),this.list.addEventListener("scroll",()=>{this.info&&this.view.requestMeasure(this.placeInfoReq)})}update(e){var t;let i=e.state.field(this.stateField),o=e.startState.field(this.stateField);if(this.updateTooltipClass(e.state),i!=o){let{options:s,selected:r,disabled:l}=i.open;(!o.open||o.open.options!=s)&&(this.range=be(s.length,r,e.state.facet(y).maxRenderedOptions),this.showOptions(s,i.id)),this.updateSel(),l!=((t=o.open)===null||t===void 0?void 0:t.disabled)&&this.dom.classList.toggle("cm-tooltip-autocomplete-disabled",!!l)}}updateTooltipClass(e){let t=this.tooltipClass(e);if(t!=this.currentClass){for(let i of this.currentClass.split(" "))i&&this.dom.classList.remove(i);for(let i of t.split(" "))i&&this.dom.classList.add(i);this.currentClass=t}}positioned(e){this.space=e,this.info&&this.view.requestMeasure(this.placeInfoReq)}updateSel(){let e=this.view.state.field(this.stateField),t=e.open;if((t.selected>-1&&t.selected<this.range.from||t.selected>=this.range.to)&&(this.range=be(t.options.length,t.selected,this.view.state.facet(y).maxRenderedOptions),this.showOptions(t.options,e.id)),this.updateSelectedOption(t.selected)){this.destroyInfo();let{completion:i}=t.options[t.selected],{info:o}=i;if(!o)return;let s=typeof o=="string"?document.createTextNode(o):o(i);if(!s)return;"then"in s?s.then(r=>{r&&this.view.state.field(this.stateField,!1)==e&&this.addInfoPane(r,i)}).catch(r=>ye(this.view.state,r,"completion info")):this.addInfoPane(s,i)}}addInfoPane(e,t){this.destroyInfo();let i=this.info=document.createElement("div");if(i.className="cm-tooltip cm-completionInfo",e.nodeType!=null)i.appendChild(e),this.infoDestroy=null;else{let{dom:o,destroy:s}=e;i.appendChild(o),this.infoDestroy=s||null}this.dom.appendChild(i),this.view.requestMeasure(this.placeInfoReq)}updateSelectedOption(e){let t=null;for(let i=this.list.firstChild,o=this.range.from;i;i=i.nextSibling,o++)i.nodeName!="LI"||!i.id?o--:o==e?i.hasAttribute("aria-selected")||(i.setAttribute("aria-selected","true"),t=i):i.hasAttribute("aria-selected")&&i.removeAttribute("aria-selected");return t&&ei(this.list,t),t}measureInfo(){let e=this.dom.querySelector("[aria-selected]");if(!e||!this.info)return null;let t=this.dom.getBoundingClientRect(),i=this.info.getBoundingClientRect(),o=e.getBoundingClientRect(),s=this.space;if(!s){let r=this.dom.ownerDocument.defaultView||window;s={left:0,top:0,right:r.innerWidth,bottom:r.innerHeight}}return o.top>Math.min(s.bottom,t.bottom)-10||o.bottom<Math.max(s.top,t.top)+10?null:this.view.state.facet(y).positionInfo(this.view,t,o,i,s,this.dom)}placeInfo(e){this.info&&(e?(e.style&&(this.info.style.cssText=e.style),this.info.className="cm-tooltip cm-completionInfo "+(e.class||"")):this.info.style.cssText="top: -1e6px")}createListBox(e,t,i){const o=document.createElement("ul");o.id=t,o.setAttribute("role","listbox"),o.setAttribute("aria-expanded","true"),o.setAttribute("aria-label",this.view.state.phrase("Completions"));let s=null;for(let r=i.from;r<i.to;r++){let{completion:l,match:a}=e[r],{section:c}=l;if(c){let d=typeof c=="string"?c:c.name;if(d!=s&&(r>i.from||i.from==0))if(s=d,typeof c!="string"&&c.header)o.appendChild(c.header(c));else{let p=o.appendChild(document.createElement("completion-section"));p.textContent=d}}const h=o.appendChild(document.createElement("li"));h.id=t+"-"+r,h.setAttribute("role","option");let f=this.optionClass(l);f&&(h.className=f);for(let d of this.optionContent){let p=d(l,this.view.state,this.view,a);p&&h.appendChild(p)}}return i.from&&o.classList.add("cm-completionListIncompleteTop"),i.to<e.length&&o.classList.add("cm-completionListIncompleteBottom"),o}destroyInfo(){this.info&&(this.infoDestroy&&this.infoDestroy(),this.info.remove(),this.info=null)}destroy(){this.destroyInfo()}}function Zn(n,e){return t=>new Yn(t,n,e)}function ei(n,e){let t=n.getBoundingClientRect(),i=e.getBoundingClientRect(),o=t.height/n.offsetHeight;i.top<t.top?n.scrollTop-=(t.top-i.top)/o:i.bottom>t.bottom&&(n.scrollTop+=(i.bottom-t.bottom)/o)}function Ze(n){return(n.boost||0)*100+(n.apply?10:0)+(n.info?5:0)+(n.type?1:0)}function ti(n,e){let t=[],i=null,o=a=>{t.push(a);let{section:c}=a.completion;if(c){i||(i=[]);let h=typeof c=="string"?c:c.name;i.some(f=>f.name==h)||i.push(typeof c=="string"?{name:h}:c)}};for(let a of n)if(a.hasResult()){let c=a.result.getMatch;if(a.result.filter===!1)for(let h of a.result.options)o(new Je(h,a.source,c?c(h):[],1e9-t.length));else{let h=new Gn(e.sliceDoc(a.from,a.to));for(let f of a.result.options)if(h.match(f.label)){let d=f.displayLabel?c?c(f,h.matched):[]:h.matched;o(new Je(f,a.source,d,h.score+(f.boost||0)))}}}if(i){let a=Object.create(null),c=0,h=(f,d)=>{var p,C;return((p=f.rank)!==null&&p!==void 0?p:1e9)-((C=d.rank)!==null&&C!==void 0?C:1e9)||(f.name<d.name?-1:1)};for(let f of i.sort(h))c-=1e5,a[f.name]=c;for(let f of t){let{section:d}=f.completion;d&&(f.score+=a[typeof d=="string"?d:d.name])}}let s=[],r=null,l=e.facet(y).compareCompletions;for(let a of t.sort((c,h)=>h.score-c.score||l(c.completion,h.completion))){let c=a.completion;!r||r.label!=c.label||r.detail!=c.detail||r.type!=null&&c.type!=null&&r.type!=c.type||r.apply!=c.apply||r.boost!=c.boost?s.push(a):Ze(a.completion)>Ze(r)&&(s[s.length-1]=a),r=a.completion}return s}class q{constructor(e,t,i,o,s,r){this.options=e,this.attrs=t,this.tooltip=i,this.timestamp=o,this.selected=s,this.disabled=r}setSelected(e,t){return e==this.selected||e>=this.options.length?this:new q(this.options,et(t,e),this.tooltip,this.timestamp,e,this.disabled)}static build(e,t,i,o,s){let r=ti(e,t);if(!r.length)return o&&e.some(a=>a.state==1)?new q(o.options,o.attrs,o.tooltip,o.timestamp,o.selected,!0):null;let l=t.facet(y).selectOnOpen?0:-1;if(o&&o.selected!=l&&o.selected!=-1){let a=o.options[o.selected].completion;for(let c=0;c<r.length;c++)if(r[c].completion==a){l=c;break}}return new q(r,et(i,l),{pos:e.reduce((a,c)=>c.hasResult()?Math.min(a,c.from):a,1e8),create:ri,above:s.aboveCursor},o?o.timestamp:Date.now(),l,!1)}map(e){return new q(this.options,this.attrs,Object.assign(Object.assign({},this.tooltip),{pos:e.mapPos(this.tooltip.pos)}),this.timestamp,this.selected,this.disabled)}}class ce{constructor(e,t,i){this.active=e,this.id=t,this.open=i}static start(){return new ce(oi,"cm-ac-"+Math.floor(Math.random()*2e6).toString(36),null)}update(e){let{state:t}=e,i=t.facet(y),s=(i.override||t.languageDataAt("autocomplete",O(t)).map(Qn)).map(l=>(this.active.find(c=>c.source==l)||new w(l,this.active.some(c=>c.state!=0)?1:0)).update(e,i));s.length==this.active.length&&s.every((l,a)=>l==this.active[a])&&(s=this.active);let r=this.open;r&&e.docChanged&&(r=r.map(e.changes)),e.selection||s.some(l=>l.hasResult()&&e.changes.touchesRange(l.from,l.to))||!ni(s,this.active)?r=q.build(s,t,this.id,r,i):r&&r.disabled&&!s.some(l=>l.state==1)&&(r=null),!r&&s.every(l=>l.state!=1)&&s.some(l=>l.hasResult())&&(s=s.map(l=>l.hasResult()?new w(l.source,0):l));for(let l of e.effects)l.is(vt)&&(r=r&&r.setSelected(l.value,this.id));return s==this.active&&r==this.open?this:new ce(s,this.id,r)}get tooltip(){return this.open?this.open.tooltip:null}get attrs(){return this.open?this.open.attrs:ii}}function ni(n,e){if(n==e)return!0;for(let t=0,i=0;;){for(;t<n.length&&!n[t].hasResult;)t++;for(;i<e.length&&!e[i].hasResult;)i++;let o=t==n.length,s=i==e.length;if(o||s)return o==s;if(n[t++].result!=e[i++].result)return!1}}const ii={"aria-autocomplete":"list"};function et(n,e){let t={"aria-autocomplete":"list","aria-haspopup":"listbox","aria-controls":n};return e>-1&&(t["aria-activedescendant"]=n+"-"+e),t}const oi=[];function Me(n){return n.isUserEvent("input.type")?"input":n.isUserEvent("delete.backward")?"delete":null}class w{constructor(e,t,i=-1){this.source=e,this.state=t,this.explicitPos=i}hasResult(){return!1}update(e,t){let i=Me(e),o=this;i?o=o.handleUserEvent(e,i,t):e.docChanged?o=o.handleChange(e):e.selection&&o.state!=0&&(o=new w(o.source,0));for(let s of e.effects)if(s.is(We))o=new w(o.source,1,s.value?O(e.state):-1);else if(s.is(Q))o=new w(o.source,0);else if(s.is(Ct))for(let r of s.value)r.source==o.source&&(o=r);return o}handleUserEvent(e,t,i){return t=="delete"||!i.activateOnTyping?this.map(e.changes):new w(this.source,1)}handleChange(e){return e.changes.touchesRange(O(e.startState))?new w(this.source,0):this.map(e.changes)}map(e){return e.empty||this.explicitPos<0?this:new w(this.source,this.state,e.mapPos(this.explicitPos))}}class U extends w{constructor(e,t,i,o,s){super(e,2,t),this.result=i,this.from=o,this.to=s}hasResult(){return!0}handleUserEvent(e,t,i){var o;let s=e.changes.mapPos(this.from),r=e.changes.mapPos(this.to,1),l=O(e.state);if((this.explicitPos<0?l<=s:l<this.from)||l>r||t=="delete"&&O(e.startState)==this.from)return new w(this.source,t=="input"&&i.activateOnTyping?1:0);let a=this.explicitPos<0?-1:e.changes.mapPos(this.explicitPos),c;return si(this.result.validFor,e.state,s,r)?new U(this.source,a,this.result,s,r):this.result.update&&(c=this.result.update(this.result,s,r,new xt(e.state,l,a>=0)))?new U(this.source,a,c,c.from,(o=c.to)!==null&&o!==void 0?o:O(e.state)):new w(this.source,1,a)}handleChange(e){return e.changes.touchesRange(this.from,this.to)?new w(this.source,0):this.map(e.changes)}map(e){return e.empty?this:new U(this.source,this.explicitPos<0?-1:e.mapPos(this.explicitPos),this.result,e.mapPos(this.from),e.mapPos(this.to,1))}}function si(n,e,t,i){if(!n)return!1;let o=e.sliceDoc(t,i);return typeof n=="function"?n(o,t,i,e):yt(n,!0).test(o)}const Ct=D.define({map(n,e){return n.map(t=>t.map(e))}}),vt=D.define(),L=he.define({create(){return ce.start()},update(n,e){return n.update(e)},provide:n=>[Tt.from(n,e=>e.tooltip),b.contentAttributes.from(n,e=>e.attrs)]});function St(n,e){const t=e.completion.apply||e.completion.label;let i=n.state.field(L).active.find(o=>o.source==e.source);return i instanceof U?(typeof t=="string"?n.dispatch(Object.assign(Object.assign({},Kn(n.state,t,i.from,i.to)),{annotations:Vn.of(e.completion)})):t(n,e.completion,i.from,i.to),!0):!1}const ri=Zn(L,St);function ee(n,e="option"){return t=>{let i=t.state.field(L,!1);if(!i||!i.open||i.open.disabled||Date.now()-i.open.timestamp<t.state.facet(y).interactionDelay)return!1;let o=1,s;e=="page"&&(s=rt(t,i.open.tooltip))&&(o=Math.max(2,Math.floor(s.dom.offsetHeight/s.dom.querySelector("li").offsetHeight)-1));let{length:r}=i.open.options,l=i.open.selected>-1?i.open.selected+o*(n?1:-1):n?0:r-1;return l<0?l=e=="page"?0:r-1:l>=r&&(l=e=="page"?r-1:0),t.dispatch({effects:vt.of(l)}),!0}}const li=n=>{let e=n.state.field(L,!1);return n.state.readOnly||!e||!e.open||e.open.selected<0||e.open.disabled||Date.now()-e.open.timestamp<n.state.facet(y).interactionDelay?!1:St(n,e.open.options[e.open.selected])},ai=n=>n.state.field(L,!1)?(n.dispatch({effects:We.of(!0)}),!0):!1,ci=n=>{let e=n.state.field(L,!1);return!e||!e.active.some(t=>t.state!=0)?!1:(n.dispatch({effects:Q.of(null)}),!0)};class hi{constructor(e,t){this.active=e,this.context=t,this.time=Date.now(),this.updates=[],this.done=void 0}}const fi=50,ui=1e3,di=ke.fromClass(class{constructor(n){this.view=n,this.debounceUpdate=-1,this.running=[],this.debounceAccept=-1,this.composing=0;for(let e of n.state.field(L).active)e.state==1&&this.startQuery(e)}update(n){let e=n.state.field(L);if(!n.selectionSet&&!n.docChanged&&n.startState.field(L)==e)return;let t=n.transactions.some(i=>(i.selection||i.docChanged)&&!Me(i));for(let i=0;i<this.running.length;i++){let o=this.running[i];if(t||o.updates.length+n.transactions.length>fi&&Date.now()-o.time>ui){for(let s of o.context.abortListeners)try{s()}catch(r){ye(this.view.state,r)}o.context.abortListeners=null,this.running.splice(i--,1)}else o.updates.push(...n.transactions)}if(this.debounceUpdate>-1&&clearTimeout(this.debounceUpdate),this.debounceUpdate=e.active.some(i=>i.state==1&&!this.running.some(o=>o.active.source==i.source))?setTimeout(()=>this.startUpdate(),50):-1,this.composing!=0)for(let i of n.transactions)Me(i)=="input"?this.composing=2:this.composing==2&&i.selection&&(this.composing=3)}startUpdate(){this.debounceUpdate=-1;let{state:n}=this.view,e=n.field(L);for(let t of e.active)t.state==1&&!this.running.some(i=>i.active.source==t.source)&&this.startQuery(t)}startQuery(n){let{state:e}=this.view,t=O(e),i=new xt(e,t,n.explicitPos==t),o=new hi(n,i);this.running.push(o),Promise.resolve(n.source(i)).then(s=>{o.context.aborted||(o.done=s||null,this.scheduleAccept())},s=>{this.view.dispatch({effects:Q.of(null)}),ye(this.view.state,s)})}scheduleAccept(){this.running.every(n=>n.done!==void 0)?this.accept():this.debounceAccept<0&&(this.debounceAccept=setTimeout(()=>this.accept(),this.view.state.facet(y).updateSyncTime))}accept(){var n;this.debounceAccept>-1&&clearTimeout(this.debounceAccept),this.debounceAccept=-1;let e=[],t=this.view.state.facet(y);for(let i=0;i<this.running.length;i++){let o=this.running[i];if(o.done===void 0)continue;if(this.running.splice(i--,1),o.done){let r=new U(o.active.source,o.active.explicitPos,o.done,o.done.from,(n=o.done.to)!==null&&n!==void 0?n:O(o.updates.length?o.updates[0].startState:this.view.state));for(let l of o.updates)r=r.update(l,t);if(r.hasResult()){e.push(r);continue}}let s=this.view.state.field(L).active.find(r=>r.source==o.active.source);if(s&&s.state==1)if(o.done==null){let r=new w(o.active.source,0);for(let l of o.updates)r=r.update(l,t);r.state!=1&&e.push(r)}else this.startQuery(s)}e.length&&this.view.dispatch({effects:Ct.of(e)})}},{eventHandlers:{blur(n){let e=this.view.state.field(L,!1);if(e&&e.tooltip&&this.view.state.facet(y).closeOnBlur){let t=e.open&&rt(this.view,e.open.tooltip);(!t||!t.dom.contains(n.relatedTarget))&&this.view.dispatch({effects:Q.of(null)})}},compositionstart(){this.composing=1},compositionend(){this.composing==3&&setTimeout(()=>this.view.dispatch({effects:We.of(!1)}),20),this.composing=0}}}),pi=b.baseTheme({".cm-tooltip.cm-tooltip-autocomplete":{"& > ul":{fontFamily:"monospace",whiteSpace:"nowrap",overflow:"hidden auto",maxWidth_fallback:"700px",maxWidth:"min(700px, 95vw)",minWidth:"250px",maxHeight:"10em",height:"100%",listStyle:"none",margin:0,padding:0,"& > li, & > completion-section":{padding:"1px 3px",lineHeight:1.2},"& > li":{overflowX:"hidden",textOverflow:"ellipsis",cursor:"pointer"},"& > completion-section":{display:"list-item",borderBottom:"1px solid silver",paddingLeft:"0.5em",opacity:.7}}},"&light .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#17c",color:"white"},"&light .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#777"},"&dark .cm-tooltip-autocomplete ul li[aria-selected]":{background:"#347",color:"white"},"&dark .cm-tooltip-autocomplete-disabled ul li[aria-selected]":{background:"#444"},".cm-completionListIncompleteTop:before, .cm-completionListIncompleteBottom:after":{content:'"···"',opacity:.5,display:"block",textAlign:"center"},".cm-tooltip.cm-completionInfo":{position:"absolute",padding:"3px 9px",width:"max-content",maxWidth:"400px",boxSizing:"border-box"},".cm-completionInfo.cm-completionInfo-left":{right:"100%"},".cm-completionInfo.cm-completionInfo-right":{left:"100%"},".cm-completionInfo.cm-completionInfo-left-narrow":{right:"30px"},".cm-completionInfo.cm-completionInfo-right-narrow":{left:"30px"},"&light .cm-snippetField":{backgroundColor:"#00000022"},"&dark .cm-snippetField":{backgroundColor:"#ffffff22"},".cm-snippetFieldPosition":{verticalAlign:"text-top",width:0,height:"1.15em",display:"inline-block",margin:"0 -0.7px -.7em",borderLeft:"1.4px dotted #888"},".cm-completionMatchedText":{textDecoration:"underline"},".cm-completionDetail":{marginLeft:"0.5em",fontStyle:"italic"},".cm-completionIcon":{fontSize:"90%",width:".8em",display:"inline-block",textAlign:"center",paddingRight:".6em",opacity:"0.6",boxSizing:"content-box"},".cm-completionIcon-function, .cm-completionIcon-method":{"&:after":{content:"'ƒ'"}},".cm-completionIcon-class":{"&:after":{content:"'○'"}},".cm-completionIcon-interface":{"&:after":{content:"'◌'"}},".cm-completionIcon-variable":{"&:after":{content:"'𝑥'"}},".cm-completionIcon-constant":{"&:after":{content:"'𝐶'"}},".cm-completionIcon-type":{"&:after":{content:"'𝑡'"}},".cm-completionIcon-enum":{"&:after":{content:"'∪'"}},".cm-completionIcon-property":{"&:after":{content:"'□'"}},".cm-completionIcon-keyword":{"&:after":{content:"'🔑︎'"}},".cm-completionIcon-namespace":{"&:after":{content:"'▢'"}},".cm-completionIcon-text":{"&:after":{content:"'abc'",fontSize:"50%",verticalAlign:"middle"}}}),G={brackets:["(","[","{","'",'"'],before:")]}:;>",stringPrefixes:[]},W=D.define({map(n,e){let t=e.mapPos(n,-1,Ot.TrackAfter);return t??void 0}}),Be=new class extends Pt{};Be.startSide=1;Be.endSide=-1;const wt=he.define({create(){return Wt.empty},update(n,e){if(n=n.map(e.changes),e.selection){let t=e.state.doc.lineAt(e.selection.main.head);n=n.update({filter:i=>i>=t.from&&i<=t.to})}for(let t of e.effects)t.is(W)&&(n=n.update({add:[Be.range(t.value,t.value+1)]}));return n}});function mi(){return[bi,wt]}const xe="()[]{}<>";function Mt(n){for(let e=0;e<xe.length;e+=2)if(xe.charCodeAt(e)==n)return xe.charAt(e+1);return Ee(n<128?n:n+1)}function kt(n,e){return n.languageDataAt("closeBrackets",e)[0]||G}const gi=typeof navigator=="object"&&/Android\b/.test(navigator.userAgent),bi=b.inputHandler.of((n,e,t,i)=>{if((gi?n.composing:n.compositionStarted)||n.state.readOnly)return!1;let o=n.state.selection.main;if(i.length>2||i.length==2&&R(I(i,0))==1||e!=o.from||t!=o.to)return!1;let s=Ci(n.state,i);return s?(n.dispatch(s),!0):!1}),xi=({state:n,dispatch:e})=>{if(n.readOnly)return!1;let i=kt(n,n.selection.main.head).brackets||G.brackets,o=null,s=n.changeByRange(r=>{if(r.empty){let l=vi(n.doc,r.head);for(let a of i)if(a==l&&fe(n.doc,r.head)==Mt(I(a,0)))return{changes:{from:r.head-a.length,to:r.head+a.length},range:m.cursor(r.head-a.length)}}return{range:o=r}});return o||e(n.update(s,{scrollIntoView:!0,userEvent:"delete.backward"})),!o},yi=[{key:"Backspace",run:xi}];function Ci(n,e){let t=kt(n,n.selection.main.head),i=t.brackets||G.brackets;for(let o of i){let s=Mt(I(o,0));if(e==o)return s==o?Mi(n,o,i.indexOf(o+o+o)>-1,t):Si(n,o,s,t.before||G.before);if(e==s&&Lt(n,n.selection.main.from))return wi(n,o,s)}return null}function Lt(n,e){let t=!1;return n.field(wt).between(0,n.doc.length,i=>{i==e&&(t=!0)}),t}function fe(n,e){let t=n.sliceString(e,e+2);return t.slice(0,R(I(t,0)))}function vi(n,e){let t=n.sliceString(e-2,e);return R(I(t,0))==t.length?t:t.slice(1)}function Si(n,e,t,i){let o=null,s=n.changeByRange(r=>{if(!r.empty)return{changes:[{insert:e,from:r.from},{insert:t,from:r.to}],effects:W.of(r.to+e.length),range:m.range(r.anchor+e.length,r.head+e.length)};let l=fe(n.doc,r.head);return!l||/\s/.test(l)||i.indexOf(l)>-1?{changes:{insert:e+t,from:r.head},effects:W.of(r.head+e.length),range:m.cursor(r.head+e.length)}:{range:o=r}});return o?null:n.update(s,{scrollIntoView:!0,userEvent:"input.type"})}function wi(n,e,t){let i=null,o=n.changeByRange(s=>s.empty&&fe(n.doc,s.head)==t?{changes:{from:s.head,to:s.head+t.length,insert:t},range:m.cursor(s.head+t.length)}:i={range:s});return i?null:n.update(o,{scrollIntoView:!0,userEvent:"input.type"})}function Mi(n,e,t,i){let o=i.stringPrefixes||G.stringPrefixes,s=null,r=n.changeByRange(l=>{if(!l.empty)return{changes:[{insert:e,from:l.from},{insert:e,from:l.to}],effects:W.of(l.to+e.length),range:m.range(l.anchor+e.length,l.head+e.length)};let a=l.head,c=fe(n.doc,a),h;if(c==e){if(tt(n,a))return{changes:{insert:e+e,from:a},effects:W.of(a+e.length),range:m.cursor(a+e.length)};if(Lt(n,a)){let d=t&&n.sliceDoc(a,a+e.length*3)==e+e+e?e+e+e:e;return{changes:{from:a,to:a+d.length,insert:d},range:m.cursor(a+d.length)}}}else{if(t&&n.sliceDoc(a-2*e.length,a)==e+e&&(h=nt(n,a-2*e.length,o))>-1&&tt(n,h))return{changes:{insert:e+e+e+e,from:a},effects:W.of(a+e.length),range:m.cursor(a+e.length)};if(n.charCategorizer(a)(c)!=v.Word&&nt(n,a,o)>-1&&!ki(n,a,e,o))return{changes:{insert:e+e,from:a},effects:W.of(a+e.length),range:m.cursor(a+e.length)}}return{range:s=l}});return s?null:n.update(r,{scrollIntoView:!0,userEvent:"input.type"})}function tt(n,e){let t=De(n).resolveInner(e+1);return t.parent&&t.from==e}function ki(n,e,t,i){let o=De(n).resolveInner(e,-1),s=i.reduce((r,l)=>Math.max(r,l.length),0);for(let r=0;r<5;r++){let l=n.sliceDoc(o.from,Math.min(o.to,o.from+t.length+s)),a=l.indexOf(t);if(!a||a>-1&&i.indexOf(l.slice(0,a))>-1){let h=o.firstChild;for(;h&&h.from==o.from&&h.to-h.from>t.length+a;){if(n.sliceDoc(h.to-t.length,h.to)==t)return!1;h=h.firstChild}return!0}let c=o.to==e&&o.parent;if(!c)break;o=c}return!1}function nt(n,e,t){let i=n.charCategorizer(e);if(i(n.sliceDoc(e-1,e))!=v.Word)return e;for(let o of t){let s=e-o.length;if(n.sliceDoc(s,e)==o&&i(n.sliceDoc(s-1,s))!=v.Word)return s}return-1}function Li(n={}){return[L,y.of(n),di,Ii,pi]}const It=[{key:"Ctrl-Space",run:ai},{key:"Escape",run:ci},{key:"ArrowDown",run:ee(!0)},{key:"ArrowUp",run:ee(!1)},{key:"PageDown",run:ee(!0,"page")},{key:"PageUp",run:ee(!1,"page")},{key:"Enter",run:li}],Ii=it.highest(Ae.computeN([y],n=>n.facet(y).defaultKeymap?[It]:[])),Ei=[Ft(),$t(),qt(),Nt(),Ut(),lt(),Ht(),V.allowMultipleSelections.of(!0),zt(),_(Ce,{fallback:!0}),jt(),mi(),Li(),_t(),Vt(),Kt(),vn(),Ae.of([...yi,...Qt,...Nn,...Gt,...Jt,...It,...Xt])],Di={"Control character":"控制字符","Selection deleted":"删除所选内容","Folded lines":"折叠行","Unfolded lines":"展开行",to:"至","folded code":"折叠的代码",unfold:"展开","Fold line":"折叠行","Unfold line":"展开行","Go to line":"跳转至行",go:"确定",Find:"查找",Replace:"替换",next:"下一个",previous:"上一个",all:"全部","match case":"匹配大小写","by word":"按单词",replace:"替换","replace all":"全部替换",close:"关闭","current match":"当前匹配项","replaced $ matches":"替换了 $ 个匹配项","replaced match on line $":"替换了行 $ 的匹配项","on line":"在行",Completions:"自动完成",Diagnostics:"诊断","No diagnostics":"无诊断信息"},Ai={extensions:[Ei,V.phrases.of(Di),Ae.of([Yt]),lt()]},Ri=en({__name:"EditorMini",props:{inputDefault:{default:""},plugin:{default:void 0},placeholder:{default:""},readonly:{type:Boolean,default:!1}},emits:["change"],setup(n,{expose:e,emit:t}){const i=n,o=t;e({getView:d,setInput:f});const s=tn();let r;const l=new Fe,a=new Fe,c=[Ai.extensions,i.plugin?i.plugin.miniExtensions||i.plugin.extensions:[],b.updateListener.of(h),l.of(de().isDark?ze:b.theme({},{dark:!1})),a.of(de().isDark?_(je,{fallback:!0}):_(Ce))];i.placeholder&&c.push(Zt(i.placeholder)),i.readonly&&c.push(V.readOnly.of(!0)),nn(()=>{r=new b({state:V.create({extensions:c,doc:i.inputDefault}),parent:s.value})}),on(()=>{r==null||r.destroy()}),sn(()=>de().isDark,p=>{r.dispatch({effects:[l.reconfigure(p?ze:b.theme({},{dark:!1})),a.reconfigure(p?_(je,{fallback:!0}):_(Ce))]})});function h(p){p.docChanged&&o("change",p.state.doc.toString())}function f(p){r.dispatch({changes:{from:0,to:r.state.doc.length,insert:p}})}function d(){return r}return(p,C)=>(rn(),ln("div",{ref_key:"editor",ref:s,class:"editor","w-full":""},null,512))}}),Pi=an(Ri,[["__scopeId","data-v-ed07c96e"]]);export{Pi as _};
