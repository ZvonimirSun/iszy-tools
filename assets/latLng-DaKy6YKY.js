import{aW as b,ax as v,k as h,R as k,T as E,E as P,r as x,K as w,F as M,w as $,W as T,bk as V,X as F,x as B,L as I,N as A,Y as D,aA as K,a0 as O}from"./index-BYYPt2FS.js";import{E as S}from"./el-space-DAch0wMf.js";import{e as y,g as N,c as W,b as j,f}from"./mapUtils-Dgu0shD8.js";import{l as u}from"./leaflet-BqppQ0oj.js";async function R(d){const i=await b.get(`${v.apiOrigin}/amap/v3/geocode/geo`,{params:{address:d,key:N}});if(i.data.status==="1"&&Number(i.data.count)>0){const t=i.data.geocodes[0],p=y.gcj02_To_gps84(Number.parseFloat(t.location.split(",")[0]),Number.parseFloat(t.location.split(",")[1]));return{latLng:new u.LatLng(p.lat,p.lng),address:t.formatted_address}}else throw new Error("未找到相关地址。")}async function U(d){const i=y.gps84_To_gcj02(d.lng,d.lat),t=await b.get(`${v.apiOrigin}/amap/v3/geocode/regeo`,{params:{location:`${i.lng},${i.lat}`,output:"json",key:N,homeorcorp:1}});if(t.data.status==="1"&&t.data.regeocode.formatted_address)return t.data.regeocode.formatted_address;throw new Error("未找到相关地址。")}const z=h({__name:"latLng",setup(d){const i=new u.Icon.Default({iconUrl:"marker-icon-yellow.png",iconRetinaUrl:"marker-icon-2x-yellow.png"});let t,p,c;const l=k(""),_=k();E(()=>{t=W({dom:_.value,view:{center:[35,105],zoom:4}}),j(t),p=u.marker(t.getCenter(),{icon:new u.Icon.Default}).addTo(t).bindPopup(g(t.getCenter())).on("popupopen",()=>{c&&c.closePopup()}).openPopup(),t.on("move",()=>{p&&window.requestAnimationFrame(()=>{const e=t.getCenter();p.setLatLng(e),g(e.wrap(),p.getPopup())})}),t.on("click",({latlng:e})=>{e=e.wrap(),l.value=`${e.lng},${e.lat}`,m(e)}),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(e=>{l.value||(l.value=`${e.coords.longitude},${e.coords.latitude}`),t.setView([e.coords.latitude,e.coords.longitude],16)})});function L(){if(!l.value)return;const e=l.value.replace(/，/g,",").split(",");if(e.length===2){const a=Number.parseFloat(e[0].trim()),r=Number.parseFloat(e[1].trim());if(!Number.isNaN(a)&&!Number.isNaN(r)){const o=new u.LatLng(r,a).wrap();l.value=`${o.lng},${o.lat}`,m(o,!0);return}}C(l.value)}function g(e,a,r){a||(a=new u.Popup({autoPan:!1,autoClose:!1,closeOnEscapeKey:!1,closeOnClick:!1}));const o=e.lat,s=e.lng;let n="";return o>=0?n+=`<p>北纬N: ${Math.abs(o)}</p>`:n+=`<p>南纬S: ${Math.abs(o)}</p>`,s>=0?n+=`<p>东经E: ${Math.abs(s)}</p>`:n+=`<p>西经W: ${Math.abs(s)}</p>`,o>=0?n+=`<p>北纬N: ${f(Math.abs(o))}</p>`:n+=`<p>南纬S: ${f(Math.abs(o))}</p>`,s>=0?n+=`<p>东经E: ${f(s)}</p>`:n+=`<p>西经W: ${f(s)}</p>`,r&&(n+=`<p>地址: ${r}</p>`),a.setContent(n),a}function m(e,a,r){if(a&&t.setView(e,16),c?c.setLatLng(e):c=u.marker(e,{icon:i}).on("popupopen",()=>{p&&p.closePopup()}).addTo(t),r)o();else{const s=setTimeout(()=>{o()},500);U(e).then(n=>{clearTimeout(s),r=n,o()})}function o(){const s=g(e,c.getPopup(),r);c.getPopup()||c.bindPopup(s),c.openPopup()}}async function C(e){try{const a=await R(e);m(a.latLng,!0,a.address)}catch(a){K.error(a.message)}}return(e,a)=>{const r=T,o=I,s=S;return x(),P(D,null,[w(s,{size:8,alignment:"center"},{default:$(()=>[w(r,{modelValue:B(l),"onUpdate:modelValue":a[0]||(a[0]=n=>F(l)?l.value=n:null),placeholder:"输入经纬度(如'116.4,36.9')或地址(如'北京市政府')","allow-clear":"",onKeydown:V(L,["enter"])},null,8,["modelValue"]),w(o,{type:"primary",onClick:L},{default:$(()=>a[1]||(a[1]=[A(" 解析 ")])),_:1})]),_:1}),M("div",{ref_key:"mapContainer",ref:_,class:"mapContainer"},null,512)],64)}}}),H=O(z,[["__scopeId","data-v-187fcfd7"]]);export{H as default};
