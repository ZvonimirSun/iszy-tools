import{a5 as $,j as K,b0 as Q,aL as X,x as Y,B as N,k as P,o as f,c as h,b as e,ay as l,W as o,y as t,a as m,t as T,ax as C,F,g as x,aa as g,aA as Z,aE as ee,az as le,b3 as te,b2 as ae,bs as oe,b4 as se,bJ as ne,bv as de,bw as ue,aG as re,aH as ie,a3 as pe}from"./vendor-Ru-BxWlB.js";import{c as fe}from"./ant-design-vue-1fGE3reg.js";import{u as me}from"./common-br7fSpCF.js";import"./vanilla-jsoneditor-_koh3yF9.js";const ce=$("main",{persist:!0,state:()=>({_cache:{},clearOfflineCacheTag:!1}),getters:{getData:p=>c=>{if(c)return(p._cache||{})[c]}},actions:{setData({key:p,val:c}={}){p&&(this._cache=this._cache||{},this._cache[p]=c)},clear(){this._cache={}},clearOfflineCache(){console.log("clearOfflineCache"),this.clearOfflineCacheTag=!0}}}),I=p=>(re("data-v-6bd85f5f"),p=p(),ie(),p),_e={key:0,flex:"","flex-col":"","text-7":"","gap-4":"","items-start":""},we={flex:""},ge=I(()=>m("div",{"w-32":""}," 昵称: ",-1)),Ve={flex:""},ye=I(()=>m("div",{"w-32":""}," 邮箱: ",-1)),ve={flex:"","text-7":"","gap-4":"","items-start":"","flex-wrap":"",class:"settings-container"},ke={key:0,class:"settings-wrapper"},he={class:"settings-wrapper"},be={key:1,class:"settings-wrapper"},Ce=K({__name:"settings",setup(p){const c=Q(),O=X(),u=me(),r=Y(()=>u.settings),V=N(!1),S=N(),s=P({nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),R=P({rePasswd:[{validator:(y,a,d)=>{a&&a!==s.passwd?d(new Error("两次输入的密码不一致")):d()}}],oldPasswd:[{validator:(y,a,d)=>{!a&&(s.passwd||s.rePasswd)?d(new Error("请输入旧密码")):d()}}]}),U=()=>ce().clearOfflineCache(),B=()=>u.uploadSettings(),j=()=>u.downloadSettings();async function D(){await B()?g.success("同步成功"):g.error("同步失败")}async function M(){await j()?g.success("同步成功"):g.error("同步失败")}function G(){c.push({path:"/login",query:{redirect:O.fullPath}})}function J(){c.push("/logout")}function q(){s.nickName=u._user.profile.nickName??"",s.email=u._user.profile.email??"",s.passwd="",s.rePasswd="",s.oldPasswd="",V.value=!0}function z(){V.value=!1}async function A(y){y&&await y.validate(async a=>{if(a){const d={};if(s.nickName&&(d.nickName=s.nickName),s.email&&(d.email=s.email),s.passwd&&(d.passwd=s.passwd,d.oldPasswd=s.oldPasswd),Object.keys(d).length===0){g.warning("没有需要修改的信息");return}try{await u.updateUser(d)}catch(i){g.error(i.message)}V.value=!1}else return g.warning("请检查输入"),!1})}return(y,a)=>{const d=fe,i=Z,_=ee,v=le,k=te,H=ae,E=oe,L=se,w=ne,b=de,W=ue;return f(),h(F,null,[e(d,{level:3},{default:l(()=>[o(" 账户信息 ")]),_:1}),t(u)._user.token?(f(),h("div",_e,[m("div",we,[ge,m("div",null,T(t(u)._user.profile.nickName),1)]),m("div",Ve,[ye,m("div",null,T(t(u)._user.profile.email),1)]),e(_,null,{default:l(()=>[e(i,{type:"primary",onClick:J},{default:l(()=>[o(" 登出 ")]),_:1}),t(V)?(f(),h(F,{key:1},[e(i,{type:"primary",onClick:a[0]||(a[0]=n=>A(t(S)))},{default:l(()=>[o(" 保存 ")]),_:1}),e(i,{onClick:z},{default:l(()=>[o(" 取消 ")]),_:1})],64)):(f(),C(i,{key:0,onClick:q},{default:l(()=>[o(" 修改信息 ")]),_:1}))]),_:1}),t(V)?(f(),C(H,{key:0,ref_key:"ruleFormRef",ref:S,model:t(s),rules:t(R),"label-width":"8rem","label-position":"left"},{default:l(()=>[e(k,{label:"昵称",prop:"nickName"},{default:l(()=>[e(v,{modelValue:t(s).nickName,"onUpdate:modelValue":a[1]||(a[1]=n=>t(s).nickName=n)},null,8,["modelValue"])]),_:1}),e(k,{label:"邮箱",prop:"email"},{default:l(()=>[e(v,{modelValue:t(s).email,"onUpdate:modelValue":a[2]||(a[2]=n=>t(s).email=n)},null,8,["modelValue"])]),_:1}),e(k,{label:"旧密码",prop:"oldPasswd"},{default:l(()=>[e(v,{modelValue:t(s).oldPasswd,"onUpdate:modelValue":a[3]||(a[3]=n=>t(s).oldPasswd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(k,{label:"新密码",prop:"passwd"},{default:l(()=>[e(v,{modelValue:t(s).passwd,"onUpdate:modelValue":a[4]||(a[4]=n=>t(s).passwd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(k,{label:"确认密码",prop:"rePasswd"},{default:l(()=>[e(v,{modelValue:t(s).rePasswd,"onUpdate:modelValue":a[5]||(a[5]=n=>t(s).rePasswd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])):x("",!0),e(E,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:U},{reference:l(()=>[e(i,{type:"danger",plain:""},{default:l(()=>[o(" 清空本地缓存 ")]),_:1})]),_:1})])):(f(),C(_,{key:1},{default:l(()=>[e(i,{type:"primary",onClick:G},{default:l(()=>[o(" 登录 ")]),_:1}),e(E,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:U},{reference:l(()=>[e(i,{type:"danger",plain:""},{default:l(()=>[o(" 清空本地缓存 ")]),_:1})]),_:1})]),_:1})),e(L),m("div",ve,[t(u)._user.token?(f(),h("div",ke,[e(d,{level:4},{default:l(()=>[o(" 设置云端同步 ")]),_:1}),e(_,null,{default:l(()=>[e(i,{onClick:D},{default:l(()=>[o(" 同步到云端 ")]),_:1}),e(i,{onClick:M},{default:l(()=>[o(" 从云端同步 ")]),_:1}),e(w,{modelValue:t(r).autoSync,"onUpdate:modelValue":a[6]||(a[6]=n=>t(r).autoSync=n)},{default:l(()=>[o(" 自动同步 ")]),_:1},8,["modelValue"])]),_:1})])):x("",!0),m("div",he,[e(d,{level:4},{default:l(()=>[o(" 全局设置 ")]),_:1}),e(d,{level:5},{default:l(()=>[o(" 外观 ")]),_:1}),e(_,null,{default:l(()=>[e(W,{"model-value":t(r).theme.mode,onChange:t(u).setTheme},{default:l(()=>[e(b,{label:"auto"},{default:l(()=>[o(" 跟随系统 ")]),_:1}),e(b,{label:"light"},{default:l(()=>[o(" 浅色 ")]),_:1}),e(b,{label:"dark"},{default:l(()=>[o(" 深色 ")]),_:1})]),_:1},8,["model-value","onChange"])]),_:1}),e(d,{level:5},{default:l(()=>[o(" 访问统计 ")]),_:1}),e(_,null,{default:l(()=>[e(w,{modelValue:t(r).showMost,"onUpdate:modelValue":a[7]||(a[7]=n=>t(r).showMost=n)},{default:l(()=>[o(" 最常访问 ")]),_:1},8,["modelValue"]),e(w,{modelValue:t(r).showRecent,"onUpdate:modelValue":a[8]||(a[8]=n=>t(r).showRecent=n)},{default:l(()=>[o(" 最近访问 ")]),_:1},8,["modelValue"])]),_:1}),e(d,{level:5},{default:l(()=>[o(" 其他设置 ")]),_:1}),e(_,null,{default:l(()=>[e(w,{modelValue:t(r).showSearch,"onUpdate:modelValue":a[9]||(a[9]=n=>t(r).showSearch=n)},{default:l(()=>[o(" 显示搜索 ")]),_:1},8,["modelValue"]),e(w,{modelValue:t(r).showType,"onUpdate:modelValue":a[10]||(a[10]=n=>t(r).showType=n)},{default:l(()=>[o(" 显示分类 ")]),_:1},8,["modelValue"]),e(w,{modelValue:t(r).openInNewTab,"onUpdate:modelValue":a[11]||(a[11]=n=>t(r).openInNewTab=n)},{default:l(()=>[o(" 新标签页打开工具 ")]),_:1},8,["modelValue"])]),_:1})]),t(u)._user.token?(f(),h("div",be,[e(d,{level:4},{default:l(()=>[o(" 应用设置 ")]),_:1}),e(d,{level:5},{default:l(()=>[o(" JSON 编辑器 ")]),_:1}),e(_,null,{default:l(()=>[e(w,{modelValue:t(u).modules.jsonEditor.syncCloud,"onUpdate:modelValue":a[12]||(a[12]=n=>t(u).modules.jsonEditor.syncCloud=n)},{default:l(()=>[o(" 从云端获取 ")]),_:1},8,["modelValue"])]),_:1})])):x("",!0)])],64)}}}),Ne=pe(Ce,[["__scopeId","data-v-6bd85f5f"]]);export{Ne as default};
