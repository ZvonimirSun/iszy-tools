import{ac as M,L as he,j as pe,k as fe,o as F,c as q,y as D,F as z,a as W,e as de,t as Q,b as w,ay as k,W as X,g as me,aa as ye,a6 as ge,aA as ve,b4 as _e,az as be,b3 as Se,ba as Te,bb as Ae,b2 as xe,a3 as we}from"./vendor-Ru-BxWlB.js";import{L as R,l as p,E as $}from"./common-K04dNQ2-.js";import{U as E,S as Ee,e as Z}from"./@supermap/iclient-common-QVgkMiQv.js";import{r as Ie,t as Ue}from"./geoJson-YQEhBVoc.js";import{p as C,s as re,_ as Oe,a as Y,r as ne,g as V,m as se,w as oe,R as ae,i as Re,F as J}from"./esri-leaflet-ntyIYjB6.js";import"./ant-design-vue-MAwBXcQi.js";import"./vanilla-jsoneditor-_koh3yF9.js";(function(t,e){(function(i,r){r()})(M,function(){function i(o){var u=this.constructor;return this.then(function(s){return u.resolve(o()).then(function(){return s})},function(s){return u.resolve(o()).then(function(){return u.reject(s)})})}function r(o){var u=this;return new u(function(s,a){if(!(o&&typeof o.length<"u"))return a(new TypeError(typeof o+" "+o+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var d=Array.prototype.slice.call(o);if(d.length===0)return s([]);var T=d.length;function _(A,x){if(x&&(typeof x=="object"||typeof x=="function")){var P=x.then;if(typeof P=="function"){P.call(x,function(O){_(A,O)},function(O){d[A]={status:"rejected",reason:O},--T===0&&s(d)});return}}d[A]={status:"fulfilled",value:x},--T===0&&s(d)}for(var y=0;y<d.length;y++)_(y,d[y])})}var n=setTimeout;function l(o){return!!(o&&typeof o.length<"u")}function h(){}function f(o,u){return function(){o.apply(u,arguments)}}function c(o){if(!(this instanceof c))throw new TypeError("Promises must be constructed via new");if(typeof o!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],I(o,this)}function g(o,u){for(;o._state===3;)o=o._value;if(o._state===0){o._deferreds.push(u);return}o._handled=!0,c._immediateFn(function(){var s=o._state===1?u.onFulfilled:u.onRejected;if(s===null){(o._state===1?m:b)(u.promise,o._value);return}var a;try{a=s(o._value)}catch(d){b(u.promise,d);return}m(u.promise,a)})}function m(o,u){try{if(u===o)throw new TypeError("A promise cannot be resolved with itself.");if(u&&(typeof u=="object"||typeof u=="function")){var s=u.then;if(u instanceof c){o._state=3,o._value=u,L(o);return}else if(typeof s=="function"){I(f(s,u),o);return}}o._state=1,o._value=u,L(o)}catch(a){b(o,a)}}function b(o,u){o._state=2,o._value=u,L(o)}function L(o){o._state===2&&o._deferreds.length===0&&c._immediateFn(function(){o._handled||c._unhandledRejectionFn(o._value)});for(var u=0,s=o._deferreds.length;u<s;u++)g(o,o._deferreds[u]);o._deferreds=null}function v(o,u,s){this.onFulfilled=typeof o=="function"?o:null,this.onRejected=typeof u=="function"?u:null,this.promise=s}function I(o,u){var s=!1;try{o(function(a){s||(s=!0,m(u,a))},function(a){s||(s=!0,b(u,a))})}catch(a){if(s)return;s=!0,b(u,a)}}c.prototype.catch=function(o){return this.then(null,o)},c.prototype.then=function(o,u){var s=new this.constructor(h);return g(this,new v(o,u,s)),s},c.prototype.finally=i,c.all=function(o){return new c(function(u,s){if(!l(o))return s(new TypeError("Promise.all accepts an array"));var a=Array.prototype.slice.call(o);if(a.length===0)return u([]);var d=a.length;function T(y,A){try{if(A&&(typeof A=="object"||typeof A=="function")){var x=A.then;if(typeof x=="function"){x.call(A,function(P){T(y,P)},s);return}}a[y]=A,--d===0&&u(a)}catch(P){s(P)}}for(var _=0;_<a.length;_++)T(_,a[_])})},c.allSettled=r,c.resolve=function(o){return o&&typeof o=="object"&&o.constructor===c?o:new c(function(u){u(o)})},c.reject=function(o){return new c(function(u,s){s(o)})},c.race=function(o){return new c(function(u,s){if(!l(o))return s(new TypeError("Promise.race accepts an array"));for(var a=0,d=o.length;a<d;a++)c.resolve(o[a]).then(u,s)})},c._immediateFn=typeof setImmediate=="function"&&function(o){setImmediate(o)}||function(o){n(o,0)},c._unhandledRejectionFn=function(u){typeof console<"u"&&console&&console.warn("Possible Unhandled Promise Rejection:",u)};var U=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof M<"u")return M;throw new Error("unable to locate global object")}();typeof U.Promise!="function"?U.Promise=c:(U.Promise.prototype.finally||(U.Promise.prototype.finally=i),U.Promise.allSettled||(U.Promise.allSettled=r))})})();var Le={exports:{}};(function(t){(function(e){if(!e.__disableNativeFetch&&e.fetch)return;function i(s){if(typeof s!="string"&&(s=String(s)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(s))throw new TypeError("Invalid character in header field name");return s.toLowerCase()}function r(s){return typeof s!="string"&&(s=String(s)),s}function n(s){this.map={},s instanceof n?s.forEach(function(a,d){this.append(d,a)},this):s&&Object.getOwnPropertyNames(s).forEach(function(a){this.append(a,s[a])},this)}n.prototype.append=function(s,a){s=i(s),a=r(a);var d=this.map[s];d||(d=[],this.map[s]=d),d.push(a)},n.prototype.delete=function(s){delete this.map[i(s)]},n.prototype.get=function(s){var a=this.map[i(s)];return a?a[0]:null},n.prototype.getAll=function(s){return this.map[i(s)]||[]},n.prototype.has=function(s){return this.map.hasOwnProperty(i(s))},n.prototype.set=function(s,a){this.map[i(s)]=[r(a)]},n.prototype.forEach=function(s,a){Object.getOwnPropertyNames(this.map).forEach(function(d){this.map[d].forEach(function(T){s.call(a,T,d,this)},this)},this)};function l(s){if(s.bodyUsed)return Promise.reject(new TypeError("Already read"));s.bodyUsed=!0}function h(s){return new Promise(function(a,d){s.onload=function(){a(s.result)},s.onerror=function(){d(s.error)}})}function f(s){var a=new FileReader;return a.readAsArrayBuffer(s),h(a)}function c(s,a){var d=new FileReader,T=a.headers.map["content-type"]?a.headers.map["content-type"].toString():"",_=/charset\=[0-9a-zA-Z\-\_]*;?/,y=s.type.match(_)||T.match(_),A=[s];return y&&A.push(y[0].replace(/^charset\=/,"").replace(/;$/,"")),d.readAsText.apply(d,A),h(d)}var g={blob:"FileReader"in e&&"Blob"in e&&function(){try{return new Blob,!0}catch{return!1}}(),formData:"FormData"in e,arrayBuffer:"ArrayBuffer"in e};function m(){return this.bodyUsed=!1,this._initBody=function(s,a){if(this._bodyInit=s,typeof s=="string")this._bodyText=s;else if(g.blob&&Blob.prototype.isPrototypeOf(s))this._bodyBlob=s,this._options=a;else if(g.formData&&FormData.prototype.isPrototypeOf(s))this._bodyFormData=s;else if(!s)this._bodyText="";else if(!(g.arrayBuffer&&ArrayBuffer.prototype.isPrototypeOf(s)))throw new Error("unsupported BodyInit type")},g.blob?(this.blob=function(){var s=l(this);if(s)return s;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(f)},this.text=function(){var s=l(this);if(s)return s;if(this._bodyBlob)return c(this._bodyBlob,this._options);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var s=l(this);return s||Promise.resolve(this._bodyText)},g.formData&&(this.formData=function(){return this.text().then(I)}),this.json=function(){return this.text().then(JSON.parse)},this}var b=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function L(s){var a=s.toUpperCase();return b.indexOf(a)>-1?a:s}function v(s,a){a=a||{};var d=a.body;if(v.prototype.isPrototypeOf(s)){if(s.bodyUsed)throw new TypeError("Already read");this.url=s.url,this.credentials=s.credentials,a.headers||(this.headers=new n(s.headers)),this.method=s.method,this.mode=s.mode,d||(d=s._bodyInit,s.bodyUsed=!0)}else this.url=s;if(this.credentials=a.credentials||this.credentials||"omit",(a.headers||!this.headers)&&(this.headers=new n(a.headers)),this.method=L(a.method||this.method||"GET"),this.mode=a.mode||this.mode||null,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&d)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(d,a)}v.prototype.clone=function(){return new v(this)};function I(s){var a=new FormData;return s.trim().split("&").forEach(function(d){if(d){var T=d.split("="),_=T.shift().replace(/\+/g," "),y=T.join("=").replace(/\+/g," ");a.append(decodeURIComponent(_),decodeURIComponent(y))}}),a}function U(s){var a=new n,d=s.getAllResponseHeaders().trim().split(`
`);return d.forEach(function(T){var _=T.trim().split(":"),y=_.shift().trim(),A=_.join(":").trim();a.append(y,A)}),a}m.call(v.prototype);function o(s,a){a||(a={}),this._initBody(s,a),this.type="default",this.status=a.status,this.ok=this.status>=200&&this.status<300,this.statusText=a.statusText,this.headers=a.headers instanceof n?a.headers:new n(a.headers),this.url=a.url||""}m.call(o.prototype),o.prototype.clone=function(){return new o(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},o.error=function(){var s=new o(null,{status:0,statusText:""});return s.type="error",s};var u=[301,302,303,307,308];o.redirect=function(s,a){if(u.indexOf(a)===-1)throw new RangeError("Invalid status code");return new o(null,{status:a,headers:{location:s}})},e.Headers=n,e.Request=v,e.Response=o,e.fetch=function(s,a){return new Promise(function(d,T){var _;v.prototype.isPrototypeOf(s)&&!a?_=s:_=new v(s,a);var y=new XMLHttpRequest;function A(){if("responseURL"in y)return y.responseURL;if(/^X-Request-URL:/m.test(y.getAllResponseHeaders()))return y.getResponseHeader("X-Request-URL")}var x=!1;function P(){if(y.readyState===4){var O=y.status===1223?204:y.status;if(O<100||O>599){if(x)return;x=!0,T(new TypeError("Network request failed"));return}var j={status:O,statusText:y.statusText,headers:U(y),url:A()},ce="response"in y?y.response:y.responseText;x||(x=!0,d(new o(ce,j)))}}y.onreadystatechange=P,y.onload=P,y.onerror=function(){x||(x=!0,T(new TypeError("Network request failed")))},y.open(_.method,_.url,!0);try{_.credentials==="include"&&("withCredentials"in y?y.withCredentials=!0:console&&console.warn&&console.warn("withCredentials is not supported, you can ignore this warning"))}catch(O){console&&console.warn&&console.warn("set withCredentials error:"+O)}"responseType"in y&&g.blob&&(y.responseType="blob"),_.headers.forEach(function(O,j){y.setRequestHeader(j,O)}),y.send(typeof _._bodyInit>"u"?null:_._bodyInit)})},e.fetch.polyfill=!0,t.exports&&(t.exports=e.fetch)})(typeof self<"u"?self:M)})(Le);var H={exports:{}};(function(t,e){(function(i,r){r(e,t)})(M,function(i,r){var n={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function l(){return"jsonp_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function h(g){try{delete window[g]}catch{window[g]=void 0}}function f(g){var m=document.getElementById(g);m&&document.getElementsByTagName("head")[0].removeChild(m)}function c(g){var m=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],b=g,L=m.timeout||n.timeout,v=m.jsonpCallback||n.jsonpCallback,I=void 0;return new Promise(function(U,o){var u=m.jsonpCallbackFunction||l(),s=v+"_"+u;window[u]=function(d){U({ok:!0,json:function(){return Promise.resolve(d)}}),I&&clearTimeout(I),f(s),h(u)},b+=b.indexOf("?")===-1?"?":"&";var a=document.createElement("script");a.setAttribute("src",""+b+v+"="+u),m.charset&&a.setAttribute("charset",m.charset),a.id=s,document.getElementsByTagName("head")[0].appendChild(a),I=setTimeout(function(){o(new Error("JSONP request to "+g+" timed out")),h(u),f(s),window[u]=function(){h(u)}},L),a.onerror=function(){o(new Error("JSONP request to "+g+" failed")),h(u),f(s),I&&clearTimeout(I)}})}r.exports=c})})(H,H.exports);var Pe=H.exports;const le=he(Pe);let ee=window.fetch;var B={limitLength:1500,queryKeys:[],queryValues:[],supermap_callbacks:{},addQueryStrings:function(t){var e=this;for(var i in t){e.queryKeys.push(i),typeof t[i]!="string"&&(t[i]=E.toJSON(t[i]));var r=encodeURIComponent(t[i]);e.queryValues.push(r)}},issue:function(t){for(var e=this,i=e.getUid(),r=t.url,n=[],l=r,h=0,f=e.queryKeys?e.queryKeys.length:0,c=0;c<f;c++)if(l.length+e.queryKeys[c].length+2>=e.limitLength){if(h==0)return!1;n.push(l),l=r,h=0,c--}else if(l.length+e.queryKeys[c].length+2+e.queryValues[c].length>e.limitLength)for(var g=e.queryValues[c];g.length>0;){var m=e.limitLength-l.length-e.queryKeys[c].length-2;l.indexOf("?")>-1?l+="&":l+="?";var b=g.substring(0,m);b.substring(m-1,m)==="%"?(m-=1,b=g.substring(0,m)):b.substring(m-2,m-1)==="%"&&(m-=2,b=g.substring(0,m)),l+=e.queryKeys[c]+"="+b,g=g.substring(m),b.length>0&&(n.push(l),l=r,h=0)}else h++,l.indexOf("?")>-1?l+="&":l+="?",l+=e.queryKeys[c]+"="+e.queryValues[c];return n.push(l),e.send(n,"SuperMapJSONPCallbacks_"+i,t&&t.proxy)},getUid:function(){var t=new Date().getTime(),e=Math.floor(Math.random()*1e17);return t*1e3+e},send:function(t,e,i){var r=t.length;if(r>0)return new Promise(n=>{for(var l=new Date().getTime(),h=0;h<r;h++){var f=t[h];f.indexOf("?")>-1?f+="&":f+="?",f+="sectionCount="+r,f+="&sectionIndex="+h,f+="&jsonpUserID="+l,i&&(f=decodeURIComponent(f),f=i+encodeURIComponent(f)),le(f,{jsonpCallbackFunction:e,timeout:3e4}).then(c=>{n(c.json())})}})},GET:function(t){var e=this;return e.queryKeys.length=0,e.queryValues.length=0,e.addQueryStrings(t.params),e.issue(t)},POST:function(t){var e=this;return e.queryKeys.length=0,e.queryValues.length=0,e.addQueryStrings({requestEntity:t.data}),e.issue(t)},PUT:function(t){var e=this;return e.queryKeys.length=0,e.queryValues.length=0,e.addQueryStrings({requestEntity:t.data}),e.issue(t)},DELETE:function(t){var e=this;return e.queryKeys.length=0,e.queryValues.length=0,e.addQueryStrings({requestEntity:t.data}),e.issue(t)}},De=function(){return window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest},te=function(){return 45e3},G={commit:function(t,e,i,r){switch(t=t&&t.toUpperCase(),t){case"GET":return this.get(e,i,r);case"POST":return this.post(e,i,r);case"PUT":return this.put(e,i,r);case"DELETE":return this.delete(e,i,r);default:return this.get(e,i,r)}},supportDirectRequest:function(t,e){return E.isInTheSameDomain(t)?!0:e.crossOrigin!=null?e.crossOrigin:De()||e.proxy},get:function(t,e,i){i=i||{};var r="GET";if(t=E.urlAppend(t,this._getParameterString(e||{})),t=this._processUrl(t,i),!this.supportDirectRequest(t,i)){t=t.replace(".json",".jsonp");var n={url:t,data:e};return B.GET(n)}return this.urlIsLong(t)?this._postSimulatie(r,t.substring(0,t.indexOf("?")),e,i):this._fetch(t,e,i,r)},delete:function(t,e,i){i=i||{};var r="DELETE";if(t=E.urlAppend(t,this._getParameterString(e||{})),t=this._processUrl(t,i),!this.supportDirectRequest(t,i)){t=t.replace(".json",".jsonp");var n={url:t+="&_method=DELETE",data:e};return B.DELETE(n)}return this.urlIsLong(t)?this._postSimulatie(r,t.substring(0,t.indexOf("?")),e,i):this._fetch(t,e,i,r)},post:function(t,e,i){if(i=i||{},t=this._processUrl(t,i),!this.supportDirectRequest(t,i)){t=t.replace(".json",".jsonp");var r={url:E.urlAppend(t,"_method=POST"),data:e};return B.POST(r)}return this._fetch(t,e,i,"POST")},put:function(t,e,i){if(i=i||{},t=this._processUrl(t,i),!this.supportDirectRequest(t,i)){t=t.replace(".json",".jsonp");var r={url:t+="&_method=PUT",data:e};return B.PUT(r)}return this._fetch(t,e,i,"PUT")},urlIsLong:function(t){for(var e=0,i=null,r=0,n=t.length;r<n;r++)i=t.charCodeAt(r),i<127?e++:128<=i&&i<=2047?e+=2:2048<=i&&i<=65535&&(e+=3);return!(e<2e3)},_postSimulatie:function(t,e,i,r){var n=e.indexOf("?")>-1?"&":"?";return e+=n+"_method="+t,typeof i!="string"&&(i=JSON.stringify(i)),this.post(e,i,r)},_processUrl:function(t,e){if(this._isMVTRequest(t))return t;if(t.indexOf(".json")===-1&&!e.withoutFormatSuffix)if(t.indexOf("?")<0)t+=".json";else{var i=t.split("?");i.length===2&&(t=i[0]+".json?"+i[1])}return e&&e.proxy&&(typeof e.proxy=="function"?t=e.proxy(t):(t=decodeURIComponent(t),t=e.proxy+encodeURIComponent(t))),t},_fetch:function(t,e,i,r){return i=i||{},i.headers=i.headers||{},!i.headers["Content-Type"]&&!FormData.prototype.isPrototypeOf(e)&&(i.headers["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8"),i.timeout?this._timeout(i.timeout,ee(t,{method:r,headers:i.headers,body:r==="PUT"||r==="POST"?e:void 0,credentials:this._getWithCredentials(i),mode:"cors",timeout:te()}).then(function(n){return n})):ee(t,{method:r,body:r==="PUT"||r==="POST"?e:void 0,headers:i.headers,credentials:this._getWithCredentials(i),mode:"cors",timeout:te()}).then(function(n){return n})},_getWithCredentials:function(t){return t.withCredentials===!0?"include":t.withCredentials===!1?"omit":"same-origin"},_fetchJsonp:function(t,e){return e=e||{},le(t,{method:"GET",timeout:e.timeout}).then(function(i){return i})},_timeout:function(t,e){return new Promise(function(i,r){setTimeout(function(){r(new Error("timeout"))},t),e.then(i,r)})},_getParameterString:function(t){var e=[];for(var i in t){var r=t[i];if(r!=null&&typeof r!="function"){var n;Array.isArray(r)||r.toString()==="[object Object]"?n=encodeURIComponent(JSON.stringify(r)):n=encodeURIComponent(r),e.push(encodeURIComponent(i)+"="+n)}}return e.join("&")},_isMVTRequest:function(t){return t.indexOf(".mvt")>-1||t.indexOf(".pbf")>-1}};class K{constructor(e,i){this.value=e||"",this.name=i||"token",this.CLASS_NAME="SuperMap.Credential"}getUrlParameters(){return this.name+"="+this.value}getValue(){return this.value}destroy(){this.value=null,this.name=null}}K.CREDENTIAL=null;class N{static generateToken(e,i){var r=this.servers[e];if(r)return G.post(r.tokenServiceUrl,JSON.stringify(i.toJSON())).then(function(n){return n.text()})}static registerServers(e){this.servers=this.servers||{},E.isArray(e)||(e=[e]);for(var i=0;i<e.length;i++){var r=e[i];this.servers[r.server]=r}}static registerToken(e,i){if(this.tokens=this.tokens||{},!(!e||!i)){var r=this._getTokenStorageKey(e);this.tokens[r]=i}}static registerKey(e,i){if(this.keys=this.keys||{},!(!e||e.length<1||!i)){e=E.isArray(e)?e:[e];for(var r=0;r<e.length;r++){var n=this._getUrlRestString(e[0])||e[0];this.keys[n]=i}}}static getServerInfo(e){return this.servers=this.servers||{},this.servers[e]}static getToken(e){if(e){this.tokens=this.tokens||{};var i=this._getTokenStorageKey(e);return this.tokens[i]}}static getKey(e){this.keys=this.keys||{};var i=this._getUrlRestString(e)||e;return this.keys[i]}static loginiServer(e,i,r,n){e=E.urlPathAppend(e,"services/security/login");var l={username:i&&i.toString(),password:r&&r.toString(),rememberme:n};l=JSON.stringify(l);var h={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}};return G.post(e,l,h).then(function(f){return f.json()})}static logoutiServer(e){e=E.urlPathAppend(e,"services/security/logout");var i={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withoutFormatSuffix:!0};return G.get(e,"",i).then(function(){return!0}).catch(function(){return!1})}static loginOnline(e,i){var r=N.SSO+"/login?service="+e;this._open(r,i)}static loginiPortal(e,i,r){e=E.urlPathAppend(e,"web/login");var n={username:i&&i.toString(),password:r&&r.toString()};n=JSON.stringify(n);var l={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!1};return G.post(e,n,l).then(function(h){return h.json()})}static logoutiPortal(e){e=E.urlPathAppend(e,"services/security/logout");var i={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!0,withoutFormatSuffix:!0};return G.get(e,"",i).then(function(){return!0}).catch(function(){return!1})}static loginManager(e,i){var r=E.urlPathAppend(e,"/security/tokens"),n=i||{},l={username:n.userName&&n.userName.toString(),password:n.password&&n.password.toString()};l=JSON.stringify(l);var h={headers:{Accept:"*/*","Content-Type":"application/json; charset=UTF-8"}},f=this;return G.post(r,l,h).then(function(c){return c.text()}).then(function(c){return f.imanagerToken=c,c})}static destroyAllCredentials(){this.keys=null,this.tokens=null,this.servers=null}static destroyToken(e){if(e){var i=this._getTokenStorageKey(e);this.tokens=this.tokens||{},this.tokens[i]&&delete this.tokens[i]}}static destroyKey(e){if(e){this.keys=this.keys||{};var i=this._getUrlRestString(e)||e;this.keys[i]&&delete this.keys[i]}}static appendCredential(e){var i=e,r=this.getToken(e),n=r?new K(r,"token"):null;return n||(r=this.getKey(e),n=r?new K(r,"key"):null),n&&(i=E.urlAppend(i,n.getUrlParameters())),i}static _open(e,i){i=i??!0;var r=window.screen.availWidth/2-this.INNER_WINDOW_WIDTH/2,n=window.screen.availHeight/2-this.INNER_WINDOW_HEIGHT/2,l="height="+this.INNER_WINDOW_HEIGHT+", width="+this.INNER_WINDOW_WIDTH+",top="+n+", left="+r+",toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no";i?window.open(e,"login"):window.open(e,"login",l)}static _getTokenStorageKey(e){var i=/(.*?):\/\/([^\/]+)/i,r=e.match(i);return r?r[0]:e}static _getUrlRestString(e){if(!e)return e;var i=/(http|https):\/\/(.*\/rest)/i,r=e.match(i);return r?r[0]:e}}N.INNER_WINDOW_WIDTH=600;N.INNER_WINDOW_HEIGHT=600;N.SSO="https://sso.supermap.com";N.ONLINE="https://www.supermapol.com";const ke=R.TileLayer.extend({options:{layersID:null,redirect:!1,transparent:!0,cacheEnabled:!0,clipRegionEnabled:!1,clipRegion:null,prjCoordSys:null,overlapDisplayed:!1,overlapDisplayedOptions:null,tileversion:null,crs:null,format:"png",tileProxy:null,attribution:"Map Data <span>© <a href='http://support.supermap.com.cn/product/iServer.aspx' title='SuperMap iServer' target='_blank'>SuperMap iServer</a></span>",subdomains:null},initialize:function(t,e){this._url=t,R.TileLayer.prototype.initialize.apply(this,arguments),R.setOptions(this,e),R.stamp(this),this.tileSetsIndex=-1,this.tempIndex=-1},onAdd:function(t){this._crs=this.options.crs||t.options.crs,R.TileLayer.prototype.onAdd.call(this,t)},getTileUrl:function(t){const e=this.getScaleFromCoords(t);let r=this._getLayerUrl()+"&scale="+e+"&x="+t.x+"&y="+t.y;return this.options.tileProxy&&(r=this.options.tileProxy+encodeURIComponent(r)),this.options.cacheEnabled||(r+="&_t="+new Date().getTime()),this.options.subdomains&&(r=R.Util.template(r,{s:this._getSubdomain(t)})),r},getScale:function(t){const e=this,i=t||e._map.getZoom();return e.scales[i]},getScaleFromCoords:function(t){const e=this;if(e.scales&&e.scales[t.z])return e.scales[t.z];e.scales=e.scales||{};const i=e.getDefaultScale(t);return e.scales[t.z]=i,i},getDefaultScale:function(t){const e=this,i=e._crs;if(i.scales)return i.scales[t.z];{const r=e._tileCoordsToBounds(t),n=i.project(r.getNorthEast()),l=i.project(r.getSouthWest()),h=e.options.tileSize,f=Math.max(Math.abs(n.x-l.x)/h,Math.abs(n.y-l.y)/h);let c=Z.METER;if(i.code){const g=i.code.split(":");if(g&&g.length>1){const m=parseInt(g[1]);c=m&&m>=4e3&&m<=5e3?Z.DEGREE:Z.METER}}return Ie(f,96,c)}},setTileSetsInfo:function(t){this.tileSets=t,R.Util.isArray(this.tileSets)&&(this.tileSets=this.tileSets[0]),this.tileSets&&(this.fire("tilesetsinfoloaded",{tileVersions:this.tileSets.tileVersions}),this.changeTilesVersion())},lastTilesVersion:function(){this.tempIndex=this.tileSetsIndex-1,this.changeTilesVersion()},nextTilesVersion:function(){this.tempIndex=this.tileSetsIndex+1,this.changeTilesVersion()},changeTilesVersion:function(){const t=this;if(t.tileSets==null||t.tempIndex===t.tileSetsIndex||this.tempIndex<0)return;const e=t.tileSets.tileVersions;if(e&&t.tempIndex<e.length&&t.tempIndex>=0){const i=e[t.tempIndex].name;t.mergeTileVersionParam(i)&&(t.tileSetsIndex=t.tempIndex,t.fire("tileversionschanged",{tileVersion:e[t.tempIndex]}))}},updateCurrentTileSetsIndex:function(t){this.tempIndex=t},mergeTileVersionParam:function(t){return t?(this.requestParams.tileversion=t,this._paramsChanged=!0,this.redraw(),this._paramsChanged=!1,!0):!1},_getLayerUrl:function(){return this._paramsChanged&&(this._layerUrl=this._createLayerUrl()),this._layerUrl||this._createLayerUrl()},_createLayerUrl:function(){let t=E.urlPathAppend(this._url,`tileImage.${this.options.format}`);return this.requestParams=this.requestParams||this._getAllRequestParams(),t=E.urlAppend(t,p.Util.getParamString(this.requestParams)),t=N.appendCredential(t),this._layerUrl=t,t},_getAllRequestParams:function(){const t=this,e=t.options||{},i={};let r=this.options.tileSize;r instanceof R.Point||(r=R.point(r,r)),i.width=r.x,i.height=r.y,i.redirect=e.redirect===!0,i.transparent=e.transparent===!0,i.cacheEnabled=e.cacheEnabled!==!1,e.prjCoordSys&&(i.prjCoordSys=JSON.stringify(e.prjCoordSys)),e.layersID&&(i.layersID=e.layersID.toString()),e.clipRegionEnabled&&e.clipRegion&&(e.clipRegion=Ee.fromGeometry(Ue(e.clipRegion)),i.clipRegionEnabled=e.clipRegionEnabled,i.clipRegion=JSON.stringify(e.clipRegion));const n=t._crs;if(n.options&&n.options.origin)i.origin=JSON.stringify({x:n.options.origin[0],y:n.options.origin[1]});else if(n.projection&&n.projection.bounds){const l=n.projection.bounds,h=R.point(l.min.x,l.max.y);i.origin=JSON.stringify({x:h.x,y:h.y})}return e.overlapDisplayed===!1?(i.overlapDisplayed=!1,e.overlapDisplayedOptions&&(i.overlapDisplayedOptions=t.overlapDisplayedOptions.toString())):i.overlapDisplayed=!0,i.cacheEnabled===!0&&e.tileversion&&(i.tileversion=e.tileversion.toString()),e.rasterfunction&&(i.rasterfunction=JSON.stringify(e.rasterfunction)),i}}),Ce=function(t,e){return new ke(t,e)};var S=window.location.protocol!=="https:"?"http:":"https:",ie=p.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:S+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:S+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:C?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:C?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:C?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:C?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:C?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:C?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:C?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:S+"//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:S+"//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:S+"//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:S+"//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize:function(t,e){var i;if(typeof t=="object"&&t.urlTemplate&&t.options)i=t;else if(typeof t=="string"&&ie.TILES[t])i=ie.TILES[t];else throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');var r=p.Util.extend(i.options,e);p.Util.setOptions(this,r),this.options.ignoreDeprecationWarning||console.warn("WARNING: L.esri.BasemapLayer uses data services that are in mature support and are not being updated. Please use L.esri.Vector.vectorBasemapLayer instead. More info: https://esriurl.com/esri-leaflet-basemap"),this.options.token&&i.urlTemplate.indexOf("token=")===-1&&(i.urlTemplate+="?token="+this.options.token),this.options.proxy&&(i.urlTemplate=this.options.proxy+"?"+i.urlTemplate),p.TileLayer.prototype.initialize.call(this,i.urlTemplate,r)},onAdd:function(t){re(t),this.options.pane==="esri-labels"&&this._initPane(),this.options.attributionUrl&&Oe((this.options.proxy?this.options.proxy+"?":"")+this.options.attributionUrl,t),t.on("moveend",Y),p.TileLayer.prototype.onAdd.call(this,t)},onRemove:function(t){ne(t),t.off("moveend",Y),p.TileLayer.prototype.onRemove.call(this,t)},_initPane:function(){if(!this._map.getPane(this.options.pane)){var t=this._map.createPane(this.options.pane);t.style.pointerEvents="none",t.style.zIndex=500}},getAttribution:function(){if(this.options.attribution)var t='<span class="esri-dynamic-attribution">'+this.options.attribution+"</span>";return t}}),ue=p.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{0:156543.033928,1:78271.5169639999,2:39135.7584820001,3:19567.8792409999,4:9783.93962049996,5:4891.96981024998,6:2445.98490512499,7:1222.99245256249,8:611.49622628138,9:305.748113140558,10:152.874056570411,11:76.4370282850732,12:38.2185141425366,13:19.1092570712683,14:9.55462853563415,15:4.77731426794937,16:2.38865713397468,17:1.19432856685505,18:.597164283559817,19:.298582141647617,20:.14929107082381,21:.07464553541191,22:.0373227677059525,23:.0186613838529763}},initialize:function(t){t=p.Util.setOptions(this,t),t=V(t),this.tileUrl=(t.proxy?t.proxy+"?":"")+t.url+"tile/{z}/{y}/{x}"+(t.requestParams&&Object.keys(t.requestParams).length>0?p.Util.getParamString(t.requestParams):""),t.url.indexOf("{s}")!==-1&&t.subdomains&&(t.url=t.url.replace("{s}",t.subdomains[0])),this.service=se(t),this.service.addEventParent(this);var e=new RegExp(/tiles.arcgis(online)?\.com/g);e.test(t.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),t.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+="?token="+this.options.token),p.TileLayer.prototype.initialize.call(this,this.tileUrl,t)},getTileUrl:function(t){var e=this._getZoomForUrl();return p.Util.template(this.tileUrl,p.Util.extend({s:this._getSubdomain(t),x:t.x,y:t.y,z:this._lodMap&&this._lodMap[e]!==void 0?this._lodMap[e]:e},this.options))},createTile:function(t,e){var i=document.createElement("img");return p.DomEvent.on(i,"load",p.Util.bind(this._tileOnLoad,this,e,i)),p.DomEvent.on(i,"error",p.Util.bind(this._tileOnError,this,e,i)),this.options.crossOrigin&&(i.crossOrigin=""),i.alt="",!this._lodMap||this._lodMap&&this._lodMap[this._getZoomForUrl()]!==void 0?i.src=this.getTileUrl(t):this.once("lodmap",function(){i.src=this.getTileUrl(t)},this),i},onAdd:function(t){re(t),this._lodMap||this.metadata(function(e,i){if(!e&&i.spatialReference){var r=i.spatialReference.latestWkid||i.spatialReference.wkid;if(!this.options.attribution&&t.attributionControl&&i.copyrightText&&(this.options.attribution=i.copyrightText,t.attributionControl.addAttribution(this.getAttribution())),t.options.crs===p.CRS.EPSG3857&&(r===102100||r===3857)){this._lodMap={};for(var n=i.tileInfo.lods,l=ue.MercatorZoomLevels,h=0;h<n.length;h++){var f=n[h];for(var c in l){var g=l[c];if(this._withinPercentage(f.resolution,g,this.options.zoomOffsetAllowance)){this._lodMap[c]=f.level;break}}}this.fire("lodmap")}else t.options.crs&&t.options.crs.code&&t.options.crs.code.indexOf(r)>-1||oe("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet https://developers.arcgis.com/esri-leaflet/samples/non-mercator-projection/")}},this),p.TileLayer.prototype.onAdd.call(this,t)},onRemove:function(t){ne(t),p.TileLayer.prototype.onRemove.call(this,t)},metadata:function(t,e){return this.service.metadata(t,e),this},identify:function(){return this.service.identify()},find:function(){return this.service.find()},query:function(){return this.service.query()},authenticate:function(t){var e="?token="+t;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,e):this.tileUrl+e,this.options.token=t,this.service.authenticate(t),this},_withinPercentage:function(t,e,i){var r=Math.abs(t/e-1);return r<i}});function Ne(t,e){return new ue(t,e)}ae.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query:function(){return this.service.query()},identify:function(){return this.service.identify()},initialize:function(t){t=V(t),this.service=Re(t),this.service.addEventParent(this),p.Util.setOptions(this,t)},setPixelType:function(t){return this.options.pixelType=t,this._update(),this},getPixelType:function(){return this.options.pixelType},setBandIds:function(t){return p.Util.isArray(t)?this.options.bandIds=t.join(","):this.options.bandIds=t.toString(),this._update(),this},getBandIds:function(){return this.options.bandIds},setNoData:function(t,e){return p.Util.isArray(t)?this.options.noData=t.join(","):this.options.noData=t.toString(),e&&(this.options.noDataInterpretation=e),this._update(),this},getNoData:function(){return this.options.noData},getNoDataInterpretation:function(){return this.options.noDataInterpretation},setRenderingRule:function(t){this.options.renderingRule=t,this._update()},getRenderingRule:function(){return this.options.renderingRule},setMosaicRule:function(t){this.options.mosaicRule=t,this._update()},getMosaicRule:function(){return this.options.mosaicRule},_getPopupData:function(t){var e=p.Util.bind(function(r,n,l){r||setTimeout(p.Util.bind(function(){this._renderPopup(t.latlng,r,n,l)},this),300)},this),i=this.identify().at(t.latlng);this.options.mosaicRule&&i.setMosaicRule(this.options.mosaicRule),i.run(e),this._shouldRenderPopup=!0,this._lastClick=t.latlng},_buildExportParams:function(){var t=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:t,imageSR:t};return this.options.from&&this.options.to&&(e.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.options.pixelType&&(e.pixelType=this.options.pixelType),this.options.interpolation&&(e.interpolation=this.options.interpolation),this.options.compressionQuality&&(e.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(e.bandIds=this.options.bandIds),(this.options.noData===0||this.options.noData)&&(e.noData=this.options.noData),this.options.noDataInterpretation&&(e.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(e.token=this.service.options.token),this.options.renderingRule&&(e.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(e.mosaicRule=JSON.stringify(this.options.mosaicRule)),e},_requestExport:function(t,e){if(this.options.f==="json")this.service.request("exportImage",t,function(r,n){r||(this.options.token&&(n.href+="?token="+this.options.token),this.options.proxy&&(n.href=this.options.proxy+"?"+n.href),this._renderImage(n.href,e))},this);else{t.f="image";var i=this.options.url+"exportImage"+p.Util.getParamString(t);this.options.proxy&&(i=this.options.proxy+"?"+i),this._renderImage(i,e)}}});var Ge=ae.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png32",transparent:!0,f:"json"},initialize:function(t){t=V(t),this.service=se(t),this.service.addEventParent(this),p.Util.setOptions(this,t)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(t){return this.options.dynamicLayers=t,this._update(),this},getLayers:function(){return this.options.layers},setLayers:function(t){return this.options.layers=t,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(t){return this.options.layerDefs=t,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(t){return this.options.timeOptions=t,this._update(),this},query:function(){return this.service.query()},identify:function(){return this.service.identify()},find:function(){return this.service.find()},_getPopupData:function(t){var e=p.Util.bind(function(n,l,h){n||setTimeout(p.Util.bind(function(){this._renderPopup(t.latlng,n,l,h)},this),300)},this),i;if(this.options.popup?i=this.options.popup.on(this._map).at(t.latlng):i=this.identify().on(this._map).at(t.latlng),i.params.maxAllowableOffset||i.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?i.layers("visible:"+this.options.layers.join(",")):i.layers("visible")),this.options.layerDefs&&typeof this.options.layerDefs!="string"&&!i.params.layerDefs)for(var r in this.options.layerDefs)Object.prototype.hasOwnProperty.call(this.options.layerDefs,r)&&i.layerDef(r,this.options.layerDefs[r]);i.run(e),this._shouldRenderPopup=!0,this._lastClick=t.latlng},_buildExportParams:function(){var t=parseInt(this._map.options.crs.code.split(":")[1],10),e={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:t,imageSR:t};if(this.options.dynamicLayers&&(e.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(this.options.layers.length===0)return;e.layers="show:"+this.options.layers.join(",")}return this.options.layerDefs&&(e.layerDefs=typeof this.options.layerDefs=="string"?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(e.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(e.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.service.options.token&&(e.token=this.service.options.token),this.options.proxy&&(e.proxy=this.options.proxy),this.options.disableCache&&(e._ts=Date.now()),e},_requestExport:function(t,e){if(this.options.f==="json")this.service.request("export",t,function(r,n){r||(this.options.token&&n.href&&(n.href+="?token="+this.options.token),this.options.proxy&&n.href&&(n.href=this.options.proxy+"?"+n.href),n.href?this._renderImage(n.href,e):this._renderImage(n.imageData,e,n.contentType))},this);else{t.f="image";var i=this.options.url+"export"+p.Util.getParamString(t);this.options.proxy&&(i=this.options.proxy+"?"+i),this._renderImage(i,e)}}});function Me(t,e){return new Ge(t,e)}J.extend({options:{cacheLayers:!0},initialize:function(t){t.apikey&&(t.token=t.apikey),J.prototype.initialize.call(this,t),this._originalStyle=this.options.style,this._layers={}},onRemove:function(t){for(var e in this._layers)t.removeLayer(this._layers[e]),this.fire("removefeature",{feature:this._layers[e].feature,permanent:!1},!0);return J.prototype.onRemove.call(this,t)},createNewLayer:function(t){var e=p.GeoJSON.geometryToLayer(t,this.options);return e&&(e.defaultOptions=e.options),e},_updateLayer:function(t,e){var i=[],r=this.options.coordsToLatLng||p.GeoJSON.coordsToLatLng;switch(e.properties&&(t.feature.properties=e.properties),e.geometry.type){case"Point":i=p.GeoJSON.coordsToLatLng(e.geometry.coordinates),t.setLatLng(i);break;case"LineString":i=p.GeoJSON.coordsToLatLngs(e.geometry.coordinates,0,r),t.setLatLngs(i);break;case"MultiLineString":i=p.GeoJSON.coordsToLatLngs(e.geometry.coordinates,1,r),t.setLatLngs(i);break;case"Polygon":i=p.GeoJSON.coordsToLatLngs(e.geometry.coordinates,1,r),t.setLatLngs(i);break;case"MultiPolygon":i=p.GeoJSON.coordsToLatLngs(e.geometry.coordinates,2,r),t.setLatLngs(i);break}this.redraw(t.feature.id)},createLayers:function(t){for(var e=t.length-1;e>=0;e--){var i=t[e],r=this._layers[i.id],n;this._visibleZoom()&&r&&!this._map.hasLayer(r)&&(!this.options.timeField||this._featureWithinTimeRange(i))&&(this._map.addLayer(r),this.fire("addfeature",{feature:r.feature},!0)),r&&(r.setLatLngs||r.setLatLng)&&this._updateLayer(r,i),r||(n=this.createNewLayer(i),n?(n.feature=i,n.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(n.feature,n),this._layers[n.feature.id]=n,this.setFeatureStyle(n.feature.id,this.options.style),this.fire("createfeature",{feature:n.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(i))&&this._map.addLayer(n)):oe("invalid GeoJSON encountered"))}},addLayers:function(t){for(var e=t.length-1;e>=0;e--){var i=this._layers[t[e]];i&&(!this.options.timeField||this._featureWithinTimeRange(i.feature))&&(this._map.addLayer(i),this.fire("addfeature",{feature:i.feature},!0))}},removeLayers:function(t,e){for(var i=t.length-1;i>=0;i--){var r=t[i],n=this._layers[r];n&&(this.fire("removefeature",{feature:n.feature,permanent:e},!0),this._map.removeLayer(n)),n&&e&&delete this._layers[r]}},cellEnter:function(t,e){this._visibleZoom()&&!this._zooming&&this._map&&p.Util.requestAnimFrame(p.Util.bind(function(){var i=this._cacheKey(e),r=this._cellCoordsToKey(e),n=this._cache[i];this._activeCells[r]&&n&&this.addLayers(n)},this))},cellLeave:function(t,e){this._zooming||p.Util.requestAnimFrame(p.Util.bind(function(){if(this._map){var i=this._cacheKey(e),r=this._cellCoordsToKey(e),n=this._cache[i],l=this._map.getBounds();if(!this._activeCells[r]&&n){for(var h=!0,f=0;f<n.length;f++){var c=this._layers[n[f]];c&&c.getBounds&&l.intersects(c.getBounds())&&(h=!1)}h&&this.removeLayers(n,!this.options.cacheLayers),!this.options.cacheLayers&&h&&(delete this._cache[i],delete this._cells[r],delete this._activeCells[r])}}},this))},resetStyle:function(){return this.options.style=this._originalStyle,this.eachFeature(function(t){this.resetFeatureStyle(t.feature.id)},this),this},setStyle:function(t){return this.options.style=t,this.eachFeature(function(e){this.setFeatureStyle(e.feature.id,t)},this),this},resetFeatureStyle:function(t){var e=this._layers[t],i=this._originalStyle||p.Path.prototype.options;return e&&(p.Util.extend(e.options,e.defaultOptions),this.setFeatureStyle(t,i)),this},setFeatureStyle:function(t,e){var i=this._layers[t];return typeof e=="function"&&(e=e(i.feature)),i.setStyle&&i.setStyle(e),this},eachActiveFeature:function(t,e){if(this._map){var i=this._map.getBounds();for(var r in this._layers)this._currentSnapshot.indexOf(this._layers[r].feature.id)!==-1&&(typeof this._layers[r].getLatLng=="function"&&i.contains(this._layers[r].getLatLng())?t.call(e,this._layers[r]):typeof this._layers[r].getBounds=="function"&&i.intersects(this._layers[r].getBounds())&&t.call(e,this._layers[r]))}return this},eachFeature:function(t,e){for(var i in this._layers)t.call(e,this._layers[i]);return this},getFeature:function(t){return this._layers[t]},bringToBack:function(){this.eachFeature(function(t){t.bringToBack&&t.bringToBack()})},bringToFront:function(){this.eachFeature(function(t){t.bringToFront&&t.bringToFront()})},redraw:function(t){return t&&this._redraw(t),this},_redraw:function(t){var e=this._layers[t],i=e.feature;if(e&&e.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){var r=this.options.pointToLayer(i,p.latLng(i.geometry.coordinates[1],i.geometry.coordinates[0])),n=r.options.icon;e.setIcon(n)}if(e&&e.setStyle&&this.options.pointToLayer){var l=this.options.pointToLayer(i,p.latLng(i.geometry.coordinates[1],i.geometry.coordinates[0])),h=l.options;this.setFeatureStyle(i.id,h)}e&&e.setStyle&&this.options.style&&this.resetFeatureStyle(i.id)},openPopup(t){return this._popup&&this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map),this},openTooltip(t){return this._tooltip&&this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this)),this}});const Fe={class:"layer-wrapper"},qe=["title"],Be=["title"],je=pe({__name:"addService",setup(t){const e=fe({count:0,name:"服务 1",url:"",type:"supermap_rest",layers:[]});function i(){const n=e.url,l=e.type,h=e.name;e.count++,e.name="服务 "+e.count;let f;try{switch(l){case"supermap_rest":case"supermap_tile":{f=Ce(n,{prjCoordSys:{epsgCode:3857},crs:p.CRS.EPSG3857});break}case"arcgis_rest":{f=Me({url:n,f:"image"});break}case"arcgis_tile":{f=Ne({url:n});break}case"tms":{f=p.tileLayer(n);break}default:break}}catch{ye.error("添加服务失败");return}f&&($.emit("addLayer",f,h),e.layers.push({name:h,url:n,layer:f,id:ge()}))}function r(n){var l;(l=e.layers[n])!=null&&l.layer&&($.emit("removeLayer",e.layers[n].layer),e.layers.splice(n,1))}return(n,l)=>{const h=ve,f=_e,c=be,g=Se,m=Te,b=Ae,L=xe;return F(),q(z,null,[D(e).layers.length?(F(),q(z,{key:0},[W("div",Fe,[(F(!0),q(z,null,de(D(e).layers,(v,I)=>(F(),q("div",{key:v.id,class:"layer-item"},[W("div",{class:"layer-item-title",title:v.name},Q(v.name),9,qe),W("div",{class:"layer-item-url",title:v.url},Q(v.url),9,Be),w(h,{onClick:U=>r(I)},{default:k(()=>[X(" 移除 ")]),_:2},1032,["onClick"])]))),128))]),w(f)],64)):me("",!0),w(L,{colon:!1,class:"addService"},{default:k(()=>[w(g,{label:"服务名称"},{default:k(()=>[w(c,{modelValue:D(e).name,"onUpdate:modelValue":l[0]||(l[0]=v=>D(e).name=v)},null,8,["modelValue"])]),_:1}),w(g,{label:"服务地址"},{default:k(()=>[w(c,{modelValue:D(e).url,"onUpdate:modelValue":l[1]||(l[1]=v=>D(e).url=v)},null,8,["modelValue"])]),_:1}),w(g,{label:"服务类型"},{default:k(()=>[w(b,{modelValue:D(e).type,"onUpdate:modelValue":l[2]||(l[2]=v=>D(e).type=v)},{default:k(()=>[w(m,{value:"supermap_rest",label:"超图动态"}),w(m,{value:"supermap_tile",label:"超图切片"}),w(m,{value:"arcgis_rest",label:"ArcGIS 动态"}),w(m,{value:"arcgis_tile",label:"ArcGIS 切片"}),w(m,{value:"tms",label:"TMS"})]),_:1},8,["modelValue"])]),_:1}),w(g,{class:"formBtnItem"},{default:k(()=>[w(h,{type:"primary",onClick:i},{default:k(()=>[X(" 添加 ")]),_:1})]),_:1})]),_:1})],64)}}}),Qe=we(je,[["__scopeId","data-v-76311256"]]);export{Qe as default};
