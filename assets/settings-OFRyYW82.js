import{F as j,aV as D,aq as G,m as J,u as o,G as ee,a2 as te,a3 as N,at as oe,aU as ae,bJ as le,au as se,t as F,aE as M,J as _,K as y,X as e,a1 as t,ar as n,ap as u,ai as x,a0 as P,T as $,a$ as U,as as ne,az as re,aA as de,aB as ie,aC as ue}from"./index-S_Cm6YJa.js";import{E as pe}from"./el-checkbox-sn5UAyNj.js";import{E as fe,a as me}from"./el-radio-group-qoR8C5el.js";/* empty css                 */import{E as ce}from"./el-divider-XN5llsgu.js";import{E as _e}from"./el-space-h5La6KT4.js";import{E as we}from"./el-popover-WsVwOdK8.js";import{n as ge,b as he}from"./Router-EOcXCkQt.js";import{a as ve,E as Ve}from"./el-form-item-eig6_KGC.js";import"./hasIn-G-TLX-WO.js";import"./castArray-YR75Oxvn.js";const ke=j({inheritAttrs:!1,__name:"HaveAccess",props:{auth:{type:[Boolean,Object],default:!1},link:{default:""}},setup(p){const f=D(),C=ge(),E=G(),d=p,g=J(()=>d.auth?typeof d.auth=="boolean"?f.logged:f.checkAccess(d.auth):d.link?f.checkAccess(C.getAuth(d.link)):!0);function i(){d.link&&E.push(d.link)}return(c,b)=>o(g)?ee(c.$slots,"default",te({key:0},c.$attrs,{goto:i})):N("",!0)}}),ye=oe("main",{persist:!0,state:()=>({_cache:{},clearOfflineCacheTag:!1}),getters:{getData:p=>f=>{if(f)return(p._cache||{})[f]}},actions:{setData({key:p,val:f}={}){p&&(this._cache=this._cache||{},this._cache[p]=f)},clear(){this._cache={}},clearOfflineCache(){console.log("clearOfflineCache"),this.clearOfflineCacheTag=!0}}}),T=p=>(de("data-v-faaa76a9"),p=p(),ie(),p),Ce={key:0,flex:"","flex-col":"","text-7":"","gap-4":"","items-start":""},Ee={flex:""},be=T(()=>u("div",{"w-32":""}," 昵称: ",-1)),Se={flex:""},xe=T(()=>u("div",{"w-32":""}," 邮箱: ",-1)),Pe={flex:""},Ue=T(()=>u("div",{"w-32":""}," 角色 ",-1)),Ne={flex:"","gap-4":""},Te={flex:"","text-7":"","gap-4":"","items-start":"","flex-wrap":"",class:"settings-container"},Oe={class:"settings-wrapper"},Ae={key:0,class:"settings-wrapper"},Ie=j({__name:"settings",setup(p){const f=G(),C=ae(),E=le(),d=D(),g=se(),i=J(()=>g.general),c=F(!1),b=F(),l=M({nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),q=M({rePasswd:[{validator:(h,a,r)=>{a&&a!==l.passwd?r(new Error("两次输入的密码不一致")):r()}}],oldPasswd:[{validator:(h,a,r)=>{!a&&(l.passwd||l.rePasswd)?r(new Error("请输入旧密码")):r()}}]}),O=()=>ye().clearOfflineCache();function H(){f.push({path:"/login",query:{redirect:C.fullPath}})}function z(){f.push("/logout")}function K(){l.nickName=d.profile.nickName??"",l.email=d.profile.email??"",l.passwd="",l.rePasswd="",l.oldPasswd="",c.value=!0}function X(){c.value=!1}async function L(h){h&&await h.validate(async a=>{if(a){const r={};if(l.nickName&&(r.nickName=l.nickName),l.email&&(r.email=l.email),l.passwd&&(r.passwd=l.passwd,r.oldPasswd=l.oldPasswd),Object.keys(r).length===0){U.warning("没有需要修改的信息");return}try{await d.updateUser(r)}catch(m){U.error(m.message)}c.value=!1}else return U.warning("请检查输入"),!1})}return(h,a)=>{var I,R,B;const r=he,m=ne,Q=ke,v=re,V=ve,W=Ve,A=we,k=_e,Y=ce,S=fe,Z=me,w=pe;return _(),y($,null,[e(r,{level:3},{default:t(()=>[n(" 账户信息 ")]),_:1}),o(d).logged?(_(),y("div",Ce,[u("div",Ee,[be,u("div",null,x(o(d).profile.nickName),1)]),u("div",Se,[xe,u("div",null,x(o(d).profile.email),1)]),u("div",Pe,[Ue,u("div",null,x(((B=(R=(I=o(d).profile)==null?void 0:I.roles)==null?void 0:R[0])==null?void 0:B.alias)??"普通用户"),1)]),u("div",Ne,[e(m,{type:"primary",onClick:z},{default:t(()=>[n(" 登出 ")]),_:1}),e(Q,{link:"/userManager"},{default:t(({goto:s})=>[e(m,{type:"primary",onClick:s},{default:t(()=>[n(" 用户权限中心 ")]),_:2},1032,["onClick"])]),_:1}),o(c)?(_(),y($,{key:1},[e(m,{type:"primary",onClick:a[0]||(a[0]=s=>L(o(b)))},{default:t(()=>[n(" 保存 ")]),_:1}),e(m,{onClick:X},{default:t(()=>[n(" 取消 ")]),_:1})],64)):(_(),P(m,{key:0,onClick:K},{default:t(()=>[n(" 修改信息 ")]),_:1}))]),o(c)?(_(),P(W,{key:0,ref_key:"ruleFormRef",ref:b,model:o(l),rules:o(q),"label-width":"8rem","label-position":"left"},{default:t(()=>[e(V,{label:"昵称",prop:"nickName"},{default:t(()=>[e(v,{modelValue:o(l).nickName,"onUpdate:modelValue":a[1]||(a[1]=s=>o(l).nickName=s)},null,8,["modelValue"])]),_:1}),e(V,{label:"邮箱",prop:"email"},{default:t(()=>[e(v,{modelValue:o(l).email,"onUpdate:modelValue":a[2]||(a[2]=s=>o(l).email=s)},null,8,["modelValue"])]),_:1}),e(V,{label:"旧密码",prop:"oldPasswd"},{default:t(()=>[e(v,{modelValue:o(l).oldPasswd,"onUpdate:modelValue":a[3]||(a[3]=s=>o(l).oldPasswd=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(V,{label:"新密码",prop:"passwd"},{default:t(()=>[e(v,{modelValue:o(l).passwd,"onUpdate:modelValue":a[4]||(a[4]=s=>o(l).passwd=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(V,{label:"确认密码",prop:"rePasswd"},{default:t(()=>[e(v,{modelValue:o(l).rePasswd,"onUpdate:modelValue":a[5]||(a[5]=s=>o(l).rePasswd=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])):N("",!0),e(A,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:O},{reference:t(()=>[e(m,{type:"danger",plain:""},{default:t(()=>[n(" 清空本地缓存 ")]),_:1})]),_:1})])):(_(),P(k,{key:1},{default:t(()=>[e(m,{type:"primary",onClick:H},{default:t(()=>[n(" 登录 ")]),_:1}),e(A,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:O},{reference:t(()=>[e(m,{type:"danger",plain:""},{default:t(()=>[n(" 清空本地缓存 ")]),_:1})]),_:1})]),_:1})),e(Y),u("div",Te,[u("div",Oe,[e(r,{level:4},{default:t(()=>[n(" 全局设置 ")]),_:1}),e(r,{level:5},{default:t(()=>[n(" 外观 ")]),_:1}),e(k,null,{default:t(()=>[e(Z,{"model-value":o(i).theme.mode,onChange:o(E).setTheme},{default:t(()=>[e(S,{label:"auto"},{default:t(()=>[n(" 跟随系统 ")]),_:1}),e(S,{label:"light"},{default:t(()=>[n(" 浅色 ")]),_:1}),e(S,{label:"dark"},{default:t(()=>[n(" 深色 ")]),_:1})]),_:1},8,["model-value","onChange"])]),_:1}),e(r,{level:5},{default:t(()=>[n(" 访问统计 ")]),_:1}),e(k,null,{default:t(()=>[e(w,{modelValue:o(i).showMost,"onUpdate:modelValue":a[6]||(a[6]=s=>o(i).showMost=s)},{default:t(()=>[n(" 最常访问 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(i).showRecent,"onUpdate:modelValue":a[7]||(a[7]=s=>o(i).showRecent=s)},{default:t(()=>[n(" 最近访问 ")]),_:1},8,["modelValue"])]),_:1}),e(r,{level:5},{default:t(()=>[n(" 其他设置 ")]),_:1}),e(k,null,{default:t(()=>[e(w,{modelValue:o(i).showSearch,"onUpdate:modelValue":a[8]||(a[8]=s=>o(i).showSearch=s)},{default:t(()=>[n(" 显示搜索 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(i).showType,"onUpdate:modelValue":a[9]||(a[9]=s=>o(i).showType=s)},{default:t(()=>[n(" 显示分类 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(i).openInNewTab,"onUpdate:modelValue":a[10]||(a[10]=s=>o(i).openInNewTab=s)},{default:t(()=>[n(" 新标签页打开工具 ")]),_:1},8,["modelValue"])]),_:1})]),o(d).logged?(_(),y("div",Ae,[e(r,{level:4},{default:t(()=>[n(" 应用设置 ")]),_:1}),e(r,{level:5},{default:t(()=>[n(" JSON 编辑器 ")]),_:1}),e(k,null,{default:t(()=>[e(w,{modelValue:o(g).modules.jsonEditor.syncCloud,"onUpdate:modelValue":a[11]||(a[11]=s=>o(g).modules.jsonEditor.syncCloud=s)},{default:t(()=>[n(" 从云端获取 ")]),_:1},8,["modelValue"])]),_:1})])):N("",!0)])],64)}}}),ze=ue(Ie,[["__scopeId","data-v-faaa76a9"]]);export{ze as default};
