import{c as ye,_ as ge}from"./ant-design-vue-67d75677.js";import{j as he,B as f,x as G,y as a,o as u,c as m,a as c,w as N,f as I,t as S,b as t,ae as o,W as b,ad as V,F as g,g as j,X as C,e as E,aa as Z,ag as ke,br as Re,aT as Se,aU as we,aM as Ve,aL as Ce,a3 as Ee}from"./vendor-7c5ae7bf.js";import"./common-cdf83cfa.js";const Te={key:0,class:"wrapper"},De={class:"video-wrapper"},Ue={class:"previewVideo"},Ae=["src"],Me={class:"operations"},Oe={class:"settings-wrapper"},ee="unshare",Be="unstart",M="recording",F="paused",ae="stopped",xe=he({__name:"screenRecord",setup(Le){const O=f(),T=f();let _=null,s=null;const r=f(ee);let P=[];const h=f(""),W=f(!1),H=[{label:"否",value:"never"},{label:"是",value:"always"}],k=f("never"),X=[{label:"否",value:"never"},{label:"是",value:"always"}],R=f("never"),$=[{label:"默认",value:"default"},{label:"16:9",value:1.77},{label:"4:3",value:1.33},{label:"21:9",value:2.35},{label:"14:10",value:1.4},{label:"19:10",value:1.9}],D=f("default"),le=[{label:"默认",value:"default"},{label:"60",value:60},{label:"30",value:30},{label:"25",value:25},{label:"15",value:15},{label:"5",value:5}],U=f("default"),te=[{label:"默认",value:"default"},{label:"屏幕尺寸",value:"fit-screen"},{label:"4K",value:"4k"},{label:"1080p",value:"1080p"},{label:"720p",value:"720p"}],B=f("default"),K=[{label:"默认",value:"default"},{label:"总是显示",value:"always"},{label:"移动时显示",value:"motion"},{label:"从不显示",value:"never"}],A=f("default"),x=(()=>navigator&&navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints?navigator.mediaDevices.getSupportedConstraints():{})(),oe=(()=>!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia))(),ne=(()=>!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia))(),ue=oe&&ne,q=G(()=>{switch(r.value){case M:return"REC";case F:return"PAUSE";default:return!1}}),se=G(()=>{const l={};switch(typeof D.value=="number"&&(l.aspectRatio=D.value),typeof U.value=="number"&&(l.frameRate=U.value),A.value!=="default"&&(l.cursor=A.value),B.value){case"fit-screen":l.width=screen.width,l.height=screen.height;break;case"4K":l.width=3840,l.height=2160;break;case"1080p":l.width=1920,l.height=1080;break;case"720p":l.width=1280,l.height=720;break}return{video:l,audio:k.value==="always"}}),w=G(()=>{var l,n;if(_){const v=_.getVideoTracks();if(v.length>0){const y=v[0].getSettings(),d={recordAudio:(l=H.find(i=>k.value===i.value))==null?void 0:l.label,recordMicro:(n=X.find(i=>R.value===i.value))==null?void 0:n.label,frameRate:y.frameRate,width:y.width,height:y.height,aspectRatio:"默认",cursor:""};if(y.aspectRatio){const i=y.aspectRatio,p=$.find(L=>typeof L.value=="number"?i-L.value<=.1:!1);p?d.aspectRatio=p.label:d.aspectRatio="默认"}if(y.cursor){const i=K.find(p=>y.cursor===p.value);i?d.cursor=i.label:d.cursor="默认"}return{video:d}}}return{video:{},audio:{}}});async function re(){try{if(_=await navigator.mediaDevices.getDisplayMedia(se.value),R.value==="always"){const n=await navigator.mediaDevices.getUserMedia({audio:!0});_.addTrack(n.getAudioTracks()[0])}const l=_.getVideoTracks()[0];l&&(l.onended=Q,l.onmute=Q),s=new MediaRecorder(_),s.onstop=pe,s.ondataavailable=fe,O.value.srcObject=_,O.value.muted=!0,r.value="unstart"}catch(l){Z.error(l.message)}}function ie(){J(),s==null||s.start(),r.value=M}function ce(){s==null||s.pause(),r.value=F}function de(){s==null||s.resume(),r.value=M}function z(){s&&s.state!=="inactive"&&s.stop(),r.value=ae}function J(){h.value=""}function ve(){if(h.value){const l=document.createElement("a");l.href=h.value,l.download="screen-record.mp4",l.click()}}function Q(){if(z(),_)_.getTracks().forEach(n=>{n.stop()});else return;Z.info("屏幕分享结束"),_=null,O.value.srcObject=null,r.value="unshare"}function pe(){const l=new Blob(P,{type:"video/mp4"});h.value=URL.createObjectURL(l),P=[];const n=setInterval(async()=>{T.value.readyState>0&&(T.value.duration===1/0?T.value.currentTime=1e7*Math.random():(clearInterval(n),T.value.currentTime=0))},200)}function fe(l){P.push(l.data)}function _e(){k.value&&R.value&&(R.value="never")}function me(){k.value&&R.value&&(k.value="never")}return(l,n)=>{const v=ke,y=Re,d=Se,i=we,p=Ve,L=Ce,Y=ye,be=ge;return a(ue)?(u(),m("div",Te,[c("div",De,[c("div",Ue,[N(c("video",{ref_key:"screenShareVideoElement",ref:O,autoplay:""},null,512),[[I,!a(h)]]),N(c("video",{ref_key:"recordVideoElement",ref:T,controls:"",src:a(h)},null,8,Ae),[[I,a(h)]]),N(c("span",{class:"rec"},S(a(q)),513),[[I,a(q)]])]),c("div",Me,[t(v,{type:"primary",onClick:n[0]||(n[0]=e=>W.value=!a(W))},{default:o(()=>[b(" 设置 ")]),_:1}),a(r)===ee?(u(),V(v,{key:0,type:"primary",onClick:re},{default:o(()=>[b(" 开启屏幕共享 ")]),_:1})):(u(),m(g,{key:1},[t(v,{type:"primary",disabled:a(r)===M||a(r)===F,onClick:ie},{default:o(()=>[b(" 开始录制 ")]),_:1},8,["disabled"]),t(v,{type:"primary",disabled:a(r)!==M,onClick:ce},{default:o(()=>[b(" 暂停 ")]),_:1},8,["disabled"]),t(v,{type:"primary",disabled:a(r)!==F,onClick:de},{default:o(()=>[b(" 继续 ")]),_:1},8,["disabled"]),t(v,{type:"primary",disabled:a(r)===Be||a(r)===ae,onClick:z},{default:o(()=>[b(" 停止 ")]),_:1},8,["disabled"])],64)),a(h)?(u(),m(g,{key:2},[t(v,{type:"primary",onClick:J},{default:o(()=>[b(" 清除 ")]),_:1}),t(v,{type:"primary",onClick:ve},{default:o(()=>[b(" 下载 ")]),_:1})],64)):j("",!0)])]),N(c("div",Oe,[t(y,{title:"由于浏览器限制，部分设置可能无法生效",type:"warning","show-icon":"",style:{"margin-bottom":".8rem"}}),a(r)==="unshare"?(u(),V(L,{key:0,"label-position":"top"},{default:o(()=>[t(p,{label:"系统音频"},{default:o(()=>[t(i,{modelValue:a(k),"onUpdate:modelValue":n[1]||(n[1]=e=>C(k)?k.value=e:null),onChange:_e},{default:o(()=>[(u(),m(g,null,E(H,e=>t(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"麦克风"},{default:o(()=>[t(i,{modelValue:a(R),"onUpdate:modelValue":n[2]||(n[2]=e=>C(R)?R.value=e:null),onChange:me},{default:o(()=>[(u(),m(g,null,E(X,e=>t(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(x).aspectRatio?(u(),V(p,{key:0,label:"选择长宽比"},{default:o(()=>[t(i,{modelValue:a(D),"onUpdate:modelValue":n[3]||(n[3]=e=>C(D)?D.value=e:null)},{default:o(()=>[(u(),m(g,null,E($,e=>t(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):j("",!0),a(x).frameRate?(u(),V(p,{key:1,label:"选择帧率"},{default:o(()=>[t(i,{modelValue:a(U),"onUpdate:modelValue":n[4]||(n[4]=e=>C(U)?U.value=e:null)},{default:o(()=>[(u(),m(g,null,E(le,e=>t(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):j("",!0),a(x).width&&a(x).height?(u(),V(p,{key:2,label:"选择分辨率"},{default:o(()=>[t(i,{modelValue:a(B),"onUpdate:modelValue":n[5]||(n[5]=e=>C(B)?B.value=e:null)},{default:o(()=>[(u(),m(g,null,E(te,e=>t(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):j("",!0),t(p,{label:"是否显示光标"},{default:o(()=>[t(i,{modelValue:a(A),"onUpdate:modelValue":n[6]||(n[6]=e=>C(A)?A.value=e:null),options:K},{default:o(()=>[(u(),m(g,null,E(K,e=>t(d,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})):(u(),m(g,{key:1},[t(Y,{level:4},{default:o(()=>[b(" 当前设置 ")]),_:1}),t(be,null,{default:o(()=>[c("ul",null,[c("li",null,"系统音频: "+S(a(w).video.recordAudio),1),c("li",null,"麦克风: "+S(a(w).video.recordMicro),1),c("li",null,"长宽比: "+S(a(w).video.aspectRatio),1),c("li",null,"帧率: "+S(a(w).video.frameRate),1),c("li",null,"视频宽度: "+S(a(w).video.width),1),c("li",null,"视频高度: "+S(a(w).video.height),1),c("li",null,"显示鼠标: "+S(a(w).video.cursor),1)])]),_:1})],64))],512),[[I,a(W)]])])):(u(),V(Y,{key:1,level:3},{default:o(()=>[b(" 你的浏览器不支持WebRTC，请安装最新版本Chrome后重试。 ")]),_:1}))}}});const Fe=Ee(xe,[["__scopeId","data-v-a5f349f3"]]);export{Fe as default};
