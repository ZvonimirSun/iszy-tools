import{h as X,aT as J,_ as O,k as A,ck as Q,co as Z,n as P,aE as I,u as ee,E as _,r as m,q as S,G as x,s as M,w as s,y as le,x as o,aP as te,v as L,z as ae,R as C,a4 as T,T as ne,aa as re,a7 as oe,bA as U,bz as N,aA as c,F as V,ai as se,K as r,W as ie,N as k,L as ue,H as Y,Y as $,X as H,a0 as de}from"./index-DdH6q6SV.js";import{v as pe}from"./el-loading-DD6CZNUk.js";import{E as ce}from"./el-pagination-CfeQBfbH.js";/* empty css               */import"./el-select-BxurROVm.js";import"./el-popper-B_12Myl_.js";import{E as me,a as fe}from"./el-table-column-BqM1ayzm.js";import"./el-checkbox-Bh4BhDHp.js";import"./el-tooltip-l0sNRNKZ.js";import{E as ye}from"./el-popover-Bz8jdwYv.js";import"./Router-C4hKjnIW.js";import"./index-PvysGUtG.js";import"./strings-Ddq4QAeH.js";import"./castArray-DfJK8VnQ.js";import"./_baseIteratee-CGDUxasU.js";import"./index-B1QAsMn1.js";import"./index--kSuBU8m.js";import"./index-ukcMG_GO.js";import"./map-wP416lLP.js";import"./_baseEach-2eNG-2sy.js";import"./raf-BV4aVOg6.js";const ke=X({type:{type:String,values:["primary","success","warning","info","danger","default"],default:void 0},underline:{type:[Boolean,String],values:[!0,!1,"always","never","hover"],default:void 0},disabled:Boolean,href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:J}}),ve={click:E=>E instanceof MouseEvent},ge=A({name:"ElLink"}),_e=A({...ge,props:ke,emits:ve,setup(E,{emit:z}){const n=E,i=Q("link");Z({scope:"el-link",from:"The underline option (boolean)",replacement:"'always' | 'hover' | 'never'",version:"3.0.0",ref:"https://element-plus.org/en-US/component/link.html#underline"},P(()=>I(n.underline)));const f=ee("link"),w=P(()=>{var l,d,g;return[f.b(),f.m((g=(d=n.type)!=null?d:(l=i.value)==null?void 0:l.type)!=null?g:"default"),f.is("disabled",n.disabled),f.is("underline",y.value==="always"),f.is("hover-underline",y.value==="hover"&&!n.disabled)]}),y=P(()=>{var l,d,g;return I(n.underline)?n.underline?"hover":"never":(g=(d=n.underline)!=null?d:(l=i.value)==null?void 0:l.underline)!=null?g:"hover"});function v(l){n.disabled||z("click",l)}return(l,d)=>(m(),_("a",{class:L(o(w)),href:l.disabled||!l.href?void 0:l.href,target:l.disabled||!l.href?void 0:l.target,onClick:v},[l.icon?(m(),S(o(te),{key:0},{default:s(()=>[(m(),S(le(l.icon)))]),_:1})):x("v-if",!0),l.$slots.default?(m(),_("span",{key:1,class:L(o(f).e("inner"))},[M(l.$slots,"default")],2)):x("v-if",!0),l.$slots.icon?M(l.$slots,"icon",{key:2}):x("v-if",!0)],10,["href","target"]))}});var we=O(_e,[["__file","link.vue"]]);const be=ae(we),he={"h-full":"",flex:"","flex-col":"","gap-4":""},Ce={class:"new-url-form"},Ee="https://url.iszy.xyz",ze=A({__name:"urls",setup(E){const z=C([]),n=C(10),i=C(1),f=C(0),w=C(!1),y=T({}),v=T({}),l=T({keyword:"",url:""});ne(()=>{d(i.value-1,n.value)}),re(()=>{d(i.value-1,n.value)}),oe(n,()=>{i.value=1});async function d(a,e){const b=setTimeout(()=>{w.value=!0},300);try{const p=await U.get("/urls/admin/urls",{params:{pageIndex:a,pageSize:e}});p.success?(f.value=p.data.count,z.value=p.data.rows.map(u=>(u.createdAt=N(u.createdAt).format("YYYY年MM月DD日 HH:mm"),u.updatedAt=N(u.updatedAt).format("YYYY年MM月DD日 HH:mm"),u))):c.error(p.message)}catch(p){c.error(p.message)}clearTimeout(b),w.value=!1}async function g(){if(l.url)try{const a=await U.post("/urls/admin/url",{url:l.url,keyword:l.keyword});a.success?(c.success("创建成功"),l.url="",l.keyword="",await d(i.value-1,n.value)):c.error(a.message)}catch(a){c.error(a.message)}}async function F(a){try{const e=await U.put(`/urls/admin/url/${a.keyword}`,{url:v[a.keyword]});e.success?(c.success("更新成功"),a.url=v[a.keyword],y[a.keyword]=!1,await d(i.value-1,n.value)):c.error(e.message)}catch(e){c.error(e.message)}}async function G(a){try{const e=await U.delete(`/urls/admin/url/${a.keyword}`,{params:{keyword:a.keyword}});e.success?(await d(i.value-1,n.value),c.success("删除成功")):c.error(e.message)}catch(e){c.error(e.message)}}function D(a){y[a.keyword]=!y[a.keyword],y[a.keyword]&&(v[a.keyword]=a.url)}function K(a){return(i.value-1)*n.value+a+1}return(a,e)=>{const b=ie,p=ue,u=me,B=be,R=ye,j=fe,q=ce,W=pe;return m(),_("div",he,[V("div",Ce,[e[5]||(e[5]=V("span",null," 输入链接: ",-1)),r(b,{modelValue:o(l).url,"onUpdate:modelValue":e[0]||(e[0]=t=>o(l).url=t),placeholder:"https",clearable:"","flex-1":""},null,8,["modelValue"]),e[6]||(e[6]=V("span",null," 自定义短网址(选): ",-1)),r(b,{modelValue:o(l).keyword,"onUpdate:modelValue":e[1]||(e[1]=t=>o(l).keyword=t),clearable:""},null,8,["modelValue"]),r(p,{type:"primary",onClick:g},{default:s(()=>e[4]||(e[4]=[k(" 缩短 ",-1)])),_:1,__:[4]})]),se((m(),S(j,{data:o(z),border:!0,stripe:!0,size:"small","flex-1":""},{default:s(()=>[r(u,{type:"index",index:K,fixed:"left"}),r(u,{prop:"keyword",label:"短网址",width:"100",fixed:"left"},{default:s(({row:t})=>[r(B,{href:`${Ee}/${t.keyword}`,target:"_blank",style:{"white-space":"nowrap"}},{default:s(()=>[k(Y(t.keyword),1)]),_:2},1032,["href"])]),_:1}),r(u,{prop:"url",label:"原网址","min-width":"300"},{default:s(({row:t})=>[o(y)[t.keyword]?(m(),S(b,{key:1,modelValue:o(v)[t.keyword],"onUpdate:modelValue":h=>o(v)[t.keyword]=h},null,8,["modelValue","onUpdate:modelValue"])):(m(),_($,{key:0},[t.title?(m(),_($,{key:0},[r(B,{href:t.url,target:"_blank"},{default:s(()=>[k(Y(t.title),1)]),_:2},1032,["href"]),e[7]||(e[7]=V("br",null,null,-1))],64)):x("",!0),r(B,{href:t.url,target:"_blank"},{default:s(()=>[k(Y(t.url),1)]),_:2},1032,["href"])],64))]),_:1}),r(u,{prop:"createdAt",label:"日期",width:"180"}),r(u,{prop:"ip",label:"IP",width:"130"}),r(u,{prop:"clicks",label:"点击次数",width:"80"}),r(u,{label:"操作",width:"140",fixed:"right"},{default:s(({row:t})=>[o(y)[t.keyword]?(m(),_($,{key:1},[r(p,{size:"small",onClick:h=>D(t)},{default:s(()=>e[10]||(e[10]=[k(" 取消 ",-1)])),_:2,__:[10]},1032,["onClick"]),r(p,{size:"small",type:"primary",onClick:h=>F(t)},{default:s(()=>e[11]||(e[11]=[k(" 更新 ",-1)])),_:2,__:[11]},1032,["onClick"])],64)):(m(),_($,{key:0},[r(p,{size:"small",onClick:h=>D(t)},{default:s(()=>e[8]||(e[8]=[k(" 编辑 ",-1)])),_:2,__:[8]},1032,["onClick"]),r(R,{width:"160",title:"删除后无法恢复！","confirm-button-type":"danger","confirm-button-text":"删除",onConfirm:h=>G(t)},{reference:s(()=>[r(p,{size:"small",type:"danger"},{default:s(()=>e[9]||(e[9]=[k(" 删除 ",-1)])),_:1,__:[9]})]),_:2},1032,["onConfirm"])],64))]),_:1})]),_:1},8,["data"])),[[W,o(w)]]),r(q,{"current-page":o(i),"onUpdate:currentPage":e[2]||(e[2]=t=>H(i)?i.value=t:null),"page-size":o(n),"onUpdate:pageSize":e[3]||(e[3]=t=>H(n)?n.value=t:null),small:"",background:"",layout:"prev, pager, next",total:o(f)},null,8,["current-page","page-size","total"])])}}}),qe=de(ze,[["__scopeId","data-v-8b60c8af"]]);export{qe as default};
