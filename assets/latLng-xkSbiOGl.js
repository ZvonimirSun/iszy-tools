import{aC as k,bN as l,a$ as s,K as y,X as p,a1 as c,ap as w,T as b,J as x,bJ as T,ar as M,az as _,as as C}from"./index-rTb2sAFH.js";import{E as v}from"./el-space-axLwH_z3.js";import{l as o}from"./leaflet-src-OCMNGFmc.js";import{m as N,c as i,C as d}from"./marker-shadow-fpwlardg.js";o.Icon.Default.prototype.options.shadowUrl=N;const Z=new o.Icon({...o.Icon.Default.prototype.options,iconUrl:"https://jsdelivr.cdn.iszy.xyz/gh/zvonimirsun/leaflet-color-markers@master/img/marker-icon-green.png",iconRetinaUrl:"https://jsdelivr.cdn.iszy.xyz/gh/zvonimirsun/leaflet-color-markers@master/img/marker-icon-2x-green.png"}),z=new o.Icon({...o.Icon.Default.prototype.options,iconUrl:"https://jsdelivr.cdn.iszy.xyz/gh/zvonimirsun/leaflet-color-markers@master/img/marker-icon-yellow.png",iconRetinaUrl:"https://jsdelivr.cdn.iszy.xyz/gh/zvonimirsun/leaflet-color-markers@master/img/marker-icon-2x-yellow.png"}),$={name:"LatLng",data:()=>({map:void 0,centerMarker:void 0,clickMarker:void 0,tdtToken:"bed806b1ccb34b268ab1c0700123d444",gaodeToken:"868d6830a7409520ae283cde3a3f84d1",latLng:{lng:"",lat:""},address:"",keyword:""}),mounted(){this.initMap()},methods:{initMap(){this.map=l(o.map(this.$refs.mapContainer,{attributionControl:!0,zoomControl:!1,minZoom:4,trackResize:!0})),this.map.setView([35,105],4),o.control.layers({高德矢量:i("GaoDe.Normal.Map",{maxNativeZoom:18,maxZoom:20,attribution:'&copy; <a href="https://lbs.amap.com/pages/terms/" target="_blank">高德地图</a> 贡献者'}).addTo(this.map),高德影像:o.layerGroup([i("GaoDe.Satellite.Map",{maxNativeZoom:18,maxZoom:20}),i("GaoDe.Satellite.Annotation",{maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://lbs.amap.com/pages/terms/" target="_blank">高德地图</a> 贡献者'}),谷歌矢量:o.layerGroup([i("Google.Normal.Map",{maxZoom:20})],{attribution:'&copy; <a href="https://www.google.com/maps" target="_blank">谷歌地图</a> 贡献者'}),谷歌影像:o.layerGroup([i("Google.Satellite.Map",{maxZoom:20}),i("Google.Satellite.Annotation",{maxZoom:20})],{attribution:'&copy; <a href="https://www.google.com/maps" target="_blank">谷歌地图</a> 贡献者'}),OpenStreetMap:i("OSM.Normal.Map",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> 贡献者',maxNativeZoom:19,maxZoom:20}),天地图矢量:o.layerGroup([i("TianDiTu.Normal.Map",{key:this.tdtToken,maxNativeZoom:18,maxZoom:20}),i("TianDiTu.Normal.Annotation",{key:this.tdtToken,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">天地图</a> 贡献者'}),天地图影像:o.layerGroup([i("TianDiTu.Satellite.Map",{key:this.tdtToken,maxNativeZoom:18,maxZoom:20}),i("TianDiTu.Satellite.Annotation",{key:this.tdtToken,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">天地图</a> 贡献者'}),天地图地形:o.layerGroup([i("TianDiTu.Terrain.Map",{key:this.tdtToken,maxNativeZoom:14,maxZoom:20}),i("TianDiTu.Terrain.Annotation",{key:this.tdtToken,maxNativeZoom:14,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">天地图</a> 贡献者'})},{},{hideSingleBase:!0,position:"bottomleft"}).addTo(this.map),o.control.scale({imperial:!1,position:"bottomright"}).addTo(this.map),o.control.zoom({zoomInTitle:"放大",zoomOutTitle:"缩小",position:"topright"}).addTo(this.map),this.centerMarker=l(o.marker(this.map.getCenter(),{icon:Z})).addTo(this.map).bindPopup(this.getPopupContent(this.map.getCenter()),{autoPan:!1,autoClose:!1,closeOnEscapeKey:!1,closeOnClick:!1}).on("popupopen",()=>{this.clickMarker&&this.clickMarker.closePopup()}).openPopup(),this.map.on("move",()=>{this.centerMarker.setLatLng(this.map.getCenter()).getPopup().setContent(this.getPopupContent(this.map.getCenter()))}),this.map.on("click",t=>{this.keyword=`${t.latlng.lng},${t.latlng.lat}`,this.locateLatLng(t.latlng,null,!1)}),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(t=>{this.keyword||(this.keyword=`${t.coords.longitude},${t.coords.latitude}`),this.map.setView([t.coords.latitude,t.coords.longitude],16)})},getPopupContent(t,e){const r=t.lat;let a=t.lng%360;a<=-180&&(a+=360);let n="";return r>=0?n+=`<p>北纬N: ${Math.abs(r)}</p>`:n+=`<p>南纬S: ${Math.abs(r)}</p>`,a>=0?n+=`<p>东经E: ${Math.abs(a)}</p>`:n+=`<p>西经W: ${Math.abs(a)}</p>`,r>=0?n+=`<p>北纬N: ${this.formatDegree(Math.abs(r))}</p>`:n+=`<p>南纬S: ${this.formatDegree(Math.abs(r))}</p>`,a>=0?n+=`<p>东经E: ${this.formatDegree(a)}</p>`:n+=`<p>西经W: ${this.formatDegree(a)}</p>`,e&&(n+=`<p>地址: ${e}</p>`),n},handler(){if(!this.keyword)return;const t=this.keyword.replace(/，/g,",").split(",");if(t.length===2&&!isNaN(parseFloat(t[0].trim()))&&!isNaN(parseFloat(t[1].trim()))){this.latLng.lng=parseFloat(t[0].trim()),this.latLng.lat=parseFloat(t[1].trim()),this.locateLatLng(this.latLng);return}this.address=this.keyword,this.locateAddress()},async locateLatLng(t={},e,r=!0){if(t.lng!=null&&t.lat!=null&&t.lng!==""&&t.lat!=="")try{if(!e)try{const a=d.prototype.csysConvert.gps84_To_gcj02(t.lng,t.lat),n=await this.$axios.get("https://amap.api.iszy.xyz/v3/geocode/regeo",{params:{location:`${a.lng},${a.lat}`,output:"json",key:this.gaodeToken,homeorcorp:1}});n.data.status==="1"&&n.data.regeocode.formatted_address?e=n.data.regeocode.formatted_address:s.warning("未找到相关地址。")}catch{s.error("查询地址失败！")}this.clickMarker?(this.clickMarker.setLatLng(t).getPopup().setContent(this.getPopupContent(t,e)),this.clickMarker.openPopup()):this.clickMarker=l(o.marker(t,{icon:z})).addTo(this.map).bindPopup(this.getPopupContent(t,e),{autoPan:!1,autoClose:!1,closeOnEscapeKey:!1,closeOnClick:!1,maxWidth:350}).on("popupopen",()=>{this.centerMarker&&this.centerMarker.closePopup()}).openPopup(),r&&this.map.setView(t,16)}catch{s.error("定位失败!")}},async locateAddress(){if(this.address)try{const t=await this.$axios.get("https://amap.api.iszy.xyz/v3/geocode/geo",{params:{address:this.address,key:this.gaodeToken}});if(t.data.status==="1"&&Number(t.data.count)>0){const e=t.data.geocodes[0],r=d.prototype.csysConvert.gcj02_To_gps84(parseFloat(e.location.split(",")[0]),parseFloat(e.location.split(",")[1]));await this.locateLatLng({lat:r.lat,lng:r.lng},e.formatted_address)}else s.warning("未找到相关地址。")}catch{s.error("查询地址失败!")}},formatDegree(t){t=Math.abs(t);const e=Math.floor(t),r=Math.floor((t-e)*60),a=((t-e)*3600%60).toFixed(2);return e+"° "+(r<10?"0"+r:r)+"' "+(a<10?"0"+a:a)+'" '}}},D={ref:"mapContainer",class:"mapContainer"};function P(t,e,r,a,n,m){const h=_,g=C,u=v;return x(),y(b,null,[p(u,{size:8,alignment:"center"},{default:c(()=>[p(h,{modelValue:t.keyword,"onUpdate:modelValue":e[0]||(e[0]=f=>t.keyword=f),placeholder:"输入经纬度(如'116.4,36.9')或地址(如'北京市政府')","allow-clear":"",onKeypress:T(m.handler,["enter"])},null,8,["modelValue","onKeypress"]),p(g,{type:"primary",onClick:m.handler},{default:c(()=>[M(" 解析 ")]),_:1},8,["onClick"])]),_:1}),w("div",D,null,512)],64)}const I=k($,[["render",P],["__scopeId","data-v-dceaa629"]]);export{I as default};
