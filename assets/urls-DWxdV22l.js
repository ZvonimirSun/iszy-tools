import{b as R,aK as X,_ as O,a as j,a_ as W,cf as Z,c as I,au as L,u as ee,t as _,o as c,g as B,x as S,r as T,w as s,j as le,y as r,aF as te,h as A,k as ae,I as E,U as M,J as ne,$ as oe,X as re,bl as V,bk as N,aq as m,v as z,a7 as se,C as o,L as ie,D as g,E as ue,z as P,N as x,M as H,Q as de}from"./index-BrEFJmNm.js";import{v as pe}from"./el-loading-BjldzHwI.js";import{E as me}from"./el-pagination-b4meRaa-.js";/* empty css               */import"./el-select-CUnxjtUP.js";import"./el-popper-CycdaFL5.js";import{E as ce,a as fe}from"./el-table-column-C8zsGP4r.js";import"./el-checkbox-CNjsJKbA.js";/* empty css                   */import{E as ke}from"./el-popover-C5Qv6a_m.js";import"./index-DWrve-4c.js";import"./strings-LK1QCitN.js";import"./castArray-BcYYRqOe.js";import"./_baseIteratee-C3s6jKTb.js";import"./clamp-Bq1YGdY0.js";import"./index-BMcsbbEc.js";import"./map-DCXU-w_n.js";import"./_baseEach-DC-fgxsx.js";import"./raf-DU2shjrS.js";import"./omit-B9uZVM92.js";import"./last-D-rYfuUG.js";const ve=R({type:{type:String,values:["primary","success","warning","info","danger","default"],default:void 0},underline:{type:[Boolean,String],values:[!0,!1,"always","never","hover"],default:void 0},disabled:Boolean,href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:X}}),ye={click:$=>$ instanceof MouseEvent},ge=["href","target"],we=j({name:"ElLink",__name:"link",props:ve,emits:ye,setup($,{emit:U}){const n=$,u=U,b=W("link");Z({scope:"el-link",from:"The underline option (boolean)",replacement:"'always' | 'hover' | 'never'",version:"3.0.0",ref:"https://element-plus.org/en-US/component/link.html#underline"},I(()=>L(n.underline)));const f=ee("link"),k=I(()=>{var l,y,w;return[f.b(),f.m((w=(y=n.type)!=null?y:(l=b.value)==null?void 0:l.type)!=null?w:"default"),f.is("disabled",n.disabled),f.is("underline",v.value==="always"),f.is("hover-underline",v.value==="hover"&&!n.disabled)]}),v=I(()=>{var l,y,w;return L(n.underline)?n.underline?"hover":"never":(w=(y=n.underline)!=null?y:(l=b.value)==null?void 0:l.underline)!=null?w:"hover"});function p(l){n.disabled||u("click",l)}return(l,y)=>(c(),_("a",{class:A(k.value),href:l.disabled||!l.href?void 0:l.href,target:l.disabled||!l.href?void 0:l.target,onClick:p},[l.icon?(c(),B(r(te),{key:0},{default:s(()=>[(c(),B(le(l.icon)))]),_:1})):S("v-if",!0),l.$slots.default?(c(),_("span",{key:1,class:A(r(f).e("inner"))},[T(l.$slots,"default")],2)):S("v-if",!0),l.$slots.icon?T(l.$slots,"icon",{key:2}):S("v-if",!0)],10,ge))}});var _e=O(we,[["__file","/home/runner/work/element-plus/element-plus/packages/components/link/src/link.vue"]]);const be=ae(_e),he={"h-full":"",flex:"","flex-col":"","gap-4":""},Ce={class:"new-url-form"},Ee="https://url.ovooo.cc",$e=j({__name:"urls",setup($){const U=E([]),n=E(10),u=E(1),b=E(0),f=E(!1),k=M({}),v=M({}),p=M({keyword:"",url:""});ne(()=>{l(u.value-1,n.value)}),oe(()=>{l(u.value-1,n.value)}),re(n,()=>{u.value=1});async function l(a,e){const h=setTimeout(()=>{f.value=!0},300);try{const d=await V.get("/urls/admin/urls",{params:{pageIndex:a,pageSize:e}});d.success?(b.value=d.data.count,U.value=d.data.rows.map(i=>(i.createdAt=N(i.createdAt).format("YYYY年MM月DD日 HH:mm"),i.updatedAt=N(i.updatedAt).format("YYYY年MM月DD日 HH:mm"),i))):m.error(d.message)}catch(d){m.error(d.message)}clearTimeout(h),f.value=!1}async function y(){if(p.url)try{const a=await V.post("/urls/admin/url",{url:p.url,keyword:p.keyword});a.success?(m.success("创建成功"),p.url="",p.keyword="",await l(u.value-1,n.value)):m.error(a.message)}catch(a){m.error(a.message)}}async function w(a){try{const e=await V.put(`/urls/admin/url/${a.keyword}`,{url:v[a.keyword]});e.success?(m.success("更新成功"),a.url=v[a.keyword],k[a.keyword]=!1,await l(u.value-1,n.value)):m.error(e.message)}catch(e){m.error(e.message)}}async function F(a){try{const e=await V.delete(`/urls/admin/url/${a.keyword}`,{params:{keyword:a.keyword}});e.success?(await l(u.value-1,n.value),m.success("删除成功")):m.error(e.message)}catch(e){m.error(e.message)}}function Y(a){k[a.keyword]=!k[a.keyword],k[a.keyword]&&(v[a.keyword]=a.url)}function K(a){return(u.value-1)*n.value+a+1}return(a,e)=>{const h=ie,d=ue,i=ce,D=be,q=ke,G=fe,J=me,Q=pe;return c(),_("div",he,[z("div",Ce,[e[5]||(e[5]=z("span",null," 输入链接: ",-1)),o(h,{modelValue:r(p).url,"onUpdate:modelValue":e[0]||(e[0]=t=>r(p).url=t),placeholder:"https",clearable:"","flex-1":""},null,8,["modelValue"]),e[6]||(e[6]=z("span",null," 自定义短网址(选): ",-1)),o(h,{modelValue:r(p).keyword,"onUpdate:modelValue":e[1]||(e[1]=t=>r(p).keyword=t),clearable:""},null,8,["modelValue"]),o(d,{type:"primary",onClick:y},{default:s(()=>[...e[4]||(e[4]=[g(" 缩短 ",-1)])]),_:1})]),se((c(),B(G,{data:r(U),border:!0,stripe:!0,size:"small","flex-1":""},{default:s(()=>[o(i,{type:"index",index:K,fixed:"left"}),o(i,{prop:"keyword",label:"短网址",width:"100",fixed:"left"},{default:s(({row:t})=>[o(D,{href:`${Ee}/${t.keyword}`,target:"_blank",style:{"white-space":"nowrap"}},{default:s(()=>[g(P(t.keyword),1)]),_:2},1032,["href"])]),_:1}),o(i,{prop:"url",label:"原网址","min-width":"300"},{default:s(({row:t})=>[r(k)[t.keyword]?(c(),B(h,{key:1,modelValue:r(v)[t.keyword],"onUpdate:modelValue":C=>r(v)[t.keyword]=C},null,8,["modelValue","onUpdate:modelValue"])):(c(),_(x,{key:0},[t.title?(c(),_(x,{key:0},[o(D,{href:t.url,target:"_blank"},{default:s(()=>[g(P(t.title),1)]),_:2},1032,["href"]),e[7]||(e[7]=z("br",null,null,-1))],64)):S("",!0),o(D,{href:t.url,target:"_blank"},{default:s(()=>[g(P(t.url),1)]),_:2},1032,["href"])],64))]),_:1}),o(i,{prop:"createdAt",label:"日期",width:"180"}),o(i,{prop:"ip",label:"IP",width:"130"}),o(i,{prop:"clicks",label:"点击次数",width:"80"}),o(i,{label:"操作",width:"140",fixed:"right"},{default:s(({row:t})=>[r(k)[t.keyword]?(c(),_(x,{key:1},[o(d,{size:"small",onClick:C=>Y(t)},{default:s(()=>[...e[10]||(e[10]=[g(" 取消 ",-1)])]),_:1},8,["onClick"]),o(d,{size:"small",type:"primary",onClick:C=>w(t)},{default:s(()=>[...e[11]||(e[11]=[g(" 更新 ",-1)])]),_:1},8,["onClick"])],64)):(c(),_(x,{key:0},[o(d,{size:"small",onClick:C=>Y(t)},{default:s(()=>[...e[8]||(e[8]=[g(" 编辑 ",-1)])]),_:1},8,["onClick"]),o(q,{width:"160",title:"删除后无法恢复！","confirm-button-type":"danger","confirm-button-text":"删除",onConfirm:C=>F(t)},{reference:s(()=>[o(d,{size:"small",type:"danger"},{default:s(()=>[...e[9]||(e[9]=[g(" 删除 ",-1)])]),_:1})]),_:1},8,["onConfirm"])],64))]),_:1})]),_:1},8,["data"])),[[Q,r(f)]]),o(J,{"current-page":r(u),"onUpdate:currentPage":e[2]||(e[2]=t=>H(u)?u.value=t:null),"page-size":r(n),"onUpdate:pageSize":e[3]||(e[3]=t=>H(n)?n.value=t:null),small:"",background:"",layout:"prev, pager, next",total:r(b)},null,8,["current-page","page-size","total"])])}}}),Je=de($e,[["__scopeId","data-v-5b66f74b"]]);export{Je as default};
