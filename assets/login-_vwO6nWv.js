import{k as q,a4 as z,R as w,J as U,at as K,aw as F,a7 as I,T as P,ab as R,aA as v,E as S,r as T,F as l,K as s,w as a,W as M,bk as E,x as n,L as Q,N as b,aB as A,ax as D,a0 as G}from"./index-PYN4Dtwr.js";import{E as H}from"./el-space-VE8MOXOA.js";import{E as J}from"./el-divider-BCjlJUHa.js";import{E as O,a as W}from"./el-form-item-CsEUCq72.js";import"./castArray-Eksu3iu2.js";const $={class:"login-container"},j={class:"main"},X=q({__name:"login",setup(Y){const t=z({userName:"",password:""}),u=w(),d=w({}),i=w(!1),p=U(),h=K(),c=F();I(h,o=>{const e=o.query;e&&(typeof e.redirect=="string"&&(u.value=e.redirect),d.value=L(e))},{immediate:!0}),P(()=>{c.logged&&p.push({path:u.value||"/",query:d.value})}),R(()=>{window.removeEventListener("message",f)});async function m(){if(!navigator.onLine){v.warning("已离线！");return}if(t.userName!=null&&t.password!=null){i.value=!0;try{await c.login({userName:t.userName,password:t.password}),y()}catch(o){o instanceof Error&&v.error(o.message)}i.value=!1}}function N(){p.push("/register")}function x(){window.addEventListener("message",f),window.open(`${D.apiBaseUrl}/auth/github`,"_blank")}async function f(o){var r;const e=o.source;((r=o.data)==null?void 0:r.type)==="oauth_complete"&&(window.removeEventListener("message",f),e.close(),await c.checkThirdPartyLogin(),y())}function y(){v.success("登录成功！"),p.push({path:u.value||"/",query:d.value})}function L(o){const{redirect:e,...r}=o;return r}return(o,e)=>{const r=M,g=O,k=Q,V=W,B=J,C=H;return T(),S("div",$,[l("div",j,[s(V,A({layout:"horizontal",model:n(t)},{wrapperCol:{span:24}}),{default:a(()=>[s(g,{required:""},{default:a(()=>[s(r,{modelValue:n(t).userName,"onUpdate:modelValue":e[0]||(e[0]=_=>n(t).userName=_),placeholder:"账户",size:"large",onKeypress:E(m,["enter"])},{prefix:a(()=>e[2]||(e[2]=[l("span",{class:"i-icon-park-outline-user"},null,-1)])),_:1},8,["modelValue"])]),_:1}),s(g,{required:""},{default:a(()=>[s(r,{modelValue:n(t).password,"onUpdate:modelValue":e[1]||(e[1]=_=>n(t).password=_),type:"password",placeholder:"密码",size:"large","show-password":"",onKeypress:E(m,["enter"])},{prefix:a(()=>e[3]||(e[3]=[l("span",{class:"i-icon-park-outline-lock"},null,-1)])),_:1},8,["modelValue"])]),_:1}),s(g,null,{default:a(()=>[s(k,{type:"primary",block:"",size:"large",loading:n(i),onClick:m},{default:a(()=>e[4]||(e[4]=[b(" 登录 ")])),_:1},8,["loading"]),s(k,{block:"",size:"large",disabled:n(i),onClick:N},{default:a(()=>e[5]||(e[5]=[b(" 注册 ")])),_:1},8,["disabled"])]),_:1})]),_:1},16,["model"]),s(B),s(C,null,{default:a(()=>[l("div",{class:"third-party",title:"GitHub登录",onClick:x},e[6]||(e[6]=[l("i",{class:"i-icon-park-outline:github"},null,-1)]))]),_:1})])])}}}),ae=G(X,[["__scopeId","data-v-01a50a96"]]);export{ae as default};
