import{bY as V,g as ve,a5 as ie,a9 as me,as as J,h as ee,S as fe,cF as ke,cG as Ie,aH as pe,j as ge,cc as _e,y as k,cH as Le,a0 as ze,k as v,D as ce,ab as we,R as ye,o as w,c as ue,a as u,w as L,m as g,p as d,n as t,a1 as de,aL as Ce,s as z,ah as N,ak as Se,l as E,G as Q,ai as Ee,aj as xe,cI as Ne,bs as Oe,q as Te,cJ as $e,cK as Re,H as Ae,T as Be,U as Ve,r as U,aU as Me,b0 as Ye,v as be,al as B,aC as M,cL as He,x as he,cM as De,cN as Pe,t as Xe,bz as Fe,bZ as je,ar as Ke,cO as We,cP as Ze}from"./index-d7e38869.js";import{t as re}from"./throttle-21dc024f.js";const Ge=(c,y)=>{if(!V||!c||!y)return!1;const o=c.getBoundingClientRect();let s;return y instanceof Element?s=y.getBoundingClientRect():s={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},o.top<s.bottom&&o.bottom>s.top&&o.right>s.left&&o.left<s.right},qe=ve({urlList:{type:ie(Array),default:()=>me([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7}}),Ue={close:()=>!0,switch:c=>J(c),rotate:c=>J(c)},Je=["src"],Qe=ee({name:"ElImageViewer"}),ea=ee({...Qe,props:qe,emits:Ue,setup(c,{expose:y,emit:o}){const s=c,O={CONTAIN:{name:"contain",icon:fe(ke)},ORIGINAL:{name:"original",icon:fe(Ie)}},{t:C}=pe(),r=ge("image-viewer"),{nextZIndex:ae}=_e(),T=k(),x=k([]),S=Le(),I=k(!0),m=k(s.initialIndex),p=ze(O.CONTAIN),i=k({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),Y=v(()=>{const{urlList:a}=s;return a.length<=1}),R=v(()=>m.value===0),X=v(()=>m.value===s.urlList.length-1),te=v(()=>s.urlList[m.value]),ne=v(()=>[r.e("btn"),r.e("prev"),r.is("disabled",!s.infinite&&R.value)]),H=v(()=>[r.e("btn"),r.e("next"),r.is("disabled",!s.infinite&&X.value)]),se=v(()=>{const{scale:a,deg:n,offsetX:l,offsetY:b,enableTransition:_}=i.value;let f=l/a,h=b/a;switch(n%360){case 90:case-270:[f,h]=[h,-f];break;case 180:case-180:[f,h]=[-f,-h];break;case 270:case-90:[f,h]=[-h,f];break}const A={transform:`scale(${a}) rotate(${n}deg) translate(${f}px, ${h}px)`,transition:_?"transform .3s":""};return p.value.name===O.CONTAIN.name&&(A.maxWidth=A.maxHeight="100%"),A}),F=v(()=>J(s.zIndex)?s.zIndex:ae());function $(){oe(),o("close")}function le(){const a=re(l=>{switch(l.code){case B.esc:s.closeOnPressEscape&&$();break;case B.space:Z();break;case B.left:G();break;case B.up:e("zoomIn");break;case B.right:q();break;case B.down:e("zoomOut");break}}),n=re(l=>{const b=l.deltaY||l.deltaX;e(b<0?"zoomIn":"zoomOut",{zoomRate:s.zoomRate,enableTransition:!1})});S.run(()=>{M(document,"keydown",a),M(document,"wheel",n)})}function oe(){S.stop()}function j(){I.value=!1}function K(a){I.value=!1,a.target.alt=C("el.image.error")}function W(a){if(I.value||a.button!==0||!T.value)return;i.value.enableTransition=!1;const{offsetX:n,offsetY:l}=i.value,b=a.pageX,_=a.pageY,f=re(A=>{i.value={...i.value,offsetX:n+A.pageX-b,offsetY:l+A.pageY-_}}),h=M(document,"mousemove",f);M(document,"mouseup",()=>{h()}),a.preventDefault()}function D(){i.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function Z(){if(I.value)return;const a=He(O),n=Object.values(O),l=p.value.name,_=(n.findIndex(f=>f.name===l)+1)%a.length;p.value=O[a[_]],D()}function P(a){const n=s.urlList.length;m.value=(a+n)%n}function G(){R.value&&!s.infinite||P(m.value-1)}function q(){X.value&&!s.infinite||P(m.value+1)}function e(a,n={}){if(I.value)return;const{minScale:l,maxScale:b}=s,{zoomRate:_,rotateDeg:f,enableTransition:h}={zoomRate:s.zoomRate,rotateDeg:90,enableTransition:!0,...n};switch(a){case"zoomOut":i.value.scale>l&&(i.value.scale=Number.parseFloat((i.value.scale/_).toFixed(3)));break;case"zoomIn":i.value.scale<b&&(i.value.scale=Number.parseFloat((i.value.scale*_).toFixed(3)));break;case"clockwise":i.value.deg+=f,o("rotate",i.value.deg);break;case"anticlockwise":i.value.deg-=f,o("rotate",i.value.deg);break}i.value.enableTransition=h}return ce(te,()=>{we(()=>{const a=x.value[0];a!=null&&a.complete||(I.value=!0)})}),ce(m,a=>{D(),o("switch",a)}),ye(()=>{var a,n;le(),(n=(a=T.value)==null?void 0:a.focus)==null||n.call(a)}),y({setActiveItem:P}),(a,n)=>(w(),ue(Ye,{to:"body",disabled:!a.teleported},[u(Me,{name:"viewer-fade",appear:""},{default:L(()=>[g("div",{ref_key:"wrapper",ref:T,tabindex:-1,class:d(t(r).e("wrapper")),style:de({zIndex:t(F)})},[g("div",{class:d(t(r).e("mask")),onClick:n[0]||(n[0]=Ce(l=>a.hideOnClickModal&&$(),["self"]))},null,2),z(" CLOSE "),g("span",{class:d([t(r).e("btn"),t(r).e("close")]),onClick:$},[u(t(N),null,{default:L(()=>[u(t(Se))]),_:1})],2),z(" ARROW "),t(Y)?z("v-if",!0):(w(),E(Q,{key:0},[g("span",{class:d(t(ne)),onClick:G},[u(t(N),null,{default:L(()=>[u(t(Ee))]),_:1})],2),g("span",{class:d(t(H)),onClick:q},[u(t(N),null,{default:L(()=>[u(t(xe))]),_:1})],2)],64)),z(" ACTIONS "),g("div",{class:d([t(r).e("btn"),t(r).e("actions")])},[g("div",{class:d(t(r).e("actions__inner"))},[u(t(N),{onClick:n[1]||(n[1]=l=>e("zoomOut"))},{default:L(()=>[u(t(Ne))]),_:1}),u(t(N),{onClick:n[2]||(n[2]=l=>e("zoomIn"))},{default:L(()=>[u(t(Oe))]),_:1}),g("i",{class:d(t(r).e("actions__divider"))},null,2),u(t(N),{onClick:Z},{default:L(()=>[(w(),ue(Te(t(p).icon)))]),_:1}),g("i",{class:d(t(r).e("actions__divider"))},null,2),u(t(N),{onClick:n[3]||(n[3]=l=>e("anticlockwise"))},{default:L(()=>[u(t($e))]),_:1}),u(t(N),{onClick:n[4]||(n[4]=l=>e("clockwise"))},{default:L(()=>[u(t(Re))]),_:1})],2)],2),z(" CANVAS "),g("div",{class:d(t(r).e("canvas"))},[(w(!0),E(Q,null,Ae(a.urlList,(l,b)=>Be((w(),E("img",{ref_for:!0,ref:_=>x.value[b]=_,key:l,src:l,style:de(t(se)),class:d(t(r).e("img")),onLoad:j,onError:K,onMousedown:W},null,46,Je)),[[Ve,b===m.value]])),128))],2),U(a.$slots,"default")],6)]),_:3})],8,["disabled"]))}});var aa=be(ea,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const ta=he(aa),na=ve({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:ie([String,Object])},previewSrcList:{type:ie(Array),default:()=>me([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7}}),sa={load:c=>c instanceof Event,error:c=>c instanceof Event,switch:c=>J(c),close:()=>!0,show:()=>!0},la=["src","loading"],oa={key:0},ra=ee({name:"ElImage",inheritAttrs:!1}),ia=ee({...ra,props:na,emits:sa,setup(c,{emit:y}){const o=c;let s="";const{t:O}=pe(),C=ge("image"),r=De(),ae=Pe(),T=k(),x=k(!1),S=k(!0),I=k(!1),m=k(),p=k(),i=V&&"loading"in HTMLImageElement.prototype;let Y,R;const X=v(()=>[C.e("inner"),H.value&&C.e("preview"),S.value&&C.is("loading")]),te=v(()=>r.style),ne=v(()=>{const{fit:e}=o;return V&&e?{objectFit:e}:{}}),H=v(()=>{const{previewSrcList:e}=o;return Array.isArray(e)&&e.length>0}),se=v(()=>{const{previewSrcList:e,initialIndex:a}=o;let n=a;return a>e.length-1&&(n=0),n}),F=v(()=>o.loading==="eager"?!1:!i&&o.loading==="lazy"||o.lazy),$=()=>{V&&(S.value=!0,x.value=!1,T.value=o.src)};function le(e){S.value=!1,x.value=!1,y("load",e)}function oe(e){S.value=!1,x.value=!0,y("error",e)}function j(){Ge(m.value,p.value)&&($(),D())}const K=Ze(j,200,!0);async function W(){var e;if(!V)return;await we();const{scrollContainer:a}=o;je(a)?p.value=a:Ke(a)&&a!==""?p.value=(e=document.querySelector(a))!=null?e:void 0:m.value&&(p.value=We(m.value)),p.value&&(Y=M(p,"scroll",K),setTimeout(()=>j(),100))}function D(){!V||!p.value||!K||(Y==null||Y(),p.value=void 0)}function Z(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}function P(){H.value&&(R=M("wheel",Z,{passive:!1}),s=document.body.style.overflow,document.body.style.overflow="hidden",I.value=!0,y("show"))}function G(){R==null||R(),document.body.style.overflow=s,I.value=!1,y("close")}function q(e){y("switch",e)}return ce(()=>o.src,()=>{F.value?(S.value=!0,x.value=!1,D(),W()):$()}),ye(()=>{F.value?W():$()}),(e,a)=>(w(),E("div",{ref_key:"container",ref:m,class:d([t(C).b(),e.$attrs.class]),style:de(t(te))},[x.value?U(e.$slots,"error",{key:0},()=>[g("div",{class:d(t(C).e("error"))},Xe(t(O)("el.image.error")),3)]):(w(),E(Q,{key:1},[T.value!==void 0?(w(),E("img",Fe({key:0},t(ae),{src:T.value,loading:e.loading,style:t(ne),class:t(X),onClick:P,onLoad:le,onError:oe}),null,16,la)):z("v-if",!0),S.value?(w(),E("div",{key:1,class:d(t(C).e("wrapper"))},[U(e.$slots,"placeholder",{},()=>[g("div",{class:d(t(C).e("placeholder"))},null,2)])],2)):z("v-if",!0)],64)),t(H)?(w(),E(Q,{key:2},[I.value?(w(),ue(t(ta),{key:0,"z-index":e.zIndex,"initial-index":t(se),infinite:e.infinite,"zoom-rate":e.zoomRate,"min-scale":e.minScale,"max-scale":e.maxScale,"url-list":e.previewSrcList,"hide-on-click-modal":e.hideOnClickModal,teleported:e.previewTeleported,"close-on-press-escape":e.closeOnPressEscape,onClose:G,onSwitch:q},{default:L(()=>[e.$slots.viewer?(w(),E("div",oa,[U(e.$slots,"viewer")])):z("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","url-list","hide-on-click-modal","teleported","close-on-press-escape"])):z("v-if",!0)],64)):z("v-if",!0)],6))}});var ca=be(ia,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const fa=he(ca);export{fa as E};
