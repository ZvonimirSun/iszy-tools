import"./index-1d25e7f7.js";import{g as we,cI as Ce,d0 as ne,h as Y,aK as Ee,j as Te,y as f,k as B,o as r,c as S,w as s,T as j,m as i,p as V,n as e,ac as le,q as Ve,s as E,l as d,r as ae,b as m,t as g,H as k,a as n,U as F,Y as De,v as Ae,d1 as Ue,x as Me,z as M,I as O,A as te,E as Oe,_ as Be}from"./index-92751bf7.js";import{a as Ie,E as Ne}from"./el-form-item-ba44493d.js";import"./el-tag-7b7ab923.js";import{E as Le,a as $e}from"./el-select-95a2c582.js";import"./el-scrollbar-e2d9603a.js";import"./el-popper-3a0f6434.js";import{_ as Pe}from"./Title-d690b7ca.js";import{_ as je}from"./Paragraph-1667213b.js";import"./ResizeObserver.es-0f9f8adb.js";import"./isEqual-05fa933a.js";import"./strings-356d7fcf.js";const Fe=["light","dark"],Ke=we({title:{type:String,default:""},description:{type:String,default:""},type:{type:String,values:Ce(ne),default:"info"},closable:{type:Boolean,default:!0},closeText:{type:String,default:""},showIcon:Boolean,center:Boolean,effect:{type:String,values:Fe,default:"light"}}),ze={close:K=>K instanceof MouseEvent},He=Y({name:"ElAlert"}),We=Y({...He,props:Ke,emits:ze,setup(K,{emit:D}){const R=K,{Close:p}=Ue,v=Ee(),t=Te("alert"),A=f(!0),_=B(()=>ne[R.type]),I=B(()=>[t.e("icon"),{[t.is("big")]:!!R.description||!!v.default}]),z=B(()=>({[t.is("bold")]:R.description||v.default})),b=u=>{A.value=!1,D("close",u)};return(u,w)=>(r(),S(De,{name:e(t).b("fade"),persisted:""},{default:s(()=>[j(i("div",{class:V([e(t).b(),e(t).m(u.type),e(t).is("center",u.center),e(t).is(u.effect)]),role:"alert"},[u.showIcon&&e(_)?(r(),S(e(le),{key:0,class:V(e(I))},{default:s(()=>[(r(),S(Ve(e(_))))]),_:1},8,["class"])):E("v-if",!0),i("div",{class:V(e(t).e("content"))},[u.title||u.$slots.title?(r(),d("span",{key:0,class:V([e(t).e("title"),e(z)])},[ae(u.$slots,"title",{},()=>[m(g(u.title),1)])],2)):E("v-if",!0),u.$slots.default||u.description?(r(),d("p",{key:1,class:V(e(t).e("description"))},[ae(u.$slots,"default",{},()=>[m(g(u.description),1)])],2)):E("v-if",!0),u.closable?(r(),d(k,{key:2},[u.closeText?(r(),d("div",{key:0,class:V([e(t).e("close-btn"),e(t).is("customed")]),onClick:b},g(u.closeText),3)):(r(),S(e(le),{key:1,class:V(e(t).e("close-btn")),onClick:b},{default:s(()=>[n(e(p))]),_:1},8,["class"]))],64)):E("v-if",!0)],2)],2),[[F,A.value]])]),_:3},8,["name"]))}});var qe=Ae(We,[["__file","/home/runner/work/element-plus/element-plus/packages/components/alert/src/alert.vue"]]);const Ge=Me(qe);const Ye={key:0,class:"wrapper"},Je={class:"video-wrapper"},Qe={class:"previewVideo"},Xe=["src"],Ze={class:"operations"},xe={class:"settings-wrapper"},oe="unshare",el="unstart",P="recording",q="paused",se="stopped",ll=Y({__name:"screenRecord",setup(K){const D=f(),R=f();let p=null,v=null;const t=f(oe);let A=[];const _=f(""),I=f(!1),z=[{label:"否",value:"never"},{label:"是",value:"always"}],b=f("never"),u=[{label:"否",value:"never"},{label:"是",value:"always"}],w=f("never"),J=[{label:"默认",value:"default"},{label:"16:9",value:1.77},{label:"4:3",value:1.33},{label:"21:9",value:2.35},{label:"14:10",value:1.4},{label:"19:10",value:1.9}],N=f("default"),re=[{label:"默认",value:"default"},{label:"60",value:60},{label:"30",value:30},{label:"25",value:25},{label:"15",value:15},{label:"5",value:5}],L=f("default"),ue=[{label:"默认",value:"default"},{label:"屏幕尺寸",value:"fit-screen"},{label:"4K",value:"4k"},{label:"1080p",value:"1080p"},{label:"720p",value:"720p"}],H=f("default"),G=[{label:"默认",value:"default"},{label:"总是显示",value:"always"},{label:"移动时显示",value:"motion"},{label:"从不显示",value:"never"}],$=f("default"),W=(()=>navigator&&navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints?navigator.mediaDevices.getSupportedConstraints():{})(),ie=(()=>!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia))(),ce=(()=>!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia))(),de=ie&&ce,Q=B(()=>{switch(t.value){case P:return"REC";case q:return"PAUSE";default:return!1}}),pe=B(()=>{const a={};switch(typeof N.value=="number"&&(a.aspectRatio=N.value),typeof L.value=="number"&&(a.frameRate=L.value),$.value!=="default"&&(a.cursor=$.value),H.value){case"fit-screen":a.width=screen.width,a.height=screen.height;break;case"4K":a.width=3840,a.height=2160;break;case"1080p":a.width=1920,a.height=1080;break;case"720p":a.width=1280,a.height=720;break}return{video:a,audio:b.value==="always"}}),T=B(()=>{if(p){const a=p.getVideoTracks();if(a.length>0){const o=a[0].getSettings(),c={recordAudio:z.find(h=>b.value===h.value)?.label,recordMicro:u.find(h=>w.value===h.value)?.label,frameRate:o.frameRate,width:o.width,height:o.height,aspectRatio:"默认",cursor:""};if(o.aspectRatio){const h=o.aspectRatio,y=J.find(C=>typeof C.value=="number"?h-C.value<=.1:!1);y?c.aspectRatio=y.label:c.aspectRatio="默认"}if(o.cursor){const h=G.find(y=>o.cursor===y.value);h?c.cursor=h.label:c.cursor="默认"}return{video:c}}}return{video:{},audio:{}}});async function ve(){try{if(p=await navigator.mediaDevices.getDisplayMedia(pe.value),w.value==="always"){const o=await navigator.mediaDevices.getUserMedia({audio:!0});p.addTrack(o.getAudioTracks()[0])}const a=p.getVideoTracks()[0];a&&(a.onended=x,a.onmute=x),v=new MediaRecorder(p),v.onstop=ye,v.ondataavailable=ge,D.value.srcObject=p,D.value.muted=!0,t.value="unstart"}catch(a){te.error(a.message)}}function fe(){Z(),v?.start(),t.value=P}function me(){v?.pause(),t.value=q}function _e(){v?.resume(),t.value=P}function X(){v&&v.state!=="inactive"&&v.stop(),t.value=se}function Z(){_.value=""}function be(){if(_.value){const a=document.createElement("a");a.href=_.value,a.download="screen-record.mp4",a.click()}}function x(){if(X(),p)p.getTracks().forEach(o=>{o.stop()});else return;te.info("屏幕分享结束"),p=null,D.value.srcObject=null,t.value="unshare"}function ye(){const a=new Blob(A,{type:"video/mp4"});_.value=URL.createObjectURL(a),A=[];const o=setInterval(async()=>{R.value.readyState>0&&(R.value.duration===1/0?R.value.currentTime=1e7*Math.random():(clearInterval(o),R.value.currentTime=0))},200)}function ge(a){A.push(a.data)}function he(){b.value&&w.value&&(w.value="never")}function ke(){b.value&&w.value&&(b.value="never")}return(a,o)=>{const c=Oe,h=Ge,y=Le,C=$e,U=Ie,Se=Ne,ee=Pe,Re=je;return e(de)?(r(),d("div",Ye,[i("div",Je,[i("div",Qe,[j(i("video",{ref_key:"screenShareVideoElement",ref:D,autoplay:""},null,512),[[F,!e(_)]]),j(i("video",{ref_key:"recordVideoElement",ref:R,controls:"",src:e(_)},null,8,Xe),[[F,e(_)]]),j(i("span",{class:"rec"},g(e(Q)),513),[[F,e(Q)]])]),i("div",Ze,[n(c,{type:"primary",onClick:o[0]||(o[0]=l=>I.value=!e(I))},{default:s(()=>[m(" 设置 ")]),_:1}),e(t)===oe?(r(),S(c,{key:0,type:"primary",onClick:ve},{default:s(()=>[m(" 开启屏幕共享 ")]),_:1})):(r(),d(k,{key:1},[n(c,{type:"primary",disabled:e(t)===P||e(t)===q,onClick:fe},{default:s(()=>[m(" 开始录制 ")]),_:1},8,["disabled"]),n(c,{type:"primary",disabled:e(t)!==P,onClick:me},{default:s(()=>[m(" 暂停 ")]),_:1},8,["disabled"]),n(c,{type:"primary",disabled:e(t)!==q,onClick:_e},{default:s(()=>[m(" 继续 ")]),_:1},8,["disabled"]),n(c,{type:"primary",disabled:e(t)===el||e(t)===se,onClick:X},{default:s(()=>[m(" 停止 ")]),_:1},8,["disabled"])],64)),e(_)?(r(),d(k,{key:2},[n(c,{type:"primary",onClick:Z},{default:s(()=>[m(" 清除 ")]),_:1}),n(c,{type:"primary",onClick:be},{default:s(()=>[m(" 下载 ")]),_:1})],64)):E("",!0)])]),j(i("div",xe,[n(h,{title:"由于浏览器限制，部分设置可能无法生效",type:"warning","show-icon":"",style:{"margin-bottom":".8rem"}}),e(t)==="unshare"?(r(),S(Se,{key:0,"label-position":"top"},{default:s(()=>[n(U,{label:"系统音频"},{default:s(()=>[n(C,{modelValue:e(b),"onUpdate:modelValue":o[1]||(o[1]=l=>M(b)?b.value=l:null),onChange:he},{default:s(()=>[(r(),d(k,null,O(z,l=>n(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),n(U,{label:"麦克风"},{default:s(()=>[n(C,{modelValue:e(w),"onUpdate:modelValue":o[2]||(o[2]=l=>M(w)?w.value=l:null),onChange:ke},{default:s(()=>[(r(),d(k,null,O(u,l=>n(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(W).aspectRatio?(r(),S(U,{key:0,label:"选择长宽比"},{default:s(()=>[n(C,{modelValue:e(N),"onUpdate:modelValue":o[3]||(o[3]=l=>M(N)?N.value=l:null)},{default:s(()=>[(r(),d(k,null,O(J,l=>n(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(W).frameRate?(r(),S(U,{key:1,label:"选择帧率"},{default:s(()=>[n(C,{modelValue:e(L),"onUpdate:modelValue":o[4]||(o[4]=l=>M(L)?L.value=l:null)},{default:s(()=>[(r(),d(k,null,O(re,l=>n(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):E("",!0),e(W).width&&e(W).height?(r(),S(U,{key:2,label:"选择分辨率"},{default:s(()=>[n(C,{modelValue:e(H),"onUpdate:modelValue":o[5]||(o[5]=l=>M(H)?H.value=l:null)},{default:s(()=>[(r(),d(k,null,O(ue,l=>n(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):E("",!0),n(U,{label:"是否显示光标"},{default:s(()=>[n(C,{modelValue:e($),"onUpdate:modelValue":o[6]||(o[6]=l=>M($)?$.value=l:null),options:G},{default:s(()=>[(r(),d(k,null,O(G,l=>n(y,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})):(r(),d(k,{key:1},[n(ee,{level:4},{default:s(()=>[m(" 当前设置 ")]),_:1}),n(Re,null,{default:s(()=>[i("ul",null,[i("li",null,"系统音频: "+g(e(T).video.recordAudio),1),i("li",null,"麦克风: "+g(e(T).video.recordMicro),1),i("li",null,"长宽比: "+g(e(T).video.aspectRatio),1),i("li",null,"帧率: "+g(e(T).video.frameRate),1),i("li",null,"视频宽度: "+g(e(T).video.width),1),i("li",null,"视频高度: "+g(e(T).video.height),1),i("li",null,"显示鼠标: "+g(e(T).video.cursor),1)])]),_:1})],64))],512),[[F,e(I)]])])):(r(),S(ee,{key:1,level:3},{default:s(()=>[m(" 你的浏览器不支持WebRTC，请安装最新版本Chrome后重试。 ")]),_:1}))}}});const fl=Be(ll,[["__scopeId","data-v-fb2b1046"]]);export{fl as default};
