var L=Object.defineProperty;var w=Object.getOwnPropertySymbols;var R=Object.prototype.hasOwnProperty,S=Object.prototype.propertyIsEnumerable;var _=(t,e,s)=>e in t?L(t,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[e]=s,k=(t,e)=>{for(var s in e||(e={}))R.call(e,s)&&_(t,s,e[s]);if(w)for(var s of w(e))S.call(e,s)&&_(t,s,e[s]);return t};var c=(t,e,s)=>(_(t,typeof e!="symbol"?e+"":e,s),s);import{bH as P,bA as B,cE as D,cF as T,bo as A,j as K,k as M,l as y,n as a,s as n,F as u,r as v,p as C,y as p,d as g,bR as N,bS as E,o as l,D as b}from"./index.dc0fbd43.js";import{t as x}from"./toFinite.13c36d64.js";import{b as F}from"./_baseRandom.67e4faa9.js";function V(t,e){return P(e,function(s){return t[s]})}function j(t){return t==null?[]:V(t,B(t))}var H=Math.ceil,U=Math.max;function z(t,e,s,o){for(var d=-1,r=U(H((e-t)/(s||1)),0),i=Array(r);r--;)i[o?r:++d]=t,t+=s;return i}function Q(t){return function(e,s,o){return o&&typeof o!="number"&&D(e,s,o)&&(s=o=void 0),e=x(e),s===void 0?(s=e,e=0):s=x(s),o=o===void 0?e<s?1:-1:x(o),z(e,s,o,t)}}var W=Q(),I=W;function G(t,e){var s=-1,o=t.length,d=o-1;for(e=e===void 0?o:e;++s<e;){var r=F(s,d),i=t[r];t[r]=t[s],t[s]=i}return t.length=e,t}function q(t){return G(T(t))}function J(t){return G(j(t))}function O(t){var e=A(t)?q:J;return e(t)}class h{}c(h,"i",[[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]]),c(h,"j",[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]]),c(h,"l",[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]]),c(h,"o",[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]]),c(h,"s",[[[0,0,0],[0,1,1],[1,1,0]],[[0,1,0],[0,1,1],[0,0,1]]]),c(h,"t",[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]]),c(h,"z",[[[0,0,0],[1,1,0],[0,1,1]],[[0,0,1],[0,1,1],[0,1,0]]]),c(h,"iLegend",[[0,0,0,0],[1,1,1,1]]),c(h,"jLegend",[[1,0,0,0],[1,1,1,0]]),c(h,"lLegend",[[0,0,1,0],[1,1,1,0]]),c(h,"oLegend",[[0,1,1,0],[0,1,1,0]]),c(h,"sLegend",[[0,1,1,0],[1,1,0,0]]),c(h,"tLegend",[[0,1,0,0],[1,1,1,0]]),c(h,"zLegend",[[1,1,0,0],[0,1,1,0]]);const{mapGetters:X,mapActions:Y}=M("tetris"),Z=["i","j","l","o","s","t","z"],$={name:"TetrisGame",data:()=>({inited:!1,gridCells:{col:10,row:20},matrix:null,rotate:0,position:null,currentTetrimino:null,nextTetrimino:null,tetriminosShuffle:[],score:0,lines:0,start:!1,end:!1,pause:!1,lock:!1,clearing:!1,clearIndexs:[],intervalID:void 0}),computed:k({movable:function(){return this.start&&!this.end&&!this.clearing&&!this.pause},level:function(){return Math.ceil(this.lines/10)},nextTetriminoMatrixLegend:function(){return this.nextTetrimino?h[this.nextTetrimino+"Legend"]:null},positions:function(){return this.currentTetrimino?this._getPositions(this._getRotatedMatrix(this.rotate),this.position):null},currentMatrix:function(){if(this.currentTetrimino){const t=y(this.matrix);for(const e of this.positions)e[0]>=0&&e[0]<this.gridCells.row&&e[1]>=0&&e[1]<this.gridCells.col&&(t[e[0]][e[1]]=this.currentTetrimino);return t}else return this.matrix},speed:function(){const t=this.level<=20?this.level:20;return 1e3*(.8-(t-1)*.007)**(t-1)}},X(["bestScore"])),mounted(){this.resetGame(),this.getNextTetrimino(),this.addListener(),this.inited=!0},beforeUnmount(){this.removeListener()},methods:k({playGame(){this.start||(this.score=0,this.lines=0,this.getNextTetrimino(),this.start=!0,this.intervalID=setInterval(()=>{this.clearing||this.moveDown()},this.speed))},resetGame(){clearInterval(this.intervalID);const t=Array(this.gridCells.row);for(const e of I(this.gridCells.row))t[e]=Array(this.gridCells.col).fill("");this.matrix=t,this.rotate=0,this.resetPosition(),this.currentTetrimino=void 0,this.start=!1,this.end=!1,this.pause=!1,this.lock=!1,this.clearing=!1},pauseGame(t){t?this.lock=!0:t===!1&&(this.lock=!1),this.start&&(this.lock===!1||t)&&(this.pause?(this.pause=!this.pause,this.intervalID=setInterval(()=>{this.clearing||this.moveDown()},this.speed)):(this.pause=!this.pause,clearInterval(this.intervalID)))},resetPosition(){this.rotate=0,this.position=[0,Math.ceil(this.gridCells.col/2)]},updateMatrix(){if(this.start){for(const e of this.positions)e[0]<0&&(this.end=!0);if(this.matrix=y(this.currentMatrix),this.end){this.pauseGame(!0),this.clearIndexs=[];for(const e of I(this.gridCells.row))this.clearIndexs.push(e);setTimeout(()=>{this.score>this.bestScore&&this.setBestScore(this.score),this.clearIndexs=[],this.resetGame()},600);return}this.score+=4;const t=[];for(const e in this.matrix)this.matrix[e].filter(o=>o==="").length===0&&t.push(parseInt(e));if(t.length>0){this.clearing=!0,this.pauseGame(!0),this.clearIndexs=t;const e=y(this.matrix);for(let o=this.clearIndexs.length-1;o>=0;o--)e.splice(this.clearIndexs[o],1);const s=Array(this.clearIndexs.length);for(const o of I(this.clearIndexs.length))s[o]=Array(this.gridCells.col).fill("");setTimeout(()=>{switch(this.lines+=this.clearIndexs.length,this.clearIndexs.length){case 1:this.score+=40*this.level;break;case 2:this.score+=100*this.level;break;case 3:this.score+=300*this.level;break;case 4:this.score+=1200*this.level;break}this.clearIndexs=[],this.matrix=[...s,...e],this.getNextTetrimino(),this.resetPosition(),this.clearing=!1,this.pauseGame(!1)},600)}else this.getNextTetrimino(),this.resetPosition()}},getNextTetrimino(){this.currentTetrimino=this.nextTetrimino,this.tetriminosShuffle.length<=7&&(this.tetriminosShuffle=this.tetriminosShuffle.concat(O(Z))),this.nextTetrimino=this.tetriminosShuffle.shift()},rotateRight(){this.movable&&!this._hasConflict(this._getPositions(this._getRotatedMatrix(this.rotate-1),this.position))&&this.rotate++},rotateLeft(){this.movable&&!this._hasConflict(this._getPositions(this._getRotatedMatrix(this.rotate-1),this.position))&&this.rotate--},moveLeft(){this.movable&&!this._hasConflict(this._getPositions(this._getRotatedMatrix(this.rotate),[this.position[0],this.position[1]-1]))&&this.position[1]--},moveRight(){this.movable&&!this._hasConflict(this._getPositions(this._getRotatedMatrix(this.rotate),[this.position[0],this.position[1]+1]))&&this.position[1]++},moveDown(){this.movable&&(this._hasConflict(this._getPositions(this._getRotatedMatrix(this.rotate),[this.position[0]+1,this.position[1]]))?this.updateMatrix():this.position[0]++)},moveBottom(){if(this.movable){let t=0;for(;!this._hasConflict(this._getPositions(this._getRotatedMatrix(this.rotate),[this.position[0]+t+1,this.position[1]]));)t++;this.position[0]+=t,this.updateMatrix()}},addListener(){document.addEventListener("keydown",this._keyboardEvent.bind(this))},removeListener(){document.removeEventListener("keydown",this._keyboardEvent.bind(this))},_getRotatedMatrix(t){let e=t%h[this.currentTetrimino].length;return e<0&&(e+=h[this.currentTetrimino].length),h[this.currentTetrimino][e]},_getPositions(t,e){const s=[];for(let o=0;o<t.length;o++)for(let d=0;d<t[o].length;d++)if(t[o][d]===1)switch(this.currentTetrimino){case"i":case"o":s.push([e[0]-2+o,e[1]-2+d]);break;case"j":case"l":case"t":s.push([e[0]-1+o,e[1]-1+d]);break;case"s":case"z":s.push([e[0]-2+o,e[1]-1+d]);break;default:return null}return s},_keyboardEvent(t){if(!(t.altKey||t.ctrlKey||t.metaKey||t.shiftKey))switch(t.code){case"Space":this.start?(this.pause&&this.pauseGame(),this.moveBottom()):this.playGame();break;case"KeyW":case"KeyE":case"ArrowUp":this.pause&&this.pauseGame(),this.rotateRight();break;case"KeyQ":this.pause&&this.pauseGame(),this.rotateLeft();break;case"KeyS":case"ArrowDown":this.pause&&this.pauseGame(),this.moveDown();break;case"KeyA":case"ArrowLeft":this.pause&&this.pauseGame(),this.moveLeft();break;case"KeyD":case"ArrowRight":this.pause&&this.pauseGame(),this.moveRight();break;case"KeyP":this.pauseGame();break;case"KeyR":this.start?this.resetGame():this.playGame();break}},_hasConflict(t){for(const e of t){if(e[0]>=this.gridCells.row||e[1]<0||e[1]>=this.gridCells.col)return!0;if(e[0]>=0&&this.matrix[e[0]][e[1]]!=="")return!0}return!1}},Y(["setBestScore"]))},f=t=>(N("data-v-144bddc4"),t=t(),E(),t),tt={class:"gamePanel"},et={class:"tetrisPanel"},st={class:"tetrisMainPanel"},it={key:1,class:"tetrisCell"},ot={class:"otherPanel"},rt={class:"infoPanel"},nt={class:"info"},at=g(" \u6700\u9AD8\u5206: "),lt={class:"digital"},ht={class:"info"},ct=g(" \u4E0A\u8F6E "),dt=g(" \u5F97\u5206: "),ut={class:"digital"},ft={class:"info"},mt=g(" \u6D88\u9664\u884C: "),vt={class:"digital"},gt={class:"info"},pt=g(" \u7EA7\u522B: "),_t={class:"digital"},kt=f(()=>n("div",{class:"info"}," \u4E0B\u4E00\u4E2A ",-1)),yt={class:"nextTetrimino"},Ct={key:1,class:"tetrisCell"},bt={class:"controlPanel"},xt=f(()=>n("div",{class:"controlInfo pause"}," \u6682\u505CP ",-1)),It=f(()=>n("div",{class:"controlInfo restart"}," \u91CD\u73A9R ",-1)),wt=f(()=>n("div",{class:"controlInfo drop"}," \u6389\u843DSpace ",-1)),Gt=f(()=>n("div",{class:"controlInfo up"}," \u65CB\u8F6C ",-1)),Lt=f(()=>n("div",{class:"controlInfo left"}," \u5DE6\u79FB ",-1)),Rt=f(()=>n("div",{class:"controlInfo right"}," \u53F3\u79FB ",-1)),St=f(()=>n("div",{class:"controlInfo down"}," \u4E0B\u79FB ",-1));function Pt(t,e,s,o,d,r){return l(),a("div",null,[n("div",tt,[n("div",et,[(l(!0),a(u,null,v(t.gridCells.col*2+t.gridCells.row*2+4,i=>(l(),a("div",{key:"tetrisFrameGrid"+i,class:b(["tetrisCell","tetrisCellGrid"])}))),128)),n("div",st,[t.inited?(l(!0),a(u,{key:0},v(t.gridCells.row,i=>(l(),a(u,{key:i},[(l(!0),a(u,null,v(t.gridCells.col,m=>(l(),a(u,{key:m},[r.currentMatrix[i-1][m-1]?(l(),a("div",{key:0,class:b(["tetrisCell","tetrisCellColor-"+r.currentMatrix[i-1][m-1],t.clearIndexs.includes(i-1)?"blink":""])},null,2)):(l(),a("div",it))],64))),128))],64))),128)):C("",!0)])]),n("div",ot,[n("div",rt,[n("div",nt,[at,n("span",lt,p(t.bestScore),1)]),n("div",ht,[t.start?C("",!0):(l(),a(u,{key:0},[ct],64)),dt,n("span",ut,p(t.score),1)]),n("div",ft,[mt,n("span",vt,p(t.lines),1)]),n("div",gt,[pt,n("span",_t,p(r.level),1)]),kt,n("div",yt,[t.inited?(l(),a(u,{key:0},v(2,i=>(l(),a(u,{key:i},[(l(),a(u,null,v(4,m=>(l(),a(u,{key:m},[r.nextTetriminoMatrixLegend[i-1][m-1]?(l(),a("div",{key:0,class:b(["tetrisCell","tetrisCellColor-"+t.nextTetrimino])},null,2)):(l(),a("div",Ct))],64))),64))],64))),64)):C("",!0)])]),n("div",bt,[n("div",{class:"controlButton pause",onClick:e[0]||(e[0]=(...i)=>r.pauseGame&&r.pauseGame(...i))}),xt,t.start?(l(),a("div",{key:0,class:"controlButton restart",onClick:e[1]||(e[1]=(...i)=>r.resetGame&&r.resetGame(...i))})):(l(),a("div",{key:1,class:"controlButton restart",onClick:e[2]||(e[2]=(...i)=>r.playGame&&r.playGame(...i))})),It,t.start?(l(),a("div",{key:2,class:"controlButton drop",onClick:e[3]||(e[3]=(...i)=>r.moveBottom&&r.moveBottom(...i))})):(l(),a("div",{key:3,class:"controlButton drop",onClick:e[4]||(e[4]=(...i)=>r.playGame&&r.playGame(...i))})),wt,n("div",{class:"controlButton up",onClick:e[5]||(e[5]=(...i)=>r.rotateRight&&r.rotateRight(...i))}),Gt,n("div",{class:"controlButton left",onClick:e[6]||(e[6]=(...i)=>r.moveLeft&&r.moveLeft(...i))}),Lt,n("div",{class:"controlButton right",onClick:e[7]||(e[7]=(...i)=>r.moveRight&&r.moveRight(...i))}),Rt,n("div",{class:"controlButton down",onClick:e[8]||(e[8]=(...i)=>r.moveDown&&r.moveDown(...i))}),St])])])])}var Kt=K($,[["render",Pt],["__scopeId","data-v-144bddc4"]]);export{Kt as default};
