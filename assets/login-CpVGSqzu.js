import{k as z,a4 as I,R as k,J as $,at as K,aw as P,a7 as T,T as F,ab as R,ax as x,E as S,r as G,F as u,K as a,w as n,W as H,bk as L,x as i,L as M,N,aB as Q,aA as d,a0 as A}from"./index-i7h8R5B5.js";import{E as D}from"./el-space-CRZMmtck.js";import{E as J}from"./el-divider-B5hA14_o.js";import{E as O,a as W}from"./el-form-item-ClM-jiU1.js";import"./castArray-DmqlXQV8.js";const j={class:"login-container"},X={class:"main"},Y=z({__name:"login",setup(Z){const r=I({userName:"",password:""}),f=k(),m=k({}),t=k(!1),g=$(),V=K(),w=P();T(V,o=>{const e=o.query;e&&(typeof e.redirect=="string"&&(f.value=e.redirect),m.value=q(e))},{immediate:!0}),F(()=>{w.logged&&g.push({path:f.value||"/",query:m.value})}),R(()=>{window.removeEventListener("message",v)});async function _(){if(!t.value){if(!navigator.onLine){d.warning("已离线！");return}if(r.userName!=null&&r.password!=null){t.value=!0;try{await w.login({userName:r.userName,password:r.password}),b()}catch(o){o instanceof Error&&d.error(o.message)}t.value=!1}}}function B(){g.push("/register")}function C(){const o=`${x.apiBaseUrl}/auth/github`;U(o,"GitHub登录")}function b(){d.success("登录成功！"),g.push({path:f.value||"/",query:m.value})}function q(o){const{redirect:e,...s}=o;return s}async function v(o){var s;const e=o.source;o.origin===x.apiBaseUrl&&((s=o.data)==null?void 0:s.type)==="oauth_complete"&&(window.removeEventListener("message",v),e.close(),t.value=!1,await w.checkThirdPartyLogin(),b())}function U(o,e="第三方登录",s=300,l=400){if(t.value){d.warning("登录进行中，请勿重复点击");return}t.value=!0,window.addEventListener("message",v);const p=(window.screen.height-400)/2,y=(window.screen.width-300)/2,c=window.open(o,e,`popup,width=${s},height=${l},top=${p},left=${y}`);if(!c){t.value=!1,d.error("请允许浏览器弹出窗口！");return}const h=window.setInterval(()=>{c.closed&&(window.clearInterval(h),t.value=!1)},500)}return(o,e)=>{const s=H,l=O,p=M,y=W,c=J,h=D;return G(),S("div",j,[u("div",X,[a(y,Q({layout:"horizontal",model:i(r)},{wrapperCol:{span:24}}),{default:n(()=>[a(l,{required:""},{default:n(()=>[a(s,{modelValue:i(r).userName,"onUpdate:modelValue":e[0]||(e[0]=E=>i(r).userName=E),placeholder:"账户",size:"large",onKeypress:L(_,["enter"])},{prefix:n(()=>e[2]||(e[2]=[u("span",{class:"i-icon-park-outline-user"},null,-1)])),_:1},8,["modelValue"])]),_:1}),a(l,{required:""},{default:n(()=>[a(s,{modelValue:i(r).password,"onUpdate:modelValue":e[1]||(e[1]=E=>i(r).password=E),type:"password",placeholder:"密码",size:"large","show-password":"",onKeypress:L(_,["enter"])},{prefix:n(()=>e[3]||(e[3]=[u("span",{class:"i-icon-park-outline-lock"},null,-1)])),_:1},8,["modelValue"])]),_:1}),a(l,null,{default:n(()=>[a(p,{type:"primary",block:"",size:"large",loading:i(t),onClick:_},{default:n(()=>e[4]||(e[4]=[N(" 登录 ")])),_:1},8,["loading"]),a(p,{block:"",size:"large",disabled:i(t),onClick:B},{default:n(()=>e[5]||(e[5]=[N(" 注册 ")])),_:1},8,["disabled"])]),_:1})]),_:1},16,["model"]),a(c),a(h,null,{default:n(()=>[u("div",{class:"third-party",title:"GitHub登录",onClick:C},e[6]||(e[6]=[u("i",{class:"i-icon-park-outline:github"},null,-1)]))]),_:1})])])}}}),se=A(Y,[["__scopeId","data-v-3183910a"]]);export{se as default};
