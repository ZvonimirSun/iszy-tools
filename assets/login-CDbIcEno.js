import{k as F,a4 as K,R as b,J as D,at as R,aw as S,a7 as T,T as G,ab as M,ax as N,aA as c,E as m,r as g,F as _,K as s,w as u,W as O,bk as I,x as d,L as Q,N as C,aB as A,Y as H,Z as J,v as W,a0 as X}from"./index-D9K1miO3.js";import{E as Y}from"./el-space-C6fkuBAr.js";import{E as Z}from"./el-divider-8pkV0Zp7.js";import{E as j,a as ee}from"./el-form-item-I7sWbSnL.js";import{L as te}from"./linuxdo-C7o2R0pC.js";import"./castArray-oMVI_d-4.js";import"./clone-DPJHBPy2.js";const oe={class:"login-container"},ae={class:"main"},re=["title","onClick"],ne=["src"],se=F({__name:"login",setup(le){const l=K({userName:"",password:""}),v=b(),w=b({}),o=b(!1),y=D(),V=R(),h=S();let a=null;const B=[{type:"github",title:"Github",icon:"i-icon-park-outline:github"},{type:"linuxdo",title:"LINUX DO",img:te}];T(V,t=>{const e=t.query;e&&(typeof e.redirect=="string"&&(v.value=e.redirect),w.value=q(e))},{immediate:!0}),G(()=>{h.logged&&y.push({path:v.value||"/",query:w.value})}),M(()=>{a!=null&&(clearInterval(a),a=null),window.removeEventListener("message",E)});async function k(){if(!o.value){if(!navigator.onLine){c.warning("已离线！");return}if(l.userName!=null&&l.password!=null){o.value=!0;try{await h.login({userName:l.userName,password:l.password}),x()}catch(t){t instanceof Error&&c.error(t.message)}o.value=!1}}}function $(){y.push("/register")}function U(t){const e=`${N.apiBaseUrl}/auth/${t}`;z(e,"GitHub登录")}function x(){c.success("登录成功！"),y.push({path:v.value||"/",query:w.value})}function q(t){const{redirect:e,...r}=t;return r}async function E(t){var r,i;const e=t.source;if(t.origin!==N.apiBaseUrl){console.log(`origin ${t.origin} is not valid`);return}((r=t.data)==null?void 0:r.type)!=="oauth_complete"&&((i=t.data)==null?void 0:i.type)!=="oauth_fail"||(window.removeEventListener("message",E),a!=null&&(clearInterval(a),a=null),e.close(),t.data.type==="oauth_complete"?(await h.thirdPartyLogin(t.data.data),x()):c.error("登录失败！"),o.value=!1)}function z(t,e="第三方登录",r=500,i=600){if(o.value){c.warning("登录进行中，请勿重复点击");return}o.value=!0,window.addEventListener("message",E);const p=(window.screen.height-r)/2,L=(window.screen.width-i)/2,f=window.open(t,e,`popup,width=${r},height=${i},top=${p},left=${L}`);if(!f){o.value=!1,c.error("请允许浏览器弹出窗口！");return}a=window.setInterval(()=>{f.closed&&(a!=null&&(clearInterval(a),a=null),o.value=!1)},500)}return(t,e)=>{const r=O,i=j,p=Q,L=ee,f=Z,P=Y;return g(),m("div",oe,[_("div",ae,[s(L,A({layout:"horizontal",model:d(l)},{wrapperCol:{span:24}}),{default:u(()=>[s(i,{required:""},{default:u(()=>[s(r,{modelValue:d(l).userName,"onUpdate:modelValue":e[0]||(e[0]=n=>d(l).userName=n),placeholder:"账户",size:"large",onKeypress:I(k,["enter"])},{prefix:u(()=>e[2]||(e[2]=[_("span",{class:"i-icon-park-outline-user"},null,-1)])),_:1},8,["modelValue"])]),_:1}),s(i,{required:""},{default:u(()=>[s(r,{modelValue:d(l).password,"onUpdate:modelValue":e[1]||(e[1]=n=>d(l).password=n),type:"password",placeholder:"密码",size:"large","show-password":"",onKeypress:I(k,["enter"])},{prefix:u(()=>e[3]||(e[3]=[_("span",{class:"i-icon-park-outline-lock"},null,-1)])),_:1},8,["modelValue"])]),_:1}),s(i,null,{default:u(()=>[s(p,{type:"primary",block:"",size:"large",loading:d(o),onClick:k},{default:u(()=>e[4]||(e[4]=[C(" 登录 ")])),_:1},8,["loading"]),s(p,{block:"",size:"large",disabled:d(o),onClick:$},{default:u(()=>e[5]||(e[5]=[C(" 注册 ")])),_:1},8,["disabled"])]),_:1})]),_:1},16,["model"]),s(f),s(P,null,{default:u(()=>[(g(),m(H,null,J(B,n=>_("div",{key:n.type,class:"third-party",title:n.title,onClick:ie=>U(n.type)},[n.icon?(g(),m("i",{key:0,class:W(n.icon)},null,2)):(g(),m("img",{key:1,class:"third-party-img",src:n.img,alt:""},null,8,ne))],8,re)),64))]),_:1})])])}}}),_e=X(se,[["__scopeId","data-v-80f74cd1"]]);export{_e as default};
