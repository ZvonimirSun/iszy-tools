function Ne(e){return Array.isArray(e)}function Pe(e){return e!==null&&typeof e=="object"&&e.constructor===Object}function Hn(e){return e&&typeof e=="object"?e.op==="add":!1}function Ln(e){return e&&typeof e=="object"?e.op==="remove":!1}function qn(e){return e&&typeof e=="object"?e.op==="replace":!1}function Bn(e){return e&&typeof e=="object"?e.op==="copy":!1}function Wn(e){return e&&typeof e=="object"?e.op==="move":!1}function Yt(e,t){return JSON.stringify(e)===JSON.stringify(t)}function Zt(e,t){return e===t}function ut(e){return e.slice(0,e.length-1)}function xt(e){return e[e.length-1]}function Qn(e,t){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Zt;if(e.length<t.length)return!1;for(let n=0;n<t.length;n++)if(!r(e[n],t[n]))return!1;return!0}function lt(e){return typeof e=="object"&&e!==null}function Me(e){if(Ne(e)){const t=e.slice();return Object.getOwnPropertySymbols(e).forEach(r=>{t[r]=e[r]}),t}else if(Pe(e)){const t={...e};return Object.getOwnPropertySymbols(e).forEach(r=>{t[r]=e[r]}),t}else return e}function ze(e,t,r){if(e[t]===r)return e;{const n=Me(e);return n[t]=r,n}}function de(e,t){let r=e,n=0;for(;n<t.length;)Pe(r)?r=r[t[n]]:Ne(r)?r=r[parseInt(t[n])]:r=void 0,n++;return r}function $e(e,t,r){let n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(t.length===0)return r;const s=t[0],a=$e(e?e[s]:void 0,t.slice(1),r,n);if(Pe(e)||Ne(e))return ze(e,s,a);if(n){const h=er.test(s)?[]:{};return h[s]=a,h}else throw new Error("Path does not exist")}const er=/^\d+$/;function dt(e,t,r){if(t.length===0)return r(e);if(!lt(e))throw new Error("Path doesn't exist");const n=t[0],s=dt(e[n],t.slice(1),r);return ze(e,n,s)}function Je(e,t){if(t.length===0)return e;if(!lt(e))throw new Error("Path does not exist");if(t.length===1){const s=t[0];if(s in e){const a=Me(e);return Ne(a)&&a.splice(parseInt(s),1),Pe(a)&&delete a[s],a}else return e}const r=t[0],n=Je(e[r],t.slice(1));return ze(e,r,n)}function Ue(e,t,r){const n=t.slice(0,t.length-1),s=t[t.length-1];return dt(e,n,a=>{if(!Array.isArray(a))throw new TypeError("Array expected at path "+JSON.stringify(n));const h=Me(a);return h.splice(parseInt(s),0,r),h})}function ft(e,t){return e===void 0?!1:t.length===0?!0:e===null?!1:ft(e[t[0]],t.slice(1))}function ht(e){const t=e.split("/");return t.shift(),t.map(r=>r.replace(/~1/g,"/").replace(/~0/g,"~"))}function Ie(e){return e.map(mt).join("")}function mt(e){return"/"+String(e).replace(/~/g,"~0").replace(/\//g,"~1")}function Xn(e,t){return e+mt(t)}function Yn(e,t){return e.startsWith(t)&&(e.length===t.length||e[t.length]==="/")}function Zn(e,t,r){let n=e;for(let s=0;s<t.length;s++){cr(t[s]);let a=t[s];if(r&&r.before){const _=r.before(n,a);if(_!==void 0){if(_.document!==void 0&&(n=_.document),_.json!==void 0)throw new Error('Deprecation warning: returned object property ".json" has been renamed to ".document"');_.operation!==void 0&&(a=_.operation)}}const h=n,p=ur(n,a.path);if(a.op==="add")n=nr(n,p,a.value);else if(a.op==="remove")n=rr(n,p);else if(a.op==="replace")n=tr(n,p,a.value);else if(a.op==="copy")n=sr(n,p,et(a.from));else if(a.op==="move")n=or(n,p,et(a.from));else if(a.op==="test")ar(n,p,a.value);else throw new Error("Unknown JSONPatch operation "+JSON.stringify(a));if(r&&r.after){const _=r.after(n,a,h);_!==void 0&&(n=_)}}return n}function tr(e,t,r){return $e(e,t,r)}function rr(e,t){return Je(e,t)}function nr(e,t,r){return Ge(e,t)?Ue(e,t,r):$e(e,t,r)}function sr(e,t,r){const n=de(e,r);if(Ge(e,t))return Ue(e,t,n);{const s=de(e,r);return $e(e,t,s)}}function or(e,t,r){const n=de(e,r),s=Je(e,r);return Ge(s,t)?Ue(s,t,n):$e(s,t,n)}function ar(e,t,r){if(r===void 0)throw new Error(`Test failed: no value provided (path: "${Ie(t)}")`);if(!ft(e,t))throw new Error(`Test failed: path not found (path: "${Ie(t)}")`);const n=de(e,t);if(!Yt(n,r))throw new Error(`Test failed, value differs (path: "${Ie(t)}")`)}function Ge(e,t){if(t.length===0)return!1;const r=de(e,ut(t));return Array.isArray(r)}function ir(e,t){if(xt(t)!=="-")return t;const r=ut(t),n=de(e,r);return r.concat(n.length)}function cr(e){if(!["add","remove","replace","copy","move","test"].includes(e.op))throw new Error("Unknown JSONPatch op "+JSON.stringify(e.op));if(typeof e.path!="string")throw new Error('Required property "path" missing or not a string in operation '+JSON.stringify(e));if((e.op==="copy"||e.op==="move")&&typeof e.from!="string")throw new Error('Required property "from" missing or not a string in operation '+JSON.stringify(e))}function ur(e,t){return ir(e,ht(t))}function et(e){return ht(e)}class xn extends Error{constructor(t,r){super(t+" at position "+r),this.position=r}}var ne={},fe={},_e={},G={},ye={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.regexpCode=e.getEsmExportName=e.getProperty=e.safeStringify=e.stringify=e.strConcat=e.addCodeArg=e.str=e._=e.nil=e._Code=e.Name=e.IDENTIFIER=e._CodeOrName=void 0;class t{}e._CodeOrName=t,e.IDENTIFIER=/^[a-z$_][a-z$_0-9]*$/i;class r extends t{constructor(f){if(super(),!e.IDENTIFIER.test(f))throw new Error("CodeGen: name must be a valid identifier");this.str=f}toString(){return this.str}emptyStr(){return!1}get names(){return{[this.str]:1}}}e.Name=r;class n extends t{constructor(f){super(),this._items=typeof f=="string"?[f]:f}toString(){return this.str}emptyStr(){if(this._items.length>1)return!1;const f=this._items[0];return f===""||f==='""'}get str(){var f;return(f=this._str)!==null&&f!==void 0?f:this._str=this._items.reduce((d,E)=>`${d}${E}`,"")}get names(){var f;return(f=this._names)!==null&&f!==void 0?f:this._names=this._items.reduce((d,E)=>(E instanceof r&&(d[E.str]=(d[E.str]||0)+1),d),{})}}e._Code=n,e.nil=new n("");function s(c,...f){const d=[c[0]];let E=0;for(;E<f.length;)p(d,f[E]),d.push(c[++E]);return new n(d)}e._=s;const a=new n("+");function h(c,...f){const d=[P(c[0])];let E=0;for(;E<f.length;)d.push(a),p(d,f[E]),d.push(a,P(c[++E]));return _(d),new n(d)}e.str=h;function p(c,f){f instanceof n?c.push(...f._items):f instanceof r?c.push(f):c.push(w(f))}e.addCodeArg=p;function _(c){let f=1;for(;f<c.length-1;){if(c[f]===a){const d=m(c[f-1],c[f+1]);if(d!==void 0){c.splice(f-1,3,d);continue}c[f++]="+"}f++}}function m(c,f){if(f==='""')return c;if(c==='""')return f;if(typeof c=="string")return f instanceof r||c[c.length-1]!=='"'?void 0:typeof f!="string"?`${c.slice(0,-1)}${f}"`:f[0]==='"'?c.slice(0,-1)+f.slice(1):void 0;if(typeof f=="string"&&f[0]==='"'&&!(c instanceof r))return`"${c}${f.slice(1)}`}function $(c,f){return f.emptyStr()?c:c.emptyStr()?f:h`${c}${f}`}e.strConcat=$;function w(c){return typeof c=="number"||typeof c=="boolean"||c===null?c:P(Array.isArray(c)?c.join(","):c)}function S(c){return new n(P(c))}e.stringify=S;function P(c){return JSON.stringify(c).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")}e.safeStringify=P;function R(c){return typeof c=="string"&&e.IDENTIFIER.test(c)?new n(`.${c}`):s`[${c}]`}e.getProperty=R;function I(c){if(typeof c=="string"&&e.IDENTIFIER.test(c))return new n(`${c}`);throw new Error(`CodeGen: invalid export name: ${c}, use explicit $id name mapping`)}e.getEsmExportName=I;function y(c){return new n(c.toString())}e.regexpCode=y})(ye);var Ve={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.ValueScope=e.ValueScopeName=e.Scope=e.varKinds=e.UsedValueState=void 0;const t=ye;class r extends Error{constructor(m){super(`CodeGen: "code" for ${m} not defined`),this.value=m.value}}var n;(function(_){_[_.Started=0]="Started",_[_.Completed=1]="Completed"})(n=e.UsedValueState||(e.UsedValueState={})),e.varKinds={const:new t.Name("const"),let:new t.Name("let"),var:new t.Name("var")};class s{constructor({prefixes:m,parent:$}={}){this._names={},this._prefixes=m,this._parent=$}toName(m){return m instanceof t.Name?m:this.name(m)}name(m){return new t.Name(this._newName(m))}_newName(m){const $=this._names[m]||this._nameGroup(m);return`${m}${$.index++}`}_nameGroup(m){var $,w;if(!((w=($=this._parent)===null||$===void 0?void 0:$._prefixes)===null||w===void 0)&&w.has(m)||this._prefixes&&!this._prefixes.has(m))throw new Error(`CodeGen: prefix "${m}" is not allowed in this scope`);return this._names[m]={prefix:m,index:0}}}e.Scope=s;class a extends t.Name{constructor(m,$){super($),this.prefix=m}setValue(m,{property:$,itemIndex:w}){this.value=m,this.scopePath=(0,t._)`.${new t.Name($)}[${w}]`}}e.ValueScopeName=a;const h=(0,t._)`\n`;class p extends s{constructor(m){super(m),this._values={},this._scope=m.scope,this.opts={...m,_n:m.lines?h:t.nil}}get(){return this._scope}name(m){return new a(m,this._newName(m))}value(m,$){var w;if($.ref===void 0)throw new Error("CodeGen: ref must be passed in value");const S=this.toName(m),{prefix:P}=S,R=(w=$.key)!==null&&w!==void 0?w:$.ref;let I=this._values[P];if(I){const f=I.get(R);if(f)return f}else I=this._values[P]=new Map;I.set(R,S);const y=this._scope[P]||(this._scope[P]=[]),c=y.length;return y[c]=$.ref,S.setValue($,{property:P,itemIndex:c}),S}getValue(m,$){const w=this._values[m];if(w)return w.get($)}scopeRefs(m,$=this._values){return this._reduceValues($,w=>{if(w.scopePath===void 0)throw new Error(`CodeGen: name "${w}" has no value`);return(0,t._)`${m}${w.scopePath}`})}scopeCode(m=this._values,$,w){return this._reduceValues(m,S=>{if(S.value===void 0)throw new Error(`CodeGen: name "${S}" has no value`);return S.value.code},$,w)}_reduceValues(m,$,w={},S){let P=t.nil;for(const R in m){const I=m[R];if(!I)continue;const y=w[R]=w[R]||new Map;I.forEach(c=>{if(y.has(c))return;y.set(c,n.Started);let f=$(c);if(f){const d=this.opts.es5?e.varKinds.var:e.varKinds.const;P=(0,t._)`${P}${d} ${c} = ${f};${this.opts._n}`}else if(f=S==null?void 0:S(c))P=(0,t._)`${P}${f}${this.opts._n}`;else throw new r(c);y.set(c,n.Completed)})}return P}}e.ValueScope=p})(Ve);(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.or=e.and=e.not=e.CodeGen=e.operators=e.varKinds=e.ValueScopeName=e.ValueScope=e.Scope=e.Name=e.regexpCode=e.stringify=e.getProperty=e.nil=e.strConcat=e.str=e._=void 0;const t=ye,r=Ve;var n=ye;Object.defineProperty(e,"_",{enumerable:!0,get:function(){return n._}}),Object.defineProperty(e,"str",{enumerable:!0,get:function(){return n.str}}),Object.defineProperty(e,"strConcat",{enumerable:!0,get:function(){return n.strConcat}}),Object.defineProperty(e,"nil",{enumerable:!0,get:function(){return n.nil}}),Object.defineProperty(e,"getProperty",{enumerable:!0,get:function(){return n.getProperty}}),Object.defineProperty(e,"stringify",{enumerable:!0,get:function(){return n.stringify}}),Object.defineProperty(e,"regexpCode",{enumerable:!0,get:function(){return n.regexpCode}}),Object.defineProperty(e,"Name",{enumerable:!0,get:function(){return n.Name}});var s=Ve;Object.defineProperty(e,"Scope",{enumerable:!0,get:function(){return s.Scope}}),Object.defineProperty(e,"ValueScope",{enumerable:!0,get:function(){return s.ValueScope}}),Object.defineProperty(e,"ValueScopeName",{enumerable:!0,get:function(){return s.ValueScopeName}}),Object.defineProperty(e,"varKinds",{enumerable:!0,get:function(){return s.varKinds}}),e.operators={GT:new t._Code(">"),GTE:new t._Code(">="),LT:new t._Code("<"),LTE:new t._Code("<="),EQ:new t._Code("==="),NEQ:new t._Code("!=="),NOT:new t._Code("!"),OR:new t._Code("||"),AND:new t._Code("&&"),ADD:new t._Code("+")};class a{optimizeNodes(){return this}optimizeNames(o,i){return this}}class h extends a{constructor(o,i,g){super(),this.varKind=o,this.name=i,this.rhs=g}render({es5:o,_n:i}){const g=o?r.varKinds.var:this.varKind,T=this.rhs===void 0?"":` = ${this.rhs}`;return`${g} ${this.name}${T};`+i}optimizeNames(o,i){if(o[this.name.str])return this.rhs&&(this.rhs=Q(this.rhs,o,i)),this}get names(){return this.rhs instanceof t._CodeOrName?this.rhs.names:{}}}class p extends a{constructor(o,i,g){super(),this.lhs=o,this.rhs=i,this.sideEffects=g}render({_n:o}){return`${this.lhs} = ${this.rhs};`+o}optimizeNames(o,i){if(!(this.lhs instanceof t.Name&&!o[this.lhs.str]&&!this.sideEffects))return this.rhs=Q(this.rhs,o,i),this}get names(){const o=this.lhs instanceof t.Name?{}:{...this.lhs.names};return ce(o,this.rhs)}}class _ extends p{constructor(o,i,g,T){super(o,g,T),this.op=i}render({_n:o}){return`${this.lhs} ${this.op}= ${this.rhs};`+o}}class m extends a{constructor(o){super(),this.label=o,this.names={}}render({_n:o}){return`${this.label}:`+o}}class $ extends a{constructor(o){super(),this.label=o,this.names={}}render({_n:o}){return`break${this.label?` ${this.label}`:""};`+o}}class w extends a{constructor(o){super(),this.error=o}render({_n:o}){return`throw ${this.error};`+o}get names(){return this.error.names}}class S extends a{constructor(o){super(),this.code=o}render({_n:o}){return`${this.code};`+o}optimizeNodes(){return`${this.code}`?this:void 0}optimizeNames(o,i){return this.code=Q(this.code,o,i),this}get names(){return this.code instanceof t._CodeOrName?this.code.names:{}}}class P extends a{constructor(o=[]){super(),this.nodes=o}render(o){return this.nodes.reduce((i,g)=>i+g.render(o),"")}optimizeNodes(){const{nodes:o}=this;let i=o.length;for(;i--;){const g=o[i].optimizeNodes();Array.isArray(g)?o.splice(i,1,...g):g?o[i]=g:o.splice(i,1)}return o.length>0?this:void 0}optimizeNames(o,i){const{nodes:g}=this;let T=g.length;for(;T--;){const j=g[T];j.optimizeNames(o,i)||(Lt(o,j.names),g.splice(T,1))}return g.length>0?this:void 0}get names(){return this.nodes.reduce((o,i)=>K(o,i.names),{})}}class R extends P{render(o){return"{"+o._n+super.render(o)+"}"+o._n}}class I extends P{}class y extends R{}y.kind="else";class c extends R{constructor(o,i){super(i),this.condition=o}render(o){let i=`if(${this.condition})`+super.render(o);return this.else&&(i+="else "+this.else.render(o)),i}optimizeNodes(){super.optimizeNodes();const o=this.condition;if(o===!0)return this.nodes;let i=this.else;if(i){const g=i.optimizeNodes();i=this.else=Array.isArray(g)?new y(g):g}if(i)return o===!1?i instanceof c?i:i.nodes:this.nodes.length?this:new c(Ze(o),i instanceof c?[i]:i.nodes);if(!(o===!1||!this.nodes.length))return this}optimizeNames(o,i){var g;if(this.else=(g=this.else)===null||g===void 0?void 0:g.optimizeNames(o,i),!!(super.optimizeNames(o,i)||this.else))return this.condition=Q(this.condition,o,i),this}get names(){const o=super.names;return ce(o,this.condition),this.else&&K(o,this.else.names),o}}c.kind="if";class f extends R{}f.kind="for";class d extends f{constructor(o){super(),this.iteration=o}render(o){return`for(${this.iteration})`+super.render(o)}optimizeNames(o,i){if(super.optimizeNames(o,i))return this.iteration=Q(this.iteration,o,i),this}get names(){return K(super.names,this.iteration.names)}}class E extends f{constructor(o,i,g,T){super(),this.varKind=o,this.name=i,this.from=g,this.to=T}render(o){const i=o.es5?r.varKinds.var:this.varKind,{name:g,from:T,to:j}=this;return`for(${i} ${g}=${T}; ${g}<${j}; ${g}++)`+super.render(o)}get names(){const o=ce(super.names,this.from);return ce(o,this.to)}}class C extends f{constructor(o,i,g,T){super(),this.loop=o,this.varKind=i,this.name=g,this.iterable=T}render(o){return`for(${this.varKind} ${this.name} ${this.loop} ${this.iterable})`+super.render(o)}optimizeNames(o,i){if(super.optimizeNames(o,i))return this.iterable=Q(this.iterable,o,i),this}get names(){return K(super.names,this.iterable.names)}}class u extends R{constructor(o,i,g){super(),this.name=o,this.args=i,this.async=g}render(o){return`${this.async?"async ":""}function ${this.name}(${this.args})`+super.render(o)}}u.kind="func";class l extends P{render(o){return"return "+super.render(o)}}l.kind="return";class v extends R{render(o){let i="try"+super.render(o);return this.catch&&(i+=this.catch.render(o)),this.finally&&(i+=this.finally.render(o)),i}optimizeNodes(){var o,i;return super.optimizeNodes(),(o=this.catch)===null||o===void 0||o.optimizeNodes(),(i=this.finally)===null||i===void 0||i.optimizeNodes(),this}optimizeNames(o,i){var g,T;return super.optimizeNames(o,i),(g=this.catch)===null||g===void 0||g.optimizeNames(o,i),(T=this.finally)===null||T===void 0||T.optimizeNames(o,i),this}get names(){const o=super.names;return this.catch&&K(o,this.catch.names),this.finally&&K(o,this.finally.names),o}}class k extends R{constructor(o){super(),this.error=o}render(o){return`catch(${this.error})`+super.render(o)}}k.kind="catch";class A extends R{render(o){return"finally"+super.render(o)}}A.kind="finally";class M{constructor(o,i={}){this._values={},this._blockStarts=[],this._constants={},this.opts={...i,_n:i.lines?`
`:""},this._extScope=o,this._scope=new r.Scope({parent:o}),this._nodes=[new I]}toString(){return this._root.render(this.opts)}name(o){return this._scope.name(o)}scopeName(o){return this._extScope.name(o)}scopeValue(o,i){const g=this._extScope.value(o,i);return(this._values[g.prefix]||(this._values[g.prefix]=new Set)).add(g),g}getScopeValue(o,i){return this._extScope.getValue(o,i)}scopeRefs(o){return this._extScope.scopeRefs(o,this._values)}scopeCode(){return this._extScope.scopeCode(this._values)}_def(o,i,g,T){const j=this._scope.toName(i);return g!==void 0&&T&&(this._constants[j.str]=g),this._leafNode(new h(o,j,g)),j}const(o,i,g){return this._def(r.varKinds.const,o,i,g)}let(o,i,g){return this._def(r.varKinds.let,o,i,g)}var(o,i,g){return this._def(r.varKinds.var,o,i,g)}assign(o,i,g){return this._leafNode(new p(o,i,g))}add(o,i){return this._leafNode(new _(o,e.operators.ADD,i))}code(o){return typeof o=="function"?o():o!==t.nil&&this._leafNode(new S(o)),this}object(...o){const i=["{"];for(const[g,T]of o)i.length>1&&i.push(","),i.push(g),(g!==T||this.opts.es5)&&(i.push(":"),(0,t.addCodeArg)(i,T));return i.push("}"),new t._Code(i)}if(o,i,g){if(this._blockNode(new c(o)),i&&g)this.code(i).else().code(g).endIf();else if(i)this.code(i).endIf();else if(g)throw new Error('CodeGen: "else" body without "then" body');return this}elseIf(o){return this._elseNode(new c(o))}else(){return this._elseNode(new y)}endIf(){return this._endBlockNode(c,y)}_for(o,i){return this._blockNode(o),i&&this.code(i).endFor(),this}for(o,i){return this._for(new d(o),i)}forRange(o,i,g,T,j=this.opts.es5?r.varKinds.var:r.varKinds.let){const F=this._scope.toName(o);return this._for(new E(j,F,i,g),()=>T(F))}forOf(o,i,g,T=r.varKinds.const){const j=this._scope.toName(o);if(this.opts.es5){const F=i instanceof t.Name?i:this.var("_arr",i);return this.forRange("_i",0,(0,t._)`${F}.length`,Xt=>{this.var(j,(0,t._)`${F}[${Xt}]`),g(j)})}return this._for(new C("of",T,j,i),()=>g(j))}forIn(o,i,g,T=this.opts.es5?r.varKinds.var:r.varKinds.const){if(this.opts.ownProperties)return this.forOf(o,(0,t._)`Object.keys(${i})`,g);const j=this._scope.toName(o);return this._for(new C("in",T,j,i),()=>g(j))}endFor(){return this._endBlockNode(f)}label(o){return this._leafNode(new m(o))}break(o){return this._leafNode(new $(o))}return(o){const i=new l;if(this._blockNode(i),this.code(o),i.nodes.length!==1)throw new Error('CodeGen: "return" should have one node');return this._endBlockNode(l)}try(o,i,g){if(!i&&!g)throw new Error('CodeGen: "try" without "catch" and "finally"');const T=new v;if(this._blockNode(T),this.code(o),i){const j=this.name("e");this._currNode=T.catch=new k(j),i(j)}return g&&(this._currNode=T.finally=new A,this.code(g)),this._endBlockNode(k,A)}throw(o){return this._leafNode(new w(o))}block(o,i){return this._blockStarts.push(this._nodes.length),o&&this.code(o).endBlock(i),this}endBlock(o){const i=this._blockStarts.pop();if(i===void 0)throw new Error("CodeGen: not in self-balancing block");const g=this._nodes.length-i;if(g<0||o!==void 0&&g!==o)throw new Error(`CodeGen: wrong number of nodes: ${g} vs ${o} expected`);return this._nodes.length=i,this}func(o,i=t.nil,g,T){return this._blockNode(new u(o,i,g)),T&&this.code(T).endFunc(),this}endFunc(){return this._endBlockNode(u)}optimize(o=1){for(;o-- >0;)this._root.optimizeNodes(),this._root.optimizeNames(this._root.names,this._constants)}_leafNode(o){return this._currNode.nodes.push(o),this}_blockNode(o){this._currNode.nodes.push(o),this._nodes.push(o)}_endBlockNode(o,i){const g=this._currNode;if(g instanceof o||i&&g instanceof i)return this._nodes.pop(),this;throw new Error(`CodeGen: not in block "${i?`${o.kind}/${i.kind}`:o.kind}"`)}_elseNode(o){const i=this._currNode;if(!(i instanceof c))throw new Error('CodeGen: "else" without "if"');return this._currNode=i.else=o,this}get _root(){return this._nodes[0]}get _currNode(){const o=this._nodes;return o[o.length-1]}set _currNode(o){const i=this._nodes;i[i.length-1]=o}}e.CodeGen=M;function K(b,o){for(const i in o)b[i]=(b[i]||0)+(o[i]||0);return b}function ce(b,o){return o instanceof t._CodeOrName?K(b,o.names):b}function Q(b,o,i){if(b instanceof t.Name)return g(b);if(!T(b))return b;return new t._Code(b._items.reduce((j,F)=>(F instanceof t.Name&&(F=g(F)),F instanceof t._Code?j.push(...F._items):j.push(F),j),[]));function g(j){const F=i[j.str];return F===void 0||o[j.str]!==1?j:(delete o[j.str],F)}function T(j){return j instanceof t._Code&&j._items.some(F=>F instanceof t.Name&&o[F.str]===1&&i[F.str]!==void 0)}}function Lt(b,o){for(const i in o)b[i]=(b[i]||0)-(o[i]||0)}function Ze(b){return typeof b=="boolean"||typeof b=="number"||b===null?!b:(0,t._)`!${Te(b)}`}e.not=Ze;const qt=xe(e.operators.AND);function Bt(...b){return b.reduce(qt)}e.and=Bt;const Wt=xe(e.operators.OR);function Qt(...b){return b.reduce(Wt)}e.or=Qt;function xe(b){return(o,i)=>o===t.nil?i:i===t.nil?o:(0,t._)`${Te(o)} ${b} ${Te(i)}`}function Te(b){return b instanceof t.Name?b:(0,t._)`(${b})`}})(G);var H={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.checkStrictMode=e.getErrorPath=e.Type=e.useFunc=e.setEvaluated=e.evaluatedPropsToName=e.mergeEvaluated=e.eachItem=e.unescapeJsonPointer=e.escapeJsonPointer=e.escapeFragment=e.unescapeFragment=e.schemaRefOrVal=e.schemaHasRulesButRef=e.schemaHasRules=e.checkUnknownRules=e.alwaysValidSchema=e.toHash=void 0;const t=G,r=ye;function n(u){const l={};for(const v of u)l[v]=!0;return l}e.toHash=n;function s(u,l){return typeof l=="boolean"?l:Object.keys(l).length===0?!0:(a(u,l),!h(l,u.self.RULES.all))}e.alwaysValidSchema=s;function a(u,l=u.schema){const{opts:v,self:k}=u;if(!v.strictSchema||typeof l=="boolean")return;const A=k.RULES.keywords;for(const M in l)A[M]||C(u,`unknown keyword: "${M}"`)}e.checkUnknownRules=a;function h(u,l){if(typeof u=="boolean")return!u;for(const v in u)if(l[v])return!0;return!1}e.schemaHasRules=h;function p(u,l){if(typeof u=="boolean")return!u;for(const v in u)if(v!=="$ref"&&l.all[v])return!0;return!1}e.schemaHasRulesButRef=p;function _({topSchemaRef:u,schemaPath:l},v,k,A){if(!A){if(typeof v=="number"||typeof v=="boolean")return v;if(typeof v=="string")return(0,t._)`${v}`}return(0,t._)`${u}${l}${(0,t.getProperty)(k)}`}e.schemaRefOrVal=_;function m(u){return S(decodeURIComponent(u))}e.unescapeFragment=m;function $(u){return encodeURIComponent(w(u))}e.escapeFragment=$;function w(u){return typeof u=="number"?`${u}`:u.replace(/~/g,"~0").replace(/\//g,"~1")}e.escapeJsonPointer=w;function S(u){return u.replace(/~1/g,"/").replace(/~0/g,"~")}e.unescapeJsonPointer=S;function P(u,l){if(Array.isArray(u))for(const v of u)l(v);else l(u)}e.eachItem=P;function R({mergeNames:u,mergeToName:l,mergeValues:v,resultToName:k}){return(A,M,K,ce)=>{const Q=K===void 0?M:K instanceof t.Name?(M instanceof t.Name?u(A,M,K):l(A,M,K),K):M instanceof t.Name?(l(A,K,M),M):v(M,K);return ce===t.Name&&!(Q instanceof t.Name)?k(A,Q):Q}}e.mergeEvaluated={props:R({mergeNames:(u,l,v)=>u.if((0,t._)`${v} !== true && ${l} !== undefined`,()=>{u.if((0,t._)`${l} === true`,()=>u.assign(v,!0),()=>u.assign(v,(0,t._)`${v} || {}`).code((0,t._)`Object.assign(${v}, ${l})`))}),mergeToName:(u,l,v)=>u.if((0,t._)`${v} !== true`,()=>{l===!0?u.assign(v,!0):(u.assign(v,(0,t._)`${v} || {}`),y(u,v,l))}),mergeValues:(u,l)=>u===!0?!0:{...u,...l},resultToName:I}),items:R({mergeNames:(u,l,v)=>u.if((0,t._)`${v} !== true && ${l} !== undefined`,()=>u.assign(v,(0,t._)`${l} === true ? true : ${v} > ${l} ? ${v} : ${l}`)),mergeToName:(u,l,v)=>u.if((0,t._)`${v} !== true`,()=>u.assign(v,l===!0?!0:(0,t._)`${v} > ${l} ? ${v} : ${l}`)),mergeValues:(u,l)=>u===!0?!0:Math.max(u,l),resultToName:(u,l)=>u.var("items",l)})};function I(u,l){if(l===!0)return u.var("props",!0);const v=u.var("props",(0,t._)`{}`);return l!==void 0&&y(u,v,l),v}e.evaluatedPropsToName=I;function y(u,l,v){Object.keys(v).forEach(k=>u.assign((0,t._)`${l}${(0,t.getProperty)(k)}`,!0))}e.setEvaluated=y;const c={};function f(u,l){return u.scopeValue("func",{ref:l,code:c[l.code]||(c[l.code]=new r._Code(l.code))})}e.useFunc=f;var d;(function(u){u[u.Num=0]="Num",u[u.Str=1]="Str"})(d=e.Type||(e.Type={}));function E(u,l,v){if(u instanceof t.Name){const k=l===d.Num;return v?k?(0,t._)`"[" + ${u} + "]"`:(0,t._)`"['" + ${u} + "']"`:k?(0,t._)`"/" + ${u}`:(0,t._)`"/" + ${u}.replace(/~/g, "~0").replace(/\\//g, "~1")`}return v?(0,t.getProperty)(u).toString():"/"+w(u)}e.getErrorPath=E;function C(u,l,v=u.opts.strictSchema){if(v){if(l=`strict mode: ${l}`,v===!0)throw new Error(l);u.self.logger.warn(l)}}e.checkStrictMode=C})(H);var ee={};Object.defineProperty(ee,"__esModule",{value:!0});const z=G,lr={data:new z.Name("data"),valCxt:new z.Name("valCxt"),instancePath:new z.Name("instancePath"),parentData:new z.Name("parentData"),parentDataProperty:new z.Name("parentDataProperty"),rootData:new z.Name("rootData"),dynamicAnchors:new z.Name("dynamicAnchors"),vErrors:new z.Name("vErrors"),errors:new z.Name("errors"),this:new z.Name("this"),self:new z.Name("self"),scope:new z.Name("scope"),json:new z.Name("json"),jsonPos:new z.Name("jsonPos"),jsonLen:new z.Name("jsonLen"),jsonPart:new z.Name("jsonPart")};ee.default=lr;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.extendErrors=e.resetErrorsCount=e.reportExtraError=e.reportError=e.keyword$DataError=e.keywordError=void 0;const t=G,r=H,n=ee;e.keywordError={message:({keyword:y})=>(0,t.str)`must pass "${y}" keyword validation`},e.keyword$DataError={message:({keyword:y,schemaType:c})=>c?(0,t.str)`"${y}" keyword must be ${c} ($data)`:(0,t.str)`"${y}" keyword is invalid ($data)`};function s(y,c=e.keywordError,f,d){const{it:E}=y,{gen:C,compositeRule:u,allErrors:l}=E,v=w(y,c,f);d??(u||l)?_(C,v):m(E,(0,t._)`[${v}]`)}e.reportError=s;function a(y,c=e.keywordError,f){const{it:d}=y,{gen:E,compositeRule:C,allErrors:u}=d,l=w(y,c,f);_(E,l),C||u||m(d,n.default.vErrors)}e.reportExtraError=a;function h(y,c){y.assign(n.default.errors,c),y.if((0,t._)`${n.default.vErrors} !== null`,()=>y.if(c,()=>y.assign((0,t._)`${n.default.vErrors}.length`,c),()=>y.assign(n.default.vErrors,null)))}e.resetErrorsCount=h;function p({gen:y,keyword:c,schemaValue:f,data:d,errsCount:E,it:C}){if(E===void 0)throw new Error("ajv implementation error");const u=y.name("err");y.forRange("i",E,n.default.errors,l=>{y.const(u,(0,t._)`${n.default.vErrors}[${l}]`),y.if((0,t._)`${u}.instancePath === undefined`,()=>y.assign((0,t._)`${u}.instancePath`,(0,t.strConcat)(n.default.instancePath,C.errorPath))),y.assign((0,t._)`${u}.schemaPath`,(0,t.str)`${C.errSchemaPath}/${c}`),C.opts.verbose&&(y.assign((0,t._)`${u}.schema`,f),y.assign((0,t._)`${u}.data`,d))})}e.extendErrors=p;function _(y,c){const f=y.const("err",c);y.if((0,t._)`${n.default.vErrors} === null`,()=>y.assign(n.default.vErrors,(0,t._)`[${f}]`),(0,t._)`${n.default.vErrors}.push(${f})`),y.code((0,t._)`${n.default.errors}++`)}function m(y,c){const{gen:f,validateName:d,schemaEnv:E}=y;E.$async?f.throw((0,t._)`new ${y.ValidationError}(${c})`):(f.assign((0,t._)`${d}.errors`,c),f.return(!1))}const $={keyword:new t.Name("keyword"),schemaPath:new t.Name("schemaPath"),params:new t.Name("params"),propertyName:new t.Name("propertyName"),message:new t.Name("message"),schema:new t.Name("schema"),parentSchema:new t.Name("parentSchema")};function w(y,c,f){const{createErrors:d}=y.it;return d===!1?(0,t._)`{}`:S(y,c,f)}function S(y,c,f={}){const{gen:d,it:E}=y,C=[P(E,f),R(y,f)];return I(y,c,C),d.object(...C)}function P({errorPath:y},{instancePath:c}){const f=c?(0,t.str)`${y}${(0,r.getErrorPath)(c,r.Type.Str)}`:y;return[n.default.instancePath,(0,t.strConcat)(n.default.instancePath,f)]}function R({keyword:y,it:{errSchemaPath:c}},{schemaPath:f,parentSchema:d}){let E=d?c:(0,t.str)`${c}/${y}`;return f&&(E=(0,t.str)`${E}${(0,r.getErrorPath)(f,r.Type.Str)}`),[$.schemaPath,E]}function I(y,{params:c,message:f},d){const{keyword:E,data:C,schemaValue:u,it:l}=y,{opts:v,propertyName:k,topSchemaRef:A,schemaPath:M}=l;d.push([$.keyword,E],[$.params,typeof c=="function"?c(y):c||(0,t._)`{}`]),v.messages&&d.push([$.message,typeof f=="function"?f(y):f]),v.verbose&&d.push([$.schema,u],[$.parentSchema,(0,t._)`${A}${M}`],[n.default.data,C]),k&&d.push([$.propertyName,k])}})(_e);Object.defineProperty(fe,"__esModule",{value:!0});fe.boolOrEmptySchema=fe.topBoolOrEmptySchema=void 0;const dr=_e,fr=G,hr=ee,mr={message:"boolean schema is false"};function pr(e){const{gen:t,schema:r,validateName:n}=e;r===!1?pt(e,!1):typeof r=="object"&&r.$async===!0?t.return(hr.default.data):(t.assign((0,fr._)`${n}.errors`,null),t.return(!0))}fe.topBoolOrEmptySchema=pr;function yr(e,t){const{gen:r,schema:n}=e;n===!1?(r.var(t,!1),pt(e)):r.var(t,!0)}fe.boolOrEmptySchema=yr;function pt(e,t){const{gen:r,data:n}=e,s={gen:r,keyword:"false schema",data:n,schema:!1,schemaCode:!1,schemaValue:!1,params:{},it:e};(0,dr.reportError)(s,mr,void 0,t)}var He={},he={};Object.defineProperty(he,"__esModule",{value:!0});he.getRules=he.isJSONType=void 0;const $r=["string","number","integer","boolean","null","object","array"],_r=new Set($r);function gr(e){return typeof e=="string"&&_r.has(e)}he.isJSONType=gr;function vr(){const e={number:{type:"number",rules:[]},string:{type:"string",rules:[]},array:{type:"array",rules:[]},object:{type:"object",rules:[]}};return{types:{...e,integer:!0,boolean:!0,null:!0},rules:[{rules:[]},e.number,e.string,e.array,e.object],post:{rules:[]},all:{},keywords:{}}}he.getRules=vr;var Z={};Object.defineProperty(Z,"__esModule",{value:!0});Z.shouldUseRule=Z.shouldUseGroup=Z.schemaHasRulesForType=void 0;function wr({schema:e,self:t},r){const n=t.RULES.types[r];return n&&n!==!0&&yt(e,n)}Z.schemaHasRulesForType=wr;function yt(e,t){return t.rules.some(r=>$t(e,r))}Z.shouldUseGroup=yt;function $t(e,t){var r;return e[t.keyword]!==void 0||((r=t.definition.implements)===null||r===void 0?void 0:r.some(n=>e[n]!==void 0))}Z.shouldUseRule=$t;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.reportTypeError=e.checkDataTypes=e.checkDataType=e.coerceAndCheckDataType=e.getJSONTypes=e.getSchemaTypes=e.DataType=void 0;const t=he,r=Z,n=_e,s=G,a=H;var h;(function(d){d[d.Correct=0]="Correct",d[d.Wrong=1]="Wrong"})(h=e.DataType||(e.DataType={}));function p(d){const E=_(d.type);if(E.includes("null")){if(d.nullable===!1)throw new Error("type: null contradicts nullable: false")}else{if(!E.length&&d.nullable!==void 0)throw new Error('"nullable" cannot be used without "type"');d.nullable===!0&&E.push("null")}return E}e.getSchemaTypes=p;function _(d){const E=Array.isArray(d)?d:d?[d]:[];if(E.every(t.isJSONType))return E;throw new Error("type must be JSONType or JSONType[]: "+E.join(","))}e.getJSONTypes=_;function m(d,E){const{gen:C,data:u,opts:l}=d,v=w(E,l.coerceTypes),k=E.length>0&&!(v.length===0&&E.length===1&&(0,r.schemaHasRulesForType)(d,E[0]));if(k){const A=I(E,u,l.strictNumbers,h.Wrong);C.if(A,()=>{v.length?S(d,E,v):c(d)})}return k}e.coerceAndCheckDataType=m;const $=new Set(["string","number","integer","boolean","null"]);function w(d,E){return E?d.filter(C=>$.has(C)||E==="array"&&C==="array"):[]}function S(d,E,C){const{gen:u,data:l,opts:v}=d,k=u.let("dataType",(0,s._)`typeof ${l}`),A=u.let("coerced",(0,s._)`undefined`);v.coerceTypes==="array"&&u.if((0,s._)`${k} == 'object' && Array.isArray(${l}) && ${l}.length == 1`,()=>u.assign(l,(0,s._)`${l}[0]`).assign(k,(0,s._)`typeof ${l}`).if(I(E,l,v.strictNumbers),()=>u.assign(A,l))),u.if((0,s._)`${A} !== undefined`);for(const K of C)($.has(K)||K==="array"&&v.coerceTypes==="array")&&M(K);u.else(),c(d),u.endIf(),u.if((0,s._)`${A} !== undefined`,()=>{u.assign(l,A),P(d,A)});function M(K){switch(K){case"string":u.elseIf((0,s._)`${k} == "number" || ${k} == "boolean"`).assign(A,(0,s._)`"" + ${l}`).elseIf((0,s._)`${l} === null`).assign(A,(0,s._)`""`);return;case"number":u.elseIf((0,s._)`${k} == "boolean" || ${l} === null
              || (${k} == "string" && ${l} && ${l} == +${l})`).assign(A,(0,s._)`+${l}`);return;case"integer":u.elseIf((0,s._)`${k} === "boolean" || ${l} === null
              || (${k} === "string" && ${l} && ${l} == +${l} && !(${l} % 1))`).assign(A,(0,s._)`+${l}`);return;case"boolean":u.elseIf((0,s._)`${l} === "false" || ${l} === 0 || ${l} === null`).assign(A,!1).elseIf((0,s._)`${l} === "true" || ${l} === 1`).assign(A,!0);return;case"null":u.elseIf((0,s._)`${l} === "" || ${l} === 0 || ${l} === false`),u.assign(A,null);return;case"array":u.elseIf((0,s._)`${k} === "string" || ${k} === "number"
              || ${k} === "boolean" || ${l} === null`).assign(A,(0,s._)`[${l}]`)}}}function P({gen:d,parentData:E,parentDataProperty:C},u){d.if((0,s._)`${E} !== undefined`,()=>d.assign((0,s._)`${E}[${C}]`,u))}function R(d,E,C,u=h.Correct){const l=u===h.Correct?s.operators.EQ:s.operators.NEQ;let v;switch(d){case"null":return(0,s._)`${E} ${l} null`;case"array":v=(0,s._)`Array.isArray(${E})`;break;case"object":v=(0,s._)`${E} && typeof ${E} == "object" && !Array.isArray(${E})`;break;case"integer":v=k((0,s._)`!(${E} % 1) && !isNaN(${E})`);break;case"number":v=k();break;default:return(0,s._)`typeof ${E} ${l} ${d}`}return u===h.Correct?v:(0,s.not)(v);function k(A=s.nil){return(0,s.and)((0,s._)`typeof ${E} == "number"`,A,C?(0,s._)`isFinite(${E})`:s.nil)}}e.checkDataType=R;function I(d,E,C,u){if(d.length===1)return R(d[0],E,C,u);let l;const v=(0,a.toHash)(d);if(v.array&&v.object){const k=(0,s._)`typeof ${E} != "object"`;l=v.null?k:(0,s._)`!${E} || ${k}`,delete v.null,delete v.array,delete v.object}else l=s.nil;v.number&&delete v.integer;for(const k in v)l=(0,s.and)(l,R(k,E,C,u));return l}e.checkDataTypes=I;const y={message:({schema:d})=>`must be ${d}`,params:({schema:d,schemaValue:E})=>typeof d=="string"?(0,s._)`{type: ${d}}`:(0,s._)`{type: ${E}}`};function c(d){const E=f(d);(0,n.reportError)(E,y)}e.reportTypeError=c;function f(d){const{gen:E,data:C,schema:u}=d,l=(0,a.schemaRefOrVal)(d,u,"type");return{gen:E,keyword:"type",data:C,schema:u.type,schemaCode:l,schemaValue:l,parentSchema:u,params:{},it:d}}})(He);var be={};Object.defineProperty(be,"__esModule",{value:!0});be.assignDefaults=void 0;const ue=G,Er=H;function Sr(e,t){const{properties:r,items:n}=e.schema;if(t==="object"&&r)for(const s in r)tt(e,s,r[s].default);else t==="array"&&Array.isArray(n)&&n.forEach((s,a)=>tt(e,a,s.default))}be.assignDefaults=Sr;function tt(e,t,r){const{gen:n,compositeRule:s,data:a,opts:h}=e;if(r===void 0)return;const p=(0,ue._)`${a}${(0,ue.getProperty)(t)}`;if(s){(0,Er.checkStrictMode)(e,`default is ignored for: ${p}`);return}let _=(0,ue._)`${p} === undefined`;h.useDefaults==="empty"&&(_=(0,ue._)`${_} || ${p} === null || ${p} === ""`),n.if(_,(0,ue._)`${p} = ${(0,ue.stringify)(r)}`)}var Y={},D={};Object.defineProperty(D,"__esModule",{value:!0});D.validateUnion=D.validateArray=D.usePattern=D.callValidateCode=D.schemaProperties=D.allSchemaProperties=D.noPropertyInData=D.propertyInData=D.isOwnProperty=D.hasPropFunc=D.reportMissingProp=D.checkMissingProp=D.checkReportMissingProp=void 0;const V=G,Le=H,te=ee,Nr=H;function Pr(e,t){const{gen:r,data:n,it:s}=e;r.if(Be(r,n,t,s.opts.ownProperties),()=>{e.setParams({missingProperty:(0,V._)`${t}`},!0),e.error()})}D.checkReportMissingProp=Pr;function br({gen:e,data:t,it:{opts:r}},n,s){return(0,V.or)(...n.map(a=>(0,V.and)(Be(e,t,a,r.ownProperties),(0,V._)`${s} = ${a}`)))}D.checkMissingProp=br;function Or(e,t){e.setParams({missingProperty:t},!0),e.error()}D.reportMissingProp=Or;function _t(e){return e.scopeValue("func",{ref:Object.prototype.hasOwnProperty,code:(0,V._)`Object.prototype.hasOwnProperty`})}D.hasPropFunc=_t;function qe(e,t,r){return(0,V._)`${_t(e)}.call(${t}, ${r})`}D.isOwnProperty=qe;function Rr(e,t,r,n){const s=(0,V._)`${t}${(0,V.getProperty)(r)} !== undefined`;return n?(0,V._)`${s} && ${qe(e,t,r)}`:s}D.propertyInData=Rr;function Be(e,t,r,n){const s=(0,V._)`${t}${(0,V.getProperty)(r)} === undefined`;return n?(0,V.or)(s,(0,V.not)(qe(e,t,r))):s}D.noPropertyInData=Be;function gt(e){return e?Object.keys(e).filter(t=>t!=="__proto__"):[]}D.allSchemaProperties=gt;function Cr(e,t){return gt(t).filter(r=>!(0,Le.alwaysValidSchema)(e,t[r]))}D.schemaProperties=Cr;function kr({schemaCode:e,data:t,it:{gen:r,topSchemaRef:n,schemaPath:s,errorPath:a},it:h},p,_,m){const $=m?(0,V._)`${e}, ${t}, ${n}${s}`:t,w=[[te.default.instancePath,(0,V.strConcat)(te.default.instancePath,a)],[te.default.parentData,h.parentData],[te.default.parentDataProperty,h.parentDataProperty],[te.default.rootData,te.default.rootData]];h.opts.dynamicRef&&w.push([te.default.dynamicAnchors,te.default.dynamicAnchors]);const S=(0,V._)`${$}, ${r.object(...w)}`;return _!==V.nil?(0,V._)`${p}.call(${_}, ${S})`:(0,V._)`${p}(${S})`}D.callValidateCode=kr;const Tr=(0,V._)`new RegExp`;function Ir({gen:e,it:{opts:t}},r){const n=t.unicodeRegExp?"u":"",{regExp:s}=t.code,a=s(r,n);return e.scopeValue("pattern",{key:a.toString(),ref:a,code:(0,V._)`${s.code==="new RegExp"?Tr:(0,Nr.useFunc)(e,s)}(${r}, ${n})`})}D.usePattern=Ir;function jr(e){const{gen:t,data:r,keyword:n,it:s}=e,a=t.name("valid");if(s.allErrors){const p=t.let("valid",!0);return h(()=>t.assign(p,!1)),p}return t.var(a,!0),h(()=>t.break()),a;function h(p){const _=t.const("len",(0,V._)`${r}.length`);t.forRange("i",0,_,m=>{e.subschema({keyword:n,dataProp:m,dataPropType:Le.Type.Num},a),t.if((0,V.not)(a),p)})}}D.validateArray=jr;function Ar(e){const{gen:t,schema:r,keyword:n,it:s}=e;if(!Array.isArray(r))throw new Error("ajv implementation error");if(r.some(_=>(0,Le.alwaysValidSchema)(s,_))&&!s.opts.unevaluated)return;const h=t.let("valid",!1),p=t.name("_valid");t.block(()=>r.forEach((_,m)=>{const $=e.subschema({keyword:n,schemaProp:m,compositeRule:!0},p);t.assign(h,(0,V._)`${h} || ${p}`),e.mergeValidEvaluated($,p)||t.if((0,V.not)(h))})),e.result(h,()=>e.reset(),()=>e.error(!0))}D.validateUnion=Ar;Object.defineProperty(Y,"__esModule",{value:!0});Y.validateKeywordUsage=Y.validSchemaType=Y.funcKeywordCode=Y.macroKeywordCode=void 0;const U=G,ae=ee,Dr=D,Vr=_e;function Kr(e,t){const{gen:r,keyword:n,schema:s,parentSchema:a,it:h}=e,p=t.macro.call(h.self,s,a,h),_=vt(r,n,p);h.opts.validateSchema!==!1&&h.self.validateSchema(p,!0);const m=r.name("valid");e.subschema({schema:p,schemaPath:U.nil,errSchemaPath:`${h.errSchemaPath}/${n}`,topSchemaRef:_,compositeRule:!0},m),e.pass(m,()=>e.error(!0))}Y.macroKeywordCode=Kr;function Fr(e,t){var r;const{gen:n,keyword:s,schema:a,parentSchema:h,$data:p,it:_}=e;zr(_,t);const m=!p&&t.compile?t.compile.call(_.self,a,h,_):t.validate,$=vt(n,s,m),w=n.let("valid");e.block$data(w,S),e.ok((r=t.valid)!==null&&r!==void 0?r:w);function S(){if(t.errors===!1)I(),t.modifying&&rt(e),y(()=>e.error());else{const c=t.async?P():R();t.modifying&&rt(e),y(()=>Mr(e,c))}}function P(){const c=n.let("ruleErrs",null);return n.try(()=>I((0,U._)`await `),f=>n.assign(w,!1).if((0,U._)`${f} instanceof ${_.ValidationError}`,()=>n.assign(c,(0,U._)`${f}.errors`),()=>n.throw(f))),c}function R(){const c=(0,U._)`${$}.errors`;return n.assign(c,null),I(U.nil),c}function I(c=t.async?(0,U._)`await `:U.nil){const f=_.opts.passContext?ae.default.this:ae.default.self,d=!("compile"in t&&!p||t.schema===!1);n.assign(w,(0,U._)`${c}${(0,Dr.callValidateCode)(e,$,f,d)}`,t.modifying)}function y(c){var f;n.if((0,U.not)((f=t.valid)!==null&&f!==void 0?f:w),c)}}Y.funcKeywordCode=Fr;function rt(e){const{gen:t,data:r,it:n}=e;t.if(n.parentData,()=>t.assign(r,(0,U._)`${n.parentData}[${n.parentDataProperty}]`))}function Mr(e,t){const{gen:r}=e;r.if((0,U._)`Array.isArray(${t})`,()=>{r.assign(ae.default.vErrors,(0,U._)`${ae.default.vErrors} === null ? ${t} : ${ae.default.vErrors}.concat(${t})`).assign(ae.default.errors,(0,U._)`${ae.default.vErrors}.length`),(0,Vr.extendErrors)(e)},()=>e.error())}function zr({schemaEnv:e},t){if(t.async&&!e.$async)throw new Error("async keyword in sync schema")}function vt(e,t,r){if(r===void 0)throw new Error(`keyword "${t}" failed to compile`);return e.scopeValue("keyword",typeof r=="function"?{ref:r}:{ref:r,code:(0,U.stringify)(r)})}function Jr(e,t,r=!1){return!t.length||t.some(n=>n==="array"?Array.isArray(e):n==="object"?e&&typeof e=="object"&&!Array.isArray(e):typeof e==n||r&&typeof e>"u")}Y.validSchemaType=Jr;function Ur({schema:e,opts:t,self:r,errSchemaPath:n},s,a){if(Array.isArray(s.keyword)?!s.keyword.includes(a):s.keyword!==a)throw new Error("ajv implementation error");const h=s.dependencies;if(h!=null&&h.some(p=>!Object.prototype.hasOwnProperty.call(e,p)))throw new Error(`parent schema must have dependencies of ${a}: ${h.join(",")}`);if(s.validateSchema&&!s.validateSchema(e[a])){const _=`keyword "${a}" value is invalid at path "${n}": `+r.errorsText(s.validateSchema.errors);if(t.validateSchema==="log")r.logger.error(_);else throw new Error(_)}}Y.validateKeywordUsage=Ur;var se={};Object.defineProperty(se,"__esModule",{value:!0});se.extendSubschemaMode=se.extendSubschemaData=se.getSubschema=void 0;const X=G,wt=H;function Gr(e,{keyword:t,schemaProp:r,schema:n,schemaPath:s,errSchemaPath:a,topSchemaRef:h}){if(t!==void 0&&n!==void 0)throw new Error('both "keyword" and "schema" passed, only one allowed');if(t!==void 0){const p=e.schema[t];return r===void 0?{schema:p,schemaPath:(0,X._)`${e.schemaPath}${(0,X.getProperty)(t)}`,errSchemaPath:`${e.errSchemaPath}/${t}`}:{schema:p[r],schemaPath:(0,X._)`${e.schemaPath}${(0,X.getProperty)(t)}${(0,X.getProperty)(r)}`,errSchemaPath:`${e.errSchemaPath}/${t}/${(0,wt.escapeFragment)(r)}`}}if(n!==void 0){if(s===void 0||a===void 0||h===void 0)throw new Error('"schemaPath", "errSchemaPath" and "topSchemaRef" are required with "schema"');return{schema:n,schemaPath:s,topSchemaRef:h,errSchemaPath:a}}throw new Error('either "keyword" or "schema" must be passed')}se.getSubschema=Gr;function Hr(e,t,{dataProp:r,dataPropType:n,data:s,dataTypes:a,propertyName:h}){if(s!==void 0&&r!==void 0)throw new Error('both "data" and "dataProp" passed, only one allowed');const{gen:p}=t;if(r!==void 0){const{errorPath:m,dataPathArr:$,opts:w}=t,S=p.let("data",(0,X._)`${t.data}${(0,X.getProperty)(r)}`,!0);_(S),e.errorPath=(0,X.str)`${m}${(0,wt.getErrorPath)(r,n,w.jsPropertySyntax)}`,e.parentDataProperty=(0,X._)`${r}`,e.dataPathArr=[...$,e.parentDataProperty]}if(s!==void 0){const m=s instanceof X.Name?s:p.let("data",s,!0);_(m),h!==void 0&&(e.propertyName=h)}a&&(e.dataTypes=a);function _(m){e.data=m,e.dataLevel=t.dataLevel+1,e.dataTypes=[],t.definedProperties=new Set,e.parentData=t.data,e.dataNames=[...t.dataNames,m]}}se.extendSubschemaData=Hr;function Lr(e,{jtdDiscriminator:t,jtdMetadata:r,compositeRule:n,createErrors:s,allErrors:a}){n!==void 0&&(e.compositeRule=n),s!==void 0&&(e.createErrors=s),a!==void 0&&(e.allErrors=a),e.jtdDiscriminator=t,e.jtdMetadata=r}se.extendSubschemaMode=Lr;var J={},Et=function e(t,r){if(t===r)return!0;if(t&&r&&typeof t=="object"&&typeof r=="object"){if(t.constructor!==r.constructor)return!1;var n,s,a;if(Array.isArray(t)){if(n=t.length,n!=r.length)return!1;for(s=n;s--!==0;)if(!e(t[s],r[s]))return!1;return!0}if(t.constructor===RegExp)return t.source===r.source&&t.flags===r.flags;if(t.valueOf!==Object.prototype.valueOf)return t.valueOf()===r.valueOf();if(t.toString!==Object.prototype.toString)return t.toString()===r.toString();if(a=Object.keys(t),n=a.length,n!==Object.keys(r).length)return!1;for(s=n;s--!==0;)if(!Object.prototype.hasOwnProperty.call(r,a[s]))return!1;for(s=n;s--!==0;){var h=a[s];if(!e(t[h],r[h]))return!1}return!0}return t!==t&&r!==r},St={exports:{}},re=St.exports=function(e,t,r){typeof t=="function"&&(r=t,t={}),r=t.cb||r;var n=typeof r=="function"?r:r.pre||function(){},s=r.post||function(){};we(t,n,s,e,"",e)};re.keywords={additionalItems:!0,items:!0,contains:!0,additionalProperties:!0,propertyNames:!0,not:!0,if:!0,then:!0,else:!0};re.arrayKeywords={items:!0,allOf:!0,anyOf:!0,oneOf:!0};re.propsKeywords={$defs:!0,definitions:!0,properties:!0,patternProperties:!0,dependencies:!0};re.skipKeywords={default:!0,enum:!0,const:!0,required:!0,maximum:!0,minimum:!0,exclusiveMaximum:!0,exclusiveMinimum:!0,multipleOf:!0,maxLength:!0,minLength:!0,pattern:!0,format:!0,maxItems:!0,minItems:!0,uniqueItems:!0,maxProperties:!0,minProperties:!0};function we(e,t,r,n,s,a,h,p,_,m){if(n&&typeof n=="object"&&!Array.isArray(n)){t(n,s,a,h,p,_,m);for(var $ in n){var w=n[$];if(Array.isArray(w)){if($ in re.arrayKeywords)for(var S=0;S<w.length;S++)we(e,t,r,w[S],s+"/"+$+"/"+S,a,s,$,n,S)}else if($ in re.propsKeywords){if(w&&typeof w=="object")for(var P in w)we(e,t,r,w[P],s+"/"+$+"/"+qr(P),a,s,$,n,P)}else($ in re.keywords||e.allKeys&&!($ in re.skipKeywords))&&we(e,t,r,w,s+"/"+$,a,s,$,n)}r(n,s,a,h,p,_,m)}}function qr(e){return e.replace(/~/g,"~0").replace(/\//g,"~1")}var Br=St.exports;Object.defineProperty(J,"__esModule",{value:!0});J.getSchemaRefs=J.resolveUrl=J.normalizeId=J._getFullPath=J.getFullPath=J.inlineRef=void 0;const Wr=H,Qr=Et,Xr=Br,Yr=new Set(["type","format","pattern","maxLength","minLength","maxProperties","minProperties","maxItems","minItems","maximum","minimum","uniqueItems","multipleOf","required","enum","const"]);function Zr(e,t=!0){return typeof e=="boolean"?!0:t===!0?!Ke(e):t?Nt(e)<=t:!1}J.inlineRef=Zr;const xr=new Set(["$ref","$recursiveRef","$recursiveAnchor","$dynamicRef","$dynamicAnchor"]);function Ke(e){for(const t in e){if(xr.has(t))return!0;const r=e[t];if(Array.isArray(r)&&r.some(Ke)||typeof r=="object"&&Ke(r))return!0}return!1}function Nt(e){let t=0;for(const r in e){if(r==="$ref")return 1/0;if(t++,!Yr.has(r)&&(typeof e[r]=="object"&&(0,Wr.eachItem)(e[r],n=>t+=Nt(n)),t===1/0))return 1/0}return t}function Pt(e,t="",r){r!==!1&&(t=le(t));const n=e.parse(t);return bt(e,n)}J.getFullPath=Pt;function bt(e,t){return e.serialize(t).split("#")[0]+"#"}J._getFullPath=bt;const en=/#\/?$/;function le(e){return e?e.replace(en,""):""}J.normalizeId=le;function tn(e,t,r){return r=le(r),e.resolve(t,r)}J.resolveUrl=tn;const rn=/^[a-z_][-a-z0-9._]*$/i;function nn(e,t){if(typeof e=="boolean")return{};const{schemaId:r,uriResolver:n}=this.opts,s=le(e[r]||t),a={"":s},h=Pt(n,s,!1),p={},_=new Set;return Xr(e,{allKeys:!0},(w,S,P,R)=>{if(R===void 0)return;const I=h+S;let y=a[R];typeof w[r]=="string"&&(y=c.call(this,w[r])),f.call(this,w.$anchor),f.call(this,w.$dynamicAnchor),a[S]=y;function c(d){const E=this.opts.uriResolver.resolve;if(d=le(y?E(y,d):d),_.has(d))throw $(d);_.add(d);let C=this.refs[d];return typeof C=="string"&&(C=this.refs[C]),typeof C=="object"?m(w,C.schema,d):d!==le(I)&&(d[0]==="#"?(m(w,p[d],d),p[d]=w):this.refs[d]=I),d}function f(d){if(typeof d=="string"){if(!rn.test(d))throw new Error(`invalid anchor "${d}"`);c.call(this,`#${d}`)}}}),p;function m(w,S,P){if(S!==void 0&&!Qr(w,S))throw $(P)}function $(w){return new Error(`reference "${w}" resolves to more than one schema`)}}J.getSchemaRefs=nn;Object.defineProperty(ne,"__esModule",{value:!0});ne.getData=ne.KeywordCxt=ne.validateFunctionCode=void 0;const Ot=fe,nt=He,We=Z,Se=He,sn=be,pe=Y,je=se,N=G,O=ee,on=J,x=H,me=_e;function an(e){if(kt(e)&&(Tt(e),Ct(e))){ln(e);return}Rt(e,()=>(0,Ot.topBoolOrEmptySchema)(e))}ne.validateFunctionCode=an;function Rt({gen:e,validateName:t,schema:r,schemaEnv:n,opts:s},a){s.code.es5?e.func(t,(0,N._)`${O.default.data}, ${O.default.valCxt}`,n.$async,()=>{e.code((0,N._)`"use strict"; ${st(r,s)}`),un(e,s),e.code(a)}):e.func(t,(0,N._)`${O.default.data}, ${cn(s)}`,n.$async,()=>e.code(st(r,s)).code(a))}function cn(e){return(0,N._)`{${O.default.instancePath}="", ${O.default.parentData}, ${O.default.parentDataProperty}, ${O.default.rootData}=${O.default.data}${e.dynamicRef?(0,N._)`, ${O.default.dynamicAnchors}={}`:N.nil}}={}`}function un(e,t){e.if(O.default.valCxt,()=>{e.var(O.default.instancePath,(0,N._)`${O.default.valCxt}.${O.default.instancePath}`),e.var(O.default.parentData,(0,N._)`${O.default.valCxt}.${O.default.parentData}`),e.var(O.default.parentDataProperty,(0,N._)`${O.default.valCxt}.${O.default.parentDataProperty}`),e.var(O.default.rootData,(0,N._)`${O.default.valCxt}.${O.default.rootData}`),t.dynamicRef&&e.var(O.default.dynamicAnchors,(0,N._)`${O.default.valCxt}.${O.default.dynamicAnchors}`)},()=>{e.var(O.default.instancePath,(0,N._)`""`),e.var(O.default.parentData,(0,N._)`undefined`),e.var(O.default.parentDataProperty,(0,N._)`undefined`),e.var(O.default.rootData,O.default.data),t.dynamicRef&&e.var(O.default.dynamicAnchors,(0,N._)`{}`)})}function ln(e){const{schema:t,opts:r,gen:n}=e;Rt(e,()=>{r.$comment&&t.$comment&&jt(e),pn(e),n.let(O.default.vErrors,null),n.let(O.default.errors,0),r.unevaluated&&dn(e),It(e),_n(e)})}function dn(e){const{gen:t,validateName:r}=e;e.evaluated=t.const("evaluated",(0,N._)`${r}.evaluated`),t.if((0,N._)`${e.evaluated}.dynamicProps`,()=>t.assign((0,N._)`${e.evaluated}.props`,(0,N._)`undefined`)),t.if((0,N._)`${e.evaluated}.dynamicItems`,()=>t.assign((0,N._)`${e.evaluated}.items`,(0,N._)`undefined`))}function st(e,t){const r=typeof e=="object"&&e[t.schemaId];return r&&(t.code.source||t.code.process)?(0,N._)`/*# sourceURL=${r} */`:N.nil}function fn(e,t){if(kt(e)&&(Tt(e),Ct(e))){hn(e,t);return}(0,Ot.boolOrEmptySchema)(e,t)}function Ct({schema:e,self:t}){if(typeof e=="boolean")return!e;for(const r in e)if(t.RULES.all[r])return!0;return!1}function kt(e){return typeof e.schema!="boolean"}function hn(e,t){const{schema:r,gen:n,opts:s}=e;s.$comment&&r.$comment&&jt(e),yn(e),$n(e);const a=n.const("_errs",O.default.errors);It(e,a),n.var(t,(0,N._)`${a} === ${O.default.errors}`)}function Tt(e){(0,x.checkUnknownRules)(e),mn(e)}function It(e,t){if(e.opts.jtd)return ot(e,[],!1,t);const r=(0,nt.getSchemaTypes)(e.schema),n=(0,nt.coerceAndCheckDataType)(e,r);ot(e,r,!n,t)}function mn(e){const{schema:t,errSchemaPath:r,opts:n,self:s}=e;t.$ref&&n.ignoreKeywordsWithRef&&(0,x.schemaHasRulesButRef)(t,s.RULES)&&s.logger.warn(`$ref: keywords ignored in schema at path "${r}"`)}function pn(e){const{schema:t,opts:r}=e;t.default!==void 0&&r.useDefaults&&r.strictSchema&&(0,x.checkStrictMode)(e,"default is ignored in the schema root")}function yn(e){const t=e.schema[e.opts.schemaId];t&&(e.baseId=(0,on.resolveUrl)(e.opts.uriResolver,e.baseId,t))}function $n(e){if(e.schema.$async&&!e.schemaEnv.$async)throw new Error("async schema in sync schema")}function jt({gen:e,schemaEnv:t,schema:r,errSchemaPath:n,opts:s}){const a=r.$comment;if(s.$comment===!0)e.code((0,N._)`${O.default.self}.logger.log(${a})`);else if(typeof s.$comment=="function"){const h=(0,N.str)`${n}/$comment`,p=e.scopeValue("root",{ref:t.root});e.code((0,N._)`${O.default.self}.opts.$comment(${a}, ${h}, ${p}.schema)`)}}function _n(e){const{gen:t,schemaEnv:r,validateName:n,ValidationError:s,opts:a}=e;r.$async?t.if((0,N._)`${O.default.errors} === 0`,()=>t.return(O.default.data),()=>t.throw((0,N._)`new ${s}(${O.default.vErrors})`)):(t.assign((0,N._)`${n}.errors`,O.default.vErrors),a.unevaluated&&gn(e),t.return((0,N._)`${O.default.errors} === 0`))}function gn({gen:e,evaluated:t,props:r,items:n}){r instanceof N.Name&&e.assign((0,N._)`${t}.props`,r),n instanceof N.Name&&e.assign((0,N._)`${t}.items`,n)}function ot(e,t,r,n){const{gen:s,schema:a,data:h,allErrors:p,opts:_,self:m}=e,{RULES:$}=m;if(a.$ref&&(_.ignoreKeywordsWithRef||!(0,x.schemaHasRulesButRef)(a,$))){s.block(()=>Vt(e,"$ref",$.all.$ref.definition));return}_.jtd||vn(e,t),s.block(()=>{for(const S of $.rules)w(S);w($.post)});function w(S){(0,We.shouldUseGroup)(a,S)&&(S.type?(s.if((0,Se.checkDataType)(S.type,h,_.strictNumbers)),at(e,S),t.length===1&&t[0]===S.type&&r&&(s.else(),(0,Se.reportTypeError)(e)),s.endIf()):at(e,S),p||s.if((0,N._)`${O.default.errors} === ${n||0}`))}}function at(e,t){const{gen:r,schema:n,opts:{useDefaults:s}}=e;s&&(0,sn.assignDefaults)(e,t.type),r.block(()=>{for(const a of t.rules)(0,We.shouldUseRule)(n,a)&&Vt(e,a.keyword,a.definition,t.type)})}function vn(e,t){e.schemaEnv.meta||!e.opts.strictTypes||(wn(e,t),e.opts.allowUnionTypes||En(e,t),Sn(e,e.dataTypes))}function wn(e,t){if(t.length){if(!e.dataTypes.length){e.dataTypes=t;return}t.forEach(r=>{At(e.dataTypes,r)||Qe(e,`type "${r}" not allowed by context "${e.dataTypes.join(",")}"`)}),Pn(e,t)}}function En(e,t){t.length>1&&!(t.length===2&&t.includes("null"))&&Qe(e,"use allowUnionTypes to allow union type keyword")}function Sn(e,t){const r=e.self.RULES.all;for(const n in r){const s=r[n];if(typeof s=="object"&&(0,We.shouldUseRule)(e.schema,s)){const{type:a}=s.definition;a.length&&!a.some(h=>Nn(t,h))&&Qe(e,`missing type "${a.join(",")}" for keyword "${n}"`)}}}function Nn(e,t){return e.includes(t)||t==="number"&&e.includes("integer")}function At(e,t){return e.includes(t)||t==="integer"&&e.includes("number")}function Pn(e,t){const r=[];for(const n of e.dataTypes)At(t,n)?r.push(n):t.includes("integer")&&n==="number"&&r.push("integer");e.dataTypes=r}function Qe(e,t){const r=e.schemaEnv.baseId+e.errSchemaPath;t+=` at "${r}" (strictTypes)`,(0,x.checkStrictMode)(e,t,e.opts.strictTypes)}class Dt{constructor(t,r,n){if((0,pe.validateKeywordUsage)(t,r,n),this.gen=t.gen,this.allErrors=t.allErrors,this.keyword=n,this.data=t.data,this.schema=t.schema[n],this.$data=r.$data&&t.opts.$data&&this.schema&&this.schema.$data,this.schemaValue=(0,x.schemaRefOrVal)(t,this.schema,n,this.$data),this.schemaType=r.schemaType,this.parentSchema=t.schema,this.params={},this.it=t,this.def=r,this.$data)this.schemaCode=t.gen.const("vSchema",Kt(this.$data,t));else if(this.schemaCode=this.schemaValue,!(0,pe.validSchemaType)(this.schema,r.schemaType,r.allowUndefined))throw new Error(`${n} value must be ${JSON.stringify(r.schemaType)}`);("code"in r?r.trackErrors:r.errors!==!1)&&(this.errsCount=t.gen.const("_errs",O.default.errors))}result(t,r,n){this.failResult((0,N.not)(t),r,n)}failResult(t,r,n){this.gen.if(t),n?n():this.error(),r?(this.gen.else(),r(),this.allErrors&&this.gen.endIf()):this.allErrors?this.gen.endIf():this.gen.else()}pass(t,r){this.failResult((0,N.not)(t),void 0,r)}fail(t){if(t===void 0){this.error(),this.allErrors||this.gen.if(!1);return}this.gen.if(t),this.error(),this.allErrors?this.gen.endIf():this.gen.else()}fail$data(t){if(!this.$data)return this.fail(t);const{schemaCode:r}=this;this.fail((0,N._)`${r} !== undefined && (${(0,N.or)(this.invalid$data(),t)})`)}error(t,r,n){if(r){this.setParams(r),this._error(t,n),this.setParams({});return}this._error(t,n)}_error(t,r){(t?me.reportExtraError:me.reportError)(this,this.def.error,r)}$dataError(){(0,me.reportError)(this,this.def.$dataError||me.keyword$DataError)}reset(){if(this.errsCount===void 0)throw new Error('add "trackErrors" to keyword definition');(0,me.resetErrorsCount)(this.gen,this.errsCount)}ok(t){this.allErrors||this.gen.if(t)}setParams(t,r){r?Object.assign(this.params,t):this.params=t}block$data(t,r,n=N.nil){this.gen.block(()=>{this.check$data(t,n),r()})}check$data(t=N.nil,r=N.nil){if(!this.$data)return;const{gen:n,schemaCode:s,schemaType:a,def:h}=this;n.if((0,N.or)((0,N._)`${s} === undefined`,r)),t!==N.nil&&n.assign(t,!0),(a.length||h.validateSchema)&&(n.elseIf(this.invalid$data()),this.$dataError(),t!==N.nil&&n.assign(t,!1)),n.else()}invalid$data(){const{gen:t,schemaCode:r,schemaType:n,def:s,it:a}=this;return(0,N.or)(h(),p());function h(){if(n.length){if(!(r instanceof N.Name))throw new Error("ajv implementation error");const _=Array.isArray(n)?n:[n];return(0,N._)`${(0,Se.checkDataTypes)(_,r,a.opts.strictNumbers,Se.DataType.Wrong)}`}return N.nil}function p(){if(s.validateSchema){const _=t.scopeValue("validate$data",{ref:s.validateSchema});return(0,N._)`!${_}(${r})`}return N.nil}}subschema(t,r){const n=(0,je.getSubschema)(this.it,t);(0,je.extendSubschemaData)(n,this.it,t),(0,je.extendSubschemaMode)(n,t);const s={...this.it,...n,items:void 0,props:void 0};return fn(s,r),s}mergeEvaluated(t,r){const{it:n,gen:s}=this;n.opts.unevaluated&&(n.props!==!0&&t.props!==void 0&&(n.props=x.mergeEvaluated.props(s,t.props,n.props,r)),n.items!==!0&&t.items!==void 0&&(n.items=x.mergeEvaluated.items(s,t.items,n.items,r)))}mergeValidEvaluated(t,r){const{it:n,gen:s}=this;if(n.opts.unevaluated&&(n.props!==!0||n.items!==!0))return s.if(r,()=>this.mergeEvaluated(t,N.Name)),!0}}ne.KeywordCxt=Dt;function Vt(e,t,r,n){const s=new Dt(e,r,t);"code"in r?r.code(s,n):s.$data&&r.validate?(0,pe.funcKeywordCode)(s,r):"macro"in r?(0,pe.macroKeywordCode)(s,r):(r.compile||r.validate)&&(0,pe.funcKeywordCode)(s,r)}const bn=/^\/(?:[^~]|~0|~1)*$/,On=/^([0-9]+)(#|\/(?:[^~]|~0|~1)*)?$/;function Kt(e,{dataLevel:t,dataNames:r,dataPathArr:n}){let s,a;if(e==="")return O.default.rootData;if(e[0]==="/"){if(!bn.test(e))throw new Error(`Invalid JSON-pointer: ${e}`);s=e,a=O.default.rootData}else{const m=On.exec(e);if(!m)throw new Error(`Invalid JSON-pointer: ${e}`);const $=+m[1];if(s=m[2],s==="#"){if($>=t)throw new Error(_("property/index",$));return n[t-$]}if($>t)throw new Error(_("data",$));if(a=r[t-$],!s)return a}let h=a;const p=s.split("/");for(const m of p)m&&(a=(0,N._)`${a}${(0,N.getProperty)((0,x.unescapeJsonPointer)(m))}`,h=(0,N._)`${h} && ${a}`);return h;function _(m,$){return`Cannot access ${m} ${$} levels up, current level is ${t}`}}ne.getData=Kt;var Xe={};Object.defineProperty(Xe,"__esModule",{value:!0});class Rn extends Error{constructor(t){super("validation failed"),this.errors=t,this.ajv=this.validation=!0}}Xe.default=Rn;var Ft={};Object.defineProperty(Ft,"__esModule",{value:!0});const Ae=J;class Cn extends Error{constructor(t,r,n,s){super(s||`can't resolve reference ${n} from id ${r}`),this.missingRef=(0,Ae.resolveUrl)(t,r,n),this.missingSchema=(0,Ae.normalizeId)((0,Ae.getFullPath)(t,this.missingRef))}}Ft.default=Cn;var B={};Object.defineProperty(B,"__esModule",{value:!0});B.resolveSchema=B.getCompilingSchema=B.resolveRef=B.compileSchema=B.SchemaEnv=void 0;const L=G,kn=Xe,oe=ee,W=J,it=H,Tn=ne;class Oe{constructor(t){var r;this.refs={},this.dynamicAnchors={};let n;typeof t.schema=="object"&&(n=t.schema),this.schema=t.schema,this.schemaId=t.schemaId,this.root=t.root||this,this.baseId=(r=t.baseId)!==null&&r!==void 0?r:(0,W.normalizeId)(n==null?void 0:n[t.schemaId||"$id"]),this.schemaPath=t.schemaPath,this.localRefs=t.localRefs,this.meta=t.meta,this.$async=n==null?void 0:n.$async,this.refs={}}}B.SchemaEnv=Oe;function Ye(e){const t=Mt.call(this,e);if(t)return t;const r=(0,W.getFullPath)(this.opts.uriResolver,e.root.baseId),{es5:n,lines:s}=this.opts.code,{ownProperties:a}=this.opts,h=new L.CodeGen(this.scope,{es5:n,lines:s,ownProperties:a});let p;e.$async&&(p=h.scopeValue("Error",{ref:kn.default,code:(0,L._)`require("ajv/dist/runtime/validation_error").default`}));const _=h.scopeName("validate");e.validateName=_;const m={gen:h,allErrors:this.opts.allErrors,data:oe.default.data,parentData:oe.default.parentData,parentDataProperty:oe.default.parentDataProperty,dataNames:[oe.default.data],dataPathArr:[L.nil],dataLevel:0,dataTypes:[],definedProperties:new Set,topSchemaRef:h.scopeValue("schema",this.opts.code.source===!0?{ref:e.schema,code:(0,L.stringify)(e.schema)}:{ref:e.schema}),validateName:_,ValidationError:p,schema:e.schema,schemaEnv:e,rootId:r,baseId:e.baseId||r,schemaPath:L.nil,errSchemaPath:e.schemaPath||(this.opts.jtd?"":"#"),errorPath:(0,L._)`""`,opts:this.opts,self:this};let $;try{this._compilations.add(e),(0,Tn.validateFunctionCode)(m),h.optimize(this.opts.code.optimize);const w=h.toString();$=`${h.scopeRefs(oe.default.scope)}return ${w}`,this.opts.code.process&&($=this.opts.code.process($,e));const P=new Function(`${oe.default.self}`,`${oe.default.scope}`,$)(this,this.scope.get());if(this.scope.value(_,{ref:P}),P.errors=null,P.schema=e.schema,P.schemaEnv=e,e.$async&&(P.$async=!0),this.opts.code.source===!0&&(P.source={validateName:_,validateCode:w,scopeValues:h._values}),this.opts.unevaluated){const{props:R,items:I}=m;P.evaluated={props:R instanceof L.Name?void 0:R,items:I instanceof L.Name?void 0:I,dynamicProps:R instanceof L.Name,dynamicItems:I instanceof L.Name},P.source&&(P.source.evaluated=(0,L.stringify)(P.evaluated))}return e.validate=P,e}catch(w){throw delete e.validate,delete e.validateName,$&&this.logger.error("Error compiling schema, function code:",$),w}finally{this._compilations.delete(e)}}B.compileSchema=Ye;function In(e,t,r){var n;r=(0,W.resolveUrl)(this.opts.uriResolver,t,r);const s=e.refs[r];if(s)return s;let a=Dn.call(this,e,r);if(a===void 0){const h=(n=e.localRefs)===null||n===void 0?void 0:n[r],{schemaId:p}=this.opts;h&&(a=new Oe({schema:h,schemaId:p,root:e,baseId:t}))}if(a!==void 0)return e.refs[r]=jn.call(this,a)}B.resolveRef=In;function jn(e){return(0,W.inlineRef)(e.schema,this.opts.inlineRefs)?e.schema:e.validate?e:Ye.call(this,e)}function Mt(e){for(const t of this._compilations)if(An(t,e))return t}B.getCompilingSchema=Mt;function An(e,t){return e.schema===t.schema&&e.root===t.root&&e.baseId===t.baseId}function Dn(e,t){let r;for(;typeof(r=this.refs[t])=="string";)t=r;return r||this.schemas[t]||Re.call(this,e,t)}function Re(e,t){const r=this.opts.uriResolver.parse(t),n=(0,W._getFullPath)(this.opts.uriResolver,r);let s=(0,W.getFullPath)(this.opts.uriResolver,e.baseId,void 0);if(Object.keys(e.schema).length>0&&n===s)return De.call(this,r,e);const a=(0,W.normalizeId)(n),h=this.refs[a]||this.schemas[a];if(typeof h=="string"){const p=Re.call(this,e,h);return typeof(p==null?void 0:p.schema)!="object"?void 0:De.call(this,r,p)}if(typeof(h==null?void 0:h.schema)=="object"){if(h.validate||Ye.call(this,h),a===(0,W.normalizeId)(t)){const{schema:p}=h,{schemaId:_}=this.opts,m=p[_];return m&&(s=(0,W.resolveUrl)(this.opts.uriResolver,s,m)),new Oe({schema:p,schemaId:_,root:e,baseId:s})}return De.call(this,r,h)}}B.resolveSchema=Re;const Vn=new Set(["properties","patternProperties","enum","dependencies","definitions"]);function De(e,{baseId:t,schema:r,root:n}){var s;if(((s=e.fragment)===null||s===void 0?void 0:s[0])!=="/")return;for(const p of e.fragment.slice(1).split("/")){if(typeof r=="boolean")return;const _=r[(0,it.unescapeFragment)(p)];if(_===void 0)return;r=_;const m=typeof r=="object"&&r[this.opts.schemaId];!Vn.has(p)&&m&&(t=(0,W.resolveUrl)(this.opts.uriResolver,t,m))}let a;if(typeof r!="boolean"&&r.$ref&&!(0,it.schemaHasRulesButRef)(r,this.RULES)){const p=(0,W.resolveUrl)(this.opts.uriResolver,t,r.$ref);a=Re.call(this,n,p)}const{schemaId:h}=this.opts;if(a=a||new Oe({schema:r,schemaId:h,root:n,baseId:t}),a.schema!==a.root.schema)return a}var zt={};Object.defineProperty(zt,"__esModule",{value:!0});const Jt=Et;Jt.code='require("ajv/dist/runtime/equal").default';zt.default=Jt;var Ce={};Object.defineProperty(Ce,"__esModule",{value:!0});Ce.validateAdditionalItems=void 0;const ie=G,Fe=H,Kn={message:({params:{len:e}})=>(0,ie.str)`must NOT have more than ${e} items`,params:({params:{len:e}})=>(0,ie._)`{limit: ${e}}`},Fn={keyword:"additionalItems",type:"array",schemaType:["boolean","object"],before:"uniqueItems",error:Kn,code(e){const{parentSchema:t,it:r}=e,{items:n}=t;if(!Array.isArray(n)){(0,Fe.checkStrictMode)(r,'"additionalItems" is ignored when "items" is not an array of schemas');return}Ut(e,n)}};function Ut(e,t){const{gen:r,schema:n,data:s,keyword:a,it:h}=e;h.items=!0;const p=r.const("len",(0,ie._)`${s}.length`);if(n===!1)e.setParams({len:t.length}),e.pass((0,ie._)`${p} <= ${t.length}`);else if(typeof n=="object"&&!(0,Fe.alwaysValidSchema)(h,n)){const m=r.var("valid",(0,ie._)`${p} <= ${t.length}`);r.if((0,ie.not)(m),()=>_(m)),e.ok(m)}function _(m){r.forRange("i",t.length,p,$=>{e.subschema({keyword:a,dataProp:$,dataPropType:Fe.Type.Num},m),h.allErrors||r.if((0,ie.not)(m),()=>r.break())})}}Ce.validateAdditionalItems=Ut;Ce.default=Fn;var ke={};Object.defineProperty(ke,"__esModule",{value:!0});ke.validateTuple=void 0;const ct=G,Ee=H,Mn=D,zn={keyword:"items",type:"array",schemaType:["object","array","boolean"],before:"uniqueItems",code(e){const{schema:t,it:r}=e;if(Array.isArray(t))return Gt(e,"additionalItems",t);r.items=!0,!(0,Ee.alwaysValidSchema)(r,t)&&e.ok((0,Mn.validateArray)(e))}};function Gt(e,t,r=e.schema){const{gen:n,parentSchema:s,data:a,keyword:h,it:p}=e;$(s),p.opts.unevaluated&&r.length&&p.items!==!0&&(p.items=Ee.mergeEvaluated.items(n,r.length,p.items));const _=n.name("valid"),m=n.const("len",(0,ct._)`${a}.length`);r.forEach((w,S)=>{(0,Ee.alwaysValidSchema)(p,w)||(n.if((0,ct._)`${m} > ${S}`,()=>e.subschema({keyword:h,schemaProp:S,dataProp:S},_)),e.ok(_))});function $(w){const{opts:S,errSchemaPath:P}=p,R=r.length,I=R===w.minItems&&(R===w.maxItems||w[t]===!1);if(S.strictTuples&&!I){const y=`"${h}" is ${R}-tuple, but minItems or maxItems/${t} are not specified or different at path "${P}"`;(0,Ee.checkStrictMode)(p,y,S.strictTuples)}}}ke.validateTuple=Gt;ke.default=zn;var Ht={};Object.defineProperty(Ht,"__esModule",{value:!0});const ge=D,q=G,Jn=ee,ve=H,Un={message:"must NOT have additional properties",params:({params:e})=>(0,q._)`{additionalProperty: ${e.additionalProperty}}`},Gn={keyword:"additionalProperties",type:["object"],schemaType:["boolean","object"],allowUndefined:!0,trackErrors:!0,error:Un,code(e){const{gen:t,schema:r,parentSchema:n,data:s,errsCount:a,it:h}=e;if(!a)throw new Error("ajv implementation error");const{allErrors:p,opts:_}=h;if(h.props=!0,_.removeAdditional!=="all"&&(0,ve.alwaysValidSchema)(h,r))return;const m=(0,ge.allSchemaProperties)(n.properties),$=(0,ge.allSchemaProperties)(n.patternProperties);w(),e.ok((0,q._)`${a} === ${Jn.default.errors}`);function w(){t.forIn("key",s,y=>{!m.length&&!$.length?R(y):t.if(S(y),()=>R(y))})}function S(y){let c;if(m.length>8){const f=(0,ve.schemaRefOrVal)(h,n.properties,"properties");c=(0,ge.isOwnProperty)(t,f,y)}else m.length?c=(0,q.or)(...m.map(f=>(0,q._)`${y} === ${f}`)):c=q.nil;return $.length&&(c=(0,q.or)(c,...$.map(f=>(0,q._)`${(0,ge.usePattern)(e,f)}.test(${y})`))),(0,q.not)(c)}function P(y){t.code((0,q._)`delete ${s}[${y}]`)}function R(y){if(_.removeAdditional==="all"||_.removeAdditional&&r===!1){P(y);return}if(r===!1){e.setParams({additionalProperty:y}),e.error(),p||t.break();return}if(typeof r=="object"&&!(0,ve.alwaysValidSchema)(h,r)){const c=t.name("valid");_.removeAdditional==="failing"?(I(y,c,!1),t.if((0,q.not)(c),()=>{e.reset(),P(y)})):(I(y,c),p||t.if((0,q.not)(c),()=>t.break()))}}function I(y,c,f){const d={keyword:"additionalProperties",dataProp:y,dataPropType:ve.Type.Str};f===!1&&Object.assign(d,{compositeRule:!0,createErrors:!1,allErrors:!1}),e.subschema(d,c)}}};Ht.default=Gn;export{Pe as A,Ne as B,Yn as C,Hn as D,qn as E,Ln as F,Bn as G,Wn as H,xn as J,et as a,Ge as b,Ie as c,G as d,ft as e,Xe as f,de as g,he as h,Zn as i,B as j,J as k,He as l,D as m,ee as n,zt as o,ur as p,ke as q,Ft as r,Qn as s,Ce as t,H as u,ne as v,Ht as w,$e as x,Xn as y,ht as z};
