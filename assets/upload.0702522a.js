var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(t,a,i)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,r=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&o(e,a,t[a]);if(i)for(var a of i(t))s.call(t,a)&&o(e,a,t[a]);return e},p=(e,i)=>t(e,a(i));import{u as d}from"./index.90ce0b5b.js";import{E as c,b3 as m,b4 as g,a as l,o as h,c as u,w as f,b,e as v,aw as j,p as w,h as y,g as x}from"./vendor.47dbce92.js";/* empty css              *//* empty css              */import{_ as O}from"./index.4e0857d2.js";var I=".container[data-v-7aa3b273] {\n  width: 100%;\n  height: 100%;\n}\n[data-v-7aa3b273] .ant-upload-drag-icon .i-icon {\n  font-size: 4.8rem;\n}\n.ant-spin-nested-loading[data-v-7aa3b273] {\n  height: 100% !important;\n}\n.ant-spin-nested-loading[data-v-7aa3b273] .ant-spin {\n  height: 100%;\n  max-height: unset;\n}\n.ant-spin-nested-loading[data-v-7aa3b273] .ant-spin-container {\n  height: 100%;\n}";const{Dragger:D}=j,{mapGetters:R,mapState:U,mapActions:$}=c("imgHosting"),q={name:"upload",components:{Dragger:D,UploadOne:m,Spin:g},props:["activeKey"],data:()=>({spinning:!1,timeoutIndex:void 0}),computed:r(r({},R(["config"])),U(["uploader","commonConfig"])),mounted(){document.addEventListener("paste",this.paste.bind(this))},beforeUnmount(){document.removeEventListener("paste",this.paste.bind(this))},methods:p(r({},$(["addImage"])),{async customRequest({file:e}){if(this.spinning=!0,this.uploader&&this.config(this.uploader)){if(this.commonConfig.renameTimeStamp){const t=e.name||"";e=new File([e],((new Date).getTime()+t.substring(t.lastIndexOf("."))).toLowerCase(),{type:e.type,lastModified:e.lastModified})}try{const a=await d[this.uploader].handle(this.config(this.uploader),e);if(this.addImage(a),this.commonConfig.copyUrlAfterUpload)try{await navigator.clipboard.writeText(a.url),this.$msg.success("上传成功，地址已复制到剪贴板")}catch(t){this.$msg.error("上传成功，但地址复制失败")}else this.$msg.success("上传成功")}catch(t){this.$msg.error("上传失败")}}else this.$msg.warn("请先进行设置");this.spinning=!1},rejectFile(){this.$msg.warning("不支持的文件类型！")},paste(e){if("home"===this.activeKey&&!this.spinning&&!this.timeoutIndex){this.timeoutIndex=setTimeout((()=>{this.timeoutIndex=void 0}),500);const t=e.clipboardData&&e.clipboardData.items;let a;t&&t.length&&(-1!==t[0].type.indexOf("image")?(a=t[0].getAsFile(),this.customRequest({file:a})):this.rejectFile())}}})},F=e=>(w("data-v-7aa3b273"),e=e(),y(),e),L={class:"ant-upload-drag-icon"},P=F((()=>v("p",{class:"ant-upload-text"},[x("直接粘贴图片或拖拽图片到这里上传"),v("br"),x("或者直接点击选择文件上传")],-1))),S=F((()=>v("p",{class:"ant-upload-hint"}," 暂时仅支持单文件上传。 ",-1)));function _(e,t,a,i,n,s){const o=l("UploadOne"),r=l("Dragger"),p=l("Spin");return h(),u(p,{spinning:e.spinning},{default:f((()=>[b(r,{fileList:[],accept:"image/bmp,image/gif,image/jpeg,image/png,image/webp",onReject:s.rejectFile,showUploadList:!1,customRequest:s.customRequest},{default:f((()=>[v("p",L,[b(o)]),P,S])),_:1},8,["onReject","customRequest"])])),_:1},8,["spinning"])}var C=O(q,[["render",_],["__scopeId","data-v-7aa3b273"]]);export{C as default};
