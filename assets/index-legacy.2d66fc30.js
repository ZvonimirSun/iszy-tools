var __vite_style__=document.createElement("style");__vite_style__.innerHTML='@charset "UTF-8";@font-face{src:url(/fonts/ClearSans-Light-webfont.eot);src:url(/fonts/ClearSans-Light-webfont.eot?#iefix) format("embedded-opentype"),url(/fonts/ClearSans-Light-webfont.svg#clear_sans_lightregular) format("svg"),url(/fonts/ClearSans-Light-webfont.woff) format("woff");font-weight:200;font-style:normal}100%{top:-50px;opacity:0}100%{top:-50px;opacity:0}100%{top:-50px;opacity:0}[data-v-0cd51204] .panel h1.title{font-size:80px;font-weight:700;line-height:88px;color:inherit;margin:0;display:block;float:left}@-webkit-keyframes move-up-0cd51204{0%{top:25px;opacity:1}100%{top:-50px;opacity:0}}@-moz-keyframes move-up-0cd51204{0%{top:25px;opacity:1}100%{top:-50px;opacity:0}}@keyframes move-up-0cd51204{0%{top:25px;opacity:1}100%{top:-50px;opacity:0}}[data-v-0cd51204] .panel .scores-container{float:right;display:flex;text-align:right;box-sizing:content-box}[data-v-0cd51204] .panel .scores-container *+*{margin-left:5px}[data-v-0cd51204] .panel .best-container,[data-v-0cd51204] .panel .score-container{position:relative;display:inline-block;background:#bbada0;padding:15px 25px;font-size:25px;height:25px;line-height:47px;font-weight:700;border-radius:3px;color:#fff;margin-top:8px;text-align:center;box-sizing:content-box}[data-v-0cd51204] .panel .best-container:after,[data-v-0cd51204] .panel .score-container:after{position:absolute;width:100%;top:10px;left:0;text-transform:uppercase;font-size:13px;line-height:13px;text-align:center;color:#eee4da;box-sizing:content-box}[data-v-0cd51204] .panel .best-container .score-addition,[data-v-0cd51204] .panel .score-container .score-addition{position:absolute;right:30px;color:red;font-size:25px;line-height:25px;font-weight:700;color:rgba(119,110,101,.9);z-index:100;box-sizing:content-box;-webkit-animation:move-up-0cd51204 .6s ease-in;-moz-animation:move-up-0cd51204 .6s ease-in;animation:move-up-0cd51204 .6s ease-in;-webkit-animation-fill-mode:both;-moz-animation-fill-mode:both;animation-fill-mode:both}[data-v-0cd51204] .panel .score-container:after{content:"分数";box-sizing:content-box}[data-v-0cd51204] .panel .best-container:after{box-sizing:content-box;content:"最高分"}[data-v-0cd51204] .panel p{margin-top:0;margin-bottom:10px;line-height:1.65}[data-v-0cd51204] .panel a{color:#776e65;font-weight:700;text-decoration:underline;cursor:pointer}[data-v-0cd51204] .panel strong.important{text-transform:uppercase}[data-v-0cd51204] .panel hr{border:none;border-bottom:1px solid #d8d4d0;margin-top:20px;margin-bottom:30px}[data-v-0cd51204] .panel .container{font-family:"Clear Sans","Helvetica Neue",Arial,sans-serif;font-size:18px;color:#776e65;width:500px;margin:0 auto}@-webkit-keyframes fade-in-0cd51204{0%{opacity:0}100%{opacity:1}}@-moz-keyframes fade-in-0cd51204{0%{opacity:0}100%{opacity:1}}@keyframes fade-in-0cd51204{0%{opacity:0}100%{opacity:1}}[data-v-0cd51204] .panel .game-container{margin-top:40px;position:relative;padding:15px;cursor:default;-webkit-touch-callout:none;-ms-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-ms-touch-action:none;touch-action:none;background:#bbada0;border-radius:6px;width:500px;height:500px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}[data-v-0cd51204] .panel .game-container .game-message{display:none;position:absolute;top:0;right:0;bottom:0;left:0;background:rgba(238,228,218,.5);z-index:100;text-align:center;-webkit-animation:fade-in-0cd51204 .8s ease 1.2s;-moz-animation:fade-in-0cd51204 .8s ease 1.2s;animation:fade-in-0cd51204 .8s ease 1.2s;-webkit-animation-fill-mode:both;-moz-animation-fill-mode:both;animation-fill-mode:both}[data-v-0cd51204] .panel .game-container .game-message p{font-size:60px;font-weight:700;height:60px;line-height:60px;margin-top:222px}[data-v-0cd51204] .panel .game-container .game-message .lower{display:block;margin-top:59px}[data-v-0cd51204] .panel .game-container .game-message a{display:inline-block;background:#8f7a66;border-radius:3px;padding:0 20px;text-decoration:none;color:#f9f6f2;height:40px;line-height:42px;margin-left:9px}[data-v-0cd51204] .panel .game-container .game-message a.keep-playing-button{display:none}[data-v-0cd51204] .panel .game-container .game-message.game-won{background:rgba(237,194,46,.5);color:#f9f6f2}[data-v-0cd51204] .panel .game-container .game-message.game-won a.keep-playing-button{display:inline-block}[data-v-0cd51204] .panel .game-container .game-message.game-over,[data-v-0cd51204] .panel .game-container .game-message.game-won{display:block}[data-v-0cd51204] .panel .grid-container{position:absolute;z-index:1}[data-v-0cd51204] .panel .grid-cell{width:106.25px;height:106.25px;margin-right:15px;margin-bottom:15px;float:left;border-radius:3px;background:rgba(238,228,218,.35)}[data-v-0cd51204] .panel .grid-cell:nth-child(4n){margin-right:0}[data-v-0cd51204] .panel .grid-cell:nth-last-child(-n+4){margin-bottom:0}[data-v-0cd51204] .panel .tile-container{position:absolute;z-index:2}[data-v-0cd51204] .panel .tile,[data-v-0cd51204] .panel .tile .tile-inner{width:107px;height:107px;line-height:107px}[data-v-0cd51204] .panel .tile.tile-position-1-1{-webkit-transform:translate(0,0);-moz-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0)}[data-v-0cd51204] .panel .tile.tile-position-1-2{-webkit-transform:translate(0,121px);-moz-transform:translate(0,121px);-ms-transform:translate(0,121px);transform:translate(0,121px)}[data-v-0cd51204] .panel .tile.tile-position-1-3{-webkit-transform:translate(0,242px);-moz-transform:translate(0,242px);-ms-transform:translate(0,242px);transform:translate(0,242px)}[data-v-0cd51204] .panel .tile.tile-position-1-4{-webkit-transform:translate(0,363px);-moz-transform:translate(0,363px);-ms-transform:translate(0,363px);transform:translate(0,363px)}[data-v-0cd51204] .panel .tile.tile-position-2-1{-webkit-transform:translate(121px,0);-moz-transform:translate(121px,0);-ms-transform:translate(121px,0);transform:translate(121px,0)}[data-v-0cd51204] .panel .tile.tile-position-2-2{-webkit-transform:translate(121px,121px);-moz-transform:translate(121px,121px);-ms-transform:translate(121px,121px);transform:translate(121px,121px)}[data-v-0cd51204] .panel .tile.tile-position-2-3{-webkit-transform:translate(121px,242px);-moz-transform:translate(121px,242px);-ms-transform:translate(121px,242px);transform:translate(121px,242px)}[data-v-0cd51204] .panel .tile.tile-position-2-4{-webkit-transform:translate(121px,363px);-moz-transform:translate(121px,363px);-ms-transform:translate(121px,363px);transform:translate(121px,363px)}[data-v-0cd51204] .panel .tile.tile-position-3-1{-webkit-transform:translate(242px,0);-moz-transform:translate(242px,0);-ms-transform:translate(242px,0);transform:translate(242px,0)}[data-v-0cd51204] .panel .tile.tile-position-3-2{-webkit-transform:translate(242px,121px);-moz-transform:translate(242px,121px);-ms-transform:translate(242px,121px);transform:translate(242px,121px)}[data-v-0cd51204] .panel .tile.tile-position-3-3{-webkit-transform:translate(242px,242px);-moz-transform:translate(242px,242px);-ms-transform:translate(242px,242px);transform:translate(242px,242px)}[data-v-0cd51204] .panel .tile.tile-position-3-4{-webkit-transform:translate(242px,363px);-moz-transform:translate(242px,363px);-ms-transform:translate(242px,363px);transform:translate(242px,363px)}[data-v-0cd51204] .panel .tile.tile-position-4-1{-webkit-transform:translate(363px,0);-moz-transform:translate(363px,0);-ms-transform:translate(363px,0);transform:translate(363px,0)}[data-v-0cd51204] .panel .tile.tile-position-4-2{-webkit-transform:translate(363px,121px);-moz-transform:translate(363px,121px);-ms-transform:translate(363px,121px);transform:translate(363px,121px)}[data-v-0cd51204] .panel .tile.tile-position-4-3{-webkit-transform:translate(363px,242px);-moz-transform:translate(363px,242px);-ms-transform:translate(363px,242px);transform:translate(363px,242px)}[data-v-0cd51204] .panel .tile.tile-position-4-4{-webkit-transform:translate(363px,363px);-moz-transform:translate(363px,363px);-ms-transform:translate(363px,363px);transform:translate(363px,363px)}[data-v-0cd51204] .panel .tile{position:absolute;-webkit-transition:.1s ease-in-out;-moz-transition:.1s ease-in-out;transition:.1s ease-in-out;-webkit-transition-property:-webkit-transform;-moz-transition-property:-moz-transform;transition-property:transform}[data-v-0cd51204] .panel .tile .tile-inner{border-radius:3px;background:#eee4da;text-align:center;font-weight:700;z-index:10;font-size:55px}[data-v-0cd51204] .panel .tile.tile-2 .tile-inner{background:#eee4da;box-shadow:0 0 30px 10px rgba(243,215,116,max(1 - 4,0)/7/1.8),inset 0 0 0 1px rgba(255,255,255,max(1 - 4,0)/7/3)}[data-v-0cd51204] .panel .tile.tile-4 .tile-inner{background:#eee1c9;box-shadow:0 0 30px 10px rgba(243,215,116,max(2 - 4,0)/7/1.8),inset 0 0 0 1px rgba(255,255,255,max(2 - 4,0)/7/3)}[data-v-0cd51204] .panel .tile.tile-8 .tile-inner{color:#f9f6f2;background:#f3b27a}[data-v-0cd51204] .panel .tile.tile-16 .tile-inner{color:#f9f6f2;background:#f69664}[data-v-0cd51204] .panel .tile.tile-32 .tile-inner{color:#f9f6f2;background:#f77c5f}[data-v-0cd51204] .panel .tile.tile-64 .tile-inner{color:#f9f6f2;background:#f75f3b}[data-v-0cd51204] .panel .tile.tile-128 .tile-inner{color:#f9f6f2;background:#edd073;box-shadow:0 0 30px 10px rgba(243,215,116,max(7 - 4,0)/7/1.8),inset 0 0 0 1px rgba(255,255,255,max(7 - 4,0)/7/3);font-size:45px}@media screen and (max-width:520px){[data-v-0cd51204] .panel .tile.tile-128 .tile-inner{font-size:25px}}[data-v-0cd51204] .panel .tile.tile-256 .tile-inner{color:#f9f6f2;background:#edcc62;box-shadow:0 0 30px 10px rgba(243,215,116,max(8 - 4,0)/7/1.8),inset 0 0 0 1px rgba(255,255,255,max(8 - 4,0)/7/3);font-size:45px}@media screen and (max-width:520px){[data-v-0cd51204] .panel .tile.tile-256 .tile-inner{font-size:25px}}[data-v-0cd51204] .panel .tile.tile-512 .tile-inner{color:#f9f6f2;background:#edc950;box-shadow:0 0 30px 10px rgba(243,215,116,max(9 - 4,0)/7/1.8),inset 0 0 0 1px rgba(255,255,255,max(9 - 4,0)/7/3);font-size:45px}@media screen and (max-width:520px){[data-v-0cd51204] .panel .tile.tile-512 .tile-inner{font-size:25px}}[data-v-0cd51204] .panel .tile.tile-1024 .tile-inner{color:#f9f6f2;background:#edc53f;box-shadow:0 0 30px 10px rgba(243,215,116,max(10 - 4,0)/7/1.8),inset 0 0 0 1px rgba(255,255,255,max(10 - 4,0)/7/3);font-size:35px}@media screen and (max-width:520px){[data-v-0cd51204] .panel .tile.tile-1024 .tile-inner{font-size:15px}}[data-v-0cd51204] .panel .tile.tile-2048 .tile-inner{color:#f9f6f2;background:#edc22e;box-shadow:0 0 30px 10px rgba(243,215,116,max(11 - 4,0)/7/1.8),inset 0 0 0 1px rgba(255,255,255,max(11 - 4,0)/7/3);font-size:35px}@media screen and (max-width:520px){[data-v-0cd51204] .panel .tile.tile-2048 .tile-inner{font-size:15px}}[data-v-0cd51204] .panel .tile.tile-super .tile-inner{color:#f9f6f2;background:#3c3a33;font-size:30px}@media screen and (max-width:520px){[data-v-0cd51204] .panel .tile.tile-super .tile-inner{font-size:10px}}@-webkit-keyframes appear-0cd51204{0%{opacity:0;-webkit-transform:scale(0);-moz-transform:scale(0);-ms-transform:scale(0);transform:scale(0)}100%{opacity:1;-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)}}@-moz-keyframes appear-0cd51204{0%{opacity:0;-webkit-transform:scale(0);-moz-transform:scale(0);-ms-transform:scale(0);transform:scale(0)}100%{opacity:1;-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)}}@keyframes appear-0cd51204{0%{opacity:0;-webkit-transform:scale(0);-moz-transform:scale(0);-ms-transform:scale(0);transform:scale(0)}100%{opacity:1;-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)}}[data-v-0cd51204] .panel .tile-new .tile-inner{-webkit-animation:appear-0cd51204 .2s ease .1s;-moz-animation:appear-0cd51204 .2s ease .1s;animation:appear-0cd51204 .2s ease .1s;-webkit-animation-fill-mode:backwards;-moz-animation-fill-mode:backwards;animation-fill-mode:backwards}@-webkit-keyframes pop-0cd51204{0%{-webkit-transform:scale(0);-moz-transform:scale(0);-ms-transform:scale(0);transform:scale(0)}50%{-webkit-transform:scale(1.2);-moz-transform:scale(1.2);-ms-transform:scale(1.2);transform:scale(1.2)}100%{-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)}}@-moz-keyframes pop-0cd51204{0%{-webkit-transform:scale(0);-moz-transform:scale(0);-ms-transform:scale(0);transform:scale(0)}50%{-webkit-transform:scale(1.2);-moz-transform:scale(1.2);-ms-transform:scale(1.2);transform:scale(1.2)}100%{-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)}}@keyframes pop-0cd51204{0%{-webkit-transform:scale(0);-moz-transform:scale(0);-ms-transform:scale(0);transform:scale(0)}50%{-webkit-transform:scale(1.2);-moz-transform:scale(1.2);-ms-transform:scale(1.2);transform:scale(1.2)}100%{-webkit-transform:scale(1);-moz-transform:scale(1);-ms-transform:scale(1);transform:scale(1)}}[data-v-0cd51204] .panel .tile-merged .tile-inner{z-index:20;-webkit-animation:pop-0cd51204 .2s ease .1s;-moz-animation:pop-0cd51204 .2s ease .1s;animation:pop-0cd51204 .2s ease .1s;-webkit-animation-fill-mode:backwards;-moz-animation-fill-mode:backwards;animation-fill-mode:backwards}[data-v-0cd51204] .panel .above-game:after{content:"";display:block;clear:both}[data-v-0cd51204] .panel .game-intro{float:left;line-height:42px;margin-bottom:0}[data-v-0cd51204] .panel .restart-button{display:inline-block;background:#8f7a66;border-radius:3px;padding:0 20px;text-decoration:none;color:#f9f6f2;height:40px;line-height:42px;display:block;text-align:center;float:right}[data-v-0cd51204] .panel .game-explanation{margin-top:50px}@media screen and (max-width:520px){[data-v-0cd51204] .panel h1.title{font-size:27px;margin-top:15px}[data-v-0cd51204] .panel .container{font-size:15px;width:280px;margin:0 auto}[data-v-0cd51204] .panel .best-container,[data-v-0cd51204] .panel .score-container{margin-top:0;padding:15px 10px;min-width:40px}[data-v-0cd51204] .panel .heading{margin-bottom:10px}[data-v-0cd51204] .panel .game-intro{width:55%;display:block;box-sizing:border-box;line-height:1.65}[data-v-0cd51204] .panel .restart-button{width:42%;padding:0;display:block;box-sizing:border-box;margin-top:2px}[data-v-0cd51204] .panel .game-container{margin-top:17px;position:relative;padding:10px;cursor:default;-webkit-touch-callout:none;-ms-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-ms-touch-action:none;touch-action:none;background:#bbada0;border-radius:6px;width:280px;height:280px;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}[data-v-0cd51204] .panel .game-container .game-message{display:none;position:absolute;top:0;right:0;bottom:0;left:0;background:rgba(238,228,218,.5);z-index:100;text-align:center;-webkit-animation:fade-in-0cd51204 .8s ease 1.2s;-moz-animation:fade-in-0cd51204 .8s ease 1.2s;animation:fade-in-0cd51204 .8s ease 1.2s;-webkit-animation-fill-mode:both;-moz-animation-fill-mode:both;animation-fill-mode:both}[data-v-0cd51204] .panel .game-container .game-message p{font-size:60px;font-weight:700;height:60px;line-height:60px;margin-top:222px}[data-v-0cd51204] .panel .game-container .game-message .lower{display:block;margin-top:59px}[data-v-0cd51204] .panel .game-container .game-message a{display:inline-block;background:#8f7a66;border-radius:3px;padding:0 20px;text-decoration:none;color:#f9f6f2;height:40px;line-height:42px;margin-left:9px}[data-v-0cd51204] .panel .game-container .game-message a.keep-playing-button{display:none}[data-v-0cd51204] .panel .game-container .game-message.game-won{background:rgba(237,194,46,.5);color:#f9f6f2}[data-v-0cd51204] .panel .game-container .game-message.game-won a.keep-playing-button{display:inline-block}[data-v-0cd51204] .panel .game-container .game-message.game-over,[data-v-0cd51204] .panel .game-container .game-message.game-won{display:block}[data-v-0cd51204] .panel .grid-container{position:absolute;z-index:1}[data-v-0cd51204] .panel .grid-cell{width:57.5px;height:57.5px;margin-right:10px;margin-bottom:10px;float:left;border-radius:3px;background:rgba(238,228,218,.35)}[data-v-0cd51204] .panel .grid-cell:nth-child(4n){margin-right:0}[data-v-0cd51204] .panel .grid-cell:nth-last-child(-n+4){margin-bottom:0}[data-v-0cd51204] .panel .tile-container{position:absolute;z-index:2}[data-v-0cd51204] .panel .tile,[data-v-0cd51204] .panel .tile .tile-inner{width:58px;height:58px;line-height:58px}[data-v-0cd51204] .panel .tile.tile-position-1-1{-webkit-transform:translate(0,0);-moz-transform:translate(0,0);-ms-transform:translate(0,0);transform:translate(0,0)}[data-v-0cd51204] .panel .tile.tile-position-1-2{-webkit-transform:translate(0,67px);-moz-transform:translate(0,67px);-ms-transform:translate(0,67px);transform:translate(0,67px)}[data-v-0cd51204] .panel .tile.tile-position-1-3{-webkit-transform:translate(0,135px);-moz-transform:translate(0,135px);-ms-transform:translate(0,135px);transform:translate(0,135px)}[data-v-0cd51204] .panel .tile.tile-position-1-4{-webkit-transform:translate(0,202px);-moz-transform:translate(0,202px);-ms-transform:translate(0,202px);transform:translate(0,202px)}[data-v-0cd51204] .panel .tile.tile-position-2-1{-webkit-transform:translate(67px,0);-moz-transform:translate(67px,0);-ms-transform:translate(67px,0);transform:translate(67px,0)}[data-v-0cd51204] .panel .tile.tile-position-2-2{-webkit-transform:translate(67px,67px);-moz-transform:translate(67px,67px);-ms-transform:translate(67px,67px);transform:translate(67px,67px)}[data-v-0cd51204] .panel .tile.tile-position-2-3{-webkit-transform:translate(67px,135px);-moz-transform:translate(67px,135px);-ms-transform:translate(67px,135px);transform:translate(67px,135px)}[data-v-0cd51204] .panel .tile.tile-position-2-4{-webkit-transform:translate(67px,202px);-moz-transform:translate(67px,202px);-ms-transform:translate(67px,202px);transform:translate(67px,202px)}[data-v-0cd51204] .panel .tile.tile-position-3-1{-webkit-transform:translate(135px,0);-moz-transform:translate(135px,0);-ms-transform:translate(135px,0);transform:translate(135px,0)}[data-v-0cd51204] .panel .tile.tile-position-3-2{-webkit-transform:translate(135px,67px);-moz-transform:translate(135px,67px);-ms-transform:translate(135px,67px);transform:translate(135px,67px)}[data-v-0cd51204] .panel .tile.tile-position-3-3{-webkit-transform:translate(135px,135px);-moz-transform:translate(135px,135px);-ms-transform:translate(135px,135px);transform:translate(135px,135px)}[data-v-0cd51204] .panel .tile.tile-position-3-4{-webkit-transform:translate(135px,202px);-moz-transform:translate(135px,202px);-ms-transform:translate(135px,202px);transform:translate(135px,202px)}[data-v-0cd51204] .panel .tile.tile-position-4-1{-webkit-transform:translate(202px,0);-moz-transform:translate(202px,0);-ms-transform:translate(202px,0);transform:translate(202px,0)}[data-v-0cd51204] .panel .tile.tile-position-4-2{-webkit-transform:translate(202px,67px);-moz-transform:translate(202px,67px);-ms-transform:translate(202px,67px);transform:translate(202px,67px)}[data-v-0cd51204] .panel .tile.tile-position-4-3{-webkit-transform:translate(202px,135px);-moz-transform:translate(202px,135px);-ms-transform:translate(202px,135px);transform:translate(202px,135px)}[data-v-0cd51204] .panel .tile.tile-position-4-4{-webkit-transform:translate(202px,202px);-moz-transform:translate(202px,202px);-ms-transform:translate(202px,202px);transform:translate(202px,202px)}[data-v-0cd51204] .panel .tile .tile-inner{font-size:35px}[data-v-0cd51204] .panel .game-message p{font-size:30px!important;height:30px!important;line-height:30px!important;margin-top:90px!important}[data-v-0cd51204] .panel .game-message .lower{margin-top:30px!important}}',document.head.appendChild(__vite_style__),System.register(["./container-legacy.6acadabd.js","./vendor-legacy.10dd88fa.js","./index-legacy.0e854b77.js","./index-legacy.d604e52b.js"],(function(t){"use strict";var e,a,n,i,s,r,o,l,p,c,d,m;return{setters:[function(t){e=t._},function(t){a=t.q,n=t.n,i=t.p,s=t.a,r=t.o,o=t.c,l=t.w,p=t.r,c=t.b,d=t.F,m=t.t},function(){},function(){}],execute:function(){class x{constructor(t,e){this.x=t.x,this.y=t.y,this.value=e||2,this.previousPosition=null,this.mergedFrom=null}savePosition(){this.previousPosition={x:this.x,y:this.y}}updatePosition(t){this.x=t.x,this.y=t.y}serialize(){return{position:{x:this.x,y:this.y},value:this.value}}}class f{constructor(t,e){this.size=t,this.cells=e?this.fromState(e):this.empty()}empty(){const t=[];for(let e=0;e<this.size;e++){const a=t[e]=[];for(let t=0;t<this.size;t++)a.push(null)}return t}fromState(t){const e=[];for(let a=0;a<this.size;a++){const n=e[a]=[];for(let e=0;e<this.size;e++){const i=t[a][e];n.push(i?new x(i.position,i.value):null)}}return e}randomAvailableCell(){const t=this.availableCells();if(t.length)return t[Math.floor(Math.random()*t.length)]}availableCells(){const t=[];return this.eachCell((function(e,a,n){n||t.push({x:e,y:a})})),t}eachCell(t){for(let e=0;e<this.size;e++)for(let a=0;a<this.size;a++)t(e,a,this.cells[e][a])}cellsAvailable(){return!!this.availableCells().length}cellAvailable(t){return!this.cellOccupied(t)}cellOccupied(t){return!!this.cellContent(t)}cellContent(t){return this.withinBounds(t)?this.cells[t.x][t.y]:null}insertTile(t){this.cells[t.x][t.y]=t}removeTile(t){this.cells[t.x][t.y]=null}withinBounds(t){return t.x>=0&&t.x<this.size&&t.y>=0&&t.y<this.size}serialize(){const t=[];for(let e=0;e<this.size;e++){const a=t[e]=[];for(let t=0;t<this.size;t++)a.push(this.cells[e][t]?this.cells[e][t].serialize():null)}return{size:this.size,cells:t}}}class h{constructor(t){this.events={},this.vue=t,this.map={ArrowUp:0,ArrowRight:1,ArrowDown:2,ArrowLeft:3,KeyK:0,KeyL:1,keyJ:2,keyH:3,KeyW:0,KeyD:1,KeyS:2,KeyA:3},window.navigator.msPointerEnabled?(this.eventTouchstart="MSPointerDown",this.eventTouchmove="MSPointerMove",this.eventTouchend="MSPointerUp"):(this.eventTouchstart="touchstart",this.eventTouchmove="touchmove",this.eventTouchend="touchend"),this.listen()}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}emit(t,e){const a=this.events[t];a&&a.forEach((function(t){t(e)}))}listen(){const t=this;let e,a;document.addEventListener("keydown",this._keyboardEvent.bind(this)),this.bindButtonPress(this.vue.$refs.retryButton,this.restart),this.bindButtonPress(this.vue.$refs.restartButton,this.restart),this.bindButtonPress(this.vue.$refs.keepPlayingButton,this.keepPlaying);const n=this.vue.$refs.gameContainer;n.addEventListener(this.eventTouchstart,(function(t){!window.navigator.msPointerEnabled&&t.touches.length>1||t.targetTouches.length>1||(window.navigator.msPointerEnabled?(e=t.pageX,a=t.pageY):(e=t.touches[0].clientX,a=t.touches[0].clientY),t.preventDefault())})),n.addEventListener(this.eventTouchmove,(function(t){t.preventDefault()})),n.addEventListener(this.eventTouchend,(function(n){if(!window.navigator.msPointerEnabled&&n.touches.length>0||n.targetTouches.length>0)return;let i,s;window.navigator.msPointerEnabled?(i=n.pageX,s=n.pageY):(i=n.changedTouches[0].clientX,s=n.changedTouches[0].clientY);const r=i-e,o=Math.abs(r),l=s-a,p=Math.abs(l);Math.max(o,p)>10&&t.emit("move",o>p?r>0?1:3:l>0?2:0)}))}restart(t){t.preventDefault(),this.emit("restart")}keepPlaying(t){t.preventDefault(),this.emit("keepPlaying")}bindButtonPress(t,e){t.addEventListener("click",e.bind(this)),t.addEventListener(this.eventTouchend,e.bind(this))}_keyboardEvent(t){const e=t.altKey||t.ctrlKey||t.metaKey||t.shiftKey,a=this.map[t.code];e||void 0!==a&&(t.preventDefault(),this.emit("move",a)),e||"KeyR"!==t.code||this.restart(t)}destroy(){document.removeEventListener("keydown",this._keyboardEvent)}}class g{constructor(t){this.vue=t,this.tileContainer=this.vue.$refs.tileContainer,this.scoreContainer=this.vue.$refs.scoreContainer,this.bestContainer=this.vue.$refs.bestContainer,this.messageContainer=document.querySelector(".game-message"),this.score=0}actuate(t,e){const a=this;window.requestAnimationFrame((function(){a.clearContainer(a.tileContainer),t.cells.forEach((function(t){t.forEach((function(t){t&&a.addTile(t)}))})),a.updateScore(e.score),a.updateBestScore(e.bestScore),e.terminated&&(e.over?a.message(!1):e.won&&a.message(!0))}))}continueGame(){this.clearMessage()}clearContainer(t){for(;t.firstChild;)t.removeChild(t.firstChild)}addTile(t){const e=this,a=document.createElement("div"),n=document.createElement("div"),i=t.previousPosition||{x:t.x,y:t.y},s=this.positionClass(i),r=["tile","tile-"+t.value,s];t.value>2048&&r.push("tile-super"),this.applyClasses(a,r),n.classList.add("tile-inner"),n.textContent=t.value,t.previousPosition?window.requestAnimationFrame((function(){r[2]=e.positionClass({x:t.x,y:t.y}),e.applyClasses(a,r)})):t.mergedFrom?(r.push("tile-merged"),this.applyClasses(a,r),t.mergedFrom.forEach((function(t){e.addTile(t)}))):(r.push("tile-new"),this.applyClasses(a,r)),a.appendChild(n),this.tileContainer.appendChild(a)}applyClasses(t,e){t.setAttribute("class",e.join(" "))}normalizePosition(t){return{x:t.x+1,y:t.y+1}}positionClass(t){return"tile-position-"+(t=this.normalizePosition(t)).x+"-"+t.y}updateScore(t){this.clearContainer(this.scoreContainer);const e=t-this.score;if(this.score=t,this.scoreContainer.textContent=this.score,e>0){const t=document.createElement("div");t.classList.add("score-addition"),t.textContent="+"+e,this.scoreContainer.appendChild(t)}}updateBestScore(t){this.bestContainer.textContent=t}message(t){const e=t?"game-won":"game-over",a=t?"你赢啦!":"游戏结束!";this.messageContainer.classList.add(e),this.messageContainer.getElementsByTagName("p")[0].textContent=a}clearMessage(){this.messageContainer.classList.remove("game-won"),this.messageContainer.classList.remove("game-over")}}class b{constructor(t,e){this.vue=e,this.size=t,this.inputManager=new h(e),this.actuator=new g(e),this.startTiles=2,this.inputManager.on("move",this.move.bind(this)),this.inputManager.on("restart",this.restart.bind(this)),this.inputManager.on("keepPlaying",this.keepPlaying.bind(this)),this.setup()}destroy(){}restart(){this.vue.clearGameState(),this.actuator.continueGame(),this.setup()}keepPlaying(){this.keepPlaying=!0,this.actuator.continueGame()}isGameTerminated(){return this.over||this.won&&!this.keepPlaying}setup(){const t=this.vue.gameState;t?(this.grid=new f(t.grid.size,t.grid.cells),this.score=t.score,this.over=t.over,this.won=t.won,this.keepPlaying=t.keepPlaying):(this.grid=new f(this.size),this.score=0,this.over=!1,this.won=!1,this.keepPlaying=!1,this.addStartTiles()),this.actuate()}addStartTiles(){for(let t=0;t<this.startTiles;t++)this.addRandomTile()}addRandomTile(){if(this.grid.cellsAvailable()){const t=Math.random()<.9?2:4,e=new x(this.grid.randomAvailableCell(),t);this.grid.insertTile(e)}}actuate(){this.vue.bestScore<this.score&&this.vue.setBestScore(this.score),this.over?this.vue.clearGameState():this.vue.setGameState(this.serialize()),this.vue.state={grid:this.grid,score:this.score,over:this.over,won:this.won,bestScore:this.vue.bestScore,terminated:this.isGameTerminated()},this.actuator.actuate(this.grid,{score:this.score,over:this.over,won:this.won,bestScore:this.vue.bestScore,terminated:this.isGameTerminated()})}serialize(){return{grid:this.grid.serialize(),score:this.score,over:this.over,won:this.won,keepPlaying:this.keepPlaying}}prepareTiles(){this.grid.eachCell((function(t,e,a){a&&(a.mergedFrom=null,a.savePosition())}))}moveTile(t,e){this.grid.cells[t.x][t.y]=null,this.grid.cells[e.x][e.y]=t,t.updatePosition(e)}move(t){const e=this;if(this.isGameTerminated())return;let a,n;const i=this.getVector(t),s=this.buildTraversals(i);let r=!1;this.prepareTiles(),s.x.forEach((function(t){s.y.forEach((function(s){if(a={x:t,y:s},n=e.grid.cellContent(a),n){const t=e.findFarthestPosition(a,i),s=e.grid.cellContent(t.next);if(s&&s.value===n.value&&!s.mergedFrom){const a=new x(t.next,2*n.value);a.mergedFrom=[n,s],e.grid.insertTile(a),e.grid.removeTile(n),n.updatePosition(t.next),e.score+=a.value,2048===a.value&&(e.won=!0)}else e.moveTile(n,t.farthest);e.positionsEqual(a,n)||(r=!0)}}))})),r&&(this.addRandomTile(),this.movesAvailable()||(this.over=!0),this.actuate())}getVector(t){return{0:{x:0,y:-1},1:{x:1,y:0},2:{x:0,y:1},3:{x:-1,y:0}}[t]}buildTraversals(t){const e={x:[],y:[]};for(let a=0;a<this.size;a++)e.x.push(a),e.y.push(a);return 1===t.x&&(e.x=e.x.reverse()),1===t.y&&(e.y=e.y.reverse()),e}findFarthestPosition(t,e){let a;do{a=t,t={x:a.x+e.x,y:a.y+e.y}}while(this.grid.withinBounds(t)&&this.grid.cellAvailable(t));return{farthest:a,next:t}}movesAvailable(){return this.grid.cellsAvailable()||this.tileMatchesAvailable()}tileMatchesAvailable(){const t=this;let e;for(let a=0;a<this.size;a++)for(let n=0;n<this.size;n++)if(e=this.grid.cellContent({x:a,y:n}),e)for(let i=0;i<4;i++){const s=t.getVector(i),r={x:a+s.x,y:n+s.y},o=t.grid.cellContent(r);if(o&&o.value===e.value)return!0}return!1}positionsEqual(t,e){return t.x===e.x&&t.y===e.y}}let u;const v=t("default",{name:"2048",components:{Container:e},data:()=>({state:{}}),computed:{...a({gameState:t=>t.g2048.gameState,bestScore:t=>t.g2048.bestScore})},mounted(){u=new b(4,this)},methods:{...n({setBestScore:"g2048/setBestScore",setGameState:"g2048/setGameState",clearGameState:"g2048/clearGameState"})},beforeUnmount(){u.destroy()}}),w=l();i("data-v-0cd51204");const y={class:"panel"},k={class:"container"},z={class:"heading"},C=c("h1",{class:"title"},"2048",-1),T={class:"scores-container"},P={class:"score-container",ref:"scoreContainer"},S={class:"best-container",ref:"bestContainer"},E={class:"above-game"},_={class:"restart-button",ref:"restartButton"},A={class:"game-container",ref:"gameContainer"},B={class:"game-message"},L=c("p",null,null,-1),M={class:"lower"},G={class:"keep-playing-button",ref:"keepPlayingButton"},F={class:"retry-button",ref:"retryButton"},K={class:"grid-container"},D={class:"tile-container",ref:"tileContainer"};s();const $=w(((t,e,a,n,i,s)=>{const l=p("container");return r(),o(l,null,{default:w((()=>[c("div",y,[c("div",k,[c("div",z,[C,c("div",T,[c("div",P,"0",512),c("div",S,"0",512)])]),c("div",E,[c("a",_,"新游戏",512)]),c("div",A,[c("div",B,[L,c("div",M,[c("a",G,"继续挑战",512),c("a",F,"重新开始",512)])]),c("div",K,[(r(),o(d,null,m(16,(t=>c("div",{class:"grid-cell",key:t}))),64))]),c("div",D,null,512)],512)])])])),_:1})}));v.render=$,v.__scopeId="data-v-0cd51204"}}}));
