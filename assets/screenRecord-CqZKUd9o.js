import{T as ye,P as he}from"./Router-SOUowP8y.js";import{j as ge,R as f,k as G,m as a,o as u,F as b,G as d,am as L,as as P,I as S,K as t,w as o,L as _,l as C,X as h,H as x,W as T,Y as D,aD as Z,N as ke,a2 as Re}from"./index-len2DOAp.js";import{a as Se,E as we}from"./el-form-item-DPWEOm_H.js";/* empty css               */import{E as Ee,a as Ve}from"./el-select-AH9OtrYv.js";import"./el-popper-C99AQLKO.js";import{E as Ce}from"./el-alert-CMC-Lhdu.js";import"./castArray-BUqJCIvV.js";import"./index-BVm_oBHH.js";import"./strings-dQx4YNGq.js";import"./_baseIteratee-t4ZODsgW.js";import"./index-Cd9gZ4dd.js";import"./index-BF3_8Zu_.js";import"./isUndefined-DCTLXrZ8.js";const Te={key:0,class:"wrapper"},De={class:"video-wrapper"},Ue={class:"previewVideo"},Ae=["src"],Oe={class:"operations"},Me={class:"settings-wrapper"},ee="unshare",Ne="unstart",M="recording",F="paused",ae="stopped",Ie=ge({__name:"screenRecord",setup(Be){const E=f(),V=f();let m=null,r=null;const s=f(ee);let j=[];const g=f(""),K=f(!1),H=[{label:"否",value:"never"},{label:"是",value:"always"}],k=f("never"),Y=[{label:"否",value:"never"},{label:"是",value:"always"}],R=f("never"),X=[{label:"默认",value:"default"},{label:"16:9",value:1.77},{label:"4:3",value:1.33},{label:"21:9",value:2.35},{label:"14:10",value:1.4},{label:"19:10",value:1.9}],U=f("default"),le=[{label:"默认",value:"default"},{label:"60",value:60},{label:"30",value:30},{label:"25",value:25},{label:"15",value:15},{label:"5",value:5}],A=f("default"),te=[{label:"默认",value:"default"},{label:"屏幕尺寸",value:"fit-screen"},{label:"4K",value:"4k"},{label:"1080p",value:"1080p"},{label:"720p",value:"720p"}],N=f("default"),W=[{label:"默认",value:"default"},{label:"总是显示",value:"always"},{label:"移动时显示",value:"motion"},{label:"从不显示",value:"never"}],O=f("default"),I=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints?navigator.mediaDevices.getSupportedConstraints():{},oe=!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia),ne=!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),ue=oe&&ne,$=G(()=>{switch(s.value){case M:return"REC";case F:return"PAUSE";default:return!1}}),re=G(()=>{const l={};switch(typeof U.value=="number"&&(l.aspectRatio=U.value),typeof A.value=="number"&&(l.frameRate=A.value),O.value!=="default"&&(l.cursor=O.value),N.value){case"fit-screen":l.width=screen.width,l.height=screen.height;break;case"4K":l.width=3840,l.height=2160;break;case"1080p":l.width=1920,l.height=1080;break;case"720p":l.width=1280,l.height=720;break}return{video:l,audio:k.value==="always"}}),w=G(()=>{var l,n;if(m){const v=m.getVideoTracks();if(v.length>0){const y=v[0].getSettings(),c={recordAudio:(l=H.find(i=>k.value===i.value))==null?void 0:l.label,recordMicro:(n=Y.find(i=>R.value===i.value))==null?void 0:n.label,frameRate:y.frameRate,width:y.width,height:y.height,aspectRatio:"默认",cursor:""};if(y.aspectRatio){const i=y.aspectRatio,p=X.find(B=>typeof B.value=="number"?i-B.value<=.1:!1);p?c.aspectRatio=p.label:c.aspectRatio="默认"}if(y.cursor){const i=W.find(p=>y.cursor===p.value);i?c.cursor=i.label:c.cursor="默认"}return{video:c}}}return{video:{},audio:{}}});async function se(){try{if(m=await navigator.mediaDevices.getDisplayMedia(re.value),R.value==="always"){const n=await navigator.mediaDevices.getUserMedia({audio:!0});m.addTrack(n.getAudioTracks()[0])}const l=m.getVideoTracks()[0];l&&(l.onended=J,l.onmute=J),r=new MediaRecorder(m),r.onstop=pe,r.ondataavailable=fe,E.value&&(E.value.srcObject=m,E.value.muted=!0),s.value="unstart"}catch(l){Z.error(l.message)}}function ie(){z(),r==null||r.start(),s.value=M}function de(){r==null||r.pause(),s.value=F}function ce(){r==null||r.resume(),s.value=M}function q(){r&&r.state!=="inactive"&&r.stop(),s.value=ae}function z(){g.value=""}function ve(){if(g.value){const l=document.createElement("a");l.href=g.value,l.download="screen-record.mp4",l.click()}}function J(){if(q(),m)m.getTracks().forEach(n=>{n.stop()});else return;Z.info("屏幕分享结束"),m=null,E.value&&(E.value.srcObject=null),s.value="unshare"}function pe(){const l=new Blob(j,{type:"video/mp4"});g.value=URL.createObjectURL(l),j=[];const n=window.setInterval(async()=>{V.value&&V.value.readyState>0&&(V.value.duration===Number.POSITIVE_INFINITY?V.value.currentTime=1e7*Math.random():(window.clearInterval(n),V.value.currentTime=0))},200)}function fe(l){j.push(l.data)}function me(){k.value&&R.value&&(R.value="never")}function be(){k.value&&R.value&&(k.value="never")}return(l,n)=>{const v=ke,y=Ce,c=Ee,i=Ve,p=Se,B=we,Q=ye,_e=he;return a(ue)?(u(),b("div",Te,[d("div",De,[d("div",Ue,[L(d("video",{ref_key:"screenShareVideoElement",ref:E,autoplay:""},null,512),[[P,!a(g)]]),L(d("video",{ref_key:"recordVideoElement",ref:V,controls:"",src:a(g)},null,8,Ae),[[P,a(g)]]),L(d("span",{class:"rec"},S(a($)),513),[[P,a($)]])]),d("div",Oe,[t(v,{type:"primary",onClick:n[0]||(n[0]=e=>K.value=!a(K))},{default:o(()=>[_(" 设置 ")]),_:1}),a(s)===ee?(u(),C(v,{key:0,type:"primary",onClick:se},{default:o(()=>[_(" 开启屏幕共享 ")]),_:1})):(u(),b(h,{key:1},[t(v,{type:"primary",disabled:a(s)===M||a(s)===F,onClick:ie},{default:o(()=>[_(" 开始录制 ")]),_:1},8,["disabled"]),t(v,{type:"primary",disabled:a(s)!==M,onClick:de},{default:o(()=>[_(" 暂停 ")]),_:1},8,["disabled"]),t(v,{type:"primary",disabled:a(s)!==F,onClick:ce},{default:o(()=>[_(" 继续 ")]),_:1},8,["disabled"]),t(v,{type:"primary",disabled:a(s)===Ne||a(s)===ae,onClick:q},{default:o(()=>[_(" 停止 ")]),_:1},8,["disabled"])],64)),a(g)?(u(),b(h,{key:2},[t(v,{type:"primary",onClick:z},{default:o(()=>[_(" 清除 ")]),_:1}),t(v,{type:"primary",onClick:ve},{default:o(()=>[_(" 下载 ")]),_:1})],64)):x("",!0)])]),L(d("div",Me,[t(y,{title:"由于浏览器限制，部分设置可能无法生效",type:"warning","show-icon":"",style:{"margin-bottom":".8rem"}}),a(s)==="unshare"?(u(),C(B,{key:0,"label-position":"top"},{default:o(()=>[t(p,{label:"系统音频"},{default:o(()=>[t(i,{modelValue:a(k),"onUpdate:modelValue":n[1]||(n[1]=e=>T(k)?k.value=e:null),onChange:me},{default:o(()=>[(u(),b(h,null,D(H,e=>t(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(p,{label:"麦克风"},{default:o(()=>[t(i,{modelValue:a(R),"onUpdate:modelValue":n[2]||(n[2]=e=>T(R)?R.value=e:null),onChange:be},{default:o(()=>[(u(),b(h,null,D(Y,e=>t(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(I).aspectRatio?(u(),C(p,{key:0,label:"选择长宽比"},{default:o(()=>[t(i,{modelValue:a(U),"onUpdate:modelValue":n[3]||(n[3]=e=>T(U)?U.value=e:null)},{default:o(()=>[(u(),b(h,null,D(X,e=>t(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):x("",!0),a(I).frameRate?(u(),C(p,{key:1,label:"选择帧率"},{default:o(()=>[t(i,{modelValue:a(A),"onUpdate:modelValue":n[4]||(n[4]=e=>T(A)?A.value=e:null)},{default:o(()=>[(u(),b(h,null,D(le,e=>t(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):x("",!0),a(I).width&&a(I).height?(u(),C(p,{key:2,label:"选择分辨率"},{default:o(()=>[t(i,{modelValue:a(N),"onUpdate:modelValue":n[5]||(n[5]=e=>T(N)?N.value=e:null)},{default:o(()=>[(u(),b(h,null,D(te,e=>t(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):x("",!0),t(p,{label:"是否显示光标"},{default:o(()=>[t(i,{modelValue:a(O),"onUpdate:modelValue":n[6]||(n[6]=e=>T(O)?O.value=e:null),options:W},{default:o(()=>[(u(),b(h,null,D(W,e=>t(c,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})):(u(),b(h,{key:1},[t(Q,{level:4},{default:o(()=>[_(" 当前设置 ")]),_:1}),t(_e,null,{default:o(()=>[d("ul",null,[d("li",null,"系统音频: "+S(a(w).video.recordAudio),1),d("li",null,"麦克风: "+S(a(w).video.recordMicro),1),d("li",null,"长宽比: "+S(a(w).video.aspectRatio),1),d("li",null,"帧率: "+S(a(w).video.frameRate),1),d("li",null,"视频宽度: "+S(a(w).video.width),1),d("li",null,"视频高度: "+S(a(w).video.height),1),d("li",null,"显示鼠标: "+S(a(w).video.cursor),1)])]),_:1})],64))],512),[[P,a(K)]])])):(u(),C(Q,{key:1,level:3},{default:o(()=>[_(" 你的浏览器不支持WebRTC，请安装最新版本Chrome后重试。 ")]),_:1}))}}}),Je=Re(Ie,[["__scopeId","data-v-d97d9c37"]]);export{Je as default};
