import{c$ as Me,aU as Be,e as we,b as Le,d as q,m as ze,_ as Se,a as oe,bo as Ie,dB as Ve,dC as Fe,aL as Ne,u as _e,cc as De,I as p,dD as Xe,c as f,dE as Ye,Z as He,ce as je,X as ne,J as $e,aH as Z,g as ye,o as k,w as m,C as u,a6 as Ke,x as b,n as Ce,h as v,j as a,cj as We,y as C,v as _,r as z,P as Ze,aF as P,bd as Je,N as he,bb as qe,bc as Ge,D as Ue,z as Oe,dF as Qe,co as ea,k as aa,dG as sa,dH as ta,dw as na,aI as oa,aJ as H,aa as Te,l as Re,aZ as la,cM as ra,dI as ia,bJ as J,av as ca,ar as Ee,aW as ua,b0 as me,br as pe,cC as da,az as fa,dJ as va,dK as ma,dL as pa,dM as ga}from"./index-BlWpl0PI.js";import{E as wa}from"./index-CMq4uf5n.js";var ya="Expected a function";function ge(i,V,c){var d=!0,t=!0;if(typeof i!="function")throw new TypeError(ya);return Me(c)&&(d="leading"in c?!!c.leading:d,t="trailing"in c?!!c.trailing:t),Be(i,V,{leading:d,maxWait:V,trailing:t})}const ha=Le({urlList:{type:q(Array),default:()=>ze([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:q(String)}}),ba={close:()=>!0,error:i=>i instanceof Event,switch:i=>we(i),rotate:i=>we(i)},ka=oe({name:"ElImageViewer"}),Ia=oe({...ka,props:ha,emits:ba,setup(i,{expose:V,emit:c}){var d;const t=i,g={CONTAIN:{name:"contain",icon:Ie(Fe)},ORIGINAL:{name:"original",icon:Ie(Ve)}};let j;const{t:G}=Ne(),n=_e("image-viewer"),{nextZIndex:K}=De(),E=p(),S=p(),F=Xe(),$=f(()=>{const{scale:e,minScale:r,maxScale:l}=t;return Ye(e,r,l)}),y=p(!0),A=p(!1),O=p(!1),w=p(t.initialIndex),D=He(g.CONTAIN),o=p({scale:$.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),le=p((d=t.zIndex)!=null?d:K());je(O,{ns:n});const U=f(()=>{const{urlList:e}=t;return e.length<=1}),X=f(()=>w.value===0),Q=f(()=>w.value===t.urlList.length-1),Y=f(()=>t.urlList[w.value]),re=f(()=>[n.e("btn"),n.e("prev"),n.is("disabled",!t.infinite&&X.value)]),ee=f(()=>[n.e("btn"),n.e("next"),n.is("disabled",!t.infinite&&Q.value)]),ae=f(()=>{const{scale:e,deg:r,offsetX:l,offsetY:N,enableTransition:R}=o.value;let L=l/e,x=N/e;const W=r*Math.PI/180,be=Math.cos(W),ke=Math.sin(W);L=L*be+x*ke,x=x*be-l/e*ke;const ve={transform:`scale(${e}) rotate(${r}deg) translate(${L}px, ${x}px)`,transition:R?"transform .3s":""};return D.value.name===g.CONTAIN.name&&(ve.maxWidth=ve.maxHeight="100%"),ve}),se=f(()=>`${w.value+1} / ${t.urlList.length}`);function M(){ce(),j?.(),O.value=!1,c("close")}function ie(){const e=ge(l=>{switch(oa(l)){case H.esc:t.closeOnPressEscape&&M();break;case H.space:ue();break;case H.left:de();break;case H.up:T("zoomIn");break;case H.right:fe();break;case H.down:T("zoomOut");break}}),r=ge(l=>{const N=l.deltaY||l.deltaX;T(N<0?"zoomIn":"zoomOut",{zoomRate:t.zoomRate,enableTransition:!1})});F.run(()=>{Z(document,"keydown",e),Z(E,"wheel",r)})}function ce(){F.stop()}function s(){y.value=!1}function I(e){A.value=!0,y.value=!1,c("error",e),e.target.alt=G("el.image.error")}function h(e){if(y.value||e.button!==0||!E.value)return;o.value.enableTransition=!1;const{offsetX:r,offsetY:l}=o.value,N=e.pageX,R=e.pageY,L=ge(W=>{o.value={...o.value,offsetX:r+W.pageX-N,offsetY:l+W.pageY-R}}),x=Z(document,"mousemove",L);Z(document,"mouseup",()=>{x()}),e.preventDefault()}function B(){o.value={scale:$.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function ue(){if(y.value||A.value)return;const e=na(g),r=Object.values(g),l=D.value.name,R=(r.findIndex(L=>L.name===l)+1)%e.length;D.value=g[e[R]],B()}function te(e){A.value=!1;const r=t.urlList.length;w.value=(e+r)%r}function de(){X.value&&!t.infinite||te(w.value-1)}function fe(){Q.value&&!t.infinite||te(w.value+1)}function T(e,r={}){if(y.value||A.value)return;const{minScale:l,maxScale:N}=t,{zoomRate:R,rotateDeg:L,enableTransition:x}={zoomRate:t.zoomRate,rotateDeg:90,enableTransition:!0,...r};switch(e){case"zoomOut":o.value.scale>l&&(o.value.scale=Number.parseFloat((o.value.scale/R).toFixed(3)));break;case"zoomIn":o.value.scale<N&&(o.value.scale=Number.parseFloat((o.value.scale*R).toFixed(3)));break;case"clockwise":o.value.deg+=L,c("rotate",o.value.deg);break;case"anticlockwise":o.value.deg-=L,c("rotate",o.value.deg);break}o.value.enableTransition=x}function xe(e){var r;((r=e.detail)==null?void 0:r.focusReason)==="pointer"&&e.preventDefault()}function Pe(){t.closeOnPressEscape&&M()}function Ae(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return ne(()=>$.value,e=>{o.value.scale=e}),ne(Y,()=>{Te(()=>{const e=S.value;e?.complete||(y.value=!0)})}),ne(w,e=>{B(),c("switch",e)}),$e(()=>{O.value=!0,ie(),j=Z("wheel",Ae,{passive:!1})}),V({setActiveItem:te}),(e,r)=>(k(),ye(a(wa),{to:"body",disabled:!e.teleported},{default:m(()=>[u(Ke,{name:"viewer-fade",appear:""},{default:m(()=>[b("div",{ref_key:"wrapper",ref:E,tabindex:-1,class:v(a(n).e("wrapper")),style:Ce({zIndex:le.value})},[u(a(We),{loop:"",trapped:"","focus-trap-el":E.value,"focus-start-el":"container",onFocusoutPrevented:xe,onReleaseRequested:Pe},{default:m(()=>[b("div",{class:v(a(n).e("mask")),onClick:Ze(l=>e.hideOnClickModal&&M(),["self"])},null,10,["onClick"]),C(" CLOSE "),b("span",{class:v([a(n).e("btn"),a(n).e("close")]),onClick:M},[u(a(P),null,{default:m(()=>[u(a(Je))]),_:1})],2),C(" ARROW "),a(U)?C("v-if",!0):(k(),_(he,{key:0},[b("span",{class:v(a(re)),onClick:de},[u(a(P),null,{default:m(()=>[u(a(qe))]),_:1})],2),b("span",{class:v(a(ee)),onClick:fe},[u(a(P),null,{default:m(()=>[u(a(Ge))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(k(),_("div",{key:1,class:v([a(n).e("btn"),a(n).e("progress")])},[z(e.$slots,"progress",{activeIndex:w.value,total:e.urlList.length},()=>[Ue(Oe(a(se)),1)])],2)):C("v-if",!0),C(" ACTIONS "),b("div",{class:v([a(n).e("btn"),a(n).e("actions")])},[b("div",{class:v(a(n).e("actions__inner"))},[z(e.$slots,"toolbar",{actions:T,prev:de,next:fe,reset:ue,activeIndex:w.value,setActiveItem:te},()=>[u(a(P),{onClick:l=>T("zoomOut")},{default:m(()=>[u(a(Qe))]),_:1},8,["onClick"]),u(a(P),{onClick:l=>T("zoomIn")},{default:m(()=>[u(a(ea))]),_:1},8,["onClick"]),b("i",{class:v(a(n).e("actions__divider"))},null,2),u(a(P),{onClick:ue},{default:m(()=>[(k(),ye(aa(a(D).icon)))]),_:1}),b("i",{class:v(a(n).e("actions__divider"))},null,2),u(a(P),{onClick:l=>T("anticlockwise")},{default:m(()=>[u(a(sa))]),_:1},8,["onClick"]),u(a(P),{onClick:l=>T("clockwise")},{default:m(()=>[u(a(ta))]),_:1},8,["onClick"])])],2)],2),C(" CANVAS "),b("div",{class:v(a(n).e("canvas"))},[A.value&&e.$slots["viewer-error"]?z(e.$slots,"viewer-error",{key:0,activeIndex:w.value,src:a(Y)}):(k(),_("img",{ref_key:"imgRef",ref:S,key:a(Y),src:a(Y),style:Ce(a(ae)),class:v(a(n).e("img")),crossorigin:e.crossorigin,onLoad:s,onError:I,onMousedown:h},null,46,["src","crossorigin"]))],2),z(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var Ca=Se(Ia,[["__file","image-viewer.vue"]]);const Ea=Re(Ca),La=Le({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:q([String,Object])},previewSrcList:{type:q(Array),default:()=>ze([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:q(String)}}),za={load:i=>i instanceof Event,error:i=>i instanceof Event,switch:i=>we(i),close:()=>!0,show:()=>!0},Sa=oe({name:"ElImage",inheritAttrs:!1}),Na=oe({...Sa,props:La,emits:za,setup(i,{expose:V,emit:c}){const d=i,{t}=Ne(),g=_e("image"),j=la(),G=f(()=>ra(Object.entries(j).filter(([s])=>/^(data-|on[A-Z])/i.test(s)||["id","style"].includes(s)))),n=ia({excludeListeners:!0,excludeKeys:f(()=>Object.keys(G.value))}),K=p(),E=p(!1),S=p(!0),F=p(!1),$=p(),y=p(),A=J&&"loading"in HTMLImageElement.prototype;let O;const w=f(()=>[g.e("inner"),o.value&&g.e("preview"),S.value&&g.is("loading")]),D=f(()=>{const{fit:s}=d;return J&&s?{objectFit:s}:{}}),o=f(()=>{const{previewSrcList:s}=d;return ca(s)&&s.length>0}),le=f(()=>{const{previewSrcList:s,initialIndex:I}=d;let h=I;return I>s.length-1&&(h=0),h}),U=f(()=>d.loading==="eager"?!1:!A&&d.loading==="lazy"||d.lazy),X=()=>{J&&(S.value=!0,E.value=!1,K.value=d.src)};function Q(s){S.value=!1,E.value=!1,c("load",s)}function Y(s){S.value=!1,E.value=!0,c("error",s)}function re(s){s&&(X(),se())}const ee=ga(re,200,!0);async function ae(){var s;if(!J)return;await Te();const{scrollContainer:I}=d;if(da(I))y.value=I;else if(fa(I)&&I!=="")y.value=(s=document.querySelector(I))!=null?s:void 0;else if($.value){const B=va($.value);y.value=ma(B)?void 0:B}const{stop:h}=pa($,([B])=>{ee(B.isIntersecting)},{root:y});O=h}function se(){!J||!ee||(O?.(),y.value=void 0,O=void 0)}function M(){o.value&&(F.value=!0,c("show"))}function ie(){F.value=!1,c("close")}function ce(s){c("switch",s)}return ne(()=>d.src,()=>{U.value?(S.value=!0,E.value=!1,se(),ae()):X()}),$e(()=>{U.value?ae():X()}),V({showPreview:M}),(s,I)=>(k(),_("div",Ee({ref_key:"container",ref:$},a(G),{class:[a(g).b(),s.$attrs.class]}),[E.value?z(s.$slots,"error",{key:0},()=>[b("div",{class:v(a(g).e("error"))},Oe(a(t)("el.image.error")),3)]):(k(),_(he,{key:1},[K.value!==void 0?(k(),_("img",Ee({key:0},a(n),{src:K.value,loading:s.loading,style:a(D),class:a(w),crossorigin:s.crossorigin,onClick:M,onLoad:Q,onError:Y}),null,16,["src","loading","crossorigin"])):C("v-if",!0),S.value?(k(),_("div",{key:1,class:v(a(g).e("wrapper"))},[z(s.$slots,"placeholder",{},()=>[b("div",{class:v(a(g).e("placeholder"))},null,2)])],2)):C("v-if",!0)],64)),a(o)?(k(),_(he,{key:2},[F.value?(k(),ye(a(Ea),{key:0,"z-index":s.zIndex,"initial-index":a(le),infinite:s.infinite,"zoom-rate":s.zoomRate,"min-scale":s.minScale,"max-scale":s.maxScale,"show-progress":s.showProgress,"url-list":s.previewSrcList,scale:s.scale,crossorigin:s.crossorigin,"hide-on-click-modal":s.hideOnClickModal,teleported:s.previewTeleported,"close-on-press-escape":s.closeOnPressEscape,onClose:ie,onSwitch:ce},ua({toolbar:m(h=>[z(s.$slots,"toolbar",me(pe(h)))]),default:m(()=>[s.$slots.viewer?(k(),_("div",{key:0},[z(s.$slots,"viewer")])):C("v-if",!0)]),_:2},[s.$slots.progress?{name:"progress",fn:m(h=>[z(s.$slots,"progress",me(pe(h)))])}:void 0,s.$slots["viewer-error"]?{name:"viewer-error",fn:m(h=>[z(s.$slots,"viewer-error",me(pe(h)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):C("v-if",!0)],64)):C("v-if",!0)],16))}});var _a=Se(Na,[["__file","image.vue"]]);const Ta=Re(_a);export{Ta as E};
