import{bd as L,F as $,t as b,o as v,J as P,K as E,X as _,a1 as h,u as x,aw as M,bH as F,ar as T,ap as V,T as z,a$ as B,az as I,as as D,aC as K}from"./index-hQPirc-P.js";import{E as S}from"./el-space-QbtNnpuv.js";import{l as u}from"./leaflet-src-WnYWwdcG.js";import{e as N,g as k,c as j,a as A,f as g}from"./leaflet-geoman-pqAspvlo.js";async function U(d){const c=await L.get("https://amap.api.iszy.xyz/v3/geocode/geo",{params:{address:d,key:k}});if(c.data.status==="1"&&Number(c.data.count)>0){const t=c.data.geocodes[0],r=N.gcj02_To_gps84(Number.parseFloat(t.location.split(",")[0]),Number.parseFloat(t.location.split(",")[1]));return{latLng:new u.LatLng(r.lat,r.lng),address:t.formatted_address}}else throw new Error("未找到相关地址。")}async function O(d){const c=N.gps84_To_gcj02(d.lng,d.lat),t=await L.get("https://amap.api.iszy.xyz/v3/geocode/regeo",{params:{location:`${c.lng},${c.lat}`,output:"json",key:k,homeorcorp:1}});if(t.data.status==="1"&&t.data.regeocode.formatted_address)return t.data.regeocode.formatted_address;throw new Error("未找到相关地址。")}const R=$({__name:"latLng",setup(d){const c=new u.Icon.Default({iconUrl:"marker-icon-yellow.png",iconRetinaUrl:"marker-icon-2x-yellow.png"});let t,r,l;const p=b(""),w=b();v(()=>{t=j({dom:w.value,view:{center:[35,105],zoom:4}}),A(t),r=u.marker(t.getCenter(),{icon:new u.Icon.Default}).addTo(t).bindPopup(m(t.getCenter())).on("popupopen",()=>{l&&l.closePopup()}).openPopup(),t.on("move",()=>{r&&window.requestAnimationFrame(()=>{r.setLatLng(t.getCenter()),m(t.getCenter(),r.getPopup())})}),t.on("click",e=>{p.value=`${e.latlng.lng},${e.latlng.lat}`,f(e.latlng)}),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(e=>{p.value||(p.value=`${e.coords.longitude},${e.coords.latitude}`),t.setView([e.coords.latitude,e.coords.longitude],16)})});function y(){if(!p.value)return;const e=p.value.replace(/，/g,",").split(",");if(e.length===2&&!Number.isNaN(Number.parseFloat(e[0].trim()))&&!Number.isNaN(Number.parseFloat(e[1].trim()))){f(new u.LatLng(Number.parseFloat(e[1].trim()),Number.parseFloat(e[0].trim())),!0);return}C(p.value)}function m(e,a,i){a||(a=new u.Popup({autoPan:!1,autoClose:!1,closeOnEscapeKey:!1,closeOnClick:!1}));const s=e.lat;let o=e.lng%360;o<=-180&&(o+=360);let n="";return s>=0?n+=`<p>北纬N: ${Math.abs(s)}</p>`:n+=`<p>南纬S: ${Math.abs(s)}</p>`,o>=0?n+=`<p>东经E: ${Math.abs(o)}</p>`:n+=`<p>西经W: ${Math.abs(o)}</p>`,s>=0?n+=`<p>北纬N: ${g(Math.abs(s))}</p>`:n+=`<p>南纬S: ${g(Math.abs(s))}</p>`,o>=0?n+=`<p>东经E: ${g(o)}</p>`:n+=`<p>西经W: ${g(o)}</p>`,i&&(n+=`<p>地址: ${i}</p>`),a.setContent(n),a}function f(e,a,i){if(a&&t.setView(e,16),l?l.setLatLng(e):l=u.marker(e,{icon:c}).on("popupopen",()=>{r&&r.closePopup()}).addTo(t),i)s();else{const o=setTimeout(()=>{s()},500);O(e).then(n=>{clearTimeout(o),i=n,s()})}function s(){const o=m(e,l.getPopup(),i);l.getPopup()||l.bindPopup(o),l.openPopup()}}async function C(e){try{const a=await U(e);f(a.latLng,!0,a.address)}catch(a){B.error(a.message)}}return(e,a)=>{const i=I,s=D,o=S;return P(),E(z,null,[_(o,{size:8,alignment:"center"},{default:h(()=>[_(i,{modelValue:x(p),"onUpdate:modelValue":a[0]||(a[0]=n=>M(p)?p.value=n:null),placeholder:"输入经纬度(如'116.4,36.9')或地址(如'北京市政府')","allow-clear":"",onKeydown:F(y,["enter"])},null,8,["modelValue"]),_(s,{type:"primary",onClick:y},{default:h(()=>[T(" 解析 ")]),_:1})]),_:1}),V("div",{ref_key:"mapContainer",ref:w,class:"mapContainer"},null,512)],64)}}}),X=K(R,[["__scopeId","data-v-b327f4d2"]]);export{X as default};
