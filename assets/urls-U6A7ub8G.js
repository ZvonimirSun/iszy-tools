import{aB as O,ae as R,G as Y,K as Q,s as W,o as p,j as _,I as V,w as i,a3 as X,v as n,Y as Z,a5 as B,a4 as L,L as P,O as ee,aF as ae,n as $,H as I,q as te,ai as le,$ as se,am as y,J as c,k as U,t as s,A as k,B as oe,D as S,F as z,x as A,z as re,E as ne,p as ie,l as de,h as ue}from"./index-o_3zfK9D.js";import{v as ce}from"./el-loading-g3fgzou9.js";import{E as pe}from"./el-pagination-i7bHHMV3.js";import"./el-tag-B0PNT7d3.js";import"./el-select-6LKyvezY.js";import"./el-scrollbar-vz8xv5bG.js";import"./el-popper-Y_gCM0eV.js";import{E as me,a as fe}from"./el-table-column-CUANvt_b.js";import"./el-checkbox-CZtkII59.js";import"./el-tooltip-w40geAFS.js";import{E as ye}from"./el-popover-xUfo7drG.js";import{d as T}from"./dayjs.min-MO-L4O-G.js";import"./isEqual-ZXEvp1IW.js";import"./index-M6Bs7v5Z.js";import"./hasIn-5_bzPVsS.js";import"./strings-1HC6G1n_.js";import"./toInteger-EeOzIynn.js";import"./toFinite-STcBZBpN.js";import"./isUndefined-IZwZ21d-.js";import"./index-7eWOsffA.js";import"./map-ticeFjFQ.js";import"./_baseEach-RR-VXSIa.js";import"./raf-09Kq0VaZ.js";const ke=O({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1},href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:R}}),_e={click:f=>f instanceof MouseEvent},ge=["href","target"],ve=Y({name:"ElLink"}),he=Y({...ve,props:ke,emits:_e,setup(f,{emit:E}){const o=f,r=Q("link"),C=W(()=>[r.b(),r.m(o.type),r.is("disabled",o.disabled),r.is("underline",o.underline&&!o.disabled)]);function v(t){o.disabled||E("click",t)}return(t,g)=>(p(),_("a",{class:L(n(C)),href:t.disabled||!t.href?void 0:t.href,target:t.disabled||!t.href?void 0:t.target,onClick:v},[t.icon?(p(),V(n(Z),{key:0},{default:i(()=>[(p(),V(X(t.icon)))]),_:1})):B("v-if",!0),t.$slots.default?(p(),_("span",{key:1,class:L(n(r).e("inner"))},[P(t.$slots,"default")],2)):B("v-if",!0),t.$slots.icon?P(t.$slots,"icon",{key:2}):B("v-if",!0)],10,ge))}});var we=ee(he,[["__file","link.vue"]]);const be=ae(we),D=f=>(ie("data-v-9d5dd9e6"),f=f(),de(),f),$e={flex:"","flex-col":"","gap-4":"","h-full":""},Ee={class:"new-url-form"},Ce=D(()=>U("span",null," 输入链接: ",-1)),ze=D(()=>U("span",null," 自定义短网址(选): ",-1)),Be=D(()=>U("br",null,null,-1)),Ve="https://url.iszy.xyz",Ue=Y({__name:"urls",setup(f){const E=$([]),o=$(10),r=$(1),C=$(0),v=$(!1),t=I({}),g=I({}),m=I({keyword:"",url:""});te(()=>{h(r.value-1,o.value)}),le(()=>{h(r.value-1,o.value)}),se(o,()=>{r.value=1});async function h(a,l){const w=setTimeout(()=>{v.value=!0},300);try{const u=(await y.get(`${y.$apiBase}/urls/admin/urls`,{params:{pageIndex:a,pageSize:l}})).data;u.success?(C.value=u.data.count,E.value=u.data.rows.map(d=>(d.createdAt=T(d.createdAt).format("YYYY年MM月DD日 HH:mm"),d.updatedAt=T(d.updatedAt).format("YYYY年MM月DD日 HH:mm"),d))):c.error(u.message)}catch(u){c.error(u.message)}clearTimeout(w),v.value=!1}async function H(){if(m.url)try{const a=(await y.post(`${y.$apiBase}/urls/admin/url`,{url:m.url,keyword:m.keyword})).data;a.success?(c.success("创建成功"),m.url="",m.keyword="",await h(r.value-1,o.value)):c.error(a.message)}catch(a){c.error(a.message)}}async function N(a){try{const l=(await y.put(`${y.$apiBase}/urls/admin/url/${a.keyword}`,{url:g[a.keyword]})).data;l.success?(c.success("更新成功"),a.url=g[a.keyword],t[a.keyword]=!1,await h(r.value-1,o.value)):c.error(l.message)}catch(l){c.error(l.message)}}async function F(a){try{const l=(await y.delete(`${y.$apiBase}/urls/admin/url/${a.keyword}`,{params:{keyword:a.keyword}})).data;l.success?(await h(r.value-1,o.value),c.success("删除成功")):c.error(l.message)}catch(l){c.error(l.message)}}function M(a){t[a.keyword]=!t[a.keyword],t[a.keyword]&&(g[a.keyword]=a.url)}function j(a){return(r.value-1)*o.value+a+1}return(a,l)=>{const w=re,u=ne,d=me,x=be,K=ye,q=fe,G=pe,J=ce;return p(),_("div",$e,[U("div",Ee,[Ce,s(w,{modelValue:n(m).url,"onUpdate:modelValue":l[0]||(l[0]=e=>n(m).url=e),placeholder:"https",clearable:"","flex-1":""},null,8,["modelValue"]),ze,s(w,{modelValue:n(m).keyword,"onUpdate:modelValue":l[1]||(l[1]=e=>n(m).keyword=e),clearable:""},null,8,["modelValue"]),s(u,{type:"primary",onClick:H},{default:i(()=>[k(" 缩短 ")]),_:1})]),oe((p(),V(q,{data:n(E),border:!0,stripe:!0,size:"small","flex-1":""},{default:i(()=>[s(d,{type:"index",index:j,fixed:"left"}),s(d,{prop:"keyword",label:"短网址",width:"100",fixed:"left"},{default:i(({row:e})=>[s(x,{href:Ve+"/"+e.keyword,target:"_blank",style:{"white-space":"nowrap"}},{default:i(()=>[k(S(e.keyword),1)]),_:2},1032,["href"])]),_:1}),s(d,{prop:"url",label:"原网址","min-width":"300"},{default:i(({row:e})=>[n(t)[e.keyword]?(p(),V(w,{key:1,modelValue:n(g)[e.keyword],"onUpdate:modelValue":b=>n(g)[e.keyword]=b},null,8,["modelValue","onUpdate:modelValue"])):(p(),_(z,{key:0},[e.title?(p(),_(z,{key:0},[s(x,{href:e.url,target:"_blank"},{default:i(()=>[k(S(e.title),1)]),_:2},1032,["href"]),Be],64)):B("",!0),s(x,{href:e.url,target:"_blank"},{default:i(()=>[k(S(e.url),1)]),_:2},1032,["href"])],64))]),_:1}),s(d,{prop:"createdAt",label:"日期",width:"180"}),s(d,{prop:"ip",label:"IP",width:"130"}),s(d,{prop:"clicks",label:"点击次数",width:"80"}),s(d,{label:"操作",width:"140",fixed:"right"},{default:i(({row:e})=>[n(t)[e.keyword]?(p(),_(z,{key:1},[s(u,{size:"small",onClick:b=>M(e)},{default:i(()=>[k(" 取消 ")]),_:2},1032,["onClick"]),s(u,{size:"small",type:"primary",onClick:b=>N(e)},{default:i(()=>[k(" 更新 ")]),_:2},1032,["onClick"])],64)):(p(),_(z,{key:0},[s(u,{size:"small",onClick:b=>M(e)},{default:i(()=>[k(" 编辑 ")]),_:2},1032,["onClick"]),s(K,{width:"160",title:"删除后无法恢复！","confirm-button-type":"danger","confirm-button-text":"删除",onConfirm:b=>F(e)},{reference:i(()=>[s(u,{size:"small",type:"danger"},{default:i(()=>[k(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])],64))]),_:1})]),_:1},8,["data"])),[[J,n(v)]]),s(G,{"current-page":n(r),"onUpdate:currentPage":l[2]||(l[2]=e=>A(r)?r.value=e:null),"page-size":n(o),"onUpdate:pageSize":l[3]||(l[3]=e=>A(o)?o.value=e:null),small:"",background:"",layout:"prev, pager, next",total:n(C)},null,8,["current-page","page-size","total"])])}}}),Ze=ue(Ue,[["__scopeId","data-v-9d5dd9e6"]]);export{Ze as default};
