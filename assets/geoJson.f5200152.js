import{L,l as d,c as W}from"./leaflet.ChineseLayer.f142a669.js";import{C as _e}from"./vue-codemirror.a2ad42b5.js";import{a8 as st,d as Te,a3 as Jt,ah as Ie,aN as Re,_ as zt,$ as Ne,aa as Zt,a0 as Ce,a9 as Vt,aO as Ae,l as xe,a as k,o as U,c as H,w as P,e as $,J as Oe,f as ot,Q as Le,P as Pe,O as we,b as M,U as be,V as xt,g as at,ag as Me}from"./vendor.3bd2b7e4.js";import{J as Ue}from"./jsoneditor.min.255f8499.js";/* empty css               *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css                *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css              */import{_ as De}from"./index.8932276d.js";var a=window.SuperMap=window.SuperMap||{};a.Components=window.SuperMap.Components||{};a.inherit=function(e,t){var r=function(){};r.prototype=t.prototype,e.prototype=new r;var i,n,s;for(i=2,n=arguments.length;i<n;i++)s=arguments[i],typeof s=="function"&&(s=s.prototype),a.Util.extend(e.prototype,s)};a.mixin=function(...e){class t{constructor(o){for(var l=0;l<e.length;l++)n(this,new e[l](o))}}for(var r=0;r<e.length;r++){var i=e[r];n(t,i),n(t.prototype,i.prototype),n(t.prototype,new i)}return t;function n(s,o){var l=Object.getOwnPropertyNames(o);Object.getOwnPropertySymbols&&(l=l.concat(Object.getOwnPropertySymbols(o)));for(var h=0;h<l.length;h++){var f=l[h];if(f!=="constructor"&&f!=="prototype"&&f!=="name"&&f!=="length"){let p=Object.getOwnPropertyDescriptor(o,f);window.ActiveXObject?Object.defineProperty(s,f,p||{}):Object.defineProperty(s,f,p)}}}};a.String={startsWith:function(e,t){return e.indexOf(t)==0},contains:function(e,t){return e.indexOf(t)!=-1},trim:function(e){return e.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},camelize:function(e){for(var t=e.split("-"),r=t[0],i=1,n=t.length;i<n;i++){var s=t[i];r+=s.charAt(0).toUpperCase()+s.substring(1)}return r},format:function(e,t,r){t||(t=window);var i=function(n,s){for(var o,l=s.split(/\.+/),h=0;h<l.length;h++)h==0&&(o=t),o=o[l[h]];return typeof o=="function"&&(o=r?o.apply(null,r):o()),typeof o=="undefined"?"undefined":o};return e.replace(a.String.tokenRegEx,i)},tokenRegEx:/\$\{([\w.]+?)\}/g,numberRegEx:/^([+-]?)(?=\d|\.\d)\d*(\.\d*)?([Ee]([+-]?\d+))?$/,isNumeric:function(e){return a.String.numberRegEx.test(e)},numericIf:function(e){return a.String.isNumeric(e)?parseFloat(e):e}};var Ge=a.Number={decimalSeparator:".",thousandsSeparator:",",limitSigDigs:function(e,t){var r=0;return t>0&&(r=parseFloat(e.toPrecision(t))),r},format:function(e,t,r,i){t=typeof t!="undefined"?t:0,r=typeof r!="undefined"?r:a.Number.thousandsSeparator,i=typeof i!="undefined"?i:a.Number.decimalSeparator,t!=null&&(e=parseFloat(e.toFixed(t)));var n=e.toString().split(".");n.length===1&&t==null&&(t=0);var s=n[0];if(r)for(var o=/(-?[0-9]+)([0-9]{3})/;o.test(s);)s=s.replace(o,"$1"+r+"$2");var l;if(t==0)l=s;else{var h=n.length>1?n[1]:"0";t!=null&&(h=h+new Array(t-h.length+1).join("0")),l=s+i+h}return l}};Number.prototype.limitSigDigs||(Number.prototype.limitSigDigs=function(e){return Ge.limitSigDigs(this,e)});a.Function={bind:function(e,t){var r=Array.prototype.slice.apply(arguments,[2]);return function(){var i=r.concat(Array.prototype.slice.apply(arguments,[0]));return e.apply(t,i)}},bindAsEventListener:function(e,t){return function(r){return e.call(t,r||window.event)}},False:function(){return!1},True:function(){return!0},Void:function(){}};a.Array={filter:function(e,t,r){var i=[];if(Array.prototype.filter)i=e.filter(t,r);else{var n=e.length;if(typeof t!="function")throw new TypeError;for(var s=0;s<n;s++)if(s in e){var o=e[s];t.call(r,o,s,e)&&i.push(o)}}return i}};var T=a.Util=a.Util||{};a.Util.extend=function(e,t){if(e=e||{},t){for(var r in t){var i=t[r];i!==void 0&&(e[r]=i)}var n=typeof window.Event=="function"&&t instanceof window.Event;!n&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&(e.toString=t.toString)}return e};a.Util.copy=function(e,t){e=e||{};var r;if(t)for(var i in e)r=t[i],typeof r!="undefined"&&(e[i]=r)};a.Util.reset=function(e){e=e||{};for(var t in e)if(e.hasOwnProperty(t)){if(typeof e[t]=="object"&&e[t]instanceof Array){for(var r in e[t])e[t][r].destroy&&e[t][r].destroy();e[t].length=0}else typeof e[t]=="object"&&e[t]instanceof Object&&e[t].destroy&&e[t].destroy();e[t]=null}};a.Util.getElement=function(){for(var e=[],t=0,r=arguments.length;t<r;t++){var i=arguments[t];if(typeof i=="string"&&(i=document.getElementById(i)),arguments.length===1)return i;e.push(i)}return e};a.Util.isElement=function(e){return!!(e&&e.nodeType===1)};a.Util.isArray=function(e){return Object.prototype.toString.call(e)==="[object Array]"};a.Util.removeItem=function(e,t){for(var r=e.length-1;r>=0;r--)e[r]===t&&e.splice(r,1);return e};a.Util.indexOf=function(e,t){if(e==null)return-1;if(typeof e.indexOf=="function")return e.indexOf(t);for(var r=0,i=e.length;r<i;r++)if(e[r]===t)return r;return-1};a.Util.modifyDOMElement=function(e,t,r,i,n,s,o,l){t&&(e.id=t),r&&(e.style.left=r.x+"px",e.style.top=r.y+"px"),i&&(e.style.width=i.w+"px",e.style.height=i.h+"px"),n&&(e.style.position=n),s&&(e.style.border=s),o&&(e.style.overflow=o),parseFloat(l)>=0&&parseFloat(l)<1?(e.style.filter="alpha(opacity="+l*100+")",e.style.opacity=l):parseFloat(l)===1&&(e.style.filter="",e.style.opacity="")};a.Util.applyDefaults=function(e,t){e=e||{};var r=typeof window.Event=="function"&&t instanceof window.Event;for(var i in t)(e[i]===void 0||!r&&t.hasOwnProperty&&t.hasOwnProperty(i)&&!e.hasOwnProperty(i))&&(e[i]=t[i]);return!r&&t&&t.hasOwnProperty&&t.hasOwnProperty("toString")&&!e.hasOwnProperty("toString")&&(e.toString=t.toString),e};a.Util.getParameterString=function(e){var t=[];for(var r in e){var i=e[r];if(i!=null&&typeof i!="function"){var n;Array.isArray(i)||i.toString()==="[object Object]"?n=encodeURIComponent(JSON.stringify(i)):n=encodeURIComponent(i),t.push(encodeURIComponent(r)+"="+n)}}return t.join("&")};a.Util.urlAppend=function(e,t){var r=e;if(t){t.indexOf("?")===0&&(t=t.substring(1));var i=(e+" ").split(/[?&]/);r+=i.pop()===" "?t:i.length?"&"+t:"?"+t}return r};a.Util.urlPathAppend=function(e,t){let r=e;if(!t)return r;t.indexOf("/")===0&&(t=t.substring(1));const i=e.split("?");return i[0].indexOf("/",i[0].length-1)<0&&(i[0]+="/"),r=`${i[0]}${t}${i.length>1?`?${i[1]}`:""}`,r};a.Util.DEFAULT_PRECISION=14;a.Util.toFloat=function(e,t){return t==null&&(t=a.Util.DEFAULT_PRECISION),typeof e!="number"&&(e=parseFloat(e)),t===0?e:parseFloat(e.toPrecision(t))};a.Util.rad=function(e){return e*Math.PI/180};a.Util.getParameters=function(e){e=e==null?window.location.href:e;var t="";if(a.String.contains(e,"?")){var r=e.indexOf("?")+1,i=a.String.contains(e,"#")?e.indexOf("#"):e.length;t=e.substring(r,i)}for(var n={},s=t.split(/[&;]/),o=0,l=s.length;o<l;++o){var h=s[o].split("=");if(h[0]){var f=h[0];try{f=decodeURIComponent(f)}catch(g){f=unescape(f)}var p=(h[1]||"").replace(/\+/g," ");try{p=decodeURIComponent(p)}catch(g){p=unescape(p)}p=p.split(","),p.length==1&&(p=p[0]),n[f]=p}}return n};a.Util.lastSeqID=0;a.Util.createUniqueID=function(e){return e==null&&(e="id_"),a.Util.lastSeqID+=1,e+a.Util.lastSeqID};a.INCHES_PER_UNIT={inches:1,ft:12,mi:63360,m:39.3701,km:39370.1,dd:4374754,yd:36};a.INCHES_PER_UNIT.in=a.INCHES_PER_UNIT.inches;a.INCHES_PER_UNIT.degrees=a.INCHES_PER_UNIT.dd;a.INCHES_PER_UNIT.nmi=1852*a.INCHES_PER_UNIT.m;a.METERS_PER_INCH=.0254000508001016;a.Util.extend(a.INCHES_PER_UNIT,{Inch:a.INCHES_PER_UNIT.inches,Meter:1/a.METERS_PER_INCH,Foot:.3048006096012192/a.METERS_PER_INCH,IFoot:.3048/a.METERS_PER_INCH,ClarkeFoot:.3047972651151/a.METERS_PER_INCH,SearsFoot:.30479947153867626/a.METERS_PER_INCH,GoldCoastFoot:.3047997101815088/a.METERS_PER_INCH,IInch:.0254/a.METERS_PER_INCH,MicroInch:254e-7/a.METERS_PER_INCH,Mil:254e-10/a.METERS_PER_INCH,Centimeter:.01/a.METERS_PER_INCH,Kilometer:1e3/a.METERS_PER_INCH,Yard:.9144018288036576/a.METERS_PER_INCH,SearsYard:.914398414616029/a.METERS_PER_INCH,IndianYard:.9143985307444408/a.METERS_PER_INCH,IndianYd37:.91439523/a.METERS_PER_INCH,IndianYd62:.9143988/a.METERS_PER_INCH,IndianYd75:.9143985/a.METERS_PER_INCH,IndianFoot:.30479951/a.METERS_PER_INCH,IndianFt37:.30479841/a.METERS_PER_INCH,IndianFt62:.3047996/a.METERS_PER_INCH,IndianFt75:.3047995/a.METERS_PER_INCH,Mile:1609.3472186944373/a.METERS_PER_INCH,IYard:.9144/a.METERS_PER_INCH,IMile:1609.344/a.METERS_PER_INCH,NautM:1852/a.METERS_PER_INCH,"Lat-66":110943.31648893273/a.METERS_PER_INCH,"Lat-83":110946.25736872235/a.METERS_PER_INCH,Decimeter:.1/a.METERS_PER_INCH,Millimeter:.001/a.METERS_PER_INCH,Dekameter:10/a.METERS_PER_INCH,Decameter:10/a.METERS_PER_INCH,Hectometer:100/a.METERS_PER_INCH,GermanMeter:1.0000135965/a.METERS_PER_INCH,CaGrid:.999738/a.METERS_PER_INCH,ClarkeChain:20.1166194976/a.METERS_PER_INCH,GunterChain:20.11684023368047/a.METERS_PER_INCH,BenoitChain:20.116782494375872/a.METERS_PER_INCH,SearsChain:20.11676512155/a.METERS_PER_INCH,ClarkeLink:.201166194976/a.METERS_PER_INCH,GunterLink:.2011684023368047/a.METERS_PER_INCH,BenoitLink:.20116782494375873/a.METERS_PER_INCH,SearsLink:.2011676512155/a.METERS_PER_INCH,Rod:5.02921005842012/a.METERS_PER_INCH,IntnlChain:20.1168/a.METERS_PER_INCH,IntnlLink:.201168/a.METERS_PER_INCH,Perch:5.02921005842012/a.METERS_PER_INCH,Pole:5.02921005842012/a.METERS_PER_INCH,Furlong:201.1684023368046/a.METERS_PER_INCH,Rood:3.778266898/a.METERS_PER_INCH,CapeFoot:.3047972615/a.METERS_PER_INCH,Brealey:375/a.METERS_PER_INCH,ModAmFt:.304812252984506/a.METERS_PER_INCH,Fathom:1.8288/a.METERS_PER_INCH,"NautM-UK":1853.184/a.METERS_PER_INCH,"50kilometers":5e4/a.METERS_PER_INCH,"150kilometers":15e4/a.METERS_PER_INCH});a.Util.extend(a.INCHES_PER_UNIT,{mm:a.INCHES_PER_UNIT.Meter/1e3,cm:a.INCHES_PER_UNIT.Meter/100,dm:a.INCHES_PER_UNIT.Meter*100,km:a.INCHES_PER_UNIT.Meter*1e3,kmi:a.INCHES_PER_UNIT.nmi,fath:a.INCHES_PER_UNIT.Fathom,ch:a.INCHES_PER_UNIT.IntnlChain,link:a.INCHES_PER_UNIT.IntnlLink,"us-in":a.INCHES_PER_UNIT.inches,"us-ft":a.INCHES_PER_UNIT.Foot,"us-yd":a.INCHES_PER_UNIT.Yard,"us-ch":a.INCHES_PER_UNIT.GunterChain,"us-mi":a.INCHES_PER_UNIT.Mile,"ind-yd":a.INCHES_PER_UNIT.IndianYd37,"ind-ft":a.INCHES_PER_UNIT.IndianFt37,"ind-ch":20.11669506/a.METERS_PER_INCH});a.DOTS_PER_INCH=96;a.Util.normalizeScale=function(e){var t=e>1?1/e:e;return t};a.Util.getResolutionFromScale=function(e,t){var r;if(e){t==null&&(t="degrees");var i=a.Util.normalizeScale(e);r=1/(i*a.INCHES_PER_UNIT[t]*a.DOTS_PER_INCH)}return r};a.Util.getScaleFromResolution=function(e,t){t==null&&(t="degrees");var r=e*a.INCHES_PER_UNIT[t]*a.DOTS_PER_INCH;return r};a.IS_GECKO=function(){var e=navigator.userAgent.toLowerCase();return e.indexOf("webkit")===-1&&e.indexOf("gecko")!==-1}();a.Browser=function(){var e="",t="",r="pc",i,n=navigator.userAgent.toLowerCase();return n.indexOf("msie")>-1||n.indexOf("trident")>-1&&n.indexOf("rv")>-1?(e="msie",i=n.match(/msie ([\d.]+)/)||n.match(/rv:([\d.]+)/)):n.indexOf("chrome")>-1?(e="chrome",i=n.match(/chrome\/([\d.]+)/)):n.indexOf("firefox")>-1?(e="firefox",i=n.match(/firefox\/([\d.]+)/)):n.indexOf("opera")>-1?(e="opera",i=n.match(/version\/([\d.]+)/)):n.indexOf("safari")>-1&&(e="safari",i=n.match(/version\/([\d.]+)/)),t=i?i[1]:"",n.indexOf("ipad")>-1||n.indexOf("ipod")>-1||n.indexOf("iphone")>-1?r="apple":n.indexOf("android")>-1&&(i=n.match(/version\/([\d.]+)/),t=i?i[1]:"",r="android"),{name:e,version:t,device:r}}();a.Util.getBrowser=function(){return a.Browser};a.Util.isSupportCanvas=function(){var e=!0,t=a.Util.getBrowser();return document.createElement("canvas").getContext?(t.name==="firefox"&&parseFloat(t.version)<5&&(e=!1),t.name==="safari"&&parseFloat(t.version)<4&&(e=!1),t.name==="opera"&&parseFloat(t.version)<10&&(e=!1),t.name==="msie"&&parseFloat(t.version)<9&&(e=!1)):e=!1,e}();a.Util.supportCanvas=function(){return a.Util.isSupportCanvas};a.INCHES_PER_UNIT.degree=a.INCHES_PER_UNIT.dd;a.INCHES_PER_UNIT.meter=a.INCHES_PER_UNIT.m;a.INCHES_PER_UNIT.foot=a.INCHES_PER_UNIT.ft;a.INCHES_PER_UNIT.inch=a.INCHES_PER_UNIT.inches;a.INCHES_PER_UNIT.mile=a.INCHES_PER_UNIT.mi;a.INCHES_PER_UNIT.kilometer=a.INCHES_PER_UNIT.km;a.INCHES_PER_UNIT.yard=a.INCHES_PER_UNIT.yd;a.Util.isInTheSameDomain=function(e){if(!e)return!0;var t=e.indexOf("//"),r=document.location.toString(),i=r.indexOf("//");if(t===-1)return!0;var n,s=n=e.substring(0,t),o=r.substring(i+2);i=o.indexOf("/");var l=o.indexOf(":"),h=o.substring(0,i),f=document.location.protocol;if(l!==-1||(h+=":"+(f.toLowerCase()==="http:"?80:443)),f.toLowerCase()!==s.toLowerCase())return!1;s=e.substring(t+2);var p=s.indexOf(":");t=s.indexOf("/");var g=s.substring(0,t),y;p!==-1?y=s.substring(0,p):(y=s.substring(0,t),g+=":"+(n.toLowerCase()==="http:"?80:443));var S=document.domain;return y===S&&g===h};a.Util.calculateDpi=function(e,t,r,i,n){if(!(!e||!t||!r)){var s=1e4,o=e.getWidth(),l=e.getHeight(),h=t.w,f=t.h;n=n||6378137,i=i||"degrees";var p;if(i.toLowerCase()==="degree"||i.toLowerCase()==="degrees"||i.toLowerCase()==="dd"){let g=o/h,y=l/f,S=g>y?g:y;p=.0254*s/S/r/(Math.PI*2*n/360)/s}else{let g=o/h;p=.0254*s/g/r/s}return p}};a.Util.toJSON=function(e){var t=e;if(t==null)return null;switch(t.constructor){case String:return t='"'+t.replace(/(["\\])/g,"\\$1")+'"',t=t.replace(/\n/g,"\\n"),t=t.replace(/\r/g,"\\r"),t=t.replace("<","&lt;"),t=t.replace(">","&gt;"),t=t.replace(/%/g,"%25"),t=t.replace(/&/g,"%26"),t;case Array:for(var r=[],i=0,n=t.length;i<n;i++)r.push(a.Util.toJSON(t[i]));return"["+r.join(",")+"]";case Number:return isFinite(t)?String(t):null;case Boolean:return String(t);case Date:var s=`{'__type':"System.DateTime",'Year':`+t.getFullYear()+",'Month':"+(t.getMonth()+1)+",'Day':"+t.getDate()+",'Hour':"+t.getHours()+",'Minute':"+t.getMinutes()+",'Second':"+t.getSeconds()+",'Millisecond':"+t.getMilliseconds()+",'TimezoneOffset':"+t.getTimezoneOffset()+"}";return s;default:if(t.toJSON!=null&&typeof t.toJSON=="function")return t.toJSON();if(typeof t=="object"){if(t.length){let l=[];for(let h=0,f=t.length;h<f;h++)l.push(a.Util.toJSON(t[h]));return"["+l.join(",")+"]"}let o=[];for(let l in t)typeof t[l]!="function"&&l!=="CLASS_NAME"&&l!=="parent"&&o.push("'"+l+"':"+a.Util.toJSON(t[l]));return o.length>0?"{"+o.join(",")+"}":"{}"}return t.toString()}};a.Util.getResolutionFromScaleDpi=function(e,t,r,i){var n=null,s=1e4;return i=i||6378137,r=r||"",e>0&&t>0?(e=a.Util.normalizeScale(e),r.toLowerCase()==="degree"||r.toLowerCase()==="degrees"||r.toLowerCase()==="dd"?(n=.0254*s/t/e/(Math.PI*2*i/360)/s,n):(n=.0254*s/t/e/s,n)):-1};a.Util.getScaleFromResolutionDpi=function(e,t,r,i){var n=null,s=1e4;return i=i||6378137,r=r||"",e>0&&t>0?r.toLowerCase()==="degree"||r.toLowerCase()==="degrees"||r.toLowerCase()==="dd"?(n=.0254*s/t/e/(Math.PI*2*i/360)/s,n):(n=.0254*s/t/e/s,n):-1};a.Util.transformResult=function(e){return e.responseText&&typeof e.responseText=="string"&&(e=JSON.parse(e.responseText)),e};a.Util.copyAttributes=function(e,t){if(e=e||{},t)for(var r in t){var i=t[r];i!==void 0&&r!=="CLASS_NAME"&&typeof i!="function"&&(e[r]=i)}return e};a.Util.copyAttributesWithClip=function(e,t,r){if(e=e||{},t)for(var i in t){var n=!1;if(r&&r.length){for(var s=0,o=r.length;s<o;s++)if(i===r[s]){n=!0;break}}if(n!==!0){var l=t[i];l!==void 0&&i!=="CLASS_NAME"&&typeof l!="function"&&(e[i]=l)}}return e};a.Util.cloneObject=function(e){if(e===null||typeof e!="object")return e;if(e instanceof Date){let r=new Date;return r.setTime(e.getTime()),r}if(e instanceof Array)return e.slice(0);if(e instanceof Object){let r={};for(var t in e)e.hasOwnProperty(t)&&(r[t]=a.Util.cloneObject(e[t]));return r}throw new Error("Unable to copy obj! Its type isn't supported.")};a.Util.lineIntersection=function(e,t,r,i){var n=null,s,o,l=(i.x-r.x)*(e.y-r.y)-(i.y-r.y)*(e.x-r.x),h=(t.x-e.x)*(e.y-r.y)-(t.y-e.y)*(e.x-r.x),f=(i.y-r.y)*(t.x-e.x)-(i.x-r.x)*(t.y-e.y);if(f!=0)s=l/f,o=h/f,s>=0&&o<=1&&s<=1&&o>=0?n=new a.Geometry.Point(e.x+s*(t.x-e.x),e.y+s*(t.y-e.y)):n="No Intersection";else if(l==0&&h==0){var p=Math.max(e.y,t.y),g=Math.min(e.y,t.y),y=Math.max(e.x,t.x),S=Math.min(e.x,t.x);(r.y>=g&&r.y<=p||i.y>=g&&i.y<=p)&&r.x>=S&&r.x<=y||i.x>=S&&i.x<=y?n="Coincident":n="Parallel"}else n="Parallel";return n};a.Util.getTextBounds=function(e,t,r){document.body.appendChild(r),r.style.width="auto",r.style.height="auto",e.fontSize&&(r.style.fontSize=e.fontSize),e.fontFamily&&(r.style.fontFamily=e.fontFamily),e.fontWeight&&(r.style.fontWeight=e.fontWeight),r.style.position="relative",r.style.visibility="hidden",r.style.display="inline-block",r.innerHTML=t;var i=r.clientWidth,n=r.clientHeight;return document.body.removeChild(r),{textWidth:i,textHeight:n}};a.Util.convertPath=function(e,t){return t?e.replace(/\{([\w-\.]+)\}/g,(r,i)=>{var n;return t.hasOwnProperty(i)?n=Fe(t[i]):n=r,encodeURIComponent(n)}):e};function Fe(e){return e==null||e==null?"":e instanceof Date?e.toJSON():Be(e)?JSON.stringify(e):e.toString()}function Be(e){if(typeof e!="string"&&typeof e!="object")return!1;try{const t=e.toString();return t==="[object Object]"||t==="[object Array]"}catch(t){return!1}}(function(e,t){(function(r,i){i()})(st,function(){function r(c){var v=this.constructor;return this.then(function(u){return v.resolve(c()).then(function(){return u})},function(u){return v.resolve(c()).then(function(){return v.reject(u)})})}function i(c){var v=this;return new v(function(u,m){if(!(c&&typeof c.length!="undefined"))return m(new TypeError(typeof c+" "+c+" is not iterable(cannot read property Symbol(Symbol.iterator))"));var E=Array.prototype.slice.call(c);if(E.length===0)return u([]);var R=E.length;function A(x,O){if(O&&(typeof O=="object"||typeof O=="function")){var B=O.then;if(typeof B=="function"){B.call(O,function(F){A(x,F)},function(F){E[x]={status:"rejected",reason:F},--R==0&&u(E)});return}}E[x]={status:"fulfilled",value:O},--R==0&&u(E)}for(var I=0;I<E.length;I++)A(I,E[I])})}var n=setTimeout;function s(c){return Boolean(c&&typeof c.length!="undefined")}function o(){}function l(c,v){return function(){c.apply(v,arguments)}}function h(c){if(!(this instanceof h))throw new TypeError("Promises must be constructed via new");if(typeof c!="function")throw new TypeError("not a function");this._state=0,this._handled=!1,this._value=void 0,this._deferreds=[],_(c,this)}function f(c,v){for(;c._state===3;)c=c._value;if(c._state===0){c._deferreds.push(v);return}c._handled=!0,h._immediateFn(function(){var u=c._state===1?v.onFulfilled:v.onRejected;if(u===null){(c._state===1?p:g)(v.promise,c._value);return}var m;try{m=u(c._value)}catch(E){g(v.promise,E);return}p(v.promise,m)})}function p(c,v){try{if(v===c)throw new TypeError("A promise cannot be resolved with itself.");if(v&&(typeof v=="object"||typeof v=="function")){var u=v.then;if(v instanceof h){c._state=3,c._value=v,y(c);return}else if(typeof u=="function"){_(l(u,v),c);return}}c._state=1,c._value=v,y(c)}catch(m){g(c,m)}}function g(c,v){c._state=2,c._value=v,y(c)}function y(c){c._state===2&&c._deferreds.length===0&&h._immediateFn(function(){c._handled||h._unhandledRejectionFn(c._value)});for(var v=0,u=c._deferreds.length;v<u;v++)f(c,c._deferreds[v]);c._deferreds=null}function S(c,v,u){this.onFulfilled=typeof c=="function"?c:null,this.onRejected=typeof v=="function"?v:null,this.promise=u}function _(c,v){var u=!1;try{c(function(m){u||(u=!0,p(v,m))},function(m){u||(u=!0,g(v,m))})}catch(m){if(u)return;u=!0,g(v,m)}}h.prototype.catch=function(c){return this.then(null,c)},h.prototype.then=function(c,v){var u=new this.constructor(o);return f(this,new S(c,v,u)),u},h.prototype.finally=r,h.all=function(c){return new h(function(v,u){if(!s(c))return u(new TypeError("Promise.all accepts an array"));var m=Array.prototype.slice.call(c);if(m.length===0)return v([]);var E=m.length;function R(I,x){try{if(x&&(typeof x=="object"||typeof x=="function")){var O=x.then;if(typeof O=="function"){O.call(x,function(B){R(I,B)},u);return}}m[I]=x,--E==0&&v(m)}catch(B){u(B)}}for(var A=0;A<m.length;A++)R(A,m[A])})},h.allSettled=i,h.resolve=function(c){return c&&typeof c=="object"&&c.constructor===h?c:new h(function(v){v(c)})},h.reject=function(c){return new h(function(v,u){u(c)})},h.race=function(c){return new h(function(v,u){if(!s(c))return u(new TypeError("Promise.race accepts an array"));for(var m=0,E=c.length;m<E;m++)h.resolve(c[m]).then(v,u)})},h._immediateFn=typeof setImmediate=="function"&&function(c){setImmediate(c)}||function(c){n(c,0)},h._unhandledRejectionFn=function(v){typeof console!="undefined"&&console&&console.warn("Possible Unhandled Promise Rejection:",v)};var N=function(){if(typeof self!="undefined")return self;if(typeof window!="undefined")return window;if(typeof st!="undefined")return st;throw new Error("unable to locate global object")}();typeof N.Promise!="function"?N.Promise=h:N.Promise.prototype.finally?N.Promise.allSettled||(N.Promise.allSettled=i):N.Promise.prototype.finally=r})})();var ke={exports:{}};(function(e){(function(t){if(!t.__disableNativeFetch&&t.fetch)return;function r(u){if(typeof u!="string"&&(u=String(u)),/[^a-z0-9\-#$%&'*+.\^_`|~]/i.test(u))throw new TypeError("Invalid character in header field name");return u.toLowerCase()}function i(u){return typeof u!="string"&&(u=String(u)),u}function n(u){this.map={},u instanceof n?u.forEach(function(m,E){this.append(E,m)},this):u&&Object.getOwnPropertyNames(u).forEach(function(m){this.append(m,u[m])},this)}n.prototype.append=function(u,m){u=r(u),m=i(m);var E=this.map[u];E||(E=[],this.map[u]=E),E.push(m)},n.prototype.delete=function(u){delete this.map[r(u)]},n.prototype.get=function(u){var m=this.map[r(u)];return m?m[0]:null},n.prototype.getAll=function(u){return this.map[r(u)]||[]},n.prototype.has=function(u){return this.map.hasOwnProperty(r(u))},n.prototype.set=function(u,m){this.map[r(u)]=[i(m)]},n.prototype.forEach=function(u,m){Object.getOwnPropertyNames(this.map).forEach(function(E){this.map[E].forEach(function(R){u.call(m,R,E,this)},this)},this)};function s(u){if(u.bodyUsed)return Promise.reject(new TypeError("Already read"));u.bodyUsed=!0}function o(u){return new Promise(function(m,E){u.onload=function(){m(u.result)},u.onerror=function(){E(u.error)}})}function l(u){var m=new FileReader;return m.readAsArrayBuffer(u),o(m)}function h(u,m){var E=new FileReader,R=m.headers.map["content-type"]?m.headers.map["content-type"].toString():"",A=/charset\=[0-9a-zA-Z\-\_]*;?/,I=u.type.match(A)||R.match(A),x=[u];return I&&x.push(I[0].replace(/^charset\=/,"").replace(/;$/,"")),E.readAsText.apply(E,x),o(E)}var f={blob:"FileReader"in t&&"Blob"in t&&function(){try{return new Blob,!0}catch(u){return!1}}(),formData:"FormData"in t,arrayBuffer:"ArrayBuffer"in t};function p(){return this.bodyUsed=!1,this._initBody=function(u,m){if(this._bodyInit=u,typeof u=="string")this._bodyText=u;else if(f.blob&&Blob.prototype.isPrototypeOf(u))this._bodyBlob=u,this._options=m;else if(f.formData&&FormData.prototype.isPrototypeOf(u))this._bodyFormData=u;else if(!u)this._bodyText="";else if(!(f.arrayBuffer&&ArrayBuffer.prototype.isPrototypeOf(u)))throw new Error("unsupported BodyInit type")},f.blob?(this.blob=function(){var u=s(this);if(u)return u;if(this._bodyBlob)return Promise.resolve(this._bodyBlob);if(this._bodyFormData)throw new Error("could not read FormData body as blob");return Promise.resolve(new Blob([this._bodyText]))},this.arrayBuffer=function(){return this.blob().then(l)},this.text=function(){var u=s(this);if(u)return u;if(this._bodyBlob)return h(this._bodyBlob,this._options);if(this._bodyFormData)throw new Error("could not read FormData body as text");return Promise.resolve(this._bodyText)}):this.text=function(){var u=s(this);return u||Promise.resolve(this._bodyText)},f.formData&&(this.formData=function(){return this.text().then(_)}),this.json=function(){return this.text().then(JSON.parse)},this}var g=["DELETE","GET","HEAD","OPTIONS","POST","PUT"];function y(u){var m=u.toUpperCase();return g.indexOf(m)>-1?m:u}function S(u,m){m=m||{};var E=m.body;if(S.prototype.isPrototypeOf(u)){if(u.bodyUsed)throw new TypeError("Already read");this.url=u.url,this.credentials=u.credentials,m.headers||(this.headers=new n(u.headers)),this.method=u.method,this.mode=u.mode,E||(E=u._bodyInit,u.bodyUsed=!0)}else this.url=u;if(this.credentials=m.credentials||this.credentials||"omit",(m.headers||!this.headers)&&(this.headers=new n(m.headers)),this.method=y(m.method||this.method||"GET"),this.mode=m.mode||this.mode||null,this.referrer=null,(this.method==="GET"||this.method==="HEAD")&&E)throw new TypeError("Body not allowed for GET or HEAD requests");this._initBody(E,m)}S.prototype.clone=function(){return new S(this)};function _(u){var m=new FormData;return u.trim().split("&").forEach(function(E){if(E){var R=E.split("="),A=R.shift().replace(/\+/g," "),I=R.join("=").replace(/\+/g," ");m.append(decodeURIComponent(A),decodeURIComponent(I))}}),m}function N(u){var m=new n,E=u.getAllResponseHeaders().trim().split(`
`);return E.forEach(function(R){var A=R.trim().split(":"),I=A.shift().trim(),x=A.join(":").trim();m.append(I,x)}),m}p.call(S.prototype);function c(u,m){m||(m={}),this._initBody(u,m),this.type="default",this.status=m.status,this.ok=this.status>=200&&this.status<300,this.statusText=m.statusText,this.headers=m.headers instanceof n?m.headers:new n(m.headers),this.url=m.url||""}p.call(c.prototype),c.prototype.clone=function(){return new c(this._bodyInit,{status:this.status,statusText:this.statusText,headers:new n(this.headers),url:this.url})},c.error=function(){var u=new c(null,{status:0,statusText:""});return u.type="error",u};var v=[301,302,303,307,308];c.redirect=function(u,m){if(v.indexOf(m)===-1)throw new RangeError("Invalid status code");return new c(null,{status:m,headers:{location:u}})},t.Headers=n,t.Request=S,t.Response=c,t.fetch=function(u,m){return new Promise(function(E,R){var A;S.prototype.isPrototypeOf(u)&&!m?A=u:A=new S(u,m);var I=new XMLHttpRequest;function x(){if("responseURL"in I)return I.responseURL;if(/^X-Request-URL:/m.test(I.getAllResponseHeaders()))return I.getResponseHeader("X-Request-URL")}var O=!1;function B(){if(I.readyState===4){var F=I.status===1223?204:I.status;if(F<100||F>599){if(O)return;O=!0,R(new TypeError("Network request failed"));return}var At={status:F,statusText:I.statusText,headers:N(I),url:x()},Se="response"in I?I.response:I.responseText;O||(O=!0,E(new c(Se,At)))}}I.onreadystatechange=B,I.onload=B,I.onerror=function(){O||(O=!0,R(new TypeError("Network request failed")))},I.open(A.method,A.url,!0);try{A.credentials==="include"&&("withCredentials"in I?I.withCredentials=!0:console&&console.warn&&console.warn("withCredentials is not supported, you can ignore this warning"))}catch(F){console&&console.warn&&console.warn("set withCredentials error:"+F)}"responseType"in I&&f.blob&&(I.responseType="blob"),A.headers.forEach(function(F,At){I.setRequestHeader(At,F)}),I.send(typeof A._bodyInit=="undefined"?null:A._bodyInit)})},t.fetch.polyfill=!0,e.exports&&(e.exports=t.fetch)})(typeof self!="undefined"?self:st)})(ke);var Ot={exports:{}};(function(e,t){(function(r,i){i(t,e)})(st,function(r,i){var n={timeout:5e3,jsonpCallback:"callback",jsonpCallbackFunction:null};function s(){return"jsonp_"+Date.now()+"_"+Math.ceil(Math.random()*1e5)}function o(f){try{delete window[f]}catch(p){window[f]=void 0}}function l(f){var p=document.getElementById(f);p&&document.getElementsByTagName("head")[0].removeChild(p)}function h(f){var p=arguments.length<=1||arguments[1]===void 0?{}:arguments[1],g=f,y=p.timeout||n.timeout,S=p.jsonpCallback||n.jsonpCallback,_=void 0;return new Promise(function(N,c){var v=p.jsonpCallbackFunction||s(),u=S+"_"+v;window[v]=function(E){N({ok:!0,json:function(){return Promise.resolve(E)}}),_&&clearTimeout(_),l(u),o(v)},g+=g.indexOf("?")===-1?"?":"&";var m=document.createElement("script");m.setAttribute("src",""+g+S+"="+v),p.charset&&m.setAttribute("charset",p.charset),m.id=u,document.getElementsByTagName("head")[0].appendChild(m),_=setTimeout(function(){c(new Error("JSONP request to "+f+" timed out")),o(v),l(u),window[v]=function(){o(v)}},y),m.onerror=function(){c(new Error("JSONP request to "+f+" failed")),o(v),l(u),_&&clearTimeout(_)}})}i.exports=h})})(Ot,Ot.exports);var Kt=Ot.exports;let Yt=window.fetch;a.setCORS=function(e){a.CORS=e};var He=a.isCORS=function(){return a.CORS!=null?a.CORS:window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest};a.setRequestTimeout=function(e){return a.RequestTimeout=e};var Qt=a.getRequestTimeout=function(){return a.RequestTimeout||45e3},rt=a.FetchRequest={commit:function(e,t,r,i){switch(e=e&&e.toUpperCase(),e){case"GET":return this.get(t,r,i);case"POST":return this.post(t,r,i);case"PUT":return this.put(t,r,i);case"DELETE":return this.delete(t,r,i);default:return this.get(t,r,i)}},supportDirectRequest:function(e,t){return T.isInTheSameDomain(e)?!0:t.crossOrigin!=null?t.crossOrigin:He()||t.proxy},get:function(e,t,r){r=r||{};var i="GET";if(e=T.urlAppend(e,this._getParameterString(t||{})),e=this._processUrl(e,r),!this.supportDirectRequest(e,r)){e=e.replace(".json",".jsonp");var n={url:e,data:t};return a.Util.RequestJSONPPromise.GET(n)}return this.urlIsLong(e)?this._postSimulatie(i,e.substring(0,e.indexOf("?")-1),t,r):this._fetch(e,t,r,i)},delete:function(e,t,r){r=r||{};var i="DELETE";if(e=T.urlAppend(e,this._getParameterString(t||{})),e=this._processUrl(e,r),!this.supportDirectRequest(e,r)){e=e.replace(".json",".jsonp");var n={url:e+="&_method=DELETE",data:t};return a.Util.RequestJSONPPromise.DELETE(n)}return this.urlIsLong(e)?this._postSimulatie(i,e.substring(0,e.indexOf("?")-1),t,r):this._fetch(e,t,r,i)},post:function(e,t,r){if(r=r||{},!this.supportDirectRequest(e,r)){e=e.replace(".json",".jsonp");var i={url:e+="&_method=POST",data:t};return a.Util.RequestJSONPPromise.POST(i)}return this._fetch(this._processUrl(e,r),t,r,"POST")},put:function(e,t,r){if(r=r||{},e=this._processUrl(e,r),!this.supportDirectRequest(e,r)){e=e.replace(".json",".jsonp");var i={url:e+="&_method=PUT",data:t};return a.Util.RequestJSONPPromise.PUT(i)}return this._fetch(e,t,r,"PUT")},urlIsLong:function(e){for(var t=0,r=null,i=0,n=e.length;i<n;i++)r=e.charCodeAt(i),r<127?t++:128<=r&&r<=2047?t+=2:2048<=r&&r<=65535&&(t+=3);return!(t<2e3)},_postSimulatie:function(e,t,r,i){var n=t.indexOf("?")>-1?"&":"?";return t+=n+"_method="+e,typeof r!="string"&&(r=JSON.stringify(r)),this.post(t,r,i)},_processUrl:function(e,t){if(this._isMVTRequest(e))return e;if(e.indexOf(".json")===-1&&!t.withoutFormatSuffix)if(e.indexOf("?")<0)e+=".json";else{var r=e.split("?");r.length===2&&(e=r[0]+".json?"+r[1])}return t&&t.proxy&&(typeof t.proxy=="function"?e=t.proxy(e):(e=decodeURIComponent(e),e=t.proxy+encodeURIComponent(e))),e},_fetch:function(e,t,r,i){return r=r||{},r.headers=r.headers||{},!r.headers["Content-Type"]&&!FormData.prototype.isPrototypeOf(t)&&(r.headers["Content-Type"]="application/x-www-form-urlencoded;charset=UTF-8"),r.timeout?this._timeout(r.timeout,Yt(e,{method:i,headers:r.headers,body:i==="PUT"||i==="POST"?t:void 0,credentials:this._getWithCredentials(r),mode:"cors",timeout:Qt()}).then(function(n){return n})):Yt(e,{method:i,body:i==="PUT"||i==="POST"?t:void 0,headers:r.headers,credentials:this._getWithCredentials(r),mode:"cors",timeout:Qt()}).then(function(n){return n})},_getWithCredentials:function(e){return e.withCredentials===!0?"include":e.withCredentials===!1?"omit":"same-origin"},_fetchJsonp:function(e,t){return t=t||{},Kt(e,{method:"GET",timeout:t.timeout}).then(function(r){return r})},_timeout:function(e,t){return new Promise(function(r,i){setTimeout(function(){i(new Error("timeout"))},e),t.then(r,i)})},_getParameterString:function(e){var t=[];for(var r in e){var i=e[r];if(i!=null&&typeof i!="function"){var n;Array.isArray(i)||i.toString()==="[object Object]"?n=encodeURIComponent(JSON.stringify(i)):n=encodeURIComponent(i),t.push(encodeURIComponent(r)+"="+n)}}return t.join("&")},_isMVTRequest:function(e){return e.indexOf(".mvt")>-1||e.indexOf(".pbf")>-1}};a.Util.RequestJSONPPromise={limitLength:1500,queryKeys:[],queryValues:[],supermap_callbacks:{},addQueryStrings:function(e){var t=this;for(var r in e){t.queryKeys.push(r),typeof e[r]!="string"&&(e[r]=a.Util.toJSON(e[r]));var i=encodeURIComponent(e[r]);t.queryValues.push(i)}},issue:function(e){for(var t=this,r=t.getUid(),i=e.url,n=[],s=new Promise(function(S){t.supermap_callbacks[r]=function(_){delete t.supermap_callbacks[r],S(_)}}),o=i,l=0,h=t.queryKeys?t.queryKeys.length:0,f=0;f<h;f++)if(o.length+t.queryKeys[f].length+2>=t.limitLength){if(l==0)return!1;n.push(o),o=i,l=0,f--}else if(o.length+t.queryKeys[f].length+2+t.queryValues[f].length>t.limitLength)for(var p=t.queryValues[f];p.length>0;){var g=t.limitLength-o.length-t.queryKeys[f].length-2;o.indexOf("?")>-1?o+="&":o+="?";var y=p.substring(0,g);y.substring(g-1,g)==="%"?(g-=1,y=p.substring(0,g)):y.substring(g-2,g-1)==="%"&&(g-=2,y=p.substring(0,g)),o+=t.queryKeys[f]+"="+y,p=p.substring(g),y.length>0&&(n.push(o),o=i,l=0)}else l++,o.indexOf("?")>-1?o+="&":o+="?",o+=t.queryKeys[f]+"="+t.queryValues[f];return n.push(o),t.send(n,"SuperMap.Util.RequestJSONPPromise.supermap_callbacks["+r+"]",e&&e.proxy),s},getUid:function(){var e=new Date().getTime(),t=Math.floor(Math.random()*1e17);return e*1e3+t},send:function(e,t,r){var i=e.length;if(i>0)for(var n=new Date().getTime(),s=0;s<i;s++){var o=e[s];o.indexOf("?")>-1?o+="&":o+="?",o+="sectionCount="+i,o+="&sectionIndex="+s,o+="&jsonpUserID="+n,r&&(o=decodeURIComponent(o),o=r+encodeURIComponent(o)),Kt(o,{jsonpCallbackFunction:t,timeout:3e4})}},GET:function(e){var t=this;return t.queryKeys.length=0,t.queryValues.length=0,t.addQueryStrings(e.params),t.issue(e)},POST:function(e){var t=this;return t.queryKeys.length=0,t.queryValues.length=0,t.addQueryStrings({requestEntity:e.data}),t.issue(e)},PUT:function(e){var t=this;return t.queryKeys.length=0,t.queryValues.length=0,t.addQueryStrings({requestEntity:e.data}),t.issue(e)},DELETE:function(e){var t=this;return t.queryKeys.length=0,t.queryValues.length=0,t.addQueryStrings({requestEntity:e.data}),t.issue(e)}};class ct{constructor(t,r){this.value=t||"",this.name=r||"token",this.CLASS_NAME="SuperMap.Credential"}getUrlParameters(){return this.name+"="+this.value}getValue(){return this.value}destroy(){this.value=null,this.name=null}}ct.CREDENTIAL=null;a.Credential=ct;class Y{static generateToken(t,r){var i=this.servers[t];if(!!i)return rt.post(i.tokenServiceUrl,JSON.stringify(r.toJSON())).then(function(n){return n.text()})}static registerServers(t){this.servers=this.servers||{},T.isArray(t)||(t=[t]);for(var r=0;r<t.length;r++){var i=t[r];this.servers[i.server]=i}}static registerToken(t,r){if(this.tokens=this.tokens||{},!(!t||!r)){var i=this._getTokenStorageKey(t);this.tokens[i]=r}}static registerKey(t,r){if(this.keys=this.keys||{},!(!t||t.length<1||!r)){t=T.isArray(t)?t:[t];for(var i=0;i<t.length;i++){var n=this._getUrlRestString(t[0])||t[0];this.keys[n]=r}}}static getServerInfo(t){return this.servers=this.servers||{},this.servers[t]}static getToken(t){if(!!t){this.tokens=this.tokens||{};var r=this._getTokenStorageKey(t);return this.tokens[r]}}static getKey(t){this.keys=this.keys||{};var r=this._getUrlRestString(t)||t;return this.keys[r]}static loginiServer(t,r,i,n){t=T.urlPathAppend(t,"services/security/login");var s={username:r&&r.toString(),password:i&&i.toString(),rememberme:n};s=JSON.stringify(s);var o={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"}};return rt.post(t,s,o).then(function(l){return l.json()})}static logoutiServer(t){t=T.urlPathAppend(t,"services/security/logout");var r={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withoutFormatSuffix:!0};return rt.get(t,"",r).then(function(){return!0}).catch(function(){return!1})}static loginOnline(t,r){var i=Y.SSO+"/login?service="+t;this._open(i,r)}static loginiPortal(t,r,i){t=T.urlPathAppend(t,"web/login");var n={username:r&&r.toString(),password:i&&i.toString()};n=JSON.stringify(n);var s={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!0};return rt.post(t,n,s).then(function(o){return o.json()})}static logoutiPortal(t){t=T.urlPathAppend(t,"services/security/logout");var r={headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},withCredentials:!0,withoutFormatSuffix:!0};return rt.get(t,"",r).then(function(){return!0}).catch(function(){return!1})}static loginManager(t,r,i){if(!T.isInTheSameDomain(t)){var n=i?i.isNewTab:!0;this._open(t,n);return}var s=T.urlPathAppend(t,"icloud/security/tokens"),o=r||{},l={username:o.userName&&o.userName.toString(),password:o.password&&o.password.toString()};l=JSON.stringify(l);var h={headers:{Accept:"*/*","Content-Type":"application/json"}},f=this;return rt.post(s,l,h).then(function(p){p.text().then(function(g){return f.imanagerToken=g,g})})}static destroyAllCredentials(){this.keys=null,this.tokens=null,this.servers=null}static destroyToken(t){if(!!t){var r=this._getTokenStorageKey(t);this.tokens=this.tokens||{},this.tokens[r]&&delete this.tokens[r]}}static destroyKey(t){if(!!t){this.keys=this.keys||{};var r=this._getUrlRestString(t)||t;this.keys[r]&&delete this.keys[r]}}static appendCredential(t){var r=t,i=this.getToken(t),n=i?new ct(i,"token"):null;return n||(i=this.getKey(t),n=i?new ct(i,"key"):null),n&&(r=T.urlAppend(r,n.getUrlParameters())),r}static _open(t,r){r=r!=null?r:!0;var i=window.screen.availWidth/2-this.INNER_WINDOW_WIDTH/2,n=window.screen.availHeight/2-this.INNER_WINDOW_HEIGHT/2,s="height="+this.INNER_WINDOW_HEIGHT+", width="+this.INNER_WINDOW_WIDTH+",top="+n+", left="+i+",toolbar=no, menubar=no, scrollbars=no, resizable=no, location=no, status=no";r?window.open(t,"login"):window.open(t,"login",s)}static _getTokenStorageKey(t){var r=/(.*?):\/\/([^\/]+)/i,i=t.match(r);return i?i[0]:t}static _getUrlRestString(t){if(!t)return t;var r=/(http|https):\/\/(.*\/rest)/i,i=t.match(r);return i?i[0]:t}}Y.INNER_WINDOW_WIDTH=600;Y.INNER_WINDOW_HEIGHT=600;Y.SSO="https://sso.supermap.com";Y.ONLINE="https://www.supermapol.com";a.SecurityManager=Y;a.DataFormat={GEOJSON:"GEOJSON",ISERVER:"ISERVER"};a.ServerType={ISERVER:"ISERVER",IPORTAL:"IPORTAL",ONLINE:"ONLINE"};var D=a.GeometryType={LINE:"LINE",LINEM:"LINEM",POINT:"POINT",REGION:"REGION",POINTEPS:"POINTEPS",LINEEPS:"LINEEPS",REGIONEPS:"REGIONEPS",ELLIPSE:"ELLIPSE",CIRCLE:"CIRCLE",TEXT:"TEXT",RECTANGLE:"RECTANGLE",UNKNOWN:"UNKNOWN",GEOCOMPOUND:"GEOCOMPOUND"};a.QueryOption={ATTRIBUTE:"ATTRIBUTE",ATTRIBUTEANDGEOMETRY:"ATTRIBUTEANDGEOMETRY",GEOMETRY:"GEOMETRY"};a.JoinType={INNERJOIN:"INNERJOIN",LEFTJOIN:"LEFTJOIN"};a.SpatialQueryMode={CONTAIN:"CONTAIN",CROSS:"CROSS",DISJOINT:"DISJOINT",IDENTITY:"IDENTITY",INTERSECT:"INTERSECT",NONE:"NONE",OVERLAP:"OVERLAP",TOUCH:"TOUCH",WITHIN:"WITHIN"};a.SpatialRelationType={CONTAIN:"CONTAIN",INTERSECT:"INTERSECT",WITHIN:"WITHIN"};a.MeasureMode={DISTANCE:"DISTANCE",AREA:"AREA"};var Q=a.Unit={METER:"METER",KILOMETER:"KILOMETER",MILE:"MILE",YARD:"YARD",DEGREE:"DEGREE",MILLIMETER:"MILLIMETER",CENTIMETER:"CENTIMETER",INCH:"INCH",DECIMETER:"DECIMETER",FOOT:"FOOT",SECOND:"SECOND",MINUTE:"MINUTE",RADIAN:"RADIAN"};a.BufferRadiusUnit={CENTIMETER:"CENTIMETER",DECIMETER:"DECIMETER",FOOT:"FOOT",INCH:"INCH",KILOMETER:"KILOMETER",METER:"METER",MILE:"MILE",MILLIMETER:"MILLIMETER",YARD:"YARD"};a.EngineType={IMAGEPLUGINS:"IMAGEPLUGINS",OGC:"OGC",ORACLEPLUS:"ORACLEPLUS",SDBPLUS:"SDBPLUS",SQLPLUS:"SQLPLUS",UDB:"UDB"};a.ThemeGraphTextFormat={CAPTION:"CAPTION",CAPTION_PERCENT:"CAPTION_PERCENT",CAPTION_VALUE:"CAPTION_VALUE",PERCENT:"PERCENT",VALUE:"VALUE"};a.ThemeGraphType={AREA:"AREA",BAR:"BAR",BAR3D:"BAR3D",LINE:"LINE",PIE:"PIE",PIE3D:"PIE3D",POINT:"POINT",RING:"RING",ROSE:"ROSE",ROSE3D:"ROSE3D",STACK_BAR:"STACK_BAR",STACK_BAR3D:"STACK_BAR3D",STEP:"STEP"};a.GraphAxesTextDisplayMode={ALL:"ALL",NONE:"NONE",YAXES:"YAXES"};a.GraduatedMode={CONSTANT:"CONSTANT",LOGARITHM:"LOGARITHM",SQUAREROOT:"SQUAREROOT"};a.RangeMode={CUSTOMINTERVAL:"CUSTOMINTERVAL",EQUALINTERVAL:"EQUALINTERVAL",LOGARITHM:"LOGARITHM",QUANTILE:"QUANTILE",SQUAREROOT:"SQUAREROOT",STDDEVIATION:"STDDEVIATION"};a.ThemeType={DOTDENSITY:"DOTDENSITY",GRADUATEDSYMBOL:"GRADUATEDSYMBOL",GRAPH:"GRAPH",LABEL:"LABEL",RANGE:"RANGE",UNIQUE:"UNIQUE"};a.ColorGradientType={BLACK_WHITE:"BLACKWHITE",BLUE_BLACK:"BLUEBLACK",BLUE_RED:"BLUERED",BLUE_WHITE:"BLUEWHITE",CYAN_BLACK:"CYANBLACK",CYAN_BLUE:"CYANBLUE",CYAN_GREEN:"CYANGREEN",CYAN_WHITE:"CYANWHITE",GREEN_BLACK:"GREENBLACK",GREEN_BLUE:"GREENBLUE",GREEN_ORANGE_VIOLET:"GREENORANGEVIOLET",GREEN_RED:"GREENRED",GREEN_WHITE:"GREENWHITE",PINK_BLACK:"PINKBLACK",PINK_BLUE:"PINKBLUE",PINK_RED:"PINKRED",PINK_WHITE:"PINKWHITE",RAIN_BOW:"RAINBOW",RED_BLACK:"REDBLACK",RED_WHITE:"REDWHITE",SPECTRUM:"SPECTRUM",TERRAIN:"TERRAIN",YELLOW_BLACK:"YELLOWBLACK",YELLOW_BLUE:"YELLOWBLUE",YELLOW_GREEN:"YELLOWGREEN",YELLOW_RED:"YELLOWRED",YELLOW_WHITE:"YELLOWWHITE"};a.TextAlignment={TOPLEFT:"TOPLEFT",TOPCENTER:"TOPCENTER",TOPRIGHT:"TOPRIGHT",BASELINELEFT:"BASELINELEFT",BASELINECENTER:"BASELINECENTER",BASELINERIGHT:"BASELINERIGHT",BOTTOMLEFT:"BOTTOMLEFT",BOTTOMCENTER:"BOTTOMCENTER",BOTTOMRIGHT:"BOTTOMRIGHT",MIDDLELEFT:"MIDDLELEFT",MIDDLECENTER:"MIDDLECENTER",MIDDLERIGHT:"MIDDLERIGHT"};a.FillGradientMode={NONE:"NONE",LINEAR:"LINEAR",RADIAL:"RADIAL",CONICAL:"CONICAL",SQUARE:"SQUARE"};a.AlongLineDirection={NORMAL:"ALONG_LINE_NORMAL",LB_TO_RT:"LEFT_BOTTOM_TO_RIGHT_TOP",LT_TO_RB:"LEFT_TOP_TO_RIGHT_BOTTOM",RB_TO_LT:"RIGHT_BOTTOM_TO_LEFT_TOP",RT_TO_LB:"RIGHT_TOP_TO_LEFT_BOTTOM"};a.LabelBackShape={DIAMOND:"DIAMOND",ELLIPSE:"ELLIPSE",MARKER:"MARKER",NONE:"NONE",RECT:"RECT",ROUNDRECT:"ROUNDRECT",TRIANGLE:"TRIANGLE"};a.LabelOverLengthMode={NEWLINE:"NEWLINE",NONE:"NONE",OMIT:"OMIT"};a.DirectionType={EAST:"EAST",NONE:"NONE",NORTH:"NORTH",SOURTH:"SOURTH",WEST:"WEST"};a.SideType={LEFT:"LEFT",MIDDLE:"MIDDLE",NONE:"NONE",RIGHT:"RIGHT"};a.SupplyCenterType={FIXEDCENTER:"FIXEDCENTER",NULL:"NULL",OPTIONALCENTER:"OPTIONALCENTER"};a.TurnType={AHEAD:"AHEAD",BACK:"BACK",END:"END",LEFT:"LEFT",NONE:"NONE",RIGHT:"RIGHT"};a.BufferEndType={FLAT:"FLAT",ROUND:"ROUND"};a.OverlayOperationType={CLIP:"CLIP",ERASE:"ERASE",IDENTITY:"IDENTITY",INTERSECT:"INTERSECT",UNION:"UNION",UPDATE:"UPDATE",XOR:"XOR"};a.OutputType={INDEXEDHDFS:"INDEXEDHDFS",UDB:"UDB",MONGODB:"MONGODB",PG:"PG"};a.SmoothMethod={BSPLINE:"BSPLINE",POLISH:"POLISH"};a.SurfaceAnalystMethod={ISOLINE:"ISOLINE",ISOREGION:"ISOREGION"};a.DataReturnMode={DATASET_AND_RECORDSET:"DATASET_AND_RECORDSET",DATASET_ONLY:"DATASET_ONLY",RECORDSET_ONLY:"RECORDSET_ONLY"};a.EditType={ADD:"add",UPDATE:"update",DELETE:"delete"};a.TransferTactic={LESS_TIME:"LESS_TIME",LESS_TRANSFER:"LESS_TRANSFER",LESS_WALK:"LESS_WALK",MIN_DISTANCE:"MIN_DISTANCE"};a.TransferPreference={BUS:"BUS",SUBWAY:"SUBWAY",NO_SUBWAY:"NO_SUBWAY",NONE:"NONE"};a.GridType={CROSS:"CROSS",GRID:"GRID",POINT:"POINT"};a.ColorSpaceType={CMYK:"CMYK",RGB:"RGB"};a.LayerType={UGC:"UGC",WMS:"WMS",WFS:"WFS",CUSTOM:"CUSTOM"};a.UGCLayerType={THEME:"THEME",VECTOR:"VECTOR",GRID:"GRID",IMAGE:"IMAGE"};a.StatisticMode={AVERAGE:"AVERAGE",MAX:"MAX",MIN:"MIN",STDDEVIATION:"STDDEVIATION",SUM:"SUM",VARIANCE:"VARIANCE"};a.PixelFormat={BIT16:"BIT16",BIT32:"BIT32",BIT64:"BIT64",SINGLE:"SINGLE",DOUBLE:"DOUBLE",UBIT1:"UBIT1",UBIT4:"UBIT4",UBIT8:"UBIT8",UBIT24:"UBIT24",UBIT32:"UBIT32"};a.SearchMode={KDTREE_FIXED_COUNT:"KDTREE_FIXED_COUNT",KDTREE_FIXED_RADIUS:"KDTREE_FIXED_RADIUS",NONE:"NONE",QUADTREE:"QUADTREE"};a.InterpolationAlgorithmType={KRIGING:"KRIGING",SimpleKriging:"SimpleKriging",UniversalKriging:"UniversalKriging"};a.VariogramMode={EXPONENTIAL:"EXPONENTIAL",GAUSSIAN:"GAUSSIAN",SPHERICAL:"SPHERICAL"};a.Exponent={EXP1:"EXP1",EXP2:"EXP2"};a.ClientType={IP:"IP",REFERER:"Referer",REQUESTIP:"RequestIP",NONE:"NONE",SERVER:"SERVER",WEB:"WEB"};a.ChartType={BAR:"Bar",BAR3D:"Bar3D",CIRCLE:"Circle",PIE:"Pie",POINT:"Point",LINE:"Line",RING:"Ring"};a.ClipAnalystMode={CLIP:"clip",INTERSECT:"intersect"};a.AnalystAreaUnit={SQUAREMETER:"SquareMeter",SQUAREKILOMETER:"SquareKiloMeter",HECTARE:"Hectare",ARE:"Are",ACRE:"Acre",SQUAREFOOT:"SquareFoot",SQUAREYARD:"SquareYard",SQUAREMILE:"SquareMile"};a.AnalystSizeUnit={METER:"Meter",KILOMETER:"Kilometer",YARD:"Yard",FOOT:"Foot",MILE:"Mile"};a.StatisticAnalystMode={MAX:"max",MIN:"min",AVERAGE:"average",SUM:"sum",VARIANCE:"variance",STDDEVIATION:"stdDeviation"};a.SummaryType={SUMMARYMESH:"SUMMARYMESH",SUMMARYREGION:"SUMMARYREGION"};a.TopologyValidatorRule={REGIONNOOVERLAP:"REGIONNOOVERLAP",REGIONNOOVERLAPWITH:"REGIONNOOVERLAPWITH",REGIONCONTAINEDBYREGION:"REGIONCONTAINEDBYREGION",REGIONCOVEREDBYREGION:"REGIONCOVEREDBYREGION",LINENOOVERLAP:"LINENOOVERLAP",LINENOOVERLAPWITH:"LINENOOVERLAPWITH",POINTNOIDENTICAL:"POINTNOIDENTICAL"};a.BucketAggType={GEOHASH_GRID:"geohash_grid"};a.MetricsAggType={AVG:"avg",MAX:"max",MIN:"min",SUM:"sum"};a.GetFeatureMode={BOUNDS:"BOUNDS",BUFFER:"BUFFER",ID:"ID",SPATIAL:"SPATIAL",SQL:"SQL"};a.RasterFunctionType={NDVI:"NDVI",HILLSHADE:"HILLSHADE"};a.ResourceType={MAP:"MAP",SERVICE:"SERVICE",SCENE:"SCENE",DATA:"DATA",INSIGHTS_WORKSPACE:"INSIGHTS_WORKSPACE",MAP_DASHBOARD:"MAP_DASHBOARD"};a.OrderBy={UPDATETIME:"UPDATETIME",HEATLEVEL:"HEATLEVEL",RELEVANCE:"RELEVANCE"};a.OrderType={ASC:"ASC",DESC:"DESC"};a.SearchType={PUBLIC:"PUBLIC",MY_RES:"MY_RES",MYGROUP_RES:"MYGROUP_RES",MYDEPARTMENT_RES:"MYDEPARTMENT_RES",SHARETOME_RES:"SHARETOME_RES"};a.AggregationTypes={TAG:"TAG",TYPE:"TYPE"};a.PermissionType={SEARCH:"SEARCH",READ:"READ",READWRITE:"READWRITE",DELETE:"DELETE",DOWNLOAD:"DOWNLOAD"};a.EntityType={DEPARTMENT:"DEPARTMENT",GROUP:"GROUP",IPORTALGROUP:"IPORTALGROUP",ROLE:"ROLE",USER:"USER"};a.DataItemType={WORKSPACE:"WORKSPACE",UDB:"UDB",SHP:"SHP",EXCEL:"EXCEL",CSV:"CSV",GEOJSON:"GEOJSON",SMTILES:"SMTILES",SVTILES:"SVTILES",MBTILES:"MBTILES",TPK:"TPK",UGCV5:"UGCV5",UGCV5_MVT:"UGCV5_MVT",JSON:"JSON"};a.WebExportFormatType={PNG:"PNG",PDF:"PDF"};a.WebScaleOrientationType={HORIZONTALLABELSBELOW:"HORIZONTALLABELSBELOW",HORIZONTALLABELSABOVE:"HORIZONTALLABELSABOVE",VERTICALLABELSLEFT:"VERTICALLABELSLEFT",VERTICALLABELSRIGHT:"VERTICALLABELSRIGHT"};a.WebScaleType={LINE:"LINE",BAR:"BAR",BAR_SUB:"BAR_SUB"};a.WebScaleUnit={METER:"METER",FOOT:"FOOT",DEGREES:"DEGREES"};class lt{constructor(){this.CLASS_NAME="SuperMap.Geometry",this.id=T.createUniqueID(this.CLASS_NAME+"_"),this.parent=null,this.bounds=null,this.SRID=null}destroy(){this.id=null,this.bounds=null,this.SRID=null}clone(){return new lt}setBounds(t){t&&(this.bounds=t.clone())}clearBounds(){this.bounds=null,this.parent&&this.parent.clearBounds()}extendBounds(t){var r=this.getBounds();r?this.bounds.extend(t):this.setBounds(t)}getBounds(){return this.bounds==null&&this.calculateBounds(),this.bounds}calculateBounds(){}getVertices(t){}getArea(){return 0}}a.Geometry=lt;class ft{constructor(t,r){this.w=t?parseFloat(t):0,this.h=t?parseFloat(r):0,this.CLASS_NAME="SuperMap.Size"}toString(){return"w="+this.w+",h="+this.h}clone(){return new ft(this.w,this.h)}equals(t){var r=!1;return t!=null&&(r=this.w===t.w&&this.h===t.h||isNaN(this.w)&&isNaN(this.h)&&isNaN(t.w)&&isNaN(t.h)),r}destroy(){this.w=null,this.h=null}}a.Size=ft;class ut{constructor(t,r,i){this.x=t?parseFloat(t):0,this.y=r?parseFloat(r):0,this.mode=i,this.CLASS_NAME="SuperMap.Pixel",a.Pixel.Mode={LeftTop:"lefttop",RightTop:"righttop",RightBottom:"rightbottom",LeftBottom:"leftbottom"}}toString(){return"x="+this.x+",y="+this.y}clone(){return new ut(this.x,this.y,this.mode)}equals(t){var r=!1;return t!=null&&(r=this.x==t.x&&this.y==t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),r}distanceTo(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))}add(t,r){if(t==null||r==null)throw new TypeError("Pixel.add cannot receive null values");return new ut(this.x+t,this.y+r)}offset(t){var r=this.clone();return t&&(r=this.add(t.x,t.y)),r}destroy(){this.x=null,this.y=null,this.mode=null}}a.Pixel=ut;class it{constructor(t,r){T.isArray(t)&&(r=t[1],t=t[0]),this.lon=t?T.toFloat(t):0,this.lat=r?T.toFloat(r):0,this.CLASS_NAME="SuperMap.LonLat"}toString(){return"lon="+this.lon+",lat="+this.lat}toShortString(){return this.lon+","+this.lat}clone(){return new it(this.lon,this.lat)}add(t,r){if(t==null||r==null)throw new TypeError("LonLat.add cannot receive null values");return new it(this.lon+T.toFloat(t),this.lat+T.toFloat(r))}equals(t){var r=!1;return t!=null&&(r=this.lon===t.lon&&this.lat===t.lat||isNaN(this.lon)&&isNaN(this.lat)&&isNaN(t.lon)&&isNaN(t.lat)),r}wrapDateLine(t){var r=this.clone();if(t){for(;r.lon<t.left;)r.lon+=t.getWidth();for(;r.lon>t.right;)r.lon-=t.getWidth()}return r}destroy(){this.lon=null,this.lat=null}static fromString(t){var r=t.split(",");return new it(r[0],r[1])}static fromArray(t){var r=T.isArray(t),i=r&&t[0],n=r&&t[1];return new it(i,n)}}class G{constructor(t,r,i,n){T.isArray(t)&&(n=t[3],i=t[2],r=t[1],t=t[0]),this.left=t!=null?T.toFloat(t):this.left,this.bottom=r!=null?T.toFloat(r):this.bottom,this.right=i!=null?T.toFloat(i):this.right,this.top=n!=null?T.toFloat(n):this.top,this.centerLonLat=null,this.CLASS_NAME="SuperMap.Bounds"}clone(){return new G(this.left,this.bottom,this.right,this.top)}equals(t){var r=!1;return t!=null&&(r=this.left===t.left&&this.right===t.right&&this.top===t.top&&this.bottom===t.bottom),r}toString(){return[this.left,this.bottom,this.right,this.top].join(",")}toArray(t){return t===!0?[this.bottom,this.left,this.top,this.right]:[this.left,this.bottom,this.right,this.top]}toBBOX(t,r){t==null&&(t=6);var i=Math.pow(10,t),n=Math.round(this.left*i)/i,s=Math.round(this.bottom*i)/i,o=Math.round(this.right*i)/i,l=Math.round(this.top*i)/i;return r===!0?s+","+n+","+l+","+o:n+","+s+","+o+","+l}getWidth(){return this.right-this.left}getHeight(){return this.top-this.bottom}getSize(){return new ft(this.getWidth(),this.getHeight())}getCenterPixel(){return new ut((this.left+this.right)/2,(this.bottom+this.top)/2)}getCenterLonLat(){return this.centerLonLat||(this.centerLonLat=new it((this.left+this.right)/2,(this.bottom+this.top)/2)),this.centerLonLat}scale(t,r){t=t||1,r==null&&(r=this.getCenterLonLat());var i,n;r.CLASS_NAME==="SuperMap.LonLat"?(i=r.lon,n=r.lat):(i=r.x,n=r.y);var s=(this.left-i)*t+i,o=(this.bottom-n)*t+n,l=(this.right-i)*t+i,h=(this.top-n)*t+n;return new G(s,o,l,h)}add(t,r){if(t==null||r==null)throw new TypeError("Bounds.add cannot receive null values");return new G(this.left+t,this.bottom+r,this.right+t,this.top+r)}extend(t){var r=null;if(t){switch(t.CLASS_NAME){case"SuperMap.LonLat":r=new G(t.lon,t.lat,t.lon,t.lat);break;case"SuperMap.Geometry.Point":r=new G(t.x,t.y,t.x,t.y);break;case"SuperMap.Bounds":r=t;break}r&&(this.centerLonLat=null,(this.left==null||r.left<this.left)&&(this.left=r.left),(this.bottom==null||r.bottom<this.bottom)&&(this.bottom=r.bottom),(this.right==null||r.right>this.right)&&(this.right=r.right),(this.top==null||r.top>this.top)&&(this.top=r.top))}}containsLonLat(t,r){typeof r=="boolean"&&(r={inclusive:r}),r=r||{};var i=this.contains(t.lon,t.lat,r.inclusive),n=r.worldBounds;if(n&&!i){var s=n.getWidth(),o=(n.left+n.right)/2,l=Math.round((t.lon-o)/s);i=this.containsLonLat({lon:t.lon-l*s,lat:t.lat},{inclusive:r.inclusive})}return i}containsPixel(t,r){return this.contains(t.x,t.y,r)}contains(t,r,i){if(i==null&&(i=!0),t==null||r==null)return!1;var n=!1;return i?n=t>=this.left&&t<=this.right&&r>=this.bottom&&r<=this.top:n=t>this.left&&t<this.right&&r>this.bottom&&r<this.top,n}intersectsBounds(t,r){if(typeof r=="boolean"&&(r={inclusive:r}),r=r||{},r.worldBounds){var i=this.wrapDateLine(r.worldBounds);t=t.wrapDateLine(r.worldBounds)}else i=this;r.inclusive==null&&(r.inclusive=!0);var n=!1,s=i.left===t.right||i.right===t.left||i.top===t.bottom||i.bottom===t.top;if(r.inclusive||!s){var o=t.bottom>=i.bottom&&t.bottom<=i.top||i.bottom>=t.bottom&&i.bottom<=t.top,l=t.top>=i.bottom&&t.top<=i.top||i.top>t.bottom&&i.top<t.top,h=t.left>=i.left&&t.left<=i.right||i.left>=t.left&&i.left<=t.right,f=t.right>=i.left&&t.right<=i.right||i.right>=t.left&&i.right<=t.right;n=(o||l)&&(h||f)}if(r.worldBounds&&!n){var p=r.worldBounds,g=p.getWidth(),y=!p.containsBounds(i),S=!p.containsBounds(t);y&&!S?(t=t.add(-g,0),n=i.intersectsBounds(t,{inclusive:r.inclusive})):S&&!y&&(i=i.add(-g,0),n=t.intersectsBounds(i,{inclusive:r.inclusive}))}return n}containsBounds(t,r,i){r==null&&(r=!1),i==null&&(i=!0);var n=this.contains(t.left,t.bottom,i),s=this.contains(t.right,t.bottom,i),o=this.contains(t.left,t.top,i),l=this.contains(t.right,t.top,i);return r?n||s||o||l:n&&s&&o&&l}determineQuadrant(t){var r="",i=this.getCenterLonLat();return r+=t.lat<i.lat?"b":"t",r+=t.lon<i.lon?"l":"r",r}wrapDateLine(t,r){r=r||{};var i=r.leftTolerance||0,n=r.rightTolerance||0,s=this.clone();if(t){for(var o=t.getWidth();s.left<t.left&&s.right-n<=t.left;)s=s.add(o,0);for(;s.left+i>=t.right&&s.right>t.right;)s=s.add(-o,0);var l=s.left+i;l<t.right&&l>t.left&&s.right-n>t.right&&(s=s.add(-o,0))}return s}toServerJSONObject(){var t={rightTop:{x:this.right,y:this.top},leftBottom:{x:this.left,y:this.bottom},left:this.left,right:this.right,top:this.top,bottom:this.bottom};return t}destroy(){this.left=null,this.right=null,this.top=null,this.bottom=null,this.centerLonLat=null}static fromString(t,r){var i=t.split(",");return G.fromArray(i,r)}static fromArray(t,r){return r===!0?new G(t[1],t[0],t[3],t[2]):new G(t[0],t[1],t[2],t[3])}static fromSize(t){return new G(0,t.h,t.w,0)}static oppositeQuadrant(t){var r="";return r+=t.charAt(0)==="t"?"b":"t",r+=t.charAt(1)==="l"?"r":"l",r}}a.Bounds=G;class C extends lt{constructor(t,r,i,n){super(t,r,i,n);this.x=parseFloat(t),this.y=parseFloat(r),this.tag=n||n==0?parseFloat(n):null,this.type=i||"Point",this.CLASS_NAME="SuperMap.Geometry.Point",this.geometryType="Point"}clone(t){return t==null&&(t=new C(this.x,this.y)),T.applyDefaults(t,this),t}calculateBounds(){this.bounds=new G(this.x,this.y,this.x,this.y)}equals(t){var r=!1;return t!=null&&(r=this.x===t.x&&this.y===t.y||isNaN(this.x)&&isNaN(this.y)&&isNaN(t.x)&&isNaN(t.y)),r}move(t,r){this.x=this.x+t,this.y=this.y+r,this.clearBounds()}toShortString(){return this.x+", "+this.y}destroy(){this.x=null,this.y=null,this.tag=null,super.destroy()}getVertices(t){return[this]}}a.Geometry.Point=C;class J extends lt{constructor(t){super();this.components=[],this.componentTypes=null,t!=null&&this.addComponents(t),this.CLASS_NAME="SuperMap.Geometry.Collection",this.geometryType="Collection"}destroy(){this.components.length=0,this.components=null,super.destroy()}clone(){for(var t=new J,r=0,i=this.components.length;r<i;r++)t.addComponent(this.components[r].clone());return T.applyDefaults(t,this),t}getComponentsString(){for(var t=[],r=0,i=this.components.length;r<i;r++)t.push(this.components[r].toShortString());return t.join(",")}calculateBounds(){this.bounds=null;var t=new G,r=this.components;if(r)for(var i=0,n=r.length;i<n;i++)t.extend(r[i].getBounds());t.left!=null&&t.bottom!=null&&t.right!=null&&t.top!=null&&this.setBounds(t)}addComponents(t){T.isArray(t)||(t=[t]);for(var r=0,i=t.length;r<i;r++)this.addComponent(t[r])}addComponent(t,r){var i=!1;if(t&&(this.componentTypes==null||T.indexOf(this.componentTypes,t.CLASS_NAME)>-1)){if(r!=null&&r<this.components.length){var n=this.components.slice(0,r),s=this.components.slice(r,this.components.length);n.push(t),this.components=n.concat(s)}else this.components.push(t);t.parent=this,this.clearBounds(),i=!0}return i}removeComponents(t){var r=!1;T.isArray(t)||(t=[t]);for(var i=t.length-1;i>=0;--i)r=this.removeComponent(t[i])||r;return r}removeComponent(t){return T.removeItem(this.components,t),this.clearBounds(),!0}getArea(){for(var t=0,r=0,i=this.components.length;r<i;r++)t+=this.components[r].getArea();return t}equals(t){var r=!0;if(!t||!t.CLASS_NAME||this.CLASS_NAME!==t.CLASS_NAME)r=!1;else if(!T.isArray(t.components)||t.components.length!==this.components.length)r=!1;else for(var i=0,n=this.components.length;i<n;++i)if(!this.components[i].equals(t.components[i])){r=!1;break}return r}getVertices(t){for(var r=[],i=0,n=this.components.length;i<n;++i)Array.prototype.push.apply(r,this.components[i].getVertices(t));return r}}a.Geometry.Collection=J;class ht extends J{constructor(t){super(t);this.componentTypes=["SuperMap.Geometry.Point"],this.CLASS_NAME="SuperMap.Geometry.MultiPoint",this.geometryType="MultiPoint"}addPoint(t,r){this.addComponent(t,r)}removePoint(t){this.removeComponent(t)}}a.Geometry.MultiPoint=ht;class Xt extends ht{constructor(t){super(t);this.componentTypes=["SuperMap.Geometry.Point","SuperMap.PointWithMeasure"],this.CLASS_NAME="SuperMap.Geometry.Curve",this.geometryType="Curve"}}a.Geometry.Curve=Xt;class w extends Xt{constructor(t){super(t);this.CLASS_NAME="SuperMap.Geometry.LineString",this.geometryType="LineString"}removeComponent(t){var r=this.components&&this.components.length>2;return r&&super.removeComponent.apply(this,arguments),r}getSortedSegments(){for(var t=this.components.length-1,r=new Array(t),i,n,s=0;s<t;++s)i=this.components[s],n=this.components[s+1],i.x<n.x?r[s]={x1:i.x,y1:i.y,x2:n.x,y2:n.y}:r[s]={x1:n.x,y1:n.y,x2:i.x,y2:i.y};function o(l,h){return l.x1-h.x1}return r.sort(o)}getVertices(t){var r;return t===!0?r=[this.components[0],this.components[this.components.length-1]]:t===!1?r=this.components.slice(1,this.components.length-1):r=this.components.slice(),r}static calculateCircle(t){if(t.length<3)return t;var r={},i=t[0],n=t[1],s=t[2],o=0,l=0,h=!0,f=0,p=0,g=0,y=72,S=[],_=(s.y-i.y)/(s.x-i.x),N=s.y-_*s.x;if(s.x!=i.x&&s.y!=i.y&&n.y==_*n.x+N||s.x==i.x&&n.x==i.x||s.y==i.y&&n.y==i.y||s.x==i.x&&s.y==i.y||s.x==n.x&&s.y==n.y||i.x==n.x&&i.y==n.y)S.push(i),S.push(n),S.push(s);else{var c=(n.x*n.x+n.y*n.y-(i.x*i.x+i.y*i.y))*(2*(s.y-i.y))-(s.x*s.x+s.y*s.y-(i.x*i.x+i.y*i.y))*(2*(n.y-i.y)),v=2*(n.x-i.x)*(s.x*s.x+s.y*s.y-(i.x*i.x+i.y*i.y))-2*(s.x-i.x)*(n.x*n.x+n.y*n.y-(i.x*i.x+i.y*i.y)),u=4*((n.x-i.x)*(s.y-i.y)-(s.x-i.x)*(n.y-i.y));r.x=c/u,r.y=v/u,o=Math.sqrt((i.x-r.x)*(i.x-r.x)+(i.y-r.y)*(i.y-r.y));var m=(i.x-s.x)*(i.x-s.x)+(i.y-s.y)*(i.y-s.y),E=(2*o*o-m)/(2*o*o);E=E>=1?1:E,E=E<=-1?-1:E,g=Math.acos(E)*180/Math.PI,s.x==i.x?g=r.x>i.x&&n.x>i.x||r.x<i.x&&n.x<i.x?360-g:g:g=r.y>_*r.x+N&&n.y>_*n.x+N||r.y<_*r.x+N&&n.y<_*n.x+N?360-g:g,l=g/72,s.y!=i.y?s.x==i.x?s.y>i.y?n.x<i.x&&(h=!1):n.x>i.x&&(h=!1):s.x<i.x?n.y<_*n.x+N&&(h=!1):n.y>_*n.x+N&&(h=!1):s.x>i.x?n.y>i.y&&(h=!1):n.y<i.y&&(h=!1);var R=(i.y-r.y)/(i.x-r.x),A=R>=0?Math.atan(R)*180/Math.PI:Math.abs(Math.atan(R)*180/Math.PI)+90,I=Math.abs(r.y);i.y==I&&I==s.y&&i.x<s.x&&(A=A+180);var x=i.y-r.y;S.push(i);for(var O=1;O<y;O++){f=l*O,p=A,h?x>=0?R>=0?p=p+f:p=180-(p-90)+f:R>0?p=p-180+f:p=90-p+f:x>=0?R>=0?p=p-f:p=180-(p-90)-f:R>=0?p=p-180-f:p=90-p-f,p=p*Math.PI/180;var B=r.x+o*Math.cos(p),F=r.y+o*Math.sin(p);S.push(new C(B,F))}S.push(s)}return S}static createLineEPS(t){var r=[],i=t.length;if(i<2)return t;for(var n=0;n<i;){var s=t[n].type;if(s=="LTypeArc"){var o=w.createLineArc(r,n,i,t);r=o[0],n=o[1]}else r.push(t[n]),n++}return r}static createLineArc(t,r,i,n){if(r==0){let l=w.addPointEPS(n,r,i,"LTypeArc");Array.prototype.push.apply(t,l[0]),r=l[1]+1}else if(r==i-1){var s=[n[r-1],n[r]],o=w.calculateCircle(s);Array.prototype.push.apply(t,o),r++}else{let l=w.addPointEPS(n,r,i,"LTypeArc");t.pop(),Array.prototype.push.apply(t,l[0]),r=l[1]+1}return[t,r]}static addPointEPS(t,r,i,n){var s=[],o=r+1;r==0?Array.prototype.push.apply(s,[t[r],t[r+1]]):r==i-1?Array.prototype.push.apply(s,[t[r-1],t[r]]):Array.prototype.push.apply(s,[t[r-1],t[r],t[r+1]]);var l;return n=="LTypeCurve"?l=w.calculatePointsFBZN(s):n=="LTypeArc"&&(l=w.calculateCircle(s)),[l,o]}}a.Geometry.LineString=w;class q extends w{constructor(t){super(t);this.componentTypes=["SuperMap.Geometry.Point"],this.CLASS_NAME="SuperMap.Geometry.LinearRing",this.geometryType="LinearRing"}addComponent(t,r){var i=!1,n=this.components.pop();(r!=null||!t.equals(n))&&(i=super.addComponent.apply(this,arguments));var s=this.components[0];return super.addComponent.apply(this,[s]),i}removeComponent(t){var r=this.components&&this.components.length>3;if(r){this.components.pop(),super.removeComponent.apply(this,arguments);var i=this.components[0];super.addComponent.apply(this,[i])}return r}getArea(){var t=0;if(this.components&&this.components.length>2){for(var r=0,i=0,n=this.components.length;i<n-1;i++){var s=this.components[i],o=this.components[i+1];r+=(s.x+o.x)*(o.y-s.y)}t=-r/2}return t}getVertices(t){return t===!0?[]:this.components.slice(0,this.components.length-1)}}a.Geometry.LinearRing=q;class pt extends J{constructor(t){super(t);this.componentTypes=["SuperMap.Geometry.LineString"],this.CLASS_NAME="SuperMap.Geometry.MultiLineString",this.geometryType="MultiLineString"}}a.Geometry.MultiLineString=pt;class z extends J{constructor(t){super(t);this.componentTypes=["SuperMap.Geometry.LinearRing"],this.CLASS_NAME="SuperMap.Geometry.Polygon",this.geometryType="Polygon"}getArea(){var t=0;if(this.components&&this.components.length>0){t+=Math.abs(this.components[0].getArea());for(var r=1,i=this.components.length;r<i;r++)t-=Math.abs(this.components[r].getArea())}return t}}a.Geometry.Polygon=z;class j extends J{constructor(t){super(t);this.componentTypes=["SuperMap.Geometry.Polygon"],this.CLASS_NAME="SuperMap.Geometry.MultiPolygon",this.geometryType="MultiPolygon"}}a.Geometry.MultiPolygon=j;class V{constructor(t,r,i){this.red=!t&&t!=0?255:t,this.green=r||0,this.blue=i||0,this.CLASS_NAME="SuperMap.ServerColor"}destroy(){var t=this;t.red=null,t.green=null,t.blue=null}static fromJson(t){if(!!t){var r=new V,i=255;t.red!==null&&(i=Number(t.red)),r.red=i;var n=0;t.green!==null&&(n=Number(t.green)),r.green=n;var s=0;return t.blue!==null&&(s=Number(t.blue)),r.blue=s,r}}}a.ServerColor=V;class dt{constructor(t){this.fillBackColor=new V(255,255,255),this.fillBackOpaque=!1,this.fillForeColor=new V(255,0,0),this.fillGradientMode=null,this.fillGradientAngle=0,this.fillGradientOffsetRatioX=0,this.fillGradientOffsetRatioY=0,this.fillOpaqueRate=100,this.fillSymbolID=0,this.lineColor=new V(0,0,0),this.lineSymbolID=0,this.lineWidth=1,this.markerAngle=0,this.markerSize=1,this.markerSymbolID=-1,t&&T.extend(this,t),this.CLASS_NAME="SuperMap.ServerStyle"}destroy(){var t=this;t.fillBackColor&&(t.fillBackColor.destroy(),t.fillBackColor=null),t.fillBackOpaque=null,t.fillForeColor&&(t.fillForeColor.destroy(),t.fillForeColor=null),t.fillGradientMode=null,t.fillGradientAngle=null,t.fillGradientOffsetRatioX=null,t.fillGradientOffsetRatioY=null,t.fillOpaqueRate=null,t.fillSymbolID=null,t.lineColor&&(t.lineColor.destroy(),t.lineColor=null),t.lineSymbolID=null,t.lineWidth=null,t.markerAngle=null,t.markerSize=null,t.markerSymbolID=null}toServerJSONObject(){var t={};return t=T.copyAttributes(t,this),t}static fromJson(t){if(!!t)return new dt({fillBackColor:V.fromJson(t.fillBackColor),fillBackOpaque:t.fillBackOpaque,fillForeColor:V.fromJson(t.fillForeColor),fillGradientMode:t.fillGradientMode,fillGradientAngle:t.fillGradientAngle,fillGradientOffsetRatioX:t.fillGradientOffsetRatioX,fillGradientOffsetRatioY:t.fillGradientOffsetRatioY,fillOpaqueRate:t.fillOpaqueRate,fillSymbolID:t.fillSymbolID,lineColor:V.fromJson(t.lineColor),lineSymbolID:t.lineSymbolID,lineWidth:t.lineWidth,markerAngle:t.markerAngle,markerSize:t.markerSize,markerSymbolID:t.markerSymbolID})}}a.ServerStyle=dt;class mt extends C{constructor(t){super(t);this.measure=null,t&&T.extend(this,t),this.CLASS_NAME="SuperMap.PointWithMeasure"}equals(t){var r=!1;if(t!=null){var i=this.x===t.x&&this.y===t.y&&this.measure===t.measure,n=isNaN(this.x)&&isNaN(this.y)&&isNaN(this.measure),s=isNaN(t.x)&&isNaN(t.y)&&isNaN(t.measure);r=i||n&&s}return r}toJson(){var t="{";return this.measure!=null&&this.measure!=null&&(t+='"measure":'+this.measure+","),t+='"x":'+this.x+",",t+='"y":'+this.y,t+="}",t}destroy(){var t=this;t.measure=null,t.x=null,t.y=null}static fromJson(t){if(!!t)return new mt({x:t.x,y:t.y,measure:t.measure})}}a.PointWithMeasure=mt;class yt extends J{constructor(t,r){super(t,r);this.id=null,this.center=null,this.style=null,this.length=null,this.maxM=null,this.minM=null,this.parts=null,this.points=null,this.type=null,this.componentTypes=["SuperMap.Geometry.LinearRing","SuperMap.Geometry.LineString"],r&&T.extend(this,r),this.CLASS_NAME="SuperMap.Route",this.geometryType="LINEM"}toJson(){var t="{";if(this.id!=null&&this.id!=null&&(t+='"id":'+this.id+","),this.center!=null&&this.center!=null&&(t+='"center":'+this.center+","),this.style!=null&&this.style!=null&&(t+='"style":'+this.style+","),this.length!=null&&this.length!=null&&(t+='"length":'+this.length+","),this.maxM!=null&&this.maxM!=null&&(t+='"maxM":'+this.maxM+","),this.minM!=null&&this.minM!=null&&(t+='"minM":'+this.minM+","),this.type!=null&&this.type!=null&&(t+='"type":"'+this.type+'",'),this.parts!=null&&this.parts!=null){t+='"parts":['+this.parts[0];for(var r=1;r<this.parts.length;r++)t+=","+this.parts[r];t+="],"}if(this.components!=null&&this.components.length>0){t+='"points":[';for(var i=0,n=this.components.length;i<n;i++)for(var s=0,o=this.components[i].components.length;s<o;s++)t+=this.components[i].components[s].toJson()+",";t=t.replace(/,$/g,""),t+="]"}return t=t.replace(/,$/g,""),t+="}",t}destroy(){var t=this;t.id=null,t.center=null,t.style=null,t.length=null,t.maxM=null,t.minM=null,t.type=null,t.parts=null,t.components.length=0,t.components=null,t.componentTypes=null}static fromJson(t){if(!!t){var r=t.parts||[],i=t.points||[],n=r.length,s=[];if(n>0)for(var o=0,l=0,h=[];o<n;o++){for(var f=0;f<r[o];f++)h.push(mt.fromJson(i[l+f]));l+=r[o],h[0].equals(h[r[o]-1])?s.push(new q(h)):s.push(new w(h)),h=[]}else return null;return new yt(s,{id:t.id,center:t.center,style:t.style,length:t.length,maxM:t.maxM,minM:t.minM,type:t.type,parts:t.parts})}}}a.Route=yt;class Z{constructor(t){this.id=0,this.style=null,this.parts=null,this.points=null,this.type=null,this.prjCoordSys=null,t&&T.extend(this,t),this.CLASS_NAME="SuperMap.ServerGeometry"}destroy(){var t=this;t.id=null,t.style=null,t.parts=null,t.partTopo=null,t.points=null,t.type=null,t.prjCoordSys=null}toGeometry(){var t=this,r=t.type;switch(r.toUpperCase()){case D.POINT:return t.toGeoPoint();case D.LINE:return t.toGeoLine();case D.LINEM:return t.toGeoLinem();case D.REGION:return t.toGeoRegion();case D.POINTEPS:return t.toGeoPoint();case D.LINEEPS:return t.toGeoLineEPS();case D.REGIONEPS:return t.toGeoRegionEPS();case D.GEOCOMPOUND:return t.transformGeoCompound()}}toGeoPoint(){var t=this,r=t.parts||[],i=t.points||[],n=r.length;if(n>0){if(n===1)return new C(i[0].x,i[0].y);var s=[];for(let o=0;o<n;o++)s.push(new C(i[o].x,i[o].y));return new ht(s)}else return null}toGeoLine(){var t=this,r=t.parts||[],i=t.points||[],n=r.length;if(n>0)if(n===1){let s=[];for(let o=0;o<r[0];o++)s.push(new C(i[o].x,i[o].y));return s[0].equals(s[r[0]-1])?new q(s):new w(s)}else{let s=[];for(let o=0;o<n;o++){let l=[];for(let h=0;h<r[o];h++)l.push(new C(i[h].x,i[h].y));s.push(new w(l)),i.splice(0,r[o])}return new pt(s)}else return null}toGeoLineEPS(){var t=this,r=t.parts||[],i=t.points||[],n,s,o,l,h,f=r.length;if(f>0)if(f===1){for(n=0,o=[];n<r[0];n++)o.push(new C(i[n].x,i[n].y,i[n].type));return o[0].equals(o[r[0]-1])?(h=w.createLineEPS(o),new q(h)):(h=w.createLineEPS(o),new w(h))}else{for(n=0,l=[];n<f;n++){for(s=0,o=[];s<r[n];s++)o.push(new C(i[s].x,i[s].y));h=w.createLineEPS(o),l.push(new w(h)),i.splice(0,r[n])}return new pt(l)}else return null}toGeoLinem(){var t=this;return yt.fromJson(t)}toGeoRegion(){var t=this,r=t.parts||[],i=t.partTopo||[],n=t.points||[],s=r.length;if(s<=0)return null;var o=[],l=[];if(s==1){for(let c=0;c<n.length;c++)l.push(new C(n[c].x,n[c].y));return o.push(new z([new q(l)])),new j(o)}var h=[],f=[],p=[],g=[],y=[];for(let c=0,v=0;c<s;c++){for(let u=0;u<r[c];u++)l.push(new C(n[v+u].x,n[v+u].y));v+=r[c];var S=new z([new q(l)]);l=[],p.push(S),i.length===0&&g.push(S.getBounds()),y.push(1),f.push(S.getArea())}if(i.length===0){Z.bubbleSort(f,p,i,g);var _=[];for(let c=1;c<p.length;c++)for(let v=c-1;v>=0;v--)if(_[c]=-1,g[v].containsBounds(g[c])){y[c]=y[v]*-1,y[c]<0&&(_[c]=v);break}for(let c=0;c<p.length;c++)y[c]>0?o.push(p[c]):(o[_[c]].components=o[_[c]].components.concat(p[c].components),o.push(""))}else{o=new Array;for(let c=0;c<p.length;c++)if(i[c]&&i[c]==-1?h=h.concat(p[c].components):(h.length>0&&o.length>0&&(o[o.length-1].components=o[o.length-1].components.concat(h),h=[]),o.push(p[c])),c==s-1){var N=o.length;if(N)o[N-1].components=o[N-1].components.concat(h);else for(let v=0,u=h.length;v<u;v++)o.push(new z(h))}}return new j(o)}toGeoRegionEPS(){var t=this,r=t.parts||[],i=t.partTopo||[],n=t.points||[],s=r.length;if(s<=0)return null;var o=[],l=[],h;if(s==1){for(var f=0;f<n.length;f++)l.push(new C(n[f].x,n[f].y));return h=w.createLineEPS(l),o.push(new z([new q(h)])),new j(o)}var p=[],g=[],y=[],S=[],_=[];for(let u=0,m=0;u<s;u++){for(let E=0;E<r[u];E++)l.push(new C(n[m+E].x,n[m+E].y));m+=r[u],h=w.createLineEPS(l);var N=new z([new q(h)]);l=[],y.push(N),i.length===0&&S.push(N.getBounds()),_.push(1),g.push(N.getArea())}if(i.length===0){Z.bubbleSort(g,y,i,S);var c=[];for(let u=1;u<y.length;u++)for(let m=u-1;m>=0;m--)if(c[u]=-1,S[m].containsBounds(S[u])){_[u]=_[m]*-1,_[u]<0&&(c[u]=m);break}for(let u=0;u<y.length;u++)_[u]>0?o.push(y[u]):(o[c[u]].components=o[c[u]].components.concat(y[u].components),o.push(""))}else{o=new Array;for(let u=0;u<y.length;u++)if(i[u]&&i[u]==-1?p=p.concat(y[u].components):(p.length>0&&o.length>0&&(o[o.length-1].components=o[o.length-1].components.concat(p),p=[]),o.push(y[u])),u==s-1){var v=o.length;if(v)o[v-1].components=o[v-1].components.concat(p);else for(let m=0,E=p.length;m<E;m++)o.push(new z(p))}}return new j(o)}transformGeoCompound(){const t=this,r=t.geoParts||[],i=r.length;if(i<=0)return null;const n=[];for(let s=0;s<i;s++){const o=r[s];n.push(new Z(o).toGeometry())}return new J(n)}static fromJson(t){if(!!t)return new Z({id:t.id,style:dt.fromJson(t.style),parts:t.parts,partTopo:t.partTopo,points:t.points,center:t.center,length:t.length,maxM:t.maxM,minM:t.minM,type:t.type})}static fromGeometry(t){if(!!t){var r=0,i=[],n=[],s=null,o=t.components,l=t.CLASS_NAME,h={epsgCode:t.SRID};if(isNaN(t.id)||(r=t.id),l!="SuperMap.Geometry.LinearRing"&&l!="SuperMap.Geometry.LineString"&&(t instanceof ht||t instanceof pt)){let f=o.length;for(let p=0;p<f;p++){let g=o[p].getVertices().length;i.push(g);for(let y=0;y<g;y++)n.push(new C(o[p].getVertices()[y].x,o[p].getVertices()[y].y))}s=l=="SuperMap.Geometry.MultiPoint"?D.POINT:D.LINE}else if(t instanceof j){let f=o.length;for(let p=0;p<f;p++){let g=o[p],y=g.components,S=y.length;for(let _=0;_<S;_++){let N=y[_].getVertices().length+1;i.push(N);for(let c=0;c<N-1;c++)n.push(new C(y[_].getVertices()[c].x,y[_].getVertices()[c].y));n.push(new C(y[_].getVertices()[0].x,y[_].getVertices()[0].y))}}s=D.REGION}else if(t instanceof z){let f=o.length;for(let p=0;p<f;p++){let g=o[p].getVertices().length+1;i.push(g);for(let y=0;y<g-1;y++)n.push(new C(o[p].getVertices()[y].x,o[p].getVertices()[y].y));n.push(new C(o[p].getVertices()[0].x,o[p].getVertices()[0].y))}s=D.REGION}else{let f=t.getVertices().length;for(let p=0;p<f;p++)n.push(new C(t.getVertices()[p].x,t.getVertices()[p].y));t instanceof q&&(n.push(new C(t.getVertices()[0].x,t.getVertices()[0].y)),f++),i.push(f),s=t instanceof C?D.POINT:D.LINE}return new Z({id:r,style:null,parts:i,points:n,type:s,prjCoordSys:h})}}static IsClockWise(t){var r=t.length;if(r<3)return 0;var i=t[0].y*(t[r-1].x-t[1].x);t.push(t[0]);for(var n=1;n<r;n++)i+=t[n].y*(t[n-1].x-t[n+1].x);return i*.5}static bubbleSort(t,r,i,n){for(var s=0;s<t.length;s++)for(var o=0;o<t.length;o++)if(t[s]>t[o]){var l=t[o];t[o]=t[s],t[s]=l;var h=r[o];if(r[o]=r[s],r[s]=h,i&&i.length>0){var f=i[o];i[o]=i[s],i[s]=f}if(n&&n.length>0){var p=n[o];n[o]=n[s],n[s]=p}}}}a.ServerGeometry=Z;class $t{constructor(t,r,i){this.CLASS_NAME="SuperMap.Feature",this.layer=t,this.id=T.createUniqueID(this.CLASS_NAME+"_"),this.lonlat=r,this.data=i!=null?i:{}}destroy(){this.id=null,this.lonlat=null,this.data=null}}a.Feature=$t;class nt extends $t{constructor(t,r,i){super(null,null,r);this.fid=null,this.geometry=t||null,this.attributes={},r&&(this.attributes=T.extend(this.attributes,r)),this.bounds=null,this.state=null,this.style=i||null,this.url=null,this.lonlat=null,this.CLASS_NAME="SuperMap.Feature.Vector",a.State={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"},nt.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"default",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}}}destroy(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,super.destroy()}clone(){return new nt(this.geometry?this.geometry.clone():null,this.attributes,this.style)}toState(t){if(t===a.State.UPDATE)switch(this.state){case a.State.UNKNOWN:case a.State.DELETE:this.state=t;break;case a.State.UPDATE:case a.State.INSERT:break}else if(t===a.State.INSERT)switch(this.state){case a.State.UNKNOWN:break;default:this.state=t;break}else if(t===a.State.DELETE)switch(this.state){case a.State.INSERT:break;case a.State.DELETE:break;case a.State.UNKNOWN:case a.State.UPDATE:this.state=t;break}else t===a.State.UNKNOWN&&(this.state=t)}}a.Feature.Vector=nt;class jt{constructor(t){this.data=null,this.keepData=!1,T.extend(this,t),this.options=t,this.CLASS_NAME="SuperMap.Format"}destroy(){}read(t){}write(t){}}a.Format=a.Format||jt;class te extends jt{constructor(t){super(t);this.indent="    ",this.space=" ",this.newline=`
`,this.level=0,this.pretty=!1,this.nativeJSON=function(){return!!(window.JSON&&typeof JSON.parse=="function"&&typeof JSON.stringify=="function")}(),this.CLASS_NAME="SuperMap.Format.JSON",this.serialize={object:function(r){if(r==null)return"null";if(r.constructor===Date)return this.serialize.date.apply(this,[r]);if(r.constructor===Array)return this.serialize.array.apply(this,[r]);var i=["{"];this.level+=1;var n,s,o,l=!1;for(n in r)r.hasOwnProperty(n)&&(s=this.write.apply(this,[n,this.pretty]),o=this.write.apply(this,[r[n],this.pretty]),s!=null&&o!=null&&(l&&i.push(","),i.push(this.writeNewline(),this.writeIndent(),s,":",this.writeSpace(),o),l=!0));return this.level-=1,i.push(this.writeNewline(),this.writeIndent(),"}"),i.join("")},array:function(r){var i,n=["["];this.level+=1;for(var s=0,o=r.length;s<o;++s)i=this.write.apply(this,[r[s],this.pretty]),i!=null&&(s>0&&n.push(","),n.push(this.writeNewline(),this.writeIndent(),i));return this.level-=1,n.push(this.writeNewline(),this.writeIndent(),"]"),n.join("")},string:function(r){var i={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(r)?'"'+r.replace(/([\x00-\x1f\\"])/g,function(n,s){var o=i[s];return o||(o=s.charCodeAt(),"\\u00"+Math.floor(o/16).toString(16)+(o%16).toString(16))})+'"':'"'+r+'"'},number:function(r){return isFinite(r)?String(r):"null"},boolean:function(r){return String(r)},date:function(r){function i(n){return n<10?"0"+n:n}return'"'+r.getFullYear()+"-"+i(r.getMonth()+1)+"-"+i(r.getDate())+"T"+i(r.getHours())+":"+i(r.getMinutes())+":"+i(r.getSeconds())+'"'}}}read(t,r){var i;if(this.nativeJSON)try{i=JSON.parse(t,r)}catch(n){}return this.keepData&&(this.data=i),i}write(t,r){this.pretty=!!r;var i=null,n=typeof t;if(this.serialize[n])try{i=!this.pretty&&this.nativeJSON?JSON.stringify(t):this.serialize[n].apply(this,[t])}catch(s){}return i}writeIndent(){var t=[];if(this.pretty)for(var r=0;r<this.level;++r)t.push(this.indent);return t.join("")}writeNewline(){return this.pretty?this.newline:""}writeSpace(){return this.pretty?this.space:""}}a.Format.JSON=te;class Lt extends te{constructor(t){super(t);this.ignoreExtraDims=!0,this.CLASS_NAME="SuperMap.Format.GeoJSON",this.parseCoords={point:function(r){if(this.ignoreExtraDims===!1&&r.length!=2)throw"Only 2D points are supported: "+r;return new C(r[0],r[1])},multipoint:function(r){for(var i=[],n=null,s=0,o=r.length;s<o;++s){try{n=this.parseCoords.point.apply(this,[r[s]])}catch(l){throw l}i.push(n)}return new ht(i)},linestring:function(r){for(var i=[],n=null,s=0,o=r.length;s<o;++s){try{n=this.parseCoords.point.apply(this,[r[s]])}catch(l){throw l}i.push(n)}return new w(i)},multilinestring:function(r){for(var i=[],n=null,s=0,o=r.length;s<o;++s){try{n=this.parseCoords.linestring.apply(this,[r[s]])}catch(l){throw l}i.push(n)}return new pt(i)},polygon:function(r){for(var i=[],n,s,o=0,l=r.length;o<l;++o){try{s=this.parseCoords.linestring.apply(this,[r[o]])}catch(h){throw h}n=new q(s.components),i.push(n)}return new z(i)},multipolygon:function(r){for(var i=[],n=null,s=0,o=r.length;s<o;++s){try{n=this.parseCoords.polygon.apply(this,[r[s]])}catch(l){throw l}i.push(n)}return new j(i)},box:function(r){if(r.length!=2)throw"GeoJSON box coordinates must have 2 elements";return new z([new q([new C(r[0][0],r[0][1]),new C(r[1][0],r[0][1]),new C(r[1][0],r[1][1]),new C(r[0][0],r[1][1]),new C(r[0][0],r[0][1])])])}},this.extract={feature:function(r){var i=this.extract.geometry.apply(this,[r.geometry]),n={type:"Feature",properties:this.createAttributes(r),geometry:i};return r.geometry&&r.geometry.type==="TEXT"&&(n.properties.texts=r.geometry.texts,n.properties.textStyle=r.geometry.textStyle),r.fid&&(n.id=r.fid),r.ID&&(n.id=r.ID),n},geometry:function(r){if(r==null)return null;!r.parts&&r.points&&(r.parts=[r.points.length]);var i=r.hasOwnProperty("geometryType")?r:new Z(r).toGeometry()||r,n=i.geometryType||i.type,s;n==="LinearRing"&&(n="LineString"),n==="LINEM"&&(n="MultiLineString"),s=this.extract[n.toLowerCase()].apply(this,[i]),n=n==="TEXT"?"Point":n;var o;return n==="Collection"?o={type:"GeometryCollection",geometries:s}:o={type:n,coordinates:s},o},point:function(r){var i=[r.x,r.y];for(var n in r)n!=="x"&&n!=="y"&&r[n]!==null&&!isNaN(r[n])&&i.push(r[n]);return i},text:function(r){return[r.points[0].x,r.points[0].y]},multipoint:function(r){for(var i=[],n=0,s=r.components.length;n<s;++n)i.push(this.extract.point.apply(this,[r.components[n]]));return i},linestring:function(r){for(var i=[],n=0,s=r.components.length;n<s;++n)i.push(this.extract.point.apply(this,[r.components[n]]));return i},multilinestring:function(r){for(var i=[],n=0,s=r.components.length;n<s;++n)i.push(this.extract.linestring.apply(this,[r.components[n]]));return i},polygon:function(r){for(var i=[],n=0,s=r.components.length;n<s;++n)i.push(this.extract.linestring.apply(this,[r.components[n]]));return i},multipolygon:function(r){for(var i=[],n=0,s=r.components.length;n<s;++n)i.push(this.extract.polygon.apply(this,[r.components[n]]));return i},collection:function(r){for(var i=r.components.length,n=new Array(i),s=0;s<i;++s)n[s]=this.extract.geometry.apply(this,[r.components[s]]);return n}}}read(t,r,i){r=r||"FeatureCollection";var n=null,s=null;if(typeof t=="string"?s=super.read(t,i):s=t,s){if(typeof s.type=="string"){if(this.isValidType(s,r))switch(r){case"Geometry":try{n=this.parseGeometry(s)}catch(f){}break;case"Feature":try{n=this.parseFeature(s),n.type="Feature"}catch(f){}break;case"FeatureCollection":switch(n=[],s.type){case"Feature":try{n.push(this.parseFeature(s))}catch(f){n=null}break;case"FeatureCollection":for(var o=0,l=s.features.length;o<l;++o)try{n.push(this.parseFeature(s.features[o]))}catch(f){n=null}break;default:try{var h=this.parseGeometry(s);n.push(new nt(h))}catch(f){n=null}}break}}}return n}write(t,r){return super.write(this.toGeoJSON(t),r)}fromGeoJSON(t,r,i){let n=this.read(t,r,i);return T.isArray(n)?n.map(s=>this._toiSevrerFeature(s)):this._toiSevrerFeature(n)}toGeoJSON(t){var r={type:null};if(T.isArray(t)){r.type="FeatureCollection";var i=t.length;r.features=new Array(i);for(var n=0;n<i;++n){var s=t[n];if(o(s)){let l={};l.geometry=s,r.features[n]=this.extract.feature.apply(this,[l])}else r.features[n]=this.extract.feature.apply(this,[s])}}else if(o(t)){let l={};l.geometry=t,r=this.extract.feature.apply(this,[l])}else r=this.extract.feature.apply(this,[t]);function o(l){return l.hasOwnProperty("parts")&&l.hasOwnProperty("points")||l.hasOwnProperty("geoParts")}return r}isValidType(t,r){var i=!1;switch(r){case"Geometry":T.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],t.type)==-1||(i=!0);break;case"FeatureCollection":i=!0;break;default:t.type==r&&(i=!0)}return i}parseFeature(t){var r,i,n,s;n=t.properties?t.properties:{},s=t.geometry&&t.geometry.bbox||t.bbox;try{i=this.parseGeometry(t.geometry)}catch(o){throw o}return r=new nt(i,n),s&&(r.bounds=G.fromArray(s)),t.id&&(r.fid=t.id),r}parseGeometry(t){if(t==null)return null;var r;if(t.type=="GeometryCollection"){if(!T.isArray(t.geometries))throw"GeometryCollection must have geometries array: "+t;for(var i=t.geometries.length,n=new Array(i),s=0;s<i;++s)n[s]=this.parseGeometry.apply(this,[t.geometries[s]]);r=new J(n)}else{if(!T.isArray(t.coordinates))throw"Geometry must have coordinates array: "+t;if(!this.parseCoords[t.type.toLowerCase()])throw"Unsupported geometry type: "+t.type;try{r=this.parseCoords[t.type.toLowerCase()].apply(this,[t.coordinates])}catch(o){throw o}}return r}createCRSObject(t){var r=t.layer.projection.toString(),i={};if(r.match(/epsg:/i)){var n=parseInt(r.substring(r.indexOf(":")+1));n==4326?i={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:i={type:"name",properties:{name:"EPSG:"+n}}}return i}_toiSevrerFeature(t){const r=t.attributes,i=[],n=[];for(var s in r)i.push(s),n.push(r[s]);const o={fieldNames:i,fieldValues:n,geometry:Z.fromGeometry(t.geometry)};return o.geometry.id=t.fid,o}createAttributes(t){if(!t)return null;var r={};s(t,r);var i=["fieldNames","fieldValues","geometry","stringID","ID"];for(var n in t)i.indexOf(n)>-1||(r[n]=t[n]);function s(o,l){if(!!(o.hasOwnProperty("fieldNames")&&o.hasOwnProperty("fieldValues"))){var h=o.fieldNames,f=o.fieldValues;for(var p in h)l[h[p]]=f[p]}}return r}}a.Format.GeoJSON=Lt;var qe=function(e){var t=6378137,r;if(e===Q.METER)r=1;else if(e===Q.DEGREE)r=Math.PI*2*t/360;else if(e===Q.KILOMETER)r=.001;else if(e===Q.INCH)r=1/.025399999918;else if(e===Q.FOOT)r=.3048;else return r;return r};const We={};L.Util.supermap_callbacks=We;const Je=function(e){return e&&new Lt().toGeoJSON(e)},ee=function(e){if(!e)return e;let t;const r=new Lt;if(["FeatureCollection","Feature","Geometry"].indexOf(e.type)!==-1)t=r.read(e,e.type);else if(typeof e.toGeoJSON=="function"){const n=e.toGeoJSON();t=n?r.read(n,n.type):e}let i=t||e;return L.Util.isArray(t)&&(t.length===1?i=t[0]:t.length>1&&(i=[],t.map(function(n){return i.push(n.geometry),n}))),i&&i.geometry?i.geometry:i},Pt=qe,re=function(e,t,r){const i=1/.0254,n=Pt(r);let s=e*t*i*n;return s=1/s,s},ze=function(e,t,r){const i=1/.0254,n=Pt(r);let s=e*t*i*n;return s=1/s,s},Ze=function(e,t,r,i){let n=null;const s=1e4;return i=i||6378137,r=r||"",e>0&&t>0?(e=L.Util.NormalizeScale(e),r.toLowerCase()==="degree"||r.toLowerCase()==="degrees"||r.toLowerCase()==="dd"?(n=.0254*s/t/e/(Math.PI*2*i/360)/s,n):(n=.0254*s/t/e/s,n)):-1},Ve=function(e){return e>1?1/e:e};L.Util.toGeoJSON=Je;L.Util.toSuperMapGeometry=ee;L.Util.resolutionToScale=re;L.Util.scaleToResolution=ze;L.Util.getMeterPerMapUnit=Pt;L.Util.GetResolutionFromScaleDpi=Ze;L.Util.NormalizeScale=Ve;const Ke=L.TileLayer.extend({options:{layersID:null,redirect:!1,transparent:!0,cacheEnabled:!0,clipRegionEnabled:!1,clipRegion:null,prjCoordSys:null,overlapDisplayed:!1,overlapDisplayedOptions:null,tileversion:null,crs:null,format:"png",tileProxy:null,attribution:"Map Data <span>\xA9 <a href='http://support.supermap.com.cn/product/iServer.aspx' title='SuperMap iServer' target='_blank'>SuperMap iServer</a></span>",subdomains:null},initialize:function(e,t){this._url=e,L.TileLayer.prototype.initialize.apply(this,arguments),L.setOptions(this,t),L.stamp(this),this.tileSetsIndex=-1,this.tempIndex=-1},onAdd:function(e){this._crs=this.options.crs||e.options.crs,L.TileLayer.prototype.onAdd.call(this,e)},getTileUrl:function(e){const t=this.getScaleFromCoords(e);let i=this._getLayerUrl()+"&scale="+t+"&x="+e.x+"&y="+e.y;return this.options.tileProxy&&(i=this.options.tileProxy+encodeURIComponent(i)),this.options.cacheEnabled||(i+="&_t="+new Date().getTime()),this.options.subdomains&&(i=L.Util.template(i,{s:this._getSubdomain(e)})),i},getScale:function(e){const t=this,r=e||t._map.getZoom();return t.scales[r]},getScaleFromCoords:function(e){const t=this;if(t.scales&&t.scales[e.z])return t.scales[e.z];t.scales=t.scales||{};const r=t.getDefaultScale(e);return t.scales[e.z]=r,r},getDefaultScale:function(e){const t=this,r=t._crs;if(r.scales)return r.scales[e.z];{const i=t._tileCoordsToBounds(e),n=r.project(i.getNorthEast()),s=r.project(i.getSouthWest()),o=t.options.tileSize,l=Math.max(Math.abs(n.x-s.x)/o,Math.abs(n.y-s.y)/o);let h=Q.METER;if(r.code){const f=r.code.split(":");if(f&&f.length>1){const p=parseInt(f[1]);h=p&&p>=4e3&&p<=5e3?Q.DEGREE:Q.METER}}return re(l,96,h)}},setTileSetsInfo:function(e){this.tileSets=e,L.Util.isArray(this.tileSets)&&(this.tileSets=this.tileSets[0]),!!this.tileSets&&(this.fire("tilesetsinfoloaded",{tileVersions:this.tileSets.tileVersions}),this.changeTilesVersion())},lastTilesVersion:function(){this.tempIndex=this.tileSetsIndex-1,this.changeTilesVersion()},nextTilesVersion:function(){this.tempIndex=this.tileSetsIndex+1,this.changeTilesVersion()},changeTilesVersion:function(){const e=this;if(e.tileSets==null||e.tempIndex===e.tileSetsIndex||this.tempIndex<0)return;const t=e.tileSets.tileVersions;if(t&&e.tempIndex<t.length&&e.tempIndex>=0){const r=t[e.tempIndex].name;e.mergeTileVersionParam(r)&&(e.tileSetsIndex=e.tempIndex,e.fire("tileversionschanged",{tileVersion:t[e.tempIndex]}))}},updateCurrentTileSetsIndex:function(e){this.tempIndex=e},mergeTileVersionParam:function(e){return e?(this.requestParams.tileversion=e,this._paramsChanged=!0,this.redraw(),this._paramsChanged=!1,!0):!1},_getLayerUrl:function(){return this._paramsChanged&&(this._layerUrl=this._createLayerUrl()),this._layerUrl||this._createLayerUrl()},_createLayerUrl:function(){let e=T.urlPathAppend(this._url,`tileImage.${this.options.format}`);return this.requestParams=this.requestParams||this._getAllRequestParams(),e=T.urlAppend(e,d.exports.Util.getParamString(this.requestParams)),e=Y.appendCredential(e),this._layerUrl=e,e},_getAllRequestParams:function(){const e=this,t=e.options||{},r={};let i=this.options.tileSize;i instanceof L.Point||(i=L.point(i,i)),r.width=i.x,r.height=i.y,r.redirect=t.redirect===!0,r.transparent=t.transparent===!0,r.cacheEnabled=t.cacheEnabled!==!1,t.prjCoordSys&&(r.prjCoordSys=JSON.stringify(t.prjCoordSys)),t.layersID&&(r.layersID=t.layersID.toString()),t.clipRegionEnabled&&t.clipRegion&&(t.clipRegion=Z.fromGeometry(ee(t.clipRegion)),r.clipRegionEnabled=t.clipRegionEnabled,r.clipRegion=JSON.stringify(t.clipRegion));const n=e._crs;if(n.options&&n.options.origin)r.origin=JSON.stringify({x:n.options.origin[0],y:n.options.origin[1]});else if(n.projection&&n.projection.bounds){const s=n.projection.bounds,o=L.point(s.min.x,s.max.y);r.origin=JSON.stringify({x:o.x,y:o.y})}return t.overlapDisplayed===!1?(r.overlapDisplayed=!1,t.overlapDisplayedOptions&&(r.overlapDisplayedOptions=e.overlapDisplayedOptions.toString())):r.overlapDisplayed=!0,r.cacheEnabled===!0&&t.tileversion&&(r.tileversion=t.tileversion.toString()),t.rasterfunction&&(r.rasterfunction=JSON.stringify(t.rasterfunction)),r}}),Ye=function(e,t){return new Ke(e,t)};var vt=window.XMLHttpRequest&&"withCredentials"in new window.XMLHttpRequest,X=document.documentElement.style.pointerEvents==="",tt={cors:vt,pointerEvents:X},Qe={attributionWidthOffset:55},ie=0;function gt(e){var t="";e.f=e.f||"json";for(var r in e)if(e.hasOwnProperty(r)){var i=e[r],n=Object.prototype.toString.call(i),s;t.length&&(t+="&"),n==="[object Array]"?s=Object.prototype.toString.call(i[0])==="[object Object]"?JSON.stringify(i):i.join(","):n==="[object Object]"?s=JSON.stringify(i):n==="[object Date]"?s=i.valueOf():s=i,t+=encodeURIComponent(r)+"="+encodeURIComponent(s)}return t}function wt(e,t){var r=new window.XMLHttpRequest;return r.onerror=function(i){r.onreadystatechange=d.exports.Util.falseFn,e.call(t,{error:{code:500,message:"XMLHttpRequest error"}},null)},r.onreadystatechange=function(){var i,n;if(r.readyState===4){try{i=JSON.parse(r.responseText)}catch(s){i=null,n={code:500,message:"Could not parse response as JSON. This could also be caused by a CORS or XMLHttpRequest error."}}!n&&i.error&&(n=i.error,i=null),r.onerror=d.exports.Util.falseFn,e.call(t,n,i)}},r.ontimeout=function(){this.onerror()},r}function Xe(e,t,r,i){var n=wt(r,i);return n.open("POST",e),typeof i!="undefined"&&i!==null&&typeof i.options!="undefined"&&(n.timeout=i.options.timeout),n.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),n.send(gt(t)),n}function ne(e,t,r,i){var n=wt(r,i);return n.open("GET",e+"?"+gt(t),!0),typeof i!="undefined"&&i!==null&&typeof i.options!="undefined"&&(n.timeout=i.options.timeout,i.options.withCredentials&&(n.withCredentials=!0)),n.send(null),n}function se(e,t,r,i){var n=gt(t),s=wt(r,i),o=(e+"?"+n).length;if(o<=2e3&&tt.cors?s.open("GET",e+"?"+n):o>2e3&&tt.cors&&(s.open("POST",e),s.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8")),typeof i!="undefined"&&i!==null&&typeof i.options!="undefined"&&(s.timeout=i.options.timeout,i.options.withCredentials&&(s.withCredentials=!0)),o<=2e3&&tt.cors)s.send(null);else if(o>2e3&&tt.cors)s.send(n);else{if(o<=2e3&&!tt.cors)return bt(e,t,r,i);et("a request to "+e+" was longer then 2000 characters and this browser cannot make a cross-domain post request. Please use a proxy http://esri.github.io/esri-leaflet/api-reference/request.html");return}return s}function bt(e,t,r,i){window._EsriLeafletCallbacks=window._EsriLeafletCallbacks||{};var n="c"+ie;t.callback="window._EsriLeafletCallbacks."+n,window._EsriLeafletCallbacks[n]=function(o){if(window._EsriLeafletCallbacks[n]!==!0){var l,h=Object.prototype.toString.call(o);h==="[object Object]"||h==="[object Array]"||(l={error:{code:500,message:"Expected array or object as JSONP response"}},o=null),!l&&o.error&&(l=o,o=null),r.call(i,l,o),window._EsriLeafletCallbacks[n]=!0}};var s=d.exports.DomUtil.create("script",null,document.body);return s.type="text/javascript",s.src=e+"?"+gt(t),s.id=n,s.onerror=function(o){if(o&&window._EsriLeafletCallbacks[n]!==!0){var l={error:{code:500,message:"An unknown error occurred"}};r.call(i,l),window._EsriLeafletCallbacks[n]=!0}},d.exports.DomUtil.addClass(s,"esri-leaflet-jsonp"),ie++,{id:n,url:s.src,abort:function(){window._EsriLeafletCallbacks._callback[n]({code:0,message:"Request aborted."})}}}var Mt=tt.cors?ne:bt;Mt.CORS=ne;Mt.JSONP=bt;function et(){console&&console.warn&&console.warn.apply(console,arguments)}var Et={request:se,get:Mt,post:Xe};/* @preserve
* @terraformer/arcgis - v2.0.7 - MIT
* Copyright (c) 2012-2021 Environmental Systems Research Institute, Inc.
* Thu Jul 22 2021 13:58:30 GMT-0700 (Pacific Daylight Time)
*/var $e=function(t,r,i,n){var s=(n[0]-i[0])*(t[1]-i[1])-(n[1]-i[1])*(t[0]-i[0]),o=(r[0]-t[0])*(t[1]-i[1])-(r[1]-t[1])*(t[0]-i[0]),l=(n[1]-i[1])*(r[0]-t[0])-(n[0]-i[0])*(r[1]-t[1]);if(l!==0){var h=s/l,f=o/l;if(h>=0&&h<=1&&f>=0&&f<=1)return!0}return!1},je=function(t,r){for(var i=!1,n=-1,s=t.length,o=s-1;++n<s;o=n)(t[n][1]<=r[1]&&r[1]<t[o][1]||t[o][1]<=r[1]&&r[1]<t[n][1])&&r[0]<(t[o][0]-t[n][0])*(r[1]-t[n][1])/(t[o][1]-t[n][1])+t[n][0]&&(i=!i);return i},tr=function(t,r){for(var i=0;i<t.length;i++)if(t[i]!==r[i])return!1;return!0},oe=function(t,r){for(var i=0;i<t.length-1;i++)for(var n=0;n<r.length-1;n++)if($e(t[i],t[i+1],r[n],r[n+1]))return!0;return!1},Ut=function(t){return tr(t[0],t[t.length-1])||t.push(t[0]),t},Dt=function(t){var r=0,i=0,n=t.length,s=t[i],o;for(i;i<n-1;i++)o=t[i+1],r+=(o[0]-s[0])*(o[1]+s[1]),s=o;return r>=0},ae=function(t){var r={};for(var i in t)t.hasOwnProperty(i)&&(r[i]=t[i]);return r},er=function(t,r){var i=oe(t,r),n=je(t,r[0]);return!!(!i&&n)},rr=function(t){for(var r=[],i=[],n,s,o,l=0;l<t.length;l++){var h=Ut(t[l].slice(0));if(!(h.length<4))if(Dt(h)){var f=[h.slice().reverse()];r.push(f)}else i.push(h.slice().reverse())}for(var p=[];i.length;){o=i.pop();var g=!1;for(n=r.length-1;n>=0;n--)if(s=r[n][0],er(s,o)){r[n].push(o),g=!0;break}g||p.push(o)}for(;p.length;){o=p.pop();var y=!1;for(n=r.length-1;n>=0;n--)if(s=r[n][0],oe(s,o)){r[n].push(o),y=!0;break}y||r.push([o.reverse()])}return r.length===1?{type:"Polygon",coordinates:r[0]}:{type:"MultiPolygon",coordinates:r}},ir=function(t,r){for(var i=r?[r,"OBJECTID","FID"]:["OBJECTID","FID"],n=0;n<i.length;n++){var s=i[n];if(s in t&&(typeof t[s]=="string"||typeof t[s]=="number"))return t[s]}throw Error("No valid id attribute found")},nr=function e(t,r){var i={};if(t.features){i.type="FeatureCollection",i.features=[];for(var n=0;n<t.features.length;n++)i.features.push(e(t.features[n],r))}if(typeof t.x=="number"&&typeof t.y=="number"&&(i.type="Point",i.coordinates=[t.x,t.y],typeof t.z=="number"&&i.coordinates.push(t.z)),t.points&&(i.type="MultiPoint",i.coordinates=t.points.slice(0)),t.paths&&(t.paths.length===1?(i.type="LineString",i.coordinates=t.paths[0].slice(0)):(i.type="MultiLineString",i.coordinates=t.paths.slice(0))),t.rings&&(i=rr(t.rings.slice(0))),typeof t.xmin=="number"&&typeof t.ymin=="number"&&typeof t.xmax=="number"&&typeof t.ymax=="number"&&(i.type="Polygon",i.coordinates=[[[t.xmax,t.ymax],[t.xmin,t.ymax],[t.xmin,t.ymin],[t.xmax,t.ymin],[t.xmax,t.ymax]]]),(t.geometry||t.attributes)&&(i.type="Feature",i.geometry=t.geometry?e(t.geometry):null,i.properties=t.attributes?ae(t.attributes):null,t.attributes))try{i.id=ir(t.attributes,r)}catch(s){}return JSON.stringify(i.geometry)===JSON.stringify({})&&(i.geometry=null),t.spatialReference&&t.spatialReference.wkid&&t.spatialReference.wkid!==4326&&console.warn("Object converted in non-standard crs - "+JSON.stringify(t.spatialReference)),i},le=function(t){var r=[],i=t.slice(0),n=Ut(i.shift().slice(0));if(n.length>=4){Dt(n)||n.reverse(),r.push(n);for(var s=0;s<i.length;s++){var o=Ut(i[s].slice(0));o.length>=4&&(Dt(o)&&o.reverse(),r.push(o))}}return r},sr=function(t){for(var r=[],i=0;i<t.length;i++)for(var n=le(t[i]),s=n.length-1;s>=0;s--){var o=n[s].slice(0);r.push(o)}return r},or=function e(t,r){r=r||"OBJECTID";var i={wkid:4326},n={},s;switch(t.type){case"Point":n.x=t.coordinates[0],n.y=t.coordinates[1],t.coordinates[2]&&(n.z=t.coordinates[2]),n.spatialReference=i;break;case"MultiPoint":n.points=t.coordinates.slice(0),t.coordinates[0][2]&&(n.hasZ=!0),n.spatialReference=i;break;case"LineString":n.paths=[t.coordinates.slice(0)],t.coordinates[0][2]&&(n.hasZ=!0),n.spatialReference=i;break;case"MultiLineString":n.paths=t.coordinates.slice(0),t.coordinates[0][0][2]&&(n.hasZ=!0),n.spatialReference=i;break;case"Polygon":n.rings=le(t.coordinates.slice(0)),t.coordinates[0][0][2]&&(n.hasZ=!0),n.spatialReference=i;break;case"MultiPolygon":n.rings=sr(t.coordinates.slice(0)),t.coordinates[0][0][0][2]&&(n.hasZ=!0),n.spatialReference=i;break;case"Feature":t.geometry&&(n.geometry=e(t.geometry,r)),n.attributes=t.properties?ae(t.properties):{},t.id&&(n.attributes[r]=t.id);break;case"FeatureCollection":for(n=[],s=0;s<t.features.length;s++)n.push(e(t.features[s],r));break;case"GeometryCollection":for(n=[],s=0;s<t.geometries.length;s++)n.push(e(t.geometries[s],r));break}return n},ue='<a href="http://leafletjs.com" title="A JS library for interactive maps">Leaflet</a>',ar='Powered by <a href="https://www.esri.com">Esri</a>';function St(e,t){return or(e,t)}function lr(e,t){return nr(e,t)}function he(e){if(e.xmin!=="NaN"&&e.ymin!=="NaN"&&e.xmax!=="NaN"&&e.ymax!=="NaN"){var t=d.exports.latLng(e.ymin,e.xmin),r=d.exports.latLng(e.ymax,e.xmax);return d.exports.latLngBounds(t,r)}else return null}function pe(e){return e=d.exports.latLngBounds(e),{xmin:e.getSouthWest().lng,ymin:e.getSouthWest().lat,xmax:e.getNorthEast().lng,ymax:e.getNorthEast().lat,spatialReference:{wkid:4326}}}var ce=/^(OBJECTID|FID|OID|ID)$/i;function ur(e){var t;if(e.objectIdFieldName)t=e.objectIdFieldName;else if(e.fields){for(var r=0;r<=e.fields.length-1;r++)if(e.fields[r].type==="esriFieldTypeOID"){t=e.fields[r].name;break}if(!t){for(r=0;r<=e.fields.length-1;r++)if(e.fields[r].name.match(ce)){t=e.fields[r].name;break}}}return t}function hr(e){for(var t in e.attributes)if(t.match(ce))return t}function _t(e,t){var r,i=e.features||e.results,n=i&&i.length;t?r=t:r=ur(e);var s={type:"FeatureCollection",features:[]};if(n)for(var o=i.length-1;o>=0;o--){var l=lr(i[o],r||hr(i[o]));s.features.push(l)}return s}function Gt(e){return e=d.exports.Util.trim(e),e[e.length-1]!=="/"&&(e+="/"),e}function Tt(e){if(e.url.indexOf("?")!==-1){e.requestParams=e.requestParams||{};var t=e.url.substring(e.url.indexOf("?")+1);e.url=e.url.split("?")[0],e.requestParams=JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}')}return e.url=Gt(e.url.split("?")[0]),e}function pr(e){return/^(?!.*utility\.arcgis\.com).*\.arcgis\.com.*FeatureServer/i.test(e)}function fe(e){var t;switch(e){case"Point":t="esriGeometryPoint";break;case"MultiPoint":t="esriGeometryMultipoint";break;case"LineString":t="esriGeometryPolyline";break;case"MultiLineString":t="esriGeometryPolyline";break;case"Polygon":t="esriGeometryPolygon";break;case"MultiPolygon":t="esriGeometryPolygon";break}return t}function Ft(e){return e.getSize().x-Qe.attributionWidthOffset+"px"}function It(e){if(!!e.attributionControl){if(e.attributionControl._esriAttributionLayerCount||(e.attributionControl._esriAttributionLayerCount=0),e.attributionControl._esriAttributionLayerCount===0){if(!e.attributionControl._esriAttributionAddedOnce){var t=document.createElement("style");t.type="text/css",t.innerHTML=".esri-truncated-attribution:hover {white-space: normal;}",document.getElementsByTagName("head")[0].appendChild(t);var r=document.createElement("style");r.type="text/css",r.innerHTML=".esri-truncated-attribution {vertical-align: -3px;white-space: nowrap;overflow: hidden;text-overflow: ellipsis;display: inline-block;transition: 0s white-space;transition-delay: 1s;max-width: "+Ft(e)+";}",document.getElementsByTagName("head")[0].appendChild(r),e.on("resize",function(i){e.attributionControl&&(e.attributionControl._container.style.maxWidth=Ft(i.target))}),e.attributionControl._esriAttributionAddedOnce=!0}e.attributionControl.setPrefix(ue+" | "+ar),d.exports.DomUtil.addClass(e.attributionControl._container,"esri-truncated-attribution:hover"),d.exports.DomUtil.addClass(e.attributionControl._container,"esri-truncated-attribution")}e.attributionControl._esriAttributionLayerCount=e.attributionControl._esriAttributionLayerCount+1}}function Rt(e){!e.attributionControl||(e.attributionControl._esriAttributionLayerCount&&e.attributionControl._esriAttributionLayerCount===1&&(e.attributionControl.setPrefix(ue),d.exports.DomUtil.removeClass(e.attributionControl._container,"esri-truncated-attribution:hover"),d.exports.DomUtil.removeClass(e.attributionControl._container,"esri-truncated-attribution")),e.attributionControl._esriAttributionLayerCount=e.attributionControl._esriAttributionLayerCount-1)}function de(e){var t={geometry:null,geometryType:null};if(e instanceof d.exports.LatLngBounds)return t.geometry=pe(e),t.geometryType="esriGeometryEnvelope",t;if(e.getLatLng&&(e=e.getLatLng()),e instanceof d.exports.LatLng&&(e={type:"Point",coordinates:[e.lng,e.lat]}),e instanceof d.exports.GeoJSON&&(e=e.getLayers()[0].feature.geometry,t.geometry=St(e),t.geometryType=fe(e.type)),e.toGeoJSON&&(e=e.toGeoJSON()),e.type==="Feature"&&(e=e.geometry),e.type==="Point"||e.type==="LineString"||e.type==="Polygon"||e.type==="MultiPolygon")return t.geometry=St(e),t.geometryType=fe(e.type),t;et("invalid geometry passed to spatial query. Should be L.LatLng, L.LatLngBounds, L.Marker or a GeoJSON Point, Line, Polygon or MultiPolygon object")}function cr(e,t){tt.cors&&se(e,{},d.exports.Util.bind(function(r,i){if(!r){t._esriAttributions=[];for(var n=0;n<i.contributors.length;n++)for(var s=i.contributors[n],o=0;o<s.coverageAreas.length;o++){var l=s.coverageAreas[o],h=d.exports.latLng(l.bbox[0],l.bbox[1]),f=d.exports.latLng(l.bbox[2],l.bbox[3]);t._esriAttributions.push({attribution:s.attribution,score:l.score,bounds:d.exports.latLngBounds(h,f),minZoom:l.zoomMin,maxZoom:l.zoomMax})}t._esriAttributions.sort(function(g,y){return y.score-g.score});var p={target:t};Bt(p)}},this))}function Bt(e){var t=e.target,r=t._esriAttributions;if(!(!t||!t.attributionControl)){var i=t.attributionControl._container.querySelector(".esri-dynamic-attribution");if(i&&r){for(var n="",s=t.getBounds(),o=d.exports.latLngBounds(s.getSouthWest().wrap(),s.getNorthEast().wrap()),l=t.getZoom(),h=0;h<r.length;h++){var f=r[h],p=f.attribution;!n.match(p)&&f.bounds.intersects(o)&&l>=f.minZoom&&l<=f.maxZoom&&(n+=", "+p)}n=n.substr(2),i.innerHTML=n,i.style.maxWidth=Ft(t),t.fire("attributionupdated",{attribution:n})}}}var kt=d.exports.Class.extend({options:{proxy:!1,useCors:vt},generateSetter:function(e,t){return d.exports.Util.bind(function(r){return this.params[e]=r,this},t)},initialize:function(e){if(e.request&&e.options?(this._service=e,d.exports.Util.setOptions(this,e.options)):(d.exports.Util.setOptions(this,e),this.options.url=Gt(e.url)),this.params=d.exports.Util.extend({},this.params||{}),this.setters)for(var t in this.setters){var r=this.setters[t];this[t]=this.generateSetter(r,this)}},token:function(e){return this._service?this._service.authenticate(e):this.params.token=e,this},apikey:function(e){return this.token(e)},format:function(e){return this.params.returnUnformattedValues=!e,this},request:function(e,t){return this.options.requestParams&&d.exports.Util.extend(this.params,this.options.requestParams),this._service?this._service.request(this.path,this.params,e,t):this._request("request",this.path,this.params,e,t)},_request:function(e,t,r,i,n){var s=this.options.proxy?this.options.proxy+"?"+this.options.url+t:this.options.url+t;return(e==="get"||e==="request")&&!this.options.useCors?Et.get.JSONP(s,r,i,n):Et[e](s,r,i,n)}}),fr=kt.extend({setters:{offset:"resultOffset",limit:"resultRecordCount",fields:"outFields",precision:"geometryPrecision",featureIds:"objectIds",returnGeometry:"returnGeometry",returnM:"returnM",transform:"datumTransformation",token:"token"},path:"query",params:{returnGeometry:!0,where:"1=1",outSR:4326,outFields:"*"},within:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelContains",this},intersects:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelIntersects",this},contains:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelWithin",this},crosses:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelCrosses",this},touches:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelTouches",this},overlaps:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelOverlaps",this},bboxIntersects:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelEnvelopeIntersects",this},indexIntersects:function(e){return this._setGeometryParams(e),this.params.spatialRel="esriSpatialRelIndexIntersects",this},nearby:function(e,t){return e=d.exports.latLng(e),this.params.geometry=[e.lng,e.lat],this.params.geometryType="esriGeometryPoint",this.params.spatialRel="esriSpatialRelIntersects",this.params.units="esriSRUnit_Meter",this.params.distance=t,this.params.inSR=4326,this},where:function(e){return this.params.where=e,this},between:function(e,t){return this.params.time=[e.valueOf(),t.valueOf()],this},simplify:function(e,t){var r=Math.abs(e.getBounds().getWest()-e.getBounds().getEast());return this.params.maxAllowableOffset=r/e.getSize().y*t,this},orderBy:function(e,t){return t=t||"ASC",this.params.orderByFields=this.params.orderByFields?this.params.orderByFields+",":"",this.params.orderByFields+=[e,t].join(" "),this},run:function(e,t){return this._cleanParams(),this.options.isModern||pr(this.options.url)&&this.options.isModern===void 0?(this.params.f="geojson",this.request(function(r,i){this._trapSQLerrors(r),e.call(t,r,i,i)},this)):this.request(function(r,i){this._trapSQLerrors(r),e.call(t,r,i&&_t(i),i)},this)},count:function(e,t){return this._cleanParams(),this.params.returnCountOnly=!0,this.request(function(r,i){e.call(this,r,i&&i.count,i)},t)},ids:function(e,t){return this._cleanParams(),this.params.returnIdsOnly=!0,this.request(function(r,i){e.call(this,r,i&&i.objectIds,i)},t)},bounds:function(e,t){return this._cleanParams(),this.params.returnExtentOnly=!0,this.request(function(r,i){i&&i.extent&&he(i.extent)?e.call(t,r,he(i.extent),i):(r={message:"Invalid Bounds"},e.call(t,r,null,i))},t)},distinct:function(){return this.params.returnGeometry=!1,this.params.returnDistinctValues=!0,this},pixelSize:function(e){var t=d.exports.point(e);return this.params.pixelSize=[t.x,t.y],this},layer:function(e){return this.path=e+"/query",this},_trapSQLerrors:function(e){e&&e.code==="400"&&et("one common syntax error in query requests is encasing string values in double quotes instead of single quotes")},_cleanParams:function(){delete this.params.returnIdsOnly,delete this.params.returnExtentOnly,delete this.params.returnCountOnly},_setGeometryParams:function(e){this.params.inSR=4326;var t=de(e);this.params.geometry=t.geometry,this.params.geometryType=t.geometryType}});function Ht(e){return new fr(e)}var dr=kt.extend({setters:{contains:"contains",text:"searchText",fields:"searchFields",spatialReference:"sr",sr:"sr",layers:"layers",returnGeometry:"returnGeometry",maxAllowableOffset:"maxAllowableOffset",precision:"geometryPrecision",dynamicLayers:"dynamicLayers",returnZ:"returnZ",returnM:"returnM",gdbVersion:"gdbVersion",token:"token"},path:"find",params:{sr:4326,contains:!0,returnGeometry:!0,returnZ:!0,returnM:!1},layerDefs:function(e,t){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[e,t].join(":"),this},simplify:function(e,t){var r=Math.abs(e.getBounds().getWest()-e.getBounds().getEast());return this.params.maxAllowableOffset=r/e.getSize().y*t,this},run:function(e,t){return this.request(function(r,i){e.call(t,r,i&&_t(i),i)},t)}});function mr(e){return new dr(e)}var me=kt.extend({path:"identify",between:function(e,t){return this.params.time=[e.valueOf(),t.valueOf()],this}}),yr=me.extend({setters:{layers:"layers",precision:"geometryPrecision",tolerance:"tolerance",returnGeometry:"returnGeometry"},params:{sr:4326,layers:"all",tolerance:3,returnGeometry:!0},on:function(e){var t=pe(e.getBounds()),r=e.getSize();return this.params.imageDisplay=[r.x,r.y,96],this.params.mapExtent=[t.xmin,t.ymin,t.xmax,t.ymax],this},at:function(e){return e.length===2&&(e=d.exports.latLng(e)),this._setGeometryParams(e),this},layerDef:function(e,t){return this.params.layerDefs=this.params.layerDefs?this.params.layerDefs+";":"",this.params.layerDefs+=[e,t].join(":"),this},simplify:function(e,t){var r=Math.abs(e.getBounds().getWest()-e.getBounds().getEast());return this.params.maxAllowableOffset=r/e.getSize().y*t,this},run:function(e,t){return this.request(function(r,i){if(r){e.call(t,r,void 0,i);return}else{var n=_t(i);i.results=i.results.reverse();for(var s=0;s<n.features.length;s++){var o=n.features[s];o.layerId=i.results[s].layerId}e.call(t,void 0,n,i)}})},_setGeometryParams:function(e){var t=de(e);this.params.geometry=t.geometry,this.params.geometryType=t.geometryType}});function vr(e){return new yr(e)}var gr=me.extend({setters:{setMosaicRule:"mosaicRule",setRenderingRule:"renderingRule",setPixelSize:"pixelSize",returnCatalogItems:"returnCatalogItems",returnGeometry:"returnGeometry"},params:{returnGeometry:!1},at:function(e){return e=d.exports.latLng(e),this.params.geometry=JSON.stringify({x:e.lng,y:e.lat,spatialReference:{wkid:4326}}),this.params.geometryType="esriGeometryPoint",this},getMosaicRule:function(){return this.params.mosaicRule},getRenderingRule:function(){return this.params.renderingRule},getPixelSize:function(){return this.params.pixelSize},run:function(e,t){return this.request(function(r,i){e.call(t,r,i&&this._responseToGeoJSON(i),i)},this)},_responseToGeoJSON:function(e){var t=e.location,r=e.catalogItems,i=e.catalogItemVisibilities,n={pixel:{type:"Feature",geometry:{type:"Point",coordinates:[t.x,t.y]},crs:{type:"EPSG",properties:{code:t.spatialReference.wkid}},properties:{OBJECTID:e.objectId,name:e.name,value:e.value},id:e.objectId}};if(e.properties&&e.properties.Values&&(n.pixel.properties.values=e.properties.Values),r&&r.features&&(n.catalogItems=_t(r),i&&i.length===n.catalogItems.features.length))for(var s=i.length-1;s>=0;s--)n.catalogItems.features[s].properties.catalogItemVisibility=i[s];return n}});function Er(e){return new gr(e)}var qt=d.exports.Evented.extend({options:{proxy:!1,useCors:vt,timeout:0},initialize:function(e){e=e||{},this._requestQueue=[],this._authenticating=!1,d.exports.Util.setOptions(this,e),this.options.url=Gt(this.options.url)},get:function(e,t,r,i){return this._request("get",e,t,r,i)},post:function(e,t,r,i){return this._request("post",e,t,r,i)},request:function(e,t,r,i){return this._request("request",e,t,r,i)},metadata:function(e,t){return this._request("get","",{},e,t)},authenticate:function(e){return this._authenticating=!1,this.options.token=e,this._runQueue(),this},getTimeout:function(){return this.options.timeout},setTimeout:function(e){this.options.timeout=e},_request:function(e,t,r,i,n){this.fire("requeststart",{url:this.options.url+t,params:r,method:e},!0);var s=this._createServiceCallback(e,t,r,i,n);if(this.options.token&&(r.token=this.options.token),this.options.requestParams&&d.exports.Util.extend(r,this.options.requestParams),this._authenticating){this._requestQueue.push([e,t,r,i,n]);return}else{var o=this.options.proxy?this.options.proxy+"?"+this.options.url+t:this.options.url+t;return(e==="get"||e==="request")&&!this.options.useCors?Et.get.JSONP(o,r,s,n):Et[e](o,r,s,n)}},_createServiceCallback:function(e,t,r,i,n){return d.exports.Util.bind(function(s,o){s&&(s.code===499||s.code===498)&&(this._authenticating=!0,this._requestQueue.push([e,t,r,i,n]),this.fire("authenticationrequired",{authenticate:d.exports.Util.bind(this.authenticate,this)},!0),s.authenticate=d.exports.Util.bind(this.authenticate,this)),i.call(n,s,o),s?this.fire("requesterror",{url:this.options.url+t,params:r,message:s.message,code:s.code,method:e},!0):this.fire("requestsuccess",{url:this.options.url+t,params:r,response:o,method:e},!0),this.fire("requestend",{url:this.options.url+t,params:r,method:e},!0)},this)},_runQueue:function(){for(var e=this._requestQueue.length-1;e>=0;e--){var t=this._requestQueue[e],r=t.shift();this[r].apply(this,t)}this._requestQueue=[]}}),Sr=qt.extend({identify:function(){return vr(this)},find:function(){return mr(this)},query:function(){return Ht(this)}});function ye(e){return new Sr(e)}var _r=qt.extend({query:function(){return Ht(this)},identify:function(){return Er(this)}});function Tr(e){return new _r(e)}var Ir=qt.extend({options:{idAttribute:"OBJECTID"},query:function(){return Ht(this)},addFeature:function(e,t,r){this.addFeatures(e,t,r)},addFeatures:function(e,t,r){for(var i=e.features?e.features:[e],n=i.length-1;n>=0;n--)delete i[n].id;return e=St(e),e=i.length>1?e:[e],this.post("addFeatures",{features:e},function(s,o){var l=o&&o.addResults?o.addResults.length>1?o.addResults:o.addResults[0]:void 0;t&&t.call(r,s||o.addResults[0].error,l)},r)},updateFeature:function(e,t,r){this.updateFeatures(e,t,r)},updateFeatures:function(e,t,r){var i=e.features?e.features:[e];return e=St(e,this.options.idAttribute),e=i.length>1?e:[e],this.post("updateFeatures",{features:e},function(n,s){var o=s&&s.updateResults?s.updateResults.length>1?s.updateResults:s.updateResults[0]:void 0;t&&t.call(r,n||s.updateResults[0].error,o)},r)},deleteFeature:function(e,t,r){this.deleteFeatures(e,t,r)},deleteFeatures:function(e,t,r){return this.post("deleteFeatures",{objectIds:e},function(i,n){var s=n&&n.deleteResults?n.deleteResults.length>1?n.deleteResults:n.deleteResults[0]:void 0;t&&t.call(r,i||n.deleteResults[0].error,s)},r)}});function Rr(e){return new Ir(e)}var b=window.location.protocol!=="https:"?"http:":"https:",ve=d.exports.TileLayer.extend({statics:{TILES:{Streets:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Street_Map"}},Topographic:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/World_Topo_Map"}},Oceans:{urlTemplate:b+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"USGS, NOAA",attributionUrl:"https://static.arcgis.com/attribution/Ocean_Basemap"}},OceansLabels:{urlTemplate:b+"//{s}.arcgisonline.com/arcgis/rest/services/Ocean/World_Ocean_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:X?"esri-labels":"tilePane",attribution:""}},NationalGeographic:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/NatGeo_World_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"National Geographic, DeLorme, HERE, UNEP-WCMC, USGS, NASA, ESA, METI, NRCAN, GEBCO, NOAA, increment P Corp."}},DarkGray:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},DarkGrayLabels:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Dark_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:X?"esri-labels":"tilePane",attribution:""}},Gray:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],attribution:"HERE, DeLorme, MapmyIndia, &copy; OpenStreetMap contributors"}},GrayLabels:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Canvas/World_Light_Gray_Reference/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:16,subdomains:["server","services"],pane:X?"esri-labels":"tilePane",attribution:""}},Imagery:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],attribution:"DigitalGlobe, GeoEye, i-cubed, USDA, USGS, AEX, Getmapping, Aerogrid, IGN, IGP, swisstopo, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}},ImageryLabels:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:X?"esri-labels":"tilePane",attribution:""}},ImageryTransportation:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Transportation/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,subdomains:["server","services"],pane:X?"esri-labels":"tilePane",attribution:""}},ShadedRelief:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Shaded_Relief/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS"}},ShadedReliefLabels:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places_Alternate/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:12,subdomains:["server","services"],pane:X?"esri-labels":"tilePane",attribution:""}},Terrain:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/World_Terrain_Base/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],attribution:"USGS, NOAA"}},TerrainLabels:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/Reference/World_Reference_Overlay/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:13,subdomains:["server","services"],pane:X?"esri-labels":"tilePane",attribution:""}},USATopo:{urlTemplate:b+"//{s}.arcgisonline.com/ArcGIS/rest/services/USA_Topo_Maps/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:15,subdomains:["server","services"],attribution:"USGS, National Geographic Society, i-cubed"}},ImageryClarity:{urlTemplate:b+"//clarity.maptiles.arcgis.com/arcgis/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community"}},Physical:{urlTemplate:b+"//{s}.arcgisonline.com/arcgis/rest/services/World_Physical_Map/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:8,subdomains:["server","services"],attribution:"U.S. National Park Service"}},ImageryFirefly:{urlTemplate:b+"//fly.maptiles.arcgis.com/arcgis/rest/services/World_Imagery_Firefly/MapServer/tile/{z}/{y}/{x}",options:{minZoom:1,maxZoom:19,attribution:"Esri, DigitalGlobe, GeoEye, Earthstar Geographics, CNES/Airbus DS, USDA, USGS, AeroGRID, IGN, and the GIS User Community",attributionUrl:"https://static.arcgis.com/attribution/World_Imagery"}}}},initialize:function(e,t){var r;if(typeof e=="object"&&e.urlTemplate&&e.options)r=e;else if(typeof e=="string"&&ve.TILES[e])r=ve.TILES[e];else throw new Error('L.esri.BasemapLayer: Invalid parameter. Use one of "Streets", "Topographic", "Oceans", "OceansLabels", "NationalGeographic", "Physical", "Gray", "GrayLabels", "DarkGray", "DarkGrayLabels", "Imagery", "ImageryLabels", "ImageryTransportation", "ImageryClarity", "ImageryFirefly", ShadedRelief", "ShadedReliefLabels", "Terrain", "TerrainLabels" or "USATopo"');var i=d.exports.Util.extend(r.options,t);d.exports.Util.setOptions(this,i),this.options.ignoreDeprecationWarning||console.warn("WARNING: L.esri.BasemapLayer uses data services that are in mature support and are not being updated. Please use L.esri.Vector.vectorBasemapLayer instead. More info: https://esriurl.com/esri-leaflet-basemap"),this.options.token&&r.urlTemplate.indexOf("token=")===-1&&(r.urlTemplate+="?token="+this.options.token),this.options.proxy&&(r.urlTemplate=this.options.proxy+"?"+r.urlTemplate),d.exports.TileLayer.prototype.initialize.call(this,r.urlTemplate,i)},onAdd:function(e){It(e),this.options.pane==="esri-labels"&&this._initPane(),this.options.attributionUrl&&cr((this.options.proxy?this.options.proxy+"?":"")+this.options.attributionUrl,e),e.on("moveend",Bt),d.exports.TileLayer.prototype.onAdd.call(this,e)},onRemove:function(e){Rt(e),e.off("moveend",Bt),d.exports.TileLayer.prototype.onRemove.call(this,e)},_initPane:function(){if(!this._map.getPane(this.options.pane)){var e=this._map.createPane(this.options.pane);e.style.pointerEvents="none",e.style.zIndex=500}},getAttribution:function(){if(this.options.attribution)var e='<span class="esri-dynamic-attribution">'+this.options.attribution+"</span>";return e}}),ge=d.exports.TileLayer.extend({options:{zoomOffsetAllowance:.1,errorTileUrl:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEABAMAAACuXLVVAAAAA1BMVEUzNDVszlHHAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAAAAAAAAAB6mUWpAAAADZJREFUeJztwQEBAAAAgiD/r25IQAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA7waBAAABw08RwAAAAABJRU5ErkJggg=="},statics:{MercatorZoomLevels:{"0":156543.033928,"1":78271.5169639999,"2":39135.7584820001,"3":19567.8792409999,"4":9783.93962049996,"5":4891.96981024998,"6":2445.98490512499,"7":1222.99245256249,"8":611.49622628138,"9":305.748113140558,"10":152.874056570411,"11":76.4370282850732,"12":38.2185141425366,"13":19.1092570712683,"14":9.55462853563415,"15":4.77731426794937,"16":2.38865713397468,"17":1.19432856685505,"18":.597164283559817,"19":.298582141647617,"20":.14929107082381,"21":.07464553541191,"22":.0373227677059525,"23":.0186613838529763}},initialize:function(e){e=d.exports.Util.setOptions(this,e),e=Tt(e),this.tileUrl=(e.proxy?e.proxy+"?":"")+e.url+"tile/{z}/{y}/{x}"+(e.requestParams&&Object.keys(e.requestParams).length>0?d.exports.Util.getParamString(e.requestParams):""),e.url.indexOf("{s}")!==-1&&e.subdomains&&(e.url=e.url.replace("{s}",e.subdomains[0])),this.service=ye(e),this.service.addEventParent(this);var t=new RegExp(/tiles.arcgis(online)?\.com/g);t.test(e.url)&&(this.tileUrl=this.tileUrl.replace("://tiles","://tiles{s}"),e.subdomains=["1","2","3","4"]),this.options.token&&(this.tileUrl+="?token="+this.options.token),d.exports.TileLayer.prototype.initialize.call(this,this.tileUrl,e)},getTileUrl:function(e){var t=this._getZoomForUrl();return d.exports.Util.template(this.tileUrl,d.exports.Util.extend({s:this._getSubdomain(e),x:e.x,y:e.y,z:this._lodMap&&this._lodMap[t]?this._lodMap[t]:t},this.options))},createTile:function(e,t){var r=document.createElement("img");return d.exports.DomEvent.on(r,"load",d.exports.Util.bind(this._tileOnLoad,this,t,r)),d.exports.DomEvent.on(r,"error",d.exports.Util.bind(this._tileOnError,this,t,r)),this.options.crossOrigin&&(r.crossOrigin=""),r.alt="",!this._lodMap||this._lodMap&&this._lodMap[this._getZoomForUrl()]?r.src=this.getTileUrl(e):this.once("lodmap",function(){r.src=this.getTileUrl(e)},this),r},onAdd:function(e){It(e),this._lodMap||this.metadata(function(t,r){if(!t&&r.spatialReference){var i=r.spatialReference.latestWkid||r.spatialReference.wkid;if(!this.options.attribution&&e.attributionControl&&r.copyrightText&&(this.options.attribution=r.copyrightText,e.attributionControl.addAttribution(this.getAttribution())),e.options.crs===d.exports.CRS.EPSG3857&&(i===102100||i===3857)){this._lodMap={};for(var n=r.tileInfo.lods,s=ge.MercatorZoomLevels,o=0;o<n.length;o++){var l=n[o];for(var h in s){var f=s[h];if(this._withinPercentage(l.resolution,f,this.options.zoomOffsetAllowance)){this._lodMap[h]=l.level;break}}}this.fire("lodmap")}else e.options.crs&&e.options.crs.code&&e.options.crs.code.indexOf(i)>-1||et("L.esri.TiledMapLayer is using a non-mercator spatial reference. Support may be available through Proj4Leaflet http://esri.github.io/esri-leaflet/examples/non-mercator-projection.html")}},this),d.exports.TileLayer.prototype.onAdd.call(this,e)},onRemove:function(e){Rt(e),d.exports.TileLayer.prototype.onRemove.call(this,e)},metadata:function(e,t){return this.service.metadata(e,t),this},identify:function(){return this.service.identify()},find:function(){return this.service.find()},query:function(){return this.service.query()},authenticate:function(e){var t="?token="+e;return this.tileUrl=this.options.token?this.tileUrl.replace(/\?token=(.+)/g,t):this.tileUrl+t,this.options.token=e,this.service.authenticate(e),this},_withinPercentage:function(e,t,r){var i=Math.abs(e/t-1);return i<r}});function Nr(e,t){return new ge(e,t)}var Cr=d.exports.ImageOverlay.extend({onAdd:function(e){this._topLeft=e.getPixelBounds().min,d.exports.ImageOverlay.prototype.onAdd.call(this,e)},_reset:function(){this._map.options.crs===d.exports.CRS.EPSG3857?d.exports.ImageOverlay.prototype._reset.call(this):d.exports.DomUtil.setPosition(this._image,this._topLeft.subtract(this._map.getPixelOrigin()))}}),Ee=d.exports.Layer.extend({options:{opacity:1,position:"front",f:"image",useCors:vt,attribution:null,interactive:!1,alt:""},onAdd:function(e){It(e),this.options.zIndex&&(this.options.position=null),this._update=d.exports.Util.throttle(this._update,this.options.updateInterval,this),e.on("moveend",this._update,this),this._currentImage&&this._currentImage._bounds.equals(this._map.getBounds())?e.addLayer(this._currentImage):this._currentImage&&(this._map.removeLayer(this._currentImage),this._currentImage=null),this._update(),this._popup&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this.metadata(function(t,r){!t&&!this.options.attribution&&e.attributionControl&&r.copyrightText&&(this.options.attribution=r.copyrightText,e.attributionControl.addAttribution(this.getAttribution()))},this)},onRemove:function(e){Rt(e),this._currentImage&&this._map.removeLayer(this._currentImage),this._popup&&(this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._map.off("moveend",this._update,this)},bindPopup:function(e,t){return this._shouldRenderPopup=!1,this._lastClick=!1,this._popup=d.exports.popup(t),this._popupFunction=e,this._map&&(this._map.on("click",this._getPopupData,this),this._map.on("dblclick",this._resetPopupState,this)),this},unbindPopup:function(){return this._map&&(this._map.closePopup(this._popup),this._map.off("click",this._getPopupData,this),this._map.off("dblclick",this._resetPopupState,this)),this._popup=!1,this},bringToFront:function(){return this.options.position="front",this._currentImage&&(this._currentImage.bringToFront(),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this.options.position="back",this._currentImage&&(this._currentImage.bringToBack(),this._setAutoZIndex(Math.min)),this},setZIndex:function(e){return this.options.zIndex=e,this._currentImage&&this._currentImage.setZIndex(e),this},_setAutoZIndex:function(e){if(!!this._currentImage){for(var t=this._currentImage.getPane().children,r=-e(-1/0,1/0),i=0,n=t.length,s;i<n;i++)s=t[i].style.zIndex,t[i]!==this._currentImage._image&&s&&(r=e(r,+s));isFinite(r)&&(this.options.zIndex=r+e(-1,1),this.setZIndex(this.options.zIndex))}},getAttribution:function(){return this.options.attribution},getOpacity:function(){return this.options.opacity},setOpacity:function(e){return this.options.opacity=e,this._currentImage&&this._currentImage.setOpacity(e),this},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(e,t){return this.options.from=e,this.options.to=t,this._update(),this},metadata:function(e,t){return this.service.metadata(e,t),this},authenticate:function(e){return this.service.authenticate(e),this},redraw:function(){this._update()},_renderImage:function(e,t,r){if(this._map){if(r&&(e="data:"+r+";base64,"+e),!e)return;var i=new Cr(e,t,{opacity:0,crossOrigin:this.options.withCredentials?"use-credentials":this.options.useCors,alt:this.options.alt,pane:this.options.pane||this.getPane(),interactive:this.options.interactive}).addTo(this._map),n=function(){this._map.removeLayer(i),this.fire("error"),i.off("load",s,this)},s=function(o){if(i.off("error",s,this),this._map){var l=o.target,h=this._currentImage;l._bounds.equals(t)&&l._bounds.equals(this._map.getBounds())?(this._currentImage=l,this.options.position==="front"?this.bringToFront():this.options.position==="back"&&this.bringToBack(),this.options.zIndex&&this.setZIndex(this.options.zIndex),this._map&&this._currentImage._map?this._currentImage.setOpacity(this.options.opacity):this._currentImage._map.removeLayer(this._currentImage),h&&this._map&&this._map.removeLayer(h),h&&h._map&&h._map.removeLayer(h)):this._map.removeLayer(l)}this.fire("load",{bounds:t})};i.once("error",n,this),i.once("load",s,this)}},_update:function(){if(!!this._map){var e=this._map.getZoom(),t=this._map.getBounds();if(!this._animatingZoom&&!(this._map._panTransition&&this._map._panTransition._inProgress)){if(e>this.options.maxZoom||e<this.options.minZoom){this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null);return}var r=this._buildExportParams();d.exports.Util.extend(r,this.options.requestParams),r?(this._requestExport(r,t),this.fire("loading",{bounds:t})):this._currentImage&&(this._currentImage._map.removeLayer(this._currentImage),this._currentImage=null)}}},_renderPopup:function(e,t,r,i){if(e=d.exports.latLng(e),this._shouldRenderPopup&&this._lastClick.equals(e)){var n=this._popupFunction(t,r,i);n&&this._popup.setLatLng(e).setContent(n).openOn(this._map)}},_resetPopupState:function(e){this._shouldRenderPopup=!1,this._lastClick=e.latlng},_calculateBbox:function(){var e=this._map.getPixelBounds(),t=this._map.unproject(e.getBottomLeft()),r=this._map.unproject(e.getTopRight()),i=this._map.options.crs.project(r),n=this._map.options.crs.project(t),s=d.exports.bounds(i,n);return[s.getBottomLeft().x,s.getBottomLeft().y,s.getTopRight().x,s.getTopRight().y].join(",")},_calculateImageSize:function(){var e=this._map.getPixelBounds(),t=this._map.getSize(),r=this._map.unproject(e.getBottomLeft()),i=this._map.unproject(e.getTopRight()),n=this._map.latLngToLayerPoint(i).y,s=this._map.latLngToLayerPoint(r).y;return(n>0||s<t.y)&&(t.y=s-n),t.x+","+t.y}});Ee.extend({options:{updateInterval:150,format:"jpgpng",transparent:!0,f:"image"},query:function(){return this.service.query()},identify:function(){return this.service.identify()},initialize:function(e){e=Tt(e),this.service=Tr(e),this.service.addEventParent(this),d.exports.Util.setOptions(this,e)},setPixelType:function(e){return this.options.pixelType=e,this._update(),this},getPixelType:function(){return this.options.pixelType},setBandIds:function(e){return d.exports.Util.isArray(e)?this.options.bandIds=e.join(","):this.options.bandIds=e.toString(),this._update(),this},getBandIds:function(){return this.options.bandIds},setNoData:function(e,t){return d.exports.Util.isArray(e)?this.options.noData=e.join(","):this.options.noData=e.toString(),t&&(this.options.noDataInterpretation=t),this._update(),this},getNoData:function(){return this.options.noData},getNoDataInterpretation:function(){return this.options.noDataInterpretation},setRenderingRule:function(e){this.options.renderingRule=e,this._update()},getRenderingRule:function(){return this.options.renderingRule},setMosaicRule:function(e){this.options.mosaicRule=e,this._update()},getMosaicRule:function(){return this.options.mosaicRule},_getPopupData:function(e){var t=d.exports.Util.bind(function(i,n,s){i||setTimeout(d.exports.Util.bind(function(){this._renderPopup(e.latlng,i,n,s)},this),300)},this),r=this.identify().at(e.latlng);this.options.mosaicRule&&r.setMosaicRule(this.options.mosaicRule),r.run(t),this._shouldRenderPopup=!0,this._lastClick=e.latlng},_buildExportParams:function(){var e=parseInt(this._map.options.crs.code.split(":")[1],10),t={bbox:this._calculateBbox(),size:this._calculateImageSize(),format:this.options.format,transparent:this.options.transparent,bboxSR:e,imageSR:e};return this.options.from&&this.options.to&&(t.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.options.pixelType&&(t.pixelType=this.options.pixelType),this.options.interpolation&&(t.interpolation=this.options.interpolation),this.options.compressionQuality&&(t.compressionQuality=this.options.compressionQuality),this.options.bandIds&&(t.bandIds=this.options.bandIds),(this.options.noData===0||this.options.noData)&&(t.noData=this.options.noData),this.options.noDataInterpretation&&(t.noDataInterpretation=this.options.noDataInterpretation),this.service.options.token&&(t.token=this.service.options.token),this.options.renderingRule&&(t.renderingRule=JSON.stringify(this.options.renderingRule)),this.options.mosaicRule&&(t.mosaicRule=JSON.stringify(this.options.mosaicRule)),t},_requestExport:function(e,t){if(this.options.f==="json")this.service.request("exportImage",e,function(i,n){i||(this.options.token&&(n.href+="?token="+this.options.token),this.options.proxy&&(n.href=this.options.proxy+"?"+n.href),this._renderImage(n.href,t))},this);else{e.f="image";var r=this.options.url+"exportImage"+d.exports.Util.getParamString(e);this.options.proxy&&(r=this.options.proxy+"?"+r),this._renderImage(r,t)}}});var Ar=Ee.extend({options:{updateInterval:150,layers:!1,layerDefs:!1,timeOptions:!1,format:"png32",transparent:!0,f:"json"},initialize:function(e){e=Tt(e),this.service=ye(e),this.service.addEventParent(this),d.exports.Util.setOptions(this,e)},getDynamicLayers:function(){return this.options.dynamicLayers},setDynamicLayers:function(e){return this.options.dynamicLayers=e,this._update(),this},getLayers:function(){return this.options.layers},setLayers:function(e){return this.options.layers=e,this._update(),this},getLayerDefs:function(){return this.options.layerDefs},setLayerDefs:function(e){return this.options.layerDefs=e,this._update(),this},getTimeOptions:function(){return this.options.timeOptions},setTimeOptions:function(e){return this.options.timeOptions=e,this._update(),this},query:function(){return this.service.query()},identify:function(){return this.service.identify()},find:function(){return this.service.find()},_getPopupData:function(e){var t=d.exports.Util.bind(function(n,s,o){n||setTimeout(d.exports.Util.bind(function(){this._renderPopup(e.latlng,n,s,o)},this),300)},this),r;if(this.options.popup?r=this.options.popup.on(this._map).at(e.latlng):r=this.identify().on(this._map).at(e.latlng),r.params.maxAllowableOffset||r.simplify(this._map,.5),this.options.popup&&this.options.popup.params&&this.options.popup.params.layers||(this.options.layers?r.layers("visible:"+this.options.layers.join(",")):r.layers("visible")),this.options.layerDefs&&typeof this.options.layerDefs!="string"&&!r.params.layerDefs)for(var i in this.options.layerDefs)this.options.layerDefs.hasOwnProperty(i)&&r.layerDef(i,this.options.layerDefs[i]);r.run(t),this._shouldRenderPopup=!0,this._lastClick=e.latlng},_buildExportParams:function(){var e=parseInt(this._map.options.crs.code.split(":")[1],10),t={bbox:this._calculateBbox(),size:this._calculateImageSize(),dpi:96,format:this.options.format,transparent:this.options.transparent,bboxSR:e,imageSR:e};if(this.options.dynamicLayers&&(t.dynamicLayers=this.options.dynamicLayers),this.options.layers){if(this.options.layers.length===0)return;t.layers="show:"+this.options.layers.join(",")}return this.options.layerDefs&&(t.layerDefs=typeof this.options.layerDefs=="string"?this.options.layerDefs:JSON.stringify(this.options.layerDefs)),this.options.timeOptions&&(t.timeOptions=JSON.stringify(this.options.timeOptions)),this.options.from&&this.options.to&&(t.time=this.options.from.valueOf()+","+this.options.to.valueOf()),this.service.options.token&&(t.token=this.service.options.token),this.options.proxy&&(t.proxy=this.options.proxy),this.options.disableCache&&(t._ts=Date.now()),t},_requestExport:function(e,t){if(this.options.f==="json")this.service.request("export",e,function(i,n){i||(this.options.token&&n.href&&(n.href+="?token="+this.options.token),this.options.proxy&&n.href&&(n.href=this.options.proxy+"?"+n.href),n.href?this._renderImage(n.href,t):this._renderImage(n.imageData,t,n.contentType))},this);else{e.f="image";var r=this.options.url+"export"+d.exports.Util.getParamString(e);this.options.proxy&&(r=this.options.proxy+"?"+r),this._renderImage(r,t)}}});function xr(e,t){return new Ar(e,t)}var Nt=d.exports.Layer.extend({options:{cellSize:512,updateWhenIdle:d.exports.Browser.mobile,updateInterval:150,noWrap:!1,keepBuffer:1.5},initialize:function(e){d.exports.Util.setOptions(this,e)},onAdd:function(e){this._cells={},this._activeCells={},this._resetView(),this._update()},onRemove:function(e){this._removeAllCells(),this._cellZoom=void 0},isLoading:function(){return this._loading},redraw:function(){return this._map&&(this._removeAllCells(),this._update()),this},getEvents:function(){var e={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=d.exports.Util.throttle(this._onMoveEnd,this.options.updateInterval,this)),e.move=this._onMove),e},createCell:function(){return document.createElement("div")},removeCell:function(){},reuseCell:function(){},cellLeave:function(){},cellEnter:function(){},getCellSize:function(){var e=this.options.cellSize;return e instanceof d.exports.Point?e:new d.exports.Point(e,e)},_pruneCells:function(){if(!!this._map){var e,t;for(e in this._cells)t=this._cells[e],t.retain=t.current;for(e in this._cells)if(t=this._cells[e],t.current&&!t.active){var r=t.coords;this._retainParent(r.x,r.y,r.z,r.z-5)||this._retainChildren(r.x,r.y,r.z,r.z+2)}for(e in this._cells)this._cells[e].retain||this._removeCell(e)}},_removeAllCells:function(){for(var e in this._cells)this._removeCell(e)},_invalidateAll:function(){this._removeAllCells(),this._cellZoom=void 0},_retainParent:function(e,t,r,i){var n=Math.floor(e/2),s=Math.floor(t/2),o=r-1,l=new d.exports.Point(+n,+s);l.z=+o;var h=this._cellCoordsToKey(l),f=this._cells[h];return f&&f.active?(f.retain=!0,!0):(f&&f.loaded&&(f.retain=!0),o>i?this._retainParent(n,s,o,i):!1)},_retainChildren:function(e,t,r,i){for(var n=2*e;n<2*e+2;n++)for(var s=2*t;s<2*t+2;s++){var o=new d.exports.Point(n,s);o.z=r+1;var l=this._cellCoordsToKey(o),h=this._cells[l];if(h&&h.active){h.retain=!0;continue}else h&&h.loaded&&(h.retain=!0);r+1<i&&this._retainChildren(n,s,r+1,i)}},_resetView:function(e){var t=e&&(e.pinch||e.flyTo);t||this._setView(this._map.getCenter(),this._map.getZoom(),t,t)},_setView:function(e,t,r,i){var n=Math.round(t);i||(this._cellZoom=n,this._abortLoading&&this._abortLoading(),this._resetGrid(),n!==void 0&&this._update(e),r||this._pruneCells(),this._noPrune=!!r)},_resetGrid:function(){var e=this._map,t=e.options.crs,r=this._cellSize=this.getCellSize(),i=this._cellZoom,n=this._map.getPixelWorldBounds(this._cellZoom);n&&(this._globalCellRange=this._pxBoundsToCellRange(n)),this._wrapX=t.wrapLng&&!this.options.noWrap&&[Math.floor(e.project([0,t.wrapLng[0]],i).x/r.x),Math.ceil(e.project([0,t.wrapLng[1]],i).x/r.y)],this._wrapY=t.wrapLat&&!this.options.noWrap&&[Math.floor(e.project([t.wrapLat[0],0],i).y/r.x),Math.ceil(e.project([t.wrapLat[1],0],i).y/r.y)]},_onMoveEnd:function(e){var t=e&&(e.pinch||e.flyTo);t||!this._map||this._map._animatingZoom||this._update()},_getCelldPixelBounds:function(e){var t=this._map,r=t._animatingZoom?Math.max(t._animateToZoom,t.getZoom()):t.getZoom(),i=t.getZoomScale(r,this._cellZoom),n=t.project(e,this._cellZoom).floor(),s=t.getSize().divideBy(i*2);return new d.exports.Bounds(n.subtract(s),n.add(s))},_update:function(e){var t=this._map;if(!!t){var r=Math.round(t.getZoom());e===void 0&&(e=t.getCenter());var i=this._getCelldPixelBounds(e),n=this._pxBoundsToCellRange(i),s=n.getCenter(),o=[],l=this.options.keepBuffer,h=new d.exports.Bounds(n.getBottomLeft().subtract([l,-l]),n.getTopRight().add([l,-l]));if(!(isFinite(n.min.x)&&isFinite(n.min.y)&&isFinite(n.max.x)&&isFinite(n.max.y)))throw new Error("Attempted to load an infinite number of cells");for(var f in this._cells){var p=this._cells[f].coords;(p.z!==this._cellZoom||!h.contains(new d.exports.Point(p.x,p.y)))&&(this._cells[f].current=!1)}if(Math.abs(r-this._cellZoom)>1){this._setView(e,r);return}for(var g=n.min.y;g<=n.max.y;g++)for(var y=n.min.x;y<=n.max.x;y++){var S=new d.exports.Point(y,g);if(S.z=this._cellZoom,!!this._isValidCell(S)){var _=this._cells[this._cellCoordsToKey(S)];_?_.current=!0:o.push(S)}}if(o.sort(function(v,u){return v.distanceTo(s)-u.distanceTo(s)}),o.length!==0)for(this._loading||(this._loading=!0),y=0;y<o.length;y++){var N=this._cellCoordsToKey(o[y]),c=this._keyToCellCoords(N);this._activeCells[c]?this._reuseCell(o[y]):this._createCell(o[y])}}},_isValidCell:function(e){var t=this._map.options.crs;if(!t.infinite){var r=this._globalCellRange;if(!t.wrapLng&&(e.x<r.min.x||e.x>r.max.x)||!t.wrapLat&&(e.y<r.min.y||e.y>r.max.y))return!1}if(!this.options.bounds)return!0;var i=this._cellCoordsToBounds(e);return d.exports.toLatLngBounds(this.options.bounds).overlaps(i)},_keyToBounds:function(e){return this._cellCoordsToBounds(this._keyToCellCoords(e))},_cellCoordsToNwSe:function(e){var t=this._map,r=this.getCellSize(),i=e.scaleBy(r),n=i.add(r),s=t.unproject(i,e.z),o=t.unproject(n,e.z);return[s,o]},_cellCoordsToBounds:function(e){var t=this._cellCoordsToNwSe(e),r=new d.exports.LatLngBounds(t[0],t[1]);return this.options.noWrap||(r=this._map.wrapLatLngBounds(r)),r},_cellCoordsToKey:function(e){return e.x+":"+e.y+":"+e.z},_keyToCellCoords:function(e){var t=e.split(":"),r=new d.exports.Point(+t[0],+t[1]);return r.z=+t[2],r},_removeCell:function(e){var t=this._cells[e];if(!!t){var r=this._keyToCellCoords(e),i=this._wrapCoords(r),n=this._cellCoordsToBounds(this._wrapCoords(r));t.current=!1,delete this._cells[e],this._activeCells[e]=t,this.cellLeave(n,i,e),this.fire("cellleave",{key:e,coords:i,bounds:n})}},_reuseCell:function(e){var t=this._cellCoordsToKey(e);this._cells[t]=this._activeCells[t],this._cells[t].current=!0;var r=this._wrapCoords(e),i=this._cellCoordsToBounds(this._wrapCoords(e));this.cellEnter(i,r,t),this.fire("cellenter",{key:t,coords:r,bounds:i})},_createCell:function(e){var t=this._cellCoordsToKey(e),r=this._wrapCoords(e),i=this._cellCoordsToBounds(this._wrapCoords(e));this.createCell(i,r,t),this.fire("cellcreate",{key:t,coords:r,bounds:i}),this._cells[t]={coords:e,current:!0},d.exports.Util.requestAnimFrame(this._pruneCells,this)},_cellReady:function(e,t,r){var i=this._cellCoordsToKey(e);r=this._cells[i],!!r&&(r.loaded=+new Date,r.active=!0)},_getCellPos:function(e){return e.scaleBy(this.getCellSize())},_wrapCoords:function(e){var t=new d.exports.Point(this._wrapX?d.exports.Util.wrapNum(e.x,this._wrapX):e.x,this._wrapY?d.exports.Util.wrapNum(e.y,this._wrapY):e.y);return t.z=e.z,t},_pxBoundsToCellRange:function(e){var t=this.getCellSize();return new d.exports.Bounds(e.min.unscaleBy(t).floor(),e.max.unscaleBy(t).ceil().subtract([1,1]))}});function K(e){this.values=[].concat(e||[])}K.prototype.query=function(e){var t=this.getIndex(e);return this.values[t]};K.prototype.getIndex=function(t){this.dirty&&this.sort();for(var r=0,i=this.values.length-1,n,s;r<=i;)if(n=(r+i)/2|0,s=this.values[Math.round(n)],+s.value<+t)r=n+1;else if(+s.value>+t)i=n-1;else return n;return Math.abs(~i)};K.prototype.between=function(t,r){var i=this.getIndex(t),n=this.getIndex(r);if(i===0&&n===0)return[];for(;this.values[i-1]&&this.values[i-1].value===t;)i--;for(;this.values[n+1]&&this.values[n+1].value===r;)n++;return this.values[n]&&this.values[n].value===r&&this.values[n+1]&&n++,this.values.slice(i,n)};K.prototype.insert=function(t){return this.values.splice(this.getIndex(t.value),0,t),this};K.prototype.bulkAdd=function(t,r){return this.values=this.values.concat([].concat(t||[])),r?this.sort():this.dirty=!0,this};K.prototype.sort=function(){return this.values.sort(function(t,r){return+r.value-+t.value}).reverse(),this.dirty=!1,this};var Wt=Nt.extend({options:{attribution:null,where:"1=1",fields:["*"],from:!1,to:!1,timeField:!1,timeFilterMode:"server",simplifyFactor:0,precision:6,fetchAllFeatures:!1},initialize:function(e){if(Nt.prototype.initialize.call(this,e),e=Tt(e),e=d.exports.Util.setOptions(this,e),this.service=Rr(e),this.service.addEventParent(this),this.options.fields[0]!=="*"){for(var t=!1,r=0;r<this.options.fields.length;r++)this.options.fields[r].match(/^(OBJECTID|FID|OID|ID)$/i)&&(t=!0);t===!1&&et("no known esriFieldTypeOID field detected in fields Array.  Please add an attribute field containing unique IDs to ensure the layer can be drawn correctly.")}this.options.timeField.start&&this.options.timeField.end?(this._startTimeIndex=new K,this._endTimeIndex=new K):this.options.timeField&&(this._timeIndex=new K),this._cache={},this._currentSnapshot=[],this._activeRequests=0},onAdd:function(e){return It(e),this.service.metadata(function(t,r){if(!t){var i=r.supportedQueryFormats,n=!1;(this.service.options.isModern===!1||this.options.fetchAllFeatures)&&(n=!0),!n&&i&&i.indexOf("geoJSON")!==-1&&(this.service.options.isModern=!0),r.objectIdField&&(this.service.options.idAttribute=r.objectIdField),!this.options.attribution&&e.attributionControl&&r.copyrightText&&(this.options.attribution=r.copyrightText,e.attributionControl.addAttribution(this.getAttribution()))}},this),e.on("zoomend",this._handleZoomChange,this),Nt.prototype.onAdd.call(this,e)},onRemove:function(e){return Rt(e),e.off("zoomend",this._handleZoomChange,this),Nt.prototype.onRemove.call(this,e)},getAttribution:function(){return this.options.attribution},createCell:function(e,t){this._visibleZoom()&&this._requestFeatures(e,t)},_requestFeatures:function(e,t,r,i){this._activeRequests++,i=i||0;var n=this.options.where;return this._activeRequests===1&&this.fire("loading",{bounds:e},!0),this._buildQuery(e,i).run(function(s,o,l){l&&l.exceededTransferLimit&&this.fire("drawlimitexceeded"),this.options.where===n&&(!s&&o&&o.features.length&&d.exports.Util.requestAnimFrame(d.exports.Util.bind(function(){this._addFeatures(o.features,t),this._postProcessFeatures(e)},this)),!s&&o&&!o.features.length&&this._postProcessFeatures(e),s&&this._postProcessFeatures(e),r&&r.call(this,s,o),l&&(l.exceededTransferLimit||l.properties&&l.properties.exceededTransferLimit)&&this.options.fetchAllFeatures&&this._requestFeatures(e,t,r,i+o.features.length))},this)},_postProcessFeatures:function(e){this._activeRequests--,this._activeRequests<=0&&this.fire("load",{bounds:e})},_cacheKey:function(e){return e.z+":"+e.x+":"+e.y},_addFeatures:function(e,t){if(t){var r=this._cacheKey(t);this._cache[r]=this._cache[r]||[]}for(var i=e.length-1;i>=0;i--){var n=e[i].id;this._currentSnapshot.indexOf(n)===-1&&this._currentSnapshot.push(n),typeof r!="undefined"&&this._cache[r].indexOf(n)===-1&&this._cache[r].push(n)}this.options.timeField&&this._buildTimeIndexes(e),this.createLayers(e)},_buildQuery:function(e,t){var r=this.service.query().intersects(e).where(this.options.where).fields(this.options.fields).precision(this.options.precision);return this.options.fetchAllFeatures&&!isNaN(parseInt(t))&&(r=r.offset(t)),r.params.resultType="tile",this.options.requestParams&&d.exports.Util.extend(r.params,this.options.requestParams),this.options.simplifyFactor&&r.simplify(this._map,this.options.simplifyFactor),this.options.timeFilterMode==="server"&&this.options.from&&this.options.to&&r.between(this.options.from,this.options.to),r},setWhere:function(e,t,r){this.options.where=e&&e.length?e:"1=1";for(var i=[],n=[],s=0,o=null,l=d.exports.Util.bind(function(y,S){if(y&&(o=y),S)for(var _=S.features.length-1;_>=0;_--)n.push(S.features[_].id);s--,s<=0&&this._visibleZoom()&&e===this.options.where&&(this._currentSnapshot=n,d.exports.Util.requestAnimFrame(d.exports.Util.bind(function(){this.removeLayers(i),this.addLayers(n),t&&t.call(r,o)},this)))},this),h=this._currentSnapshot.length-1;h>=0;h--)i.push(this._currentSnapshot[h]);this._cache={};for(var f in this._cells){s++;var p=this._keyToCellCoords(f),g=this._cellCoordsToBounds(p);this._requestFeatures(g,p,l)}return this},getWhere:function(){return this.options.where},getTimeRange:function(){return[this.options.from,this.options.to]},setTimeRange:function(e,t,r,i){var n=this.options.from,s=this.options.to,o=0,l=null,h=d.exports.Util.bind(function(y){y&&(l=y),this._filterExistingFeatures(n,s,e,t),o--,r&&o<=0&&r.call(i,l)},this);if(this.options.from=e,this.options.to=t,this._filterExistingFeatures(n,s,e,t),this.options.timeFilterMode==="server")for(var f in this._cells){o++;var p=this._keyToCellCoords(f),g=this._cellCoordsToBounds(p);this._requestFeatures(g,p,h)}return this},refresh:function(){this.setWhere(this.options.where)},_filterExistingFeatures:function(e,t,r,i){var n=e&&t?this._getFeaturesInTimeRange(e,t):this._currentSnapshot,s=this._getFeaturesInTimeRange(r,i);if(s.indexOf)for(var o=0;o<s.length;o++){var l=n.indexOf(s[o]);l>=0&&n.splice(l,1)}d.exports.Util.requestAnimFrame(d.exports.Util.bind(function(){this.removeLayers(n),this.addLayers(s)},this))},_getFeaturesInTimeRange:function(e,t){var r=[],i;if(this.options.timeField.start&&this.options.timeField.end){var n=this._startTimeIndex.between(e,t),s=this._endTimeIndex.between(e,t);i=n.concat(s)}else if(this._timeIndex)i=this._timeIndex.between(e,t);else return et("You must set timeField in the layer constructor in order to manipulate the start and end time filter."),[];for(var o=i.length-1;o>=0;o--)r.push(i[o].id);return r},_buildTimeIndexes:function(e){var t,r;if(this.options.timeField.start&&this.options.timeField.end){var i=[],n=[];for(t=e.length-1;t>=0;t--)r=e[t],i.push({id:r.id,value:new Date(r.properties[this.options.timeField.start])}),n.push({id:r.id,value:new Date(r.properties[this.options.timeField.end])});this._startTimeIndex.bulkAdd(i),this._endTimeIndex.bulkAdd(n)}else{var s=[];for(t=e.length-1;t>=0;t--)r=e[t],s.push({id:r.id,value:new Date(r.properties[this.options.timeField])});this._timeIndex.bulkAdd(s)}},_featureWithinTimeRange:function(e){if(!this.options.from||!this.options.to)return!0;var t=+this.options.from.valueOf(),r=+this.options.to.valueOf();if(typeof this.options.timeField=="string"){var i=+e.properties[this.options.timeField];return i>=t&&i<=r}if(this.options.timeField.start&&this.options.timeField.end){var n=+e.properties[this.options.timeField.start],s=+e.properties[this.options.timeField.end];return n>=t&&n<=r||s>=t&&s<=r||n<=t&&s>=r}},_visibleZoom:function(){if(!this._map)return!1;var e=this._map.getZoom();return!(e>this.options.maxZoom||e<this.options.minZoom)},_handleZoomChange:function(){if(!this._visibleZoom())this.removeLayers(this._currentSnapshot);else for(var e in this._cells){var t=this._cells[e].coords,r=this._cacheKey(t);this._cache[r]&&this.addLayers(this._cache[r])}},authenticate:function(e){return this.service.authenticate(e),this},metadata:function(e,t){return this.service.metadata(e,t),this},query:function(){return this.service.query()},_getMetadata:function(e){if(this._metadata){var t;e(t,this._metadata)}else this.metadata(d.exports.Util.bind(function(r,i){this._metadata=i,e(r,this._metadata)},this))},addFeature:function(e,t,r){this.addFeatures(e,t,r)},addFeatures:function(e,t,r){this._getMetadata(d.exports.Util.bind(function(i,n){if(i){t&&t.call(this,i,null);return}var s=e.features?e.features:[e];this.service.addFeatures(e,d.exports.Util.bind(function(o,l){if(!o){for(var h=s.length-1;h>=0;h--)s[h].properties[n.objectIdField]=s.length>1?l[h].objectId:l.objectId,s[h].id=s.length>1?l[h].objectId:l.objectId;this._addFeatures(s)}t&&t.call(r,o,l)},this))},this))},updateFeature:function(e,t,r){this.updateFeatures(e,t,r)},updateFeatures:function(e,t,r){var i=e.features?e.features:[e];this.service.updateFeatures(e,function(n,s){if(!n){for(var o=i.length-1;o>=0;o--)this.removeLayers([i[o].id],!0);this._addFeatures(i)}t&&t.call(r,n,s)},this)},deleteFeature:function(e,t,r){this.deleteFeatures(e,t,r)},deleteFeatures:function(e,t,r){return this.service.deleteFeatures(e,function(i,n){var s=n.length?n:[n];if(!i&&s.length>0)for(var o=s.length-1;o>=0;o--)this.removeLayers([s[o].objectId],!0);t&&t.call(r,i,n)},this)}});Wt.extend({options:{cacheLayers:!0},initialize:function(e){e.apikey&&(e.token=e.apikey),Wt.prototype.initialize.call(this,e),this._originalStyle=this.options.style,this._layers={}},onRemove:function(e){for(var t in this._layers)e.removeLayer(this._layers[t]),this.fire("removefeature",{feature:this._layers[t].feature,permanent:!1},!0);return Wt.prototype.onRemove.call(this,e)},createNewLayer:function(e){var t=d.exports.GeoJSON.geometryToLayer(e,this.options);return t&&(t.defaultOptions=t.options),t},_updateLayer:function(e,t){var r=[],i=this.options.coordsToLatLng||d.exports.GeoJSON.coordsToLatLng;switch(t.properties&&(e.feature.properties=t.properties),t.geometry.type){case"Point":r=d.exports.GeoJSON.coordsToLatLng(t.geometry.coordinates),e.setLatLng(r);break;case"LineString":r=d.exports.GeoJSON.coordsToLatLngs(t.geometry.coordinates,0,i),e.setLatLngs(r);break;case"MultiLineString":r=d.exports.GeoJSON.coordsToLatLngs(t.geometry.coordinates,1,i),e.setLatLngs(r);break;case"Polygon":r=d.exports.GeoJSON.coordsToLatLngs(t.geometry.coordinates,1,i),e.setLatLngs(r);break;case"MultiPolygon":r=d.exports.GeoJSON.coordsToLatLngs(t.geometry.coordinates,2,i),e.setLatLngs(r);break}},createLayers:function(e){for(var t=e.length-1;t>=0;t--){var r=e[t],i=this._layers[r.id],n;this._visibleZoom()&&i&&!this._map.hasLayer(i)&&(!this.options.timeField||this._featureWithinTimeRange(r))&&(this._map.addLayer(i),this.fire("addfeature",{feature:i.feature},!0)),i&&this.options.simplifyFactor>0&&(i.setLatLngs||i.setLatLng)&&this._updateLayer(i,r),i||(n=this.createNewLayer(r),n?(n.feature=r,n.addEventParent(this),this.options.onEachFeature&&this.options.onEachFeature(n.feature,n),this._layers[n.feature.id]=n,this.setFeatureStyle(n.feature.id,this.options.style),this.fire("createfeature",{feature:n.feature},!0),this._visibleZoom()&&(!this.options.timeField||this.options.timeField&&this._featureWithinTimeRange(r))&&this._map.addLayer(n)):et("invalid GeoJSON encountered"))}},addLayers:function(e){for(var t=e.length-1;t>=0;t--){var r=this._layers[e[t]];r&&(!this.options.timeField||this._featureWithinTimeRange(r.feature))&&this._map.addLayer(r)}},removeLayers:function(e,t){for(var r=e.length-1;r>=0;r--){var i=e[r],n=this._layers[i];n&&(this.fire("removefeature",{feature:n.feature,permanent:t},!0),this._map.removeLayer(n)),n&&t&&delete this._layers[i]}},cellEnter:function(e,t){this._visibleZoom()&&!this._zooming&&this._map&&d.exports.Util.requestAnimFrame(d.exports.Util.bind(function(){var r=this._cacheKey(t),i=this._cellCoordsToKey(t),n=this._cache[r];this._activeCells[i]&&n&&this.addLayers(n)},this))},cellLeave:function(e,t){this._zooming||d.exports.Util.requestAnimFrame(d.exports.Util.bind(function(){if(this._map){var r=this._cacheKey(t),i=this._cellCoordsToKey(t),n=this._cache[r],s=this._map.getBounds();if(!this._activeCells[i]&&n){for(var o=!0,l=0;l<n.length;l++){var h=this._layers[n[l]];h&&h.getBounds&&s.intersects(h.getBounds())&&(o=!1)}o&&this.removeLayers(n,!this.options.cacheLayers),!this.options.cacheLayers&&o&&(delete this._cache[r],delete this._cells[i],delete this._activeCells[i])}}},this))},resetStyle:function(){return this.options.style=this._originalStyle,this.eachFeature(function(e){this.resetFeatureStyle(e.feature.id)},this),this},setStyle:function(e){return this.options.style=e,this.eachFeature(function(t){this.setFeatureStyle(t.feature.id,e)},this),this},resetFeatureStyle:function(e){var t=this._layers[e],r=this._originalStyle||d.exports.Path.prototype.options;return t&&(d.exports.Util.extend(t.options,t.defaultOptions),this.setFeatureStyle(e,r)),this},setFeatureStyle:function(e,t){var r=this._layers[e];return typeof t=="function"&&(t=t(r.feature)),r.setStyle&&r.setStyle(t),this},eachActiveFeature:function(e,t){if(this._map){var r=this._map.getBounds();for(var i in this._layers)this._currentSnapshot.indexOf(this._layers[i].feature.id)!==-1&&(typeof this._layers[i].getLatLng=="function"&&r.contains(this._layers[i].getLatLng())?e.call(t,this._layers[i]):typeof this._layers[i].getBounds=="function"&&r.intersects(this._layers[i].getBounds())&&e.call(t,this._layers[i]))}return this},eachFeature:function(e,t){for(var r in this._layers)e.call(t,this._layers[r]);return this},getFeature:function(e){return this._layers[e]},bringToBack:function(){this.eachFeature(function(e){e.bringToBack&&e.bringToBack()})},bringToFront:function(){this.eachFeature(function(e){e.bringToFront&&e.bringToFront()})},redraw:function(e){return e&&this._redraw(e),this},_redraw:function(e){var t=this._layers[e],r=t.feature;if(t&&t.setIcon&&this.options.pointToLayer&&this.options.pointToLayer){var i=this.options.pointToLayer(r,d.exports.latLng(r.geometry.coordinates[1],r.geometry.coordinates[0])),n=i.options.icon;t.setIcon(n)}if(t&&t.setStyle&&this.options.pointToLayer){var s=this.options.pointToLayer(r,d.exports.latLng(r.geometry.coordinates[1],r.geometry.coordinates[0])),o=s.options;this.setFeatureStyle(r.id,o)}t&&t.setStyle&&this.options.style&&this.resetStyle(r.id)}});const{TabPane:Or}=Jt,{Item:Lr}=zt,{Option:Pr}=Zt;let Ct;const wr=Te({name:"geoJson",components:{Container:_e,Tabs:Jt,TabPane:Or,Table:Ie,Empty:Re,Form:zt,Item:Lr,Input:Ne,Select:Zt,SelectOption:Pr,Button:Ce},data:()=>({map:void 0,editor:void 0,geoJson:{type:"FeatureCollection",features:[]},geoJsonLayer:void 0,selectedFeature:void 0,editorUpdated:!1,editorUpdateTimeout:void 0,editableData:{},tdtToken:"bed806b1ccb34b268ab1c0700123d444",gaodeToken:"868d6830a7409520ae283cde3a3f84d1",service:{id:1,name:"\u670D\u52A1 1",url:"",type:"supermap_rest"}}),computed:{tableColumns(){if(this.propertyList&&this.propertyList.length>0){const t=Object.keys(this.propertyList[0]).map(r=>({title:r,dataIndex:r,key:r,slots:{customRender:"property"}}));return t.push({title:"\u64CD\u4F5C",dataIndex:"operation",width:40,fixed:"right",slots:{customRender:"operation"}}),t}else return null},propertyList(){return this.features?this.features.map(e=>e.properties):null},features(){if(this.geoJsonLayer)try{return this.geoJsonLayer.toGeoJSON().features}catch(e){return null}return null}},mounted(){this.editor=Vt(new Ue(this.$refs.geoJsonContainer,{mode:"code",onChangeText:()=>{this.editorUpdated=!0,this.editorUpdateTimeout&&(clearTimeout(this.editorUpdateTimeout),this.editorUpdateTimeout=void 0),this.editorUpdateTimeout=setTimeout(()=>{this.updateGeoJsonLayer(),this.editorUpdated=!1,this.editorUpdateTimeout=void 0},5e3)},onBlur:()=>{this.editorUpdateTimeout&&(clearTimeout(this.editorUpdateTimeout),this.editorUpdateTimeout=void 0),this.editorUpdated&&(this.updateGeoJsonLayer(),this.editorUpdated=!1)}},this.geoJson)),this.initMap()},methods:{initMap(){this.map=Vt(d.exports.map(this.$refs.mapContainer,{attributionControl:!0,zoomControl:!1})),this.map.setView([35,105],4),this.geoJsonLayer=d.exports.geoJSON(void 0,{onEachFeature:this.onEachFeature}).addTo(this.map),Ct=d.exports.control.layers({\u9AD8\u5FB7\u77E2\u91CF:W("GaoDe.Normal.Map",{minZoom:3,maxNativeZoom:18,maxZoom:20,attribution:'&copy; <a href="https://lbs.amap.com/pages/terms/" target="_blank">\u9AD8\u5FB7\u5730\u56FE</a> \u8D21\u732E\u8005'}).addTo(this.map),\u9AD8\u5FB7\u5F71\u50CF:d.exports.layerGroup([W("GaoDe.Satellite.Map",{minZoom:3,maxNativeZoom:18,maxZoom:20}),W("GaoDe.Satellite.Annotation",{minZoom:3,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://lbs.amap.com/pages/terms/" target="_blank">\u9AD8\u5FB7\u5730\u56FE</a> \u8D21\u732E\u8005'}),\u5929\u5730\u56FE\u77E2\u91CF:d.exports.layerGroup([W("TianDiTu.Normal.Map",{key:this.tdtToken,minZoom:3,maxNativeZoom:18,maxZoom:20}),W("TianDiTu.Normal.Annotation",{key:this.tdtToken,minZoom:3,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">\u5929\u5730\u56FE</a> \u8D21\u732E\u8005'}),\u5929\u5730\u56FE\u5F71\u50CF:d.exports.layerGroup([W("TianDiTu.Satellite.Map",{key:this.tdtToken,minZoom:3,maxNativeZoom:18,maxZoom:20}),W("TianDiTu.Satellite.Annotation",{key:this.tdtToken,minZoom:3,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">\u5929\u5730\u56FE</a> \u8D21\u732E\u8005'}),\u5929\u5730\u56FE\u5730\u5F62:d.exports.layerGroup([W("TianDiTu.Terrain.Map",{key:this.tdtToken,minZoom:3,maxNativeZoom:14,maxZoom:20}),W("TianDiTu.Terrain.Annotation",{key:this.tdtToken,minZoom:3,maxNativeZoom:14,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">\u5929\u5730\u56FE</a> \u8D21\u732E\u8005'}),OpenStreetMap:W("OSM.Normal.Map",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> \u8D21\u732E\u8005'})},{\u56FE\u5F62:Ae(this.geoJsonLayer)},{hideSingleBase:!0,position:"topright"}).addTo(this.map),d.exports.control.scale({imperial:!1,position:"bottomleft"}).addTo(this.map),d.exports.control.zoom({zoomInTitle:"\u653E\u5927",zoomOutTitle:"\u7F29\u5C0F",position:"bottomright"}).addTo(this.map)},updateGeoJsonLayer(){this.geoJsonLayer&&this.geoJsonLayer instanceof d.exports.GeoJSON&&this.geoJsonLayer.clearLayers();try{this.geoJson=this.editor.get();try{this.geoJsonLayer.addData(this.geoJson);const e=this.geoJsonLayer.getBounds(),t=e.getCenter(),r=this.map.getBoundsZoom(e);this.map.setView(t,r)}catch(e){}}catch(e){this.geoJson=void 0}},locationGeo(e){try{const r=d.exports.geoJSON(e).getBounds(),i=r.getCenter(),n=this.map.getBoundsZoom(r);this.map.setView(i,n)}catch(t){}},onEachFeature(e,t){e.properties&&t.bindPopup(this.$refs.propertyPopup).on("popupopen",()=>{this.selectedFeature=e,t.setStyle({color:"#ff7800",weight:5,opacity:.65})}).on("popupclose",()=>{this.selectedFeature=void 0,this.geoJsonLayer.resetStyle()})},saveToEditor(e,t,r){if(e instanceof InputEvent&&t&&r)try{t.properties[r]=JSON.parse(e.currentTarget.value)}catch(i){t.properties[r]=e.currentTarget.value}this.geoJson=this.geoJsonLayer.toGeoJSON(),this.editor.update(this.geoJson)},saveToEditableData(e,t,r){if(e instanceof InputEvent&&t&&r)try{t[r]=JSON.parse(e.currentTarget.value)}catch(i){t[r]=e.currentTarget.value}},edit(e){this.editableData[e]=xe(this.propertyList[e])},save(e){Object.assign(this.propertyList[e],this.editableData[e]),delete this.editableData[e]},cancel(e){delete this.editableData[e]},addService(){const e=this.service.url,t=this.service.type,r=this.service.name;switch(this.service.id++,this.service.name="\u670D\u52A1 "+this.service.id,t){case"supermap_rest":case"supermap_tile":{try{const i=Ye(e,{prjCoordSys:{epsgCode:3857},crs:d.exports.CRS.EPSG3857}).addTo(this.map);Ct.addOverlay(i,r)}catch(i){this.$msg.error("\u6DFB\u52A0\u670D\u52A1\u5931\u8D25")}break}case"arcgis_rest":{try{const i=xr({url:e,f:"image"});i.addTo(this.map),Ct.addOverlay(i,r)}catch(i){console.log(i),this.$msg.error("\u6DFB\u52A0\u670D\u52A1\u5931\u8D25")}break}case"arcgis_tile":{try{const i=Nr({url:e});i.addTo(this.map),Ct.addOverlay(i,r)}catch(i){console.log(i),this.$msg.error("\u6DFB\u52A0\u670D\u52A1\u5931\u8D25")}break}}},rowEvents(e,t){return{onClick:()=>{this.locationGeo(this.features[t])}}}},beforeUnmount(){this.map&&(this.map.remove(),this.map=void 0),this.editor&&(this.editor.destroy(),this.editor=void 0)}}),br={class:"container"},Mr={class:"mapContainer",ref:"mapContainer"},Ur={class:"propertyPopup",ref:"propertyPopup"},Dr={class:"geoJsonContainer",ref:"geoJsonContainer"},Gr={key:0,class:"editable-cell-input-wrapper"},Fr={key:1,class:"editable-cell-text-wrapper"},Br={key:0},kr=["onClick"],Hr=["onClick"],qr={key:1},Wr=["onClick"],Jr=at("\u8D85\u56FE\u52A8\u6001"),zr=at("\u8D85\u56FE\u5207\u7247"),Zr=at("ArcGIS \u52A8\u6001"),Vr=at("ArcGIS \u5207\u7247"),Kr=at("\u6DFB\u52A0");function Yr(e,t,r,i,n,s){const o=k("Input"),l=k("Item"),h=k("Form"),f=k("TabPane"),p=k("Table"),g=k("Empty"),y=k("SelectOption"),S=k("Select"),_=k("Button"),N=k("Tabs"),c=k("container");return U(),H(c,null,{default:P(()=>{var v;return[$("div",br,[$("div",Mr,null,512),Oe($("div",Ur,[((v=e.selectedFeature)==null?void 0:v.properties)?(U(),H(h,{key:0,"label-col":{span:6},"wrapper-col":{span:18},colon:!1},{default:P(()=>[(U(!0),ot(Pe,null,Le(e.selectedFeature.properties,(u,m,E)=>(U(),H(l,{label:m,key:"prop"+E},{default:P(()=>[typeof e.selectedFeature.properties[m]=="string"?(U(),H(o,{key:0,value:e.selectedFeature.properties[m],"onUpdate:value":R=>e.selectedFeature.properties[m]=R,onChange:e.saveToEditor},null,8,["value","onUpdate:value","onChange"])):typeof e.selectedFeature.properties[m]=="number"?(U(),H(o,{key:1,value:e.selectedFeature.properties[m],"onUpdate:value":R=>e.selectedFeature.properties[m]=R,valueModifiers:{number:!0},onChange:e.saveToEditor},null,8,["value","onUpdate:value","onChange"])):(U(),H(o,{key:2,value:JSON.stringify(u),onChange:R=>e.saveToEditor(R,e.selectedFeature,m)},null,8,["value","onChange"]))]),_:2},1032,["label"]))),128))]),_:1})):we("",!0)],512),[[Me,!1]]),M(N,{type:"card"},{default:P(()=>[M(f,{key:"geoJson",tab:"GeoJSON"},{default:P(()=>[$("div",Dr,null,512)]),_:1}),M(f,{key:"table",tab:"\u8868\u683C"},{default:P(()=>[e.tableColumns?(U(),H(p,{key:0,class:"ant-table-striped",columns:e.tableColumns,"data-source":e.propertyList,rowKey:(u,m)=>m,pagination:!1,bordered:"",size:"small",scroll:{x:!0},rowClassName:(u,m)=>m%2==1?"table-striped":null,customRow:e.rowEvents},{property:P(({text:u,column:m,index:E})=>[e.editableData[E]?(U(),ot("div",Gr,[typeof e.editableData[E][m.dataIndex]=="string"?(U(),H(o,{key:0,value:e.editableData[E][m.dataIndex],"onUpdate:value":R=>e.editableData[E][m.dataIndex]=R,onChange:e.saveToEditor},null,8,["value","onUpdate:value","onChange"])):typeof e.editableData[E][m.dataIndex]=="number"?(U(),H(o,{key:1,value:e.editableData[E][m.dataIndex],"onUpdate:value":R=>e.editableData[E][m.dataIndex]=R,valueModifiers:{number:!0},onChange:e.saveToEditor},null,8,["value","onUpdate:value","onChange"])):(U(),H(o,{key:2,value:JSON.stringify(e.editableData[E][m.dataIndex]),onChange:R=>e.saveToEditableData(R,e.editableData[E],m.dataIndex)},null,8,["value","onChange"]))])):(U(),ot("div",Fr,be(typeof u=="object"?JSON.stringify(u):u),1))]),operation:P(({index:u})=>[e.editableData[u]?(U(),ot("span",Br,[$("a",{onClick:xt(m=>e.save(u),["stop"])}," \u4FDD\u5B58\u5C5E\u6027 ",8,kr),$("a",{onClick:xt(m=>e.cancel(u),["stop"])}," \u53D6\u6D88\u7F16\u8F91 ",8,Hr)])):(U(),ot("span",qr,[$("a",{onClick:xt(m=>e.edit(u),["stop"])}," \u7F16\u8F91\u5C5E\u6027 ",8,Wr)]))]),_:1},8,["columns","data-source","rowKey","rowClassName","customRow"])):(U(),H(g,{key:1}))]),_:1}),M(f,{key:"addService",tab:"\u6DFB\u52A0\u670D\u52A1"},{default:P(()=>[M(h,{colon:!1,class:"addService"},{default:P(()=>[M(l,{label:"\u670D\u52A1\u540D\u79F0"},{default:P(()=>[M(o,{value:e.service.name,"onUpdate:value":t[0]||(t[0]=u=>e.service.name=u)},null,8,["value"])]),_:1}),M(l,{label:"\u670D\u52A1\u5730\u5740"},{default:P(()=>[M(o,{value:e.service.url,"onUpdate:value":t[1]||(t[1]=u=>e.service.url=u)},null,8,["value"])]),_:1}),M(l,{label:"\u670D\u52A1\u7C7B\u578B"},{default:P(()=>[M(S,{value:e.service.type,"onUpdate:value":t[2]||(t[2]=u=>e.service.type=u)},{default:P(()=>[M(y,{value:"supermap_rest"},{default:P(()=>[Jr]),_:1}),M(y,{value:"supermap_tile"},{default:P(()=>[zr]),_:1}),M(y,{value:"arcgis_rest"},{default:P(()=>[Zr]),_:1}),M(y,{value:"arcgis_tile"},{default:P(()=>[Vr]),_:1})]),_:1},8,["value"])]),_:1}),M(l,{class:"formBtnItem"},{default:P(()=>[M(_,{onClick:e.addService,type:"primary"},{default:P(()=>[Kr]),_:1},8,["onClick"])]),_:1})]),_:1})]),_:1})]),_:1})])]}),_:1})}var ci=De(wr,[["render",Yr],["__scopeId","data-v-bbd3fa12"]]);export{ci as default};
