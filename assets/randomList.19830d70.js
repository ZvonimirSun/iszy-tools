var Ut=Object.defineProperty,Kt=Object.defineProperties;var Yt=Object.getOwnPropertyDescriptors;var At=Object.getOwnPropertySymbols;var Jt=Object.prototype.hasOwnProperty,Zt=Object.prototype.propertyIsEnumerable;var Wt=(o,e,t)=>e in o?Ut(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,mt=(o,e)=>{for(var t in e||(e={}))Jt.call(e,t)&&Wt(o,t,e[t]);if(At)for(var t of At(e))Zt.call(e,t)&&Wt(o,t,e[t]);return o},vt=(o,e)=>Kt(o,Yt(e));import{d as ut,bb as Qt,aZ as te,aa as ee,ah as ie,T as ne,ae as re,bj as oe,bk as ae,bd as se,bl as ce,N as le,c as Q,f as tt,y as et,J as it,ab as he,h as ct,aO as ue,L as Lt,r as N,o as F,K as yt,g as Et,p as fe,b as de,a as pe}from"./vendor.53be07e2.js";/* empty css                *//* empty css               */import{_ as ge}from"./index.fe0b3df3.js";var Ft=!1;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var L=function(){return L=Object.assign||function(o){for(var e,t=1,n=arguments.length;t<n;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(o[i]=e[i]);return o},L.apply(this,arguments)};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var wt=function(o,e){return wt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])},wt(o,e)};function bt(o,e){if(typeof e!="function"&&e!==null)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function t(){this.constructor=o}wt(o,e),o.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}var H=function(){return H=Object.assign||function(o){for(var e,t=1,n=arguments.length;t<n;t++)for(var i in e=arguments[t])Object.prototype.hasOwnProperty.call(e,i)&&(o[i]=e[i]);return o},H.apply(this,arguments)};function j(o,e,t,n){return new(t||(t=Promise))(function(i,r){function l(s){try{f(n.next(s))}catch(c){r(c)}}function a(s){try{f(n.throw(s))}catch(c){r(c)}}function f(s){var c;s.done?i(s.value):(c=s.value,c instanceof t?c:new t(function(h){h(c)})).then(l,a)}f((n=n.apply(o,e||[])).next())})}function M(o,e){var t,n,i,r,l={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(r[Symbol.iterator]=function(){return this}),r;function a(f){return function(s){return function(c){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,n&&(i=2&c[0]?n.return:c[0]?n.throw||((i=n.return)&&i.call(n),0):n.next)&&!(i=i.call(n,c[1])).done)return i;switch(n=0,i&&(c=[2&c[0],i.value]),c[0]){case 0:case 1:i=c;break;case 4:return l.label++,{value:c[1],done:!1};case 5:l.label++,n=c[1],c=[0];continue;case 7:c=l.ops.pop(),l.trys.pop();continue;default:if(!((i=(i=l.trys).length>0&&i[i.length-1])||c[0]!==6&&c[0]!==2)){l=0;continue}if(c[0]===3&&(!i||c[1]>i[0]&&c[1]<i[3])){l.label=c[1];break}if(c[0]===6&&l.label<i[1]){l.label=i[1],i=c;break}if(i&&l.label<i[2]){l.label=i[2],l.ops.push(c);break}i[2]&&l.ops.pop(),l.trys.pop();continue}c=e.call(o,l)}catch(h){c=[6,h],n=0}finally{t=i=0}if(5&c[0])throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}([f,s])}}}function K(o,e){for(var t=0,n=e.length,i=o.length;t<n;t++,i++)o[i]=e[t];return o}Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(o,e){if(this==null)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if(n===0)return!1;for(var i,r,l=0|e,a=Math.max(l>=0?l:n-Math.abs(l),0);a<n;){if((i=t[a])===(r=o)||typeof i=="number"&&typeof r=="number"&&isNaN(i)&&isNaN(r))return!0;a++}return!1}}),String.prototype.includes||(String.prototype.includes=function(o,e){return typeof e!="number"&&(e=0),!(e+o.length>this.length)&&this.indexOf(o,e)!==-1}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(o){if(this==null)throw new TypeError('"this" is null or not defined');var e=Object(this),t=e.length>>>0;if(typeof o!="function")throw new TypeError("predicate must be a function");for(var n=arguments[1],i=0;i<t;){var r=e[i];if(o.call(n,r,i,e))return r;i++}}});var D=function(o){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];return e.some(function(n){return Object.prototype.toString.call(o).slice(8,-1).toLowerCase()===n})},Dt=function(o,e){return Object.prototype.hasOwnProperty.call(o,e)},kt=function(o){return[].filter.call(o,function(e){return e!==`
`}).join("")},B=function(o){if(typeof o!="string"||(o=o.toLocaleLowerCase().trim())==="transparent")return!1;var e;return!(/^rgba/.test(o)&&((e=/([^\s,]+)\)$/.exec(o))===null?0:typeof e=="object"?NaN:typeof e=="number"?e:typeof e=="string"?e[e.length-1]==="%"?Number(e.slice(0,-1))/100:Number(e):NaN)===0)},Ht=function(o){var e,t=((e=o.padding)===null||e===void 0?void 0:e.replace(/px/g,"").split(" ").map(function(s){return~~s}))||[0],n=0,i=0,r=0,l=0;switch(t.length){case 1:n=i=r=l=t[0];break;case 2:n=i=t[0],r=l=t[1];break;case 3:n=t[0],r=l=t[1],i=t[2];break;default:n=t[0],i=t[1],r=t[2],l=t[3]}var a={paddingTop:n,paddingBottom:i,paddingLeft:r,paddingRight:l};for(var f in a)a[f]=Object.prototype.hasOwnProperty.call(o,f)&&D(o[f],"string","number")?~~String(o[f]).replace(/px/g,""):a[f];return[n,i,r,l]},jt=function(o){var e=[],t=o.map(function(i){return Number(i)}).reduce(function(i,r){if(r>0){var l=i+r;return e.push(l),l}return e.push(NaN),i},0),n=Math.random()*t;return e.findIndex(function(i){return n<=i})},St=function(o,e,t,n){n===void 0&&(n=1/0),n<=0&&(n=1/0);for(var i="",r=[],l=o.measureText("...").width,a=0;a<e.length;a++){i+=e[a];var f=o.measureText(i).width,s=t(r);if(n===r.length+1&&(f+=l),s<0)return r;if(f>s&&(r.push(i.slice(0,-1)),i=e[a]),n===r.length)return r[r.length-1]+="...",r}return i&&r.push(i),r.length||r.push(e),r},X=function(){function o(){this.subs=[]}return o.prototype.addSub=function(e){this.subs.includes(e)||this.subs.push(e)},o.prototype.notify=function(){this.subs.forEach(function(e){e.update()})},o}(),me="__proto__"in{};function Pt(o,e,t,n){Object.defineProperty(o,e,{value:t,enumerable:!!n,writable:!0,configurable:!0})}var Mt=Array.prototype,lt=Object.create(Mt);["push","pop","shift","unshift","sort","splice","reverse"].forEach(function(o){lt[o]=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=Mt[o].apply(this,e),i=this.__luckyOb__;return["push","unshift","splice"].includes(o)&&i.walk(this),i.dep.notify(),n}});var ve=function(){function o(e){this.dep=new X,Pt(e,"__luckyOb__",this),Array.isArray(e)&&(me?e.__proto__=lt:Object.getOwnPropertyNames(lt).forEach(function(t){Pt(e,t,lt[t])})),this.walk(e)}return o.prototype.walk=function(e){Object.keys(e).forEach(function(t){Bt(e,t,e[t])})},o}();function Rt(o){if(o&&typeof o=="object")return"__luckyOb__"in o?o.__luckyOb__:new ve(o)}function Bt(o,e,t){var n=new X,i=Object.getOwnPropertyDescriptor(o,e);if(!i||i.configurable!==!1){var r=i&&i.get,l=i&&i.set;r&&!l||arguments.length!==2||(t=o[e]);var a=Rt(t);Object.defineProperty(o,e,{get:function(){var f=r?r.call(o):t;return X.target&&(n.addSub(X.target),a&&a.dep.addSub(X.target)),f},set:function(f){f!==t&&(t=f,r&&!l||(l?l.call(o,f):t=f,a=Rt(f),n.notify()))}})}}var ye=0,we=function(){function o(e,t,n,i){i===void 0&&(i={}),this.id=ye++,this.$lucky=e,this.expr=t,this.deep=!!i.deep,this.getter=typeof t=="function"?t:function(r){r+=".";for(var l=[],a="",f=0;f<r.length;f++){var s=r[f];if(/\[|\./.test(s))l.push(a),a="";else{if(/\W/.test(s))continue;a+=s}}return function(c){return l.reduce(function(h,u){return h[u]},c)}}(t),this.cb=n,this.value=this.get()}return o.prototype.get=function(){X.target=this;var e=this.getter.call(this.$lucky,this.$lucky);return this.deep&&function(t){var n=function(i){D(i,"array","object")&&Object.keys(i).forEach(function(r){var l=i[r];n(l)})};n(t)}(e),X.target=null,e},o.prototype.update=function(){var e=this.get(),t=this.value;this.value=e,this.cb.call(this.$lucky,e,t)},o}(),Ct=function(){function o(e,t){var n=this;this.version="1.7.19",this.htmlFontSize=16,this.rAF=function(){},this.boxWidth=0,this.boxHeight=0,typeof e=="string"?e={el:e}:e.nodeType===1&&(e={el:"",divElement:e}),e=e,this.config=e,this.data=t,e.flag||(e.flag="WEB"),e.el&&(e.divElement=document.querySelector(e.el)),e.divElement&&(e.canvasElement=document.createElement("canvas"),e.divElement.appendChild(e.canvasElement)),e.canvasElement&&(e.ctx=e.canvasElement.getContext("2d"),e.canvasElement.setAttribute("package","".concat("lucky-canvas","@").concat("1.7.19")),e.canvasElement.addEventListener("click",function(i){return n.handleClick(i)})),this.ctx=e.ctx,this.initWindowFunction(),this.config.ctx||console.error("\u65E0\u6CD5\u83B7\u53D6\u5230 CanvasContext2D"),window&&typeof window.addEventListener=="function"&&window.addEventListener("resize",function(i,r){r===void 0&&(r=300);var l=null;return function(){for(var a=this,f=[],s=0;s<arguments.length;s++)f[s]=arguments[s];l||(l=setTimeout(function(){i.apply(a,f),clearTimeout(l),l=null},r))}}(function(){return n.resize()},300)),window&&typeof window.MutationObserver=="function"&&new window.MutationObserver(function(){n.resize()}).observe(document.documentElement,{attributes:!0})}return o.prototype.resize=function(){var e,t;(t=(e=this.config).beforeResize)===null||t===void 0||t.call(e),this.setHTMLFontSize(),this.setDpr(),this.resetWidthAndHeight(),this.zoomCanvas()},o.prototype.initLucky=function(){if(this.resize(),!this.boxWidth||!this.boxHeight)return console.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u5BBD\u5EA6\u6216\u9AD8\u5EA6")},o.prototype.handleClick=function(e){},o.prototype.setHTMLFontSize=function(){window&&(this.htmlFontSize=+window.getComputedStyle(document.documentElement).fontSize.slice(0,-2))},o.prototype.clearCanvas=function(){var e=[this.boxWidth,this.boxHeight],t=e[0],n=e[1];this.ctx.clearRect(-t,-n,2*t,2*n)},o.prototype.setDpr=function(){var e=this.config;e.dpr||(window?window.dpr=e.dpr=window.devicePixelRatio||1:e.dpr||console.error(e,"\u672A\u4F20\u5165 dpr \u53EF\u80FD\u4F1A\u5BFC\u81F4\u7ED8\u5236\u5F02\u5E38"))},o.prototype.resetWidthAndHeight=function(){var e=this.config,t=this.data,n=0,i=0;e.divElement&&(n=e.divElement.offsetWidth,i=e.divElement.offsetHeight),this.boxWidth=this.getLength(t.width||e.width)||n,this.boxHeight=this.getLength(t.height||e.height)||i,e.divElement&&(e.divElement.style.overflow="hidden",e.divElement.style.width=this.boxWidth+"px",e.divElement.style.height=this.boxHeight+"px")},o.prototype.zoomCanvas=function(){var e=this.config,t=this.ctx,n=e.canvasElement,i=e.dpr,r=[this.boxWidth*i,this.boxHeight*i],l=r[0],a=r[1];n&&(n.width=l,n.height=a,n.style.width="".concat(l,"px"),n.style.height="".concat(a,"px"),n.style["transform-origin"]="left top",n.style.transform="scale(".concat(1/i,")"),t.scale(i,i))},o.prototype.initWindowFunction=function(){var e=this.config;if(window)return this.rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)},e.setTimeout=window.setTimeout,e.setInterval=window.setInterval,e.clearTimeout=window.clearTimeout,void(e.clearInterval=window.clearInterval);if(e.rAF)this.rAF=e.rAF;else if(e.setTimeout){var t=e.setTimeout;this.rAF=function(n){return t(n,16.7)}}else this.rAF=function(n){return setTimeout(n,16.7)}},o.prototype.loadImg=function(e,t,n){var i=this;return n===void 0&&(n="$resolve"),new Promise(function(r,l){if(e||l("=> '".concat(t.src,"' \u4E0D\u80FD\u4E3A\u7A7A\u6216\u4E0D\u5408\u6CD5")),i.config.flag!=="WEB")return t[n]=r,void(t.$reject=l);var a=new Image;a.onload=function(){return r(a)},a.onerror=function(){return l("=> '".concat(t.src,"' \u56FE\u7247\u52A0\u8F7D\u5931\u8D25"))},a.src=e})},o.prototype.drawImage=function(e,t){for(var n,i=[],r=2;r<arguments.length;r++)i[r-2]=arguments[r];var l=this.config,a=l.flag,f=l.dpr;if(["WEB","MP-WX"].includes(a))n=t;else{if(!["UNI-H5","UNI-MP","TARO-H5","TARO-MP"].includes(a))return console.error("\u610F\u6599\u4E4B\u5916\u7684 flag, \u8BE5\u5E73\u53F0\u5C1A\u672A\u517C\u5BB9!");n=t.path}if(!n.canvas)return i.length===8&&(i=i.map(function(h,u){return u<4?h*f:h})),e.drawImage.apply(e,K([n],i));var s=n.canvas.getContext("2d");i=i.map(function(h){return h*f});var c=s.getImageData.apply(s,i.slice(0,4));e.putImageData.apply(e,K([c],i.slice(4,6)))},o.prototype.getLength=function(e){return D(e,"number")?e:D(e,"string")?this.changeUnits(e):0},o.prototype.changeUnits=function(e,t){var n=this;t===void 0&&(t=1);var i=this.config;return Number(e.replace(/^([-]*[0-9.]*)([a-z%]*)$/,function(r,l,a){var f={"%":function(c){return c*(t/100)},px:function(c){return 1*c},rem:function(c){return c*n.htmlFontSize},vw:function(c){return c/100*window.innerWidth}}[a];if(f)return f(l);var s=i.handleCssUnit||i.unitFunc;return s?s(l,a):l}))},o.prototype.computedWidthAndHeight=function(e,t,n,i){if(!t.width&&!t.height)return[e.width,e.height];if(t.width&&!t.height){var r=this.getWidth(t.width,n);return[r,e.height*(r/e.width)]}if(!t.width&&t.height){var l=this.getHeight(t.height,i);return[e.width*(l/e.height),l]}return[this.getWidth(t.width,n),this.getHeight(t.height,i)]},o.prototype.getWidth=function(e,t){return D(e,"number")?e:D(e,"string")?this.changeUnits(e,t):0},o.prototype.getHeight=function(e,t){return D(e,"number")?e:D(e,"string")?this.changeUnits(e,t):0},o.prototype.getOffsetX=function(e,t){return t===void 0&&(t=0),(t-e)/2},o.prototype.getOffscreenCanvas=function(e,t){if(!Dt(this,"_offscreenCanvas")&&(window&&window.document&&this.config.flag==="WEB"?this._offscreenCanvas=document.createElement("canvas"):this._offscreenCanvas=this.config.offscreenCanvas,!this._offscreenCanvas))return console.log("\u79BB\u5C4F Canvas \u65E0\u6CD5\u6E32\u67D3!");var n=this.config.dpr,i=this._offscreenCanvas;i.width=(e||300)*n,i.height=(t||150)*n;var r=i.getContext("2d");return r.clearRect(0,0,e,t),r.scale(n,n),r.dpr=n,{_offscreenCanvas:i,_ctx:r}},o.prototype.$set=function(e,t,n){e&&typeof e=="object"&&Bt(e,t,n)},o.prototype.$computed=function(e,t,n){var i=this;Object.defineProperty(e,t,{get:function(){return n.call(i)}})},o.prototype.$watch=function(e,t,n){n===void 0&&(n={}),typeof t=="object"&&(t=(n=t).handler);var i=new we(this,e,t,n);return n.immediate&&t.call(this,i.value),function(){}},o}(),V=function(o){return Math.PI/180*o},ht=function(o){for(var e=[],t=1;t<arguments.length;t++)e[t-1]=arguments[t];var n=e[0],i=e[1],r=e[2],l=e[3],a=e[4],f=Math.min(r,l),s=Math.PI;a>f/2&&(a=f/2),o.beginPath(),o.moveTo(n+a,i),o.lineTo(n+a,i),o.lineTo(n+r-a,i),o.arc(n+r-a,i+a,a,-s/2,0),o.lineTo(n+r,i+l-a),o.arc(n+r-a,i+l-a,a,0,s/2),o.lineTo(n+a,i+l),o.arc(n+a,i+l-a,a,s/2,s),o.lineTo(n,i+a),o.arc(n+a,i+a,a,s,-s/2),o.closePath()},$t=function(o,e,t,n){return o>=n&&(o=n),t*(o/=n)*o+e},Y=function(o,e,t,n){return o>=n&&(o=n),-t*(o/=n)*(o-2)+e},be=function(o){function e(t,n){var i,r=o.call(this,t,{width:n.width,height:n.height})||this;return r.blocks=[],r.prizes=[],r.buttons=[],r.defaultConfig={},r.defaultStyle={},r._defaultConfig={},r._defaultStyle={},r.Radius=0,r.prizeRadius=0,r.prizeDeg=0,r.prizeRadian=0,r.rotateDeg=0,r.maxBtnRadius=0,r.startTime=0,r.endTime=0,r.stopDeg=0,r.endDeg=0,r.FPS=16.6,r.step=0,r.ImageCache=new Map,r.initData(n),r.initWatch(),r.initComputed(),(i=t.beforeCreate)===null||i===void 0||i.call(r),r.init(),r}return bt(e,o),e.prototype.resize=function(){var t,n;o.prototype.resize.call(this),this.Radius=Math.min(this.boxWidth,this.boxHeight)/2,this.ctx.translate(this.Radius,this.Radius),this.draw(),(n=(t=this.config).afterResize)===null||n===void 0||n.call(t)},e.prototype.initLucky=function(){this.Radius=0,this.prizeRadius=0,this.prizeDeg=0,this.prizeRadian=0,this.rotateDeg=0,this.maxBtnRadius=0,this.startTime=0,this.endTime=0,this.stopDeg=0,this.endDeg=0,this.FPS=16.6,this.prizeFlag=-1,this.step=0,o.prototype.initLucky.call(this)},e.prototype.initData=function(t){this.$set(this,"width",t.width||"300px"),this.$set(this,"height",t.height||"300px"),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"buttons",t.buttons||[]),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"startCallback",t.start),this.$set(this,"endCallback",t.end)},e.prototype.initComputed=function(){var t=this;this.$computed(this,"_defaultConfig",function(){return H({gutter:"0px",offsetDegree:0,speed:20,speedFunction:"quad",accelerationTime:2500,decelerationTime:2500,stopRange:0},t.defaultConfig)}),this.$computed(this,"_defaultStyle",function(){return H({fontSize:"18px",fontColor:"#000",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",wordWrap:!0,lengthLimit:"90%"},t.defaultStyle)})},e.prototype.initWatch=function(){var t=this;this.$watch("width",function(n){t.data.width=n,t.resize()}),this.$watch("height",function(n){t.data.height=n,t.resize()}),this.$watch("blocks",function(n){t.initImageCache()},{deep:!0}),this.$watch("prizes",function(n){t.initImageCache()},{deep:!0}),this.$watch("buttons",function(n){t.initImageCache()},{deep:!0}),this.$watch("defaultConfig",function(){return t.draw()},{deep:!0}),this.$watch("defaultStyle",function(){return t.draw()},{deep:!0}),this.$watch("startCallback",function(){return t.init()}),this.$watch("endCallback",function(){return t.init()})},e.prototype.init=function(){var t,n;return j(this,void 0,void 0,function(){var i;return M(this,function(r){switch(r.label){case 0:return this.initLucky(),i=this.config,(t=i.beforeInit)===null||t===void 0||t.call(this),this.draw(),this.draw(),[4,this.initImageCache()];case 1:return r.sent(),(n=i.afterInit)===null||n===void 0||n.call(this),[2]}})})},e.prototype.initImageCache=function(){var t=this;return new Promise(function(n){var i={blocks:t.blocks.map(function(r){return r.imgs}),prizes:t.prizes.map(function(r){return r.imgs}),buttons:t.buttons.map(function(r){return r.imgs})};Object.keys(i).forEach(function(r){var l=i[r],a=[];l&&l.forEach(function(f,s){f&&f.forEach(function(c,h){a.push(t.loadAndCacheImg(r,s,h))})}),Promise.all(a).then(function(){t.draw(),n()})})})},e.prototype.handleClick=function(t){var n,i=this.ctx;i.beginPath(),i.arc(0,0,this.maxBtnRadius,0,2*Math.PI,!1),i.isPointInPath(t.offsetX,t.offsetY)&&this.step===0&&((n=this.startCallback)===null||n===void 0||n.call(this,t))},e.prototype.loadAndCacheImg=function(t,n,i){return j(this,void 0,void 0,function(){var r=this;return M(this,function(l){return[2,new Promise(function(a,f){var s=r[t][n];if(s&&s.imgs){var c=s.imgs[i];c&&r.loadImg(c.src,c).then(function(h){return j(r,void 0,void 0,function(){return M(this,function(u){switch(u.label){case 0:return typeof c.formatter!="function"?[3,2]:[4,Promise.resolve(c.formatter.call(this,h))];case 1:h=u.sent(),u.label=2;case 2:return this.ImageCache.set(c.src,h),a(),[2]}})})}).catch(function(h){console.error("".concat(t,"[").concat(n,"].imgs[").concat(i,"] ").concat(h)),f()})}})]})})},e.prototype.drawBlock=function(t,n,i){var r=this,l=this.ctx;B(n.background)&&(l.beginPath(),l.fillStyle=n.background,l.arc(0,0,t,0,2*Math.PI,!1),l.fill()),n.imgs&&n.imgs.forEach(function(a,f){var s=r.ImageCache.get(a.src);if(s){var c=r.computedWidthAndHeight(s,a,2*t,2*t),h=c[0],u=c[1],d=[r.getOffsetX(h),r.getHeight(a.top,2*t)-t],y=d[0],p=d[1];l.save(),a.rotate&&l.rotate(V(r.rotateDeg)),r.drawImage(l,s,y,p,h,u),l.restore()}})},e.prototype.draw=function(){var t,n,i=this,r=this,l=r.config,a=r.ctx,f=r._defaultConfig,s=r._defaultStyle;(t=l.beforeDraw)===null||t===void 0||t.call(this,a),a.clearRect(-this.Radius,-this.Radius,2*this.Radius,2*this.Radius),this.prizeRadius=this.blocks.reduce(function(d,y,p){return i.drawBlock(d,y,p),d-i.getLength(y.padding&&y.padding.split(" ")[0])},this.Radius),this.prizeDeg=360/this.prizes.length,this.prizeRadian=V(this.prizeDeg);var c=V(this.rotateDeg-90+this.prizeDeg/2+f.offsetDegree),h=function(d){return i.getOffsetX(a.measureText(d).width)},u=function(d,y,p){var g=d.lineHeight||s.lineHeight||d.fontSize||s.fontSize;return i.getHeight(d.top,y)+(p+1)*i.getLength(g)};a.save(),this.prizes.forEach(function(d,y){var p=c+y*i.prizeRadian,g=i.prizeRadius-i.maxBtnRadius,b=d.background||s.background;B(b)&&(a.fillStyle=b,function(v,$,m,C,S,O){v.beginPath();var z,x,I=V(90/Math.PI/m*O),T=C+I,_=S-I;v.arc(0,0,m,T,_,!1),v.lineTo.apply(v,(z=(C+S)/2,x=O/2/Math.abs(Math.sin((C-S)/2)),[+(Math.cos(z)*x).toFixed(8),+(Math.sin(z)*x).toFixed(8)])),v.closePath()}(a,i.maxBtnRadius,i.prizeRadius,p-i.prizeRadian/2,p+i.prizeRadian/2,i.getLength(f.gutter)),a.fill());var k=Math.cos(p)*i.prizeRadius,w=Math.sin(p)*i.prizeRadius;a.translate(k,w),a.rotate(p+V(90)),d.imgs&&d.imgs.forEach(function(v,$){var m=i.ImageCache.get(v.src);if(m){var C=i.computedWidthAndHeight(m,v,i.prizeRadian*i.prizeRadius,g),S=C[0],O=C[1],z=[i.getOffsetX(S),i.getHeight(v.top,g)],x=z[0],I=z[1];i.drawImage(a,m,x,I,S,O)}}),d.fonts&&d.fonts.forEach(function(v){var $=v.fontColor||s.fontColor,m=v.fontWeight||s.fontWeight,C=i.getLength(v.fontSize||s.fontSize),S=v.fontStyle||s.fontStyle,O=Object.prototype.hasOwnProperty.call(v,"wordWrap")?v.wordWrap:s.wordWrap,z=v.lengthLimit||s.lengthLimit,x=v.lineClamp||s.lineClamp;a.fillStyle=$,a.font="".concat(m," ").concat(C>>0,"px ").concat(S);var I=String(v.text);(O?St(a,kt(I),function(T){var _=(i.prizeRadius-u(v,g,T.length))*Math.tan(i.prizeRadian/2)*2-i.getLength(f.gutter);return i.getWidth(z,_)},x):I.split(`
`)).filter(function(T){return!!T}).forEach(function(T,_){a.fillText(T,h(T),u(v,g,_))})}),a.rotate(V(360)-p-V(90)),a.translate(-k,-w)}),a.restore(),this.buttons.forEach(function(d,y){var p=i.getHeight(d.radius,i.prizeRadius);i.maxBtnRadius=Math.max(i.maxBtnRadius,p),B(d.background)&&(a.beginPath(),a.fillStyle=d.background,a.arc(0,0,p,0,2*Math.PI,!1),a.fill()),d.pointer&&B(d.background)&&(a.beginPath(),a.fillStyle=d.background,a.moveTo(-p,0),a.lineTo(p,0),a.lineTo(0,2*-p),a.closePath(),a.fill()),d.imgs&&d.imgs.forEach(function(g,b){var k=i.ImageCache.get(g.src);if(k){var w=i.computedWidthAndHeight(k,g,2*p,2*p),v=w[0],$=w[1],m=[i.getOffsetX(v),i.getHeight(g.top,p)],C=m[0],S=m[1];i.drawImage(a,k,C,S,v,$)}}),d.fonts&&d.fonts.forEach(function(g){var b=g.fontColor||s.fontColor,k=g.fontWeight||s.fontWeight,w=i.getLength(g.fontSize||s.fontSize),v=g.fontStyle||s.fontStyle;a.fillStyle=b,a.font="".concat(k," ").concat(w>>0,"px ").concat(v),String(g.text).split(`
`).forEach(function($,m){a.fillText($,h($),u(g,p,m))})})}),(n=l.afterDraw)===null||n===void 0||n.call(this,a)},e.prototype.carveOnGunwaleOfAMovingBoat=function(){var t=this,n=t._defaultConfig,i=t.prizeFlag,r=t.prizeDeg,l=t.rotateDeg;this.endTime=Date.now();for(var a=this.stopDeg=l,f=n.speed,s=(Math.random()*r-r/2)*this.getLength(n.stopRange),c=0,h=0,u=0;++c;){var d=360*c-i*r-l-n.offsetDegree+s-r/2,y=Y(this.FPS,a,d,n.decelerationTime)-a;if(y>f){this.endDeg=f-h>y-f?d:u;break}u=d,h=y}},e.prototype.play=function(){var t,n;this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,(n=(t=this.config).afterStart)===null||n===void 0||n.call(t),this.run())},e.prototype.stop=function(t){if(this.step!==0&&this.step!==3){if(!t&&t!==0){var n=this.prizes.map(function(i){return i.range});t=jt(n)}t<0?(this.step=0,this.prizeFlag=-1):(this.step=2,this.prizeFlag=t%this.prizes.length)}},e.prototype.run=function(t){var n;t===void 0&&(t=0);var i=this,r=i.rAF,l=i.step,a=i.prizeFlag,f=i._defaultConfig,s=f.accelerationTime,c=f.decelerationTime,h=f.speed;if(l!==0){if(a!==-1){l!==3||this.endDeg||this.carveOnGunwaleOfAMovingBoat();var u=Date.now()-this.startTime,d=Date.now()-this.endTime,y=this.rotateDeg;if(l===1||u<s){this.FPS=u/t;var p=$t(u,0,h,s);p===h&&(this.step=2),y+=p%360}else l===2?(y+=h%360,a!==void 0&&a>=0&&(this.step=3,this.stopDeg=0,this.endDeg=0)):l===3?(y=Y(d,this.stopDeg,this.endDeg,c),d>=c&&(this.step=0)):this.stop(-1);this.rotateDeg=y,this.draw(),r(this.run.bind(this,t+1))}}else(n=this.endCallback)===null||n===void 0||n.call(this,this.prizes.find(function(g,b){return b===a})||{})},e.prototype.conversionAxis=function(t,n){var i=this.config;return[t/i.dpr-this.Radius,n/i.dpr-this.Radius]},e}(Ct),ke=function(o){function e(t,n){var i,r=o.call(this,t,{width:n.width,height:n.height})||this;return r.rows=3,r.cols=3,r.blocks=[],r.prizes=[],r.buttons=[],r.defaultConfig={},r.defaultStyle={},r.activeStyle={},r._defaultConfig={},r._defaultStyle={},r._activeStyle={},r.cellWidth=0,r.cellHeight=0,r.startTime=0,r.endTime=0,r.currIndex=0,r.stopIndex=0,r.endIndex=0,r.demo=!1,r.timer=0,r.FPS=16.6,r.step=0,r.prizeFlag=-1,r.cells=[],r.ImageCache=new Map,r.initData(n),r.initWatch(),r.initComputed(),(i=t.beforeCreate)===null||i===void 0||i.call(r),r.init(),r}return bt(e,o),e.prototype.resize=function(){var t,n;o.prototype.resize.call(this),this.draw(),(n=(t=this.config).afterResize)===null||n===void 0||n.call(t)},e.prototype.initLucky=function(){this.cellWidth=0,this.cellHeight=0,this.startTime=0,this.endTime=0,this.currIndex=0,this.stopIndex=0,this.endIndex=0,this.demo=!1,this.timer=0,this.FPS=16.6,this.prizeFlag=-1,this.step=0,o.prototype.initLucky.call(this)},e.prototype.initData=function(t){this.$set(this,"width",t.width||"300px"),this.$set(this,"height",t.height||"300px"),this.$set(this,"rows",Number(t.rows)||3),this.$set(this,"cols",Number(t.cols)||3),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"buttons",t.buttons||[]),this.$set(this,"button",t.button),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"activeStyle",t.activeStyle||{}),this.$set(this,"startCallback",t.start),this.$set(this,"endCallback",t.end)},e.prototype.initComputed=function(){var t=this;this.$computed(this,"_defaultConfig",function(){var n=H({gutter:5,speed:20,accelerationTime:2500,decelerationTime:2500},t.defaultConfig);return n.gutter=t.getLength(n.gutter),n.speed=n.speed/40,n}),this.$computed(this,"_defaultStyle",function(){return H({borderRadius:20,fontColor:"#000",fontSize:"18px",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",shadow:"",wordWrap:!0,lengthLimit:"90%"},t.defaultStyle)}),this.$computed(this,"_activeStyle",function(){return H({background:"#ffce98",shadow:""},t.activeStyle)})},e.prototype.initWatch=function(){var t=this;this.$watch("width",function(n){t.data.width=n,t.resize()}),this.$watch("height",function(n){t.data.height=n,t.resize()}),this.$watch("blocks",function(n){t.initImageCache()},{deep:!0}),this.$watch("prizes",function(n){t.initImageCache()},{deep:!0}),this.$watch("buttons",function(n){t.initImageCache()},{deep:!0}),this.$watch("rows",function(){return t.init()}),this.$watch("cols",function(){return t.init()}),this.$watch("defaultConfig",function(){return t.draw()},{deep:!0}),this.$watch("defaultStyle",function(){return t.draw()},{deep:!0}),this.$watch("activeStyle",function(){return t.draw()},{deep:!0}),this.$watch("startCallback",function(){return t.init()}),this.$watch("endCallback",function(){return t.init()})},e.prototype.init=function(){var t,n;return j(this,void 0,void 0,function(){var i;return M(this,function(r){switch(r.label){case 0:return this.initLucky(),i=this.config,(t=i.beforeInit)===null||t===void 0||t.call(this),this.draw(),[4,this.initImageCache()];case 1:return r.sent(),(n=i.afterInit)===null||n===void 0||n.call(this),[2]}})})},e.prototype.initImageCache=function(){var t=this;return new Promise(function(n){var i=t.buttons.map(function(l){return l.imgs});t.button&&i.push(t.button.imgs);var r={blocks:t.blocks.map(function(l){return l.imgs}),prizes:t.prizes.map(function(l){return l.imgs}),buttons:i};Object.keys(r).forEach(function(l){var a=r[l],f=[];a&&a.forEach(function(s,c){s&&s.forEach(function(h,u){f.push(t.loadAndCacheImg(l,c,u))})}),Promise.all(f).then(function(){t.draw(),n()})})})},e.prototype.handleClick=function(t){var n=this,i=this.ctx;K(K([],this.buttons),[this.button]).forEach(function(r){var l;if(r){var a=n.getGeometricProperty([r.x,r.y,r.col||1,r.row||1]),f=a[0],s=a[1],c=a[2],h=a[3];i.beginPath(),i.rect(f,s,c,h),i.isPointInPath(t.offsetX,t.offsetY)&&n.step===0&&(typeof r.callback=="function"&&r.callback.call(n,r),(l=n.startCallback)===null||l===void 0||l.call(n,t,r))}})},e.prototype.loadAndCacheImg=function(t,n,i){return j(this,void 0,void 0,function(){var r=this;return M(this,function(l){return[2,new Promise(function(a,f){var s=r[t][n];if(t==="buttons"&&!r.buttons.length&&r.button&&(s=r.button),s&&s.imgs){var c=s.imgs[i];if(c){var h=[r.loadImg(c.src,c),c.activeSrc&&r.loadImg(c.activeSrc,c,"$activeResolve")];Promise.all(h).then(function(u){var d=u[0],y=u[1];return j(r,void 0,void 0,function(){var p;return M(this,function(g){switch(g.label){case 0:return typeof(p=c.formatter)!="function"?[3,3]:[4,Promise.resolve(p.call(this,d))];case 1:return d=g.sent(),y?[4,Promise.resolve(p.call(this,y))]:[3,3];case 2:y=g.sent(),g.label=3;case 3:return this.ImageCache.set(c.src,d),y&&this.ImageCache.set(c.activeSrc,y),a(),[2]}})})}).catch(function(u){console.error("".concat(t,"[").concat(n,"].imgs[").concat(i,"] ").concat(u)),f()})}}})]})})},e.prototype.draw=function(){var t,n,i=this,r=this,l=r.config,a=r.ctx,f=r._defaultConfig,s=r._defaultStyle,c=r._activeStyle;(t=l.beforeDraw)===null||t===void 0||t.call(this,a),a.clearRect(0,0,this.boxWidth,this.boxHeight),this.cells=K(K([],this.prizes),this.buttons),this.button&&this.cells.push(this.button),this.cells.forEach(function(h){h.col=h.col||1,h.row=h.row||1}),this.prizeArea=this.blocks.reduce(function(h,u,d){var y=h.x,p=h.y,g=h.w,b=h.h,k=Ht(u),w=k[0],v=k[1],$=k[2],m=k[3],C=u.borderRadius?i.getLength(u.borderRadius):0,S=u.background||s.background;return B(S)&&(a.fillStyle=i.handleBackground(y,p,g,b,S),ht(a,y,p,g,b,C),a.fill()),u.imgs&&u.imgs.forEach(function(O,z){var x=i.ImageCache.get(O.src);if(x){var I=i.computedWidthAndHeight(x,O,g,b),T=I[0],_=I[1],A=[i.getOffsetX(T,g),i.getHeight(O.top,b)],R=A[0],q=A[1];i.drawImage(a,x,y+R,p+q,T,_)}}),{x:y+$,y:p+w,w:g-$-m,h:b-w-v}},{x:0,y:0,w:this.boxWidth,h:this.boxHeight}),this.cellWidth=(this.prizeArea.w-f.gutter*(this.cols-1))/this.cols,this.cellHeight=(this.prizeArea.h-f.gutter*(this.rows-1))/this.rows,this.cells.forEach(function(h,u){var d=i.getGeometricProperty([h.x,h.y,h.col,h.row]),y=d[0],p=d[1],g=d[2],b=d[3],k=!1;(i.prizeFlag===void 0||i.prizeFlag>-1)&&(k=u===i.currIndex%i.prizes.length>>0);var w=k?c.background:h.background||s.background;if(B(w)){var v=(k?c.shadow:h.shadow||s.shadow).replace(/px/g,"").split(",")[0].split(" ").map(function(m,C){return C<3?Number(m):m});v.length===4&&(a.shadowColor=v[3],a.shadowOffsetX=v[0]*l.dpr,a.shadowOffsetY=v[1]*l.dpr,a.shadowBlur=v[2],v[0]>0?g-=v[0]:(g+=v[0],y-=v[0]),v[1]>0?b-=v[1]:(b+=v[1],p-=v[1])),a.fillStyle=i.handleBackground(y,p,g,b,w);var $=i.getLength(h.borderRadius?h.borderRadius:s.borderRadius);ht(a,y,p,g,b,$),a.fill(),a.shadowColor="rgba(0, 0, 0, 0)",a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowBlur=0}u>=i.prizes.length&&(u-=i.prizes.length),h.imgs&&h.imgs.forEach(function(m,C){var S=i.ImageCache.get(m.src),O=i.ImageCache.get(m.activeSrc);if(S){var z=k&&O||S;if(z){var x=i.computedWidthAndHeight(z,m,g,b),I=x[0],T=x[1],_=[y+i.getOffsetX(I,g),p+i.getHeight(m.top,b)],A=_[0],R=_[1];i.drawImage(a,z,A,R,I,T)}}}),h.fonts&&h.fonts.forEach(function(m){var C=k&&c.fontStyle?c.fontStyle:m.fontStyle||s.fontStyle,S=k&&c.fontWeight?c.fontWeight:m.fontWeight||s.fontWeight,O=k&&c.fontSize?i.getLength(c.fontSize):i.getLength(m.fontSize||s.fontSize),z=k&&c.lineHeight?c.lineHeight:m.lineHeight||s.lineHeight||m.fontSize||s.fontSize,x=Object.prototype.hasOwnProperty.call(m,"wordWrap")?m.wordWrap:s.wordWrap,I=m.lengthLimit||s.lengthLimit,T=m.lineClamp||s.lineClamp;a.font="".concat(S," ").concat(O>>0,"px ").concat(C),a.fillStyle=k&&c.fontColor?c.fontColor:m.fontColor||s.fontColor;var _=[],A=String(m.text);if(x){var R=i.getWidth(I,g);_=St(a,kt(A),function(){return R},T)}else _=A.split(`
`);_.forEach(function(q,ft){a.fillText(q,y+i.getOffsetX(a.measureText(q).width,g),p+i.getHeight(m.top,b)+(ft+1)*i.getLength(z))})})}),(n=l.afterDraw)===null||n===void 0||n.call(this,a)},e.prototype.handleBackground=function(t,n,i,r,l){var a=this.ctx;return l.includes("linear-gradient")&&(l=function(f,s,c,h,u,d){var y=/linear-gradient\((.+)\)/.exec(d)[1].split(",").map(function(w){return w.trim()}),p=y.shift(),g=[0,0,0,0];if(p.includes("deg")){var b=function(w){return Math.tan(w/180*Math.PI)};(p=p.slice(0,-3)%360)>=0&&p<45?g=[s,c+u,s+h,c+u-h*b(p-0)]:p>=45&&p<90?g=[s,c+u,s+h-u*b(p-45),c]:p>=90&&p<135?g=[s+h,c+u,s+h-u*b(p-90),c]:p>=135&&p<180?g=[s+h,c+u,s,c+h*b(p-135)]:p>=180&&p<225?g=[s+h,c,s,c+h*b(p-180)]:p>=225&&p<270?g=[s+h,c,s+u*b(p-225),c+u]:p>=270&&p<315?g=[s,c,s+u*b(p-270),c+u]:p>=315&&p<360&&(g=[s,c,s+h,c+u-h*b(p-315)])}else p.includes("top")?g=[s,c+u,s,c]:p.includes("bottom")?g=[s,c,s,c+u]:p.includes("left")?g=[s+h,c,s,c]:p.includes("right")&&(g=[s,c,s+h,c]);var k=f.createLinearGradient.apply(f,g.map(function(w){return w>>0}));return y.reduce(function(w,v,$){var m=v.split(" ");return m.length===1?w.addColorStop($,m[0]):m.length===2&&w.addColorStop.apply(w,m),w},k)}(a,t,n,i,r,l)),l},e.prototype.carveOnGunwaleOfAMovingBoat=function(){var t=this,n=t._defaultConfig,i=t.prizeFlag,r=t.currIndex;this.endTime=Date.now();for(var l=this.stopIndex=r,a=n.speed,f=0,s=0,c=0;++f;){var h=this.prizes.length*f+i-l,u=Y(this.FPS,l,h,n.decelerationTime)-l;if(u>a){this.endIndex=a-s>u-a?h:c;break}c=h,s=u}},e.prototype.play=function(){var t,n;this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,(n=(t=this.config).afterStart)===null||n===void 0||n.call(t),this.run())},e.prototype.stop=function(t){if(this.step!==0&&this.step!==3){if(!t&&t!==0){var n=this.prizes.map(function(i){return i.range});t=jt(n)}t<0?(this.step=0,this.prizeFlag=-1):(this.step=2,this.prizeFlag=t%this.prizes.length)}},e.prototype.run=function(t){var n;t===void 0&&(t=0);var i=this,r=i.rAF,l=i.step,a=i.prizes,f=i.prizeFlag,s=i._defaultConfig,c=s.accelerationTime,h=s.decelerationTime,u=s.speed;if(l!==0){if(f!==-1){l!==3||this.endIndex||this.carveOnGunwaleOfAMovingBoat();var d=Date.now()-this.startTime,y=Date.now()-this.endTime,p=this.currIndex;if(l===1||d<c){this.FPS=d/t;var g=$t(d,.1,u-.1,c);g===u&&(this.step=2),p+=g%a.length}else l===2?(p+=u%a.length,f!==void 0&&f>=0&&(this.step=3,this.stopIndex=0,this.endIndex=0)):l===3?(p=Y(y,this.stopIndex,this.endIndex,h),y>=h&&(this.step=0)):this.stop(-1);this.currIndex=p,this.draw(),r(this.run.bind(this,t+1))}}else(n=this.endCallback)===null||n===void 0||n.call(this,this.prizes.find(function(b,k){return k===f})||{})},e.prototype.getGeometricProperty=function(t){var n=t[0],i=t[1],r=t[2],l=r===void 0?1:r,a=t[3],f=a===void 0?1:a,s=this.cellWidth,c=this.cellHeight,h=this._defaultConfig.gutter,u=[this.prizeArea.x+(s+h)*n,this.prizeArea.y+(c+h)*i];return l&&f&&u.push(s*l+h*(l-1),c*f+h*(f-1)),u},e.prototype.conversionAxis=function(t,n){var i=this.config;return[t/i.dpr,n/i.dpr]},e}(Ct),Se=function(o){function e(t,n){var i,r=o.call(this,t,{width:n.width,height:n.height})||this;return r.blocks=[],r.prizes=[],r.slots=[],r.defaultConfig={},r._defaultConfig={},r.defaultStyle={},r._defaultStyle={},r.endCallback=function(){},r.cellWidth=0,r.cellHeight=0,r.cellAndSpacing=0,r.widthAndSpacing=0,r.heightAndSpacing=0,r.FPS=16.6,r.scroll=[],r.stopScroll=[],r.endScroll=[],r.startTime=0,r.endTime=0,r.step=0,r.prizeFlag=void 0,r.ImageCache=new Map,r.initData(n),r.initWatch(),r.initComputed(),(i=t.beforeCreate)===null||i===void 0||i.call(r),r.init(),r}return bt(e,o),e.prototype.resize=function(){var t,n;o.prototype.resize.call(this),this.draw(),(n=(t=this.config).afterResize)===null||n===void 0||n.call(t)},e.prototype.initLucky=function(){this.cellWidth=0,this.cellHeight=0,this.cellAndSpacing=0,this.widthAndSpacing=0,this.heightAndSpacing=0,this.FPS=16.6,this.scroll=[],this.stopScroll=[],this.endScroll=[],this.startTime=0,this.endTime=0,this.prizeFlag=void 0,this.step=0,o.prototype.initLucky.call(this)},e.prototype.initData=function(t){this.$set(this,"width",t.width||"300px"),this.$set(this,"height",t.height||"300px"),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"slots",t.slots||[]),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"endCallback",t.end)},e.prototype.initComputed=function(){var t=this;this.$computed(this,"_defaultConfig",function(){var n=H({mode:"vertical",rowSpacing:0,colSpacing:5,speed:20,direction:1,accelerationTime:2500,decelerationTime:2500},t.defaultConfig);return n.rowSpacing=t.getLength(n.rowSpacing),n.colSpacing=t.getLength(n.colSpacing),n}),this.$computed(this,"_defaultStyle",function(){return H({borderRadius:0,fontColor:"#000",fontSize:"18px",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",wordWrap:!0,lengthLimit:"90%"},t.defaultStyle)})},e.prototype.initWatch=function(){var t=this;this.$watch("width",function(n){t.data.width=n,t.resize()}),this.$watch("height",function(n){t.data.height=n,t.resize()}),this.$watch("blocks",function(n){t.initImageCache()},{deep:!0}),this.$watch("prizes",function(n){t.initImageCache()},{deep:!0}),this.$watch("slots",function(n){t.drawOffscreenCanvas(),t.draw()},{deep:!0}),this.$watch("defaultConfig",function(){return t.draw()},{deep:!0}),this.$watch("defaultStyle",function(){return t.draw()},{deep:!0}),this.$watch("endCallback",function(){return t.init()})},e.prototype.init=function(){var t,n;return j(this,void 0,void 0,function(){var i;return M(this,function(r){switch(r.label){case 0:return this.initLucky(),i=this.config,(t=i.beforeInit)===null||t===void 0||t.call(this),this.drawOffscreenCanvas(),this.draw(),[4,this.initImageCache()];case 1:return r.sent(),(n=i.afterInit)===null||n===void 0||n.call(this),[2]}})})},e.prototype.initImageCache=function(){var t=this;return new Promise(function(n){var i={blocks:t.blocks.map(function(r){return r.imgs}),prizes:t.prizes.map(function(r){return r.imgs})};Object.keys(i).forEach(function(r){var l=i[r],a=[];l&&l.forEach(function(f,s){f&&f.forEach(function(c,h){a.push(t.loadAndCacheImg(r,s,h))})}),Promise.all(a).then(function(){t.drawOffscreenCanvas(),t.draw(),n()})})})},e.prototype.loadAndCacheImg=function(t,n,i){return j(this,void 0,void 0,function(){var r=this;return M(this,function(l){return[2,new Promise(function(a,f){var s=r[t][n];if(s&&s.imgs){var c=s.imgs[i];c&&r.loadImg(c.src,c).then(function(h){return j(r,void 0,void 0,function(){return M(this,function(u){switch(u.label){case 0:return typeof c.formatter!="function"?[3,2]:[4,Promise.resolve(c.formatter.call(this,h))];case 1:h=u.sent(),u.label=2;case 2:return this.ImageCache.set(c.src,h),a(),[2]}})})}).catch(function(h){console.error("".concat(t,"[").concat(n,"].imgs[").concat(i,"] ").concat(h)),f()})}})]})})},e.prototype.drawOffscreenCanvas=function(){var t=this,n=this._defaultConfig,i=this._defaultStyle,r=this.drawBlocks(),l=r.w,a=r.h,f=this.prizes.length,s=this.displacementWidthOrHeight(),c=s.cellWidth,h=s.cellHeight,u=s.widthAndSpacing,d=s.heightAndSpacing,y=new Array(f).fill(void 0).map(function(v,$){return $}),p=0,g=0;this.slots.forEach(function(v,$){t.scroll[$]===void 0&&(t.scroll[$]=0),v.order=v.order||y;var m=v.order.length;p=Math.max(p,l+u*m),g=Math.max(g,a+d*m)});var b=this.getOffscreenCanvas(p,g),k=b._offscreenCanvas,w=b._ctx;this._offscreenCanvas=k,this.slots.forEach(function(v,$){var m=c*$,C=h*$,S=0,O=function(P,G){for(var nt={},rt=[],E=0;E<P.length;E++)nt[E]=P[E];for(E=0;E<G.length;E++){var U=nt[G[E]];U&&(rt[E]=U)}return rt}(t.prizes,v.order);if(O.length){O.forEach(function(P,G){if(P){v.order[G];var nt=u*G+n.colSpacing/2,rt=d*G+n.rowSpacing/2,E=t.displacement([m,rt,d],[nt,C,u]),U=E[0],dt=E[1],Vt=E[2];S+=Vt;var It=P.background||i.background;if(B(It)){var Xt=t.getLength(Dt(P,"borderRadius")?P.borderRadius:i.borderRadius);ht(w,U,dt,c,c,Xt),w.fillStyle=It,w.fill()}P.imgs&&P.imgs.forEach(function(W,Ot){var J=t.ImageCache.get(W.src);if(J){var ot=t.computedWidthAndHeight(J,W,c,h),at=ot[0],pt=ot[1],st=[U+t.getOffsetX(at,c),dt+t.getHeight(W.top,h)],gt=st[0],Z=st[1];t.drawImage(w,J,gt,Z,at,pt)}}),P.fonts&&P.fonts.forEach(function(W){var Ot=W.fontStyle||i.fontStyle,J=W.fontWeight||i.fontWeight,ot=t.getLength(W.fontSize||i.fontSize),at=W.lineHeight||i.lineHeight||W.fontSize||i.fontSize,pt=Object.prototype.hasOwnProperty.call(W,"wordWrap")?W.wordWrap:i.wordWrap,st=W.lengthLimit||i.lengthLimit,gt=W.lineClamp||i.lineClamp;w.font="".concat(J," ").concat(ot>>0,"px ").concat(Ot),w.fillStyle=W.fontColor||i.fontColor;var Z=[],Tt=String(W.text);if(pt){var qt=t.getWidth(st,c);Z=St(w,kt(Tt),function(){return qt},gt)}else Z=Tt.split(`
`);Z.forEach(function(_t,Gt){w.fillText(_t,U+t.getOffsetX(w.measureText(_t).width,c),dt+t.getHeight(W.top,h)+(Gt+1)*t.getLength(at))})})}});for(var z=t.displacement([m,0,c,S],[0,C,S,h]),x=z[0],I=z[1],T=z[2],_=z[3],A=S;A<g+S;){var R=t.displacement([x,A],[A,I]),q=R[0],ft=R[1];t.drawImage(w,k,x,I,T,_,q,ft,T,_),A+=S}}})},e.prototype.drawBlocks=function(){var t=this,n=this;n.config;var i=n.ctx;n._defaultConfig;var r=n._defaultStyle;return this.prizeArea=this.blocks.reduce(function(l,a,f){var s=l.x,c=l.y,h=l.w,u=l.h,d=Ht(a),y=d[0],p=d[1],g=d[2],b=d[3],k=a.borderRadius?t.getLength(a.borderRadius):0,w=a.background||r.background;return B(w)&&(ht(i,s,c,h,u,k),i.fillStyle=w,i.fill()),a.imgs&&a.imgs.forEach(function(v,$){var m=t.ImageCache.get(v.src);if(m){var C=t.computedWidthAndHeight(m,v,h,u),S=C[0],O=C[1],z=[t.getOffsetX(S,h),t.getHeight(v.top,u)],x=z[0],I=z[1];t.drawImage(i,m,s+x,c+I,S,O)}}),{x:s+g,y:c+y,w:h-g-b,h:u-y-p}},{x:0,y:0,w:this.boxWidth,h:this.boxHeight})},e.prototype.draw=function(){var t,n=this,i=this,r=i.config,l=i.ctx;i._defaultConfig,i._defaultStyle,(t=r.beforeDraw)===null||t===void 0||t.call(this,l),l.clearRect(0,0,this.boxWidth,this.boxHeight);var a=this.drawBlocks(),f=a.x,s=a.y,c=a.w,h=a.h;if(this._offscreenCanvas){var u=this,d=u.cellWidth,y=u.cellHeight,p=u.cellAndSpacing,g=u.widthAndSpacing,b=u.heightAndSpacing;this.slots.forEach(function(k,w){var v=p*k.order.length,$=n.displacement(-(h-b)/2,-(c-g)/2),m=n.scroll[w]+$;m<0&&(m=m%v+v),m>v&&(m%=v);var C=n.displacement([d*w,m,d,h],[m,y*w,c,y]),S=C[0],O=C[1],z=C[2],x=C[3],I=n.displacement([f+g*w,s,d,h],[f,s+b*w,c,y]),T=I[0],_=I[1],A=I[2],R=I[3];n.drawImage(l,n._offscreenCanvas,S,O,z,x,T,_,A,R)})}},e.prototype.carveOnGunwaleOfAMovingBoat=function(){var t=this,n=this,i=n._defaultConfig,r=n.prizeFlag,l=n.cellAndSpacing;this.endTime=Date.now(),this.slots.forEach(function(a,f){var s=a.order;if(s.length)for(var c=a.speed||i.speed,h=a.direction||i.direction,u=s.findIndex(function(k){return k===r[f]}),d=l*s.length,y=t.stopScroll[f]=t.scroll[f],p=0;++p;){var g=l*u+d*p*h-y,b=Y(t.FPS,y,g,i.decelerationTime)-y;if(Math.abs(b)>c){t.endScroll[f]=g;break}}})},e.prototype.play=function(){var t,n;this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,(n=(t=this.config).afterStart)===null||n===void 0||n.call(t),this.run())},e.prototype.stop=function(t){var n;if(this.step!==0&&this.step!==3){if(typeof t=="number")this.prizeFlag=new Array(this.slots.length).fill(t);else{if(!D(t,"array"))return this.stop(-1),console.error("stop() \u65E0\u6CD5\u8BC6\u522B\u7684\u53C2\u6570\u7C7B\u578B ".concat(typeof t));if(t.length!==this.slots.length)return this.stop(-1),console.error("stop([".concat(t,"]) \u53C2\u6570\u957F\u5EA6\u7684\u4E0D\u6B63\u786E"));this.prizeFlag=t}((n=this.prizeFlag)===null||n===void 0?void 0:n.includes(-1))?(this.prizeFlag=[],this.step=0):this.step=2}},e.prototype.run=function(t){var n,i,r=this;t===void 0&&(t=0);var l=this,a=l.rAF,f=l.step,s=l.prizeFlag,c=l._defaultConfig,h=l.cellAndSpacing,u=l.slots,d=c.accelerationTime,y=c.decelerationTime;if(this.step!==0||(s==null?void 0:s.length)!==u.length){if(s===void 0||s.length){this.step!==3||this.endScroll.length||this.carveOnGunwaleOfAMovingBoat();var p=Date.now()-this.startTime,g=Date.now()-this.endTime;u.forEach(function($,m){var C=$.order;if(C&&C.length){var S=h*C.length,O=Math.abs($.speed||c.speed),z=$.direction||c.direction,x=0,I=r.scroll[m];if(f===1||p<d){r.FPS=p/t;var T=$t(p,0,O,d);T===O&&(r.step=2),x=(I+T*z)%S}else if(f===2)x=(I+O*z)%S,(s==null?void 0:s.length)===u.length&&(r.step=3,r.stopScroll=[],r.endScroll=[]);else if(f===3&&g){var _=r.stopScroll[m],A=r.endScroll[m];x=Y(g,_,A,y),g>=y&&(r.step=0)}r.scroll[m]=x}}),this.draw(),a(this.run.bind(this,t+1))}}else{for(var b=s[0],k=0;k<u.length;k++){var w=u[k],v=s[k];if(!((n=w.order)===null||n===void 0?void 0:n.includes(v))||b!==v){b=-1;break}}(i=this.endCallback)===null||i===void 0||i.call(this,this.prizes.find(function($,m){return m===b})||void 0)}},e.prototype.displacement=function(t,n){return this._defaultConfig.mode==="horizontal"?n:t},e.prototype.displacementWidthOrHeight=function(){var t=this._defaultConfig.mode,n=this.slots.length,i=this._defaultConfig,r=i.colSpacing,l=i.rowSpacing,a=this.prizeArea||this.drawBlocks();a.x,a.y;var f,s,c=a.w,h=a.h,u=0,d=0;return t==="horizontal"?(d=this.cellHeight=(h-l*(n-1))/n,u=this.cellWidth=d):(u=this.cellWidth=(c-r*(n-1))/n,d=this.cellHeight=u),f=this.widthAndSpacing=this.cellWidth+r,s=this.heightAndSpacing=this.cellHeight+l,this.cellAndSpacing=t==="horizontal"?f:s,{cellWidth:u,cellHeight:d,widthAndSpacing:f,heightAndSpacing:s}},e}(Ct),zt=function(o,e,t){e===void 0&&(e={}),Ft;var n=e.props,i=e.domProps,r=e.on,l=function(s,c){var h={};for(var u in s)Object.prototype.hasOwnProperty.call(s,u)&&c.indexOf(u)<0&&(h[u]=s[u]);if(s!=null&&typeof Object.getOwnPropertySymbols=="function"){var d=0;for(u=Object.getOwnPropertySymbols(s);d<u.length;d++)c.indexOf(u[d])<0&&Object.prototype.propertyIsEnumerable.call(s,u[d])&&(h[u[d]]=s[u[d]])}return h}(e,["props","domProps","on"]),a=function(s){return s?Object.entries(s).reduce(function(c,h){var u,d=h[0],y=h[1];return d=d.charAt(0).toUpperCase()+d.slice(1),d="on".concat(d),L(L({},c),((u={})[d]=y,u))},{}):null}(r),f=L(L(L(L({},l),n),i),a);return Qt(o,f,t)},xt="@lucky-canvas/vue",Nt=ut({name:"LuckyWheel",props:{width:{type:[String,Number],default:"300px",require:!0},height:{type:[String,Number],default:"300px",require:!0},blocks:{type:Array,default:function(){return[]}},prizes:{type:Array,default:function(){return[]}},buttons:{type:Array,default:function(){return[]}},defaultStyle:{type:Object,default:function(){return{}}},defaultConfig:{type:Object,default:function(){return{}}}},emits:["start","end","success","error","finally"],watch:{blocks:function(o,e){this.$lucky&&(this.$lucky.blocks=o)},prizes:function(o,e){this.$lucky&&(this.$lucky.prizes=o)},buttons:function(o,e){this.$lucky&&(this.$lucky.buttons=o)}},data:function(){return{$lucky:null}},mounted:function(){this.$refs.myLucky&&this.$refs.myLucky.setAttribute("package","".concat(xt,"@").concat("0.1.7"));try{this.initLucky(),this.$emit("success")}catch(o){this.$emit("error",o)}finally{this.$emit("finally")}},methods:{initLucky:function(){var o=this;this.$lucky=new be({flag:"WEB",width:String(this.width),height:String(this.height),divElement:this.$refs.myLucky,rAF:window.requestAnimationFrame,setTimeout:window.setTimeout,setInterval:window.setInterval,clearTimeout:window.clearTimeout,clearInterval:window.clearInterval},L(L({},this.$props),{start:function(e){o.$emit("start",e)},end:function(e){o.$emit("end",e)}}))},init:function(){this.$lucky&&this.$lucky.init()},play:function(){var o;(o=this.$lucky)===null||o===void 0||o.play()},stop:function(o){var e;(e=this.$lucky)===null||e===void 0||e.stop(o)}},render:function(){return zt("div",{ref:"myLucky"})}}),Ce=ut({name:"LuckyGrid",props:{width:{type:[String,Number],default:"300px",require:!0},height:{type:[String,Number],default:"300px",require:!0},cols:{type:[String,Number],default:3},rows:{type:[String,Number],default:3},blocks:{type:Array,default:function(){return[]}},prizes:{type:Array,default:function(){return[]}},buttons:{type:Array,default:function(){return[]}},button:{type:Object},defaultStyle:{type:Object,default:function(){return{}}},activeStyle:{type:Object,default:function(){return{}}},defaultConfig:{type:Object,default:function(){return{}}}},emits:["start","end","success","error","finally"],watch:{cols:function(o,e){this.$lucky&&(this.$lucky.cols=o)},rows:function(o,e){this.$lucky&&(this.$lucky.rows=o)},blocks:function(o,e){this.$lucky&&(this.$lucky.blocks=o)},prizes:function(o,e){this.$lucky&&(this.$lucky.prizes=o)},buttons:function(o,e){this.$lucky&&(this.$lucky.buttons=o)},button:function(o,e){this.$lucky&&(this.$lucky.button=o)}},data:function(){return{$lucky:null}},mounted:function(){this.$refs.myLucky&&this.$refs.myLucky.setAttribute("package","".concat(xt,"@").concat("0.1.7"));try{this.initLucky(),this.$emit("success")}catch(o){this.$emit("error",o)}finally{this.$emit("finally")}},methods:{initLucky:function(){var o=this;this.$lucky=new ke({flag:"WEB",width:String(this.width),height:String(this.height),divElement:this.$refs.myLucky,rAF:window.requestAnimationFrame,setTimeout:window.setTimeout,setInterval:window.setInterval,clearTimeout:window.clearTimeout,clearInterval:window.clearInterval},L(L({},this.$props),{start:function(e,t){o.$emit("start",e,t)},end:function(e){o.$emit("end",e)}}))},init:function(){this.$lucky&&this.$lucky.init()},play:function(){var o;(o=this.$lucky)===null||o===void 0||o.play()},stop:function(o){var e;(e=this.$lucky)===null||e===void 0||e.stop(o)}},render:function(){return zt("div",{ref:"myLucky"})}}),$e=ut({name:"SlotMachine",props:{width:{type:[String,Number],default:"300px",require:!0},height:{type:[String,Number],default:"300px",require:!0},blocks:{type:Array,default:function(){return[]}},prizes:{type:Array,default:function(){return[]}},slots:{type:Array,default:function(){return[]}},defaultStyle:{type:Object,default:function(){return{}}},defaultConfig:{type:Object,default:function(){return{}}}},watch:{blocks:function(o,e){this.$lucky&&(this.$lucky.blocks=o)},slots:function(o,e){this.$lucky&&(this.$lucky.slots=o)},prizes:function(o,e){this.$lucky&&(this.$lucky.prizes=o)}},data:function(){return{$lucky:null}},mounted:function(){this.$refs.myLucky&&this.$refs.myLucky.setAttribute("package","".concat(xt,"@").concat("0.1.7"));try{this.initLucky(),this.$emit("success")}catch(o){this.$emit("error",o)}finally{this.$emit("finally")}},methods:{initLucky:function(){var o=this;this.$lucky=new Se({flag:"WEB",width:String(this.width),height:String(this.height),divElement:this.$refs.myLucky,rAF:window.requestAnimationFrame,setTimeout:window.setTimeout,setInterval:window.setInterval,clearTimeout:window.clearTimeout,clearInterval:window.clearInterval},L(L({},this.$props),{start:function(e){o.$emit("start",e)},end:function(e){o.$emit("end",e)}}))},init:function(){this.$lucky&&this.$lucky.init()},play:function(){var o;(o=this.$lucky)===null||o===void 0||o.play()},stop:function(o){var e;(e=this.$lucky)===null||e===void 0||e.stop(o)}},render:function(){return zt("div",{ref:"myLucky"})}}),ze=function(o){o.component("LuckyWheel",Nt),o.component("LuckyGrid",Ce),o.component("SlotMachine",$e)};typeof window!="undefined"&&window.Vue&&Ft&&ze(window.Vue);const xe=ut({name:"RandomList",components:{Tag:te,Tooltip:ee,Input:ie,Typography:ne,Divider:re,Plus:oe,LuckyWheel:Nt},data:()=>({tags:[],inputValue:"",inputVisible:!1,loading:!1,blocks:[{padding:"10px",background:"#869cfa"}],buttons:[{radius:"40%",background:"#617df2"},{radius:"35%",background:"#afc8ff"},{radius:"30%",background:"#869cfa",pointer:!0,fonts:[{text:"\u5F00\u59CB",top:"-10px"}]}]}),computed:vt(mt({},ae(["getData"])),{prizes:function(){const o=["#e9e8fe","#b8c5f2"];return this.tags.map((e,t)=>({background:o[t%2],fonts:[{text:e}]}))}}),watch:{},mounted(){this.tags=(this.getData("randomList")||{}).tags||[]},beforeUnmount(){},methods:vt(mt({},se(["setData"])),{startCallBack(){this.loading=!0,this.$refs.myLucky.play(),setTimeout(()=>{this.$refs.myLucky.stop(ce(this.tags.length))},3e3)},endCallBack(o){le.success({title:()=>`\u62BD\u4E2D\u4E86 \u300E${o.fonts[0].text}\u300F`,onOk:()=>{this.$refs.myLucky.init(),this.loading=!1}})},updateCache(){this.setData({key:"randomList",val:{tags:this.tags}})},handleClose(o){this.tags=this.tags.filter(e=>e!==o),this.updateCache()},showInput(){this.inputVisible=!0,this.$nextTick(()=>{this.$refs.inputRef.focus()})},handleInputConfirm(){const o=this.inputValue;o&&this.tags.indexOf(o)===-1&&(this.tags=[...this.tags,o]),this.inputVisible=!1,this.inputValue="",this.updateCache()}})}),Ie=o=>(fe("data-v-336cc3f1"),o=o(),de(),o),Oe=Ie(()=>pe("h4",null,"\u968F\u673A\u5217\u8868",-1)),Te=yt(" \u65B0\u5185\u5BB9 ");function _e(o,e,t,n,i,r){const l=N("Typography"),a=N("Tag"),f=N("Tooltip"),s=N("Input"),c=N("Plus"),h=N("Divider"),u=N("LuckyWheel");return F(),Q(it,null,[tt(l,null,{default:et(()=>[Oe]),_:1}),(F(!0),Q(it,null,he(o.tags,(d,y)=>(F(),Q(it,{key:y},[d.length>20?(F(),ct(f,{key:0,title:d},{default:et(()=>[tt(a,{closable:!o.loading,onClose:p=>o.handleClose(d)},{default:et(()=>[yt(Et(`${d.slice(0,20)}...`),1)]),_:2},1032,["closable","onClose"])]),_:2},1032,["title"])):(F(),ct(a,{key:1,closable:!o.loading,onClose:p=>o.handleClose(d)},{default:et(()=>[yt(Et(d),1)]),_:2},1032,["closable","onClose"]))],64))),128)),o.loading?Lt("",!0):(F(),Q(it,{key:0},[o.inputVisible?(F(),ct(s,{key:0,ref:"inputRef",value:o.inputValue,"onUpdate:value":e[0]||(e[0]=d=>o.inputValue=d),type:"text",size:"small",style:{width:"78px"},onBlur:o.handleInputConfirm,onKeyup:ue(o.handleInputConfirm,["enter"])},null,8,["value","onBlur","onKeyup"])):(F(),ct(a,{key:1,style:{background:"#fff","border-style":"dashed"},onClick:o.showInput},{default:et(()=>[tt(c,{theme:"outline"}),Te]),_:1},8,["onClick"]))],64)),o.tags.length?(F(),Q(it,{key:1},[tt(h),tt(u,{ref:"myLucky",width:"200px",height:"200px",blocks:o.blocks,prizes:o.prizes,buttons:o.buttons,onStart:o.startCallBack,onEnd:o.endCallBack},null,8,["blocks","prizes","buttons","onStart","onEnd"])],64)):Lt("",!0)],64)}var Re=ge(xe,[["render",_e],["__scopeId","data-v-336cc3f1"]]);export{Re as default};
