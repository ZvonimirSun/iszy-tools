import{m as y,c as n}from"./marker-shadow.2a6721e2.js";import{l as t}from"./leaflet-src.210582e5.js";import{ad as b,ae as F,m as L,V as M,c as x,a as u,a8 as C,u as c,x as w,H as G,E as _,p as I,b as B,r as g,o as i,a7 as J,aB as j}from"./vendor.c45c2a3c.js";/* empty css                *//* empty css               */import{_ as z}from"./index.29b6224a.js";const{Item:D}=b,Z=new t.exports.Icon({iconUrl:"https://cdn.jsdelivr.net/gh/zvonimirsun/leaflet-color-markers@master/img/marker-icon-2x-blue.png",shadowUrl:y,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),E=new t.exports.Icon({iconUrl:"https://cdn.jsdelivr.net/gh/zvonimirsun/leaflet-color-markers@master/img/marker-icon-2x-yellow.png",shadowUrl:y,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),l="bed806b1ccb34b268ab1c0700123d444";let a;const O={name:"leafletMap",props:{geoJsonLayer:Object},emits:["update:geoJsonLayer"],components:{Form:b,Item:D,Input:F},data:()=>({selectedFeature:void 0}),mounted(){this.$eventBus.on("locationGeo",this.locationGeo),this.$eventBus.on("updateGeojsonLayer",this.updateGeojsonLayer),this.initMap(),this.$nextTick(()=>{this.addBaseMaps(),this.addControls()})},methods:{initMap(){a=L(t.exports.map(this.$refs.mapContainer,{attributionControl:!0,zoomControl:!1})),a.setView([35,105],4),this.$emit("update:geoJsonLayer",t.exports.geoJSON(void 0,{onEachFeature:this.onEachFeature,pointToLayer:(e,o)=>t.exports.marker(o,{icon:Z})}).addTo(a))},addBaseMaps(){t.exports.control.layers({\u9AD8\u5FB7\u77E2\u91CF:n("GaoDe.Normal.Map",{minZoom:3,maxNativeZoom:18,maxZoom:20,attribution:'&copy; <a href="https://lbs.amap.com/pages/terms/" target="_blank">\u9AD8\u5FB7\u5730\u56FE</a> \u8D21\u732E\u8005'}).addTo(a),\u9AD8\u5FB7\u5F71\u50CF:t.exports.layerGroup([n("GaoDe.Satellite.Map",{minZoom:3,maxNativeZoom:18,maxZoom:20}),n("GaoDe.Satellite.Annotation",{minZoom:3,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://lbs.amap.com/pages/terms/" target="_blank">\u9AD8\u5FB7\u5730\u56FE</a> \u8D21\u732E\u8005'}),\u5929\u5730\u56FE\u77E2\u91CF:t.exports.layerGroup([n("TianDiTu.Normal.Map",{key:l,minZoom:3,maxNativeZoom:18,maxZoom:20}),n("TianDiTu.Normal.Annotation",{key:l,minZoom:3,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">\u5929\u5730\u56FE</a> \u8D21\u732E\u8005'}),\u5929\u5730\u56FE\u5F71\u50CF:t.exports.layerGroup([n("TianDiTu.Satellite.Map",{key:l,minZoom:3,maxNativeZoom:18,maxZoom:20}),n("TianDiTu.Satellite.Annotation",{key:l,minZoom:3,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">\u5929\u5730\u56FE</a> \u8D21\u732E\u8005'}),\u5929\u5730\u56FE\u5730\u5F62:t.exports.layerGroup([n("TianDiTu.Terrain.Map",{key:l,minZoom:3,maxNativeZoom:14,maxZoom:20}),n("TianDiTu.Terrain.Annotation",{key:l,minZoom:3,maxNativeZoom:14,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">\u5929\u5730\u56FE</a> \u8D21\u732E\u8005'}),OpenStreetMap:n("OSM.Normal.Map",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> \u8D21\u732E\u8005',minZoom:3,maxNativeZoom:19,maxZoom:20})},{\u56FE\u5F62:M(this.geoJsonLayer)},{hideSingleBase:!0,position:"topright"}).addTo(a)},addControls(){t.exports.control.scale({imperial:!1,position:"bottomleft"}).addTo(a),t.exports.control.zoom({zoomInTitle:"\u653E\u5927",zoomOutTitle:"\u7F29\u5C0F",position:"bottomright"}).addTo(a)},onEachFeature(e,o){e.properties&&o.bindPopup(this.$refs.propertyPopup).on("popupopen",()=>{this.selectedFeature=e,o instanceof t.exports.Marker?o.setIcon(E):o.setStyle({color:"#ffff00",weight:5,opacity:.65})}).on("popupclose",()=>{this.selectedFeature=void 0,o instanceof t.exports.Marker?o.setIcon(Z):this.geoJsonLayer.resetStyle(o)})},saveToEditor(e,o,r){if(e instanceof InputEvent&&o&&r)try{o.properties[r]=JSON.parse(e.currentTarget.value)}catch{o.properties[r]=e.currentTarget.value}this.$eventBus.emit("updateEditor")},locationGeo(e){try{const r=t.exports.geoJSON(e).getBounds(),p=r.getCenter(),d=a.getBoundsZoom(r);a.setView(p,d>16?16:d)}catch{}},updateGeojsonLayer(e){if(this.geoJsonLayer&&this.geoJsonLayer instanceof t.exports.GeoJSON){this.geoJsonLayer.clearLayers();try{this.geoJsonLayer.addData(e);const o=this.geoJsonLayer.getBounds(),r=o.getCenter(),p=a.getBoundsZoom(o);a.setView(r,p>16?16:p)}catch(o){console.log(o)}}}},beforeUnmount(){this.$eventBus.off("locationGeo",this.locationGeo),this.$eventBus.off("updateGeojsonLayer",this.updateGeojsonLayer),a&&(a.remove(),a=void 0)}},$=e=>(I("data-v-5cb6b3b2"),e=e(),B(),e),U={class:"mapContainer",ref:"mapContainer"},A={class:"propertyPopup",ref:"propertyPopup"},V=$(()=>u("div",{class:"title"},[u("span",null,"\u5C5E\u6027")],-1));function P(e,o,r,p,d,h){var v;const f=g("Input"),T=g("Item"),S=g("Form");return i(),x(_,null,[u("div",U,null,512),C(u("div",A,[V,((v=e.selectedFeature)==null?void 0:v.properties)?(i(),c(S,{key:0,"label-col":{span:8},"wrapper-col":{span:16},colon:!1},{default:w(()=>[(i(!0),x(_,null,J(e.selectedFeature.properties,(k,s,N)=>(i(),c(T,{label:s,key:"prop"+N},{default:w(()=>[typeof e.selectedFeature.properties[s]=="string"?(i(),c(f,{key:0,value:e.selectedFeature.properties[s],"onUpdate:value":m=>e.selectedFeature.properties[s]=m,onChange:h.saveToEditor},null,8,["value","onUpdate:value","onChange"])):typeof e.selectedFeature.properties[s]=="number"?(i(),c(f,{key:1,value:e.selectedFeature.properties[s],"onUpdate:value":m=>e.selectedFeature.properties[s]=m,valueModifiers:{number:!0},onChange:h.saveToEditor},null,8,["value","onUpdate:value","onChange"])):(i(),c(f,{key:2,value:JSON.stringify(k),onChange:m=>h.saveToEditor(m,e.selectedFeature,s)},null,8,["value","onChange"]))]),_:2},1032,["label"]))),128))]),_:1})):G("",!0)],512),[[j,!1]])],64)}var X=z(O,[["render",P],["__scopeId","data-v-5cb6b3b2"]]);export{X as default};
