import{k as P,Q as Z,aw as T,E as k,r as c,q as O,G as $,x as n,w as l,N as u,K as o,F as r,a0 as D,J as ee,n as re,s as ie,aB as ue,R as I,a4 as X,H as E,Y as z,Z as K,L as te,X as Q,W as de,aA as y,v as W,$ as pe,ax as Y,P as fe,at as me,bl as ce}from"./index-CiwyZVDa.js";import{E as oe}from"./el-divider-D1vvcAYf.js";import{E as H}from"./el-space-Cxo-WSyB.js";import{E as le}from"./el-checkbox-Ct5cP3DY.js";import{T as B,u as _e}from"./Router-Bifg_M__.js";import{E as ge}from"./el-popover-6-FG_QJZ.js";import"./el-popper-Dcvg2tBv.js";import{E as ve}from"./el-dialog-BZk0Bb2I.js";import{a as we,E as ye}from"./el-form-item-BiZtJrBF.js";import{L as ke}from"./linuxdo-C7o2R0pC.js";import{E as xe,a as Ve}from"./el-radio-group-bwHNxNCJ.js";/* empty css                 */import"./index-C8Y1W57m.js";import"./isUndefined-DCTLXrZ8.js";import"./castArray-wig7wfO1.js";import"./clone-Ct6WsOVd.js";const be=P({__name:"jsonEditor",setup(x){const s=Z(),_=T(),i=s.modules.jsonEditor;return(C,e)=>{const V=B,m=le,b=H;return c(),k("div",null,[n(_).logged?(c(),O(V,{key:0,level:5},{default:l(()=>e[1]||(e[1]=[u(" JSON 编辑器 ")])),_:1})):$("",!0),n(_).logged?(c(),O(b,{key:1},{default:l(()=>[o(m,{modelValue:n(i).syncCloud,"onUpdate:modelValue":e[0]||(e[0]=f=>n(i).syncCloud=f)},{default:l(()=>e[2]||(e[2]=[u(" 从云端获取 ")])),_:1},8,["modelValue"])]),_:1})):$("",!0)])}}}),Ce={"w-full":"","overflow-auto":""},Ne={"gap-4":"",class:"settings-wrapper"},Ee=P({__name:"toolSettings",setup(x){return(s,_)=>{const i=B;return c(),k("div",Ce,[o(i,{level:4},{default:l(()=>_[0]||(_[0]=[u(" 应用设置 ")])),_:1}),r("div",Ne,[o(be)])])}}}),Se=D(Ee,[["__scopeId","data-v-730637d2"]]),$e=P({inheritAttrs:!1,__name:"HaveAccess",props:{auth:{type:[Boolean,Object],default:!1},link:{default:""}},setup(x){const s=x,_=T(),i=_e(),C=ee(),e=re(()=>s.auth?typeof s.auth=="boolean"?_.logged:_.checkAccess(s.auth):s.link?_.checkAccess(i.getAuth(s.link)):!0);function V(){s.link&&C.push(s.link)}return(m,b)=>n(e)?ie(m.$slots,"default",ue({key:0},m.$attrs,{goto:V})):$("",!0)}}),Pe={flex:"","flex-col":"","items-start":"","gap-4":"","text-7":""},Ue={flex:"","items-center":"","gap-4":""},he={flex:"","items-center":"","gap-4":""},Ie={flex:"","items-center":"","gap-4":""},Te={flex:"","items-center":"","gap-4":""},De={flex:"","items-center":"","gap-4":""},Be={flex:"","items-center":"","gap-4":""},Re=["title","onClick"],Le=["src"],Oe=["onClick"],Ae={flex:"","items-center":""},Fe={class:"dialog-footer"},Me={flex:"","flex-col":"","gap-4":"","p-0":""},Ge={"w-full":"","flex-inline":"","items-center":"","gap-2":""},je={"flex-1":""},ze={key:0},He={"w-full":"",flex:"","flex-col":"","p-l-6":""},qe={flex:"","items-center":""},Je={class:"dialog-footer"},Xe=P({__name:"personalInfo",setup(x){const s=T(),_=[{type:"github",title:"Github",icon:"i-icon-park-outline:github"},{type:"linuxdo",title:"LINUX DO",img:ke}],i=I(!1),C=I(),e=X({userName:"",nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),V=X({userName:[{trigger:"change",validator:(d,t,p)=>{t&&!t.trim()?p(new Error("用户名无效")):p()}}],nickName:[{trigger:"change",validator:(d,t,p)=>{t&&!t.trim()?p(new Error("昵称无效")):p()}}],rePasswd:[{trigger:"change",validator:(d,t,p)=>{t&&t!==e.passwd?p(new Error("两次输入的密码不一致")):p()}}]}),m=I(""),b=I(!1),f=I([]);async function v(){try{f.value=await s.getDevices(),b.value=!0}catch(d){b.value=!1,y.error(d.message)}}function w(){b.value=!1}async function U(d){if(d.current){await s.logout(),y.success("登出成功");return}await s.logoutDevice(d),y.success("登出成功"),d.all||(f.value=await s.getDevices())}function A(){e.userName=s.profile.userName??"",e.nickName=s.profile.nickName??"",e.email=s.profile.email??"",e.passwd="",e.rePasswd="",e.oldPasswd="",i.value=!0}function R(){i.value=!1}async function F(d){d&&await d.validate(async t=>{if(t){const p={};if(e.userName&&(p.userName=e.userName),e.nickName&&(p.nickName=e.nickName),e.email&&(p.email=e.email),e.passwd&&(p.passwd=e.passwd,e.oldPasswd&&(p.oldPasswd=e.oldPasswd)),Object.keys(p).length===0){y.warning("没有需要修改的信息");return}try{await s.updateUser(p)}catch(g){y.error(g.message)}i.value=!1}else y.warning("请检查输入")})}async function se(d,t){if(s.profile[d])return;const p=new URL(`${Y.apiBaseUrl}/auth/${d}/bind`);p.searchParams.append("access_token",s.access_token),ae(d,p.toString(),t)}async function ne(d){if(s.profile[d])try{await s.thirdPartyUnbind(d),y.success("解绑成功")}catch(t){y.error(t.message)}}async function M(d){var p,g;const t=d.source;if(d.origin===Y.apiBaseUrl)if(((p=d.data)==null?void 0:p.type)==="bind_success"){window.removeEventListener("message",M),t.close();try{await s.thirdPartyBind(m.value,d.data.data),y.success("绑定成功")}catch(N){y.error(N.message)}finally{m.value=""}}else((g=d.data)==null?void 0:g.type)==="bind_fail"&&(window.removeEventListener("message",M),t.close(),m.value="",y.error("绑定失败"))}function ae(d,t,p="绑定第三方登录",g=500,N=600){if(m.value){y.warning("绑定进行中，请勿重复点击");return}m.value=d,window.addEventListener("message",M);const S=(window.screen.height-g)/2,G=(window.screen.width-N)/2,h=window.open(t,p,`popup,width=${g},height=${N},top=${S},left=${G}`);if(!h){m.value="",y.error("请允许浏览器弹出窗口！");return}const L=window.setInterval(()=>{h.closed&&(window.clearInterval(L),m.value="")},500)}return(d,t)=>{var L,q,J;const p=B,g=te,N=de,S=ye,G=we,h=ve;return c(),k("div",null,[o(p,{level:4},{default:l(()=>t[11]||(t[11]=[u(" 账户信息 ")])),_:1}),r("div",Pe,[r("div",Ue,[t[12]||(t[12]=r("div",{"w-32":"","text-right":""}," 用户名: ",-1)),r("div",null,E(n(s).profile.userName),1)]),r("div",he,[t[13]||(t[13]=r("div",{"w-32":"","text-right":""}," 昵称: ",-1)),r("div",null,E(n(s).profile.nickName),1)]),r("div",Ie,[t[14]||(t[14]=r("div",{"w-32":"","text-right":""}," 邮箱: ",-1)),r("div",null,E(n(s).profile.email),1)]),r("div",Te,[t[15]||(t[15]=r("div",{"w-32":"","text-right":""}," 角色: ",-1)),r("div",null,E(((J=(q=(L=n(s).profile)==null?void 0:L.roles)==null?void 0:q[0])==null?void 0:J.alias)??"注册用户"),1)]),r("div",De,[t[17]||(t[17]=r("div",{"w-32":"","text-right":""}," 绑定: ",-1)),r("div",Be,[(c(),k(z,null,K(_,a=>r("div",{key:a.type,class:W(["third-party",{active:n(s).profile[a.type]}]),title:a.title,onClick:j=>se(a.type,`${a.title} 绑定`)},[a.icon?(c(),k("i",{key:0,class:W(a.icon)},null,2)):a.img?(c(),k("img",{key:1,src:a.img,class:"third-party-img",alt:""},null,8,Le)):$("",!0),n(s).profile[a.type]?(c(),k("div",{key:2,class:"unbind-btn",title:"解绑",onClick:pe(j=>ne(a.type),["stop"])},t[16]||(t[16]=[r("i",{class:"i-icon-park-solid:close-one"},null,-1)]),8,Oe)):$("",!0)],10,Re)),64))])]),r("div",Ae,[o(g,{onClick:A},{default:l(()=>t[18]||(t[18]=[u(" 修改信息 ")])),_:1}),o(g,{onClick:v},{default:l(()=>t[19]||(t[19]=[u(" 登录设备管理 ")])),_:1})])]),o(h,{modelValue:n(i),"onUpdate:modelValue":t[7]||(t[7]=a=>Q(i)?i.value=a:null),title:"修改信息","before-close":R},{footer:l(()=>[r("span",Fe,[o(g,{onClick:R},{default:l(()=>t[20]||(t[20]=[u("取消")])),_:1}),o(g,{type:"primary",onClick:t[6]||(t[6]=a=>F(n(C)))},{default:l(()=>t[21]||(t[21]=[u(" 保存 ")])),_:1})])]),default:l(()=>[o(G,{ref_key:"ruleFormRef",ref:C,model:n(e),rules:n(V),"label-width":"8rem","label-position":"left"},{default:l(()=>[o(S,{label:"用户名",prop:"userName"},{default:l(()=>[o(N,{modelValue:n(e).userName,"onUpdate:modelValue":t[0]||(t[0]=a=>n(e).userName=a)},null,8,["modelValue"])]),_:1}),o(S,{label:"昵称",prop:"nickName"},{default:l(()=>[o(N,{modelValue:n(e).nickName,"onUpdate:modelValue":t[1]||(t[1]=a=>n(e).nickName=a)},null,8,["modelValue"])]),_:1}),o(S,{label:"邮箱",prop:"email"},{default:l(()=>[o(N,{modelValue:n(e).email,"onUpdate:modelValue":t[2]||(t[2]=a=>n(e).email=a)},null,8,["modelValue"])]),_:1}),o(S,{label:"旧密码",prop:"oldPasswd"},{default:l(()=>[o(N,{modelValue:n(e).oldPasswd,"onUpdate:modelValue":t[3]||(t[3]=a=>n(e).oldPasswd=a),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(S,{label:"新密码",prop:"passwd"},{default:l(()=>[o(N,{modelValue:n(e).passwd,"onUpdate:modelValue":t[4]||(t[4]=a=>n(e).passwd=a),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(S,{label:"确认密码",prop:"rePasswd"},{default:l(()=>[o(N,{modelValue:n(e).rePasswd,"onUpdate:modelValue":t[5]||(t[5]=a=>n(e).rePasswd=a),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),o(h,{modelValue:n(b),"onUpdate:modelValue":t[10]||(t[10]=a=>Q(b)?b.value=a:null),title:"管理登录设备","before-close":w,width:400},{footer:l(()=>[r("span",Je,[o(g,{type:"primary",onClick:w},{default:l(()=>t[25]||(t[25]=[u(" 关闭 ")])),_:1})])]),default:l(()=>[r("ul",Me,[(c(!0),k(z,null,K(n(f),(a,j)=>(c(),k("li",{key:j,"w-full":"",flex:"","flex-col":""},[r("div",Ge,[r("span",je,E(a.name||a.id),1),a.current?(c(),k("span",ze,"(当前设备)")):$("",!0),o(g,{size:"small",onClick:nt=>U({deviceId:a.id,current:a.current})},{default:l(()=>t[22]||(t[22]=[u(" 登出 ")])),_:2},1032,["onClick"])]),r("div",He,[r("span",null,"IP: "+E(a.ip),1),r("span",null,"首次登录时间: "+E(a.createTime),1),r("span",null,"最后登录时间: "+E(a.lastLoginTime),1)])]))),128)),r("li",qe,[o(g,{size:"small",onClick:t[8]||(t[8]=a=>U({other:!0}))},{default:l(()=>t[23]||(t[23]=[u(" 登出其他 ")])),_:1}),o(g,{size:"small",onClick:t[9]||(t[9]=a=>U({all:!0}))},{default:l(()=>t[24]||(t[24]=[u(" 登出所有 ")])),_:1})])])]),_:1},8,["modelValue"])])}}}),Ke=D(Xe,[["__scopeId","data-v-5b94145b"]]),Qe=fe("main",{persist:!0,state:()=>({_cache:{},clearOfflineCacheTag:!1}),getters:{getData:x=>s=>{if(s)return(x._cache||{})[s]}},actions:{setData({key:x,val:s}={}){x&&(this._cache=this._cache||{},this._cache[x]=s)},clear(){this._cache={}},clearOfflineCache(){console.log("clearOfflineCache"),this.clearOfflineCacheTag=!0}}}),We={flex:"","items-center":"","gap-4":""},Ye=P({__name:"authInfo",setup(x){const s=ee(),_=me(),i=T(),C=()=>Qe().clearOfflineCache();function e(){s.push({path:"/login",query:{redirect:_.fullPath}})}function V(){s.push("/register")}function m(){s.push("/logout")}return(b,f)=>{const v=te,w=$e,U=ge,A=oe,R=H;return n(i).logged?(c(),k(z,{key:0},[r("div",We,[o(v,{type:"primary",onClick:m},{default:l(()=>f[0]||(f[0]=[u(" 登出 ")])),_:1}),o(w,{link:"/userManager"},{default:l(({goto:F})=>[o(v,{onClick:F},{default:l(()=>f[1]||(f[1]=[u(" 用户权限中心 ")])),_:2},1032,["onClick"])]),_:1}),o(U,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:C},{reference:l(()=>[o(v,{type:"danger",plain:""},{default:l(()=>f[2]||(f[2]=[u(" 清空本地缓存 ")])),_:1})]),_:1})]),o(A),o(Ke)],64)):(c(),O(R,{key:1,"mt-4":""},{default:l(()=>[o(v,{type:"primary",onClick:e},{default:l(()=>f[3]||(f[3]=[u(" 登录 ")])),_:1}),o(v,{onClick:V},{default:l(()=>f[4]||(f[4]=[u(" 注册 ")])),_:1}),o(U,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:C},{reference:l(()=>[o(v,{type:"danger",plain:""},{default:l(()=>f[5]||(f[5]=[u(" 清空本地缓存 ")])),_:1})]),_:1})]),_:1}))}}}),Ze=D(Ye,[["__scopeId","data-v-304747f8"]]),et={class:"settings-wrapper"},tt=P({__name:"globalSettings",setup(x){const s=Z(),_=ce(),i=s.general;return(C,e)=>{const V=B,m=Ve,b=xe,f=H,v=le;return c(),k("div",et,[o(V,{level:4},{default:l(()=>e[5]||(e[5]=[u(" 全局设置 ")])),_:1}),o(V,{level:5},{default:l(()=>e[6]||(e[6]=[u(" 外观 ")])),_:1}),o(f,null,{default:l(()=>[o(b,{"model-value":n(i).theme.mode,onChange:n(_).setTheme},{default:l(()=>[o(m,{value:"auto",label:"跟随系统"}),o(m,{value:"light",label:"浅色"}),o(m,{value:"dark",label:"深色"})]),_:1},8,["model-value","onChange"])]),_:1}),o(V,{level:5},{default:l(()=>e[7]||(e[7]=[u(" 访问统计 ")])),_:1}),o(f,null,{default:l(()=>[o(v,{modelValue:n(i).showMost,"onUpdate:modelValue":e[0]||(e[0]=w=>n(i).showMost=w)},{default:l(()=>e[8]||(e[8]=[u(" 最常访问 ")])),_:1},8,["modelValue"]),o(v,{modelValue:n(i).showRecent,"onUpdate:modelValue":e[1]||(e[1]=w=>n(i).showRecent=w)},{default:l(()=>e[9]||(e[9]=[u(" 最近访问 ")])),_:1},8,["modelValue"])]),_:1}),o(V,{level:5},{default:l(()=>e[10]||(e[10]=[u(" 其他设置 ")])),_:1}),o(f,null,{default:l(()=>[o(v,{modelValue:n(i).showSearch,"onUpdate:modelValue":e[2]||(e[2]=w=>n(i).showSearch=w)},{default:l(()=>e[11]||(e[11]=[u(" 显示搜索 ")])),_:1},8,["modelValue"]),o(v,{modelValue:n(i).showType,"onUpdate:modelValue":e[3]||(e[3]=w=>n(i).showType=w)},{default:l(()=>e[12]||(e[12]=[u(" 显示分类 ")])),_:1},8,["modelValue"]),o(v,{modelValue:n(i).openInNewTab,"onUpdate:modelValue":e[4]||(e[4]=w=>n(i).openInNewTab=w)},{default:l(()=>e[13]||(e[13]=[u(" 新标签页打开工具 ")])),_:1},8,["modelValue"])]),_:1})])}}}),ot=D(tt,[["__scopeId","data-v-f2fa67ef"]]),lt={flex:"","flex-wrap":"","items-start":"","gap-4":""},st=P({__name:"settings",setup(x){const s=T();return(_,i)=>{const C=B,e=oe;return c(),k("div",null,[n(s).logged?(c(),O(C,{key:0,level:3},{default:l(()=>[u(E(n(s).profile.nickName)+" 欢迎你~ ",1)]),_:1})):$("",!0),o(Ze),o(e),r("div",lt,[o(ot),o(Se,{"flex-1":""})])])}}}),Vt=D(st,[["__scopeId","data-v-0add9d51"]]);export{Vt as default};
