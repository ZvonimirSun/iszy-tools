import{b9 as Z,aF as ue,cc as ce,h as A,j as v,cd as b,m as G,_ as H,k as _,aS as ke,u as N,ce as K,R as de,n as W,q as T,r as g,w as C,E as S,s as $,Y as Ee,Z as $e,bk as pe,x as s,v as y,G as h,F as q,$ as B,K as P,aN as O,cf as Ce,H as Q,t as Re,cg as Fe,ch as we,bf as Pe,ci as Se,cj as Ue,ck as Le,l as Te,a9 as J,bx as x,cl as ee,cm as _e,aH as De,cn as Oe,a7 as te,co as Be,ab as je,I as qe,am as Ne,b0 as se,aB as ae,z as Ae}from"./index-Cgiq8ZMG.js";import{E as He}from"./el-progress-DIEkUKLC.js";import{i as Ke}from"./Router-CjbSmzHk.js";const fe=Symbol("uploadContextKey"),Me="ElUpload";class ze extends Error{constructor(r,a,d,i){super(r),this.name="UploadAjaxError",this.status=a,this.method=d,this.url=i}}function oe(o,r,a){let d;return a.response?d=`${a.response.error||a.response}`:a.responseText?d=`${a.responseText}`:d=`fail to ${r.method} ${o} ${a.status}`,new ze(d,a.status,r.method,o)}function Ie(o){const r=o.responseText||o.response;if(!r)return r;try{return JSON.parse(r)}catch{return r}}const Ve=o=>{typeof XMLHttpRequest>"u"&&Z(Me,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,a=o.action;r.upload&&r.upload.addEventListener("progress",u=>{const f=u;f.percent=u.total>0?u.loaded/u.total*100:0,o.onProgress(f)});const d=new FormData;if(o.data)for(const[u,f]of Object.entries(o.data))ue(f)&&f.length?d.append(u,...f):d.append(u,f);d.append(o.filename,o.file,o.file.name),r.addEventListener("error",()=>{o.onError(oe(a,o,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return o.onError(oe(a,o,r));o.onSuccess(Ie(r))}),r.open(o.method,a,!0),o.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const i=o.headers||{};if(i instanceof Headers)i.forEach((u,f)=>r.setRequestHeader(f,u));else for(const[u,f]of Object.entries(i))ce(f)||r.setRequestHeader(u,String(f));return r.send(d),r},ve=["text","picture","picture-card"];let Xe=1;const Y=()=>Date.now()+Xe++,me=A({action:{type:String,default:"#"},headers:{type:v(Object)},method:{type:String,default:"post"},data:{type:v([Object,Function,Promise]),default:()=>G({})},multiple:Boolean,name:{type:String,default:"file"},drag:Boolean,withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:v(Array),default:()=>G([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ve,default:"text"},httpRequest:{type:v(Function),default:Ve},disabled:Boolean,limit:Number}),Ge=A({...me,beforeUpload:{type:v(Function),default:b},beforeRemove:{type:v(Function)},onRemove:{type:v(Function),default:b},onChange:{type:v(Function),default:b},onPreview:{type:v(Function),default:b},onSuccess:{type:v(Function),default:b},onProgress:{type:v(Function),default:b},onError:{type:v(Function),default:b},onExceed:{type:v(Function),default:b},crossorigin:{type:v(String)}}),We=A({files:{type:v(Array),default:()=>G([])},disabled:{type:Boolean,default:!1},handlePreview:{type:v(Function),default:b},listType:{type:String,values:ve,default:"text"},crossorigin:{type:v(String)}}),Je={remove:o=>!!o},Ye=_({name:"ElUploadList"}),Ze=_({...Ye,props:We,emits:Je,setup(o,{emit:r}){const a=o,{t:d}=ke(),i=N("upload"),u=N("icon"),f=N("list"),k=K(),m=de(!1),R=W(()=>[i.b("list"),i.bm("list",a.listType),i.is("disabled",a.disabled)]),E=p=>{r("remove",p)};return(p,U)=>(g(),T(Le,{tag:"ul",class:y(s(R)),name:s(f).b()},{default:C(()=>[(g(!0),S(Ee,null,$e(p.files,(t,n)=>(g(),S("li",{key:t.uid||t.name,class:y([s(i).be("list","item"),s(i).is(t.status),{focusing:m.value}]),tabindex:"0",onKeydown:pe(e=>!s(k)&&E(t),["delete"]),onFocus:e=>m.value=!0,onBlur:e=>m.value=!1,onClick:e=>m.value=!1},[$(p.$slots,"default",{file:t,index:n},()=>[p.listType==="picture"||t.status!=="uploading"&&p.listType==="picture-card"?(g(),S("img",{key:0,class:y(s(i).be("list","item-thumbnail")),src:t.url,crossorigin:p.crossorigin,alt:""},null,10,["src","crossorigin"])):h("v-if",!0),t.status==="uploading"||p.listType!=="picture-card"?(g(),S("div",{key:1,class:y(s(i).be("list","item-info"))},[q("a",{class:y(s(i).be("list","item-name")),onClick:B(e=>p.handlePreview(t),["prevent"])},[P(s(O),{class:y(s(u).m("document"))},{default:C(()=>[P(s(Ce))]),_:1},8,["class"]),q("span",{class:y(s(i).be("list","item-file-name")),title:t.name},Q(t.name),11,["title"])],10,["onClick"]),t.status==="uploading"?(g(),T(s(He),{key:0,type:p.listType==="picture-card"?"circle":"line","stroke-width":p.listType==="picture-card"?6:2,percentage:Number(t.percentage),style:Re(p.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):h("v-if",!0)],2)):h("v-if",!0),q("label",{class:y(s(i).be("list","item-status-label"))},[p.listType==="text"?(g(),T(s(O),{key:0,class:y([s(u).m("upload-success"),s(u).m("circle-check")])},{default:C(()=>[P(s(Fe))]),_:1},8,["class"])):["picture-card","picture"].includes(p.listType)?(g(),T(s(O),{key:1,class:y([s(u).m("upload-success"),s(u).m("check")])},{default:C(()=>[P(s(we))]),_:1},8,["class"])):h("v-if",!0)],2),s(k)?h("v-if",!0):(g(),T(s(O),{key:2,class:y(s(u).m("close")),onClick:e=>E(t)},{default:C(()=>[P(s(Pe))]),_:2},1032,["class","onClick"])),h(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),h(" This is a bug which needs to be fixed "),h(" TODO: Fix the incorrect navigation interaction "),s(k)?h("v-if",!0):(g(),S("i",{key:3,class:y(s(u).m("close-tip"))},Q(s(d)("el.upload.deleteTip")),3)),p.listType==="picture-card"?(g(),S("span",{key:4,class:y(s(i).be("list","item-actions"))},[q("span",{class:y(s(i).be("list","item-preview")),onClick:e=>p.handlePreview(t)},[P(s(O),{class:y(s(u).m("zoom-in"))},{default:C(()=>[P(s(Se))]),_:1},8,["class"])],10,["onClick"]),s(k)?h("v-if",!0):(g(),S("span",{key:0,class:y(s(i).be("list","item-delete")),onClick:e=>E(t)},[P(s(O),{class:y(s(u).m("delete"))},{default:C(()=>[P(s(Ue))]),_:1},8,["class"])],10,["onClick"]))],2)):h("v-if",!0)])],42,["onKeydown","onFocus","onBlur","onClick"]))),128)),$(p.$slots,"append")]),_:3},8,["class","name"]))}});var ne=H(Ze,[["__file","upload-list.vue"]]);const Qe=A({disabled:{type:Boolean,default:!1}}),xe={file:o=>ue(o)},ye="ElUploadDrag",et=_({name:ye}),tt=_({...et,props:Qe,emits:xe,setup(o,{emit:r}){Te(fe)||Z(ye,"usage: <el-upload><el-upload-dragger /></el-upload>");const d=N("upload"),i=de(!1),u=K(),f=m=>{if(u.value)return;i.value=!1,m.stopPropagation();const R=Array.from(m.dataTransfer.files),E=m.dataTransfer.items||[];R.forEach((p,U)=>{var t;const n=E[U],e=(t=n==null?void 0:n.webkitGetAsEntry)==null?void 0:t.call(n);e&&(p.isDirectory=e.isDirectory)}),r("file",R)},k=()=>{u.value||(i.value=!0)};return(m,R)=>(g(),S("div",{class:y([s(d).b("dragger"),s(d).is("dragover",i.value)]),onDrop:B(f,["prevent"]),onDragover:B(k,["prevent"]),onDragleave:B(E=>i.value=!1,["prevent"])},[$(m.$slots,"default")],42,["onDrop","onDragover","onDragleave"]))}});var st=H(tt,[["__file","upload-dragger.vue"]]);const at=A({...me,beforeUpload:{type:v(Function),default:b},onRemove:{type:v(Function),default:b},onStart:{type:v(Function),default:b},onSuccess:{type:v(Function),default:b},onProgress:{type:v(Function),default:b},onError:{type:v(Function),default:b},onExceed:{type:v(Function),default:b}}),ot=_({name:"ElUploadContent",inheritAttrs:!1}),nt=_({...ot,props:at,setup(o,{expose:r}){const a=o,d=N("upload"),i=K(),u=J({}),f=J(),k=e=>{if(e.length===0)return;const{autoUpload:c,limit:l,fileList:F,multiple:w,onStart:L,onExceed:M}=a;if(l&&F.length+e.length>l){M(e,F);return}w||(e=e.slice(0,1));for(const z of e){const j=z;j.uid=Y(),L(j),c&&m(j)}},m=async e=>{if(f.value.value="",!a.beforeUpload)return E(e);let c,l={};try{const w=a.data,L=a.beforeUpload(e);l=ee(a.data)?x(a.data):a.data,c=await L,ee(a.data)&&Ke(w,l)&&(l=x(a.data))}catch{c=!1}if(c===!1){a.onRemove(e);return}let F=e;c instanceof Blob&&(c instanceof File?F=c:F=new File([c],e.name,{type:e.type})),E(Object.assign(F,{uid:e.uid}),l)},R=async(e,c)=>De(e)?e(c):e,E=async(e,c)=>{const{headers:l,data:F,method:w,withCredentials:L,name:M,action:z,onProgress:j,onSuccess:ge,onError:he,httpRequest:be}=a;try{c=await R(c??F,e)}catch{a.onRemove(e);return}const{uid:I}=e,V={headers:l||{},withCredentials:L,file:e,data:c,method:w,filename:M,action:z,onProgress:D=>{j(D,e)},onSuccess:D=>{ge(D,e),delete u.value[I]},onError:D=>{he(D,e),delete u.value[I]}},X=be(V);u.value[I]=X,X instanceof Promise&&X.then(V.onSuccess,V.onError)},p=e=>{const c=e.target.files;c&&k(Array.from(c))},U=()=>{i.value||(f.value.value="",f.value.click())},t=()=>{U()};return r({abort:e=>{_e(u.value).filter(e?([l])=>String(e.uid)===l:()=>!0).forEach(([l,F])=>{F instanceof XMLHttpRequest&&F.abort(),delete u.value[l]})},upload:m}),(e,c)=>(g(),S("div",{class:y([s(d).b(),s(d).m(e.listType),s(d).is("drag",e.drag),s(d).is("disabled",s(i))]),tabindex:s(i)?"-1":"0",onClick:U,onKeydown:pe(B(t,["self"]),["enter","space"])},[e.drag?(g(),T(st,{key:0,disabled:s(i),onFile:k},{default:C(()=>[$(e.$slots,"default")]),_:3},8,["disabled"])):$(e.$slots,"default",{key:1}),q("input",{ref_key:"inputRef",ref:f,class:y(s(d).e("input")),name:e.name,disabled:s(i),multiple:e.multiple,accept:e.accept,type:"file",onChange:p,onClick:B(()=>{},["stop"])},null,42,["name","disabled","multiple","accept","onClick"])],42,["tabindex","onKeydown"]))}});var le=H(nt,[["__file","upload-content.vue"]]);const re="ElUpload",ie=o=>{var r;(r=o.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(o.url)},lt=(o,r)=>{const a=Oe(o,"fileList",void 0,{passive:!0}),d=t=>a.value.find(n=>n.uid===t.uid);function i(t){var n;(n=r.value)==null||n.abort(t)}function u(t=["ready","uploading","success","fail"]){a.value=a.value.filter(n=>!t.includes(n.status))}function f(t){a.value=a.value.filter(n=>n.uid!==t.uid)}const k=(t,n)=>{const e=d(n);e&&(console.error(t),e.status="fail",f(e),o.onError(t,e,a.value),o.onChange(e,a.value))},m=(t,n)=>{const e=d(n);e&&(o.onProgress(t,e,a.value),e.status="uploading",e.percentage=Math.round(t.percent))},R=(t,n)=>{const e=d(n);e&&(e.status="success",e.response=t,o.onSuccess(t,e,a.value),o.onChange(e,a.value))},E=t=>{ce(t.uid)&&(t.uid=Y());const n={name:t.name,percentage:0,status:"ready",size:t.size,raw:t,uid:t.uid};if(o.listType==="picture-card"||o.listType==="picture")try{n.url=URL.createObjectURL(t)}catch(e){Be(re,e.message),o.onError(e,n,a.value)}a.value=[...a.value,n],o.onChange(n,a.value)},p=async t=>{const n=t instanceof File?d(t):t;n||Z(re,"file to be removed not found");const e=c=>{i(c),f(c),o.onRemove(c,a.value),ie(c)};o.beforeRemove?await o.beforeRemove(n,a.value)!==!1&&e(n):e(n)};function U(){a.value.filter(({status:t})=>t==="ready").forEach(({raw:t})=>{var n;return t&&((n=r.value)==null?void 0:n.upload(t))})}return te(()=>o.listType,t=>{t!=="picture-card"&&t!=="picture"||(a.value=a.value.map(n=>{const{raw:e,url:c}=n;if(!c&&e)try{n.url=URL.createObjectURL(e)}catch(l){o.onError(l,n,a.value)}return n}))}),te(a,t=>{for(const n of t)n.uid||(n.uid=Y()),n.status||(n.status="success")},{immediate:!0,deep:!0}),{uploadFiles:a,abort:i,clearFiles:u,handleError:k,handleProgress:m,handleStart:E,handleSuccess:R,handleRemove:p,submit:U,revokeFileObjectURL:ie}},rt=_({name:"ElUpload"}),it=_({...rt,props:Ge,setup(o,{expose:r}){const a=o,d=K(),i=J(),{abort:u,submit:f,clearFiles:k,uploadFiles:m,handleStart:R,handleError:E,handleRemove:p,handleSuccess:U,handleProgress:t,revokeFileObjectURL:n}=lt(a,i),e=W(()=>a.listType==="picture-card"),c=W(()=>({...a,fileList:m.value,onStart:R,onProgress:t,onSuccess:U,onError:E,onRemove:p}));return je(()=>{m.value.forEach(n)}),qe(fe,{accept:Ne(a,"accept")}),r({abort:u,submit:f,clearFiles:k,handleStart:R,handleRemove:p}),(l,F)=>(g(),S("div",null,[s(e)&&l.showFileList?(g(),T(ne,{key:0,disabled:s(d),"list-type":l.listType,files:s(m),crossorigin:l.crossorigin,"handle-preview":l.onPreview,onRemove:s(p)},se({append:C(()=>[P(le,ae({ref_key:"uploadRef",ref:i},s(c)),{default:C(()=>[l.$slots.trigger?$(l.$slots,"trigger",{key:0}):h("v-if",!0),!l.$slots.trigger&&l.$slots.default?$(l.$slots,"default",{key:1}):h("v-if",!0)]),_:3},16)]),_:2},[l.$slots.file?{name:"default",fn:C(({file:w,index:L})=>[$(l.$slots,"file",{file:w,index:L})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):h("v-if",!0),!s(e)||s(e)&&!l.showFileList?(g(),T(le,ae({key:1,ref_key:"uploadRef",ref:i},s(c)),{default:C(()=>[l.$slots.trigger?$(l.$slots,"trigger",{key:0}):h("v-if",!0),!l.$slots.trigger&&l.$slots.default?$(l.$slots,"default",{key:1}):h("v-if",!0)]),_:3},16)):h("v-if",!0),l.$slots.trigger?$(l.$slots,"default",{key:2}):h("v-if",!0),$(l.$slots,"tip"),!s(e)&&l.showFileList?(g(),T(ne,{key:3,disabled:s(d),"list-type":l.listType,files:s(m),crossorigin:l.crossorigin,"handle-preview":l.onPreview,onRemove:s(p)},se({_:2},[l.$slots.file?{name:"default",fn:C(({file:w,index:L})=>[$(l.$slots,"file",{file:w,index:L})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):h("v-if",!0)]))}});var ut=H(it,[["__file","upload.vue"]]);const ft=Ae(ut);export{ft as E};
