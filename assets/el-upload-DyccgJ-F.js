import{b6 as Q,av as de,aw as ce,b as N,d as f,aA as k,m as W,_ as A,a as K,aL as ke,u as q,cj as M,I as pe,c as G,g as U,o as y,w as C,t as S,r as R,N as Ee,O as we,bi as fe,y as a,h as v,x as g,v as j,P as D,C as T,aF as O,ck as $e,z as Y,n as Re,cl as Ce,cm as Pe,bd as Fe,cn as Te,co as Se,cp as Le,i as Ue,Z as J,c7 as x,cq as ee,ab as _e,cr as Oe,ay as De,cs as Be,X as te,ct as je,aa as qe,a0 as Ne,A as Ae,ac as Ke,aW as se,ar as ae,k as Me}from"./index-COHXkc47.js";import{E as He}from"./el-progress-Bfp5tbl5.js";const ve=Symbol("uploadContextKey"),ze="ElUpload";class Ie extends Error{constructor(r,o,d,p){super(r),this.name="UploadAjaxError",this.status=o,this.method=d,this.url=p}}function oe(l,r,o){let d;return o.response?d=`${o.response.error||o.response}`:o.responseText?d=`${o.responseText}`:d=`fail to ${r.method} ${l} ${o.status}`,new Ie(d,o.status,r.method,l)}function Xe(l){const r=l.responseText||l.response;if(!r)return r;try{return JSON.parse(r)}catch{return r}}const Ve=l=>{typeof XMLHttpRequest>"u"&&Q(ze,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,o=l.action;r.upload&&r.upload.addEventListener("progress",i=>{const u=i;u.percent=i.total>0?i.loaded/i.total*100:0,l.onProgress(u)});const d=new FormData;if(l.data)for(const[i,u]of Object.entries(l.data))de(u)&&u.length?d.append(i,...u):d.append(i,u);d.append(l.filename,l.file,l.file.name),r.addEventListener("error",()=>{l.onError(oe(o,l,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return l.onError(oe(o,l,r));l.onSuccess(Xe(r))}),r.open(l.method,o,!0),l.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const p=l.headers||{};if(p instanceof Headers)p.forEach((i,u)=>r.setRequestHeader(u,i));else for(const[i,u]of Object.entries(p))ce(u)||r.setRequestHeader(i,String(u));return r.send(d),r},me=["text","picture","picture-card"];let We=1;const Z=()=>Date.now()+We++,ye=N({action:{type:String,default:"#"},headers:{type:f(Object)},method:{type:String,default:"post"},data:{type:f([Object,Function,Promise]),default:()=>W({})},multiple:Boolean,name:{type:String,default:"file"},drag:Boolean,withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:f(Array),default:()=>W([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:me,default:"text"},httpRequest:{type:f(Function),default:Ve},disabled:{type:Boolean,default:void 0},limit:Number}),Ge=N({...ye,beforeUpload:{type:f(Function),default:k},beforeRemove:{type:f(Function)},onRemove:{type:f(Function),default:k},onChange:{type:f(Function),default:k},onPreview:{type:f(Function),default:k},onSuccess:{type:f(Function),default:k},onProgress:{type:f(Function),default:k},onError:{type:f(Function),default:k},onExceed:{type:f(Function),default:k},crossorigin:{type:f(String)}}),Je=N({files:{type:f(Array),default:()=>W([])},disabled:{type:Boolean,default:void 0},handlePreview:{type:f(Function),default:k},listType:{type:String,values:me,default:"text"},crossorigin:{type:f(String)}}),Ze={remove:l=>!!l},Qe=["tabindex","aria-disabled","onKeydown"],Ye=["src","crossorigin"],xe=["onClick"],et=["title"],tt=["onClick"],st=["onClick"],at=K({name:"ElUploadList",__name:"upload-list",props:Je,emits:Ze,setup(l,{emit:r}){const o=l,d=r,{t:p}=ke(),i=q("upload"),u=q("icon"),P=q("list"),m=M(),$=pe(!1),h=G(()=>[i.b("list"),i.bm("list",o.listType),i.is("disabled",m.value)]),b=c=>{d("remove",c)};return(c,E)=>(y(),U(Le,{tag:"ul",class:v(h.value),name:a(P).b()},{default:C(()=>[(y(!0),S(Ee,null,we(c.files,(s,e)=>(y(),S("li",{key:s.uid||s.name,class:v([a(i).be("list","item"),a(i).is(s.status),{focusing:$.value}]),tabindex:a(m)?void 0:0,"aria-disabled":a(m),role:"button",onKeydown:fe(t=>!a(m)&&b(s),["delete"]),onFocus:E[0]||(E[0]=t=>$.value=!0),onBlur:E[1]||(E[1]=t=>$.value=!1),onClick:E[2]||(E[2]=t=>$.value=!1)},[R(c.$slots,"default",{file:s,index:e},()=>[c.listType==="picture"||s.status!=="uploading"&&c.listType==="picture-card"?(y(),S("img",{key:0,class:v(a(i).be("list","item-thumbnail")),src:s.url,crossorigin:c.crossorigin,alt:""},null,10,Ye)):g("v-if",!0),s.status==="uploading"||c.listType!=="picture-card"?(y(),S("div",{key:1,class:v(a(i).be("list","item-info"))},[j("a",{class:v(a(i).be("list","item-name")),onClick:D(t=>c.handlePreview(s),["prevent"])},[T(a(O),{class:v(a(u).m("document"))},{default:C(()=>[T(a($e))]),_:1},8,["class"]),j("span",{class:v(a(i).be("list","item-file-name")),title:s.name},Y(s.name),11,et)],10,xe),s.status==="uploading"?(y(),U(a(He),{key:0,type:c.listType==="picture-card"?"circle":"line","stroke-width":c.listType==="picture-card"?6:2,percentage:Number(s.percentage),style:Re(c.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):g("v-if",!0)],2)):g("v-if",!0),j("label",{class:v(a(i).be("list","item-status-label"))},[c.listType==="text"?(y(),U(a(O),{key:0,class:v([a(u).m("upload-success"),a(u).m("circle-check")])},{default:C(()=>[T(a(Ce))]),_:1},8,["class"])):["picture-card","picture"].includes(c.listType)?(y(),U(a(O),{key:1,class:v([a(u).m("upload-success"),a(u).m("check")])},{default:C(()=>[T(a(Pe))]),_:1},8,["class"])):g("v-if",!0)],2),a(m)?g("v-if",!0):(y(),U(a(O),{key:2,class:v(a(u).m("close")),onClick:t=>b(s)},{default:C(()=>[T(a(Fe))]),_:1},8,["class","onClick"])),g(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),g(" This is a bug which needs to be fixed "),g(" TODO: Fix the incorrect navigation interaction "),a(m)?g("v-if",!0):(y(),S("i",{key:3,class:v(a(u).m("close-tip"))},Y(a(p)("el.upload.deleteTip")),3)),c.listType==="picture-card"?(y(),S("span",{key:4,class:v(a(i).be("list","item-actions"))},[j("span",{class:v(a(i).be("list","item-preview")),onClick:t=>c.handlePreview(s)},[T(a(O),{class:v(a(u).m("zoom-in"))},{default:C(()=>[T(a(Te))]),_:1},8,["class"])],10,tt),a(m)?g("v-if",!0):(y(),S("span",{key:0,class:v(a(i).be("list","item-delete")),onClick:t=>b(s)},[T(a(O),{class:v(a(u).m("delete"))},{default:C(()=>[T(a(Se))]),_:1},8,["class"])],10,st))],2)):g("v-if",!0)])],42,Qe))),128)),R(c.$slots,"append")]),_:3},8,["class","name"]))}});var ne=A(at,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-list.vue"]]);const ot=N({disabled:{type:Boolean,default:void 0}}),nt={file:l=>de(l)},le="ElUploadDrag",lt=K({name:le,__name:"upload-dragger",props:ot,emits:nt,setup(l,{emit:r}){const o=r;Ue(ve)||Q(le,"usage: <el-upload><el-upload-dragger /></el-upload>");const p=q("upload"),i=pe(!1),u=M(),P=h=>{if(u.value)return;i.value=!1,h.stopPropagation();const b=Array.from(h.dataTransfer.files),c=h.dataTransfer.items||[];b.forEach((E,s)=>{var e;const t=c[s],n=(e=t?.webkitGetAsEntry)==null?void 0:e.call(t);n&&(E.isDirectory=n.isDirectory)}),o("file",b)},m=()=>{u.value||(i.value=!0)},$=h=>{h.currentTarget.contains(h.relatedTarget)||(i.value=!1)};return(h,b)=>(y(),S("div",{class:v([a(p).b("dragger"),a(p).is("dragover",i.value)]),onDrop:D(P,["prevent"]),onDragover:D(m,["prevent"]),onDragleave:D($,["prevent"])},[R(h.$slots,"default")],34))}});var rt=A(lt,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-dragger.vue"]]);const it=N({...ye,beforeUpload:{type:f(Function),default:k},onRemove:{type:f(Function),default:k},onStart:{type:f(Function),default:k},onSuccess:{type:f(Function),default:k},onProgress:{type:f(Function),default:k},onError:{type:f(Function),default:k},onExceed:{type:f(Function),default:k}}),ut=["tabindex","aria-disabled","onKeydown"],dt=["name","disabled","multiple","accept"],ct=K({name:"ElUploadContent",inheritAttrs:!1,__name:"upload-content",props:it,setup(l,{expose:r}){const o=l,d=q("upload"),p=M(),i=J({}),u=J(),P=e=>{if(e.length===0)return;const{autoUpload:t,limit:n,fileList:w,multiple:F,onStart:L,onExceed:H}=o;if(n&&w.length+e.length>n){H(e,w);return}F||(e=e.slice(0,1));for(const z of e){const B=z;B.uid=Z(),L(B),t&&m(B)}},m=async e=>{if(u.value.value="",!o.beforeUpload)return h(e);let t,n={};try{const F=o.data,L=o.beforeUpload(e);n=ee(o.data)?x(o.data):o.data,t=await L,ee(o.data)&&_e(F,n)&&(n=x(o.data))}catch{t=!1}if(t===!1){o.onRemove(e);return}let w=e;t instanceof Blob&&(t instanceof File?w=t:w=new File([t],e.name,{type:e.type})),h(Object.assign(w,{uid:e.uid}),n)},$=async(e,t)=>De(e)?e(t):e,h=async(e,t)=>{const{headers:n,data:w,method:F,withCredentials:L,name:H,action:z,onProgress:B,onSuccess:ge,onError:he,httpRequest:be}=o;try{t=await $(t??w,e)}catch{o.onRemove(e);return}const{uid:I}=e,X={headers:n||{},withCredentials:L,file:e,data:t,method:F,filename:H,action:z,onProgress:_=>{B(_,e)},onSuccess:_=>{ge(_,e),delete i.value[I]},onError:_=>{he(_,e),delete i.value[I]}},V=be(X);i.value[I]=V,V instanceof Promise&&V.then(X.onSuccess,X.onError)},b=e=>{const t=e.target.files;t&&P(Array.from(t))},c=()=>{p.value||(u.value.value="",u.value.click())},E=()=>{c()};return r({abort:e=>{Oe(i.value).filter(e?([n])=>String(e.uid)===n:()=>!0).forEach(([n,w])=>{w instanceof XMLHttpRequest&&w.abort(),delete i.value[n]})},upload:m}),(e,t)=>(y(),S("div",{class:v([a(d).b(),a(d).m(e.listType),a(d).is("drag",e.drag),a(d).is("disabled",a(p))]),tabindex:a(p)?void 0:0,"aria-disabled":a(p),role:"button",onClick:c,onKeydown:fe(D(E,["self"]),["enter","space"])},[e.drag?(y(),U(rt,{key:0,disabled:a(p),onFile:P},{default:C(()=>[R(e.$slots,"default")]),_:3},8,["disabled"])):R(e.$slots,"default",{key:1}),j("input",{ref_key:"inputRef",ref:u,class:v(a(d).e("input")),name:e.name,disabled:a(p),multiple:e.multiple,accept:e.accept,type:"file",onChange:b,onClick:t[0]||(t[0]=D(()=>{},["stop"]))},null,42,dt)],42,ut))}});var re=A(ct,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload-content.vue"]]);const ie="ElUpload",ue=l=>{var r;(r=l.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(l.url)},pt=(l,r)=>{const o=Be(l,"fileList",void 0,{passive:!0}),d=s=>o.value.find(e=>e.uid===s.uid);function p(s){var e;(e=r.value)==null||e.abort(s)}function i(s=["ready","uploading","success","fail"]){o.value=o.value.filter(e=>!s.includes(e.status))}function u(s){o.value=o.value.filter(e=>e.uid!==s.uid)}const P=s=>{qe(()=>l.onChange(s,o.value))},m=(s,e)=>{const t=d(e);t&&(console.error(s),t.status="fail",u(t),l.onError(s,t,o.value),P(t))},$=(s,e)=>{const t=d(e);t&&(l.onProgress(s,t,o.value),t.status="uploading",t.percentage=Math.round(s.percent))},h=(s,e)=>{const t=d(e);t&&(t.status="success",t.response=s,l.onSuccess(s,t,o.value),P(t))},b=s=>{ce(s.uid)&&(s.uid=Z());const e={name:s.name,percentage:0,status:"ready",size:s.size,raw:s,uid:s.uid};if(l.listType==="picture-card"||l.listType==="picture")try{e.url=URL.createObjectURL(s)}catch(t){je(ie,t.message),l.onError(t,e,o.value)}o.value=[...o.value,e],P(e)},c=async s=>{const e=s instanceof File?d(s):s;e||Q(ie,"file to be removed not found");const t=n=>{p(n),u(n),l.onRemove(n,o.value),ue(n)};l.beforeRemove?await l.beforeRemove(e,o.value)!==!1&&t(e):t(e)};function E(){o.value.filter(({status:s})=>s==="ready").forEach(({raw:s})=>{var e;return s&&((e=r.value)==null?void 0:e.upload(s))})}return te(()=>l.listType,s=>{s!=="picture-card"&&s!=="picture"||(o.value=o.value.map(e=>{const{raw:t,url:n}=e;if(!n&&t)try{e.url=URL.createObjectURL(t)}catch(w){l.onError(w,e,o.value)}return e}))}),te(o,s=>{for(const e of s)e.uid||(e.uid=Z()),e.status||(e.status="success")},{immediate:!0,deep:!0}),{uploadFiles:o,abort:p,clearFiles:i,handleError:m,handleProgress:$,handleStart:b,handleSuccess:h,handleRemove:c,submit:E,revokeFileObjectURL:ue}},ft=K({name:"ElUpload",__name:"upload",props:Ge,setup(l,{expose:r}){const o=l,d=M(),p=J(),{abort:i,submit:u,clearFiles:P,uploadFiles:m,handleStart:$,handleError:h,handleRemove:b,handleSuccess:c,handleProgress:E,revokeFileObjectURL:s}=pt(o,p),e=G(()=>o.listType==="picture-card"),t=G(()=>({...o,fileList:m.value,onStart:$,onProgress:E,onSuccess:c,onError:h,onRemove:b}));return Ne(()=>{m.value.forEach(s)}),Ae(ve,{accept:Ke(o,"accept")}),r({abort:i,submit:u,clearFiles:P,handleStart:$,handleRemove:b}),(n,w)=>(y(),S("div",null,[e.value&&n.showFileList?(y(),U(ne,{key:0,disabled:a(d),"list-type":n.listType,files:a(m),crossorigin:n.crossorigin,"handle-preview":n.onPreview,onRemove:a(b)},se({append:C(()=>[T(re,ae({ref_key:"uploadRef",ref:p},t.value),{default:C(()=>[n.$slots.trigger?R(n.$slots,"trigger",{key:0}):g("v-if",!0),!n.$slots.trigger&&n.$slots.default?R(n.$slots,"default",{key:1}):g("v-if",!0)]),_:3},16)]),_:2},[n.$slots.file?{name:"default",fn:C(({file:F,index:L})=>[R(n.$slots,"file",{file:F,index:L})]),key:"0"}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):g("v-if",!0),!e.value||e.value&&!n.showFileList?(y(),U(re,ae({key:1,ref_key:"uploadRef",ref:p},t.value),{default:C(()=>[n.$slots.trigger?R(n.$slots,"trigger",{key:0}):g("v-if",!0),!n.$slots.trigger&&n.$slots.default?R(n.$slots,"default",{key:1}):g("v-if",!0)]),_:3},16)):g("v-if",!0),n.$slots.trigger?R(n.$slots,"default",{key:2}):g("v-if",!0),R(n.$slots,"tip"),!e.value&&n.showFileList?(y(),U(ne,{key:3,disabled:a(d),"list-type":n.listType,files:a(m),crossorigin:n.crossorigin,"handle-preview":n.onPreview,onRemove:a(b)},se({_:2},[n.$slots.file?{name:"default",fn:C(({file:F,index:L})=>[R(n.$slots,"file",{file:F,index:L})]),key:"0"}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):g("v-if",!0)]))}});var vt=A(ft,[["__file","/home/runner/work/element-plus/element-plus/packages/components/upload/src/upload.vue"]]);const gt=Me(vt);export{gt as E};
