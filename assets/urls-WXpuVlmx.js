import{h as O,aO as W,j as S,u as X,k as q,o as m,F as k,l as B,w as i,s as J,m as n,aH as Q,H as z,n as D,r as L,_ as Z,t as ee,R as $,a4 as I,T as te,aa as ae,a7 as le,aU as f,aA as p,G as U,K as s,L as y,ah as se,I as M,X as V,W as P,$ as re,N as oe,a0 as ne}from"./index-BBGb7ztx.js";import{v as ie}from"./el-loading-DK9sEaPE.js";import{E as de}from"./el-pagination-Bou5a3jx.js";/* empty css               */import"./el-select-Dow_X64C.js";import"./el-popper-FxBZeNKL.js";import{E as ue,a as pe}from"./el-table-column-Bm3aQaQn.js";import"./el-checkbox-DL9PAFRs.js";import"./el-tooltip-l0sNRNKZ.js";import{E as me}from"./el-popover-BGFwYz2d.js";import{d as T}from"./dayjs.min-Bk--R0Ow.js";import"./Router-u-NDJPc-.js";import"./index-xewF16Ru.js";import"./strings-BQ5A9Gdz.js";import"./castArray-DD9_FAvF.js";import"./_baseIteratee-NjpBBnhP.js";import"./index-D61loPXR.js";import"./index-Bvtjfwmg.js";import"./isUndefined-DCTLXrZ8.js";import"./map-BRvwWGil.js";import"./_baseEach-u96A_dWs.js";import"./raf-WoczJQ5-.js";const ce=O({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:Boolean,href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:W}}),fe={click:h=>h instanceof MouseEvent},ye=S({name:"ElLink"}),ke=S({...ye,props:ce,emits:fe,setup(h,{emit:C}){const r=h,o=X("link"),E=q(()=>[o.b(),o.m(r.type),o.is("disabled",r.disabled),o.is("underline",r.underline&&!r.disabled)]);function v(l){r.disabled||C("click",l)}return(l,g)=>(m(),k("a",{class:D(n(E)),href:l.disabled||!l.href?void 0:l.href,target:l.disabled||!l.href?void 0:l.target,onClick:v},[l.icon?(m(),B(n(Q),{key:0},{default:i(()=>[(m(),B(J(l.icon)))]),_:1})):z("v-if",!0),l.$slots.default?(m(),k("span",{key:1,class:D(n(o).e("inner"))},[L(l.$slots,"default")],2)):z("v-if",!0),l.$slots.icon?L(l.$slots,"icon",{key:2}):z("v-if",!0)],10,["href","target"]))}});var ge=Z(ke,[["__file","link.vue"]]);const ve=ee(ge),we={"h-full":"",flex:"","flex-col":"","gap-4":""},_e={class:"new-url-form"},be="https://url.iszy.xyz",$e=S({__name:"urls",setup(h){const C=$([]),r=$(10),o=$(1),E=$(0),v=$(!1),l=I({}),g=I({}),c=I({keyword:"",url:""});te(()=>{w(o.value-1,r.value)}),ae(()=>{w(o.value-1,r.value)}),le(r,()=>{o.value=1});async function w(a,e){const _=setTimeout(()=>{v.value=!0},300);try{const u=(await f.get(`${f.$apiBase}/urls/admin/urls`,{params:{pageIndex:a,pageSize:e}})).data;u.success?(E.value=u.data.count,C.value=u.data.rows.map(d=>(d.createdAt=T(d.createdAt).format("YYYY年MM月DD日 HH:mm"),d.updatedAt=T(d.updatedAt).format("YYYY年MM月DD日 HH:mm"),d))):p.error(u.message)}catch(u){p.error(u.message)}clearTimeout(_),v.value=!1}async function A(){if(c.url)try{const a=(await f.post(`${f.$apiBase}/urls/admin/url`,{url:c.url,keyword:c.keyword})).data;a.success?(p.success("创建成功"),c.url="",c.keyword="",await w(o.value-1,r.value)):p.error(a.message)}catch(a){p.error(a.message)}}async function H(a){try{const e=(await f.put(`${f.$apiBase}/urls/admin/url/${a.keyword}`,{url:g[a.keyword]})).data;e.success?(p.success("更新成功"),a.url=g[a.keyword],l[a.keyword]=!1,await w(o.value-1,r.value)):p.error(e.message)}catch(e){p.error(e.message)}}async function N(a){try{const e=(await f.delete(`${f.$apiBase}/urls/admin/url/${a.keyword}`,{params:{keyword:a.keyword}})).data;e.success?(await w(o.value-1,r.value),p.success("删除成功")):p.error(e.message)}catch(e){p.error(e.message)}}function Y(a){l[a.keyword]=!l[a.keyword],l[a.keyword]&&(g[a.keyword]=a.url)}function j(a){return(o.value-1)*r.value+a+1}return(a,e)=>{const _=re,u=oe,d=ue,x=ve,F=me,K=pe,R=de,G=ie;return m(),k("div",we,[U("div",_e,[e[5]||(e[5]=U("span",null," 输入链接: ",-1)),s(_,{modelValue:n(c).url,"onUpdate:modelValue":e[0]||(e[0]=t=>n(c).url=t),placeholder:"https",clearable:"","flex-1":""},null,8,["modelValue"]),e[6]||(e[6]=U("span",null," 自定义短网址(选): ",-1)),s(_,{modelValue:n(c).keyword,"onUpdate:modelValue":e[1]||(e[1]=t=>n(c).keyword=t),clearable:""},null,8,["modelValue"]),s(u,{type:"primary",onClick:A},{default:i(()=>e[4]||(e[4]=[y(" 缩短 ")])),_:1})]),se((m(),B(K,{data:n(C),border:!0,stripe:!0,size:"small","flex-1":""},{default:i(()=>[s(d,{type:"index",index:j,fixed:"left"}),s(d,{prop:"keyword",label:"短网址",width:"100",fixed:"left"},{default:i(({row:t})=>[s(x,{href:`${be}/${t.keyword}`,target:"_blank",style:{"white-space":"nowrap"}},{default:i(()=>[y(M(t.keyword),1)]),_:2},1032,["href"])]),_:1}),s(d,{prop:"url",label:"原网址","min-width":"300"},{default:i(({row:t})=>[n(l)[t.keyword]?(m(),B(_,{key:1,modelValue:n(g)[t.keyword],"onUpdate:modelValue":b=>n(g)[t.keyword]=b},null,8,["modelValue","onUpdate:modelValue"])):(m(),k(V,{key:0},[t.title?(m(),k(V,{key:0},[s(x,{href:t.url,target:"_blank"},{default:i(()=>[y(M(t.title),1)]),_:2},1032,["href"]),e[7]||(e[7]=U("br",null,null,-1))],64)):z("",!0),s(x,{href:t.url,target:"_blank"},{default:i(()=>[y(M(t.url),1)]),_:2},1032,["href"])],64))]),_:1}),s(d,{prop:"createdAt",label:"日期",width:"180"}),s(d,{prop:"ip",label:"IP",width:"130"}),s(d,{prop:"clicks",label:"点击次数",width:"80"}),s(d,{label:"操作",width:"140",fixed:"right"},{default:i(({row:t})=>[n(l)[t.keyword]?(m(),k(V,{key:1},[s(u,{size:"small",onClick:b=>Y(t)},{default:i(()=>e[10]||(e[10]=[y(" 取消 ")])),_:2},1032,["onClick"]),s(u,{size:"small",type:"primary",onClick:b=>H(t)},{default:i(()=>e[11]||(e[11]=[y(" 更新 ")])),_:2},1032,["onClick"])],64)):(m(),k(V,{key:0},[s(u,{size:"small",onClick:b=>Y(t)},{default:i(()=>e[8]||(e[8]=[y(" 编辑 ")])),_:2},1032,["onClick"]),s(F,{width:"160",title:"删除后无法恢复！","confirm-button-type":"danger","confirm-button-text":"删除",onConfirm:b=>N(t)},{reference:i(()=>[s(u,{size:"small",type:"danger"},{default:i(()=>e[9]||(e[9]=[y(" 删除 ")])),_:1})]),_:2},1032,["onConfirm"])],64))]),_:1})]),_:1},8,["data"])),[[G,n(v)]]),s(R,{"current-page":n(o),"onUpdate:currentPage":e[2]||(e[2]=t=>P(o)?o.value=t:null),"page-size":n(r),"onUpdate:pageSize":e[3]||(e[3]=t=>P(r)?r.value=t:null),small:"",background:"",layout:"prev, pager, next",total:n(E)},null,8,["current-page","page-size","total"])])}}}),Re=ne($e,[["__scopeId","data-v-8cfcbc85"]]);export{Re as default};
