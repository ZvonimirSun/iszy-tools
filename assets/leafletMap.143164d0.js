import{m as v,c as n}from"./marker-shadow.7a4572f4.js";import{l as t}from"./leaflet-src.dff82e55.js";import{_ as y,$ as F,a9 as L,b5 as M,a as f,o as i,f as x,e as b,J as C,c,w,P as Z,Q as G,O as B,ag as J}from"./vendor.a9a3554e.js";/* empty css               *//* empty css              */import{_ as I}from"./index.83c9750c.js";const{Item:j}=y,_=new t.exports.Icon({iconUrl:"https://cdn.jsdelivr.net/gh/zvonimirsun/leaflet-color-markers@master/img/marker-icon-2x-blue.png",shadowUrl:v,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),z=new t.exports.Icon({iconUrl:"https://cdn.jsdelivr.net/gh/zvonimirsun/leaflet-color-markers@master/img/marker-icon-2x-yellow.png",shadowUrl:v,iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),l="bed806b1ccb34b268ab1c0700123d444";let a;const D={name:"leafletMap",props:{geoJsonLayer:Object},emits:["update:geoJsonLayer"],components:{Form:y,Item:j,Input:F},data:()=>({selectedFeature:void 0}),mounted(){this.$eventBus.on("locationGeo",this.locationGeo),this.$eventBus.on("updateGeojsonLayer",this.updateGeojsonLayer),this.initMap(),this.$nextTick(()=>{this.addBaseMaps(),this.addControls()})},methods:{initMap(){a=L(t.exports.map(this.$refs.mapContainer,{attributionControl:!0,zoomControl:!1})),a.setView([35,105],4),this.$emit("update:geoJsonLayer",t.exports.geoJSON(void 0,{onEachFeature:this.onEachFeature,pointToLayer:(e,o)=>t.exports.marker(o,{icon:_})}).addTo(a))},addBaseMaps(){t.exports.control.layers({\u9AD8\u5FB7\u77E2\u91CF:n("GaoDe.Normal.Map",{minZoom:3,maxNativeZoom:18,maxZoom:20,attribution:'&copy; <a href="https://lbs.amap.com/pages/terms/" target="_blank">\u9AD8\u5FB7\u5730\u56FE</a> \u8D21\u732E\u8005'}).addTo(a),\u9AD8\u5FB7\u5F71\u50CF:t.exports.layerGroup([n("GaoDe.Satellite.Map",{minZoom:3,maxNativeZoom:18,maxZoom:20}),n("GaoDe.Satellite.Annotation",{minZoom:3,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://lbs.amap.com/pages/terms/" target="_blank">\u9AD8\u5FB7\u5730\u56FE</a> \u8D21\u732E\u8005'}),\u5929\u5730\u56FE\u77E2\u91CF:t.exports.layerGroup([n("TianDiTu.Normal.Map",{key:l,minZoom:3,maxNativeZoom:18,maxZoom:20}),n("TianDiTu.Normal.Annotation",{key:l,minZoom:3,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">\u5929\u5730\u56FE</a> \u8D21\u732E\u8005'}),\u5929\u5730\u56FE\u5F71\u50CF:t.exports.layerGroup([n("TianDiTu.Satellite.Map",{key:l,minZoom:3,maxNativeZoom:18,maxZoom:20}),n("TianDiTu.Satellite.Annotation",{key:l,minZoom:3,maxNativeZoom:18,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">\u5929\u5730\u56FE</a> \u8D21\u732E\u8005'}),\u5929\u5730\u56FE\u5730\u5F62:t.exports.layerGroup([n("TianDiTu.Terrain.Map",{key:l,minZoom:3,maxNativeZoom:14,maxZoom:20}),n("TianDiTu.Terrain.Annotation",{key:l,minZoom:3,maxNativeZoom:14,maxZoom:20})],{attribution:'&copy; <a href="https://www.tianditu.gov.cn/" target="_blank">\u5929\u5730\u56FE</a> \u8D21\u732E\u8005'}),OpenStreetMap:n("OSM.Normal.Map",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright" target="_blank">OpenStreetMap</a> \u8D21\u732E\u8005',minZoom:3,maxNativeZoom:19,maxZoom:20})},{\u56FE\u5F62:M(this.geoJsonLayer)},{hideSingleBase:!0,position:"topright"}).addTo(a)},addControls(){t.exports.control.scale({imperial:!1,position:"bottomleft"}).addTo(a),t.exports.control.zoom({zoomInTitle:"\u653E\u5927",zoomOutTitle:"\u7F29\u5C0F",position:"bottomright"}).addTo(a)},onEachFeature(e,o){e.properties&&o.bindPopup(this.$refs.propertyPopup).on("popupopen",()=>{this.selectedFeature=e,o instanceof t.exports.Marker?o.setIcon(z):o.setStyle({color:"#ffff00",weight:5,opacity:.65})}).on("popupclose",()=>{this.selectedFeature=void 0,o instanceof t.exports.Marker?o.setIcon(_):this.geoJsonLayer.resetStyle(o)})},saveToEditor(e,o,r){if(e instanceof InputEvent&&o&&r)try{o.properties[r]=JSON.parse(e.currentTarget.value)}catch(p){o.properties[r]=e.currentTarget.value}this.$eventBus.emit("updateEditor")},locationGeo(e){try{const r=t.exports.geoJSON(e).getBounds(),p=r.getCenter(),u=a.getBoundsZoom(r);a.setView(p,u>16?16:u)}catch(o){}},updateGeojsonLayer(e){if(this.geoJsonLayer&&this.geoJsonLayer instanceof t.exports.GeoJSON){this.geoJsonLayer.clearLayers();try{this.geoJsonLayer.addData(e);const o=this.geoJsonLayer.getBounds(),r=o.getCenter(),p=a.getBoundsZoom(o);a.setView(r,p>16?16:p)}catch(o){console.log(o)}}}},beforeUnmount(){this.$eventBus.off("locationGeo",this.locationGeo),this.$eventBus.off("updateGeojsonLayer",this.updateGeojsonLayer),a&&(a.remove(),a=void 0)}},O={class:"mapContainer",ref:"mapContainer"},$={class:"propertyPopup",ref:"propertyPopup"};function E(e,o,r,p,u,d){var g;const h=f("Input"),T=f("Item"),k=f("Form");return i(),x(Z,null,[b("div",O,null,512),C(b("div",$,[((g=e.selectedFeature)==null?void 0:g.properties)?(i(),c(k,{key:0,"label-col":{span:6},"wrapper-col":{span:18},colon:!1},{default:w(()=>[(i(!0),x(Z,null,G(e.selectedFeature.properties,(S,s,N)=>(i(),c(T,{label:s,key:"prop"+N},{default:w(()=>[typeof e.selectedFeature.properties[s]=="string"?(i(),c(h,{key:0,value:e.selectedFeature.properties[s],"onUpdate:value":m=>e.selectedFeature.properties[s]=m,onChange:d.saveToEditor},null,8,["value","onUpdate:value","onChange"])):typeof e.selectedFeature.properties[s]=="number"?(i(),c(h,{key:1,value:e.selectedFeature.properties[s],"onUpdate:value":m=>e.selectedFeature.properties[s]=m,valueModifiers:{number:!0},onChange:d.saveToEditor},null,8,["value","onUpdate:value","onChange"])):(i(),c(h,{key:2,value:JSON.stringify(S),onChange:m=>d.saveToEditor(m,e.selectedFeature,s)},null,8,["value","onChange"]))]),_:2},1032,["label"]))),128))]),_:1})):B("",!0)],512),[[J,!1]])],64)}var q=I(D,[["render",E],["__scopeId","data-v-ff2135fc"]]);export{q as default};
