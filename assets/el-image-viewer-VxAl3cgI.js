import{c$ as Xe,aU as Ye,e as ye,b as Ce,d as Q,m as Se,_ as Ne,a as Te,bn as Le,dB as Ve,dC as De,aL as $e,u as Oe,cb as Fe,I as p,dD as He,c as d,dE as je,Z as Ke,cd as We,X as ie,J as _e,aH as Y,g as be,o as I,w as m,C as u,a6 as Ze,v as k,n as Ee,h as v,y as s,ci as qe,x as C,t as _,r as T,P as Je,aF as A,bd as Ge,N as ke,bb as Ue,bc as Qe,D as ea,z as Re,dF as aa,cn as sa,j as ta,dG as na,dH as oa,dw as la,aI as ra,aJ as Z,aa as xe,k as Pe,aZ as ia,cL as ua,dI as ca,bI as U,av as da,dJ as fa,ar as ze,aW as va,b0 as we,bq as he,cB as ma,az as pa,dK as ga,dL as wa,dM as ha}from"./index-BrEFJmNm.js";import{E as ya}from"./index-BMcsbbEc.js";var ba="Expected a function";function re(i,V,$){var c=!0,f=!0;if(typeof i!="function")throw new TypeError(ba);return Xe($)&&(c="leading"in $?!!$.leading:c,f="trailing"in $?!!$.trailing:f),Ye(i,V,{leading:c,maxWait:V,trailing:f})}const ka=Ce({urlList:{type:Q(Array),default:()=>Se([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:Q(String)}}),Ia={close:()=>!0,error:i=>i instanceof Event,switch:i=>ye(i),rotate:i=>ye(i)},La=["src","crossorigin"],Ea=Te({name:"ElImageViewer",__name:"image-viewer",props:ka,emits:Ia,setup(i,{expose:V,emit:$}){var c;const f={CONTAIN:{name:"contain",icon:Le(De)},ORIGINAL:{name:"original",icon:Le(Ve)}},r=i,g=$;let q;const{t:ee}=$e(),o=Oe("image-viewer"),{nextZIndex:J}=Fe(),L=p(),O=p(),D=He(),R=d(()=>{const{scale:e,minScale:t,maxScale:l}=r;return je(e,t,l)}),w=p(!0),M=p(!1),x=p(!1),h=p(r.initialIndex),F=Ke(f.CONTAIN),n=p({scale:R.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),ue=p((c=r.zIndex)!=null?c:J());We(x,{ns:o});const ae=d(()=>{const{urlList:e}=r;return e.length<=1}),H=d(()=>h.value===0),se=d(()=>h.value===r.urlList.length-1),j=d(()=>r.urlList[h.value]),ce=d(()=>[o.e("btn"),o.e("prev"),o.is("disabled",!r.infinite&&H.value)]),te=d(()=>[o.e("btn"),o.e("next"),o.is("disabled",!r.infinite&&se.value)]),ne=d(()=>{const{scale:e,deg:t,offsetX:l,offsetY:z,enableTransition:S}=n.value;let b=l/e,N=z/e;const W=t*Math.PI/180,X=Math.cos(W),G=Math.sin(W);b=b*X+N*G,N=N*X-l/e*G;const ge={transform:`scale(${e}) rotate(${t}deg) translate(${b}px, ${N}px)`,transition:S?"transform .3s":""};return F.value.name===f.CONTAIN.name&&(ge.maxWidth=ge.maxHeight="100%"),ge}),oe=d(()=>`${h.value+1} / ${r.urlList.length}`);function B(){fe(),q?.(),x.value=!1,g("close")}function de(){const e=re(l=>{switch(ra(l)){case Z.esc:r.closeOnPressEscape&&B();break;case Z.space:ve();break;case Z.left:me();break;case Z.up:P("zoomIn");break;case Z.right:pe();break;case Z.down:P("zoomOut");break}}),t=re(l=>{const z=l.deltaY||l.deltaX;P(z<0?"zoomIn":"zoomOut",{zoomRate:r.zoomRate,enableTransition:!1})});D.run(()=>{Y(document,"keydown",e),Y(L,"wheel",t)})}function fe(){D.stop()}function a(){w.value=!1}function E(e){M.value=!0,w.value=!1,g("error",e),e.target.alt=ee("el.image.error")}function y(e){if(w.value||e.button!==0||!L.value)return;n.value.enableTransition=!1;const{offsetX:t,offsetY:l}=n.value,z=e.pageX,S=e.pageY,b=re(X=>{n.value={...n.value,offsetX:t+X.pageX-z,offsetY:l+X.pageY-S}}),N=Y(document,"mousemove",b),W=Y(document,"mouseup",()=>{N(),W()});e.preventDefault()}function K(e){if(w.value||!L.value||e.touches.length!==1)return;n.value.enableTransition=!1;const{offsetX:t,offsetY:l}=n.value,{pageX:z,pageY:S}=e.touches[0],b=re(X=>{const G=X.touches[0];n.value={...n.value,offsetX:t+G.pageX-z,offsetY:l+G.pageY-S}}),N=Y(document,"touchmove",b),W=Y(document,"touchend",()=>{N(),W()});e.preventDefault()}function Ie(){n.value={scale:R.value,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function ve(){if(w.value||M.value)return;const e=la(f),t=Object.values(f),l=F.value.name,S=(t.findIndex(b=>b.name===l)+1)%e.length;F.value=f[e[S]],Ie()}function le(e){M.value=!1;const t=r.urlList.length;h.value=(e+t)%t}function me(){H.value&&!r.infinite||le(h.value-1)}function pe(){se.value&&!r.infinite||le(h.value+1)}function P(e,t={}){if(w.value||M.value)return;const{minScale:l,maxScale:z}=r,{zoomRate:S,rotateDeg:b,enableTransition:N}={zoomRate:r.zoomRate,rotateDeg:90,enableTransition:!0,...t};switch(e){case"zoomOut":n.value.scale>l&&(n.value.scale=Number.parseFloat((n.value.scale/S).toFixed(3)));break;case"zoomIn":n.value.scale<z&&(n.value.scale=Number.parseFloat((n.value.scale*S).toFixed(3)));break;case"clockwise":n.value.deg+=b,g("rotate",n.value.deg);break;case"anticlockwise":n.value.deg-=b,g("rotate",n.value.deg);break}n.value.enableTransition=N}function Ae(e){var t;((t=e.detail)==null?void 0:t.focusReason)==="pointer"&&e.preventDefault()}function Me(){r.closeOnPressEscape&&B()}function Be(e){if(e.ctrlKey){if(e.deltaY<0)return e.preventDefault(),!1;if(e.deltaY>0)return e.preventDefault(),!1}}return ie(()=>R.value,e=>{n.value.scale=e}),ie(j,()=>{xe(()=>{const e=O.value;e?.complete||(w.value=!0)})}),ie(h,e=>{Ie(),g("switch",e)}),_e(()=>{x.value=!0,de(),q=Y("wheel",Be,{passive:!1})}),V({setActiveItem:le}),(e,t)=>(I(),be(s(ya),{to:"body",disabled:!e.teleported},{default:m(()=>[u(Ze,{name:"viewer-fade",appear:""},{default:m(()=>[k("div",{ref_key:"wrapper",ref:L,tabindex:-1,class:v(s(o).e("wrapper")),style:Ee({zIndex:ue.value})},[u(s(qe),{loop:"",trapped:"","focus-trap-el":L.value,"focus-start-el":"container",onFocusoutPrevented:Ae,onReleaseRequested:Me},{default:m(()=>[k("div",{class:v(s(o).e("mask")),onClick:t[0]||(t[0]=Je(l=>e.hideOnClickModal&&B(),["self"]))},null,2),C(" CLOSE "),k("span",{class:v([s(o).e("btn"),s(o).e("close")]),onClick:B},[u(s(A),null,{default:m(()=>[u(s(Ge))]),_:1})],2),C(" ARROW "),ae.value?C("v-if",!0):(I(),_(ke,{key:0},[k("span",{class:v(ce.value),onClick:me},[u(s(A),null,{default:m(()=>[u(s(Ue))]),_:1})],2),k("span",{class:v(te.value),onClick:pe},[u(s(A),null,{default:m(()=>[u(s(Qe))]),_:1})],2)],64)),e.$slots.progress||e.showProgress?(I(),_("div",{key:1,class:v([s(o).e("btn"),s(o).e("progress")])},[T(e.$slots,"progress",{activeIndex:h.value,total:e.urlList.length},()=>[ea(Re(oe.value),1)])],2)):C("v-if",!0),C(" ACTIONS "),k("div",{class:v([s(o).e("btn"),s(o).e("actions")])},[k("div",{class:v(s(o).e("actions__inner"))},[T(e.$slots,"toolbar",{actions:P,prev:me,next:pe,reset:ve,activeIndex:h.value,setActiveItem:le},()=>[u(s(A),{onClick:t[1]||(t[1]=l=>P("zoomOut"))},{default:m(()=>[u(s(aa))]),_:1}),u(s(A),{onClick:t[2]||(t[2]=l=>P("zoomIn"))},{default:m(()=>[u(s(sa))]),_:1}),k("i",{class:v(s(o).e("actions__divider"))},null,2),u(s(A),{onClick:ve},{default:m(()=>[(I(),be(ta(F.value.icon)))]),_:1}),k("i",{class:v(s(o).e("actions__divider"))},null,2),u(s(A),{onClick:t[3]||(t[3]=l=>P("anticlockwise"))},{default:m(()=>[u(s(na))]),_:1}),u(s(A),{onClick:t[4]||(t[4]=l=>P("clockwise"))},{default:m(()=>[u(s(oa))]),_:1})])],2)],2),C(" CANVAS "),k("div",{class:v(s(o).e("canvas"))},[M.value&&e.$slots["viewer-error"]?T(e.$slots,"viewer-error",{key:0,activeIndex:h.value,src:j.value}):(I(),_("img",{ref_key:"imgRef",ref:O,key:j.value,src:j.value,style:Ee(ne.value),class:v(s(o).e("img")),crossorigin:e.crossorigin,onLoad:a,onError:E,onMousedown:y,onTouchstart:K},null,46,La))],2),T(e.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var za=Ne(Ea,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image-viewer/src/image-viewer.vue"]]);const Ca=Pe(za),Sa=Ce({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:Q([String,Object])},previewSrcList:{type:Q(Array),default:()=>Se([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},scale:{type:Number,default:1},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:Q(String)}}),Na={load:i=>i instanceof Event,error:i=>i instanceof Event,switch:i=>ye(i),close:()=>!0,show:()=>!0},Ta=["src","loading","crossorigin"],$a={key:0},Oa=Te({name:"ElImage",inheritAttrs:!1,__name:"image",props:Sa,emits:Na,setup(i,{expose:V,emit:$}){const c=i,f=$,{t:r}=$e(),g=Oe("image"),q=ia(),ee=d(()=>ua(Object.entries(q).filter(([a])=>/^(data-|on[A-Z])/i.test(a)||["id","style"].includes(a)))),o=ca({excludeListeners:!0,excludeKeys:d(()=>Object.keys(ee.value))}),J=p(),L=p(!1),O=p(!0),D=p(!1),R=p(),w=p(),M=U&&"loading"in HTMLImageElement.prototype;let x;const h=d(()=>[g.e("inner"),n.value&&g.e("preview"),O.value&&g.is("loading")]),F=d(()=>{const{fit:a}=c;return U&&a?{objectFit:a}:{}}),n=d(()=>{const{previewSrcList:a}=c;return da(a)&&a.length>0}),ue=d(()=>{const{previewSrcList:a,initialIndex:E}=c;let y=E;return E>a.length-1&&(y=0),y}),ae=d(()=>c.loading==="eager"?!1:!M&&c.loading==="lazy"||c.lazy),H=()=>{U&&(O.value=!0,L.value=!1,J.value=c.src)};function se(a){O.value=!1,L.value=!1,f("load",a)}function j(a){O.value=!1,L.value=!0,f("error",a)}function ce(a){a&&(H(),oe())}const te=fa(ce,200,!0);async function ne(){var a;if(!U)return;await xe();const{scrollContainer:E}=c;if(ma(E))w.value=E;else if(pa(E)&&E!=="")w.value=(a=document.querySelector(E))!=null?a:void 0;else if(R.value){const K=ga(R.value);w.value=wa(K)?void 0:K}const{stop:y}=ha(R,([K])=>{te(K.isIntersecting)},{root:w});x=y}function oe(){!U||!te||(x?.(),w.value=void 0,x=void 0)}function B(){n.value&&(D.value=!0,f("show"))}function de(){D.value=!1,f("close")}function fe(a){f("switch",a)}return ie(()=>c.src,()=>{ae.value?(O.value=!0,L.value=!1,oe(),ne()):H()}),_e(()=>{ae.value?ne():H()}),V({showPreview:B}),(a,E)=>(I(),_("div",ze({ref_key:"container",ref:R},ee.value,{class:[s(g).b(),a.$attrs.class]}),[L.value?T(a.$slots,"error",{key:0},()=>[k("div",{class:v(s(g).e("error"))},Re(s(r)("el.image.error")),3)]):(I(),_(ke,{key:1},[J.value!==void 0?(I(),_("img",ze({key:0},s(o),{src:J.value,loading:a.loading,style:F.value,class:h.value,crossorigin:a.crossorigin,onClick:B,onLoad:se,onError:j}),null,16,Ta)):C("v-if",!0),O.value?(I(),_("div",{key:1,class:v(s(g).e("wrapper"))},[T(a.$slots,"placeholder",{},()=>[k("div",{class:v(s(g).e("placeholder"))},null,2)])],2)):C("v-if",!0)],64)),n.value?(I(),_(ke,{key:2},[D.value?(I(),be(s(Ca),{key:0,"z-index":a.zIndex,"initial-index":ue.value,infinite:a.infinite,"zoom-rate":a.zoomRate,"min-scale":a.minScale,"max-scale":a.maxScale,"show-progress":a.showProgress,"url-list":a.previewSrcList,scale:a.scale,crossorigin:a.crossorigin,"hide-on-click-modal":a.hideOnClickModal,teleported:a.previewTeleported,"close-on-press-escape":a.closeOnPressEscape,onClose:de,onSwitch:fe},va({toolbar:m(y=>[T(a.$slots,"toolbar",we(he(y)))]),default:m(()=>[a.$slots.viewer?(I(),_("div",$a,[T(a.$slots,"viewer")])):C("v-if",!0)]),_:2},[a.$slots.progress?{name:"progress",fn:m(y=>[T(a.$slots,"progress",we(he(y)))]),key:"0"}:void 0,a.$slots["viewer-error"]?{name:"viewer-error",fn:m(y=>[T(a.$slots,"viewer-error",we(he(y)))]),key:"1"}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","scale","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):C("v-if",!0)],64)):C("v-if",!0)],16))}});var _a=Ne(Oa,[["__file","/home/runner/work/element-plus/element-plus/packages/components/image/src/image.vue"]]);const Pa=Pe(_a);export{Pa as E};
