import{i as B,T as L,n as V,r as T,a as o,b as I,q as F,P as D}from"./default-5df60f68.js";import{h as Q,a3 as q,ao as G,at as C,aQ as x,bp as b,a as r,F as J,G as P,b8 as d,S as Y,db as R}from"./index-2d447dfc.js";import{d as c}from"./dayjs.min-2cbf9cf8.js";import{c as W}from"./clamp-e5c63767.js";var K=["class","style"],O=function(){return{prefixCls:String,spinning:{type:Boolean,default:void 0},size:String,wrapperClassName:String,tip:D.any,delay:Number,indicator:D.any}},f=null;function X(t,n){return!!t&&!!n&&!isNaN(Number(n))}function st(t){var n=t.indicator;f=typeof n=="function"?n:function(){return r(n,null,null)}}const rt=Q({compatConfig:{MODE:3},name:"ASpin",inheritAttrs:!1,props:B(O(),{size:"default",spinning:!0,wrapperClassName:""}),setup:function(){return{originalUpdateSpinning:null,configProvider:q("configProvider",L)}},data:function(){var n=this.spinning,e=this.delay,i=X(n,e);return{sSpinning:n&&!i}},created:function(){this.originalUpdateSpinning=this.updateSpinning,this.debouncifyUpdateSpinning(this.$props)},mounted:function(){this.updateSpinning()},updated:function(){var n=this;G(function(){n.debouncifyUpdateSpinning(),n.updateSpinning()})},beforeUnmount:function(){this.cancelExistingSpin()},methods:{debouncifyUpdateSpinning:function(n){var e=n||this.$props,i=e.delay;i&&(this.cancelExistingSpin(),this.updateSpinning=C(this.originalUpdateSpinning,i))},updateSpinning:function(){var n=this.spinning,e=this.sSpinning;e!==n&&(this.sSpinning=n)},cancelExistingSpin:function(){var n=this.updateSpinning;n&&n.cancel&&n.cancel()},renderIndicator:function(n){var e="".concat(n,"-dot"),i=V(this,"indicator");return i===null?null:(Array.isArray(i)&&(i=i.length===1?i[0]:i),x(i)?b(i,{class:e}):f&&x(f())?b(f(),{class:e}):r("span",{class:"".concat(e," ").concat(n,"-dot-spin")},[r("i",{class:"".concat(n,"-dot-item")},null),r("i",{class:"".concat(n,"-dot-item")},null),r("i",{class:"".concat(n,"-dot-item")},null),r("i",{class:"".concat(n,"-dot-item")},null)]))}},render:function(){var n,e,i,a=this.$props,l=a.size,E=a.prefixCls,S=a.tip,h=S===void 0?(n=(e=this.$slots).tip)===null||n===void 0?void 0:n.call(e):S,M=a.wrapperClassName,g=this.$attrs,y=g.class,N=g.style,U=T(g,K),_=this.configProvider,k=_.getPrefixCls,H=_.direction,s=k("spin",E),m=this.sSpinning,A=(i={},o(i,s,!0),o(i,"".concat(s,"-sm"),l==="small"),o(i,"".concat(s,"-lg"),l==="large"),o(i,"".concat(s,"-spinning"),m),o(i,"".concat(s,"-show-text"),!!h),o(i,"".concat(s,"-rtl"),H==="rtl"),o(i,y,!!y),i),v=r("div",I(I({},U),{},{style:N,class:A}),[this.renderIndicator(s),h?r("div",{class:"".concat(s,"-text")},[h]):null]),$=F(this);if($&&$.length){var u,z=(u={},o(u,"".concat(s,"-container"),!0),o(u,"".concat(s,"-blur"),m),u);return r("div",{class:["".concat(s,"-nested-loading"),M]},[m&&r("div",{key:"loading"},[v]),r("div",{class:z,key:"container"},[$])])}return v}});function j(t,n){t=t||32,n=n||"ABCDEFGHJKMNPQRSTWXYZabcdefghijkmnprstwxyz2345678";const e=n.length;let i="";for(let a=0;a<t;a++)i+=n.charAt(Math.floor(Math.random()*e));return i}const Z=new R;let p={},w=!1;const tt=J("jsonEditor",{persist:!0,state:()=>({leftId:null,rightId:null,splitterValue:.5,fullStatus:"",$_data:{}}),getters:{dataList:t=>n=>{const e=[];for(const i in t.$_data)e.push({_id:i,name:t.$_data[i].name,updated:c(t.$_data[i].updated).format("YYYY-MM-DD HH:mm")});return n?e.filter(i=>i.name.includes(n)):e},data:t=>n=>t.$_data[n]?{...t.$_data[n],updated:c(t.$_data[n].updated).format("YYYY-MM-DD HH:mm")}:null,leftData:t=>t.leftId&&t.$_data[t.leftId]?{...t.$_data[t.leftId],updated:c(t.$_data[t.leftId].updated).format("YYYY-MM-DD HH:mm")}:null,rightData:t=>t.rightId&&t.$_data[t.rightId]?{...t.$_data[t.rightId],updated:c(t.$_data[t.rightId].updated).format("YYYY-MM-DD HH:mm")}:null,syncCloud:()=>P().isLogged&&P().modules.jsonEditor.syncCloud},actions:{setSplitter(t=.5){this.splitterValue=W(t,0,1)},setFullStatus(t){t==="left"||t==="right"?this.fullStatus=t:this.fullStatus=""},replaceState(t=[]){const n={};for(const e of t)n[e.key]={name:e.name,content:{}},e.text!=null?n[e.key].content.text=e.text:e.json!=null&&(n[e.key].content.json=e.json),n[e.key].updated=c(e.updatedAt).format();this.$_data=n},async getSyncData(){try{const t=(await d.get(`${d.$apiBase}/tools/jsoneditor`)).data;t.success?this.replaceState(t.data):console.log(t.message)}catch(t){console.log(t.message)}},syncData:C(({id:t,data:n}={})=>{if(navigator.onLine)Z.enqueue(d.post(`${d.$apiBase}/tools/jsoneditor/${t}`,n));else if(p[t]=n,!w){let e=function(){window.removeEventListener("online",e);for(const i in p)tt().syncData({id:i,data:p[i]});p={}};w=!0,window.addEventListener("online",e)}},500),saveData({left:t,right:n,id:e,content:i,name:a}={}){if(this.syncCloud&&(e=e||j(6),i!=null||a!=null)){const l={name:a||(this.$_data[e]||{}).name||`文档-${e}`};typeof i=="string"?l.text=i:typeof i=="object"&&(l.json=Y(i)),this.syncData({id:e,data:l})}typeof i<"u"?(e=e||j(6),this.$_data[e]=this.$_data[e]||{},this.$_data[e].name=a||this.$_data[e].name||`文档-${e}`,typeof i=="string"?this.$_data[e].content={text:i}:this.$_data[e].content={json:Y(i)},this.$_data[e].updated=c().format(),t&&(this.leftId=e),n&&(this.rightId=e)):e&&this.$_data[e]?(t&&(this.leftId=e),n&&(this.rightId=e),this.$_data[e].name=a||this.$_data[e].name):(t&&(this.leftId=null),n&&(this.rightId=null))},async deleteData({id:t}={}){if(this.syncCloud)try{const n=(await d.delete(`${d.$apiBase}/tools/jsoneditor/${t}`)).data;n.success?(this.leftId===t&&(this.leftId=null),this.rightId===t&&(this.rightId=null),this.$_data[t]&&delete this.$_data[t]):console.log(n.message)}catch(n){console.log(n)}else this.leftId===t&&(this.leftId=null),this.rightId===t&&(this.rightId=null),this.$_data[t]&&delete this.$_data[t]}}});export{rt as S,st as s,tt as u};
