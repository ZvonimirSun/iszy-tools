import{c$ as Pe,b0 as Ae,o as ve,h as ze,j as G,m as Ce,_ as Ee,k as ae,bE as ye,dx as Be,dy as Me,aU as Le,u as _e,ck as Ve,R as C,dz as Fe,a9 as Ye,n as v,a7 as me,T as Se,aR as q,q as pe,r as p,w as m,K as i,ah as De,F as I,t as he,v as f,x as e,cr as Xe,G as z,E,s as x,$ as He,aP as R,bs as je,Y as Z,bq as Ke,br as qe,N as We,H as Ne,dA as Ge,cw as Ze,y as Ue,dB as Je,dC as Qe,Z as ea,ds as aa,aS as F,al as Oe,z as $e,b5 as sa,cU as ta,dD as na,bY as W,aF as oa,aB as be,b2 as la,b8 as ke,bG as Ie,cK as ra,aJ as ia,dE as ca,dF as ua,dG as da,dH as fa}from"./index-1Gxk3gC0.js";import{E as va}from"./index-CkJlwJox.js";var ma="Expected a function";function fe(c,M,u){var d=!0,n=!0;if(typeof c!="function")throw new TypeError(ma);return Pe(u)&&(d="leading"in u?!!u.leading:d,n="trailing"in u?!!u.trailing:n),Ae(c,M,{leading:d,maxWait:M,trailing:n})}const pa=ze({urlList:{type:G(Array),default:()=>Ce([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:G(String)}}),ga={close:()=>!0,switch:c=>ve(c),rotate:c=>ve(c)},wa=ae({name:"ElImageViewer"}),ya=ae({...wa,props:pa,emits:ga,setup(c,{expose:M,emit:u}){var d;const n=c,g={CONTAIN:{name:"contain",icon:ye(Me)},ORIGINAL:{name:"original",icon:ye(Be)}};let Y,D="";const{t:se}=Le(),t=_e("image-viewer"),{nextZIndex:P}=Ve(),L=C(),V=C([]),A=Fe(),y=C(!0),w=C(n.initialIndex),N=Ye(g.CONTAIN),l=C({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),te=C((d=n.zIndex)!=null?d:P()),X=v(()=>{const{urlList:a}=n;return a.length<=1}),U=v(()=>w.value===0),H=v(()=>w.value===n.urlList.length-1),j=v(()=>n.urlList[w.value]),ne=v(()=>[t.e("btn"),t.e("prev"),t.is("disabled",!n.infinite&&U.value)]),oe=v(()=>[t.e("btn"),t.e("next"),t.is("disabled",!n.infinite&&H.value)]),le=v(()=>{const{scale:a,deg:r,offsetX:o,offsetY:k,enableTransition:_}=l.value;let S=o/a,T=k/a;const K=r*Math.PI/180,ge=Math.cos(K),we=Math.sin(K);S=S*ge+T*we,T=T*ge-o/a*we;const de={transform:`scale(${a}) rotate(${r}deg) translate(${S}px, ${T}px)`,transition:_?"transform .3s":""};return N.value.name===g.CONTAIN.name&&(de.maxWidth=de.maxHeight="100%"),de}),J=v(()=>`${w.value+1} / ${n.urlList.length}`);function B(){ee(),Y?.(),document.body.style.overflow=D,u("close")}function Q(){const a=fe(o=>{switch(o.code){case F.esc:n.closeOnPressEscape&&B();break;case F.space:b();break;case F.left:ce();break;case F.up:$("zoomIn");break;case F.right:ue();break;case F.down:$("zoomOut");break}}),r=fe(o=>{const k=o.deltaY||o.deltaX;$(k<0?"zoomIn":"zoomOut",{zoomRate:n.zoomRate,enableTransition:!1})});A.run(()=>{q(document,"keydown",a),q(document,"wheel",r)})}function ee(){A.stop()}function re(){y.value=!1}function ie(a){y.value=!1,a.target.alt=se("el.image.error")}function s(a){if(y.value||a.button!==0||!L.value)return;l.value.enableTransition=!1;const{offsetX:r,offsetY:o}=l.value,k=a.pageX,_=a.pageY,S=fe(K=>{l.value={...l.value,offsetX:r+K.pageX-k,offsetY:o+K.pageY-_}}),T=q(document,"mousemove",S);q(document,"mouseup",()=>{T()}),a.preventDefault()}function h(){l.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function b(){if(y.value)return;const a=aa(g),r=Object.values(g),o=N.value.name,_=(r.findIndex(S=>S.name===o)+1)%a.length;N.value=g[a[_]],h()}function O(a){const r=n.urlList.length;w.value=(a+r)%r}function ce(){U.value&&!n.infinite||O(w.value-1)}function ue(){H.value&&!n.infinite||O(w.value+1)}function $(a,r={}){if(y.value)return;const{minScale:o,maxScale:k}=n,{zoomRate:_,rotateDeg:S,enableTransition:T}={zoomRate:n.zoomRate,rotateDeg:90,enableTransition:!0,...r};switch(a){case"zoomOut":l.value.scale>o&&(l.value.scale=Number.parseFloat((l.value.scale/_).toFixed(3)));break;case"zoomIn":l.value.scale<k&&(l.value.scale=Number.parseFloat((l.value.scale*_).toFixed(3)));break;case"clockwise":l.value.deg+=S,u("rotate",l.value.deg);break;case"anticlockwise":l.value.deg-=S,u("rotate",l.value.deg);break}l.value.enableTransition=T}function Te(a){var r;((r=a.detail)==null?void 0:r.focusReason)==="pointer"&&a.preventDefault()}function Re(){n.closeOnPressEscape&&B()}function xe(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}return me(j,()=>{Oe(()=>{const a=V.value[0];a?.complete||(y.value=!0)})}),me(w,a=>{h(),u("switch",a)}),Se(()=>{Q(),Y=q("wheel",xe,{passive:!1}),D=document.body.style.overflow,document.body.style.overflow="hidden"}),M({setActiveItem:O}),(a,r)=>(p(),pe(e(va),{to:"body",disabled:!a.teleported},{default:m(()=>[i(De,{name:"viewer-fade",appear:""},{default:m(()=>[I("div",{ref_key:"wrapper",ref:L,tabindex:-1,class:f(e(t).e("wrapper")),style:he({zIndex:te.value})},[i(e(Xe),{loop:"",trapped:"","focus-trap-el":L.value,"focus-start-el":"container",onFocusoutPrevented:Te,onReleaseRequested:Re},{default:m(()=>[I("div",{class:f(e(t).e("mask")),onClick:He(o=>a.hideOnClickModal&&B(),["self"])},null,10,["onClick"]),z(" CLOSE "),I("span",{class:f([e(t).e("btn"),e(t).e("close")]),onClick:B},[i(e(R),null,{default:m(()=>[i(e(je))]),_:1})],2),z(" ARROW "),e(X)?z("v-if",!0):(p(),E(Z,{key:0},[I("span",{class:f(e(ne)),onClick:ce},[i(e(R),null,{default:m(()=>[i(e(Ke))]),_:1})],2),I("span",{class:f(e(oe)),onClick:ue},[i(e(R),null,{default:m(()=>[i(e(qe))]),_:1})],2)],64)),a.$slots.progress||a.showProgress?(p(),E("div",{key:1,class:f([e(t).e("btn"),e(t).e("progress")])},[x(a.$slots,"progress",{activeIndex:w.value,total:a.urlList.length},()=>[We(Ne(e(J)),1)])],2)):z("v-if",!0),z(" ACTIONS "),I("div",{class:f([e(t).e("btn"),e(t).e("actions")])},[I("div",{class:f(e(t).e("actions__inner"))},[x(a.$slots,"toolbar",{actions:$,prev:ce,next:ue,reset:b,activeIndex:w.value,setActiveItem:O},()=>[i(e(R),{onClick:o=>$("zoomOut")},{default:m(()=>[i(e(Ge))]),_:1},8,["onClick"]),i(e(R),{onClick:o=>$("zoomIn")},{default:m(()=>[i(e(Ze))]),_:1},8,["onClick"]),I("i",{class:f(e(t).e("actions__divider"))},null,2),i(e(R),{onClick:b},{default:m(()=>[(p(),pe(Ue(e(N).icon)))]),_:1}),I("i",{class:f(e(t).e("actions__divider"))},null,2),i(e(R),{onClick:o=>$("anticlockwise")},{default:m(()=>[i(e(Je))]),_:1},8,["onClick"]),i(e(R),{onClick:o=>$("clockwise")},{default:m(()=>[i(e(Qe))]),_:1},8,["onClick"])])],2)],2),z(" CANVAS "),I("div",{class:f(e(t).e("canvas"))},[(p(!0),E(Z,null,ea(a.urlList,(o,k)=>(p(),E(Z,{key:k},[k===w.value?(p(),E("img",{key:0,ref_for:!0,ref:_=>V.value[k]=_,src:o,style:he(e(le)),class:f(e(t).e("img")),crossorigin:a.crossorigin,onLoad:re,onError:ie,onMousedown:s},null,46,["src","crossorigin"])):z("v-if",!0)],64))),128))],2),x(a.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ha=Ee(ya,[["__file","image-viewer.vue"]]);const ba=$e(ha),ka=ze({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:G([String,Object])},previewSrcList:{type:G(Array),default:()=>Ce([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:Boolean,crossorigin:{type:G(String)}}),Ia={load:c=>c instanceof Event,error:c=>c instanceof Event,switch:c=>ve(c),close:()=>!0,show:()=>!0},za=ae({name:"ElImage",inheritAttrs:!1}),Ca=ae({...za,props:ka,emits:Ia,setup(c,{expose:M,emit:u}){const d=c,{t:n}=Le(),g=_e("image"),Y=sa(),D=v(()=>ta(Object.entries(Y).filter(([s])=>/^(data-|on[A-Z])/i.test(s)||["id","style"].includes(s)))),se=na({excludeListeners:!0,excludeKeys:v(()=>Object.keys(D.value))}),t=C(),P=C(!1),L=C(!0),V=C(!1),A=C(),y=C(),w=W&&"loading"in HTMLImageElement.prototype;let N;const l=v(()=>[g.e("inner"),X.value&&g.e("preview"),L.value&&g.is("loading")]),te=v(()=>{const{fit:s}=d;return W&&s?{objectFit:s}:{}}),X=v(()=>{const{previewSrcList:s}=d;return oa(s)&&s.length>0}),U=v(()=>{const{previewSrcList:s,initialIndex:h}=d;let b=h;return h>s.length-1&&(b=0),b}),H=v(()=>d.loading==="eager"?!1:!w&&d.loading==="lazy"||d.lazy),j=()=>{W&&(L.value=!0,P.value=!1,t.value=d.src)};function ne(s){L.value=!1,P.value=!1,u("load",s)}function oe(s){L.value=!1,P.value=!0,u("error",s)}function le(s){s&&(j(),Q())}const J=fa(le,200,!0);async function B(){var s;if(!W)return;await Oe();const{scrollContainer:h}=d;if(ra(h))y.value=h;else if(ia(h)&&h!=="")y.value=(s=document.querySelector(h))!=null?s:void 0;else if(A.value){const O=ca(A.value);y.value=ua(O)?void 0:O}const{stop:b}=da(A,([O])=>{J(O.isIntersecting)},{root:y});N=b}function Q(){!W||!J||(N?.(),y.value=void 0,N=void 0)}function ee(){X.value&&(V.value=!0,u("show"))}function re(){V.value=!1,u("close")}function ie(s){u("switch",s)}return me(()=>d.src,()=>{H.value?(L.value=!0,P.value=!1,Q(),B()):j()}),Se(()=>{H.value?B():j()}),M({showPreview:ee}),(s,h)=>(p(),E("div",be({ref_key:"container",ref:A},e(D),{class:[e(g).b(),s.$attrs.class]}),[P.value?x(s.$slots,"error",{key:0},()=>[I("div",{class:f(e(g).e("error"))},Ne(e(n)("el.image.error")),3)]):(p(),E(Z,{key:1},[t.value!==void 0?(p(),E("img",be({key:0},e(se),{src:t.value,loading:s.loading,style:e(te),class:e(l),crossorigin:s.crossorigin,onClick:ee,onLoad:ne,onError:oe}),null,16,["src","loading","crossorigin"])):z("v-if",!0),L.value?(p(),E("div",{key:1,class:f(e(g).e("wrapper"))},[x(s.$slots,"placeholder",{},()=>[I("div",{class:f(e(g).e("placeholder"))},null,2)])],2)):z("v-if",!0)],64)),e(X)?(p(),E(Z,{key:2},[V.value?(p(),pe(e(ba),{key:0,"z-index":s.zIndex,"initial-index":e(U),infinite:s.infinite,"zoom-rate":s.zoomRate,"min-scale":s.minScale,"max-scale":s.maxScale,"show-progress":s.showProgress,"url-list":s.previewSrcList,crossorigin:s.crossorigin,"hide-on-click-modal":s.hideOnClickModal,teleported:s.previewTeleported,"close-on-press-escape":s.closeOnPressEscape,onClose:re,onSwitch:ie},la({toolbar:m(b=>[x(s.$slots,"toolbar",ke(Ie(b)))]),default:m(()=>[s.$slots.viewer?(p(),E("div",{key:0},[x(s.$slots,"viewer")])):z("v-if",!0)]),_:2},[s.$slots.progress?{name:"progress",fn:m(b=>[x(s.$slots,"progress",ke(Ie(b)))])}:void 0]),1032,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):z("v-if",!0)],64)):z("v-if",!0)],16))}});var Ea=Ee(Ca,[["__file","image.vue"]]);const Sa=$e(Ea);export{Sa as E};
