import{a as D,U as F,I as b,B as K,aj as O,am as Q,X as S,J as G,a0 as M,an as N,aq as c,t as m,v as g,C as n,w as l,L as R,bi as x,y as u,E as T,D as C,ar as X,o as _,N as j,O as H,h as J,Q as A}from"./index-BrEFJmNm.js";import{E as W}from"./el-space-KxvBc_si.js";import{E as Y}from"./el-divider-T-NSYMXG.js";import{E as Z,a as ee}from"./el-form-item-BDeP41V9.js";import{L as te}from"./linuxdo-C7o2R0pC.js";import"./castArray-BcYYRqOe.js";import"./clone-CelRWtFt.js";const oe={class:"login-container"},re={class:"main"},ae=["title","onClick"],ne=["src"],se=D({__name:"login",setup(le){const s=F({userName:"",password:""}),v=b(),y=b({}),o=b(!1),w=K(),V=O(),h=Q();let r=null;const B=[{type:"github",title:"Github",icon:"i-icon-park-outline:github"},{type:"linuxdo",title:"LINUX DO",img:te}];S(V,t=>{const e=t.query;e&&(typeof e.redirect=="string"&&(v.value=e.redirect),y.value=q(e))},{immediate:!0}),G(()=>{h.logged&&w.push({path:v.value||"/",query:y.value})}),M(()=>{r!=null&&(clearInterval(r),r=null),window.removeEventListener("message",E)});async function k(){if(!o.value){if(!navigator.onLine){c.warning("已离线！");return}if(s.userName!=null&&s.password!=null){o.value=!0;try{await h.login({userName:s.userName,password:s.password}),I()}catch(t){t instanceof Error&&c.error(t.message)}o.value=!1}}}function U(){w.push("/register")}function $(t){const e=`${N.apiBaseUrl}/auth/${t}`;z(e,"GitHub登录")}function I(){c.success("登录成功！"),w.push({path:v.value||"/",query:y.value})}function q(t){const{redirect:e,...i}=t;return i}async function E(t){const e=t.source;if(t.origin!==N.apiBaseUrl){console.log(`origin ${t.origin} is not valid`);return}t.data?.type!=="oauth_complete"&&t.data?.type!=="oauth_fail"||(window.removeEventListener("message",E),r!=null&&(clearInterval(r),r=null),e.close(),t.data.type==="oauth_complete"?(await h.thirdPartyLogin(t.data.data),I()):c.error("登录失败！"),o.value=!1)}function z(t,e="第三方登录",i=500,d=600){if(o.value){c.warning("登录进行中，请勿重复点击");return}o.value=!0,window.addEventListener("message",E);const p=(window.screen.height-i)/2,L=(window.screen.width-d)/2,f=window.open(t,e,`popup,width=${i},height=${d},top=${p},left=${L}`);if(!f){o.value=!1,c.error("请允许浏览器弹出窗口！");return}r=window.setInterval(()=>{f.closed&&(r!=null&&(clearInterval(r),r=null),o.value=!1)},500)}return(t,e)=>{const i=R,d=Z,p=T,L=ee,f=Y,P=W;return _(),m("div",oe,[g("div",re,[n(L,X({layout:"horizontal",model:u(s)},{wrapperCol:{span:24}}),{default:l(()=>[n(d,{required:""},{default:l(()=>[n(i,{modelValue:u(s).userName,"onUpdate:modelValue":e[0]||(e[0]=a=>u(s).userName=a),placeholder:"账户",size:"large",onKeypress:x(k,["enter"])},{prefix:l(()=>[...e[2]||(e[2]=[g("span",{class:"i-icon-park-outline-user"},null,-1)])]),_:1},8,["modelValue"])]),_:1}),n(d,{required:""},{default:l(()=>[n(i,{modelValue:u(s).password,"onUpdate:modelValue":e[1]||(e[1]=a=>u(s).password=a),type:"password",placeholder:"密码",size:"large","show-password":"",onKeypress:x(k,["enter"])},{prefix:l(()=>[...e[3]||(e[3]=[g("span",{class:"i-icon-park-outline-lock"},null,-1)])]),_:1},8,["modelValue"])]),_:1}),n(d,null,{default:l(()=>[n(p,{type:"primary",block:"",size:"large",loading:u(o),onClick:k},{default:l(()=>[...e[4]||(e[4]=[C(" 登录 ",-1)])]),_:1},8,["loading"]),n(p,{block:"",size:"large",disabled:u(o),onClick:U},{default:l(()=>[...e[5]||(e[5]=[C(" 注册 ",-1)])]),_:1},8,["disabled"])]),_:1})]),_:1},16,["model"]),n(f),n(P,null,{default:l(()=>[(_(),m(j,null,H(B,a=>g("div",{key:a.type,class:"third-party",title:a.title,onClick:ie=>$(a.type)},[a.icon?(_(),m("i",{key:0,class:J(a.icon)},null,2)):(_(),m("img",{key:1,class:"third-party-img",src:a.img,alt:""},null,8,ne))],8,ae)),64))]),_:1})])])}}}),_e=A(se,[["__scopeId","data-v-80f74cd1"]]);export{_e as default};
