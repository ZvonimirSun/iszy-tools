import{be as L,D as $,r as b,o as v,H as P,I as E,V as _,$ as h,u as x,aw as M,bI as V,aq as F,ao as T,Q as z,a$ as I,az as B,ar as D,aC as S}from"./index-DvzMXwRn.js";import{E as j}from"./el-space-H27-uGFf.js";import{l as u}from"./leaflet-src-BJJFh9Dk.js";import{e as N,g as k,c as A,a as K,f as g}from"./leaflet-geoman-B4f0EdGJ.js";async function U(d){const c=await L.get("https://amap.api.iszy.xyz/v3/geocode/geo",{params:{address:d,key:k}});if(c.data.status==="1"&&Number(c.data.count)>0){const t=c.data.geocodes[0],s=N.gcj02_To_gps84(Number.parseFloat(t.location.split(",")[0]),Number.parseFloat(t.location.split(",")[1]));return{latLng:new u.LatLng(s.lat,s.lng),address:t.formatted_address}}else throw new Error("未找到相关地址。")}async function q(d){const c=N.gps84_To_gcj02(d.lng,d.lat),t=await L.get("https://amap.api.iszy.xyz/v3/geocode/regeo",{params:{location:`${c.lng},${c.lat}`,output:"json",key:k,homeorcorp:1}});if(t.data.status==="1"&&t.data.regeocode.formatted_address)return t.data.regeocode.formatted_address;throw new Error("未找到相关地址。")}const O=$({__name:"latLng",setup(d){const c=new u.Icon.Default({iconUrl:"marker-icon-yellow.png",iconRetinaUrl:"marker-icon-2x-yellow.png"});let t,s,l;const p=b(""),w=b();v(()=>{t=A({dom:w.value,view:{center:[35,105],zoom:4}}),K(t),s=u.marker(t.getCenter(),{icon:new u.Icon.Default}).addTo(t).bindPopup(m(t.getCenter())).on("popupopen",()=>{l&&l.closePopup()}).openPopup(),t.on("move",()=>{s&&window.requestAnimationFrame(()=>{s.setLatLng(t.getCenter()),m(t.getCenter(),s.getPopup())})}),t.on("click",e=>{p.value=`${e.latlng.lng},${e.latlng.lat}`,f(e.latlng)}),"geolocation"in navigator&&navigator.geolocation.getCurrentPosition(e=>{p.value||(p.value=`${e.coords.longitude},${e.coords.latitude}`),t.setView([e.coords.latitude,e.coords.longitude],16)})});function y(){if(!p.value)return;const e=p.value.replace(/，/g,",").split(",");if(e.length===2&&!Number.isNaN(Number.parseFloat(e[0].trim()))&&!Number.isNaN(Number.parseFloat(e[1].trim()))){f(new u.LatLng(Number.parseFloat(e[1].trim()),Number.parseFloat(e[0].trim())),!0);return}C(p.value)}function m(e,a,i){a||(a=new u.Popup({autoPan:!1,autoClose:!1,closeOnEscapeKey:!1,closeOnClick:!1}));const r=e.lat;let o=e.lng%360;o<=-180&&(o+=360);let n="";return r>=0?n+=`<p>北纬N: ${Math.abs(r)}</p>`:n+=`<p>南纬S: ${Math.abs(r)}</p>`,o>=0?n+=`<p>东经E: ${Math.abs(o)}</p>`:n+=`<p>西经W: ${Math.abs(o)}</p>`,r>=0?n+=`<p>北纬N: ${g(Math.abs(r))}</p>`:n+=`<p>南纬S: ${g(Math.abs(r))}</p>`,o>=0?n+=`<p>东经E: ${g(o)}</p>`:n+=`<p>西经W: ${g(o)}</p>`,i&&(n+=`<p>地址: ${i}</p>`),a.setContent(n),a}function f(e,a,i){if(a&&t.setView(e,16),l?l.setLatLng(e):l=u.marker(e,{icon:c}).on("popupopen",()=>{s&&s.closePopup()}).addTo(t),i)r();else{const o=setTimeout(()=>{r()},500);q(e).then(n=>{clearTimeout(o),i=n,r()})}function r(){const o=m(e,l.getPopup(),i);l.getPopup()||l.bindPopup(o),l.openPopup()}}async function C(e){try{const a=await U(e);f(a.latLng,!0,a.address)}catch(a){I.error(a.message)}}return(e,a)=>{const i=B,r=D,o=j;return P(),E(z,null,[_(o,{size:8,alignment:"center"},{default:h(()=>[_(i,{modelValue:x(p),"onUpdate:modelValue":a[0]||(a[0]=n=>M(p)?p.value=n:null),placeholder:"输入经纬度(如'116.4,36.9')或地址(如'北京市政府')","allow-clear":"",onKeydown:V(y,["enter"])},null,8,["modelValue"]),_(r,{type:"primary",onClick:y},{default:h(()=>[F(" 解析 ")]),_:1})]),_:1}),T("div",{ref_key:"mapContainer",ref:w,class:"mapContainer"},null,512)],64)}}}),G=S(O,[["__scopeId","data-v-b327f4d2"]]);export{G as default};
