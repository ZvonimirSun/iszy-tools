import{k as _e,R as v,n as G,E as f,q as C,x as a,r,F as s,ai as B,an as L,H as S,K as o,G as P,w as n,N as m,L as ge,Y as _,X as T,Z as D,aA as J,a0 as ke}from"./index-fGxIgJKl.js";import{E as Re,a as Se}from"./el-form-item-Da8cdjrY.js";/* empty css               */import{a as we,E as he}from"./el-select-Bm_SUVzM.js";import"./el-popper-DtR_00rM.js";import{E as Ee}from"./el-alert-DB8_S-1l.js";import{T as Ve,P as Ce}from"./Router-CGciQyM0.js";import"./castArray-D9hNaF__.js";import"./clone-BBISs6QV.js";import"./index-Ddg_CAbr.js";import"./strings-C14RrWcq.js";import"./_baseIteratee-CdF8XRIM.js";import"./index-BfVLsmmM.js";import"./index-BjIp7eB0.js";import"./index-DHLRnE4H.js";const Te={key:0,class:"wrapper"},De={class:"video-wrapper"},Ue={class:"previewVideo"},Ae=["src"],Oe={class:"operations"},Me={class:"settings-wrapper"},Q="unshare",Ne="unstart",M="recording",x="paused",ee="stopped",Ie=_e({__name:"screenRecord",setup(Be){const h=v(),E=v();let c=null,b=null;const u=v(Q);let F=[];const g=v(""),j=v(!1),H=[{label:"否",value:"never"},{label:"是",value:"always"}],k=v("never"),W=[{label:"否",value:"never"},{label:"是",value:"always"}],R=v("never"),Y=[{label:"默认",value:"default"},{label:"16:9",value:1.77},{label:"4:3",value:1.33},{label:"21:9",value:2.35},{label:"14:10",value:1.4},{label:"19:10",value:1.9}],U=v("default"),le=[{label:"默认",value:"default"},{label:"60",value:60},{label:"30",value:30},{label:"25",value:25},{label:"15",value:15},{label:"5",value:5}],A=v("default"),ae=[{label:"默认",value:"default"},{label:"屏幕尺寸",value:"fit-screen"},{label:"4K",value:"4k"},{label:"1080p",value:"1080p"},{label:"720p",value:"720p"}],N=v("default"),K=[{label:"默认",value:"default"},{label:"总是显示",value:"always"},{label:"移动时显示",value:"motion"},{label:"从不显示",value:"never"}],O=v("default"),I=navigator&&navigator.mediaDevices&&navigator.mediaDevices.getSupportedConstraints?navigator.mediaDevices.getSupportedConstraints():{},te=!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia),oe=!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia),ne=te&&oe,q=G(()=>{switch(u.value){case M:return"REC";case x:return"PAUSE";default:return!1}}),re=G(()=>{const t={};switch(typeof U.value=="number"&&(t.aspectRatio=U.value),typeof A.value=="number"&&(t.frameRate=A.value),O.value!=="default"&&(t.cursor=O.value),N.value){case"fit-screen":t.width=screen.width,t.height=screen.height;break;case"4K":t.width=3840,t.height=2160;break;case"1080p":t.width=1920,t.height=1080;break;case"720p":t.width=1280,t.height=720;break}return{video:t,audio:k.value==="always"}}),w=G(()=>{if(c){const t=c.getVideoTracks();if(t.length>0){const e=t[0].getSettings(),i={recordAudio:H.find(p=>k.value===p.value)?.label,recordMicro:W.find(p=>R.value===p.value)?.label,frameRate:e.frameRate,width:e.width,height:e.height,aspectRatio:"默认",cursor:""};if(e.aspectRatio){const p=e.aspectRatio,d=Y.find(y=>typeof y.value=="number"?p-y.value<=.1:!1);d?i.aspectRatio=d.label:i.aspectRatio="默认"}if(e.cursor){const p=K.find(d=>e.cursor===d.value);p?i.cursor=p.label:i.cursor="默认"}return{video:i}}}return{video:{},audio:{}}});async function ue(){try{if(c=await navigator.mediaDevices.getDisplayMedia(re.value),R.value==="always"){const e=await navigator.mediaDevices.getUserMedia({audio:!0});c.addTrack(e.getAudioTracks()[0])}const t=c.getVideoTracks()[0];t&&(t.onended=$,t.onmute=$),b=new MediaRecorder(c),b.onstop=ce,b.ondataavailable=pe,h.value&&(h.value.srcObject=c,h.value.muted=!0),u.value="unstart"}catch(t){J.error(t.message)}}function se(){Z(),b?.start(),u.value=M}function ie(){b?.pause(),u.value=x}function de(){b?.resume(),u.value=M}function X(){b&&b.state!=="inactive"&&b.stop(),u.value=ee}function Z(){g.value=""}function ve(){if(g.value){const t=document.createElement("a");t.href=g.value,t.download="screen-record.mp4",t.click()}}function $(){if(X(),c)c.getTracks().forEach(e=>{e.stop()});else return;J.info("屏幕分享结束"),c=null,h.value&&(h.value.srcObject=null),u.value="unshare"}function ce(){const t=new Blob(F,{type:"video/mp4"});g.value=URL.createObjectURL(t),F=[];const e=window.setInterval(async()=>{E.value&&E.value.readyState>0&&(E.value.duration===Number.POSITIVE_INFINITY?E.value.currentTime=1e7*Math.random():(window.clearInterval(e),E.value.currentTime=0))},200)}function pe(t){F.push(t.data)}function fe(){k.value&&R.value&&(R.value="never")}function me(){k.value&&R.value&&(k.value="never")}return(t,e)=>{const i=ge,p=Ee,d=he,y=we,V=Re,be=Se,z=Ve,ye=Ce;return a(ne)?(r(),f("div",Te,[s("div",De,[s("div",Ue,[B(s("video",{ref_key:"screenShareVideoElement",ref:h,autoplay:""},null,512),[[L,!a(g)]]),B(s("video",{ref_key:"recordVideoElement",ref:E,controls:"",src:a(g)},null,8,Ae),[[L,a(g)]]),B(s("span",{class:"rec"},S(a(q)),513),[[L,a(q)]])]),s("div",Oe,[o(i,{type:"primary",onClick:e[0]||(e[0]=l=>j.value=!a(j))},{default:n(()=>[...e[7]||(e[7]=[m(" 设置 ",-1)])]),_:1}),a(u)===Q?(r(),C(i,{key:0,type:"primary",onClick:ue},{default:n(()=>[...e[8]||(e[8]=[m(" 开启屏幕共享 ",-1)])]),_:1})):(r(),f(_,{key:1},[o(i,{type:"primary",disabled:a(u)===M||a(u)===x,onClick:se},{default:n(()=>[...e[9]||(e[9]=[m(" 开始录制 ",-1)])]),_:1},8,["disabled"]),o(i,{type:"primary",disabled:a(u)!==M,onClick:ie},{default:n(()=>[...e[10]||(e[10]=[m(" 暂停 ",-1)])]),_:1},8,["disabled"]),o(i,{type:"primary",disabled:a(u)!==x,onClick:de},{default:n(()=>[...e[11]||(e[11]=[m(" 继续 ",-1)])]),_:1},8,["disabled"]),o(i,{type:"primary",disabled:a(u)===Ne||a(u)===ee,onClick:X},{default:n(()=>[...e[12]||(e[12]=[m(" 停止 ",-1)])]),_:1},8,["disabled"])],64)),a(g)?(r(),f(_,{key:2},[o(i,{type:"primary",onClick:Z},{default:n(()=>[...e[13]||(e[13]=[m(" 清除 ",-1)])]),_:1}),o(i,{type:"primary",onClick:ve},{default:n(()=>[...e[14]||(e[14]=[m(" 下载 ",-1)])]),_:1})],64)):P("",!0)])]),B(s("div",Me,[o(p,{title:"由于浏览器限制，部分设置可能无法生效",type:"warning","show-icon":"",style:{"margin-bottom":".8rem"}}),a(u)==="unshare"?(r(),C(be,{key:0,"label-position":"top"},{default:n(()=>[o(V,{label:"系统音频"},{default:n(()=>[o(y,{modelValue:a(k),"onUpdate:modelValue":e[1]||(e[1]=l=>T(k)?k.value=l:null),onChange:fe},{default:n(()=>[(r(),f(_,null,D(H,l=>o(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),o(V,{label:"麦克风"},{default:n(()=>[o(y,{modelValue:a(R),"onUpdate:modelValue":e[2]||(e[2]=l=>T(R)?R.value=l:null),onChange:me},{default:n(()=>[(r(),f(_,null,D(W,l=>o(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),a(I).aspectRatio?(r(),C(V,{key:0,label:"选择长宽比"},{default:n(()=>[o(y,{modelValue:a(U),"onUpdate:modelValue":e[3]||(e[3]=l=>T(U)?U.value=l:null)},{default:n(()=>[(r(),f(_,null,D(Y,l=>o(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):P("",!0),a(I).frameRate?(r(),C(V,{key:1,label:"选择帧率"},{default:n(()=>[o(y,{modelValue:a(A),"onUpdate:modelValue":e[4]||(e[4]=l=>T(A)?A.value=l:null)},{default:n(()=>[(r(),f(_,null,D(le,l=>o(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):P("",!0),a(I).width&&a(I).height?(r(),C(V,{key:2,label:"选择分辨率"},{default:n(()=>[o(y,{modelValue:a(N),"onUpdate:modelValue":e[5]||(e[5]=l=>T(N)?N.value=l:null)},{default:n(()=>[(r(),f(_,null,D(ae,l=>o(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})):P("",!0),o(V,{label:"是否显示光标"},{default:n(()=>[o(y,{modelValue:a(O),"onUpdate:modelValue":e[6]||(e[6]=l=>T(O)?O.value=l:null),options:K},{default:n(()=>[(r(),f(_,null,D(K,l=>o(d,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1})]),_:1})):(r(),f(_,{key:1},[o(z,{level:4},{default:n(()=>[...e[15]||(e[15]=[m(" 当前设置 ",-1)])]),_:1}),o(ye,null,{default:n(()=>[s("ul",null,[s("li",null,"系统音频: "+S(a(w).video.recordAudio),1),s("li",null,"麦克风: "+S(a(w).video.recordMicro),1),s("li",null,"长宽比: "+S(a(w).video.aspectRatio),1),s("li",null,"帧率: "+S(a(w).video.frameRate),1),s("li",null,"视频宽度: "+S(a(w).video.width),1),s("li",null,"视频高度: "+S(a(w).video.height),1),s("li",null,"显示鼠标: "+S(a(w).video.cursor),1)])]),_:1})],64))],512),[[L,a(j)]])])):(r(),C(z,{key:1,level:3},{default:n(()=>[...e[16]||(e[16]=[m(" 你的浏览器不支持WebRTC，请安装最新版本Chrome后重试。 ",-1)])]),_:1}))}}}),Je=ke(Ie,[["__scopeId","data-v-600ca46c"]]);export{Je as default};
