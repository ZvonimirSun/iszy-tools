import{k as S,Q as X,aw as $,E as N,r as g,q as A,G as h,x as l,w as s,N as u,K as o,F as p,a0 as I,J as z,n as ee,s as te,aB as oe,R as F,a4 as H,H as U,Y as K,Z as le,L as Q,X as se,W as ne,aA as x,v as q,$ as ae,ax as J,P as re,at as ie,bl as de}from"./index-cf9rWmbE.js";import{E as W}from"./el-divider-DeaeNJ-y.js";import{E as M}from"./el-space-CggOX_Fd.js";import{E as Y}from"./el-checkbox-B5m5sai4.js";import{T,u as ue}from"./Router-Dq-8Nfn0.js";import{E as pe}from"./el-popover-CeJmCNxc.js";import"./el-popper-Du3HqGel.js";import{E as me}from"./el-dialog-DKNdnJM1.js";import{a as fe,E as _e}from"./el-form-item-DTZNgFbw.js";import{L as ce}from"./linuxdo-C7o2R0pC.js";import{E as ge,a as we}from"./el-radio-group-tmHnqiRe.js";/* empty css                 */import"./index-BWoed5MZ.js";import"./isUndefined-DCTLXrZ8.js";import"./castArray-DMcLvZI7.js";import"./clone-TDUO1AO-.js";const ve=S({__name:"jsonEditor",setup(v){const n=X(),_=$(),a=n.modules.jsonEditor;return(k,e)=>{const y=T,f=Y,E=M;return g(),N("div",null,[l(_).logged?(g(),A(y,{key:0,level:5},{default:s(()=>e[1]||(e[1]=[u(" JSON 编辑器 ")])),_:1})):h("",!0),l(_).logged?(g(),A(E,{key:1},{default:s(()=>[o(f,{modelValue:l(a).syncCloud,"onUpdate:modelValue":e[0]||(e[0]=m=>l(a).syncCloud=m)},{default:s(()=>e[2]||(e[2]=[u(" 从云端获取 ")])),_:1},8,["modelValue"])]),_:1})):h("",!0)])}}}),ye={"w-full":"","overflow-auto":""},ke={"gap-4":"",class:"settings-wrapper"},Ve=S({__name:"toolSettings",setup(v){return(n,_)=>{const a=T;return g(),N("div",ye,[o(a,{level:4},{default:s(()=>_[0]||(_[0]=[u(" 应用设置 ")])),_:1}),p("div",ke,[o(ve)])])}}}),be=I(Ve,[["__scopeId","data-v-730637d2"]]),xe=S({inheritAttrs:!1,__name:"HaveAccess",props:{auth:{type:[Boolean,Object],default:!1},link:{default:""}},setup(v){const n=v,_=$(),a=ue(),k=z(),e=ee(()=>n.auth?typeof n.auth=="boolean"?_.logged:_.checkAccess(n.auth):n.link?_.checkAccess(a.getAuth(n.link)):!0);function y(){n.link&&k.push(n.link)}return(f,E)=>l(e)?te(f.$slots,"default",oe({key:0},f.$attrs,{goto:y})):h("",!0)}}),Ne={flex:"","flex-col":"","items-start":"","gap-4":"","text-7":""},Ce={flex:"","items-center":"","gap-4":""},Ee={flex:"","items-center":"","gap-4":""},Se={flex:"","items-center":"","gap-4":""},he={flex:"","items-center":"","gap-4":""},Pe={flex:"","items-center":"","gap-4":""},Ue={flex:"","items-center":"","gap-4":""},$e=["title","onClick"],Ie=["src"],Te=["onClick"],Be={class:"dialog-footer"},Re=S({__name:"personalInfo",setup(v){const n=$(),_=[{type:"github",title:"Github",icon:"i-icon-park-outline:github"},{type:"linuxdo",title:"LINUX DO",img:ce}],a=F(!1),k=F(),e=H({userName:"",nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),y=H({userName:[{trigger:"change",validator:(d,t,r)=>{t&&!t.trim()?r(new Error("用户名无效")):r()}}],nickName:[{trigger:"change",validator:(d,t,r)=>{t&&!t.trim()?r(new Error("昵称无效")):r()}}],rePasswd:[{trigger:"change",validator:(d,t,r)=>{t&&t!==e.passwd?r(new Error("两次输入的密码不一致")):r()}}]}),f=F("");function E(){e.userName=n.profile.userName??"",e.nickName=n.profile.nickName??"",e.email=n.profile.email??"",e.passwd="",e.rePasswd="",e.oldPasswd="",a.value=!0}function m(){a.value=!1}async function c(d){d&&await d.validate(async t=>{if(t){const r={};if(e.userName&&(r.userName=e.userName),e.nickName&&(r.nickName=e.nickName),e.email&&(r.email=e.email),e.passwd&&(r.passwd=e.passwd,e.oldPasswd&&(r.oldPasswd=e.oldPasswd)),Object.keys(r).length===0){x.warning("没有需要修改的信息");return}try{await n.updateUser(r)}catch(V){x.error(V.message)}a.value=!1}else x.warning("请检查输入")})}async function w(d,t){if(n.profile[d])return;const r=new URL(`${J.apiBaseUrl}/auth/${d}/bind`);r.searchParams.append("access_token",n.access_token),L(d,r.toString(),t)}async function B(d){if(n.profile[d])try{await n.thirdPartyUnbind(d),x.success("解绑成功")}catch(t){x.error(t.message)}}async function P(d){var r,V;const t=d.source;if(d.origin===J.apiBaseUrl)if(((r=d.data)==null?void 0:r.type)==="bind_success"){window.removeEventListener("message",P),t.close();try{await n.thirdPartyBind(f.value,d.data.data),x.success("绑定成功")}catch(b){x.error(b.message)}finally{f.value=""}}else((V=d.data)==null?void 0:V.type)==="bind_fail"&&(window.removeEventListener("message",P),t.close(),f.value="",x.error("绑定失败"))}function L(d,t,r="绑定第三方登录",V=500,b=600){if(f.value){x.warning("绑定进行中，请勿重复点击");return}f.value=d,window.addEventListener("message",P);const C=(window.screen.height-V)/2,D=(window.screen.width-b)/2,R=window.open(t,r,`popup,width=${V},height=${b},top=${C},left=${D}`);if(!R){f.value="",x.error("请允许浏览器弹出窗口！");return}const O=window.setInterval(()=>{R.closed&&(window.clearInterval(O),f.value="")},500)}return(d,t)=>{var O,G,j;const r=T,V=Q,b=ne,C=_e,D=fe,R=me;return g(),N("div",null,[o(r,{level:4},{default:s(()=>t[8]||(t[8]=[u(" 账户信息 ")])),_:1}),p("div",Ne,[p("div",Ce,[t[9]||(t[9]=p("div",{"w-32":"","text-right":""}," 用户名: ",-1)),p("div",null,U(l(n).profile.userName),1)]),p("div",Ee,[t[10]||(t[10]=p("div",{"w-32":"","text-right":""}," 昵称: ",-1)),p("div",null,U(l(n).profile.nickName),1)]),p("div",Se,[t[11]||(t[11]=p("div",{"w-32":"","text-right":""}," 邮箱: ",-1)),p("div",null,U(l(n).profile.email),1)]),p("div",he,[t[12]||(t[12]=p("div",{"w-32":"","text-right":""}," 角色: ",-1)),p("div",null,U(((j=(G=(O=l(n).profile)==null?void 0:O.roles)==null?void 0:G[0])==null?void 0:j.alias)??"注册用户"),1)]),p("div",Pe,[t[14]||(t[14]=p("div",{"w-32":"","text-right":""}," 绑定: ",-1)),p("div",Ue,[(g(),N(K,null,le(_,i=>p("div",{key:i.type,class:q(["third-party",{active:l(n).profile[i.type]}]),title:i.title,onClick:Z=>w(i.type,`${i.title} 绑定`)},[i.icon?(g(),N("i",{key:0,class:q(i.icon)},null,2)):i.img?(g(),N("img",{key:1,src:i.img,class:"third-party-img",alt:""},null,8,Ie)):h("",!0),l(n).profile[i.type]?(g(),N("div",{key:2,class:"unbind-btn",title:"解绑",onClick:ae(Z=>B(i.type),["stop"])},t[13]||(t[13]=[p("i",{class:"i-icon-park-solid:close-one"},null,-1)]),8,Te)):h("",!0)],10,$e)),64))])]),o(V,{onClick:E},{default:s(()=>t[15]||(t[15]=[u(" 修改信息 ")])),_:1})]),o(R,{modelValue:l(a),"onUpdate:modelValue":t[7]||(t[7]=i=>se(a)?a.value=i:null),title:"修改信息","before-close":m},{footer:s(()=>[p("span",Be,[o(V,{onClick:m},{default:s(()=>t[16]||(t[16]=[u("取消")])),_:1}),o(V,{type:"primary",onClick:t[6]||(t[6]=i=>c(l(k)))},{default:s(()=>t[17]||(t[17]=[u(" 保存 ")])),_:1})])]),default:s(()=>[o(D,{ref_key:"ruleFormRef",ref:k,model:l(e),rules:l(y),"label-width":"8rem","label-position":"left"},{default:s(()=>[o(C,{label:"用户名",prop:"userName"},{default:s(()=>[o(b,{modelValue:l(e).userName,"onUpdate:modelValue":t[0]||(t[0]=i=>l(e).userName=i)},null,8,["modelValue"])]),_:1}),o(C,{label:"昵称",prop:"nickName"},{default:s(()=>[o(b,{modelValue:l(e).nickName,"onUpdate:modelValue":t[1]||(t[1]=i=>l(e).nickName=i)},null,8,["modelValue"])]),_:1}),o(C,{label:"邮箱",prop:"email"},{default:s(()=>[o(b,{modelValue:l(e).email,"onUpdate:modelValue":t[2]||(t[2]=i=>l(e).email=i)},null,8,["modelValue"])]),_:1}),o(C,{label:"旧密码",prop:"oldPasswd"},{default:s(()=>[o(b,{modelValue:l(e).oldPasswd,"onUpdate:modelValue":t[3]||(t[3]=i=>l(e).oldPasswd=i),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(C,{label:"新密码",prop:"passwd"},{default:s(()=>[o(b,{modelValue:l(e).passwd,"onUpdate:modelValue":t[4]||(t[4]=i=>l(e).passwd=i),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(C,{label:"确认密码",prop:"rePasswd"},{default:s(()=>[o(b,{modelValue:l(e).rePasswd,"onUpdate:modelValue":t[5]||(t[5]=i=>l(e).rePasswd=i),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),Oe=I(Re,[["__scopeId","data-v-715d90ed"]]),Ae=re("main",{persist:!0,state:()=>({_cache:{},clearOfflineCacheTag:!1}),getters:{getData:v=>n=>{if(n)return(v._cache||{})[n]}},actions:{setData({key:v,val:n}={}){v&&(this._cache=this._cache||{},this._cache[v]=n)},clear(){this._cache={}},clearOfflineCache(){console.log("clearOfflineCache"),this.clearOfflineCacheTag=!0}}}),Le={flex:"","items-center":"","gap-4":""},De=S({__name:"authInfo",setup(v){const n=z(),_=ie(),a=$(),k=()=>Ae().clearOfflineCache();function e(){n.push({path:"/login",query:{redirect:_.fullPath}})}function y(){n.push("/register")}function f(){n.push("/logout")}return(E,m)=>{const c=Q,w=xe,B=pe,P=W,L=M;return l(a).logged?(g(),N(K,{key:0},[p("div",Le,[o(c,{type:"primary",onClick:f},{default:s(()=>m[0]||(m[0]=[u(" 登出 ")])),_:1}),o(w,{link:"/userManager"},{default:s(({goto:d})=>[o(c,{onClick:d},{default:s(()=>m[1]||(m[1]=[u(" 用户权限中心 ")])),_:2},1032,["onClick"])]),_:1}),o(B,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:k},{reference:s(()=>[o(c,{type:"danger",plain:""},{default:s(()=>m[2]||(m[2]=[u(" 清空本地缓存 ")])),_:1})]),_:1})]),o(P),o(Oe)],64)):(g(),A(L,{key:1,"mt-4":""},{default:s(()=>[o(c,{type:"primary",onClick:e},{default:s(()=>m[3]||(m[3]=[u(" 登录 ")])),_:1}),o(c,{onClick:y},{default:s(()=>m[4]||(m[4]=[u(" 注册 ")])),_:1}),o(B,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:k},{reference:s(()=>[o(c,{type:"danger",plain:""},{default:s(()=>m[5]||(m[5]=[u(" 清空本地缓存 ")])),_:1})]),_:1})]),_:1}))}}}),Fe=I(De,[["__scopeId","data-v-304747f8"]]),Me={class:"settings-wrapper"},Ge=S({__name:"globalSettings",setup(v){const n=X(),_=de(),a=n.general;return(k,e)=>{const y=T,f=we,E=ge,m=M,c=Y;return g(),N("div",Me,[o(y,{level:4},{default:s(()=>e[5]||(e[5]=[u(" 全局设置 ")])),_:1}),o(y,{level:5},{default:s(()=>e[6]||(e[6]=[u(" 外观 ")])),_:1}),o(m,null,{default:s(()=>[o(E,{"model-value":l(a).theme.mode,onChange:l(_).setTheme},{default:s(()=>[o(f,{value:"auto",label:"跟随系统"}),o(f,{value:"light",label:"浅色"}),o(f,{value:"dark",label:"深色"})]),_:1},8,["model-value","onChange"])]),_:1}),o(y,{level:5},{default:s(()=>e[7]||(e[7]=[u(" 访问统计 ")])),_:1}),o(m,null,{default:s(()=>[o(c,{modelValue:l(a).showMost,"onUpdate:modelValue":e[0]||(e[0]=w=>l(a).showMost=w)},{default:s(()=>e[8]||(e[8]=[u(" 最常访问 ")])),_:1},8,["modelValue"]),o(c,{modelValue:l(a).showRecent,"onUpdate:modelValue":e[1]||(e[1]=w=>l(a).showRecent=w)},{default:s(()=>e[9]||(e[9]=[u(" 最近访问 ")])),_:1},8,["modelValue"])]),_:1}),o(y,{level:5},{default:s(()=>e[10]||(e[10]=[u(" 其他设置 ")])),_:1}),o(m,null,{default:s(()=>[o(c,{modelValue:l(a).showSearch,"onUpdate:modelValue":e[2]||(e[2]=w=>l(a).showSearch=w)},{default:s(()=>e[11]||(e[11]=[u(" 显示搜索 ")])),_:1},8,["modelValue"]),o(c,{modelValue:l(a).showType,"onUpdate:modelValue":e[3]||(e[3]=w=>l(a).showType=w)},{default:s(()=>e[12]||(e[12]=[u(" 显示分类 ")])),_:1},8,["modelValue"]),o(c,{modelValue:l(a).openInNewTab,"onUpdate:modelValue":e[4]||(e[4]=w=>l(a).openInNewTab=w)},{default:s(()=>e[13]||(e[13]=[u(" 新标签页打开工具 ")])),_:1},8,["modelValue"])]),_:1})])}}}),je=I(Ge,[["__scopeId","data-v-f2fa67ef"]]),He={flex:"","flex-wrap":"","items-start":"","gap-4":""},qe=S({__name:"settings",setup(v){const n=$();return(_,a)=>{const k=T,e=W;return g(),N("div",null,[l(n).logged?(g(),A(k,{key:0,level:3},{default:s(()=>[u(U(l(n).profile.nickName)+" 欢迎你~ ",1)]),_:1})):h("",!0),o(Fe),o(e),p("div",He,[o(je),o(be,{"flex-1":""})])])}}}),it=I(qe,[["__scopeId","data-v-0add9d51"]]);export{it as default};
