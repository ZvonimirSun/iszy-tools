import{F as H,h as L,u as Q,dh as W,K as X,k as Z,y as N,Y as P,o as m,l as h,a as e,w as t,b as a,n as l,m as f,t as I,c as E,G as T,s as b,A as g,E as ee,B as te,I as le,J as oe,_ as ae}from"./index.js";import{E as se,a as ne}from"./el-radio-group-d3ada2f3.js";/* empty css                 */import{E as de}from"./el-checkbox-a510239a.js";import{E as re}from"./el-divider-e7db1f3a.js";import{E as ue}from"./el-popover-e8057a68.js";import"./el-popper-c257b8a5.js";import{a as ie,E as pe}from"./el-form-item-7c2ee4a4.js";import{E as me}from"./el-space-8178ace4.js";import"./index-8a2c406b.js";import{_ as fe}from"./Title-a43cccee.js";import"./vite-8235fac6.js";import"./isEqual-16073b58.js";import"./hasIn-b438300e.js";import"./isUndefined-aa0326a0.js";import"./castArray-88ad293b.js";import"./ResizeObserver.es-0f9f8adb.js";const _e=H("main",{persist:!0,state:()=>({_cache:{},clearOfflineCacheTag:!1}),getters:{getData:p=>_=>{if(_)return(p._cache||{})[_]}},actions:{setData({key:p,val:_}={}){p&&(this._cache=this._cache||{},this._cache[p]=_)},clear(){this._cache={}},clearOfflineCache(){console.log("clearOfflineCache"),this.clearOfflineCacheTag=!0}}}),F=p=>(le("data-v-bcfe9f77"),p=p(),oe(),p),ce={key:0,flex:"","flex-col":"","text-7":"","gap-4":"","items-start":""},we={flex:""},ge=F(()=>f("div",{"w-32":""}," 昵称: ",-1)),Ve={flex:""},ye=F(()=>f("div",{"w-32":""}," 邮箱: ",-1)),ve={flex:"","text-7":"","gap-4":"","items-start":"","flex-wrap":"",class:"settings-container"},ke={key:0,class:"settings-wrapper"},he={class:"settings-wrapper"},Ce={key:1,class:"settings-wrapper"},Ee=L({__name:"settings",setup(p){const _=Q(),O=W(),r=X(),u=Z(()=>r.settings),V=N(!1),x=N(),s=P({nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),R=P({rePasswd:[{validator:(y,o,d)=>{o&&o!==s.passwd?d(new Error("两次输入的密码不一致")):d()}}],oldPasswd:[{validator:(y,o,d)=>{!o&&(s.passwd||s.rePasswd)?d(new Error("请输入旧密码")):d()}}]}),S=()=>_e().clearOfflineCache(),B=()=>r.uploadSettings(),D=()=>r.downloadSettings();async function M(){await B()?g.success("同步成功"):g.error("同步失败")}async function j(){await D()?g.success("同步成功"):g.error("同步失败")}function G(){_.push({path:"/login",query:{redirect:O.fullPath}})}function J(){_.push("/logout")}function q(){s.nickName=r._user.profile.nickName??"",s.email=r._user.profile.email??"",s.passwd="",s.rePasswd="",s.oldPasswd="",V.value=!0}function A(){V.value=!1}async function K(y){y&&await y.validate(async o=>{if(o){const d={};if(s.nickName&&(d.nickName=s.nickName),s.email&&(d.email=s.email),s.passwd&&(d.passwd=s.passwd,d.oldPasswd=s.oldPasswd),Object.keys(d).length===0){g.warning("没有需要修改的信息");return}try{await r.updateUser(d)}catch(i){g.error(i.message)}V.value=!1}else return g.warning("请检查输入"),!1})}return(y,o)=>{const d=fe,i=ee,c=me,v=te,k=ie,Y=pe,U=ue,$=re,w=de,C=se,z=ne;return m(),h(T,null,[e(d,{level:3},{default:t(()=>[a(" 账户信息 ")]),_:1}),l(r)._user.token?(m(),h("div",ce,[f("div",we,[ge,f("div",null,I(l(r)._user.profile.nickName),1)]),f("div",Ve,[ye,f("div",null,I(l(r)._user.profile.email),1)]),e(c,null,{default:t(()=>[e(i,{type:"primary",onClick:J},{default:t(()=>[a(" 登出 ")]),_:1}),l(V)?(m(),h(T,{key:1},[e(i,{type:"primary",onClick:o[0]||(o[0]=n=>K(l(x)))},{default:t(()=>[a(" 保存 ")]),_:1}),e(i,{onClick:A},{default:t(()=>[a(" 取消 ")]),_:1})],64)):(m(),E(i,{key:0,onClick:q},{default:t(()=>[a(" 修改信息 ")]),_:1}))]),_:1}),l(V)?(m(),E(Y,{key:0,ref_key:"ruleFormRef",ref:x,model:l(s),rules:l(R),"label-width":"8rem","label-position":"left"},{default:t(()=>[e(k,{label:"昵称",prop:"nickName"},{default:t(()=>[e(v,{modelValue:l(s).nickName,"onUpdate:modelValue":o[1]||(o[1]=n=>l(s).nickName=n)},null,8,["modelValue"])]),_:1}),e(k,{label:"邮箱",prop:"email"},{default:t(()=>[e(v,{modelValue:l(s).email,"onUpdate:modelValue":o[2]||(o[2]=n=>l(s).email=n)},null,8,["modelValue"])]),_:1}),e(k,{label:"旧密码",prop:"oldPasswd"},{default:t(()=>[e(v,{modelValue:l(s).oldPasswd,"onUpdate:modelValue":o[3]||(o[3]=n=>l(s).oldPasswd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(k,{label:"新密码",prop:"passwd"},{default:t(()=>[e(v,{modelValue:l(s).passwd,"onUpdate:modelValue":o[4]||(o[4]=n=>l(s).passwd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(k,{label:"确认密码",prop:"rePasswd"},{default:t(()=>[e(v,{modelValue:l(s).rePasswd,"onUpdate:modelValue":o[5]||(o[5]=n=>l(s).rePasswd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])):b("",!0),e(U,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:S},{reference:t(()=>[e(i,{type:"danger",plain:""},{default:t(()=>[a(" 清空本地缓存 ")]),_:1})]),_:1})])):(m(),E(c,{key:1},{default:t(()=>[e(i,{type:"primary",onClick:G},{default:t(()=>[a(" 登录 ")]),_:1}),e(U,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:S},{reference:t(()=>[e(i,{type:"danger",plain:""},{default:t(()=>[a(" 清空本地缓存 ")]),_:1})]),_:1})]),_:1})),e($),f("div",ve,[l(r)._user.token?(m(),h("div",ke,[e(d,{level:4},{default:t(()=>[a(" 设置云端同步 ")]),_:1}),e(c,null,{default:t(()=>[e(i,{onClick:M},{default:t(()=>[a(" 同步到云端 ")]),_:1}),e(i,{onClick:j},{default:t(()=>[a(" 从云端同步 ")]),_:1}),e(w,{modelValue:l(u).autoSync,"onUpdate:modelValue":o[6]||(o[6]=n=>l(u).autoSync=n)},{default:t(()=>[a(" 自动同步 ")]),_:1},8,["modelValue"])]),_:1})])):b("",!0),f("div",he,[e(d,{level:4},{default:t(()=>[a(" 全局设置 ")]),_:1}),e(d,{level:5},{default:t(()=>[a(" 外观 ")]),_:1}),e(c,null,{default:t(()=>[e(z,{"model-value":l(u).theme.mode,onChange:l(r).setTheme},{default:t(()=>[e(C,{label:"auto"},{default:t(()=>[a(" 跟随系统 ")]),_:1}),e(C,{label:"light"},{default:t(()=>[a(" 浅色 ")]),_:1}),e(C,{label:"dark"},{default:t(()=>[a(" 深色 ")]),_:1})]),_:1},8,["model-value","onChange"])]),_:1}),e(d,{level:5},{default:t(()=>[a(" 访问统计 ")]),_:1}),e(c,null,{default:t(()=>[e(w,{modelValue:l(u).showMost,"onUpdate:modelValue":o[7]||(o[7]=n=>l(u).showMost=n)},{default:t(()=>[a(" 最常访问 ")]),_:1},8,["modelValue"]),e(w,{modelValue:l(u).showRecent,"onUpdate:modelValue":o[8]||(o[8]=n=>l(u).showRecent=n)},{default:t(()=>[a(" 最近访问 ")]),_:1},8,["modelValue"])]),_:1}),e(d,{level:5},{default:t(()=>[a(" 其他设置 ")]),_:1}),e(c,null,{default:t(()=>[e(w,{modelValue:l(u).showSearch,"onUpdate:modelValue":o[9]||(o[9]=n=>l(u).showSearch=n)},{default:t(()=>[a(" 显示搜索 ")]),_:1},8,["modelValue"]),e(w,{modelValue:l(u).showType,"onUpdate:modelValue":o[10]||(o[10]=n=>l(u).showType=n)},{default:t(()=>[a(" 显示分类 ")]),_:1},8,["modelValue"]),e(w,{modelValue:l(u).openInNewTab,"onUpdate:modelValue":o[11]||(o[11]=n=>l(u).openInNewTab=n)},{default:t(()=>[a(" 新标签页打开工具 ")]),_:1},8,["modelValue"])]),_:1})]),l(r)._user.token?(m(),h("div",Ce,[e(d,{level:4},{default:t(()=>[a(" 应用设置 ")]),_:1}),e(d,{level:5},{default:t(()=>[a(" JSON 编辑器 ")]),_:1}),e(c,null,{default:t(()=>[e(w,{modelValue:l(r).modules.jsonEditor.syncCloud,"onUpdate:modelValue":o[12]||(o[12]=n=>l(r).modules.jsonEditor.syncCloud=n)},{default:t(()=>[a(" 从云端获取 ")]),_:1},8,["modelValue"])]),_:1})])):b("",!0)])],64)}}});const qe=ae(Ee,[["__scopeId","data-v-bcfe9f77"]]);export{qe as default};
