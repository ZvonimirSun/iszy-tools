import{x as S,y as F,z as P,d as p,A as w,B as V,D as b,F as G,G as I,H as L,J as M,K as N}from"../../common-WPj835yt.js";import{j as U,B as v,l as j,P as q,q as H,o as c,c as l,a as _,F as x,e as E,g as J,d as $,a3 as K}from"../../vendor-flbquvym.js";function R(d){const i=document.createElement("div");return i.style.padding="0 .5rem",i.textContent=e(),{dom:i,update(s){s.selectionSet&&(i.textContent=e())}};function e(){const s=d.state.selection.main,u=d.state.doc.lineAt(s.head);let t=`总行数: ${d.state.doc.lines} 行数: ${u.number} 列数: ${s.head-u.from}`;return s.empty||(t+=`选中: ${Math.abs(s.to-s.from)} 字符`),t}}const O={...S,extensions:[...S.extensions,F.of(R),P()]},Q={flex:"","flex-col":""},T={class:"controller",flex:""},W=["title","onClick"],X=U({__name:"Editor",props:{inputDefault:{default:""},plugin:{default:void 0},placeholder:{default:""}},emits:["change"],setup(d,{emit:i}){var k,B;const e=d,s=i,u=v();let t;const C=new L,m=v(!1),h=v(!1);j(()=>{var a;const o=[...O.extensions,...((a=e.plugin)==null?void 0:a.extensions)||[],p.updateListener.of(z),C.of(p.theme({},{dark:w().isDark}))];e.placeholder&&o.push(V(e.placeholder)),t=new p({state:b.create({extensions:o,doc:e.inputDefault}),parent:u.value})}),q(()=>{t==null||t.destroy()}),H(()=>w().isDark,o=>{t.dispatch({effects:C.reconfigure(p.theme({},{dark:o}))})});function z(o){o.docChanged&&(m.value=G(t.state)>0,h.value=I(t.state)>0,s("change",o.state.doc.toString()))}const y=[[{title:"撤销",isDisabled:()=>!m.value,event:function(){m.value&&M(t)},icon:"i-fa6-solid-arrow-rotate-left"},{title:"重做",isDisabled:()=>!h.value,event:function(){h.value&&N(t)},icon:"i-fa6-solid-arrow-rotate-right"}]],f=[];return(k=e.plugin)!=null&&k.formatter&&f.push({title:"格式化",event:function(){var a;if((a=e.plugin)!=null&&a.formatter)try{const n=e.plugin.formatter(t.state.doc.toString());n&&n!==t.state.doc.toString()&&t.dispatch({changes:{from:0,to:t.state.doc.length,insert:n}})}catch{}},icon:"i-iszy-editor-format"}),(B=e.plugin)!=null&&B.compactor&&f.push({title:"压缩",event:function(){var a;if((a=e.plugin)!=null&&a.compactor)try{const n=e.plugin.compactor(t.state.doc.toString());n&&n!==t.state.doc.toString()&&t.dispatch({changes:{from:0,to:t.state.doc.length,insert:n}})}catch{}},icon:"i-iszy-editor-compact"}),f.length&&y.unshift(f),(o,a)=>(c(),l("div",Q,[_("div",T,[(c(),l(x,null,E(y,(n,g)=>(c(),l(x,null,[g!==0?(c(),l("div",{key:"divider"+g,class:"divider"})):J("",!0),(c(!0),l(x,null,E(n,(r,A)=>{var D;return c(),l("div",{key:"btn"+g+A,title:r.title,class:$(["controller-btn",{disabled:(D=r.isDisabled)==null?void 0:D.call(r)}]),onClick:r.event},[_("span",{class:$(r.icon)},null,2)],10,W)}),128))],64))),64))]),_("div",{ref_key:"editor",ref:u,class:"editor","w-full":""},null,512)]))}}),tt=K(X,[["__scopeId","data-v-4c4d1a66"]]);export{tt as _};
