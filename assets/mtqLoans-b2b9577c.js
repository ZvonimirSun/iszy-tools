import{ac as Z,L as ee,j as ae,b0 as g,B as F,x as A,aD as W,q as te,o as j,c as q,a as P,b as a,ae as r,y as p,X as _,F as Y,e as X,W as O,ad as ne,g as le,t as oe,aQ as ue,aM as me,aT as se,aU as re,af as ie,bo as de,aN as pe,ag as fe,ak as ce,aL as ve,aO as ye,aP as be,am as _e,an as he,a3 as ge}from"./vendor-7c5ae7bf.js";var $={exports:{}};(function(L,R){(function(M,v){L.exports=v()})(Z,function(){return function(M,v,h){v.prototype.isBetween=function(V,y,m,b){var n=h(V),w=h(y),B=(b=b||"()")[0]==="(",x=b[1]===")";return(B?this.isAfter(n,m):!this.isBefore(n,m))&&(x?this.isBefore(w,m):!this.isAfter(w,m))||(B?this.isBefore(n,m):!this.isAfter(n,m))&&(x?this.isAfter(w,m):!this.isBefore(w,m))}}})})($);var Ae=$.exports;const Re=ee(Ae),Me=L=>(_e("data-v-3aebece7"),L=L(),he(),L),Ve={flex:"","flex-col":"","h-full":"","overflow-auto":""},xe=Me(()=>P("span",{class:"tips"},"计算仅供参考，请以银行数据为准!",-1)),De={flex:"","flex-1":"","overflow-auto":"",class:"panel-wrapper"},Ne={class:"panel"},Fe={class:"panel","flex-1":"",flex:"","flex-col":""},k="YYYY/MM/DD",Le=ae({__name:"mtqLoans",setup(L){g.extend(Re);const R=F(15e4),M=F(2),v=F(24),h=F(4.5),V=F("equalLoan"),y=F(new Date),m=F([]),b=A(()=>{const t={};if(!isNaN(R.value)&&R.value>0&&(t.loanAmount=R.value),Number.isInteger(v.value)&&v.value>0&&(t.loanMonth=v.value),!isNaN(h.value)&&h.value>0&&(t.lendingRates=h.value),y.value)if(t.firstRepaymentDate=g(y.value),m.value.length===0)t.prepayment=m.value;else{let e=!0;for(const u in m.value)if(u==="0"){if(!(m.value[u].repaymentDate&&g(m.value[u].repaymentDate).diff(g(y.value).subtract(1,"M"),"days")>=0)){e=!1;break}}else if(!(m.value[u].repaymentDate&&g(m.value[u].repaymentDate).diff(m.value[parseInt(u)-1].repaymentDate,"days")>=0)){e=!1;break}e&&(t.prepayment=m.value)}return t}),n=A(()=>b.value.loanAmount!=null&&b.value.loanMonth!=null&&b.value.lendingRates!=null&&b.value.firstRepaymentDate&&b.value.prepayment?b.value:null),w=A(()=>{if(n.value){const t=[];if(t.push({key:0,times:0,remainingPrincipal:b.value.loanAmount}),V.value==="equalLoan"){const e={loanAmount:n.value.loanAmount,loanMonth:n.value.loanMonth,lendingRates:n.value.lendingRates};for(let u=1;u<=n.value.loanMonth;u++){const l=Number((-G(e.lendingRates/100/12,e.loanMonth,e.loanAmount)).toFixed(2)),i=Number((e.loanAmount*e.lendingRates/100/12).toFixed(2)),s=Number((l-i).toFixed(2));e.loanAmount-=s,e.loanMonth--,t.push({key:u,times:u,repaymentDate:n.value.firstRepaymentDate.clone().add(u-1,"M").format(k),monthlyAmount:l,interestRepayment:i,principalRepayment:s,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}}else{const e={loanAmount:n.value.loanAmount,loanMonth:n.value.loanMonth};for(let u=1;u<=n.value.loanMonth;u++){const l=Number((e.loanAmount/e.loanMonth).toFixed(2)),i=Number((e.loanAmount*n.value.lendingRates/100/12).toFixed(2)),s=Number((l+i).toFixed(2));e.loanAmount-=l,e.loanMonth--,t.push({key:u,times:u,repaymentDate:n.value.firstRepaymentDate.clone().add(u-1,"M").format(k),monthlyAmount:s,interestRepayment:i,principalRepayment:l,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}}return t}else return[]}),B=A(()=>{if(n.value){const t=[];if(t.push({key:0,times:0,remainingPrincipal:n.value.loanAmount}),V.value==="equalLoan"){const e={loanAmount:n.value.loanAmount,loanMonth:n.value.loanMonth,lendingRates:n.value.lendingRates};let u=0,l=0;const i=W(n.value.prepayment);for(let s=1;s<=n.value.loanMonth-u;s++){if(s>0)for(;i.length>0&&g(i[0].repaymentDate).isBetween(n.value.firstRepaymentDate.clone().add(s-2,"M").subtract(1,"days"),n.value.firstRepaymentDate.clone().add(s-1,"M"),"[)");){const d=i.shift();e.loanAmount-=Number(d.repaymentAmount),e.lendingRates=Number(d.lendingRates||0),e.loanMonth-=Number(d.adjustLoanMonth||0),u+=Number(d.adjustLoanMonth||0),t.push({repaymentDate:g(d.repaymentDate).format(k),principalRepayment:d.repaymentAmount,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}const f=Number((-G(e.lendingRates/100/12,e.loanMonth,e.loanAmount)).toFixed(2));let c=Number((e.loanAmount*e.lendingRates/100/12).toFixed(2));l+=e.loanAmount*e.lendingRates/100/12-c;const D=Number((f-c).toFixed(2));e.loanAmount-=D,e.loanMonth--,e.loanMonth===0&&(c=Number((c+l).toFixed(2))),t.push({key:s,times:s,repaymentDate:n.value.firstRepaymentDate.clone().add(s-1,"M").format(k),monthlyAmount:f,interestRepayment:c,principalRepayment:D,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}}else{const e={loanAmount:n.value.loanAmount,loanMonth:n.value.loanMonth,lendingRates:n.value.lendingRates};let u=0,l=0;const i=W(n.value.prepayment);for(let s=1;s<=n.value.loanMonth-u;s++){if(i.length>0&&s>1&&g(i[0].repaymentDate).isBetween(n.value.firstRepaymentDate.clone().add(s-2,"M").subtract(1,"days"),n.value.firstRepaymentDate.clone().add(s-1,"M"),"[)")){const d=i.shift();e.loanAmount-=Number(d.repaymentAmount),e.lendingRates=Number(d.lendingRates||0),e.loanMonth-=Number(d.adjustLoanMonth||0),u+=Number(d.adjustLoanMonth||0),t.push({repaymentDate:g(d.repaymentDate).format(k),principalRepayment:d.repaymentAmount,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}const f=Number((e.loanAmount/e.loanMonth).toFixed(2));let c=Number((e.loanAmount*e.lendingRates/100/12).toFixed(2));l+=e.loanAmount*e.lendingRates/100/12-c;const D=Number((f+c).toFixed(2));e.loanAmount-=f,e.loanMonth--,e.loanMonth===0&&(c=Number((c+l).toFixed(2))),t.push({key:s,times:s,repaymentDate:n.value.firstRepaymentDate.clone().add(s-1,"M").format(k),monthlyAmount:D,interestRepayment:c,principalRepayment:f,remainingPrincipal:Number(e.loanAmount.toFixed(2))})}}return t}else return[]}),x=A(()=>{let t=0;if(n.value)for(const e of w.value)t+=e.interestRepayment||0;return Number(t.toFixed(2))}),E=A(()=>{let t=0;if(n.value)for(const e of B.value)t+=e.interestRepayment||0;return Number(t.toFixed(2))}),C=A(()=>{let t=0;if(n.value)for(const e of m.value)t+=Number(e.repaymentAmount||0);return t.toFixed(2)}),S=A(()=>{let t=0;if(n.value)for(const e of m.value)t+=Number(e.adjustLoanMonth||0);return t.toFixed(2)}),T=A(()=>(x.value-E.value).toFixed(2));te(M,t=>{t!==0?v.value=t*12:v.value=120});function z(){let t,e;m.value.length===0?(t=y.value?y.value:new Date,e=h.value||0):(t=m.value[m.value.length-1].repaymentDate||new Date,e=m.value[m.value.length-1].lendingRates||0),m.value.push({repaymentDate:t,repaymentAmount:0,adjustLoanMonth:0,lendingRates:e})}function H(){m.value.pop()}function G(t,e,u,l,i){if(l=typeof l<"u"?l:0,i=typeof i<"u"?i:0,t!==0){const s=Math.pow(1+t,e);return-(t*(l+s*u))/((-1+s)*(1+t*i))}else if(e!==0)return-(l+u)/e;return 0}return(t,e)=>{const u=ue,l=me,i=se,s=re,f=ie,c=de,D=pe,d=fe,J=ce,Q=ve,U=ye,K=be;return j(),q("div",Ve,[xe,P("div",De,[P("div",Ne,[a(Q,{"label-width":120,"label-align":"left"},{default:r(()=>[a(l,{label:"贷款金额"},{default:r(()=>[a(u,{modelValue:p(R),"onUpdate:modelValue":e[0]||(e[0]=o=>_(R)?R.value=o:null),"addon-after":"元","controls-position":"right"},null,8,["modelValue"])]),_:1}),a(l,{label:"贷款期限"},{default:r(()=>[a(s,{modelValue:p(M),"onUpdate:modelValue":e[1]||(e[1]=o=>_(M)?M.value=o:null),type:"number"},{default:r(()=>[a(i,{value:0,label:"自定义贷款期限"}),(j(),q(Y,null,X(30,(o,I)=>a(i,{key:"repaymentPeriod"+I,value:o,label:o+"年("+o*12+"月)"},null,8,["value","label"])),64))]),_:1},8,["modelValue"])]),_:1}),a(l,{label:"贷款月数"},{default:r(()=>[a(f,{modelValue:p(v),"onUpdate:modelValue":e[2]||(e[2]=o=>_(v)?v.value=o:null),"addon-after":"月",disabled:p(M)!==0},null,8,["modelValue","disabled"])]),_:1}),a(l,{label:"贷款利率"},{default:r(()=>[a(f,{modelValue:p(h),"onUpdate:modelValue":e[3]||(e[3]=o=>_(h)?h.value=o:null),"addon-after":"%"},null,8,["modelValue"])]),_:1}),a(l,{label:"还款方式"},{default:r(()=>[a(s,{modelValue:p(V),"onUpdate:modelValue":e[4]||(e[4]=o=>_(V)?V.value=o:null)},{default:r(()=>[a(i,{value:"equalLoan",label:"等额本息"}),a(i,{value:"equalPrincipal",label:"等额本金"})]),_:1},8,["modelValue"])]),_:1}),a(l,{label:"首次还款"},{default:r(()=>[a(c,{modelValue:p(y),"onUpdate:modelValue":e[5]||(e[5]=o=>_(y)?y.value=o:null),type:"date"},null,8,["modelValue"])]),_:1}),a(D),a(l,null,{default:r(()=>[a(J,null,{default:r(()=>[a(d,{type:"primary",disabled:!p(y),onClick:z},{default:r(()=>[O(" 添加提前还款 ")]),_:1},8,["disabled"]),p(m).length>0?(j(),ne(d,{key:0,onClick:H},{default:r(()=>[O(" 移除 ")]),_:1})):le("",!0)]),_:1})]),_:1}),(j(!0),q(Y,null,X(p(m),(o,I)=>(j(),q(Y,{key:I},[a(D,{orientation:"left"},{default:r(()=>[O(" 第"+oe(I+1)+"次提前还款 ",1)]),_:2},1024),a(l,{label:"还款日期"},{default:r(()=>[a(c,{modelValue:o.repaymentDate,"onUpdate:modelValue":N=>o.repaymentDate=N,style:{width:"100%"}},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(l,{label:"提前还款金额"},{default:r(()=>[a(u,{modelValue:o.repaymentAmount,"onUpdate:modelValue":N=>o.repaymentAmount=N},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(l,{label:"调整期数"},{default:r(()=>[a(u,{modelValue:o.adjustLoanMonth,"onUpdate:modelValue":N=>o.adjustLoanMonth=N},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024),a(l,{label:"调整利率"},{default:r(()=>[a(f,{modelValue:o.lendingRates,"onUpdate:modelValue":N=>o.lendingRates=N,"addon-after":"%"},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1024)],64))),128))]),_:1})]),P("div",Fe,[a(Q,{"label-width":120,"label-align":"left"},{default:r(()=>[a(l,{label:"累计提前还款"},{default:r(()=>[a(f,{modelValue:p(C),"onUpdate:modelValue":e[6]||(e[6]=o=>_(C)?C.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1}),a(l,{label:"累计调整期数"},{default:r(()=>[a(f,{modelValue:p(S),"onUpdate:modelValue":e[7]||(e[7]=o=>_(S)?S.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1}),a(l,{label:"原累计利息"},{default:r(()=>[a(f,{modelValue:p(x),"onUpdate:modelValue":e[8]||(e[8]=o=>_(x)?x.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1}),a(l,{label:"累计缴息"},{default:r(()=>[a(f,{modelValue:p(E),"onUpdate:modelValue":e[9]||(e[9]=o=>_(E)?E.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1}),a(l,{label:"累计节省利息"},{default:r(()=>[a(f,{modelValue:p(T),"onUpdate:modelValue":e[10]||(e[10]=o=>_(T)?T.value=o:null),"addon-after":"元",readonly:""},null,8,["modelValue"])]),_:1})]),_:1}),a(K,{"flex-1":"",data:p(B)},{default:r(()=>[a(U,{prop:"times",label:"期次"}),a(U,{prop:"repaymentDate",label:"还款日期"}),a(U,{prop:"monthlyAmount",label:"每月还款"}),a(U,{prop:"interestRepayment",label:"偿还利息"}),a(U,{prop:"principalRepayment",label:"偿还本金"}),a(U,{prop:"remainingPrincipal",label:"剩余本金"})]),_:1},8,["data"])])])])}}});const Ue=ge(Le,[["__scopeId","data-v-3aebece7"]]);export{Ue as default};
