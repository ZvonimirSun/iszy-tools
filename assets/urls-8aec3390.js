import{j as F,B as v,k as x,l as R,M as W,q as X,a4 as p,bf as I,aa as d,o as m,c as $,a as V,b as l,y as o,ae as r,W as _,w as G,ad as U,t as M,F as Y,X as S,af as J,ag as K,bh as O,bo as Q,b4 as Z,bi as ee,bp as ae,bq as te,am as le,an as se,a3 as oe}from"./vendor-c7d095d4.js";import"./common-bad41c28.js";import"./ant-design-vue-8684357f.js";const A=b=>(le("data-v-41af8d31"),b=b(),se(),b),ne={flex:"","flex-col":"","gap-4":"","h-full":""},re={class:"new-url-form"},de=A(()=>V("span",null," 输入链接: ",-1)),ue=A(()=>V("span",null," 自定义短网址(选): ",-1)),ie="https://url.iszy.xyz",ce=F({__name:"urls",setup(b){const z=v([]),u=v(10),i=v(1),C=v(0),h=v(!1),f=x({}),y=x({}),c=x({keyword:"",url:""});R(()=>{k(i.value-1,u.value)}),W(()=>{k(i.value-1,u.value)}),X(u,()=>{i.value=1});async function k(e,t){const g=setTimeout(()=>{h.value=!0},300);try{const n=(await p.get(`${p.$apiBase}/urls/admin/urls`,{params:{pageIndex:e,pageSize:t}})).data;n.success?(C.value=n.data.count,z.value=n.data.rows.map(s=>(s.createdAt=I(s.createdAt).format("YYYY年MM月DD日 HH:mm"),s.updatedAt=I(s.updatedAt).format("YYYY年MM月DD日 HH:mm"),s))):d.error(n.message)}catch(n){d.error(n.message)}clearTimeout(g),h.value=!1}async function D(){if(c.url)try{const e=(await p.post(`${p.$apiBase}/urls/admin/url`,{url:c.url,keyword:c.keyword})).data;e.success?(d.success("创建成功"),c.url="",c.keyword="",await k(i.value-1,u.value)):d.error(e.message)}catch(e){d.error(e.message)}}async function L(e){try{const t=(await p.put(`${p.$apiBase}/urls/admin/url/${e.keyword}`,{url:y[e.keyword]})).data;t.success?(d.success("更新成功"),e.url=y[e.keyword],f[e.keyword]=!1,await k(i.value-1,u.value)):d.error(t.message)}catch(t){d.error(t.message)}}async function T(e){try{const t=(await p.delete(`${p.$apiBase}/urls/admin/url/${e.keyword}`,{params:{keyword:e.keyword}})).data;t.success?(await k(i.value-1,u.value),d.success("删除成功")):d.error(t.message)}catch(t){d.error(t.message)}}function B(e){f[e.keyword]=!f[e.keyword],f[e.keyword]&&(y[e.keyword]=e.url)}function H(e){return(i.value-1)*u.value+e+1}return(e,t)=>{const g=J,n=K,s=O,E=Q,P=Z,N=ee,j=ae,q=te;return m(),$("div",ne,[V("div",re,[de,l(g,{modelValue:o(c).url,"onUpdate:modelValue":t[0]||(t[0]=a=>o(c).url=a),placeholder:"https",clearable:"","flex-1":""},null,8,["modelValue"]),ue,l(g,{modelValue:o(c).keyword,"onUpdate:modelValue":t[1]||(t[1]=a=>o(c).keyword=a),clearable:""},null,8,["modelValue"]),l(n,{type:"primary",onClick:D},{default:r(()=>[_(" 缩短 ")]),_:1})]),G((m(),U(N,{data:o(z),border:!0,stripe:!0,size:"small","flex-1":""},{default:r(()=>[l(s,{type:"index",index:H,fixed:"left"}),l(s,{prop:"keyword",label:"短网址",width:"100",fixed:"left"},{default:r(({row:a})=>[l(E,{href:ie+"/"+a.keyword,target:"_blank",style:{"white-space":"nowrap"}},{default:r(()=>[_(M(a.keyword),1)]),_:2},1032,["href"])]),_:1}),l(s,{prop:"url",label:"原网址","min-width":"300"},{default:r(({row:a})=>[o(f)[a.keyword]?(m(),U(g,{key:1,modelValue:o(y)[a.keyword],"onUpdate:modelValue":w=>o(y)[a.keyword]=w},null,8,["modelValue","onUpdate:modelValue"])):(m(),U(E,{key:0,href:a.url,target:"_blank"},{default:r(()=>[_(M(a.url),1)]),_:2},1032,["href"]))]),_:1}),l(s,{prop:"createdAt",label:"日期",width:"180"}),l(s,{prop:"ip",label:"IP",width:"130"}),l(s,{prop:"clicks",label:"点击次数",width:"80"}),l(s,{label:"操作",width:"140",fixed:"right"},{default:r(({row:a})=>[o(f)[a.keyword]?(m(),$(Y,{key:1},[l(n,{size:"small",onClick:w=>B(a)},{default:r(()=>[_(" 取消 ")]),_:2},1032,["onClick"]),l(n,{size:"small",type:"primary",onClick:w=>L(a)},{default:r(()=>[_(" 更新 ")]),_:2},1032,["onClick"])],64)):(m(),$(Y,{key:0},[l(n,{size:"small",onClick:w=>B(a)},{default:r(()=>[_(" 编辑 ")]),_:2},1032,["onClick"]),l(P,{width:"160",title:"删除后无法恢复！","confirm-button-type":"danger","confirm-button-text":"删除",onConfirm:w=>T(a)},{reference:r(()=>[l(n,{size:"small",type:"danger"},{default:r(()=>[_(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])],64))]),_:1})]),_:1},8,["data"])),[[q,o(h)]]),l(j,{"current-page":o(i),"onUpdate:currentPage":t[2]||(t[2]=a=>S(i)?i.value=a:null),"page-size":o(u),"onUpdate:pageSize":t[3]||(t[3]=a=>S(u)?u.value=a:null),small:"",background:"",layout:"prev, pager, next",total:o(C)},null,8,["current-page","page-size","total"])])}}});const me=oe(ce,[["__scopeId","data-v-41af8d31"]]);export{me as default};
