import{d as L,B as Q,aX as W,dp as Y,cA as Z,b as ee,k as le,i as N,C as P,o as m,f as h,l as e,w as l,x as a,n as o,g as f,A as T,D as E,F,a1 as S,G as g,E as oe,t as te,p as ae,h as se,e as ne}from"./index-aIwKM8lD.js";import{E as de,a as re}from"./el-radio-group-VXxIdnJm.js";/* empty css                 */import{E as ue}from"./el-checkbox-nj6mZRjJ.js";import{E as ie}from"./el-divider-IYJawxmE.js";import{E as pe}from"./el-popover-9nhMqC8S.js";import"./el-popper-aNEWiCWJ.js";import{a as me,E as fe}from"./el-form-item-iHMVzKwg.js";import{E as ce}from"./el-space-1fWKpXt0.js";import"./index-MbLc3uX2.js";import{_ as _e}from"./Title-tZjnQmNX.js";import"./isEqual-WP41xjOp.js";import"./hasIn-omV-Klcl.js";import"./isUndefined-IZwZ21d-.js";import"./castArray-thIFR-tu.js";const we=L("main",{persist:!0,state:()=>({_cache:{},clearOfflineCacheTag:!1}),getters:{getData:p=>c=>{if(c)return(p._cache||{})[c]}},actions:{setData({key:p,val:c}={}){p&&(this._cache=this._cache||{},this._cache[p]=c)},clear(){this._cache={}},clearOfflineCache(){console.log("clearOfflineCache"),this.clearOfflineCacheTag=!0}}}),I=p=>(ae("data-v-fdb25d61"),p=p(),se(),p),ge={key:0,flex:"","flex-col":"","text-7":"","gap-4":"","items-start":""},Ve={flex:""},ye=I(()=>f("div",{"w-32":""}," 昵称: ",-1)),ve={flex:""},ke=I(()=>f("div",{"w-32":""}," 邮箱: ",-1)),he={flex:"","text-7":"","gap-4":"","items-start":"","flex-wrap":"",class:"settings-container"},Ce={key:0,class:"settings-wrapper"},Ee={class:"settings-wrapper"},Se={key:1,class:"settings-wrapper"},be=Q({__name:"settings",setup(p){const c=W(),O=Y(),R=Z(),r=ee(),u=le(()=>r.settings),V=N(!1),b=N(),s=P({nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),B=P({rePasswd:[{validator:(y,t,d)=>{t&&t!==s.passwd?d(new Error("两次输入的密码不一致")):d()}}],oldPasswd:[{validator:(y,t,d)=>{!t&&(s.passwd||s.rePasswd)?d(new Error("请输入旧密码")):d()}}]}),x=()=>we().clearOfflineCache(),D=()=>r.uploadSettings(),M=()=>r.downloadSettings();async function j(){await D()?g.success("同步成功"):g.error("同步失败")}async function A(){await M()?g.success("同步成功"):g.error("同步失败")}function G(){c.push({path:"/login",query:{redirect:O.fullPath}})}function q(){c.push("/logout")}function J(){s.nickName=r._user.profile.nickName??"",s.email=r._user.profile.email??"",s.passwd="",s.rePasswd="",s.oldPasswd="",V.value=!0}function X(){V.value=!1}async function $(y){y&&await y.validate(async t=>{if(t){const d={};if(s.nickName&&(d.nickName=s.nickName),s.email&&(d.email=s.email),s.passwd&&(d.passwd=s.passwd,d.oldPasswd=s.oldPasswd),Object.keys(d).length===0){g.warning("没有需要修改的信息");return}try{await r.updateUser(d)}catch(i){g.error(i.message)}V.value=!1}else return g.warning("请检查输入"),!1})}return(y,t)=>{const d=_e,i=oe,_=ce,v=te,k=me,z=fe,U=pe,H=ie,w=ue,C=de,K=re;return m(),h(F,null,[e(d,{level:3},{default:l(()=>[a(" 账户信息 ")]),_:1}),o(r)._user.token?(m(),h("div",ge,[f("div",Ve,[ye,f("div",null,T(o(r)._user.profile.nickName),1)]),f("div",ve,[ke,f("div",null,T(o(r)._user.profile.email),1)]),e(_,null,{default:l(()=>[e(i,{type:"primary",onClick:q},{default:l(()=>[a(" 登出 ")]),_:1}),o(V)?(m(),h(F,{key:1},[e(i,{type:"primary",onClick:t[0]||(t[0]=n=>$(o(b)))},{default:l(()=>[a(" 保存 ")]),_:1}),e(i,{onClick:X},{default:l(()=>[a(" 取消 ")]),_:1})],64)):(m(),E(i,{key:0,onClick:J},{default:l(()=>[a(" 修改信息 ")]),_:1}))]),_:1}),o(V)?(m(),E(z,{key:0,ref_key:"ruleFormRef",ref:b,model:o(s),rules:o(B),"label-width":"8rem","label-position":"left"},{default:l(()=>[e(k,{label:"昵称",prop:"nickName"},{default:l(()=>[e(v,{modelValue:o(s).nickName,"onUpdate:modelValue":t[1]||(t[1]=n=>o(s).nickName=n)},null,8,["modelValue"])]),_:1}),e(k,{label:"邮箱",prop:"email"},{default:l(()=>[e(v,{modelValue:o(s).email,"onUpdate:modelValue":t[2]||(t[2]=n=>o(s).email=n)},null,8,["modelValue"])]),_:1}),e(k,{label:"旧密码",prop:"oldPasswd"},{default:l(()=>[e(v,{modelValue:o(s).oldPasswd,"onUpdate:modelValue":t[3]||(t[3]=n=>o(s).oldPasswd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(k,{label:"新密码",prop:"passwd"},{default:l(()=>[e(v,{modelValue:o(s).passwd,"onUpdate:modelValue":t[4]||(t[4]=n=>o(s).passwd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(k,{label:"确认密码",prop:"rePasswd"},{default:l(()=>[e(v,{modelValue:o(s).rePasswd,"onUpdate:modelValue":t[5]||(t[5]=n=>o(s).rePasswd=n),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])):S("",!0),e(U,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:x},{reference:l(()=>[e(i,{type:"danger",plain:""},{default:l(()=>[a(" 清空本地缓存 ")]),_:1})]),_:1})])):(m(),E(_,{key:1},{default:l(()=>[e(i,{type:"primary",onClick:G},{default:l(()=>[a(" 登录 ")]),_:1}),e(U,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:x},{reference:l(()=>[e(i,{type:"danger",plain:""},{default:l(()=>[a(" 清空本地缓存 ")]),_:1})]),_:1})]),_:1})),e(H),f("div",he,[o(r)._user.token?(m(),h("div",Ce,[e(d,{level:4},{default:l(()=>[a(" 设置云端同步 ")]),_:1}),e(_,null,{default:l(()=>[e(i,{onClick:j},{default:l(()=>[a(" 同步到云端 ")]),_:1}),e(i,{onClick:A},{default:l(()=>[a(" 从云端同步 ")]),_:1}),e(w,{modelValue:o(u).autoSync,"onUpdate:modelValue":t[6]||(t[6]=n=>o(u).autoSync=n)},{default:l(()=>[a(" 自动同步 ")]),_:1},8,["modelValue"])]),_:1})])):S("",!0),f("div",Ee,[e(d,{level:4},{default:l(()=>[a(" 全局设置 ")]),_:1}),e(d,{level:5},{default:l(()=>[a(" 外观 ")]),_:1}),e(_,null,{default:l(()=>[e(K,{"model-value":o(u).theme.mode,onChange:o(R).setTheme},{default:l(()=>[e(C,{label:"auto"},{default:l(()=>[a(" 跟随系统 ")]),_:1}),e(C,{label:"light"},{default:l(()=>[a(" 浅色 ")]),_:1}),e(C,{label:"dark"},{default:l(()=>[a(" 深色 ")]),_:1})]),_:1},8,["model-value","onChange"])]),_:1}),e(d,{level:5},{default:l(()=>[a(" 访问统计 ")]),_:1}),e(_,null,{default:l(()=>[e(w,{modelValue:o(u).showMost,"onUpdate:modelValue":t[7]||(t[7]=n=>o(u).showMost=n)},{default:l(()=>[a(" 最常访问 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(u).showRecent,"onUpdate:modelValue":t[8]||(t[8]=n=>o(u).showRecent=n)},{default:l(()=>[a(" 最近访问 ")]),_:1},8,["modelValue"])]),_:1}),e(d,{level:5},{default:l(()=>[a(" 其他设置 ")]),_:1}),e(_,null,{default:l(()=>[e(w,{modelValue:o(u).showSearch,"onUpdate:modelValue":t[9]||(t[9]=n=>o(u).showSearch=n)},{default:l(()=>[a(" 显示搜索 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(u).showType,"onUpdate:modelValue":t[10]||(t[10]=n=>o(u).showType=n)},{default:l(()=>[a(" 显示分类 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(u).openInNewTab,"onUpdate:modelValue":t[11]||(t[11]=n=>o(u).openInNewTab=n)},{default:l(()=>[a(" 新标签页打开工具 ")]),_:1},8,["modelValue"])]),_:1})]),o(r)._user.token?(m(),h("div",Se,[e(d,{level:4},{default:l(()=>[a(" 应用设置 ")]),_:1}),e(d,{level:5},{default:l(()=>[a(" JSON 编辑器 ")]),_:1}),e(_,null,{default:l(()=>[e(w,{modelValue:o(r).modules.jsonEditor.syncCloud,"onUpdate:modelValue":t[12]||(t[12]=n=>o(r).modules.jsonEditor.syncCloud=n)},{default:l(()=>[a(" 从云端获取 ")]),_:1},8,["modelValue"])]),_:1})])):S("",!0)])],64)}}}),qe=ne(be,[["__scopeId","data-v-fdb25d61"]]);export{qe as default};
