var Ut=Object.defineProperty,Kt=Object.defineProperties;var Yt=Object.getOwnPropertyDescriptors;var Ot=Object.getOwnPropertySymbols;var Jt=Object.prototype.hasOwnProperty,Zt=Object.prototype.propertyIsEnumerable;var Et=(o,i,t)=>i in o?Ut(o,i,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[i]=t,yt=(o,i)=>{for(var t in i||(i={}))Jt.call(i,t)&&Et(o,t,i[t]);if(Ot)for(var t of Ot(i))Zt.call(i,t)&&Et(o,t,i[t]);return o},mt=(o,i)=>Kt(o,Yt(i));import{d as ft,bb as Qt,aZ as te,aa as ee,ah as ie,T as ne,ae as re,bm as oe,bn as se,bd as ae,bo as he,N as le,c as Q,f as tt,y as et,J as it,ab as ce,h as lt,aO as ue,L as Wt,r as B,o as D,K as wt,g as Pt,p as fe,b as de,a as pe}from"./vendor.9bf0bfaf.js";/* empty css                *//* empty css               */import{_ as ge}from"./index.2d1c3b8a.js";var Rt=!1;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var E=function(){return E=Object.assign||function(o){for(var i,t=1,n=arguments.length;t<n;t++)for(var e in i=arguments[t])Object.prototype.hasOwnProperty.call(i,e)&&(o[e]=i[e]);return o},E.apply(this,arguments)};/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var bt=function(o,i){return bt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&(t[e]=n[e])},bt(o,i)};function kt(o,i){if(typeof i!="function"&&i!==null)throw new TypeError("Class extends value "+String(i)+" is not a constructor or null");function t(){this.constructor=o}bt(o,i),o.prototype=i===null?Object.create(i):(t.prototype=i.prototype,new t)}var R=function(){return R=Object.assign||function(o){for(var i,t=1,n=arguments.length;t<n;t++)for(var e in i=arguments[t])Object.prototype.hasOwnProperty.call(i,e)&&(o[e]=i[e]);return o},R.apply(this,arguments)};function H(o,i,t,n){return new(t||(t=Promise))(function(e,r){function l(a){try{f(n.next(a))}catch(h){r(h)}}function s(a){try{f(n.throw(a))}catch(h){r(h)}}function f(a){var h;a.done?e(a.value):(h=a.value,h instanceof t?h:new t(function(c){c(h)})).then(l,s)}f((n=n.apply(o,i||[])).next())})}function M(o,i){var t,n,e,r,l={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return r={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(r[Symbol.iterator]=function(){return this}),r;function s(f){return function(a){return function(h){if(t)throw new TypeError("Generator is already executing.");for(;l;)try{if(t=1,n&&(e=2&h[0]?n.return:h[0]?n.throw||((e=n.return)&&e.call(n),0):n.next)&&!(e=e.call(n,h[1])).done)return e;switch(n=0,e&&(h=[2&h[0],e.value]),h[0]){case 0:case 1:e=h;break;case 4:return l.label++,{value:h[1],done:!1};case 5:l.label++,n=h[1],h=[0];continue;case 7:h=l.ops.pop(),l.trys.pop();continue;default:if(!((e=(e=l.trys).length>0&&e[e.length-1])||h[0]!==6&&h[0]!==2)){l=0;continue}if(h[0]===3&&(!e||h[1]>e[0]&&h[1]<e[3])){l.label=h[1];break}if(h[0]===6&&l.label<e[1]){l.label=e[1],e=h;break}if(e&&l.label<e[2]){l.label=e[2],l.ops.push(h);break}e[2]&&l.ops.pop(),l.trys.pop();continue}h=i.call(o,l)}catch(c){h=[6,c],n=0}finally{t=e=0}if(5&h[0])throw h[1];return{value:h[0]?h[1]:void 0,done:!0}}([f,a])}}}function U(o,i){for(var t=0,n=i.length,e=o.length;t<n;t++,e++)o[e]=i[t];return o}Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(o,i){if(this==null)throw new TypeError('"this" is null or not defined');var t=Object(this),n=t.length>>>0;if(n===0)return!1;for(var e,r,l=0|i,s=Math.max(l>=0?l:n-Math.abs(l),0);s<n;){if((e=t[s])===(r=o)||typeof e=="number"&&typeof r=="number"&&isNaN(e)&&isNaN(r))return!0;s++}return!1}}),String.prototype.includes||(String.prototype.includes=function(o,i){return typeof i!="number"&&(i=0),!(i+o.length>this.length)&&this.indexOf(o,i)!==-1}),Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(o){if(this==null)throw new TypeError('"this" is null or not defined');var i=Object(this),t=i.length>>>0;if(typeof o!="function")throw new TypeError("predicate must be a function");for(var n=arguments[1],e=0;e<t;){var r=i[e];if(o.call(n,r,e,i))return r;e++}}});var nt=function(o){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];return i.some(function(n){return Object.prototype.toString.call(o).slice(8,-1).toLowerCase()===n})},K=function(o,i){return Object.prototype.hasOwnProperty.call(o,i)},St=function(o){return[].filter.call(o,function(i){return i!==`
`}).join("")},j=function(o){if(typeof o!="string"||(o=o.toLocaleLowerCase().trim())==="transparent")return!1;var i;return!(/^rgba/.test(o)&&((i=/([^\s,]+)\)$/.exec(o))===null?0:typeof i=="object"?NaN:typeof i=="number"?i:typeof i=="string"?i[i.length-1]==="%"?Number(i.slice(0,-1))/100:Number(i):NaN)===0)},Ht=function(o){var i,t=((i=o.padding)===null||i===void 0?void 0:i.replace(/px/g,"").split(" ").map(function(a){return~~a}))||[0],n=0,e=0,r=0,l=0;switch(t.length){case 1:n=e=r=l=t[0];break;case 2:n=e=t[0],r=l=t[1];break;case 3:n=t[0],r=l=t[1],e=t[2];break;default:n=t[0],e=t[1],r=t[2],l=t[3]}var s={paddingTop:n,paddingBottom:e,paddingLeft:r,paddingRight:l};for(var f in s)s[f]=K(o,f)&&nt(o[f],"string","number")?~~String(o[f]).replace(/px/g,""):s[f];return[n,e,r,l]},Mt=function(o){var i=[],t=o.map(function(e){return Number(e)}).reduce(function(e,r){if(r>0){var l=e+r;return i.push(l),l}return i.push(NaN),e},0),n=Math.random()*t;return i.findIndex(function(e){return n<=e})},Ct=function(o,i,t,n){n===void 0&&(n=1/0),n<=0&&(n=1/0);for(var e="",r=[],l=o.measureText("...").width,s=0;s<i.length;s++){e+=i[s];var f=o.measureText(e).width,a=t(r);if(n===r.length+1&&(f+=l),a<0)return r;if(f>a&&(r.push(e.slice(0,-1)),e=i[s]),n===r.length)return r[r.length-1]+="...",r}return e&&r.push(e),r.length||r.push(i),r},V=function(){function o(){this.subs=[]}return o.prototype.addSub=function(i){this.subs.includes(i)||this.subs.push(i)},o.prototype.notify=function(){this.subs.forEach(function(i){i.update()})},o}(),ve="__proto__"in{};function Ft(o,i,t,n){Object.defineProperty(o,i,{value:t,enumerable:!!n,writable:!0,configurable:!0})}var jt=Array.prototype,ct=Object.create(jt);["push","pop","shift","unshift","sort","splice","reverse"].forEach(function(o){ct[o]=function(){for(var i=[],t=0;t<arguments.length;t++)i[t]=arguments[t];var n=jt[o].apply(this,i),e=this.__luckyOb__;return["push","unshift","splice"].includes(o)&&e.walk(this),e.dep.notify(),n}});var ye=function(){function o(i){this.dep=new V,Ft(i,"__luckyOb__",this),Array.isArray(i)&&(ve?i.__proto__=ct:Object.getOwnPropertyNames(ct).forEach(function(t){Ft(i,t,ct[t])})),this.walk(i)}return o.prototype.walk=function(i){Object.keys(i).forEach(function(t){Bt(i,t,i[t])})},o}();function Dt(o){if(o&&typeof o=="object")return"__luckyOb__"in o?o.__luckyOb__:new ye(o)}function Bt(o,i,t){var n=new V,e=Object.getOwnPropertyDescriptor(o,i);if(!e||e.configurable!==!1){var r=e&&e.get,l=e&&e.set;r&&!l||arguments.length!==2||(t=o[i]);var s=Dt(t);Object.defineProperty(o,i,{get:function(){var f=r?r.call(o):t;return V.target&&(n.addSub(V.target),s&&s.dep.addSub(V.target)),f},set:function(f){f!==t&&(t=f,r&&!l||(l?l.call(o,f):t=f,s=Dt(f),n.notify()))}})}}var me=0,we=function(){function o(i,t,n,e){e===void 0&&(e={}),this.id=me++,this.$lucky=i,this.expr=t,this.deep=!!e.deep,this.getter=typeof t=="function"?t:function(r){r+=".";for(var l=[],s="",f=0;f<r.length;f++){var a=r[f];if(/\[|\./.test(a))l.push(s),s="";else{if(/\W/.test(a))continue;s+=a}}return function(h){return l.reduce(function(c,u){return c[u]},h)}}(t),this.cb=n,this.value=this.get()}return o.prototype.get=function(){V.target=this;var i=this.getter.call(this.$lucky,this.$lucky);return this.deep&&function(t){var n=function(e){nt(e,"array","object")&&Object.keys(e).forEach(function(r){var l=e[r];n(l)})};n(t)}(i),V.target=null,i},o.prototype.update=function(){var i=this.get(),t=this.value;this.value=i,this.cb.call(this.$lucky,i,t)},o}(),$t=function(){function o(i,t){var n=this;this.version="1.7.20",this.htmlFontSize=16,this.rAF=function(){},this.boxWidth=0,this.boxHeight=0,typeof i=="string"?i={el:i}:i.nodeType===1&&(i={el:"",divElement:i}),i=i,this.config=i,this.data=t,i.flag||(i.flag="WEB"),i.el&&(i.divElement=document.querySelector(i.el)),i.divElement&&(i.canvasElement=document.createElement("canvas"),i.divElement.appendChild(i.canvasElement)),i.canvasElement&&(i.ctx=i.canvasElement.getContext("2d"),i.canvasElement.setAttribute("package","lucky-canvas@1.7.20"),i.canvasElement.addEventListener("click",function(e){return n.handleClick(e)})),this.ctx=i.ctx,this.initWindowFunction(),this.config.ctx||console.error("\u65E0\u6CD5\u83B7\u53D6\u5230 CanvasContext2D"),window&&typeof window.addEventListener=="function"&&window.addEventListener("resize",function(e,r){r===void 0&&(r=300);var l=null;return function(){for(var s=this,f=[],a=0;a<arguments.length;a++)f[a]=arguments[a];l||(l=setTimeout(function(){e.apply(s,f),clearTimeout(l),l=null},r))}}(function(){return n.resize()},300)),window&&typeof window.MutationObserver=="function"&&new window.MutationObserver(function(){n.resize()}).observe(document.documentElement,{attributes:!0})}return o.prototype.resize=function(){var i,t;(t=(i=this.config).beforeResize)===null||t===void 0||t.call(i),this.setHTMLFontSize(),this.setDpr(),this.resetWidthAndHeight(),this.zoomCanvas()},o.prototype.initLucky=function(){if(this.resize(),!this.boxWidth||!this.boxHeight)return console.error("\u65E0\u6CD5\u83B7\u53D6\u5230\u5BBD\u5EA6\u6216\u9AD8\u5EA6")},o.prototype.handleClick=function(i){},o.prototype.setHTMLFontSize=function(){window&&(this.htmlFontSize=+window.getComputedStyle(document.documentElement).fontSize.slice(0,-2))},o.prototype.clearCanvas=function(){var i=[this.boxWidth,this.boxHeight],t=i[0],n=i[1];this.ctx.clearRect(-t,-n,2*t,2*n)},o.prototype.setDpr=function(){var i=this.config;i.dpr||(window?window.dpr=i.dpr=window.devicePixelRatio||1:i.dpr||console.error(i,"\u672A\u4F20\u5165 dpr \u53EF\u80FD\u4F1A\u5BFC\u81F4\u7ED8\u5236\u5F02\u5E38"))},o.prototype.resetWidthAndHeight=function(){var i=this.config,t=this.data,n=0,e=0;i.divElement&&(n=i.divElement.offsetWidth,e=i.divElement.offsetHeight),this.boxWidth=this.getLength(t.width||i.width)||n,this.boxHeight=this.getLength(t.height||i.height)||e,i.divElement&&(i.divElement.style.overflow="hidden",i.divElement.style.width=this.boxWidth+"px",i.divElement.style.height=this.boxHeight+"px")},o.prototype.zoomCanvas=function(){var i=this.config,t=this.ctx,n=i.canvasElement,e=i.dpr,r=[this.boxWidth*e,this.boxHeight*e],l=r[0],s=r[1];n&&(n.width=l,n.height=s,n.style.width=l+"px",n.style.height=s+"px",n.style["transform-origin"]="left top",n.style.transform="scale("+1/e+")",t.scale(e,e))},o.prototype.initWindowFunction=function(){var i=this.config;if(window)return this.rAF=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(n){window.setTimeout(n,1e3/60)},i.setTimeout=window.setTimeout,i.setInterval=window.setInterval,i.clearTimeout=window.clearTimeout,void(i.clearInterval=window.clearInterval);if(i.rAF)this.rAF=i.rAF;else if(i.setTimeout){var t=i.setTimeout;this.rAF=function(n){return t(n,16.7)}}else this.rAF=function(n){return setTimeout(n,16.7)}},o.prototype.loadImg=function(i,t,n){var e=this;return n===void 0&&(n="$resolve"),new Promise(function(r,l){if(i||l("=> '"+t.src+"' \u4E0D\u80FD\u4E3A\u7A7A\u6216\u4E0D\u5408\u6CD5"),e.config.flag!=="WEB")return t[n]=r,void(t.$reject=l);var s=new Image;s.onload=function(){return r(s)},s.onerror=function(){return l("=> '"+t.src+"' \u56FE\u7247\u52A0\u8F7D\u5931\u8D25")},s.src=i})},o.prototype.drawImage=function(i,t){for(var n,e=[],r=2;r<arguments.length;r++)e[r-2]=arguments[r];var l=this.config,s=l.flag,f=l.dpr;if(["WEB","MP-WX"].includes(s))n=t;else{if(!["UNI-H5","UNI-MP","TARO-H5","TARO-MP"].includes(s))return console.error("\u610F\u6599\u4E4B\u5916\u7684 flag, \u8BE5\u5E73\u53F0\u5C1A\u672A\u517C\u5BB9!");n=t.path}if(!n.canvas)return e.length===8&&(e=e.map(function(c,u){return u<4?c*f:c})),i.drawImage.apply(i,U([n],e));var a=n.canvas.getContext("2d");e=e.map(function(c){return c*f});var h=a.getImageData.apply(a,e.slice(0,4));i.putImageData.apply(i,U([h],e.slice(4,6)))},o.prototype.computedWidthAndHeight=function(i,t,n,e){if(!t.width&&!t.height)return[i.width,i.height];if(t.width&&!t.height){var r=this.getLength(t.width,n);return[r,i.height*(r/i.width)]}if(!t.width&&t.height){var l=this.getLength(t.height,e);return[i.width*(l/i.height),l]}return[this.getLength(t.width,n),this.getLength(t.height,e)]},o.prototype.changeUnits=function(i,t){var n=this;t===void 0&&(t=1);var e=this.config;return Number(i.replace(/^([-]*[0-9.]*)([a-z%]*)$/,function(r,l,s){var f={"%":function(h){return h*(t/100)},px:function(h){return 1*h},rem:function(h){return h*n.htmlFontSize},vw:function(h){return h/100*window.innerWidth}}[s];if(f)return f(l);var a=e.handleCssUnit||e.unitFunc;return a?a(l,s):l}))},o.prototype.getLength=function(i,t){return nt(i,"number")?i:nt(i,"string")?this.changeUnits(i,t):0},o.prototype.getOffsetX=function(i,t){return t===void 0&&(t=0),(t-i)/2},o.prototype.getOffscreenCanvas=function(i,t){if(!K(this,"_offscreenCanvas")&&(window&&window.document&&this.config.flag==="WEB"?this._offscreenCanvas=document.createElement("canvas"):this._offscreenCanvas=this.config.offscreenCanvas,!this._offscreenCanvas))return console.error("\u79BB\u5C4F Canvas \u65E0\u6CD5\u6E32\u67D3!");var n=this.config.dpr,e=this._offscreenCanvas;e.width=(i||300)*n,e.height=(t||150)*n;var r=e.getContext("2d");return r.clearRect(0,0,i,t),r.scale(n,n),r.dpr=n,{_offscreenCanvas:e,_ctx:r}},o.prototype.$set=function(i,t,n){i&&typeof i=="object"&&Bt(i,t,n)},o.prototype.$computed=function(i,t,n){var e=this;Object.defineProperty(i,t,{get:function(){return n.call(e)}})},o.prototype.$watch=function(i,t,n){n===void 0&&(n={}),typeof t=="object"&&(t=(n=t).handler);var e=new we(this,i,t,n);return n.immediate&&t.call(this,e.value),function(){}},o.version="1.7.20",o}(),N=function(o){return Math.PI/180*o},ut=function(o){for(var i=[],t=1;t<arguments.length;t++)i[t-1]=arguments[t];var n=i[0],e=i[1],r=i[2],l=i[3],s=i[4],f=Math.min(r,l),a=Math.PI;s>f/2&&(s=f/2),o.beginPath(),o.moveTo(n+s,e),o.lineTo(n+s,e),o.lineTo(n+r-s,e),o.arc(n+r-s,e+s,s,-a/2,0),o.lineTo(n+r,e+l-s),o.arc(n+r-s,e+l-s,s,0,a/2),o.lineTo(n+s,e+l),o.arc(n+s,e+l-s,s,a/2,a),o.lineTo(n,e+s),o.arc(n+s,e+s,s,a,-a/2),o.closePath()},zt=function(o,i,t,n){return o>=n&&(o=n),t*(o/=n)*o+i},Y=function(o,i,t,n){return o>=n&&(o=n),-t*(o/=n)*(o-2)+i},be=function(o){function i(t,n){var e,r=o.call(this,t,{width:n.width,height:n.height})||this;return r.blocks=[],r.prizes=[],r.buttons=[],r.defaultConfig={},r.defaultStyle={},r._defaultConfig={},r._defaultStyle={},r.Radius=0,r.prizeRadius=0,r.prizeDeg=0,r.prizeAng=0,r.rotateDeg=0,r.maxBtnRadius=0,r.startTime=0,r.endTime=0,r.stopDeg=0,r.endDeg=0,r.FPS=16.6,r.step=0,r.ImageCache=new Map,r.initData(n),r.initWatch(),r.initComputed(),(e=t.beforeCreate)===null||e===void 0||e.call(r),r.init(),r}return kt(i,o),i.prototype.resize=function(){var t,n;o.prototype.resize.call(this),this.Radius=Math.min(this.boxWidth,this.boxHeight)/2,this.ctx.translate(this.Radius,this.Radius),this.draw(),(n=(t=this.config).afterResize)===null||n===void 0||n.call(t)},i.prototype.initLucky=function(){this.Radius=0,this.prizeRadius=0,this.prizeDeg=0,this.prizeAng=0,this.rotateDeg=0,this.maxBtnRadius=0,this.startTime=0,this.endTime=0,this.stopDeg=0,this.endDeg=0,this.FPS=16.6,this.prizeFlag=-1,this.step=0,o.prototype.initLucky.call(this)},i.prototype.initData=function(t){this.$set(this,"width",t.width||"300px"),this.$set(this,"height",t.height||"300px"),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"buttons",t.buttons||[]),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"startCallback",t.start),this.$set(this,"endCallback",t.end)},i.prototype.initComputed=function(){var t=this;this.$computed(this,"_defaultConfig",function(){return R({gutter:"0px",offsetDegree:0,speed:20,speedFunction:"quad",accelerationTime:2500,decelerationTime:2500,stopRange:0},t.defaultConfig)}),this.$computed(this,"_defaultStyle",function(){return R({fontSize:"18px",fontColor:"#000",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",wordWrap:!0,lengthLimit:"90%"},t.defaultStyle)})},i.prototype.initWatch=function(){var t=this;this.$watch("width",function(n){t.data.width=n,t.resize()}),this.$watch("height",function(n){t.data.height=n,t.resize()}),this.$watch("blocks",function(n){t.initImageCache()},{deep:!0}),this.$watch("prizes",function(n){t.initImageCache()},{deep:!0}),this.$watch("buttons",function(n){t.initImageCache()},{deep:!0}),this.$watch("defaultConfig",function(){return t.draw()},{deep:!0}),this.$watch("defaultStyle",function(){return t.draw()},{deep:!0}),this.$watch("startCallback",function(){return t.init()}),this.$watch("endCallback",function(){return t.init()})},i.prototype.init=function(){var t,n;return H(this,void 0,void 0,function(){var e;return M(this,function(r){switch(r.label){case 0:return this.initLucky(),e=this.config,(t=e.beforeInit)===null||t===void 0||t.call(this),this.draw(),this.draw(),[4,this.initImageCache()];case 1:return r.sent(),(n=e.afterInit)===null||n===void 0||n.call(this),[2]}})})},i.prototype.initImageCache=function(){var t=this;return new Promise(function(n){var e={blocks:t.blocks.map(function(r){return r.imgs}),prizes:t.prizes.map(function(r){return r.imgs}),buttons:t.buttons.map(function(r){return r.imgs})};Object.keys(e).forEach(function(r){var l=e[r],s=[];l&&l.forEach(function(f,a){f&&f.forEach(function(h,c){s.push(t.loadAndCacheImg(r,a,c))})}),Promise.all(s).then(function(){t.draw(),n()})})})},i.prototype.handleClick=function(t){var n,e=this.ctx;e.beginPath(),e.arc(0,0,this.maxBtnRadius,0,2*Math.PI,!1),e.isPointInPath(t.offsetX,t.offsetY)&&this.step===0&&((n=this.startCallback)===null||n===void 0||n.call(this,t))},i.prototype.loadAndCacheImg=function(t,n,e){return H(this,void 0,void 0,function(){var r=this;return M(this,function(l){return[2,new Promise(function(s,f){var a=r[t][n];if(a&&a.imgs){var h=a.imgs[e];h&&r.loadImg(h.src,h).then(function(c){return H(r,void 0,void 0,function(){return M(this,function(u){switch(u.label){case 0:return typeof h.formatter!="function"?[3,2]:[4,Promise.resolve(h.formatter.call(this,c))];case 1:c=u.sent(),u.label=2;case 2:return this.ImageCache.set(h.src,c),s(),[2]}})})}).catch(function(c){console.error(t+"["+n+"].imgs["+e+"] "+c),f()})}})]})})},i.prototype.drawBlock=function(t,n,e){var r=this,l=this.ctx;j(n.background)&&(l.beginPath(),l.fillStyle=n.background,l.arc(0,0,t,0,2*Math.PI,!1),l.fill()),n.imgs&&n.imgs.forEach(function(s,f){var a=r.ImageCache.get(s.src);if(a){var h=r.computedWidthAndHeight(a,s,2*t,2*t),c=h[0],u=h[1],v=[r.getOffsetX(c)+r.getLength(s.left,2*t),r.getLength(s.top,2*t)-t],g=v[0],d=v[1];l.save(),s.rotate&&l.rotate(N(r.rotateDeg)),r.drawImage(l,a,g,d,c,u),l.restore()}})},i.prototype.draw=function(){var t,n,e=this,r=this,l=r.config,s=r.ctx,f=r._defaultConfig,a=r._defaultStyle;(t=l.beforeDraw)===null||t===void 0||t.call(this,s),s.clearRect(-this.Radius,-this.Radius,2*this.Radius,2*this.Radius),this.prizeRadius=this.blocks.reduce(function(g,d,p){return e.drawBlock(g,d,p),g-e.getLength(d.padding&&d.padding.split(" ")[0])},this.Radius),this.prizeDeg=360/this.prizes.length,this.prizeAng=N(this.prizeDeg);var h=this.prizeRadius*Math.sin(this.prizeAng/2)*2,c=N(this.rotateDeg-90+this.prizeDeg/2+f.offsetDegree),u=function(g,d){return e.getOffsetX(s.measureText(d).width)+e.getLength(g.left,h)},v=function(g,d,p){var m=g.lineHeight||a.lineHeight||g.fontSize||a.fontSize;return e.getLength(g.top,d)+(p+1)*e.getLength(m)};s.save(),this.prizes.forEach(function(g,d){var p=c+d*e.prizeAng,m=e.prizeRadius-e.maxBtnRadius,S=g.background||a.background;j(S)&&(s.fillStyle=S,function(w,y,C,$,z,L){w.beginPath();var x,I,A=N(90/Math.PI/C*L),T=$+A,_=z-A;w.arc(0,0,C,T,_,!1),w.lineTo.apply(w,(x=($+z)/2,I=L/2/Math.abs(Math.sin(($-z)/2)),[+(Math.cos(x)*I).toFixed(8),+(Math.sin(x)*I).toFixed(8)])),w.closePath()}(s,e.maxBtnRadius,e.prizeRadius,p-e.prizeAng/2,p+e.prizeAng/2,e.getLength(f.gutter)),s.fill());var b=Math.cos(p)*e.prizeRadius,k=Math.sin(p)*e.prizeRadius;s.translate(b,k),s.rotate(p+N(90)),g.imgs&&g.imgs.forEach(function(w,y){var C=e.ImageCache.get(w.src);if(C){var $=e.computedWidthAndHeight(C,w,e.prizeAng*e.prizeRadius,m),z=$[0],L=$[1],x=[e.getOffsetX(z)+e.getLength(w.left,h),e.getLength(w.top,m)],I=x[0],A=x[1];e.drawImage(s,C,I,A,z,L)}}),g.fonts&&g.fonts.forEach(function(w){var y=w.fontColor||a.fontColor,C=w.fontWeight||a.fontWeight,$=e.getLength(w.fontSize||a.fontSize),z=w.fontStyle||a.fontStyle,L=K(w,"wordWrap")?w.wordWrap:a.wordWrap,x=w.lengthLimit||a.lengthLimit,I=w.lineClamp||a.lineClamp;s.fillStyle=y,s.font=C+" "+($>>0)+"px "+z;var A=String(w.text);(L?Ct(s,St(A),function(T){var _=(e.prizeRadius-v(w,m,T.length))*Math.tan(e.prizeAng/2)*2-e.getLength(f.gutter);return e.getLength(x,_)},I):A.split(`
`)).filter(function(T){return!!T}).forEach(function(T,_){s.fillText(T,u(w,T),v(w,m,_))})}),s.rotate(N(360)-p-N(90)),s.translate(-b,-k)}),s.restore(),this.buttons.forEach(function(g,d){var p=e.getLength(g.radius,e.prizeRadius);e.maxBtnRadius=Math.max(e.maxBtnRadius,p),j(g.background)&&(s.beginPath(),s.fillStyle=g.background,s.arc(0,0,p,0,2*Math.PI,!1),s.fill()),g.pointer&&j(g.background)&&(s.beginPath(),s.fillStyle=g.background,s.moveTo(-p,0),s.lineTo(p,0),s.lineTo(0,2*-p),s.closePath(),s.fill()),g.imgs&&g.imgs.forEach(function(m,S){var b=e.ImageCache.get(m.src);if(b){var k=e.computedWidthAndHeight(b,m,2*p,2*p),w=k[0],y=k[1],C=[e.getOffsetX(w)+e.getLength(m.left,p),e.getLength(m.top,p)],$=C[0],z=C[1];e.drawImage(s,b,$,z,w,y)}}),g.fonts&&g.fonts.forEach(function(m){var S=m.fontColor||a.fontColor,b=m.fontWeight||a.fontWeight,k=e.getLength(m.fontSize||a.fontSize),w=m.fontStyle||a.fontStyle;s.fillStyle=S,s.font=b+" "+(k>>0)+"px "+w,String(m.text).split(`
`).forEach(function(y,C){s.fillText(y,u(m,y),v(m,p,C))})})}),(n=l.afterDraw)===null||n===void 0||n.call(this,s)},i.prototype.carveOnGunwaleOfAMovingBoat=function(){var t=this,n=t._defaultConfig,e=t.prizeFlag,r=t.prizeDeg,l=t.rotateDeg;this.endTime=Date.now();for(var s=this.stopDeg=l,f=n.speed,a=(Math.random()*r-r/2)*this.getLength(n.stopRange),h=0,c=0,u=0;++h;){var v=360*h-e*r-l-n.offsetDegree+a-r/2,g=Y(this.FPS,s,v,n.decelerationTime)-s;if(g>f){this.endDeg=f-c>g-f?v:u;break}u=v,c=g}},i.prototype.play=function(){var t,n;this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,(n=(t=this.config).afterStart)===null||n===void 0||n.call(t),this.run())},i.prototype.stop=function(t){if(this.step!==0&&this.step!==3){if(!t&&t!==0){var n=this.prizes.map(function(e){return e.range});t=Mt(n)}t<0?(this.step=0,this.prizeFlag=-1):(this.step=2,this.prizeFlag=t%this.prizes.length)}},i.prototype.run=function(t){var n;t===void 0&&(t=0);var e=this,r=e.rAF,l=e.step,s=e.prizeFlag,f=e._defaultConfig,a=f.accelerationTime,h=f.decelerationTime,c=f.speed;if(l!==0){if(s!==-1){l!==3||this.endDeg||this.carveOnGunwaleOfAMovingBoat();var u=Date.now()-this.startTime,v=Date.now()-this.endTime,g=this.rotateDeg;if(l===1||u<a){this.FPS=u/t;var d=zt(u,0,c,a);d===c&&(this.step=2),g+=d%360}else l===2?(g+=c%360,s!==void 0&&s>=0&&(this.step=3,this.stopDeg=0,this.endDeg=0)):l===3?(g=Y(v,this.stopDeg,this.endDeg,h),v>=h&&(this.step=0)):this.stop(-1);this.rotateDeg=g,this.draw(),r(this.run.bind(this,t+1))}}else(n=this.endCallback)===null||n===void 0||n.call(this,this.prizes.find(function(p,m){return m===s})||{})},i.prototype.conversionAxis=function(t,n){var e=this.config;return[t/e.dpr-this.Radius,n/e.dpr-this.Radius]},i}($t),ke=function(o){function i(t,n){var e,r=o.call(this,t,{width:n.width,height:n.height})||this;return r.rows=3,r.cols=3,r.blocks=[],r.prizes=[],r.buttons=[],r.defaultConfig={},r.defaultStyle={},r.activeStyle={},r._defaultConfig={},r._defaultStyle={},r._activeStyle={},r.cellWidth=0,r.cellHeight=0,r.startTime=0,r.endTime=0,r.currIndex=0,r.stopIndex=0,r.endIndex=0,r.demo=!1,r.timer=0,r.FPS=16.6,r.step=0,r.prizeFlag=-1,r.cells=[],r.ImageCache=new Map,r.initData(n),r.initWatch(),r.initComputed(),(e=t.beforeCreate)===null||e===void 0||e.call(r),r.init(),r}return kt(i,o),i.prototype.resize=function(){var t,n;o.prototype.resize.call(this),this.draw(),(n=(t=this.config).afterResize)===null||n===void 0||n.call(t)},i.prototype.initLucky=function(){this.cellWidth=0,this.cellHeight=0,this.startTime=0,this.endTime=0,this.currIndex=0,this.stopIndex=0,this.endIndex=0,this.demo=!1,this.timer=0,this.FPS=16.6,this.prizeFlag=-1,this.step=0,o.prototype.initLucky.call(this)},i.prototype.initData=function(t){this.$set(this,"width",t.width||"300px"),this.$set(this,"height",t.height||"300px"),this.$set(this,"rows",Number(t.rows)||3),this.$set(this,"cols",Number(t.cols)||3),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"buttons",t.buttons||[]),this.$set(this,"button",t.button),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"activeStyle",t.activeStyle||{}),this.$set(this,"startCallback",t.start),this.$set(this,"endCallback",t.end)},i.prototype.initComputed=function(){var t=this;this.$computed(this,"_defaultConfig",function(){var n=R({gutter:5,speed:20,accelerationTime:2500,decelerationTime:2500},t.defaultConfig);return n.gutter=t.getLength(n.gutter),n.speed=n.speed/40,n}),this.$computed(this,"_defaultStyle",function(){return R({borderRadius:20,fontColor:"#000",fontSize:"18px",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",shadow:"",wordWrap:!0,lengthLimit:"90%"},t.defaultStyle)}),this.$computed(this,"_activeStyle",function(){return R({background:"#ffce98",shadow:""},t.activeStyle)})},i.prototype.initWatch=function(){var t=this;this.$watch("width",function(n){t.data.width=n,t.resize()}),this.$watch("height",function(n){t.data.height=n,t.resize()}),this.$watch("blocks",function(n){t.initImageCache()},{deep:!0}),this.$watch("prizes",function(n){t.initImageCache()},{deep:!0}),this.$watch("buttons",function(n){t.initImageCache()},{deep:!0}),this.$watch("rows",function(){return t.init()}),this.$watch("cols",function(){return t.init()}),this.$watch("defaultConfig",function(){return t.draw()},{deep:!0}),this.$watch("defaultStyle",function(){return t.draw()},{deep:!0}),this.$watch("activeStyle",function(){return t.draw()},{deep:!0}),this.$watch("startCallback",function(){return t.init()}),this.$watch("endCallback",function(){return t.init()})},i.prototype.init=function(){var t,n;return H(this,void 0,void 0,function(){var e;return M(this,function(r){switch(r.label){case 0:return this.initLucky(),e=this.config,(t=e.beforeInit)===null||t===void 0||t.call(this),this.draw(),[4,this.initImageCache()];case 1:return r.sent(),(n=e.afterInit)===null||n===void 0||n.call(this),[2]}})})},i.prototype.initImageCache=function(){var t=this;return new Promise(function(n){var e=t.buttons.map(function(l){return l.imgs});t.button&&e.push(t.button.imgs);var r={blocks:t.blocks.map(function(l){return l.imgs}),prizes:t.prizes.map(function(l){return l.imgs}),buttons:e};Object.keys(r).forEach(function(l){var s=r[l],f=[];s&&s.forEach(function(a,h){a&&a.forEach(function(c,u){f.push(t.loadAndCacheImg(l,h,u))})}),Promise.all(f).then(function(){t.draw(),n()})})})},i.prototype.handleClick=function(t){var n=this,e=this.ctx;U(U([],this.buttons),[this.button]).forEach(function(r){var l;if(r){var s=n.getGeometricProperty([r.x,r.y,r.col||1,r.row||1]),f=s[0],a=s[1],h=s[2],c=s[3];e.beginPath(),e.rect(f,a,h,c),e.isPointInPath(t.offsetX,t.offsetY)&&n.step===0&&(typeof r.callback=="function"&&r.callback.call(n,r),(l=n.startCallback)===null||l===void 0||l.call(n,t,r))}})},i.prototype.loadAndCacheImg=function(t,n,e){return H(this,void 0,void 0,function(){var r=this;return M(this,function(l){return[2,new Promise(function(s,f){var a=r[t][n];if(t==="buttons"&&!r.buttons.length&&r.button&&(a=r.button),a&&a.imgs){var h=a.imgs[e];if(h){var c=[r.loadImg(h.src,h),h.activeSrc&&r.loadImg(h.activeSrc,h,"$activeResolve")];Promise.all(c).then(function(u){var v=u[0],g=u[1];return H(r,void 0,void 0,function(){var d;return M(this,function(p){switch(p.label){case 0:return typeof(d=h.formatter)!="function"?[3,3]:[4,Promise.resolve(d.call(this,v))];case 1:return v=p.sent(),g?[4,Promise.resolve(d.call(this,g))]:[3,3];case 2:g=p.sent(),p.label=3;case 3:return this.ImageCache.set(h.src,v),g&&this.ImageCache.set(h.activeSrc,g),s(),[2]}})})}).catch(function(u){console.error(t+"["+n+"].imgs["+e+"] "+u),f()})}}})]})})},i.prototype.draw=function(){var t,n,e=this,r=this,l=r.config,s=r.ctx,f=r._defaultConfig,a=r._defaultStyle,h=r._activeStyle;(t=l.beforeDraw)===null||t===void 0||t.call(this,s),s.clearRect(0,0,this.boxWidth,this.boxHeight),this.cells=U(U([],this.prizes),this.buttons),this.button&&this.cells.push(this.button),this.cells.forEach(function(c){c.col=c.col||1,c.row=c.row||1}),this.prizeArea=this.blocks.reduce(function(c,u,v){var g=c.x,d=c.y,p=c.w,m=c.h,S=Ht(u),b=S[0],k=S[1],w=S[2],y=S[3],C=u.borderRadius?e.getLength(u.borderRadius):0,$=u.background||a.background;return j($)&&(s.fillStyle=e.handleBackground(g,d,p,m,$),ut(s,g,d,p,m,C),s.fill()),u.imgs&&u.imgs.forEach(function(z,L){var x=e.ImageCache.get(z.src);if(x){var I=e.computedWidthAndHeight(x,z,p,m),A=I[0],T=I[1],_=[e.getOffsetX(A,p)+e.getLength(z.left,p),e.getLength(z.top,m)],F=_[0],X=_[1];e.drawImage(s,x,g+F,d+X,A,T)}}),{x:g+w,y:d+b,w:p-w-y,h:m-b-k}},{x:0,y:0,w:this.boxWidth,h:this.boxHeight}),this.cellWidth=(this.prizeArea.w-f.gutter*(this.cols-1))/this.cols,this.cellHeight=(this.prizeArea.h-f.gutter*(this.rows-1))/this.rows,this.cells.forEach(function(c,u){var v=e.getGeometricProperty([c.x,c.y,c.col,c.row]),g=v[0],d=v[1],p=v[2],m=v[3],S=!1;(e.prizeFlag===void 0||e.prizeFlag>-1)&&(S=u===e.currIndex%e.prizes.length>>0);var b=S?h.background:c.background||a.background;if(j(b)){var k=(S?h.shadow:c.shadow||a.shadow).replace(/px/g,"").split(",")[0].split(" ").map(function(y,C){return C<3?Number(y):y});k.length===4&&(s.shadowColor=k[3],s.shadowOffsetX=k[0]*l.dpr,s.shadowOffsetY=k[1]*l.dpr,s.shadowBlur=k[2],k[0]>0?p-=k[0]:(p+=k[0],g-=k[0]),k[1]>0?m-=k[1]:(m+=k[1],d-=k[1])),s.fillStyle=e.handleBackground(g,d,p,m,b);var w=e.getLength(c.borderRadius?c.borderRadius:a.borderRadius);ut(s,g,d,p,m,w),s.fill(),s.shadowColor="rgba(0, 0, 0, 0)",s.shadowOffsetX=0,s.shadowOffsetY=0,s.shadowBlur=0}u>=e.prizes.length&&(u-=e.prizes.length),c.imgs&&c.imgs.forEach(function(y,C){var $=e.ImageCache.get(y.src),z=e.ImageCache.get(y.activeSrc);if($){var L=S&&z||$;if(L){var x=e.computedWidthAndHeight(L,y,p,m),I=x[0],A=x[1],T=[g+e.getOffsetX(I,p)+e.getLength(y.left,p),d+e.getLength(y.top,m)],_=T[0],F=T[1];e.drawImage(s,L,_,F,I,A)}}}),c.fonts&&c.fonts.forEach(function(y){var C=S&&h.fontStyle?h.fontStyle:y.fontStyle||a.fontStyle,$=S&&h.fontWeight?h.fontWeight:y.fontWeight||a.fontWeight,z=S&&h.fontSize?e.getLength(h.fontSize):e.getLength(y.fontSize||a.fontSize),L=S&&h.lineHeight?h.lineHeight:y.lineHeight||a.lineHeight||y.fontSize||a.fontSize,x=K(y,"wordWrap")?y.wordWrap:a.wordWrap,I=y.lengthLimit||a.lengthLimit,A=y.lineClamp||a.lineClamp;s.font=$+" "+(z>>0)+"px "+C,s.fillStyle=S&&h.fontColor?h.fontColor:y.fontColor||a.fontColor;var T=[],_=String(y.text);if(x){var F=e.getLength(I,p);T=Ct(s,St(_),function(){return F},A)}else T=_.split(`
`);T.forEach(function(X,dt){s.fillText(X,g+e.getOffsetX(s.measureText(X).width,p)+e.getLength(y.left,p),d+e.getLength(y.top,m)+(dt+1)*e.getLength(L))})})}),(n=l.afterDraw)===null||n===void 0||n.call(this,s)},i.prototype.handleBackground=function(t,n,e,r,l){var s=this.ctx;return l.includes("linear-gradient")&&(l=function(f,a,h,c,u,v){var g=/linear-gradient\((.+)\)/.exec(v)[1].split(",").map(function(b){return b.trim()}),d=g.shift(),p=[0,0,0,0];if(d.includes("deg")){var m=function(b){return Math.tan(b/180*Math.PI)};(d=d.slice(0,-3)%360)>=0&&d<45?p=[a,h+u,a+c,h+u-c*m(d-0)]:d>=45&&d<90?p=[a,h+u,a+c-u*m(d-45),h]:d>=90&&d<135?p=[a+c,h+u,a+c-u*m(d-90),h]:d>=135&&d<180?p=[a+c,h+u,a,h+c*m(d-135)]:d>=180&&d<225?p=[a+c,h,a,h+c*m(d-180)]:d>=225&&d<270?p=[a+c,h,a+u*m(d-225),h+u]:d>=270&&d<315?p=[a,h,a+u*m(d-270),h+u]:d>=315&&d<360&&(p=[a,h,a+c,h+u-c*m(d-315)])}else d.includes("top")?p=[a,h+u,a,h]:d.includes("bottom")?p=[a,h,a,h+u]:d.includes("left")?p=[a+c,h,a,h]:d.includes("right")&&(p=[a,h,a+c,h]);var S=f.createLinearGradient.apply(f,p.map(function(b){return b>>0}));return g.reduce(function(b,k,w){var y=k.split(" ");return y.length===1?b.addColorStop(w,y[0]):y.length===2&&b.addColorStop.apply(b,y),b},S)}(s,t,n,e,r,l)),l},i.prototype.carveOnGunwaleOfAMovingBoat=function(){var t=this,n=t._defaultConfig,e=t.prizeFlag,r=t.currIndex;this.endTime=Date.now();for(var l=this.stopIndex=r,s=n.speed,f=0,a=0,h=0;++f;){var c=this.prizes.length*f+e-l,u=Y(this.FPS,l,c,n.decelerationTime)-l;if(u>s){this.endIndex=s-a>u-s?c:h;break}h=c,a=u}},i.prototype.play=function(){var t,n;this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,(n=(t=this.config).afterStart)===null||n===void 0||n.call(t),this.run())},i.prototype.stop=function(t){if(this.step!==0&&this.step!==3){if(!t&&t!==0){var n=this.prizes.map(function(e){return e.range});t=Mt(n)}t<0?(this.step=0,this.prizeFlag=-1):(this.step=2,this.prizeFlag=t%this.prizes.length)}},i.prototype.run=function(t){var n;t===void 0&&(t=0);var e=this,r=e.rAF,l=e.step,s=e.prizes,f=e.prizeFlag,a=e._defaultConfig,h=a.accelerationTime,c=a.decelerationTime,u=a.speed;if(l!==0){if(f!==-1){l!==3||this.endIndex||this.carveOnGunwaleOfAMovingBoat();var v=Date.now()-this.startTime,g=Date.now()-this.endTime,d=this.currIndex;if(l===1||v<h){this.FPS=v/t;var p=zt(v,.1,u-.1,h);p===u&&(this.step=2),d+=p%s.length}else l===2?(d+=u%s.length,f!==void 0&&f>=0&&(this.step=3,this.stopIndex=0,this.endIndex=0)):l===3?(d=Y(g,this.stopIndex,this.endIndex,c),g>=c&&(this.step=0)):this.stop(-1);this.currIndex=d,this.draw(),r(this.run.bind(this,t+1))}}else(n=this.endCallback)===null||n===void 0||n.call(this,this.prizes.find(function(m,S){return S===f})||{})},i.prototype.getGeometricProperty=function(t){var n=t[0],e=t[1],r=t[2],l=r===void 0?1:r,s=t[3],f=s===void 0?1:s,a=this.cellWidth,h=this.cellHeight,c=this._defaultConfig.gutter,u=[this.prizeArea.x+(a+c)*n,this.prizeArea.y+(h+c)*e];return l&&f&&u.push(a*l+c*(l-1),h*f+c*(f-1)),u},i.prototype.conversionAxis=function(t,n){var e=this.config;return[t/e.dpr,n/e.dpr]},i}($t),Se=function(o){function i(t,n){var e,r=o.call(this,t,{width:n.width,height:n.height})||this;return r.blocks=[],r.prizes=[],r.slots=[],r.defaultConfig={},r._defaultConfig={},r.defaultStyle={},r._defaultStyle={},r.endCallback=function(){},r.cellWidth=0,r.cellHeight=0,r.cellAndSpacing=0,r.widthAndSpacing=0,r.heightAndSpacing=0,r.FPS=16.6,r.scroll=[],r.stopScroll=[],r.endScroll=[],r.startTime=0,r.endTime=0,r.step=0,r.prizeFlag=void 0,r.ImageCache=new Map,r.initData(n),r.initWatch(),r.initComputed(),(e=t.beforeCreate)===null||e===void 0||e.call(r),r.init(),r}return kt(i,o),i.prototype.resize=function(){var t,n;o.prototype.resize.call(this),this.draw(),(n=(t=this.config).afterResize)===null||n===void 0||n.call(t)},i.prototype.initLucky=function(){this.cellWidth=0,this.cellHeight=0,this.cellAndSpacing=0,this.widthAndSpacing=0,this.heightAndSpacing=0,this.FPS=16.6,this.scroll=[],this.stopScroll=[],this.endScroll=[],this.startTime=0,this.endTime=0,this.prizeFlag=void 0,this.step=0,o.prototype.initLucky.call(this)},i.prototype.initData=function(t){this.$set(this,"width",t.width||"300px"),this.$set(this,"height",t.height||"300px"),this.$set(this,"blocks",t.blocks||[]),this.$set(this,"prizes",t.prizes||[]),this.$set(this,"slots",t.slots||[]),this.$set(this,"defaultConfig",t.defaultConfig||{}),this.$set(this,"defaultStyle",t.defaultStyle||{}),this.$set(this,"endCallback",t.end)},i.prototype.initComputed=function(){var t=this;this.$computed(this,"_defaultConfig",function(){var n=R({mode:"vertical",rowSpacing:0,colSpacing:5,speed:20,direction:1,accelerationTime:2500,decelerationTime:2500},t.defaultConfig);return n.rowSpacing=t.getLength(n.rowSpacing),n.colSpacing=t.getLength(n.colSpacing),n}),this.$computed(this,"_defaultStyle",function(){return R({borderRadius:0,fontColor:"#000",fontSize:"18px",fontStyle:"sans-serif",fontWeight:"400",background:"rgba(0,0,0,0)",wordWrap:!0,lengthLimit:"90%"},t.defaultStyle)})},i.prototype.initWatch=function(){var t=this;this.$watch("width",function(n){t.data.width=n,t.resize()}),this.$watch("height",function(n){t.data.height=n,t.resize()}),this.$watch("blocks",function(n){t.initImageCache()},{deep:!0}),this.$watch("prizes",function(n){t.initImageCache()},{deep:!0}),this.$watch("slots",function(n){t.drawOffscreenCanvas(),t.draw()},{deep:!0}),this.$watch("defaultConfig",function(){return t.draw()},{deep:!0}),this.$watch("defaultStyle",function(){return t.draw()},{deep:!0}),this.$watch("endCallback",function(){return t.init()})},i.prototype.init=function(){var t,n;return H(this,void 0,void 0,function(){var e;return M(this,function(r){switch(r.label){case 0:return this.initLucky(),e=this.config,(t=e.beforeInit)===null||t===void 0||t.call(this),this.drawOffscreenCanvas(),this.draw(),[4,this.initImageCache()];case 1:return r.sent(),(n=e.afterInit)===null||n===void 0||n.call(this),[2]}})})},i.prototype.initImageCache=function(){var t=this;return new Promise(function(n){var e={blocks:t.blocks.map(function(r){return r.imgs}),prizes:t.prizes.map(function(r){return r.imgs})};Object.keys(e).forEach(function(r){var l=e[r],s=[];l&&l.forEach(function(f,a){f&&f.forEach(function(h,c){s.push(t.loadAndCacheImg(r,a,c))})}),Promise.all(s).then(function(){t.drawOffscreenCanvas(),t.draw(),n()})})})},i.prototype.loadAndCacheImg=function(t,n,e){return H(this,void 0,void 0,function(){var r=this;return M(this,function(l){return[2,new Promise(function(s,f){var a=r[t][n];if(a&&a.imgs){var h=a.imgs[e];h&&r.loadImg(h.src,h).then(function(c){return H(r,void 0,void 0,function(){return M(this,function(u){switch(u.label){case 0:return typeof h.formatter!="function"?[3,2]:[4,Promise.resolve(h.formatter.call(this,c))];case 1:c=u.sent(),u.label=2;case 2:return this.ImageCache.set(h.src,c),s(),[2]}})})}).catch(function(c){console.error(t+"["+n+"].imgs["+e+"] "+c),f()})}})]})})},i.prototype.drawOffscreenCanvas=function(){var t=this,n=this._defaultConfig,e=this._defaultStyle,r=this.drawBlocks(),l=r.w,s=r.h,f=this.prizes.length,a=this.displacementWidthOrHeight(),h=a.cellWidth,c=a.cellHeight,u=a.widthAndSpacing,v=a.heightAndSpacing,g=new Array(f).fill(void 0).map(function(k,w){return w}),d=0,p=0;this.slots.forEach(function(k,w){t.scroll[w]===void 0&&(t.scroll[w]=0),k.order=k.order||g;var y=k.order.length;d=Math.max(d,l+u*y),p=Math.max(p,s+v*y)});var m=this.getOffscreenCanvas(d,p),S=m._offscreenCanvas,b=m._ctx;this._offscreenCanvas=S,this.slots.forEach(function(k,w){var y=h*w,C=c*w,$=0,z=function(P,q){for(var rt={},ot=[],W=0;W<P.length;W++)rt[W]=P[W];for(W=0;W<q.length;W++){var G=rt[q[W]];G&&(ot[W]=G)}return ot}(t.prizes,k.order);if(z.length){z.forEach(function(P,q){if(P){k.order[q];var rt=u*q+n.colSpacing/2,ot=v*q+n.rowSpacing/2,W=t.displacement([y,ot,v],[rt,C,u]),G=W[0],pt=W[1],Vt=W[2];$+=Vt;var Lt=P.background||e.background;if(j(Lt)){var Xt=t.getLength(K(P,"borderRadius")?P.borderRadius:e.borderRadius);ut(b,G,pt,h,h,Xt),b.fillStyle=Lt,b.fill()}P.imgs&&P.imgs.forEach(function(O,Tt){var J=t.ImageCache.get(O.src);if(J){var st=t.computedWidthAndHeight(J,O,h,c),at=st[0],gt=st[1],ht=[G+t.getOffsetX(at,h)+t.getLength(O.left,h),pt+t.getLength(O.top,c)],vt=ht[0],Z=ht[1];t.drawImage(b,J,vt,Z,at,gt)}}),P.fonts&&P.fonts.forEach(function(O){var Tt=O.fontStyle||e.fontStyle,J=O.fontWeight||e.fontWeight,st=t.getLength(O.fontSize||e.fontSize),at=O.lineHeight||e.lineHeight||O.fontSize||e.fontSize,gt=K(O,"wordWrap")?O.wordWrap:e.wordWrap,ht=O.lengthLimit||e.lengthLimit,vt=O.lineClamp||e.lineClamp;b.font=J+" "+(st>>0)+"px "+Tt,b.fillStyle=O.fontColor||e.fontColor;var Z=[],At=String(O.text);if(gt){var qt=t.getLength(ht,h);Z=Ct(b,St(At),function(){return qt},vt)}else Z=At.split(`
`);Z.forEach(function(_t,Gt){b.fillText(_t,G+t.getOffsetX(b.measureText(_t).width,h)+t.getLength(O.left,h),pt+t.getLength(O.top,c)+(Gt+1)*t.getLength(at))})})}});for(var L=t.displacement([y,0,h,$],[0,C,$,c]),x=L[0],I=L[1],A=L[2],T=L[3],_=$;_<p+$;){var F=t.displacement([x,_],[_,I]),X=F[0],dt=F[1];t.drawImage(b,S,x,I,A,T,X,dt,A,T),_+=$}}})},i.prototype.drawBlocks=function(){var t=this,n=this;n.config;var e=n.ctx;n._defaultConfig;var r=n._defaultStyle;return this.prizeArea=this.blocks.reduce(function(l,s,f){var a=l.x,h=l.y,c=l.w,u=l.h,v=Ht(s),g=v[0],d=v[1],p=v[2],m=v[3],S=s.borderRadius?t.getLength(s.borderRadius):0,b=s.background||r.background;return j(b)&&(ut(e,a,h,c,u,S),e.fillStyle=b,e.fill()),s.imgs&&s.imgs.forEach(function(k,w){var y=t.ImageCache.get(k.src);if(y){var C=t.computedWidthAndHeight(y,k,c,u),$=C[0],z=C[1],L=[t.getOffsetX($,c)+t.getLength(k.left,c),t.getLength(k.top,u)],x=L[0],I=L[1];t.drawImage(e,y,a+x,h+I,$,z)}}),{x:a+p,y:h+g,w:c-p-m,h:u-g-d}},{x:0,y:0,w:this.boxWidth,h:this.boxHeight})},i.prototype.draw=function(){var t,n=this,e=this,r=e.config,l=e.ctx;e._defaultConfig,e._defaultStyle,(t=r.beforeDraw)===null||t===void 0||t.call(this,l),l.clearRect(0,0,this.boxWidth,this.boxHeight);var s=this.drawBlocks(),f=s.x,a=s.y,h=s.w,c=s.h;if(this._offscreenCanvas){var u=this,v=u.cellWidth,g=u.cellHeight,d=u.cellAndSpacing,p=u.widthAndSpacing,m=u.heightAndSpacing;this.slots.forEach(function(S,b){var k=d*S.order.length,w=n.displacement(-(c-m)/2,-(h-p)/2),y=n.scroll[b]+w;y<0&&(y=y%k+k),y>k&&(y%=k);var C=n.displacement([v*b,y,v,c],[y,g*b,h,g]),$=C[0],z=C[1],L=C[2],x=C[3],I=n.displacement([f+p*b,a,v,c],[f,a+m*b,h,g]),A=I[0],T=I[1],_=I[2],F=I[3];n.drawImage(l,n._offscreenCanvas,$,z,L,x,A,T,_,F)})}},i.prototype.carveOnGunwaleOfAMovingBoat=function(){var t=this,n=this,e=n._defaultConfig,r=n.prizeFlag,l=n.cellAndSpacing;this.endTime=Date.now(),this.slots.forEach(function(s,f){var a=s.order;if(a.length)for(var h=s.speed||e.speed,c=s.direction||e.direction,u=a.findIndex(function(S){return S===r[f]}),v=l*a.length,g=t.stopScroll[f]=t.scroll[f],d=0;++d;){var p=l*u+v*d*c-g,m=Y(t.FPS,g,p,e.decelerationTime)-g;if(Math.abs(m)>h){t.endScroll[f]=p;break}}})},i.prototype.play=function(){var t,n;this.step===0&&(this.startTime=Date.now(),this.prizeFlag=void 0,this.step=1,(n=(t=this.config).afterStart)===null||n===void 0||n.call(t),this.run())},i.prototype.stop=function(t){var n;if(this.step!==0&&this.step!==3){if(typeof t=="number")this.prizeFlag=new Array(this.slots.length).fill(t);else{if(!nt(t,"array"))return this.stop(-1),console.error("stop() \u65E0\u6CD5\u8BC6\u522B\u7684\u53C2\u6570\u7C7B\u578B "+typeof t);if(t.length!==this.slots.length)return this.stop(-1),console.error("stop(["+t+"]) \u53C2\u6570\u957F\u5EA6\u7684\u4E0D\u6B63\u786E");this.prizeFlag=t}!((n=this.prizeFlag)===null||n===void 0)&&n.includes(-1)?(this.prizeFlag=[],this.step=0):this.step=2}},i.prototype.run=function(t){var n,e,r=this;t===void 0&&(t=0);var l=this,s=l.rAF,f=l.step,a=l.prizeFlag,h=l._defaultConfig,c=l.cellAndSpacing,u=l.slots,v=h.accelerationTime,g=h.decelerationTime;if(this.step!==0||(a==null?void 0:a.length)!==u.length){if(a===void 0||a.length){this.step!==3||this.endScroll.length||this.carveOnGunwaleOfAMovingBoat();var d=Date.now()-this.startTime,p=Date.now()-this.endTime;u.forEach(function(w,y){var C=w.order;if(C&&C.length){var $=c*C.length,z=Math.abs(w.speed||h.speed),L=w.direction||h.direction,x=0,I=r.scroll[y];if(f===1||d<v){r.FPS=d/t;var A=zt(d,0,z,v);A===z&&(r.step=2),x=(I+A*L)%$}else if(f===2)x=(I+z*L)%$,(a==null?void 0:a.length)===u.length&&(r.step=3,r.stopScroll=[],r.endScroll=[]);else if(f===3&&p){var T=r.stopScroll[y],_=r.endScroll[y];x=Y(p,T,_,g),p>=g&&(r.step=0)}r.scroll[y]=x}}),this.draw(),s(this.run.bind(this,t+1))}}else{for(var m=a[0],S=0;S<u.length;S++){var b=u[S],k=a[S];if(!(!((n=b.order)===null||n===void 0)&&n.includes(k))||m!==k){m=-1;break}}(e=this.endCallback)===null||e===void 0||e.call(this,this.prizes.find(function(w,y){return y===m})||void 0)}},i.prototype.displacement=function(t,n){return this._defaultConfig.mode==="horizontal"?n:t},i.prototype.displacementWidthOrHeight=function(){var t=this._defaultConfig.mode,n=this.slots.length,e=this._defaultConfig,r=e.colSpacing,l=e.rowSpacing,s=this.prizeArea||this.drawBlocks();s.x,s.y;var f,a,h=s.w,c=s.h,u=0,v=0;return t==="horizontal"?(v=this.cellHeight=(c-l*(n-1))/n,u=this.cellWidth=v):(u=this.cellWidth=(h-r*(n-1))/n,v=this.cellHeight=u),f=this.widthAndSpacing=this.cellWidth+r,a=this.heightAndSpacing=this.cellHeight+l,this.cellAndSpacing=t==="horizontal"?f:a,{cellWidth:u,cellHeight:v,widthAndSpacing:f,heightAndSpacing:a}},i}($t),xt=function(o,i,t){i===void 0&&(i={});var n=i.props,e=i.domProps,r=i.on,l=function(a,h){var c={};for(var u in a)Object.prototype.hasOwnProperty.call(a,u)&&h.indexOf(u)<0&&(c[u]=a[u]);if(a!=null&&typeof Object.getOwnPropertySymbols=="function"){var v=0;for(u=Object.getOwnPropertySymbols(a);v<u.length;v++)h.indexOf(u[v])<0&&Object.prototype.propertyIsEnumerable.call(a,u[v])&&(c[u[v]]=a[u[v]])}return c}(i,["props","domProps","on"]),s=function(a){return a?Object.entries(a).reduce(function(h,c){var u,v=c[0],g=c[1];return v="on"+(v=v.charAt(0).toUpperCase()+v.slice(1)),E(E({},h),((u={})[v]=g,u))},{}):null}(r),f=E(E(E(E({},l),n),e),s);return Qt(o,f,t)},It="@lucky-canvas/vue",Nt=ft({name:"LuckyWheel",props:{width:{type:[String,Number],default:"300px",require:!0},height:{type:[String,Number],default:"300px",require:!0},blocks:{type:Array,default:function(){return[]}},prizes:{type:Array,default:function(){return[]}},buttons:{type:Array,default:function(){return[]}},defaultStyle:{type:Object,default:function(){return{}}},defaultConfig:{type:Object,default:function(){return{}}}},emits:["start","end","success","error","finally"],watch:{blocks:function(o,i){this.$lucky&&(this.$lucky.blocks=o)},prizes:function(o,i){this.$lucky&&(this.$lucky.prizes=o)},buttons:function(o,i){this.$lucky&&(this.$lucky.buttons=o)}},data:function(){return{$lucky:null}},mounted:function(){this.$refs.myLucky&&this.$refs.myLucky.setAttribute("package",It+"@0.1.8");try{this.initLucky(),this.$emit("success")}catch(o){this.$emit("error",o)}finally{this.$emit("finally")}},methods:{initLucky:function(){var o=this;this.$lucky=new be({flag:"WEB",width:String(this.width),height:String(this.height),divElement:this.$refs.myLucky,rAF:window.requestAnimationFrame,setTimeout:window.setTimeout,setInterval:window.setInterval,clearTimeout:window.clearTimeout,clearInterval:window.clearInterval},E(E({},this.$props),{start:function(i){o.$emit("start",i)},end:function(i){o.$emit("end",i)}}))},init:function(){this.$lucky&&this.$lucky.init()},play:function(){var o;(o=this.$lucky)===null||o===void 0||o.play()},stop:function(o){var i;(i=this.$lucky)===null||i===void 0||i.stop(o)}},render:function(){return xt("div",{ref:"myLucky"})}}),Ce=ft({name:"LuckyGrid",props:{width:{type:[String,Number],default:"300px",require:!0},height:{type:[String,Number],default:"300px",require:!0},cols:{type:[String,Number],default:3},rows:{type:[String,Number],default:3},blocks:{type:Array,default:function(){return[]}},prizes:{type:Array,default:function(){return[]}},buttons:{type:Array,default:function(){return[]}},button:{type:Object},defaultStyle:{type:Object,default:function(){return{}}},activeStyle:{type:Object,default:function(){return{}}},defaultConfig:{type:Object,default:function(){return{}}}},emits:["start","end","success","error","finally"],watch:{cols:function(o,i){this.$lucky&&(this.$lucky.cols=o)},rows:function(o,i){this.$lucky&&(this.$lucky.rows=o)},blocks:function(o,i){this.$lucky&&(this.$lucky.blocks=o)},prizes:function(o,i){this.$lucky&&(this.$lucky.prizes=o)},buttons:function(o,i){this.$lucky&&(this.$lucky.buttons=o)},button:function(o,i){this.$lucky&&(this.$lucky.button=o)}},data:function(){return{$lucky:null}},mounted:function(){this.$refs.myLucky&&this.$refs.myLucky.setAttribute("package",It+"@0.1.8");try{this.initLucky(),this.$emit("success")}catch(o){this.$emit("error",o)}finally{this.$emit("finally")}},methods:{initLucky:function(){var o=this;this.$lucky=new ke({flag:"WEB",width:String(this.width),height:String(this.height),divElement:this.$refs.myLucky,rAF:window.requestAnimationFrame,setTimeout:window.setTimeout,setInterval:window.setInterval,clearTimeout:window.clearTimeout,clearInterval:window.clearInterval},E(E({},this.$props),{start:function(i,t){o.$emit("start",i,t)},end:function(i){o.$emit("end",i)}}))},init:function(){this.$lucky&&this.$lucky.init()},play:function(){var o;(o=this.$lucky)===null||o===void 0||o.play()},stop:function(o){var i;(i=this.$lucky)===null||i===void 0||i.stop(o)}},render:function(){return xt("div",{ref:"myLucky"})}}),$e=ft({name:"SlotMachine",props:{width:{type:[String,Number],default:"300px",require:!0},height:{type:[String,Number],default:"300px",require:!0},blocks:{type:Array,default:function(){return[]}},prizes:{type:Array,default:function(){return[]}},slots:{type:Array,default:function(){return[]}},defaultStyle:{type:Object,default:function(){return{}}},defaultConfig:{type:Object,default:function(){return{}}}},watch:{blocks:function(o,i){this.$lucky&&(this.$lucky.blocks=o)},slots:function(o,i){this.$lucky&&(this.$lucky.slots=o)},prizes:function(o,i){this.$lucky&&(this.$lucky.prizes=o)}},data:function(){return{$lucky:null}},mounted:function(){this.$refs.myLucky&&this.$refs.myLucky.setAttribute("package",It+"@0.1.8");try{this.initLucky(),this.$emit("success")}catch(o){this.$emit("error",o)}finally{this.$emit("finally")}},methods:{initLucky:function(){var o=this;this.$lucky=new Se({flag:"WEB",width:String(this.width),height:String(this.height),divElement:this.$refs.myLucky,rAF:window.requestAnimationFrame,setTimeout:window.setTimeout,setInterval:window.setInterval,clearTimeout:window.clearTimeout,clearInterval:window.clearInterval},E(E({},this.$props),{start:function(i){o.$emit("start",i)},end:function(i){o.$emit("end",i)}}))},init:function(){this.$lucky&&this.$lucky.init()},play:function(){var o;(o=this.$lucky)===null||o===void 0||o.play()},stop:function(o){var i;(i=this.$lucky)===null||i===void 0||i.stop(o)}},render:function(){return xt("div",{ref:"myLucky"})}}),ze=function(o){o.component("LuckyWheel",Nt),o.component("LuckyGrid",Ce),o.component("SlotMachine",$e)};typeof window!="undefined"&&window.Vue&&Rt&&ze(window.Vue);const xe=ft({name:"RandomList",components:{Tag:te,Tooltip:ee,Input:ie,Typography:ne,Divider:re,Plus:oe,LuckyWheel:Nt},data:()=>({tags:[],inputValue:"",inputVisible:!1,loading:!1,blocks:[{padding:"10px",background:"#869cfa"}],buttons:[{radius:"40%",background:"#617df2"},{radius:"35%",background:"#afc8ff"},{radius:"30%",background:"#869cfa",pointer:!0,fonts:[{text:"\u5F00\u59CB",top:"-10px"}]}]}),computed:mt(yt({},se(["getData"])),{prizes:function(){const o=["#e9e8fe","#b8c5f2"];return this.tags.map((i,t)=>({background:o[t%2],fonts:[{text:i}]}))}}),watch:{},mounted(){this.tags=(this.getData("randomList")||{}).tags||[]},beforeUnmount(){},methods:mt(yt({},ae(["setData"])),{startCallBack(){this.loading=!0,this.$refs.myLucky.play(),setTimeout(()=>{this.$refs.myLucky.stop(he(this.tags.length))},3e3)},endCallBack(o){le.success({title:()=>`\u62BD\u4E2D\u4E86 \u300E${o.fonts[0].text}\u300F`,onOk:()=>{this.$refs.myLucky.init(),this.loading=!1}})},updateCache(){this.setData({key:"randomList",val:{tags:this.tags}})},handleClose(o){this.tags=this.tags.filter(i=>i!==o),this.updateCache()},showInput(){this.inputVisible=!0,this.$nextTick(()=>{this.$refs.inputRef.focus()})},handleInputConfirm(){const o=this.inputValue;o&&this.tags.indexOf(o)===-1&&(this.tags=[...this.tags,o]),this.inputVisible=!1,this.inputValue="",this.updateCache()}})}),Ie=o=>(fe("data-v-336cc3f1"),o=o(),de(),o),Le=Ie(()=>pe("h4",null,"\u968F\u673A\u5217\u8868",-1)),Te=wt(" \u65B0\u5185\u5BB9 ");function Ae(o,i,t,n,e,r){const l=B("Typography"),s=B("Tag"),f=B("Tooltip"),a=B("Input"),h=B("Plus"),c=B("Divider"),u=B("LuckyWheel");return D(),Q(it,null,[tt(l,null,{default:et(()=>[Le]),_:1}),(D(!0),Q(it,null,ce(o.tags,(v,g)=>(D(),Q(it,{key:g},[v.length>20?(D(),lt(f,{key:0,title:v},{default:et(()=>[tt(s,{closable:!o.loading,onClose:d=>o.handleClose(v)},{default:et(()=>[wt(Pt(`${v.slice(0,20)}...`),1)]),_:2},1032,["closable","onClose"])]),_:2},1032,["title"])):(D(),lt(s,{key:1,closable:!o.loading,onClose:d=>o.handleClose(v)},{default:et(()=>[wt(Pt(v),1)]),_:2},1032,["closable","onClose"]))],64))),128)),o.loading?Wt("",!0):(D(),Q(it,{key:0},[o.inputVisible?(D(),lt(a,{key:0,ref:"inputRef",value:o.inputValue,"onUpdate:value":i[0]||(i[0]=v=>o.inputValue=v),type:"text",size:"small",style:{width:"78px"},onBlur:o.handleInputConfirm,onKeyup:ue(o.handleInputConfirm,["enter"])},null,8,["value","onBlur","onKeyup"])):(D(),lt(s,{key:1,style:{background:"#fff","border-style":"dashed"},onClick:o.showInput},{default:et(()=>[tt(h,{theme:"outline"}),Te]),_:1},8,["onClick"]))],64)),o.tags.length?(D(),Q(it,{key:1},[tt(c),tt(u,{ref:"myLucky",width:"200px",height:"200px",blocks:o.blocks,prizes:o.prizes,buttons:o.buttons,onStart:o.startCallBack,onEnd:o.endCallBack},null,8,["blocks","prizes","buttons","onStart","onEnd"])],64)):Wt("",!0)],64)}var Fe=ge(xe,[["render",Ae],["__scopeId","data-v-336cc3f1"]]);export{Fe as default};
