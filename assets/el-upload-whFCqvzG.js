import{aL as Q,a$ as ue,b0 as de,aB as K,aG as m,aK as G,b1 as k,G as _,af as ke,K as N,b2 as A,n as ce,s as W,o as b,I as U,w as F,F as $e,v as s,a4 as y,b3 as pe,j as S,a5 as h,y as D,Y as O,b4 as Ee,t as L,D as Z,k as q,a6 as Re,b5 as Ce,b6 as Fe,aR as we,b7 as Pe,b8 as Le,L as C,r as Se,b9 as Ue,O as M,R as _e,aa as J,ba as x,aH as ee,bb as Te,a8 as Oe,bc as De,$ as te,bd as Be,ah as je,V as qe,be as Ne,aA as se,M as ae,aF as Ke}from"./index-uqERcsTP.js";import{E as Ae}from"./el-progress-mFEUiRti.js";import{i as Me}from"./isEqual-IpfS1yCm.js";const fe=Symbol("uploadContextKey"),He="ElUpload";class ze extends Error{constructor(r,e,p,u){super(r),this.name="UploadAjaxError",this.status=e,this.method=p,this.url=u}}function oe(o,r,e){let p;return e.response?p=`${e.response.error||e.response}`:e.responseText?p=`${e.responseText}`:p=`fail to ${r.method} ${o} ${e.status}`,new ze(p,e.status,r.method,o)}function Ie(o){const r=o.responseText||o.response;if(!r)return r;try{return JSON.parse(r)}catch{return r}}const Ve=o=>{typeof XMLHttpRequest>"u"&&Q(He,"XMLHttpRequest is undefined");const r=new XMLHttpRequest,e=o.action;r.upload&&r.upload.addEventListener("progress",d=>{const v=d;v.percent=d.total>0?d.loaded/d.total*100:0,o.onProgress(v)});const p=new FormData;if(o.data)for(const[d,v]of Object.entries(o.data))ue(v)&&v.length?p.append(d,...v):p.append(d,v);p.append(o.filename,o.file,o.file.name),r.addEventListener("error",()=>{o.onError(oe(e,o,r))}),r.addEventListener("load",()=>{if(r.status<200||r.status>=300)return o.onError(oe(e,o,r));o.onSuccess(Ie(r))}),r.open(o.method,e,!0),o.withCredentials&&"withCredentials"in r&&(r.withCredentials=!0);const u=o.headers||{};if(u instanceof Headers)u.forEach((d,v)=>r.setRequestHeader(v,d));else for(const[d,v]of Object.entries(u))de(v)||r.setRequestHeader(d,String(v));return r.send(p),r},ve=["text","picture","picture-card"];let Xe=1;const Y=()=>Date.now()+Xe++,me=K({action:{type:String,default:"#"},headers:{type:m(Object)},method:{type:String,default:"post"},data:{type:m([Object,Function,Promise]),default:()=>G({})},multiple:{type:Boolean,default:!1},name:{type:String,default:"file"},drag:{type:Boolean,default:!1},withCredentials:Boolean,showFileList:{type:Boolean,default:!0},accept:{type:String,default:""},fileList:{type:m(Array),default:()=>G([])},autoUpload:{type:Boolean,default:!0},listType:{type:String,values:ve,default:"text"},httpRequest:{type:m(Function),default:Ve},disabled:Boolean,limit:Number}),Ge=K({...me,beforeUpload:{type:m(Function),default:k},beforeRemove:{type:m(Function)},onRemove:{type:m(Function),default:k},onChange:{type:m(Function),default:k},onPreview:{type:m(Function),default:k},onSuccess:{type:m(Function),default:k},onProgress:{type:m(Function),default:k},onError:{type:m(Function),default:k},onExceed:{type:m(Function),default:k},crossorigin:{type:m(String)}}),We=K({files:{type:m(Array),default:()=>G([])},disabled:{type:Boolean,default:!1},handlePreview:{type:m(Function),default:k},listType:{type:String,values:ve,default:"text"},crossorigin:{type:m(String)}}),Je={remove:o=>!!o},Ye=["onKeydown"],Qe=["src","crossorigin"],Ze=["onClick"],xe=["title"],et=["onClick"],tt=["onClick"],st=_({name:"ElUploadList"}),at=_({...st,props:We,emits:Je,setup(o,{emit:r}){const e=o,{t:p}=ke(),u=N("upload"),d=N("icon"),v=N("list"),R=A(),g=ce(!1),$=W(()=>[u.b("list"),u.bm("list",e.listType),u.is("disabled",e.disabled)]),E=f=>{r("remove",f)};return(f,l)=>(b(),U(Ue,{tag:"ul",class:y(s($)),name:s(v).b()},{default:F(()=>[(b(!0),S($e,null,Se(f.files,t=>(b(),S("li",{key:t.uid||t.name,class:y([s(u).be("list","item"),s(u).is(t.status),{focusing:g.value}]),tabindex:"0",onKeydown:pe(i=>!s(R)&&E(t),["delete"]),onFocus:l[0]||(l[0]=i=>g.value=!0),onBlur:l[1]||(l[1]=i=>g.value=!1),onClick:l[2]||(l[2]=i=>g.value=!1)},[C(f.$slots,"default",{file:t},()=>[f.listType==="picture"||t.status!=="uploading"&&f.listType==="picture-card"?(b(),S("img",{key:0,class:y(s(u).be("list","item-thumbnail")),src:t.url,crossorigin:f.crossorigin,alt:""},null,10,Qe)):h("v-if",!0),t.status==="uploading"||f.listType!=="picture-card"?(b(),S("div",{key:1,class:y(s(u).be("list","item-info"))},[q("a",{class:y(s(u).be("list","item-name")),onClick:D(i=>f.handlePreview(t),["prevent"])},[L(s(O),{class:y(s(d).m("document"))},{default:F(()=>[L(s(Ee))]),_:1},8,["class"]),q("span",{class:y(s(u).be("list","item-file-name")),title:t.name},Z(t.name),11,xe)],10,Ze),t.status==="uploading"?(b(),U(s(Ae),{key:0,type:f.listType==="picture-card"?"circle":"line","stroke-width":f.listType==="picture-card"?6:2,percentage:Number(t.percentage),style:Re(f.listType==="picture-card"?"":"margin-top: 0.5rem")},null,8,["type","stroke-width","percentage","style"])):h("v-if",!0)],2)):h("v-if",!0),q("label",{class:y(s(u).be("list","item-status-label"))},[f.listType==="text"?(b(),U(s(O),{key:0,class:y([s(d).m("upload-success"),s(d).m("circle-check")])},{default:F(()=>[L(s(Ce))]),_:1},8,["class"])):["picture-card","picture"].includes(f.listType)?(b(),U(s(O),{key:1,class:y([s(d).m("upload-success"),s(d).m("check")])},{default:F(()=>[L(s(Fe))]),_:1},8,["class"])):h("v-if",!0)],2),s(R)?h("v-if",!0):(b(),U(s(O),{key:2,class:y(s(d).m("close")),onClick:i=>E(t)},{default:F(()=>[L(s(we))]),_:2},1032,["class","onClick"])),h(" Due to close btn only appears when li gets focused disappears after li gets blurred, thus keyboard navigation can never reach close btn"),h(" This is a bug which needs to be fixed "),h(" TODO: Fix the incorrect navigation interaction "),s(R)?h("v-if",!0):(b(),S("i",{key:3,class:y(s(d).m("close-tip"))},Z(s(p)("el.upload.deleteTip")),3)),f.listType==="picture-card"?(b(),S("span",{key:4,class:y(s(u).be("list","item-actions"))},[q("span",{class:y(s(u).be("list","item-preview")),onClick:i=>f.handlePreview(t)},[L(s(O),{class:y(s(d).m("zoom-in"))},{default:F(()=>[L(s(Pe))]),_:1},8,["class"])],10,et),s(R)?h("v-if",!0):(b(),S("span",{key:0,class:y(s(u).be("list","item-delete")),onClick:i=>E(t)},[L(s(O),{class:y(s(d).m("delete"))},{default:F(()=>[L(s(Le))]),_:1},8,["class"])],10,tt))],2)):h("v-if",!0)])],42,Ye))),128)),C(f.$slots,"append")]),_:3},8,["class","name"]))}});var ne=M(at,[["__file","upload-list.vue"]]);const ot=K({disabled:{type:Boolean,default:!1}}),nt={file:o=>ue(o)},lt=["onDrop","onDragover"],ye="ElUploadDrag",rt=_({name:ye}),it=_({...rt,props:ot,emits:nt,setup(o,{emit:r}){const e=_e(fe);e||Q(ye,"usage: <el-upload><el-upload-dragger /></el-upload>");const p=N("upload"),u=ce(!1),d=A(),v=g=>{if(d.value)return;u.value=!1,g.stopPropagation();const $=Array.from(g.dataTransfer.files),E=e.accept.value;if(!E){r("file",$);return}const f=$.filter(l=>{const{type:t,name:i}=l,a=i.includes(".")?`.${i.split(".").pop()}`:"",c=t.replace(/\/.*$/,"");return E.split(",").map(n=>n.trim()).filter(n=>n).some(n=>n.startsWith(".")?a===n:/\/\*$/.test(n)?c===n.replace(/\/\*$/,""):/^[^/]+\/[^/]+$/.test(n)?t===n:!1)});r("file",f)},R=()=>{d.value||(u.value=!0)};return(g,$)=>(b(),S("div",{class:y([s(p).b("dragger"),s(p).is("dragover",u.value)]),onDrop:D(v,["prevent"]),onDragover:D(R,["prevent"]),onDragleave:$[0]||($[0]=D(E=>u.value=!1,["prevent"]))},[C(g.$slots,"default")],42,lt))}});var ut=M(it,[["__file","upload-dragger.vue"]]);const dt=K({...me,beforeUpload:{type:m(Function),default:k},onRemove:{type:m(Function),default:k},onStart:{type:m(Function),default:k},onSuccess:{type:m(Function),default:k},onProgress:{type:m(Function),default:k},onError:{type:m(Function),default:k},onExceed:{type:m(Function),default:k}}),ct=["onKeydown"],pt=["name","multiple","accept"],ft=_({name:"ElUploadContent",inheritAttrs:!1}),vt=_({...ft,props:dt,setup(o,{expose:r}){const e=o,p=N("upload"),u=A(),d=J({}),v=J(),R=a=>{if(a.length===0)return;const{autoUpload:c,limit:n,fileList:w,multiple:P,onStart:B,onExceed:H}=e;if(n&&w.length+a.length>n){H(a,w);return}P||(a=a.slice(0,1));for(const z of a){const j=z;j.uid=Y(),B(j),c&&g(j)}},g=async a=>{if(v.value.value="",!e.beforeUpload)return E(a);let c,n={};try{const P=e.data,B=e.beforeUpload(a);n=x(e.data)?ee(e.data):e.data,c=await B,x(e.data)&&Me(P,n)&&(n=ee(e.data))}catch{c=!1}if(c===!1){e.onRemove(a);return}let w=a;c instanceof Blob&&(c instanceof File?w=c:w=new File([c],a.name,{type:a.type})),E(Object.assign(w,{uid:a.uid}),n)},$=async(a,c)=>Oe(a)?a(c):a,E=async(a,c)=>{const{headers:n,data:w,method:P,withCredentials:B,name:H,action:z,onProgress:j,onSuccess:ge,onError:be,httpRequest:he}=e;try{c=await $(c??w,a)}catch{e.onRemove(a);return}const{uid:I}=a,V={headers:n||{},withCredentials:B,file:a,data:c,method:P,filename:H,action:z,onProgress:T=>{j(T,a)},onSuccess:T=>{ge(T,a),delete d.value[I]},onError:T=>{be(T,a),delete d.value[I]}},X=he(V);d.value[I]=X,X instanceof Promise&&X.then(V.onSuccess,V.onError)},f=a=>{const c=a.target.files;c&&R(Array.from(c))},l=()=>{u.value||(v.value.value="",v.value.click())},t=()=>{l()};return r({abort:a=>{Te(d.value).filter(a?([n])=>String(a.uid)===n:()=>!0).forEach(([n,w])=>{w instanceof XMLHttpRequest&&w.abort(),delete d.value[n]})},upload:g}),(a,c)=>(b(),S("div",{class:y([s(p).b(),s(p).m(a.listType),s(p).is("drag",a.drag)]),tabindex:"0",onClick:l,onKeydown:pe(D(t,["self"]),["enter","space"])},[a.drag?(b(),U(ut,{key:0,disabled:s(u),onFile:R},{default:F(()=>[C(a.$slots,"default")]),_:3},8,["disabled"])):C(a.$slots,"default",{key:1}),q("input",{ref_key:"inputRef",ref:v,class:y(s(p).e("input")),name:a.name,multiple:a.multiple,accept:a.accept,type:"file",onChange:f,onClick:c[0]||(c[0]=D(()=>{},["stop"]))},null,42,pt)],42,ct))}});var le=M(vt,[["__file","upload-content.vue"]]);const re="ElUpload",ie=o=>{var r;(r=o.url)!=null&&r.startsWith("blob:")&&URL.revokeObjectURL(o.url)},mt=(o,r)=>{const e=De(o,"fileList",void 0,{passive:!0}),p=l=>e.value.find(t=>t.uid===l.uid);function u(l){var t;(t=r.value)==null||t.abort(l)}function d(l=["ready","uploading","success","fail"]){e.value=e.value.filter(t=>!l.includes(t.status))}const v=(l,t)=>{const i=p(t);i&&(console.error(l),i.status="fail",e.value.splice(e.value.indexOf(i),1),o.onError(l,i,e.value),o.onChange(i,e.value))},R=(l,t)=>{const i=p(t);i&&(o.onProgress(l,i,e.value),i.status="uploading",i.percentage=Math.round(l.percent))},g=(l,t)=>{const i=p(t);i&&(i.status="success",i.response=l,o.onSuccess(l,i,e.value),o.onChange(i,e.value))},$=l=>{de(l.uid)&&(l.uid=Y());const t={name:l.name,percentage:0,status:"ready",size:l.size,raw:l,uid:l.uid};if(o.listType==="picture-card"||o.listType==="picture")try{t.url=URL.createObjectURL(l)}catch(i){Be(re,i.message),o.onError(i,t,e.value)}e.value=[...e.value,t],o.onChange(t,e.value)},E=async l=>{const t=l instanceof File?p(l):l;t||Q(re,"file to be removed not found");const i=a=>{u(a);const c=e.value;c.splice(c.indexOf(a),1),o.onRemove(a,c),ie(a)};o.beforeRemove?await o.beforeRemove(t,e.value)!==!1&&i(t):i(t)};function f(){e.value.filter(({status:l})=>l==="ready").forEach(({raw:l})=>{var t;return l&&((t=r.value)==null?void 0:t.upload(l))})}return te(()=>o.listType,l=>{l!=="picture-card"&&l!=="picture"||(e.value=e.value.map(t=>{const{raw:i,url:a}=t;if(!a&&i)try{t.url=URL.createObjectURL(i)}catch(c){o.onError(c,t,e.value)}return t}))}),te(e,l=>{for(const t of l)t.uid||(t.uid=Y()),t.status||(t.status="success")},{immediate:!0,deep:!0}),{uploadFiles:e,abort:u,clearFiles:d,handleError:v,handleProgress:R,handleStart:$,handleSuccess:g,handleRemove:E,submit:f,revokeFileObjectURL:ie}},yt=_({name:"ElUpload"}),gt=_({...yt,props:Ge,setup(o,{expose:r}){const e=o,p=A(),u=J(),{abort:d,submit:v,clearFiles:R,uploadFiles:g,handleStart:$,handleError:E,handleRemove:f,handleSuccess:l,handleProgress:t,revokeFileObjectURL:i}=mt(e,u),a=W(()=>e.listType==="picture-card"),c=W(()=>({...e,fileList:g.value,onStart:$,onProgress:t,onSuccess:l,onError:E,onRemove:f}));return je(()=>{g.value.forEach(i)}),qe(fe,{accept:Ne(e,"accept")}),r({abort:d,submit:v,clearFiles:R,handleStart:$,handleRemove:f}),(n,w)=>(b(),S("div",null,[s(a)&&n.showFileList?(b(),U(ne,{key:0,disabled:s(p),"list-type":n.listType,files:s(g),crossorigin:n.crossorigin,"handle-preview":n.onPreview,onRemove:s(f)},se({append:F(()=>[L(le,ae({ref_key:"uploadRef",ref:u},s(c)),{default:F(()=>[n.$slots.trigger?C(n.$slots,"trigger",{key:0}):h("v-if",!0),!n.$slots.trigger&&n.$slots.default?C(n.$slots,"default",{key:1}):h("v-if",!0)]),_:3},16)]),_:2},[n.$slots.file?{name:"default",fn:F(({file:P})=>[C(n.$slots,"file",{file:P})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):h("v-if",!0),!s(a)||s(a)&&!n.showFileList?(b(),U(le,ae({key:1,ref_key:"uploadRef",ref:u},s(c)),{default:F(()=>[n.$slots.trigger?C(n.$slots,"trigger",{key:0}):h("v-if",!0),!n.$slots.trigger&&n.$slots.default?C(n.$slots,"default",{key:1}):h("v-if",!0)]),_:3},16)):h("v-if",!0),n.$slots.trigger?C(n.$slots,"default",{key:2}):h("v-if",!0),C(n.$slots,"tip"),!s(a)&&n.showFileList?(b(),U(ne,{key:3,disabled:s(p),"list-type":n.listType,files:s(g),crossorigin:n.crossorigin,"handle-preview":n.onPreview,onRemove:s(f)},se({_:2},[n.$slots.file?{name:"default",fn:F(({file:P})=>[C(n.$slots,"file",{file:P})])}:void 0]),1032,["disabled","list-type","files","crossorigin","handle-preview","onRemove"])):h("v-if",!0)]))}});var bt=M(gt,[["__file","upload.vue"]]);const Et=Ke(bt);export{Et as E};
