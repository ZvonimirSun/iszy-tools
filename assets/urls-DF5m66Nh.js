import{h as q,aR as G,_ as X,k as S,u as J,n as O,E as k,r as m,q as x,G as U,s as I,w as i,y as Q,x as n,aN as Z,v as L,z as ee,R as $,a4 as Y,T as te,aa as ae,a7 as le,aW as c,aA as p,F as z,ai as se,K as s,W as re,N as y,L as oe,H as M,Y as V,X as N,a0 as ne}from"./index-Bxv9mi5k.js";import{v as ie}from"./el-loading-B5hM4C-O.js";import{E as de}from"./el-pagination-4cqDVx28.js";/* empty css               */import"./el-select-BgbSXFMd.js";import"./el-popper-D9N6o6tY.js";import{E as ue,a as pe}from"./el-table-column-CU_Sn0XQ.js";import"./el-checkbox-mq9b-K6M.js";import"./el-tooltip-l0sNRNKZ.js";import{E as me}from"./el-popover-DEER6qat.js";import{d as P}from"./dayjs.min-CcbPpEag.js";import"./Router-DiIORSmQ.js";import"./index-CCD87bMe.js";import"./strings-8EdSUSAh.js";import"./castArray-CnwU0dPU.js";import"./_baseIteratee---A0hcr9.js";import"./index-MprSRxLQ.js";import"./index-DiWVgKd_.js";import"./isUndefined-DCTLXrZ8.js";import"./map-CfHEC4R1.js";import"./_baseEach-B5tQ39C4.js";import"./raf-C7cd4oHy.js";const fe=q({type:{type:String,values:["primary","success","warning","info","danger","default"],default:"default"},underline:{type:Boolean,default:!0},disabled:Boolean,href:{type:String,default:""},target:{type:String,default:"_self"},icon:{type:G}}),ce={click:E=>E instanceof MouseEvent},ye=S({name:"ElLink"}),ke=S({...ye,props:fe,emits:ce,setup(E,{emit:h}){const r=E,o=J("link"),C=O(()=>[o.b(),o.m(r.type),o.is("disabled",r.disabled),o.is("underline",r.underline&&!r.disabled)]);function v(l){r.disabled||h("click",l)}return(l,g)=>(m(),k("a",{class:L(n(C)),href:l.disabled||!l.href?void 0:l.href,target:l.disabled||!l.href?void 0:l.target,onClick:v},[l.icon?(m(),x(n(Z),{key:0},{default:i(()=>[(m(),x(Q(l.icon)))]),_:1})):U("v-if",!0),l.$slots.default?(m(),k("span",{key:1,class:L(n(o).e("inner"))},[I(l.$slots,"default")],2)):U("v-if",!0),l.$slots.icon?I(l.$slots,"icon",{key:2}):U("v-if",!0)],10,["href","target"]))}});var ge=X(ke,[["__file","link.vue"]]);const ve=ee(ge),we={"h-full":"",flex:"","flex-col":"","gap-4":""},_e={class:"new-url-form"},be="https://url.iszy.xyz",$e=S({__name:"urls",setup(E){const h=$([]),r=$(10),o=$(1),C=$(0),v=$(!1),l=Y({}),g=Y({}),f=Y({keyword:"",url:""});te(()=>{w(o.value-1,r.value)}),ae(()=>{w(o.value-1,r.value)}),le(r,()=>{o.value=1});async function w(a,e){const _=setTimeout(()=>{v.value=!0},300);try{const u=(await c.get(`${c.$apiBase}/urls/admin/urls`,{params:{pageIndex:a,pageSize:e}})).data;u.success?(C.value=u.data.count,h.value=u.data.rows.map(d=>(d.createdAt=P(d.createdAt).format("YYYY年MM月DD日 HH:mm"),d.updatedAt=P(d.updatedAt).format("YYYY年MM月DD日 HH:mm"),d))):p.error(u.message)}catch(u){p.error(u.message)}clearTimeout(_),v.value=!1}async function T(){if(f.url)try{const a=(await c.post(`${c.$apiBase}/urls/admin/url`,{url:f.url,keyword:f.keyword})).data;a.success?(p.success("创建成功"),f.url="",f.keyword="",await w(o.value-1,r.value)):p.error(a.message)}catch(a){p.error(a.message)}}async function A(a){try{const e=(await c.put(`${c.$apiBase}/urls/admin/url/${a.keyword}`,{url:g[a.keyword]})).data;e.success?(p.success("更新成功"),a.url=g[a.keyword],l[a.keyword]=!1,await w(o.value-1,r.value)):p.error(e.message)}catch(e){p.error(e.message)}}async function H(a){try{const e=(await c.delete(`${c.$apiBase}/urls/admin/url/${a.keyword}`,{params:{keyword:a.keyword}})).data;e.success?(await w(o.value-1,r.value),p.success("删除成功")):p.error(e.message)}catch(e){p.error(e.message)}}function D(a){l[a.keyword]=!l[a.keyword],l[a.keyword]&&(g[a.keyword]=a.url)}function R(a){return(o.value-1)*r.value+a+1}return(a,e)=>{const _=re,u=oe,d=ue,B=ve,F=me,K=pe,W=de,j=ie;return m(),k("div",we,[z("div",_e,[e[5]||(e[5]=z("span",null," 输入链接: ",-1)),s(_,{modelValue:n(f).url,"onUpdate:modelValue":e[0]||(e[0]=t=>n(f).url=t),placeholder:"https",clearable:"","flex-1":""},null,8,["modelValue"]),e[6]||(e[6]=z("span",null," 自定义短网址(选): ",-1)),s(_,{modelValue:n(f).keyword,"onUpdate:modelValue":e[1]||(e[1]=t=>n(f).keyword=t),clearable:""},null,8,["modelValue"]),s(u,{type:"primary",onClick:T},{default:i(()=>e[4]||(e[4]=[y(" 缩短 ")])),_:1})]),se((m(),x(K,{data:n(h),border:!0,stripe:!0,size:"small","flex-1":""},{default:i(()=>[s(d,{type:"index",index:R,fixed:"left"}),s(d,{prop:"keyword",label:"短网址",width:"100",fixed:"left"},{default:i(({row:t})=>[s(B,{href:`${be}/${t.keyword}`,target:"_blank",style:{"white-space":"nowrap"}},{default:i(()=>[y(M(t.keyword),1)]),_:2},1032,["href"])]),_:1}),s(d,{prop:"url",label:"原网址","min-width":"300"},{default:i(({row:t})=>[n(l)[t.keyword]?(m(),x(_,{key:1,modelValue:n(g)[t.keyword],"onUpdate:modelValue":b=>n(g)[t.keyword]=b},null,8,["modelValue","onUpdate:modelValue"])):(m(),k(V,{key:0},[t.title?(m(),k(V,{key:0},[s(B,{href:t.url,target:"_blank"},{default:i(()=>[y(M(t.title),1)]),_:2},1032,["href"]),e[7]||(e[7]=z("br",null,null,-1))],64)):U("",!0),s(B,{href:t.url,target:"_blank"},{default:i(()=>[y(M(t.url),1)]),_:2},1032,["href"])],64))]),_:1}),s(d,{prop:"createdAt",label:"日期",width:"180"}),s(d,{prop:"ip",label:"IP",width:"130"}),s(d,{prop:"clicks",label:"点击次数",width:"80"}),s(d,{label:"操作",width:"140",fixed:"right"},{default:i(({row:t})=>[n(l)[t.keyword]?(m(),k(V,{key:1},[s(u,{size:"small",onClick:b=>D(t)},{default:i(()=>e[10]||(e[10]=[y(" 取消 ")])),_:2},1032,["onClick"]),s(u,{size:"small",type:"primary",onClick:b=>A(t)},{default:i(()=>e[11]||(e[11]=[y(" 更新 ")])),_:2},1032,["onClick"])],64)):(m(),k(V,{key:0},[s(u,{size:"small",onClick:b=>D(t)},{default:i(()=>e[8]||(e[8]=[y(" 编辑 ")])),_:2},1032,["onClick"]),s(F,{width:"160",title:"删除后无法恢复！","confirm-button-type":"danger","confirm-button-text":"删除",onConfirm:b=>H(t)},{reference:i(()=>[s(u,{size:"small",type:"danger"},{default:i(()=>e[9]||(e[9]=[y(" 删除 ")])),_:1})]),_:2},1032,["onConfirm"])],64))]),_:1})]),_:1},8,["data"])),[[j,n(v)]]),s(W,{"current-page":n(o),"onUpdate:currentPage":e[2]||(e[2]=t=>N(o)?o.value=t:null),"page-size":n(r),"onUpdate:pageSize":e[3]||(e[3]=t=>N(r)?r.value=t:null),small:"",background:"",layout:"prev, pager, next",total:n(C)},null,8,["current-page","page-size","total"])])}}}),We=ne($e,[["__scopeId","data-v-f2928ba1"]]);export{We as default};
