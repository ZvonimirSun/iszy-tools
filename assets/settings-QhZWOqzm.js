import{G as D,f as $,a_ as H,s as z,v as o,L as ee,M as te,a5 as U,d as oe,dn as le,cz as ae,u as se,n as B,H as M,o as _,j as y,t as e,w as t,A as n,k as u,D as x,I as P,F as j,J as N,E as ne,z as re,p as de,l as ie,h as ue}from"./index-bhorRYI3.js";import{E as pe}from"./el-checkbox-tDHm_kqw.js";import{E as me,a as fe}from"./el-radio-group-lOoAMGo4.js";/* empty css                 */import{E as ce}from"./el-divider-Ozwd1N_S.js";import{E as _e}from"./el-space-tIpqN85c.js";import{E as we}from"./el-popover-3ia0FYBF.js";import"./el-popper-L4mGt41k.js";import{a as ge,E as he}from"./el-form-item-7n6SYwOs.js";import{u as ve}from"./Router-J4VqWyom.js";import"./index-7ErNgVHw.js";import{_ as ke}from"./Title-afamLJql.js";import"./isEqual-Gv3C3bbv.js";import"./hasIn-ApIfS2De.js";import"./isUndefined-IZwZ21d-.js";import"./castArray-1n_4zd2Z.js";const Ve=D({inheritAttrs:!1,__name:"HaveAccess",props:{auth:{type:[Boolean,Object],default:!1},link:{default:""}},setup(p){const m=$(),C=ve(),E=H(),d=p,g=z(()=>d.auth?typeof d.auth=="boolean"?m.logged:m.checkAccess(d.auth):d.link?m.checkAccess(C.getAuth(d.link)):!0);function i(){d.link&&E.push(d.link)}return(c,S)=>o(g)?ee(c.$slots,"default",te({key:0},c.$attrs,{goto:i})):U("",!0)}}),ye=oe("main",{persist:!0,state:()=>({_cache:{},clearOfflineCacheTag:!1}),getters:{getData:p=>m=>{if(m)return(p._cache||{})[m]}},actions:{setData({key:p,val:m}={}){p&&(this._cache=this._cache||{},this._cache[p]=m)},clear(){this._cache={}},clearOfflineCache(){console.log("clearOfflineCache"),this.clearOfflineCacheTag=!0}}}),I=p=>(de("data-v-550be378"),p=p(),ie(),p),Ce={key:0,flex:"","flex-col":"","text-7":"","gap-4":"","items-start":""},Ee={flex:""},Se=I(()=>u("div",{"w-32":""}," 昵称: ",-1)),be={flex:""},xe=I(()=>u("div",{"w-32":""}," 邮箱: ",-1)),Pe={flex:""},Ne=I(()=>u("div",{"w-32":""}," 角色 ",-1)),Ue={flex:"","gap-4":""},Ie={flex:"","text-7":"","gap-4":"","items-start":"","flex-wrap":"",class:"settings-container"},Oe={class:"settings-wrapper"},Te={key:0,class:"settings-wrapper"},Ae=D({__name:"settings",setup(p){const m=H(),C=le(),E=ae(),d=$(),g=se(),i=z(()=>g.general),c=B(!1),S=B(),a=M({nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),G=M({rePasswd:[{validator:(h,l,r)=>{l&&l!==a.passwd?r(new Error("两次输入的密码不一致")):r()}}],oldPasswd:[{validator:(h,l,r)=>{!l&&(a.passwd||a.rePasswd)?r(new Error("请输入旧密码")):r()}}]}),O=()=>ye().clearOfflineCache();function J(){m.push({path:"/login",query:{redirect:C.fullPath}})}function q(){m.push("/logout")}function L(){a.nickName=d.profile.nickName??"",a.email=d.profile.email??"",a.passwd="",a.rePasswd="",a.oldPasswd="",c.value=!0}function K(){c.value=!1}async function Q(h){h&&await h.validate(async l=>{if(l){const r={};if(a.nickName&&(r.nickName=a.nickName),a.email&&(r.email=a.email),a.passwd&&(r.passwd=a.passwd,r.oldPasswd=a.oldPasswd),Object.keys(r).length===0){N.warning("没有需要修改的信息");return}try{await d.updateUser(r)}catch(f){N.error(f.message)}c.value=!1}else return N.warning("请检查输入"),!1})}return(h,l)=>{var A,R,F;const r=ke,f=ne,W=Ve,v=re,k=ge,X=he,T=we,V=_e,Y=ce,b=me,Z=fe,w=pe;return _(),y(j,null,[e(r,{level:3},{default:t(()=>[n(" 账户信息 ")]),_:1}),o(d).logged?(_(),y("div",Ce,[u("div",Ee,[Se,u("div",null,x(o(d).profile.nickName),1)]),u("div",be,[xe,u("div",null,x(o(d).profile.email),1)]),u("div",Pe,[Ne,u("div",null,x(((F=(R=(A=o(d).profile)==null?void 0:A.roles)==null?void 0:R[0])==null?void 0:F.alias)??"普通用户"),1)]),u("div",Ue,[e(f,{type:"primary",onClick:q},{default:t(()=>[n(" 登出 ")]),_:1}),e(W,{link:"/userManager"},{default:t(({goto:s})=>[e(f,{type:"primary",onClick:s},{default:t(()=>[n(" 用户权限中心 ")]),_:2},1032,["onClick"])]),_:1}),o(c)?(_(),y(j,{key:1},[e(f,{type:"primary",onClick:l[0]||(l[0]=s=>Q(o(S)))},{default:t(()=>[n(" 保存 ")]),_:1}),e(f,{onClick:K},{default:t(()=>[n(" 取消 ")]),_:1})],64)):(_(),P(f,{key:0,onClick:L},{default:t(()=>[n(" 修改信息 ")]),_:1}))]),o(c)?(_(),P(X,{key:0,ref_key:"ruleFormRef",ref:S,model:o(a),rules:o(G),"label-width":"8rem","label-position":"left"},{default:t(()=>[e(k,{label:"昵称",prop:"nickName"},{default:t(()=>[e(v,{modelValue:o(a).nickName,"onUpdate:modelValue":l[1]||(l[1]=s=>o(a).nickName=s)},null,8,["modelValue"])]),_:1}),e(k,{label:"邮箱",prop:"email"},{default:t(()=>[e(v,{modelValue:o(a).email,"onUpdate:modelValue":l[2]||(l[2]=s=>o(a).email=s)},null,8,["modelValue"])]),_:1}),e(k,{label:"旧密码",prop:"oldPasswd"},{default:t(()=>[e(v,{modelValue:o(a).oldPasswd,"onUpdate:modelValue":l[3]||(l[3]=s=>o(a).oldPasswd=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(k,{label:"新密码",prop:"passwd"},{default:t(()=>[e(v,{modelValue:o(a).passwd,"onUpdate:modelValue":l[4]||(l[4]=s=>o(a).passwd=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(k,{label:"确认密码",prop:"rePasswd"},{default:t(()=>[e(v,{modelValue:o(a).rePasswd,"onUpdate:modelValue":l[5]||(l[5]=s=>o(a).rePasswd=s),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])):U("",!0),e(T,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:O},{reference:t(()=>[e(f,{type:"danger",plain:""},{default:t(()=>[n(" 清空本地缓存 ")]),_:1})]),_:1})])):(_(),P(V,{key:1},{default:t(()=>[e(f,{type:"primary",onClick:J},{default:t(()=>[n(" 登录 ")]),_:1}),e(T,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:O},{reference:t(()=>[e(f,{type:"danger",plain:""},{default:t(()=>[n(" 清空本地缓存 ")]),_:1})]),_:1})]),_:1})),e(Y),u("div",Ie,[u("div",Oe,[e(r,{level:4},{default:t(()=>[n(" 全局设置 ")]),_:1}),e(r,{level:5},{default:t(()=>[n(" 外观 ")]),_:1}),e(V,null,{default:t(()=>[e(Z,{"model-value":o(i).theme.mode,onChange:o(E).setTheme},{default:t(()=>[e(b,{label:"auto"},{default:t(()=>[n(" 跟随系统 ")]),_:1}),e(b,{label:"light"},{default:t(()=>[n(" 浅色 ")]),_:1}),e(b,{label:"dark"},{default:t(()=>[n(" 深色 ")]),_:1})]),_:1},8,["model-value","onChange"])]),_:1}),e(r,{level:5},{default:t(()=>[n(" 访问统计 ")]),_:1}),e(V,null,{default:t(()=>[e(w,{modelValue:o(i).showMost,"onUpdate:modelValue":l[6]||(l[6]=s=>o(i).showMost=s)},{default:t(()=>[n(" 最常访问 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(i).showRecent,"onUpdate:modelValue":l[7]||(l[7]=s=>o(i).showRecent=s)},{default:t(()=>[n(" 最近访问 ")]),_:1},8,["modelValue"])]),_:1}),e(r,{level:5},{default:t(()=>[n(" 其他设置 ")]),_:1}),e(V,null,{default:t(()=>[e(w,{modelValue:o(i).showSearch,"onUpdate:modelValue":l[8]||(l[8]=s=>o(i).showSearch=s)},{default:t(()=>[n(" 显示搜索 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(i).showType,"onUpdate:modelValue":l[9]||(l[9]=s=>o(i).showType=s)},{default:t(()=>[n(" 显示分类 ")]),_:1},8,["modelValue"]),e(w,{modelValue:o(i).openInNewTab,"onUpdate:modelValue":l[10]||(l[10]=s=>o(i).openInNewTab=s)},{default:t(()=>[n(" 新标签页打开工具 ")]),_:1},8,["modelValue"])]),_:1})]),o(d).logged?(_(),y("div",Te,[e(r,{level:4},{default:t(()=>[n(" 应用设置 ")]),_:1}),e(r,{level:5},{default:t(()=>[n(" JSON 编辑器 ")]),_:1}),e(V,null,{default:t(()=>[e(w,{modelValue:o(g).modules.jsonEditor.syncCloud,"onUpdate:modelValue":l[11]||(l[11]=s=>o(g).modules.jsonEditor.syncCloud=s)},{default:t(()=>[n(" 从云端获取 ")]),_:1},8,["modelValue"])]),_:1})])):U("",!0)])],64)}}}),Xe=ue(Ae,[["__scopeId","data-v-550be378"]]);export{Xe as default};
