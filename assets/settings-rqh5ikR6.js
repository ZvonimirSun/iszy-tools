import{k as S,Q as H,aw as $,E as C,r as b,q as A,G as U,x as l,w as s,N as u,K as t,F as d,a0 as h,J as q,n as Q,s as W,aB as X,R as F,a4 as L,H as P,v as Y,$ as Z,L as J,X as ee,W as te,aA as x,ax as j,P as oe,at as le,Y as se,bl as ne}from"./index-CwKDEmrf.js";import{E as z}from"./el-divider-B5h2HHkU.js";import{E as M}from"./el-space-BTDgPr_5.js";import{E as K}from"./el-checkbox-CcRX5BUu.js";import{T as I,u as ae}from"./Router-2vtoQPXu.js";import{E as re}from"./el-popover-3y593W46.js";import"./el-popper-BsStjEin.js";import{E as ie}from"./el-dialog-CTKlJh_s.js";import{a as de,E as ue}from"./el-form-item-BwOWyd__.js";import{E as pe,a as me}from"./el-radio-group-DZUdk_po.js";/* empty css                 */import"./index-Dk0MDWYH.js";import"./isUndefined-DCTLXrZ8.js";import"./castArray-B30xlL8p.js";import"./clone-DQ1o0krA.js";const fe=S({__name:"jsonEditor",setup(v){const n=H(),p=$(),i=n.modules.jsonEditor;return(a,o)=>{const _=I,y=K,N=M;return b(),C("div",null,[l(p).logged?(b(),A(_,{key:0,level:5},{default:s(()=>o[1]||(o[1]=[u(" JSON 编辑器 ")])),_:1})):U("",!0),l(p).logged?(b(),A(N,{key:1},{default:s(()=>[t(y,{modelValue:l(i).syncCloud,"onUpdate:modelValue":o[0]||(o[0]=m=>l(i).syncCloud=m)},{default:s(()=>o[2]||(o[2]=[u(" 从云端获取 ")])),_:1},8,["modelValue"])]),_:1})):U("",!0)])}}}),_e={"w-full":"","overflow-auto":""},ce={"gap-4":"",class:"settings-wrapper"},ge=S({__name:"toolSettings",setup(v){return(n,p)=>{const i=I;return b(),C("div",_e,[t(i,{level:4},{default:s(()=>p[0]||(p[0]=[u(" 应用设置 ")])),_:1}),d("div",ce,[t(fe)])])}}}),we=h(ge,[["__scopeId","data-v-730637d2"]]),ve=S({inheritAttrs:!1,__name:"HaveAccess",props:{auth:{type:[Boolean,Object],default:!1},link:{default:""}},setup(v){const n=v,p=$(),i=ae(),a=q(),o=Q(()=>n.auth?typeof n.auth=="boolean"?p.logged:p.checkAccess(n.auth):n.link?p.checkAccess(i.getAuth(n.link)):!0);function _(){n.link&&a.push(n.link)}return(y,N)=>l(o)?W(y.$slots,"default",X({key:0},y.$attrs,{goto:_})):U("",!0)}}),ye={flex:"","flex-col":"","items-start":"","gap-4":"","text-7":""},ke={flex:"","items-center":"","gap-4":""},Ve={flex:"","items-center":"","gap-4":""},be={flex:"","items-center":"","gap-4":""},xe={flex:"","items-center":"","gap-4":""},Ne={flex:"","items-center":"","gap-4":""},Ee={flex:"","items-center":"","gap-2":""},Ce={class:"dialog-footer"},Se=S({__name:"personalInfo",setup(v){const n=$(),p=F(!1),i=F(),a=L({userName:"",nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),o=L({userName:[{trigger:"change",validator:(f,e,r)=>{e&&!e.trim()?r(new Error("用户名无效")):r()}}],nickName:[{trigger:"change",validator:(f,e,r)=>{e&&!e.trim()?r(new Error("昵称无效")):r()}}],rePasswd:[{trigger:"change",validator:(f,e,r)=>{e&&e!==a.passwd?r(new Error("两次输入的密码不一致")):r()}}]}),_=F("");function y(){a.userName=n.profile.userName??"",a.nickName=n.profile.nickName??"",a.email=n.profile.email??"",a.passwd="",a.rePasswd="",a.oldPasswd="",p.value=!0}function N(){p.value=!1}async function m(f){f&&await f.validate(async e=>{if(e){const r={};if(a.userName&&(r.userName=a.userName),a.nickName&&(r.nickName=a.nickName),a.email&&(r.email=a.email),a.passwd&&(r.passwd=a.passwd,a.oldPasswd&&(r.oldPasswd=a.oldPasswd)),Object.keys(r).length===0){x.warning("没有需要修改的信息");return}try{await n.updateUser(r)}catch(k){x.error(k.message)}p.value=!1}else x.warning("请检查输入")})}async function g(f,e){if(e){const r=new URL(`${j.apiBaseUrl}/auth/${f}/bind`);r.searchParams.append("access_token",n.access_token),T(f,r.toString())}else try{await n.thirdPartyUnbind(f),x.success("解绑成功")}catch(r){x.error(r.message)}}async function w(f){var r,k;const e=f.source;if(f.origin===j.apiBaseUrl)if(((r=f.data)==null?void 0:r.type)==="bind_success"){window.removeEventListener("message",w),e.close();try{await n.thirdPartyBind(_.value,f.data.data),x.success("绑定成功")}catch(V){x.error(V.message)}finally{_.value=""}}else((k=f.data)==null?void 0:k.type)==="bind_fail"&&(window.removeEventListener("message",w),e.close(),_.value="",x.error("绑定失败"))}function T(f,e,r="绑定第三方登录",k=500,V=600){if(_.value){x.warning("绑定进行中，请勿重复点击");return}_.value=f,window.addEventListener("message",w);const E=(window.screen.height-k)/2,O=(window.screen.width-V)/2,B=window.open(e,r,`popup,width=${k},height=${V},top=${E},left=${O}`);if(!B){_.value="",x.error("请允许浏览器弹出窗口！");return}const R=window.setInterval(()=>{B.closed&&(window.clearInterval(R),_.value="")},500)}return(f,e)=>{var R,D,G;const r=I,k=J,V=te,E=ue,O=de,B=ie;return b(),C("div",null,[t(r,{level:4},{default:s(()=>e[10]||(e[10]=[u(" 账户信息 ")])),_:1}),d("div",ye,[d("div",ke,[e[11]||(e[11]=d("div",{"w-32":"","text-right":""}," 用户名: ",-1)),d("div",null,P(l(n).profile.userName),1)]),d("div",Ve,[e[12]||(e[12]=d("div",{"w-32":"","text-right":""}," 昵称: ",-1)),d("div",null,P(l(n).profile.nickName),1)]),d("div",be,[e[13]||(e[13]=d("div",{"w-32":"","text-right":""}," 邮箱: ",-1)),d("div",null,P(l(n).profile.email),1)]),d("div",xe,[e[14]||(e[14]=d("div",{"w-32":"","text-right":""}," 角色: ",-1)),d("div",null,P(((G=(D=(R=l(n).profile)==null?void 0:R.roles)==null?void 0:D[0])==null?void 0:G.alias)??"注册用户"),1)]),d("div",Ne,[e[17]||(e[17]=d("div",{"w-32":"","text-right":""}," 绑定: ",-1)),d("div",Ee,[d("div",{class:Y(["third-party",{active:l(n).profile.github}]),title:"Github",onClick:e[1]||(e[1]=c=>g("github",!l(n).profile.github))},[e[16]||(e[16]=d("i",{class:"i-icon-park-outline:github"},null,-1)),l(n).profile.github?(b(),C("div",{key:0,class:"unbind-btn",onClick:e[0]||(e[0]=Z(c=>g("github",!1),["stop"]))},e[15]||(e[15]=[d("i",{class:"i-icon-park-solid:close-one"},null,-1)]))):U("",!0)],2)])]),t(k,{onClick:y},{default:s(()=>e[18]||(e[18]=[u(" 修改信息 ")])),_:1})]),t(B,{modelValue:l(p),"onUpdate:modelValue":e[9]||(e[9]=c=>ee(p)?p.value=c:null),title:"修改信息","before-close":N},{footer:s(()=>[d("span",Ce,[t(k,{onClick:N},{default:s(()=>e[19]||(e[19]=[u("取消")])),_:1}),t(k,{type:"primary",onClick:e[8]||(e[8]=c=>m(l(i)))},{default:s(()=>e[20]||(e[20]=[u(" 保存 ")])),_:1})])]),default:s(()=>[t(O,{ref_key:"ruleFormRef",ref:i,model:l(a),rules:l(o),"label-width":"8rem","label-position":"left"},{default:s(()=>[t(E,{label:"用户名",prop:"userName"},{default:s(()=>[t(V,{modelValue:l(a).userName,"onUpdate:modelValue":e[2]||(e[2]=c=>l(a).userName=c)},null,8,["modelValue"])]),_:1}),t(E,{label:"昵称",prop:"nickName"},{default:s(()=>[t(V,{modelValue:l(a).nickName,"onUpdate:modelValue":e[3]||(e[3]=c=>l(a).nickName=c)},null,8,["modelValue"])]),_:1}),t(E,{label:"邮箱",prop:"email"},{default:s(()=>[t(V,{modelValue:l(a).email,"onUpdate:modelValue":e[4]||(e[4]=c=>l(a).email=c)},null,8,["modelValue"])]),_:1}),t(E,{label:"旧密码",prop:"oldPasswd"},{default:s(()=>[t(V,{modelValue:l(a).oldPasswd,"onUpdate:modelValue":e[5]||(e[5]=c=>l(a).oldPasswd=c),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(E,{label:"新密码",prop:"passwd"},{default:s(()=>[t(V,{modelValue:l(a).passwd,"onUpdate:modelValue":e[6]||(e[6]=c=>l(a).passwd=c),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(E,{label:"确认密码",prop:"rePasswd"},{default:s(()=>[t(V,{modelValue:l(a).rePasswd,"onUpdate:modelValue":e[7]||(e[7]=c=>l(a).rePasswd=c),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])}}}),Pe=h(Se,[["__scopeId","data-v-c1890d18"]]),Ue=oe("main",{persist:!0,state:()=>({_cache:{},clearOfflineCacheTag:!1}),getters:{getData:v=>n=>{if(n)return(v._cache||{})[n]}},actions:{setData({key:v,val:n}={}){v&&(this._cache=this._cache||{},this._cache[v]=n)},clear(){this._cache={}},clearOfflineCache(){console.log("clearOfflineCache"),this.clearOfflineCacheTag=!0}}}),$e={flex:"","items-center":"","gap-4":""},he=S({__name:"authInfo",setup(v){const n=q(),p=le(),i=$(),a=()=>Ue().clearOfflineCache();function o(){n.push({path:"/login",query:{redirect:p.fullPath}})}function _(){n.push("/register")}function y(){n.push("/logout")}return(N,m)=>{const g=J,w=ve,T=re,f=z,e=M;return l(i).logged?(b(),C(se,{key:0},[d("div",$e,[t(g,{type:"primary",onClick:y},{default:s(()=>m[0]||(m[0]=[u(" 登出 ")])),_:1}),t(w,{link:"/userManager"},{default:s(({goto:r})=>[t(g,{onClick:r},{default:s(()=>m[1]||(m[1]=[u(" 用户权限中心 ")])),_:2},1032,["onClick"])]),_:1}),t(T,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:a},{reference:s(()=>[t(g,{type:"danger",plain:""},{default:s(()=>m[2]||(m[2]=[u(" 清空本地缓存 ")])),_:1})]),_:1})]),t(f),t(Pe)],64)):(b(),A(e,{key:1,"mt-4":""},{default:s(()=>[t(g,{type:"primary",onClick:o},{default:s(()=>m[3]||(m[3]=[u(" 登录 ")])),_:1}),t(g,{onClick:_},{default:s(()=>m[4]||(m[4]=[u(" 注册 ")])),_:1}),t(T,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:a},{reference:s(()=>[t(g,{type:"danger",plain:""},{default:s(()=>m[5]||(m[5]=[u(" 清空本地缓存 ")])),_:1})]),_:1})]),_:1}))}}}),Ie=h(he,[["__scopeId","data-v-304747f8"]]),Te={class:"settings-wrapper"},Be=S({__name:"globalSettings",setup(v){const n=H(),p=ne(),i=n.general;return(a,o)=>{const _=I,y=me,N=pe,m=M,g=K;return b(),C("div",Te,[t(_,{level:4},{default:s(()=>o[5]||(o[5]=[u(" 全局设置 ")])),_:1}),t(_,{level:5},{default:s(()=>o[6]||(o[6]=[u(" 外观 ")])),_:1}),t(m,null,{default:s(()=>[t(N,{"model-value":l(i).theme.mode,onChange:l(p).setTheme},{default:s(()=>[t(y,{value:"auto",label:"跟随系统"}),t(y,{value:"light",label:"浅色"}),t(y,{value:"dark",label:"深色"})]),_:1},8,["model-value","onChange"])]),_:1}),t(_,{level:5},{default:s(()=>o[7]||(o[7]=[u(" 访问统计 ")])),_:1}),t(m,null,{default:s(()=>[t(g,{modelValue:l(i).showMost,"onUpdate:modelValue":o[0]||(o[0]=w=>l(i).showMost=w)},{default:s(()=>o[8]||(o[8]=[u(" 最常访问 ")])),_:1},8,["modelValue"]),t(g,{modelValue:l(i).showRecent,"onUpdate:modelValue":o[1]||(o[1]=w=>l(i).showRecent=w)},{default:s(()=>o[9]||(o[9]=[u(" 最近访问 ")])),_:1},8,["modelValue"])]),_:1}),t(_,{level:5},{default:s(()=>o[10]||(o[10]=[u(" 其他设置 ")])),_:1}),t(m,null,{default:s(()=>[t(g,{modelValue:l(i).showSearch,"onUpdate:modelValue":o[2]||(o[2]=w=>l(i).showSearch=w)},{default:s(()=>o[11]||(o[11]=[u(" 显示搜索 ")])),_:1},8,["modelValue"]),t(g,{modelValue:l(i).showType,"onUpdate:modelValue":o[3]||(o[3]=w=>l(i).showType=w)},{default:s(()=>o[12]||(o[12]=[u(" 显示分类 ")])),_:1},8,["modelValue"]),t(g,{modelValue:l(i).openInNewTab,"onUpdate:modelValue":o[4]||(o[4]=w=>l(i).openInNewTab=w)},{default:s(()=>o[13]||(o[13]=[u(" 新标签页打开工具 ")])),_:1},8,["modelValue"])]),_:1})])}}}),Re=h(Be,[["__scopeId","data-v-f2fa67ef"]]),Ae={flex:"","flex-wrap":"","items-start":"","gap-4":""},Oe=S({__name:"settings",setup(v){const n=$();return(p,i)=>{const a=I,o=z;return b(),C("div",null,[l(n).logged?(b(),A(a,{key:0,level:3},{default:s(()=>[u(P(l(n).profile.nickName)+" 欢迎你~ ",1)]),_:1})):U("",!0),t(Ie),t(o),d("div",Ae,[t(Re),t(we,{"flex-1":""})])])}}}),Ze=h(Oe,[["__scopeId","data-v-0add9d51"]]);export{Ze as default};
