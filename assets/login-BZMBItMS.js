import{k as z,a4 as I,R as k,J as $,at as K,aw as P,a7 as T,T as F,ab as R,ax as x,E as S,r as G,F as u,K as r,w as n,W as H,bk as L,x as i,L as M,N,aB as Q,aA as d,a0 as A}from"./index-w7TCLGKA.js";import{E as D}from"./el-space-CPEcZ4be.js";import{E as J}from"./el-divider-Bg3gZdsK.js";import{E as O,a as W}from"./el-form-item-CmDPJEEH.js";import"./castArray-B5gwZRA9.js";import"./clone-MGzO6PYW.js";const j={class:"login-container"},X={class:"main"},Y=z({__name:"login",setup(Z){const s=I({userName:"",password:""}),f=k(),m=k({}),t=k(!1),g=$(),V=K(),w=P();T(V,o=>{const e=o.query;e&&(typeof e.redirect=="string"&&(f.value=e.redirect),m.value=q(e))},{immediate:!0}),F(()=>{w.logged&&g.push({path:f.value||"/",query:m.value})}),R(()=>{window.removeEventListener("message",v)});async function _(){if(!t.value){if(!navigator.onLine){d.warning("已离线！");return}if(s.userName!=null&&s.password!=null){t.value=!0;try{await w.login({userName:s.userName,password:s.password}),b()}catch(o){o instanceof Error&&d.error(o.message)}t.value=!1}}}function B(){g.push("/register")}function C(){const o=`${x.apiBaseUrl}/auth/github`;U(o,"GitHub登录")}function b(){d.success("登录成功！"),g.push({path:f.value||"/",query:m.value})}function q(o){const{redirect:e,...a}=o;return a}async function v(o){var a;const e=o.source;o.origin===x.apiBaseUrl&&((a=o.data)==null?void 0:a.type)==="oauth_complete"&&(window.removeEventListener("message",v),e.close(),t.value=!1,await w.checkThirdPartyLogin(o.data.data),b())}function U(o,e="第三方登录",a=500,l=600){if(t.value){d.warning("登录进行中，请勿重复点击");return}t.value=!0,window.addEventListener("message",v);const p=(window.screen.height-a)/2,y=(window.screen.width-l)/2,c=window.open(o,e,`popup,width=${a},height=${l},top=${p},left=${y}`);if(!c){t.value=!1,d.error("请允许浏览器弹出窗口！");return}const h=window.setInterval(()=>{c.closed&&(window.clearInterval(h),t.value=!1)},500)}return(o,e)=>{const a=H,l=O,p=M,y=W,c=J,h=D;return G(),S("div",j,[u("div",X,[r(y,Q({layout:"horizontal",model:i(s)},{wrapperCol:{span:24}}),{default:n(()=>[r(l,{required:""},{default:n(()=>[r(a,{modelValue:i(s).userName,"onUpdate:modelValue":e[0]||(e[0]=E=>i(s).userName=E),placeholder:"账户",size:"large",onKeypress:L(_,["enter"])},{prefix:n(()=>e[2]||(e[2]=[u("span",{class:"i-icon-park-outline-user"},null,-1)])),_:1},8,["modelValue"])]),_:1}),r(l,{required:""},{default:n(()=>[r(a,{modelValue:i(s).password,"onUpdate:modelValue":e[1]||(e[1]=E=>i(s).password=E),type:"password",placeholder:"密码",size:"large","show-password":"",onKeypress:L(_,["enter"])},{prefix:n(()=>e[3]||(e[3]=[u("span",{class:"i-icon-park-outline-lock"},null,-1)])),_:1},8,["modelValue"])]),_:1}),r(l,null,{default:n(()=>[r(p,{type:"primary",block:"",size:"large",loading:i(t),onClick:_},{default:n(()=>e[4]||(e[4]=[N(" 登录 ")])),_:1},8,["loading"]),r(p,{block:"",size:"large",disabled:i(t),onClick:B},{default:n(()=>e[5]||(e[5]=[N(" 注册 ")])),_:1},8,["disabled"])]),_:1})]),_:1},16,["model"]),r(c),r(h,null,{default:n(()=>[u("div",{class:"third-party",title:"GitHub登录",onClick:C},e[6]||(e[6]=[u("i",{class:"i-icon-park-outline:github"},null,-1)]))]),_:1})])])}}}),ne=A(Y,[["__scopeId","data-v-0db345cf"]]);export{ne as default};
