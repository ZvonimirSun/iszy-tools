import{j as q,B as v,k as U,l as O,M as R,q as W,a4 as p,b0 as S,aa as d,o as m,c as h,a as V,b as l,y as o,ae as n,W as _,w as X,ad as Y,t as z,F as x,g as G,X as A,af as J,ag as K,aO as Q,bv as Z,ba as ee,aP as ae,aS as te,bw as le,am as se,an as oe,a3 as ne}from"./vendor-7c5ae7bf.js";import"./common-cdf83cfa.js";import"./ant-design-vue-67d75677.js";const B=b=>(se("data-v-ce269cc8"),b=b(),oe(),b),re={flex:"","flex-col":"","gap-4":"","h-full":""},de={class:"new-url-form"},ce=B(()=>V("span",null," 输入链接: ",-1)),ue=B(()=>V("span",null," 自定义短网址(选): ",-1)),ie=B(()=>V("br",null,null,-1)),pe="https://url.iszy.xyz",_e=q({__name:"urls",setup(b){const E=v([]),c=v(10),u=v(1),I=v(0),$=v(!1),f=U({}),y=U({}),i=U({keyword:"",url:""});O(()=>{k(u.value-1,c.value)}),R(()=>{k(u.value-1,c.value)}),W(c,()=>{u.value=1});async function k(a,t){const g=setTimeout(()=>{$.value=!0},300);try{const r=(await p.get(`${p.$apiBase}/urls/admin/urls`,{params:{pageIndex:a,pageSize:t}})).data;r.success?(I.value=r.data.count,E.value=r.data.rows.map(s=>(s.createdAt=S(s.createdAt).format("YYYY年MM月DD日 HH:mm"),s.updatedAt=S(s.updatedAt).format("YYYY年MM月DD日 HH:mm"),s))):d.error(r.message)}catch(r){d.error(r.message)}clearTimeout(g),$.value=!1}async function D(){if(i.url)try{const a=(await p.post(`${p.$apiBase}/urls/admin/url`,{url:i.url,keyword:i.keyword})).data;a.success?(d.success("创建成功"),i.url="",i.keyword="",await k(u.value-1,c.value)):d.error(a.message)}catch(a){d.error(a.message)}}async function L(a){try{const t=(await p.put(`${p.$apiBase}/urls/admin/url/${a.keyword}`,{url:y[a.keyword]})).data;t.success?(d.success("更新成功"),a.url=y[a.keyword],f[a.keyword]=!1,await k(u.value-1,c.value)):d.error(t.message)}catch(t){d.error(t.message)}}async function P(a){try{const t=(await p.delete(`${p.$apiBase}/urls/admin/url/${a.keyword}`,{params:{keyword:a.keyword}})).data;t.success?(await k(u.value-1,c.value),d.success("删除成功")):d.error(t.message)}catch(t){d.error(t.message)}}function M(a){f[a.keyword]=!f[a.keyword],f[a.keyword]&&(y[a.keyword]=a.url)}function T(a){return(u.value-1)*c.value+a+1}return(a,t)=>{const g=J,r=K,s=Q,C=Z,H=ee,N=ae,j=te,F=le;return m(),h("div",re,[V("div",de,[ce,l(g,{modelValue:o(i).url,"onUpdate:modelValue":t[0]||(t[0]=e=>o(i).url=e),placeholder:"https",clearable:"","flex-1":""},null,8,["modelValue"]),ue,l(g,{modelValue:o(i).keyword,"onUpdate:modelValue":t[1]||(t[1]=e=>o(i).keyword=e),clearable:""},null,8,["modelValue"]),l(r,{type:"primary",onClick:D},{default:n(()=>[_(" 缩短 ")]),_:1})]),X((m(),Y(N,{data:o(E),border:!0,stripe:!0,size:"small","flex-1":""},{default:n(()=>[l(s,{type:"index",index:T,fixed:"left"}),l(s,{prop:"keyword",label:"短网址",width:"100",fixed:"left"},{default:n(({row:e})=>[l(C,{href:pe+"/"+e.keyword,target:"_blank",style:{"white-space":"nowrap"}},{default:n(()=>[_(z(e.keyword),1)]),_:2},1032,["href"])]),_:1}),l(s,{prop:"url",label:"原网址","min-width":"300"},{default:n(({row:e})=>[o(f)[e.keyword]?(m(),Y(g,{key:1,modelValue:o(y)[e.keyword],"onUpdate:modelValue":w=>o(y)[e.keyword]=w},null,8,["modelValue","onUpdate:modelValue"])):(m(),h(x,{key:0},[e.title?(m(),h(x,{key:0},[l(C,{href:e.url,target:"_blank"},{default:n(()=>[_(z(e.title),1)]),_:2},1032,["href"]),ie],64)):G("",!0),l(C,{href:e.url,target:"_blank"},{default:n(()=>[_(z(e.url),1)]),_:2},1032,["href"])],64))]),_:1}),l(s,{prop:"createdAt",label:"日期",width:"180"}),l(s,{prop:"ip",label:"IP",width:"130"}),l(s,{prop:"clicks",label:"点击次数",width:"80"}),l(s,{label:"操作",width:"140",fixed:"right"},{default:n(({row:e})=>[o(f)[e.keyword]?(m(),h(x,{key:1},[l(r,{size:"small",onClick:w=>M(e)},{default:n(()=>[_(" 取消 ")]),_:2},1032,["onClick"]),l(r,{size:"small",type:"primary",onClick:w=>L(e)},{default:n(()=>[_(" 更新 ")]),_:2},1032,["onClick"])],64)):(m(),h(x,{key:0},[l(r,{size:"small",onClick:w=>M(e)},{default:n(()=>[_(" 编辑 ")]),_:2},1032,["onClick"]),l(H,{width:"160",title:"删除后无法恢复！","confirm-button-type":"danger","confirm-button-text":"删除",onConfirm:w=>P(e)},{reference:n(()=>[l(r,{size:"small",type:"danger"},{default:n(()=>[_(" 删除 ")]),_:1})]),_:2},1032,["onConfirm"])],64))]),_:1})]),_:1},8,["data"])),[[F,o($)]]),l(j,{"current-page":o(u),"onUpdate:currentPage":t[2]||(t[2]=e=>A(u)?u.value=e:null),"page-size":o(c),"onUpdate:pageSize":t[3]||(t[3]=e=>A(c)?c.value=e:null),small:"",background:"",layout:"prev, pager, next",total:o(I)},null,8,["current-page","page-size","total"])])}}});const ke=ne(_e,[["__scopeId","data-v-ce269cc8"]]);export{ke as default};
