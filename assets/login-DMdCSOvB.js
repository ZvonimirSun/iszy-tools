import{k as P,a4 as F,R as b,J as K,at as D,aw as R,a7 as S,T,ab as G,ax as N,E as m,r as f,F as g,K as s,w as i,W as M,bk as C,x as l,L as O,N as V,aB as Q,Y as A,Z as H,v as J,aA as d,a0 as W}from"./index-cf9rWmbE.js";import{E as X}from"./el-space-CggOX_Fd.js";import{E as Y}from"./el-divider-DeaeNJ-y.js";import{E as Z,a as j}from"./el-form-item-DTZNgFbw.js";import{L as ee}from"./linuxdo-C7o2R0pC.js";import"./castArray-DMcLvZI7.js";import"./clone-TDUO1AO-.js";const te={class:"login-container"},oe={class:"main"},ae=["title","onClick"],re=["src"],se=P({__name:"login",setup(ne){const n=F({userName:"",password:""}),_=b(),w=b({}),o=b(!1),v=K(),B=D(),y=R(),I=[{type:"github",title:"Github",icon:"i-icon-park-outline:github"},{type:"linuxdo",title:"LINUX DO",img:ee}];S(B,t=>{const e=t.query;e&&(typeof e.redirect=="string"&&(_.value=e.redirect),w.value=q(e))},{immediate:!0}),T(()=>{y.logged&&v.push({path:_.value||"/",query:w.value})}),G(()=>{window.removeEventListener("message",k)});async function h(){if(!o.value){if(!navigator.onLine){d.warning("已离线！");return}if(n.userName!=null&&n.password!=null){o.value=!0;try{await y.login({userName:n.userName,password:n.password}),x()}catch(t){t instanceof Error&&d.error(t.message)}o.value=!1}}}function U(){v.push("/register")}function $(t){const e=`${N.apiBaseUrl}/auth/${t}`;z(e,"GitHub登录")}function x(){d.success("登录成功！"),v.push({path:_.value||"/",query:w.value})}function q(t){const{redirect:e,...a}=t;return a}async function k(t){var a;const e=t.source;t.origin===N.apiBaseUrl&&((a=t.data)==null?void 0:a.type)==="oauth_complete"&&(window.removeEventListener("message",k),e.close(),o.value=!1,await y.thirdPartyLogin(t.data.data),x())}function z(t,e="第三方登录",a=500,u=600){if(o.value){d.warning("登录进行中，请勿重复点击");return}o.value=!0,window.addEventListener("message",k);const c=(window.screen.height-a)/2,E=(window.screen.width-u)/2,p=window.open(t,e,`popup,width=${a},height=${u},top=${c},left=${E}`);if(!p){o.value=!1,d.error("请允许浏览器弹出窗口！");return}const L=window.setInterval(()=>{p.closed&&(window.clearInterval(L),o.value=!1)},500)}return(t,e)=>{const a=M,u=Z,c=O,E=j,p=Y,L=X;return f(),m("div",te,[g("div",oe,[s(E,Q({layout:"horizontal",model:l(n)},{wrapperCol:{span:24}}),{default:i(()=>[s(u,{required:""},{default:i(()=>[s(a,{modelValue:l(n).userName,"onUpdate:modelValue":e[0]||(e[0]=r=>l(n).userName=r),placeholder:"账户",size:"large",onKeypress:C(h,["enter"])},{prefix:i(()=>e[2]||(e[2]=[g("span",{class:"i-icon-park-outline-user"},null,-1)])),_:1},8,["modelValue"])]),_:1}),s(u,{required:""},{default:i(()=>[s(a,{modelValue:l(n).password,"onUpdate:modelValue":e[1]||(e[1]=r=>l(n).password=r),type:"password",placeholder:"密码",size:"large","show-password":"",onKeypress:C(h,["enter"])},{prefix:i(()=>e[3]||(e[3]=[g("span",{class:"i-icon-park-outline-lock"},null,-1)])),_:1},8,["modelValue"])]),_:1}),s(u,null,{default:i(()=>[s(c,{type:"primary",block:"",size:"large",loading:l(o),onClick:h},{default:i(()=>e[4]||(e[4]=[V(" 登录 ")])),_:1},8,["loading"]),s(c,{block:"",size:"large",disabled:l(o),onClick:U},{default:i(()=>e[5]||(e[5]=[V(" 注册 ")])),_:1},8,["disabled"])]),_:1})]),_:1},16,["model"]),s(p),s(L,null,{default:i(()=>[(f(),m(A,null,H(I,r=>g("div",{key:r.type,class:"third-party",title:r.title,onClick:ie=>$(r.type)},[r.icon?(f(),m("i",{key:0,class:J(r.icon)},null,2)):(f(),m("img",{key:1,class:"third-party-img",src:r.img,alt:""},null,8,re))],8,ae)),64))]),_:1})])])}}}),ge=W(se,[["__scopeId","data-v-1f6ddb1d"]]);export{ge as default};
