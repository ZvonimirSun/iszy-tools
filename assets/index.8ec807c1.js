var e=Object.defineProperty,t=(t,i,r)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[i]=r,i=(e,i,r)=>(t(e,"symbol"!=typeof i?i+"":i,r),r);import{l as r,p as s,a as n,o,c as a,b as l,F as c,x as h,u as d,y as m,w as f,r as g}from"./vendor.a2be80c6.js";import{_ as b}from"./container.0f0ec48a.js";/* empty css              *//* empty css              */class u{}i(u,"i",[[[0,0,0,0],[0,0,0,0],[1,1,1,1],[0,0,0,0]],[[0,0,1,0],[0,0,1,0],[0,0,1,0],[0,0,1,0]]]),i(u,"j",[[[1,0,0],[1,1,1],[0,0,0]],[[0,1,1],[0,1,0],[0,1,0]],[[0,0,0],[1,1,1],[0,0,1]],[[0,1,0],[0,1,0],[1,1,0]]]),i(u,"l",[[[0,0,1],[1,1,1],[0,0,0]],[[0,1,0],[0,1,0],[0,1,1]],[[0,0,0],[1,1,1],[1,0,0]],[[1,1,0],[0,1,0],[0,1,0]]]),i(u,"o",[[[0,0,0,0],[0,1,1,0],[0,1,1,0],[0,0,0,0]]]),i(u,"s",[[[0,0,0],[0,1,1],[1,1,0]],[[0,1,0],[0,1,1],[0,0,1]]]),i(u,"t",[[[0,1,0],[1,1,1],[0,0,0]],[[0,1,0],[0,1,1],[0,1,0]],[[0,0,0],[1,1,1],[0,1,0]],[[0,1,0],[1,1,0],[0,1,0]]]),i(u,"z",[[[0,0,0],[1,1,0],[0,1,1]],[[0,0,1],[0,1,1],[0,1,0]]]),i(u,"iLegend",[[0,0,0,0],[1,1,1,1]]),i(u,"jLegend",[[1,0,0,0],[1,1,1,0]]),i(u,"lLegend",[[0,0,1,0],[1,1,1,0]]),i(u,"oLegend",[[0,1,1,0],[0,1,1,0]]),i(u,"sLegend",[[0,1,1,0],[1,1,0,0]]),i(u,"tLegend",[[0,1,0,0],[1,1,1,0]]),i(u,"zLegend",[[1,1,0,0],[0,1,1,0]]);var p="@keyframes blink-010e3a28 {\n0%, 50%, 100% {\n    opacity: 1;\n}\n25%, 75% {\n    opacity: 0;\n}\n}\n.gamePanel[data-v-010e3a28] {\n  height: calc(100vh - 32rem);\n  width: calc(100vh - 32rem);\n  max-height: calc(100vw - 8rem);\n  max-width: calc(100vw - 8rem);\n  margin: 0 auto;\n  border: 1rem solid #1e1e1e;\n  border-right-color: #a1a1a1;\n  border-bottom-color: #d7d7d7;\n  border-left-color: #525252;\n  background: #000;\n  box-sizing: border-box;\n  padding: 0.8rem;\n  display: flex;\n}\n.gamePanel .tetrisPanel[data-v-010e3a28] {\n  width: fit-content;\n  display: grid;\n  grid-template-columns: repeat(12, 1fr);\n  grid-template-rows: repeat(22, 1fr);\n}\n.gamePanel .tetrisPanel .tetrisMainPanel[data-v-010e3a28] {\n  grid-column: 2/12;\n  grid-row: 2/22;\n  display: grid;\n  grid-template-columns: repeat(10, 1fr);\n  grid-template-rows: repeat(20, 1fr);\n}\n.gamePanel .infoPanel[data-v-010e3a28] {\n  height: 100%;\n  padding-left: 0.8rem;\n  flex: 1;\n}\n.gamePanel .infoPanel .infoTitle[data-v-010e3a28] {\n  font-size: 4.6rem;\n  line-height: 5.4rem;\n  color: #fff;\n  margin: 1.6rem auto;\n  padding-left: 1rem;\n}\n.gamePanel .infoPanel .nextTetrimino[data-v-010e3a28], .gamePanel .infoPanel .startGame[data-v-010e3a28] {\n  margin: 0 auto;\n  display: grid;\n  width: fit-content;\n  grid-template-columns: repeat(4, 1fr);\n  grid-template-rows: repeat(2, 1fr);\n}\n.gamePanel .infoPanel .startGame[data-v-010e3a28] {\n  margin: 2rem auto 0;\n  display: grid;\n  width: fit-content;\n  grid-template-columns: repeat(2, 1fr);\n  grid-template-rows: repeat(2, 1fr);\n  cursor: pointer;\n  user-select: none;\n}\n.gamePanel .infoPanel .startGame .tetrisCell[data-v-010e3a28] {\n  color: #fff;\n  text-align: center;\n  line-height: 3.131rem;\n  font-size: 2.5rem;\n  background: #0000ab;\n  border: 0.6rem solid #b4b4e7;\n  border-right-color: #000078;\n  border-bottom-color: #00002f;\n  border-left-color: #4c4cc5;\n}\n.gamePanel .infoPanel .startGame:active .tetrisCell[data-v-010e3a28] {\n  border: 0.6rem solid #00002f;\n  border-right-color: #4c4cc5;\n  border-bottom-color: #b4b4e7;\n  border-left-color: #000078;\n  font-size: 2rem;\n  transition: 0.1s;\n}\n.gamePanel .infoPanel .score[data-v-010e3a28] {\n  color: #fff;\n  font-size: 6.8rem;\n  line-height: 7.6rem;\n  text-align: center;\n}\n.gamePanel .tetrisCell[data-v-010e3a28] {\n  height: calc(4.5454545455vh - 1.6181818182rem);\n  width: calc(4.5454545455vh - 1.6181818182rem);\n  max-height: calc(4.5454545455vw - 0.5272727273rem);\n  max-width: calc(4.5454545455vw - 0.5272727273rem);\n}\n.gamePanel .tetrisCell.blink[data-v-010e3a28] {\n  animation: blink-010e3a28 0.6s both;\n}\n.gamePanel .tetrisCell.tetrisCellColor-i[data-v-010e3a28] {\n  background: #02ffff;\n  border: 0.6rem solid #b4ffff;\n  border-right-color: #00b4b3;\n  border-bottom-color: #004a4b;\n  border-left-color: #4cffff;\n}\n.gamePanel .tetrisCell.tetrisCellColor-j[data-v-010e3a28] {\n  background: #0000ab;\n  border: 0.6rem solid #b4b4e7;\n  border-right-color: #000078;\n  border-bottom-color: #00002f;\n  border-left-color: #4c4cc5;\n}\n.gamePanel .tetrisCell.tetrisCellColor-l[data-v-010e3a28] {\n  background: #ff7700;\n  border: 0.6rem solid #ffd8b5;\n  border-right-color: #b35200;\n  border-bottom-color: #4b1d00;\n  border-left-color: #ffa24c;\n}\n.gamePanel .tetrisCell.tetrisCellColor-o[data-v-010e3a28] {\n  background: #ffff00;\n  border: 0.6rem solid #ffffb5;\n  border-right-color: #b3b302;\n  border-bottom-color: #4b4b00;\n  border-left-color: #ffff4c;\n}\n.gamePanel .tetrisCell.tetrisCellColor-s[data-v-010e3a28] {\n  background: #00ff00;\n  border: 0.6rem solid #b4ffb4;\n  border-right-color: #00b400;\n  border-bottom-color: #004a00;\n  border-left-color: #4cff4b;\n}\n.gamePanel .tetrisCell.tetrisCellColor-t[data-v-010e3a28] {\n  background: #cd00cd;\n  border: 0.6rem solid #f0b5f1;\n  border-right-color: #8f008f;\n  border-bottom-color: #3b003a;\n  border-left-color: #dc4cdb;\n}\n.gamePanel .tetrisCell.tetrisCellColor-z[data-v-010e3a28] {\n  background: #ff0000;\n  border: 0.6rem solid #ffb5b4;\n  border-right-color: #b30100;\n  border-bottom-color: #4b0000;\n  border-left-color: #ff4b4b;\n}\n.gamePanel .tetrisCell.tetrisCellGrid[data-v-010e3a28] {\n  background: #787878;\n  border: 0.6rem solid #d7d7d7;\n  border-right-color: #525252;\n  border-bottom-color: #1e1e1e;\n  border-left-color: #a1a1a1;\n}";const v=["i","j","l","o","s","t","z"],x={name:"tetris",components:{Container:b},data:()=>({inited:!1,gridCells:{col:10,row:20},matrix:null,rotate:0,position:null,currentTetrimino:null,nextTetrimino:null,bestScore:0,score:0,lines:0,start:!1,end:!1,pause:!1,clearing:!1,clearIndexs:[],intervalID:void 0}),computed:{movable:function(){return this.start&&!this.end&&!this.clearing&&!this.pause},level:function(){return Math.ceil(this.lines/10)},nextTetriminoMatrixLegend:function(){return this.nextTetrimino?u[this.nextTetrimino+"Legend"]:null},positions:function(){return this.currentTetrimino?this._getPositions(this._getRotatedMatrix(this.rotate),this.position):null},currentMatrix:function(){if(this.currentTetrimino){const e=r.exports.cloneDeep(this.matrix);for(const t of this.positions)t[0]>=0&&t[0]<this.gridCells.row&&t[1]>=0&&t[1]<this.gridCells.col&&(e[t[0]][t[1]]=this.currentTetrimino);return e}return this.matrix}},mounted(){this.resetGame(),this.getNextTetrimino(),this.addListener(),this.inited=!0},methods:{playGame(){this.start||(this.score=0,this.lines=0,this.getNextTetrimino(),this.start=!0,this.intervalID=setInterval((()=>{this.clearing||this.moveDown()}),1e3))},resetGame(){const e=Array(this.gridCells.row);for(const t of r.exports.range(this.gridCells.row))e[t]=Array(this.gridCells.col).fill("");this.matrix=e,this.rotate=0,this.resetPosition(),this.currentTetrimino=void 0,this.start=!1,this.end=!1,this.pause=!1,this.clearing=!1},pauseGame(){this.start&&(this.pause?(this.pause=!this.pause,this.intervalID=setInterval((()=>{this.clearing||this.moveDown()}),1e3)):(this.pause=!this.pause,clearInterval(this.intervalID)))},resetPosition(){this.rotate=0,this.position=[0,Math.ceil(this.gridCells.col/2)]},updateMatrix(){if(this.start){for(const t of this.positions)t[0]<0&&(this.end=!0);if(this.matrix=r.exports.cloneDeep(this.currentMatrix),this.end){this.clearIndexs=[];for(const e of r.exports.range(this.gridCells.row))this.clearIndexs.push(e);return void setTimeout((()=>{this.score>this.bestScore&&(this.bestScore=this.score),this.clearIndexs=[],this.resetGame()}),600)}const e=[];for(const t in this.matrix){0===this.matrix[t].filter((e=>""===e)).length&&e.push(parseInt(t))}if(e.length>0){this.clearing=!0,this.clearIndexs=e;const t=r.exports.cloneDeep(this.matrix);for(let e=this.clearIndexs.length-1;e>=0;e--)t.splice(this.clearIndexs[e],1);const i=Array(this.clearIndexs.length);for(const e of r.exports.range(this.clearIndexs.length))i[e]=Array(this.gridCells.col).fill("");setTimeout((()=>{switch(this.lines+=this.clearIndexs.length,this.clearIndexs.length){case 1:this.score+=40*this.level;break;case 2:this.score+=100*this.level;break;case 3:this.score+=300*this.level;break;case 4:this.score+=1200*this.level;break}this.clearIndexs=[],this.matrix=[...i,...t],this.getNextTetrimino(),this.resetPosition(),this.clearing=!1}),600)}else this.getNextTetrimino(),this.resetPosition()}},getNextTetrimino(){this.currentTetrimino=this.nextTetrimino,this.nextTetrimino=v[r.exports.random(0,6)]},rotateRight(){this.movable&&!this._hasConflict(this._getPositions(this._getRotatedMatrix(this.rotate-1),this.position))&&this.rotate++},rotateLeft(){this.movable&&!this._hasConflict(this._getPositions(this._getRotatedMatrix(this.rotate-1),this.position))&&this.rotate--},moveLeft(){this.movable&&!this._hasConflict(this._getPositions(this._getRotatedMatrix(this.rotate),[this.position[0],this.position[1]-1]))&&this.position[1]--},moveRight(){this.movable&&!this._hasConflict(this._getPositions(this._getRotatedMatrix(this.rotate),[this.position[0],this.position[1]+1]))&&this.position[1]++},moveDown(){this.movable&&(this._hasConflict(this._getPositions(this._getRotatedMatrix(this.rotate),[this.position[0]+1,this.position[1]]))?this.updateMatrix():this.position[0]++)},moveBottom(){if(this.movable){let e=0;for(;!this._hasConflict(this._getPositions(this._getRotatedMatrix(this.rotate),[this.position[0]+e+1,this.position[1]]));)e++;this.position[0]+=e,this.updateMatrix()}},addListener(){document.addEventListener("keydown",this._keyboardEvent.bind(this))},removeListener(){document.removeEventListener("keydown",this._keyboardEvent.bind(this))},_getRotatedMatrix(e){let t=e%u[this.currentTetrimino].length;return t<0&&(t+=u[this.currentTetrimino].length),u[this.currentTetrimino][t]},_getPositions(e,t){const i=[];for(let r=0;r<e.length;r++)for(let s=0;s<e[r].length;s++)if(1===e[r][s])switch(this.currentTetrimino){case"i":case"o":i.push([t[0]-2+r,t[1]-2+s]);break;case"j":case"l":case"t":i.push([t[0]-1+r,t[1]-1+s]);break;case"s":case"z":i.push([t[0]-2+r,t[1]-1+s]);break;default:return null}return i},_keyboardEvent(e){if(!(e.altKey||e.ctrlKey||e.metaKey||e.shiftKey))switch(e.code){case"Space":this.start?(this.pause&&this.pauseGame(),this.moveBottom()):this.playGame();break;case"KeyW":case"KeyE":case"ArrowUp":this.pause&&this.pauseGame(),this.rotateRight();break;case"KeyQ":this.pause&&this.pauseGame(),this.rotateLeft();break;case"KeyS":case"ArrowDown":this.pause&&this.pauseGame(),this.moveDown();break;case"KeyA":case"ArrowLeft":this.pause&&this.pauseGame(),this.moveLeft();break;case"KeyD":case"ArrowRight":this.pause&&this.pauseGame(),this.moveRight();break;case"KeyP":this.pauseGame();break}},_hasConflict(e){for(const t of e){if(t[0]>=this.gridCells.row||t[1]<0||t[1]>=this.gridCells.col)return!0;if(t[0]>=0&&""!==this.matrix[t[0]][t[1]])return!0}return!1}},beforeUnmount(){this.removeListener()}},C=f();s("data-v-010e3a28");const P={class:"gamePanel"},y={class:"tetrisPanel"},k={class:"tetrisMainPanel"},w={key:1,class:"tetrisCell"},T={class:"infoPanel"},_=l("div",{class:"infoTitle"},"最高分",-1),G={class:"score"},I=l("div",{class:"infoTitle"},"得分",-1),L={class:"score"},M=l("div",{class:"infoTitle"},"消除行",-1),D={class:"score"},R=l("div",{class:"infoTitle"},"级别",-1),K={class:"score"},j=l("div",{class:"infoTitle"},"下一个",-1),z={class:"nextTetrimino"},A={key:1,class:"tetrisCell"},E=l("div",{class:"tetrisCell"},"开",-1),S=l("div",{class:"tetrisCell"},"始",-1),N=l("div",{class:"tetrisCell"},"游",-1),B=l("div",{class:"tetrisCell"},"戏",-1);n();const F=C(((e,t,i,r,s,n)=>{const f=g("container");return o(),a(f,null,{default:C((()=>[l("div",P,[l("div",y,[(o(!0),a(c,null,h(2*e.gridCells.col+2*e.gridCells.row+4,(e=>(o(),a("div",{class:["tetrisCell","tetrisCellGrid"],key:"tetrisFrameGrid"+e})))),128)),l("div",k,[e.inited?(o(!0),a(c,{key:0},h(e.gridCells.row,(t=>(o(),a(c,{key:t},[(o(!0),a(c,null,h(e.gridCells.col,(i=>(o(),a(c,{key:i},[n.currentMatrix[t-1][i-1]?(o(),a("div",{key:0,class:["tetrisCell","tetrisCellColor-"+n.currentMatrix[t-1][i-1],e.clearIndexs.includes(t-1)?"blink":""]},null,2)):(o(),a("div",w))],64)))),128))],64)))),128)):d("",!0)])]),l("div",T,[_,l("div",G,m(e.bestScore),1),I,l("div",L,m(e.score),1),M,l("div",D,m(e.lines),1),R,l("div",K,m(n.level),1),j,l("div",z,[e.inited?(o(),a(c,{key:0},h(2,(t=>(o(),a(c,{key:t},[(o(),a(c,null,h(4,(i=>(o(),a(c,{key:i},[n.nextTetriminoMatrixLegend[t-1][i-1]?(o(),a("div",{key:0,class:["tetrisCell","tetrisCellColor-"+e.nextTetrimino]},null,2)):(o(),a("div",A))],64)))),64))],64)))),64)):d("",!0)]),l("div",{class:"startGame",onClick:t[1]||(t[1]=(...e)=>n.playGame&&n.playGame(...e))},[E,S,N,B])])])])),_:1})}));x.render=F,x.__scopeId="data-v-010e3a28";export default x;
