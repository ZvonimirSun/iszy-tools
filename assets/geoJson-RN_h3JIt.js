import{u}from"./common-CpI8Jpmo.js";import{U as h,P as f,M as O,L as C,a as k,b as w,c as m,d as x,S,B as M,C as P,e as y}from"./@supermap/iclient-common-QVgkMiQv.js";class E{constructor(i,e,r){this.CLASS_NAME="SuperMap.Feature",this.layer=i,this.id=h.createUniqueID(this.CLASS_NAME+"_"),this.lonlat=e,this.data=r??{}}destroy(){this.id=null,this.lonlat=null,this.data=null}}const a={UNKNOWN:"Unknown",INSERT:"Insert",UPDATE:"Update",DELETE:"Delete"};class v extends E{constructor(i,e,r){super(null,null,e),this.fid=null,this.geometry=i||null,this.attributes={},e&&(this.attributes=h.extend(this.attributes,e)),this.bounds=null,this.state=null,this.style=r||null,this.url=null,this.lonlat=null,this.CLASS_NAME="SuperMap.Feature.Vector",v.style={default:{fillColor:"#ee9900",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#ee9900",strokeOpacity:1,strokeWidth:1,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"inherit",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},select:{fillColor:"blue",fillOpacity:.4,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"blue",strokeOpacity:1,strokeWidth:2,strokeLinecap:"round",strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"pointer",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},temporary:{fillColor:"#66cccc",fillOpacity:.2,hoverFillColor:"white",hoverFillOpacity:.8,strokeColor:"#66cccc",strokeOpacity:1,strokeLinecap:"round",strokeWidth:2,strokeDashstyle:"solid",hoverStrokeColor:"red",hoverStrokeOpacity:1,hoverStrokeWidth:.2,pointRadius:6,hoverPointRadius:1,hoverPointUnit:"%",pointerEvents:"visiblePainted",cursor:"default",fontColor:"#000000",labelAlign:"cm",labelOutlineColor:"white",labelOutlineWidth:3},delete:{display:"none"}}}destroy(){this.layer&&(this.layer.removeFeatures(this),this.layer=null),this.geometry=null,super.destroy()}clone(){return new v(this.geometry?this.geometry.clone():null,this.attributes,this.style)}toState(i){if(i===a.UPDATE)switch(this.state){case a.UNKNOWN:case a.DELETE:this.state=i;break}else if(i===a.INSERT)switch(this.state){case a.UNKNOWN:break;default:this.state=i;break}else if(i===a.DELETE)switch(this.state){case a.INSERT:break;case a.DELETE:break;case a.UNKNOWN:case a.UPDATE:this.state=i;break}else i===a.UNKNOWN&&(this.state=i)}}class F{constructor(i){this.data=null,this.keepData=!1,h.extend(this,i),this.options=i,this.CLASS_NAME="SuperMap.Format"}destroy(){}read(i){}write(i){}}class G extends F{constructor(i){super(i),this.indent="    ",this.space=" ",this.newline=`
`,this.level=0,this.pretty=!1,this.nativeJSON=function(){return!!(window.JSON&&typeof JSON.parse=="function"&&typeof JSON.stringify=="function")}(),this.CLASS_NAME="SuperMap.Format.JSON",this.serialize={object:function(e){if(e==null)return"null";if(e.constructor===Date)return this.serialize.date.apply(this,[e]);if(e.constructor===Array)return this.serialize.array.apply(this,[e]);var r=["{"];this.level+=1;var t,s,n,l=!1;for(t in e)e.hasOwnProperty(t)&&(s=this.write.apply(this,[t,this.pretty]),n=this.write.apply(this,[e[t],this.pretty]),s!=null&&n!=null&&(l&&r.push(","),r.push(this.writeNewline(),this.writeIndent(),s,":",this.writeSpace(),n),l=!0));return this.level-=1,r.push(this.writeNewline(),this.writeIndent(),"}"),r.join("")},array:function(e){var r,t=["["];this.level+=1;for(var s=0,n=e.length;s<n;++s)r=this.write.apply(this,[e[s],this.pretty]),r!=null&&(s>0&&t.push(","),t.push(this.writeNewline(),this.writeIndent(),r));return this.level-=1,t.push(this.writeNewline(),this.writeIndent(),"]"),t.join("")},string:function(e){var r={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return/["\\\x00-\x1f]/.test(e)?'"'+e.replace(/([\x00-\x1f\\"])/g,function(t,s){var n=r[s];return n||(n=s.charCodeAt(),"\\u00"+Math.floor(n/16).toString(16)+(n%16).toString(16))})+'"':'"'+e+'"'},number:function(e){return isFinite(e)?String(e):"null"},boolean:function(e){return String(e)},date:function(e){function r(t){return t<10?"0"+t:t}return'"'+e.getFullYear()+"-"+r(e.getMonth()+1)+"-"+r(e.getDate())+"T"+r(e.getHours())+":"+r(e.getMinutes())+":"+r(e.getSeconds())+'"'}}}read(i,e){var r;if(this.nativeJSON)try{r=JSON.parse(i,e)}catch{return{data:i}}return this.keepData&&(this.data=r),r}write(i,e){this.pretty=!!e;var r=null,t=typeof i;if(this.serialize[t])try{r=!this.pretty&&this.nativeJSON?JSON.stringify(i):this.serialize[t].apply(this,[i])}catch{}return r}writeIndent(){var i=[];if(this.pretty)for(var e=0;e<this.level;++e)i.push(this.indent);return i.join("")}writeNewline(){return this.pretty?this.newline:""}writeSpace(){return this.pretty?this.space:""}}class N extends G{constructor(i){super(i),this.ignoreExtraDims=!0,this.CLASS_NAME="SuperMap.Format.GeoJSON",this.parseCoords={point:function(e){if(this.ignoreExtraDims===!1&&e.length!=2)throw"Only 2D points are supported: "+e;return new f(e[0],e[1])},multipoint:function(e){for(var r=[],t=null,s=0,n=e.length;s<n;++s){try{t=this.parseCoords.point.apply(this,[e[s]])}catch(l){throw l}r.push(t)}return new O(r)},linestring:function(e){for(var r=[],t=null,s=0,n=e.length;s<n;++s){try{t=this.parseCoords.point.apply(this,[e[s]])}catch(l){throw l}r.push(t)}return new C(r)},multilinestring:function(e){for(var r=[],t=null,s=0,n=e.length;s<n;++s){try{t=this.parseCoords.linestring.apply(this,[e[s]])}catch(l){throw l}r.push(t)}return new k(r)},polygon:function(e){for(var r=[],t,s,n=0,l=e.length;n<l;++n){try{s=this.parseCoords.linestring.apply(this,[e[n]])}catch(p){throw p}t=new w(s.components),r.push(t)}return new m(r)},multipolygon:function(e){for(var r=[],t=null,s=0,n=e.length;s<n;++s){try{t=this.parseCoords.polygon.apply(this,[e[s]])}catch(l){throw l}r.push(t)}return new x(r)},box:function(e){if(e.length!=2)throw"GeoJSON box coordinates must have 2 elements";return new m([new w([new f(e[0][0],e[0][1]),new f(e[1][0],e[0][1]),new f(e[1][0],e[1][1]),new f(e[0][0],e[1][1]),new f(e[0][0],e[0][1])])])}},this.extract={feature:function(e){var r=this.extract.geometry.apply(this,[e.geometry]),t={type:"Feature",properties:this.createAttributes(e),geometry:r};return e.geometry&&e.geometry.type==="TEXT"&&(t.properties.texts=e.geometry.texts,t.properties.textStyle=e.geometry.textStyle),e.fid&&(t.id=e.fid),e.ID&&(t.id=e.ID),t},geometry:function(e){if(e==null)return null;!e.parts&&e.points&&(e.parts=[e.points.length]);var r=e.hasOwnProperty("geometryType")?e:new S(e).toGeometry()||e,t=r.geometryType||r.type,s;t==="LinearRing"&&(t="LineString"),t==="LINEM"&&(t="MultiLineString"),s=this.extract[t.toLowerCase()].apply(this,[r]),t=t==="TEXT"?"Point":t;var n;return t==="Collection"?n={type:"GeometryCollection",geometries:s}:n={type:t,coordinates:s},n},point:function(e){var r=[e.x,e.y];for(var t in e)t!=="x"&&t!=="y"&&e[t]!==null&&!isNaN(e[t])&&r.push(e[t]);return r},text:function(e){return[e.points[0].x,e.points[0].y]},multipoint:function(e){for(var r=[],t=0,s=e.components.length;t<s;++t)r.push(this.extract.point.apply(this,[e.components[t]]));return r},linestring:function(e){for(var r=[],t=0,s=e.components.length;t<s;++t)r.push(this.extract.point.apply(this,[e.components[t]]));return r},multilinestring:function(e){for(var r=[],t=0,s=e.components.length;t<s;++t)r.push(this.extract.linestring.apply(this,[e.components[t]]));return r},polygon:function(e){for(var r=[],t=0,s=e.components.length;t<s;++t)r.push(this.extract.linestring.apply(this,[e.components[t]]));return r},multipolygon:function(e){for(var r=[],t=0,s=e.components.length;t<s;++t)r.push(this.extract.polygon.apply(this,[e.components[t]]));return r},collection:function(e){for(var r=e.components.length,t=new Array(r),s=0;s<r;++s)t[s]=this.extract.geometry.apply(this,[e.components[s]]);return t}}}read(i,e,r){e=e||"FeatureCollection";var t=null,s=null;if(typeof i=="string"?s=super.read(i,r):s=i,s){if(typeof s.type=="string"){if(this.isValidType(s,e))switch(e){case"Geometry":try{t=this.parseGeometry(s)}catch{}break;case"Feature":try{t=this.parseFeature(s),t.type="Feature"}catch{}break;case"FeatureCollection":switch(t=[],s.type){case"Feature":try{t.push(this.parseFeature(s))}catch{t=null}break;case"FeatureCollection":for(var n=0,l=s.features.length;n<l;++n)try{t.push(this.parseFeature(s.features[n]))}catch{t=null}break;default:try{var p=this.parseGeometry(s);t.push(new v(p))}catch{t=null}}break}}}return t}write(i,e){return super.write(this.toGeoJSON(i),e)}fromGeoJSON(i,e,r){let t=this.read(i,e,r);return h.isArray(t)?t.map(s=>this._toiSevrerFeature(s)):this._toiSevrerFeature(t)}toGeoJSON(i){var e={type:null};if(h.isArray(i)){e.type="FeatureCollection";var r=i.length;e.features=new Array(r);for(var t=0;t<r;++t){var s=i[t];if(n(s)){let l={};l.geometry=s,e.features[t]=this.extract.feature.apply(this,[l])}else e.features[t]=this.extract.feature.apply(this,[s])}}else if(n(i)){let l={};l.geometry=i,e=this.extract.feature.apply(this,[l])}else e=this.extract.feature.apply(this,[i]);function n(l){return l.hasOwnProperty("parts")&&l.hasOwnProperty("points")||l.hasOwnProperty("geoParts")}return e}isValidType(i,e){var r=!1;switch(e){case"Geometry":h.indexOf(["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon","Box","GeometryCollection"],i.type)==-1||(r=!0);break;case"FeatureCollection":r=!0;break;default:i.type==e&&(r=!0)}return r}parseFeature(i){var e,r,t,s;t=i.properties?i.properties:{},s=i.geometry&&i.geometry.bbox||i.bbox;try{r=this.parseGeometry(i.geometry)}catch(n){throw n}return e=new v(r,t),s&&(e.bounds=M.fromArray(s)),i.id&&(e.geometry.id=i.id,e.fid=i.id),e}parseGeometry(i){if(i==null)return null;var e;if(i.type=="GeometryCollection"){if(!h.isArray(i.geometries))throw"GeometryCollection must have geometries array: "+i;for(var r=i.geometries.length,t=new Array(r),s=0;s<r;++s)t[s]=this.parseGeometry.apply(this,[i.geometries[s]]);e=new P(t)}else{if(!h.isArray(i.coordinates))throw"Geometry must have coordinates array: "+i;if(!this.parseCoords[i.type.toLowerCase()])throw"Unsupported geometry type: "+i.type;try{e=this.parseCoords[i.type.toLowerCase()].apply(this,[i.coordinates])}catch(n){throw n}}return e}createCRSObject(i){var e=i.layer.projection.toString(),r={};if(e.match(/epsg:/i)){var t=parseInt(e.substring(e.indexOf(":")+1));t==4326?r={type:"name",properties:{name:"urn:ogc:def:crs:OGC:1.3:CRS84"}}:r={type:"name",properties:{name:"EPSG:"+t}}}return r}_toiSevrerFeature(i){const e=i.attributes,r=[],t=[];for(var s in e)r.push(s),t.push(e[s]);const n={fieldNames:r,fieldValues:t,geometry:S.fromGeometry(i.geometry)};return n.geometry.id=i.fid,n}createAttributes(i){if(!i)return null;var e={};s(i,e);var r=["fieldNames","fieldValues","geometry","stringID","ID"];for(var t in i)r.indexOf(t)>-1||(e[t]=i[t]);function s(n,l){if(n.hasOwnProperty("fieldNames")&&n.hasOwnProperty("fieldValues")){var p=n.fieldNames,c=n.fieldValues;for(var g in p)l[p[g]]=c[g]}}return e}}var L=function(o){var i=6378137,e;if(o===y.METER)e=1;else if(o===y.DEGREE)e=Math.PI*2*i/360;else if(o===y.KILOMETER)e=.001;else if(o===y.INCH)e=1/.025399999918;else if(o===y.FOOT)e=.3048;else return e;return e};const A={};u.Util.supermap_callbacks=A;const T=function(o){return o&&new N().toGeoJSON(o)},D=function(o){if(!o)return o;let i;const e=new N;if(["FeatureCollection","Feature","Geometry"].indexOf(o.type)!==-1)i=e.read(o,o.type);else if(typeof o.toGeoJSON=="function"){const t=o.toGeoJSON();i=t?e.read(t,t.type):o}let r=i||o;return u.Util.isArray(i)&&(i.length===1?r=i[0]:i.length>1&&(r=[],i.map(function(t){return r.push(t.geometry),t}))),r&&r.geometry?r.geometry:r},d=L,U=function(o,i,e){const r=39.37007874015748,t=d(e);let s=o*i*r*t;return s=1/s,s},J=function(o,i,e){const r=39.37007874015748,t=d(e);let s=o*i*r*t;return s=1/s,s},b=function(o,i,e,r){let t=null;const s=1e4;return r=r||6378137,e=e||"",o>0&&i>0?(o=u.Util.NormalizeScale(o),e.toLowerCase()==="degree"||e.toLowerCase()==="degrees"||e.toLowerCase()==="dd"?(t=.0254*s/i/o/(Math.PI*2*r/360)/s,t):(t=.0254*s/i/o/s,t)):-1},R=function(o){return o>1?1/o:o};u.Util.toGeoJSON=T;u.Util.toSuperMapGeometry=D;u.Util.resolutionToScale=U;u.Util.scaleToResolution=J;u.Util.getMeterPerMapUnit=d;u.Util.GetResolutionFromScaleDpi=b;u.Util.NormalizeScale=R;export{U as r,D as t};
