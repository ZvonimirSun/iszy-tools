import{a as U,H as K,am as T,v as k,g as L,y as P,j as n,w as l,D as d,C as o,o as c,x as r,Q as D,B as W,c as se,r as ne,ar as ae,I,U as H,z as E,N as z,O as q,E as Y,M as J,L as re,aq as y,h as Q,P as ie,an as X,G as de,aj as ue,bl as pe}from"./index-B74qAObi.js";import{E as Z}from"./el-divider-Dp-B900r.js";import{E as G}from"./el-space-DA_WJkom.js";import{E as ee}from"./el-checkbox-BiYf3wXW.js";import{T as B,u as fe}from"./Router-810EeTv3.js";import{E as me}from"./el-popover-CAyXK4Dh.js";import"./el-popper-F5yJsTgW.js";import{E as ce}from"./el-dialog-CIvnMNEg.js";import{a as _e,E as ge}from"./el-form-item-DX9Kdh8G.js";import{L as ve}from"./linuxdo-C7o2R0pC.js";import{E as we,a as ye}from"./el-radio-group-ByUm7CGI.js";import"./omit-D_IKygii.js";import"./last-D-rYfuUG.js";import"./index-DqSb17bi.js";import"./index-B8bjuJjA.js";import"./castArray-HXGYNaq5.js";import"./clone-DaVDKMpV.js";const ke=U({__name:"jsonEditor",setup(x){const s=K(),_=T(),i=s.modules.jsonEditor;return(C,t)=>{const V=B,m=ee,b=G;return c(),k("div",null,[n(_).logged?(c(),L(V,{key:0,level:5},{default:l(()=>[...t[1]||(t[1]=[d(" JSON 编辑器 ",-1)])]),_:1})):P("",!0),n(_).logged?(c(),L(b,{key:1},{default:l(()=>[o(m,{modelValue:n(i).syncCloud,"onUpdate:modelValue":t[0]||(t[0]=f=>n(i).syncCloud=f)},{default:l(()=>[...t[2]||(t[2]=[d(" 从云端获取 ",-1)])]),_:1},8,["modelValue"])]),_:1})):P("",!0)])}}}),xe={"w-full":"","overflow-auto":""},Ve={"gap-4":"",class:"settings-wrapper"},be=U({__name:"toolSettings",setup(x){return(s,_)=>{const i=B;return c(),k("div",xe,[o(i,{level:4},{default:l(()=>[..._[0]||(_[0]=[d(" 应用设置 ",-1)])]),_:1}),r("div",Ve,[o(ke)])])}}}),Ce=D(be,[["__scopeId","data-v-730637d2"]]),Ne=U({inheritAttrs:!1,__name:"HaveAccess",props:{auth:{type:[Boolean,Object],default:!1},link:{default:""}},setup(x){const s=x,_=T(),i=fe(),C=W(),t=se(()=>s.auth?typeof s.auth=="boolean"?_.logged:_.checkAccess(s.auth):s.link?_.checkAccess(i.getAuth(s.link)):!0);function V(){s.link&&C.push(s.link)}return(m,b)=>n(t)?ne(m.$slots,"default",ae({key:0},m.$attrs,{goto:V})):P("",!0)}}),Ee={flex:"","flex-col":"","items-start":"","gap-4":"","text-7":""},Se={flex:"","items-center":"","gap-4":""},Pe={flex:"","items-center":"","gap-4":""},Ue={flex:"","items-center":"","gap-4":""},$e={flex:"","items-center":"","gap-4":""},he={flex:"","items-center":"","gap-4":""},Ie={flex:"","items-center":"","gap-4":""},Te=["title","onClick"],De=["src"],Be=["onClick"],Oe={flex:"","items-center":""},Le={class:"dialog-footer"},Re={flex:"~ col","m-0":"","gap-4":"","p-0":""},Ae={"w-full":"","flex-inline":"","items-center":"","gap-2":""},Me=["title"],je={key:0},Fe={"w-full":"","p-l-6":""},ze={underline:""},Ge={underline:""},He={underline:""},qe={flex:"","items-center":""},Je={class:"dialog-footer"},Qe=U({__name:"personalInfo",setup(x){const s=T(),_=[{type:"github",title:"Github",icon:"i-icon-park-outline:github"},{type:"linuxdo",title:"LINUX DO",img:ve}],i=I(!1),C=I(),t=H({userName:"",nickName:"",email:"",passwd:"",rePasswd:"",oldPasswd:""}),V=H({userName:[{trigger:"change",validator:(u,e,p)=>{e&&!e.trim()?p(new Error("用户名无效")):p()}}],nickName:[{trigger:"change",validator:(u,e,p)=>{e&&!e.trim()?p(new Error("昵称无效")):p()}}],rePasswd:[{trigger:"change",validator:(u,e,p)=>{e&&e!==t.passwd?p(new Error("两次输入的密码不一致")):p()}}]}),m=I(""),b=I(!1),f=I([]);async function g(){try{f.value=await s.getDevices(),b.value=!0}catch(u){b.value=!1,y.error(u.message)}}function v(){b.value=!1}async function $(u){if(u.current){await s.logout(),y.success("登出成功");return}await s.logoutDevice(u),y.success("登出成功"),u.all||(f.value=await s.getDevices())}function R(){t.userName=s.profile.userName??"",t.nickName=s.profile.nickName??"",t.email=s.profile.email??"",t.passwd="",t.rePasswd="",t.oldPasswd="",i.value=!0}function O(){i.value=!1}async function A(u){u&&await u.validate(async e=>{if(e){const p={};if(t.userName&&(p.userName=t.userName),t.nickName&&(p.nickName=t.nickName),t.email&&(p.email=t.email),t.passwd&&(p.passwd=t.passwd,t.oldPasswd&&(p.oldPasswd=t.oldPasswd)),Object.keys(p).length===0){y.warning("没有需要修改的信息");return}try{await s.updateUser(p)}catch(w){y.error(w.message)}i.value=!1}else y.warning("请检查输入")})}async function te(u,e){if(s.profile[u])return;const p=new URL(`${X.apiBaseUrl}/auth/${u}/bind`);p.searchParams.append("access_token",s.access_token),le(u,p.toString(),e)}async function oe(u){if(s.profile[u])try{await s.thirdPartyUnbind(u),y.success("解绑成功")}catch(e){y.error(e.message)}}async function M(u){const e=u.source;if(u.origin===X.apiBaseUrl)if(u.data?.type==="bind_success"){window.removeEventListener("message",M),e.close();try{await s.thirdPartyBind(m.value,u.data.data),y.success("绑定成功")}catch(p){y.error(p.message)}finally{m.value=""}}else u.data?.type==="bind_fail"&&(window.removeEventListener("message",M),e.close(),m.value="",y.error("绑定失败"))}function le(u,e,p="绑定第三方登录",w=500,N=600){if(m.value){y.warning("绑定进行中，请勿重复点击");return}m.value=u,window.addEventListener("message",M);const S=(window.screen.height-w)/2,j=(window.screen.width-N)/2,h=window.open(e,p,`popup,width=${w},height=${N},top=${S},left=${j}`);if(!h){m.value="",y.error("请允许浏览器弹出窗口！");return}const a=window.setInterval(()=>{h.closed&&(window.clearInterval(a),m.value="")},500)}return(u,e)=>{const p=B,w=Y,N=re,S=ge,j=_e,h=ce;return c(),k("div",null,[o(p,{level:4},{default:l(()=>[...e[11]||(e[11]=[d(" 账户信息 ",-1)])]),_:1}),r("div",Ee,[r("div",Se,[e[12]||(e[12]=r("div",{"w-32":"","text-right":""}," 用户名: ",-1)),r("div",null,E(n(s).profile.userName),1)]),r("div",Pe,[e[13]||(e[13]=r("div",{"w-32":"","text-right":""}," 昵称: ",-1)),r("div",null,E(n(s).profile.nickName),1)]),r("div",Ue,[e[14]||(e[14]=r("div",{"w-32":"","text-right":""}," 邮箱: ",-1)),r("div",null,E(n(s).profile.email),1)]),r("div",$e,[e[15]||(e[15]=r("div",{"w-32":"","text-right":""}," 角色: ",-1)),r("div",null,E(n(s).profile?.roles?.[0]?.alias??"注册用户"),1)]),r("div",he,[e[17]||(e[17]=r("div",{"w-32":"","text-right":""}," 绑定: ",-1)),r("div",Ie,[(c(),k(z,null,q(_,a=>r("div",{key:a.type,class:Q(["third-party",{active:n(s).profile[a.type]}]),title:a.title,onClick:F=>te(a.type,`${a.title} 绑定`)},[a.icon?(c(),k("i",{key:0,class:Q(a.icon)},null,2)):a.img?(c(),k("img",{key:1,src:a.img,class:"third-party-img",alt:""},null,8,De)):P("",!0),n(s).profile[a.type]?(c(),k("div",{key:2,class:"unbind-btn",title:"解绑",onClick:ie(F=>oe(a.type),["stop"])},[...e[16]||(e[16]=[r("i",{class:"i-icon-park-solid:close-one"},null,-1)])],8,Be)):P("",!0)],10,Te)),64))])]),r("div",Oe,[o(w,{onClick:R},{default:l(()=>[...e[18]||(e[18]=[d(" 修改信息 ",-1)])]),_:1}),o(w,{onClick:g},{default:l(()=>[...e[19]||(e[19]=[d(" 登录设备管理 ",-1)])]),_:1})])]),o(h,{modelValue:n(i),"onUpdate:modelValue":e[7]||(e[7]=a=>J(i)?i.value=a:null),title:"修改信息","before-close":O},{footer:l(()=>[r("span",Le,[o(w,{onClick:O},{default:l(()=>[...e[20]||(e[20]=[d("取消",-1)])]),_:1}),o(w,{type:"primary",onClick:e[6]||(e[6]=a=>A(n(C)))},{default:l(()=>[...e[21]||(e[21]=[d(" 保存 ",-1)])]),_:1})])]),default:l(()=>[o(j,{ref_key:"ruleFormRef",ref:C,model:n(t),rules:n(V),"label-width":"8rem","label-position":"left"},{default:l(()=>[o(S,{label:"用户名",prop:"userName"},{default:l(()=>[o(N,{modelValue:n(t).userName,"onUpdate:modelValue":e[0]||(e[0]=a=>n(t).userName=a)},null,8,["modelValue"])]),_:1}),o(S,{label:"昵称",prop:"nickName"},{default:l(()=>[o(N,{modelValue:n(t).nickName,"onUpdate:modelValue":e[1]||(e[1]=a=>n(t).nickName=a)},null,8,["modelValue"])]),_:1}),o(S,{label:"邮箱",prop:"email"},{default:l(()=>[o(N,{modelValue:n(t).email,"onUpdate:modelValue":e[2]||(e[2]=a=>n(t).email=a)},null,8,["modelValue"])]),_:1}),o(S,{label:"旧密码",prop:"oldPasswd"},{default:l(()=>[o(N,{modelValue:n(t).oldPasswd,"onUpdate:modelValue":e[3]||(e[3]=a=>n(t).oldPasswd=a),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(S,{label:"新密码",prop:"passwd"},{default:l(()=>[o(N,{modelValue:n(t).passwd,"onUpdate:modelValue":e[4]||(e[4]=a=>n(t).passwd=a),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1}),o(S,{label:"确认密码",prop:"rePasswd"},{default:l(()=>[o(N,{modelValue:n(t).rePasswd,"onUpdate:modelValue":e[5]||(e[5]=a=>n(t).rePasswd=a),type:"password",autocomplete:"off"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),o(h,{modelValue:n(b),"onUpdate:modelValue":e[10]||(e[10]=a=>J(b)?b.value=a:null),title:"管理登录设备","before-close":v,width:400},{footer:l(()=>[r("span",Je,[o(w,{type:"primary",onClick:v},{default:l(()=>[...e[28]||(e[28]=[d(" 关闭 ",-1)])]),_:1})])]),default:l(()=>[r("ul",Re,[(c(!0),k(z,null,q(n(f),(a,F)=>(c(),k("li",{key:F,"w-full":"",flex:"~ col"},[r("div",Ae,[r("span",{"flex-1":"","overflow-hidden":"","font-bold":"",text:"ellipsis nowrap",title:a.name||a.id},E(a.name||a.id),9,Me),a.current?(c(),k("span",je,"(当前设备)")):P("",!0),o(w,{size:"small",onClick:nt=>$({deviceId:a.id,current:a.current})},{default:l(()=>[...e[22]||(e[22]=[d(" 登出 ",-1)])]),_:1},8,["onClick"])]),r("div",Fe,[r("table",null,[r("tbody",null,[r("tr",null,[e[23]||(e[23]=r("td",{"text-right":""}," IP: ",-1)),r("td",ze,E(a.ip),1)]),r("tr",null,[e[24]||(e[24]=r("td",{"text-right":""}," 首次登录时间: ",-1)),r("td",Ge,E(a.createTime),1)]),r("tr",null,[e[25]||(e[25]=r("td",{"text-right":""}," 最后登录时间: ",-1)),r("td",He,E(a.lastLoginTime),1)])])])])]))),128)),r("li",qe,[o(w,{size:"small",onClick:e[8]||(e[8]=a=>$({other:!0}))},{default:l(()=>[...e[26]||(e[26]=[d(" 登出其他 ",-1)])]),_:1}),o(w,{size:"small",onClick:e[9]||(e[9]=a=>$({all:!0}))},{default:l(()=>[...e[27]||(e[27]=[d(" 登出所有 ",-1)])]),_:1})])])]),_:1},8,["modelValue"])])}}}),Xe=D(Qe,[["__scopeId","data-v-193804cc"]]),Ke=de("main",{persist:!0,state:()=>({_cache:{},clearOfflineCacheTag:!1}),getters:{getData:x=>s=>{if(s)return(x._cache||{})[s]}},actions:{setData({key:x,val:s}={}){x&&(this._cache=this._cache||{},this._cache[x]=s)},clear(){this._cache={}},clearOfflineCache(){console.log("clearOfflineCache"),this.clearOfflineCacheTag=!0}}}),We={flex:"","items-center":"","gap-4":""},Ye=U({__name:"authInfo",setup(x){const s=W(),_=ue(),i=T(),C=()=>Ke().clearOfflineCache();function t(){s.push({path:"/login",query:{redirect:_.fullPath}})}function V(){s.push("/register")}function m(){s.push("/logout")}return(b,f)=>{const g=Y,v=Ne,$=me,R=Z,O=G;return n(i).logged?(c(),k(z,{key:0},[r("div",We,[o(g,{type:"primary",onClick:m},{default:l(()=>[...f[0]||(f[0]=[d(" 登出 ",-1)])]),_:1}),o(v,{link:"/userManager"},{default:l(({goto:A})=>[o(g,{onClick:A},{default:l(()=>[...f[1]||(f[1]=[d(" 用户权限中心 ",-1)])]),_:1},8,["onClick"])]),_:1}),o($,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:C},{reference:l(()=>[o(g,{type:"danger",plain:""},{default:l(()=>[...f[2]||(f[2]=[d(" 清空本地缓存 ",-1)])]),_:1})]),_:1})]),o(R),o(Xe)],64)):(c(),L(O,{key:1,"mt-4":""},{default:l(()=>[o(g,{type:"primary",onClick:t},{default:l(()=>[...f[3]||(f[3]=[d(" 登录 ",-1)])]),_:1}),o(g,{onClick:V},{default:l(()=>[...f[4]||(f[4]=[d(" 注册 ",-1)])]),_:1}),o($,{title:"您是否确定要清空本地缓存？","confirm-button-text":"清空",onConfirm:C},{reference:l(()=>[o(g,{type:"danger",plain:""},{default:l(()=>[...f[5]||(f[5]=[d(" 清空本地缓存 ",-1)])]),_:1})]),_:1})]),_:1}))}}}),Ze=D(Ye,[["__scopeId","data-v-304747f8"]]),et={class:"settings-wrapper"},tt=U({__name:"globalSettings",setup(x){const s=K(),_=pe(),i=s.general;return(C,t)=>{const V=B,m=ye,b=we,f=G,g=ee;return c(),k("div",et,[o(V,{level:4},{default:l(()=>[...t[5]||(t[5]=[d(" 全局设置 ",-1)])]),_:1}),o(V,{level:5},{default:l(()=>[...t[6]||(t[6]=[d(" 外观 ",-1)])]),_:1}),o(f,null,{default:l(()=>[o(b,{"model-value":n(i).theme.mode,onChange:n(_).setTheme},{default:l(()=>[o(m,{value:"auto",label:"跟随系统"}),o(m,{value:"light",label:"浅色"}),o(m,{value:"dark",label:"深色"})]),_:1},8,["model-value","onChange"])]),_:1}),o(V,{level:5},{default:l(()=>[...t[7]||(t[7]=[d(" 访问统计 ",-1)])]),_:1}),o(f,null,{default:l(()=>[o(g,{modelValue:n(i).showMost,"onUpdate:modelValue":t[0]||(t[0]=v=>n(i).showMost=v)},{default:l(()=>[...t[8]||(t[8]=[d(" 最常访问 ",-1)])]),_:1},8,["modelValue"]),o(g,{modelValue:n(i).showRecent,"onUpdate:modelValue":t[1]||(t[1]=v=>n(i).showRecent=v)},{default:l(()=>[...t[9]||(t[9]=[d(" 最近访问 ",-1)])]),_:1},8,["modelValue"])]),_:1}),o(V,{level:5},{default:l(()=>[...t[10]||(t[10]=[d(" 其他设置 ",-1)])]),_:1}),o(f,null,{default:l(()=>[o(g,{modelValue:n(i).showSearch,"onUpdate:modelValue":t[2]||(t[2]=v=>n(i).showSearch=v)},{default:l(()=>[...t[11]||(t[11]=[d(" 显示搜索 ",-1)])]),_:1},8,["modelValue"]),o(g,{modelValue:n(i).showType,"onUpdate:modelValue":t[3]||(t[3]=v=>n(i).showType=v)},{default:l(()=>[...t[12]||(t[12]=[d(" 显示分类 ",-1)])]),_:1},8,["modelValue"]),o(g,{modelValue:n(i).openInNewTab,"onUpdate:modelValue":t[4]||(t[4]=v=>n(i).openInNewTab=v)},{default:l(()=>[...t[13]||(t[13]=[d(" 新标签页打开工具 ",-1)])]),_:1},8,["modelValue"])]),_:1})])}}}),ot=D(tt,[["__scopeId","data-v-f2fa67ef"]]),lt={flex:"","flex-wrap":"","items-start":"","gap-4":""},st=U({__name:"settings",setup(x){const s=T();return(_,i)=>{const C=B,t=Z;return c(),k("div",null,[n(s).logged?(c(),L(C,{key:0,level:3},{default:l(()=>[d(E(n(s).profile.nickName)+" 欢迎你~ ",1)]),_:1})):P("",!0),o(Ze),o(t),r("div",lt,[o(ot),o(Ce,{"flex-1":""})])])}}}),bt=D(st,[["__scopeId","data-v-0add9d51"]]);export{bt as default};
