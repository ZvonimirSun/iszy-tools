import{X as s,ar as i,as as m,T as B,F as b,aE as g,o as x,aY as p,bd as E,a$ as u,J as z,K as F,a1 as L,u as h}from"./index-Tr-dY9sd.js";import"./el-empty-jlcBcXS2.js";import{F as v,E as C,a as N}from"./el-table-v2-nRRyEbqv.js";import{d as y}from"./dayjs.min-ibOCvbiK.js";/* empty css               */import{E as Y}from"./el-popover-Ouwpg9Bu.js";import"./Router-twqYWQ-l.js";import{E as f}from"./index-aUgguFfQ.js";import"./raf-YnYdwPCo.js";import"./memoize-one.esm-JaOscZgY.js";import"./castArray-7k1-08SJ.js";var o=function(t){return t[t.DELETED=-1]="DELETED",t[t.DEACTIVATED=0]="DEACTIVATED",t[t.ENABLED=1]="ENABLED",t[t.DISABLED=2]="DISABLED",t}(o||{});function M(t){return[{key:"userId",dataKey:"userId",width:150,hidden:!0},{key:"userName",dataKey:"userName",title:"用户名",width:150,align:"center"},{key:"nickName",dataKey:"nickName",title:"昵称",width:150,align:"center"},{key:"email",dataKey:"email",title:"邮箱",width:150,align:"center"},{key:"roles",title:"角色",width:150,align:"center",cellRenderer:({rowData:a})=>{var d;const n=((d=a.roles)==null?void 0:d.map(c=>c.name).join(", "))||"";return s("span",null,[n])}},{key:"status",title:"状态",width:100,align:"center",cellRenderer:({rowData:a})=>{switch(a.status){case o.ENABLED:return s(f,{type:"success"},{default:()=>[i("正常")]});case o.DISABLED:return s(f,{type:"info"},{default:()=>[i("禁用")]});case o.DEACTIVATED:return s(f,{type:"info"},{default:()=>[i("待激活")]});default:return s(f,{type:"warning"},{default:()=>[i("未知")]})}}},{key:"createdAt",title:"创建时间",width:200,align:"center",cellRenderer:({rowData:a})=>s("span",null,[y(a.createdAt).format("YYYY-MM-DD HH:mm:ss")])},{key:"updatedAt",title:"更新时间",width:200,align:"center",cellRenderer:({rowData:a})=>s("span",null,[y(a.updatedAt).format("YYYY-MM-DD HH:mm:ss")])},{key:"operations",title:"操作",width:200,fixed:v.RIGHT,cellRenderer:({rowData:a})=>s(B,null,[s(m,{size:"small",plain:!0,onClick:()=>t(a,"edit")},{default:()=>[i("修改")]}),a.status===o.DEACTIVATED||a.status===o.DISABLED?s(m,{size:"small",plain:!0,onClick:()=>t(a,"activate")},{default:()=>[i("启用")]}):s(m,{size:"small",plain:!0,onClick:()=>t(a,"disable")},{default:()=>[i("禁用")]}),s(Y,{title:"确定要删除吗？",onConfirm:()=>t(a,"delete")},{reference:()=>s(m,{size:"small",plain:!0,type:"danger"},{default:()=>[i("删除")]})})])}]}const R={"h-full":"","w-full":""},Q=b({__name:"userManager",setup(t){const a=g([]),n=g({index:1,size:10}),d=M(D);x(()=>{c(1,n.size)});async function c(r,e){try{const l=(await E.get(`${p.apiOrigin}/user/list`,{params:{pageIndex:r,pageSize:e}})).data;if(l.success)a.splice(0,a.length,...l.data);else throw new Error(l.message)}catch(l){u.error(l.message)}}function D(r,e){switch(e){case"edit":break;case"disable":w(r);break;case"activate":A(r);break;case"delete":_(r);break}}async function w(r){try{const e=(await E.post(`${p.apiOrigin}/user/ban`,null,{params:{id:r.userId}})).data;if(e.success)u.success(e.message),await c(n.index,n.size);else throw new Error(e.message)}catch(e){u.error(e.message)}}async function A(r){try{const e=(await E.post(`${p.apiOrigin}/user/activate`,null,{params:{id:r.userId}})).data;if(e.success)u.success(e.message),await c(n.index,n.size);else throw new Error(e.message)}catch(e){u.error(e.message)}}async function _(r){try{const e=(await E.post(`${p.apiOrigin}/user/remove`,null,{params:{id:r.userId}})).data;if(e.success)u.success(e.message),await c(n.index,n.size);else throw new Error(e.message)}catch(e){u.error(e.message)}}return(r,e)=>{const l=C,k=N;return z(),F("div",R,[s(k,null,{default:L(({width:T,height:I})=>[s(l,{columns:h(d),data:h(a),width:T,height:I,fixed:""},null,8,["columns","data","width","height"])]),_:1})])}}});export{Q as default};
